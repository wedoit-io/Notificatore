function ArrayList(c){Array.call(this);if(c){if(typeof(c)=="number"){}else{if(c instanceof ArrayList){var b=c.Count();for(var a=0;a<b;a++){this.Add(c[a])}}}}}ArrayList.prototype=new Array();ArrayList.prototype.toString=function(){return this.join(",")};ArrayList.prototype.Add=function(a){this.push(a)};ArrayList.prototype.Get=function(a){return this[a]};ArrayList.prototype.Count=function(){return this.length};ArrayList.prototype.Clear=function(){this.splice(0,this.length)};ArrayList.prototype.Remove=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){this.splice(a,1);break}}};ArrayList.prototype.RemoveAt=function(a){this.splice(a,1)};ArrayList.prototype.SortFunction=function(d,c){return d.CompareTo(c)};ArrayList.prototype.Sort=function(){if(this.Count()==0){return}if(this[0]&&this[0].CompareTo){this.sort(this.SortFunction)}else{this.sort()}};ArrayList.prototype.Insert=function(a,b){this.splice(a,0,b)};ArrayList.prototype.Clone=function(){var a=new ArrayList();a.AddRange(this);return a};ArrayList.prototype.AddRange=function(d){var b=d.Count();for(var a=0;a<b;a++){this.Add(d[a])}};ArrayList.prototype.Contains=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){return true}}return false};ArrayList.prototype.IndexOf=function(b){var c=this.length;for(var a=0;a<c;a++){if(b==this[a]){return a}}return -1};base64={};base64.PADCHAR="=";base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";base64.getbyte64=function(c,b){var a=base64.ALPHA.indexOf(c.charAt(b));if(a==-1){throw"Cannot decode base64"}return a};base64.decode=function(d){d=""+d;var g=base64.getbyte64;var f,c,e;var b=d.length;if(b==0){return d}if(b%4!=0){throw"Cannot decode base64"}f=0;if(d.charAt(b-1)==base64.PADCHAR){f=1;if(d.charAt(b-2)==base64.PADCHAR){f=2}b-=4}var a=[];for(c=0;c<b;c+=4){e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6)|g(d,c+3);a.push(String.fromCharCode(e>>16,(e>>8)&255,e&255))}switch(f){case 1:e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6);a.push(String.fromCharCode(e>>16,(e>>8)&255));break;case 2:e=(g(d,c)<<18)|(g(d,c+1)<<12);a.push(String.fromCharCode(e>>16));break}return a.join("")};base64.getbyte=function(c,b){var a=c.charCodeAt(b);if(a>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return a};base64.encode=function(e){if(arguments.length!=1){throw"SyntaxError: Not enough arguments"}var b=base64.PADCHAR;var g=base64.ALPHA;var f=base64.getbyte;var d,h;var a=[];e=""+e;var c=e.length-e.length%3;if(e.length==0){return e}for(d=0;d<c;d+=3){h=(f(e,d)<<16)|(f(e,d+1)<<8)|f(e,d+2);a.push(g.charAt(h>>18));a.push(g.charAt((h>>12)&63));a.push(g.charAt((h>>6)&63));a.push(g.charAt(h&63))}switch(e.length-c){case 1:h=f(e,d)<<16;a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+b+b);break;case 2:h=(f(e,d)<<16)|(f(e,d+1)<<8);a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+g.charAt((h>>6)&63)+b);break}return a.join("")};if(self.atob==undefined){self.atob=base64.decode}if(self.btoa==undefined){self.btoa=base64.encode}function Collection(a){this.coll=a||(new ArrayList())}Collection.prototype.GetNative=function(){return this.coll};Collection.prototype.Add=function(a){this.coll.Add(a)};Collection.prototype.Get=function(a){return this.coll[a]};Collection.prototype.GetString=function(a){return this.coll[a]};Collection.prototype.GetInteger=function(a){return this.coll[a]};Collection.prototype.RemoveLast=function(){this.coll.RemoveAt(this.coll.Count()-1)};Collection.prototype.Clear=function(){this.coll.Clear()};Collection.prototype.Count=function(){return this.coll.Count()};if(String.prototype.trim==undefined){String.prototype.trim=function(){return(this.trimLeft().trimRight())}}if(String.prototype.trimLeft==undefined){String.prototype.trimLeft=function(){if(this.length==0){return this}var a=0;while(" \t\n\v\f\r".indexOf(this.charAt(a))!=-1){a++}return this.substr(a)}}if(String.prototype.trimRight==undefined){String.prototype.trimRight=function(){if(this.length==0){return this}var a=this.length-1;while(" \t\n\v\f\r".indexOf(this.charAt(a))!=-1){a--}return this.substr(0,a+1)}}if(String.prototype.startsWith==undefined){String.prototype.startsWith=function(a){return(this.substr(0,a.length)==a)}}if(String.prototype.endsWith==undefined){String.prototype.endsWith=function(a){return(this.substr(this.length-a.length)==a)}}if(String.prototype.equals==undefined){String.prototype.equals=function(a){return(this+""==a)}}if(String.compare==undefined){String.compare=function(c,a,b){if(b){srtA=c.toLowerCase();srtB=a.toLowerCase()}if(c>a){return 1}else{if(c<a){return -1}else{return 0}}}}if(String.prototype.remove==undefined){String.prototype.remove=function(a,d){var c=this.substring(0,a);var b="";if(a+d<this.length){b=this.substring(a+d)}return c+b}}if(String.prototype.insert==undefined){String.prototype.insert=function(a,d){if(a>=this.length){return this.concat(d)}var c=this.substring(0,a);var b=this.substring(a);return c+d+b}}if(String.prototype.Replace==undefined){String.prototype.Replace=function(b,a){return this.replace(new RegExp(b,"g"),a)}}if(String.prototype.toHex==undefined){String.prototype.toHex=function(c){var b="";for(var a=0;a<c.length;a++){b+=(c.charCodeAt(a)<16?"0":"")+c.charCodeAt(a).toString(16).toUpperCase()}return b}}if(String.isDigit==undefined){String.isDigit=function(a){return(a>="0"&&a<="9")}}if(Array.resize==undefined){Array.resize=function(d,a){var c=d.length;if(a<c){d.splice(a,c-a)}else{for(var b=c;b<a;b++){d.push(undefined)}}}}if(Array.copy==undefined){Array.copy=function(e,a,f,b,d){for(var c=0;c<d;c++){f[b+c]=e[a+c]}}}if(Array.prototype.copyTo==undefined){Array.prototype.copyTo=function(c,a){for(var b=a;b<this.length;b++){c[b]=this[b]}}}if(Array.prototype.remove==undefined){Array.prototype.remove=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1);return}}}}if(Object.keys==undefined){Object.keys=function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(b)}}return a}}if(Object.prototype.clone==undefined){Object.prototype.clone=function(){var a=new (Object(this).constructor);var c=Object.keys(this);for(var b=0;b<c.length;b++){var e=c[b];var d=this[e];switch(typeof(d)){case"object":a[e]=(d===null?null:d.clone());break;case"function":break;default:a[e]=this[e];break}}return a}}Object.prototype.getClassName=function(){if(this.constructor.prototype.constructor.name!=undefined){return this.constructor.prototype.constructor.name}else{var a=this.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return a[1]}}return undefined};Object.prototype.getConstructorName=function(){if(this.prototype.constructor.name!=undefined){return this.prototype.constructor.name}else{var a=this.prototype.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return a[1]}}return undefined};Object.prototype.ToString=function(){return this.toString()};Boolean.prototype.toString=function(){return(this==true?"-1":"0")};if(Date.prototype.dstOffset==undefined){Date.prototype.dstOffset=function(){var a=new Date(this.getFullYear(),0,1);var c=new Date(this.getFullYear(),6,1);var b=Math.max(a.getTimezoneOffset(),c.getTimezoneOffset());return(this.getTimezoneOffset()<b?3600000:0)}}if(self.myPostMessage==undefined){self.myPostMessage=function(a){self.postMessage(a)}}function WriteToConsoleError(a){WriteToConsole(a,"error")}function WriteToConsoleOutput(a){WriteToConsole(a,"output")}function WriteToConsole(b,a){var c="";if(self.RD4_ServerSession){c="(SS '"+self.RD4_ServerSession.SessionName+"') "}else{c="(Main Application) "}if(typeof(b)=="object"){if(b.stack){c+=b.stack}else{if(b.message){c+=b.message}else{c+=JSON.stringify(b)}}}else{c+=b}myPostMessage({type:"debug",channel:a,message:c})}function TryOpenDatabase(c,a,f,e){for(var d=0;d<30*5;d++){var b=openDatabaseSync(c,a,f,e);if(b!=null){return b}if(d==0){myPostMessage({type:"db",name:c,ver:a,desc:f,size:e})}IDL.Sleep(200)}return null}self.BlobBuilder=self.MozBlobBuilder||self.WebKitBlobBuilder||self.BlobBuilder;self.URL=self.webkitURL||self.URL;function BitArray(b){Array.call(this);if(b){if(typeof(b)=="number"){var c=Math.floor(b);for(var a=0;a<c;a++){this.push(false)}}}}BitArray.prototype=new Array();BitArray.prototype.SetAll=function(b){var c=this.length;for(var a=0;a<c;a++){this[a]=b}}
/* @source http://purl.eligrey.com/github/BlobBuilder.js/blob/master/BlobBuilder.js */
;self.BlobBuilder=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||(function(k){var c=function(w){return Object.prototype.toString.call(w).match(/^\[object\s(.*)\]$/)[1]};var v=function(){this.data=[]};var u=function(y,w,x){this.data=y;this.size=y.length;this.type=w;this.encoding=x};var l=v.prototype;var t=u.prototype;var p=k.FileReaderSync;var a=function(w){this.code=this[this.name=w]};var m=("NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR").split(" ");var s=m.length;var q=k.URL||k.webkitURL||k;var r=q.createObjectURL;var b=q.revokeObjectURL;var e=q;var j=k.btoa;var f=k.atob;var o=false;var h=function(w){o=!w};var d=k.ArrayBuffer;var g=k.Uint8Array;v.fake=t.fake=true;while(s--){a.prototype[m[s]]=s+1}if(!q.createObjectURL){e=k.URL={}}e.createObjectURL=function(x){var y=x.type;var w;if(y===null){y="application/octet-stream"}if(x instanceof u){w="data:"+y;if(x.encoding==="base64"){return w+";base64,"+x.data}else{if(x.encoding==="URI"){return w+","+decodeURIComponent(x.data)}}if(j){return w+";base64,"+j(x.data)}else{return w+","+encodeURIComponent(x.data)}}else{if(real_create_object_url){return real_create_object_url.call(q,x)}}};e.revokeObjectURL=function(w){if(w.substring(0,5)!=="data:"&&real_revoke_object_url){real_revoke_object_url.call(q,w)}};l.append=function(A){var B=this.data;if(g&&A instanceof d){if(o){B.push(String.fromCharCode.apply(String,new g(A)))}else{var x=new g(A);var z=x.length;for(var y=0;y<z;y++){B.push(String.fromCharCode(x[y]))}}}else{if(c(A)==="Blob"||c(A)==="File"){if(p){var w=new p;B.push(w.readAsBinaryString(A))}else{throw new a("NOT_READABLE_ERR")}}else{if(A instanceof u){if(A.encoding==="base64"&&f){B.push(f(A.data))}else{if(A.encoding==="URI"){B.push(decodeURIComponent(A.data))}else{if(A.encoding==="raw"){B.push(A.data)}}}}else{if(typeof A!=="string"){A+=""}B.push(unescape(encodeURIComponent(A)))}}}};l.getBlob=function(w){if(!arguments.length){w=null}return new u(this.data.join(""),w,"raw")};l.toString=function(){return"[object BlobBuilder]"};t.slice=function(z,w,y){var x=arguments.length;if(x<3){y=null}return new u(this.data.slice(z,x>1?w:this.data.length),y,this.encoding)};t.toString=function(){return"[object Blob]"};return v}(self));DTTEngine.LEV_NONE=0;DTTEngine.LEV_EXCEPT=1;DTTEngine.LEV_PROCS=2;DTTEngine.LEV_CTRLBLCKS=3;DTTEngine.LEV_QUERY=4;DTTEngine.LEV_STATEM=5;DTTEngine.IT_NULL=-1;DTTEngine.IT_LOOPDET=0;DTTEngine.IT_ENTERPROC=1;DTTEngine.IT_EXITPROC=2;DTTEngine.IT_IF=3;DTTEngine.IT_ENTERIF=4;DTTEngine.IT_ENTERELSE=5;DTTEngine.IT_ENDIF=6;DTTEngine.IT_ASSIGN=7;DTTEngine.IT_ERROR=8;DTTEngine.IT_BREAK=9;DTTEngine.IT_EXCEPTION=10;DTTEngine.IT_RETURN=11;DTTEngine.IT_SUBPROC=12;DTTEngine.IT_FOREACH=13;DTTEngine.IT_ENDFOREACH=14;DTTEngine.IT_DBDATASRC=15;DTTEngine.IT_IMDBDATASRC=16;DTTEngine.IT_WHILE=17;DTTEngine.IT_ENDWHILE=18;DTTEngine.IT_QUERY=19;DTTEngine.IT_ENDQUERY=20;DTTEngine.IT_PARAMETER=21;DTTEngine.IT_TOKEN=22;DTTEngine.IT_CONTINUE=23;DTTEngine.IT_SWITCH=24;DTTEngine.IT_ENTERSWITCH=25;DTTEngine.IT_ENDSWITCH=26;DTTEngine.IT_FORI=27;DTTEngine.IT_ENDFORI=28;DTTEngine.IT_MESSAGE=48;DTTEngine.IT_MESSAGE_TK=49;DTTEngine.IT_USER=50;DTTEngine.IT_TRACE=100;DTTEngine.IT_TEST=200;DTTEngine.STMT_QRY_DELETE=256;DTTEngine.STMT_QRY_UPDATE=512;DTTEngine.STMT_QRY_INSVAL=768;DTTEngine.STMT_QRY_INSSEL=1024;DTTEngine.STMT_QRY_SELVAR=1280;DTTEngine.STMT_QRY_SELECT=1536;DTTEngine.STMT_QRY_SELCOL=1792;DTTEngine.PT_EVENT=0;DTTEngine.PT_EVENT_RECUR=1;DTTEngine.PT_FUNCTION=2;DTTEngine.PT_PROCEDURE=3;DTTEngine.PT_PROC_ITEM=4;DTTEngine.DTTMSG_NONE=0;DTTEngine.DTTMSG_VERB=4;DTTEngine.DTTMSG_INFO=3;DTTEngine.DTTMSG_WARN=2;DTTEngine.DTTMSG_ERROR=1;DTTEngine.TRC_ITMAIN=1;DTTEngine.TRC_ITFORM=2;DTTEngine.TRC_ITFRAME=3;DTTEngine.TRC_ITPANEL=4;DTTEngine.TRC_ITTREE=5;DTTEngine.TRC_ITTABBED=6;DTTEngine.TRC_ITCOMMAND=7;DTTEngine.TRC_ITMENU=8;DTTEngine.TRC_ITTOOLBAR=9;DTTEngine.TRC_ITBUTBAR=10;DTTEngine.TRC_ITCAPTBAR=11;DTTEngine.TRC_ITERROR=12;DTTEngine.TRC_MAINCAPTION=1;DTTEngine.TRC_MAININDIC=2;DTTEngine.TRC_FORMINDIC=3;DTTEngine.TRC_FORMCAPTION=4;DTTEngine.TRC_FORMMESSAGE=5;DTTEngine.TRC_FRAMECAPTION=6;DTTEngine.TRC_PANCAPTION=7;DTTEngine.TRC_PANFLDVALUE=8;DTTEngine.TRC_TREECAPTION=9;DTTEngine.TRC_TREENODE=10;DTTEngine.TRC_TABCAPTION=11;DTTEngine.TRC_CMDCAPTION=12;DTTEngine.TRC_CMDCOMMAND=13;DTTEngine.TRC_ERRNUMBER=14;DTTEngine.TRC_ERRDESCR=15;DTTEngine.TST_APPLOGUP=1;DTTEngine.TST_APPLOGIN=2;DTTEngine.TST_FRMMENU=10;DTTEngine.TST_FRMCLOSE=11;DTTEngine.TST_FRMSELECT=12;DTTEngine.TST_TREEEXP=20;DTTEngine.TST_TREECLK=21;DTTEngine.TST_TREENCHK=22;DTTEngine.TST_PANROWSEL=30;DTTEngine.TST_PANLOCK=31;DTTEngine.TST_PANTOOLBAR=32;DTTEngine.TST_PANCHGPG=33;DTTEngine.TST_PANSORT=34;DTTEngine.TST_PANLOOKUP=35;DTTEngine.TST_PANMSELTLB=36;DTTEngine.TST_FLDCHG=40;DTTEngine.TST_FLDACT=41;DTTEngine.TST_CMDSET=50;DTTEngine.TST_CMD=51;DTTEngine.TST_TABSELPG=60;DTTEngine.TST_BOOKTOOLBAR=70;DTTEngine.TST_MENU=80;DTTEngine.TST_BLOB=81;DTTEngine.TST_TOOLBAR=82;DTTEngine.TST_INDIC=83;DTTEngine.TST_CLOSEALL=84;DTTEngine.TST_ERROR=85;DTTEngine.TST_LOGOFF=86;DTTEngine.TST_TERM=87;function DTTEngine(){this.Requests=new ArrayList();this.AttRequest=null;this.AttItem=null;this.AttID=0;this.AlreadyInit=false;this.CurrentIndLevel=0;this.ShowTime;this.ProfileTicks=0;this.Procs=new HashTableSrv();this.ProcLoaded=false;this.ProcShowed=true;this.HiddenMessages=new ArrayList();this.BreakPoints=new ArrayList();this.flTestHorizontal;this.Level=DTTEngine.LEV_NONE;this.MsgLevel=DTTEngine.DTTMSG_NONE;this.TraceEnabled=false;this.TestEnabled=false;this.HelpGeneration=false;this.HelpGenerationActive=false;this.TestRunning;this.RecordRunning=false;this.NextSessionID=-1;this.RunMode="";this.FixedDebugFile="";this.ShowLevel;this.ShowMsgLevel;this.ShowRequest="";this.LastCmdRes="";this.MaxLoopCycles;this.LoggedLoops;this.MaxStackLoops;this.MaxRecToDump;this.TraceRecToDump;this.RequestsToPassive;this.RequestsToPerm;this.PassiveLevel;this.PassiveMsgLevel;this.PassiveTraceEnabled;this.PermSaveToDB;this.Enabled=true;this.DB;this.DBClass;this.SQLSessInsert;this.SQLSessUpdate;this.SessionID;this.SQLReqInsert;this.SQLItemInsert;this.SQLGetSessID;this.SQLGetReqID;this.SQLGetItemID;this.SQLSessLoad;this.SQLReqLoad;this.SQLItemLoad;this.SQLSubItemLoad;this.Name="";this.Description="";this.UserID;this.SessionTestSrcID;this.RefDTTObj=null;this.HelpEnabled;this.HelpSMTPServer;this.HelpSMTPUsername;this.HelpSMTPPassword;this.HelpAddress;this.HelpSubject;this.HelpName;this.HelpRecallTo;this.HelpReplyTo;this.HelpDescription;this.HelpAutoSendMail;this.LastSentTime;this.LastSentReqID;this.HelpReqIdx;this.HelpTotItems;this.HelpErrors;this.MaskGuid="";this.MaskIndLevel=-1;this.ItemCollect=true;this.LevelCollect=0;this.ItemVisible=true;this.LevelVisible=0;this.DTTStarted=false;this.DTT2File=false;this.DTTFileName="";this.ShowRecurr=true;this.MainFrm}DTTEngine.prototype.GetTickCount=function(){return new Date().getTime()};DTTEngine.prototype.Init=function(f,e,d,a,c,b){if(this.AlreadyInit){return}WriteToConsoleOutput("DTT_LEVEL="+f);WriteToConsoleOutput("DTT_MSGLEVEL="+e);if(f>0){this.DTTStarted=true}this.AlreadyInit=true;this.Level=b.getRTCObj().GetConst("2644B5C1-6387-4E9A-9481-F2A973A4CCD0",f);this.MsgLevel=b.getRTCObj().GetConst("97A1A665-A117-42A0-8C40-48079EE5F2CD",e);this.ShowLevel=f;this.ShowMsgLevel=e;this.TraceEnabled=d;this.TestEnabled=a;this.HelpGeneration=c;this.TraceRecToDump=b.getRTCObj().GetConst("B85E1BB7-E7C0-4D6B-BAB6-EFC98B1FF5B7",1);if(!this.TraceEnabled){this.MaxLoopCycles=1000;this.MaxStackLoops=32}else{this.MaxLoopCycles=1000000;this.MaxStackLoops=100}this.MaxLoopCycles=b.getRTCObj().GetConst("78A3F157-59CD-43CF-9002-2DCDD4D639D7",this.MaxLoopCycles);this.LoggedLoops=b.getRTCObj().GetConst("F899CBB9-4C90-40A3-B90C-95852DA339A1",10);this.MaxStackLoops=b.getRTCObj().GetConst("8138A398-AFF0-46E5-8614-4ADA34FD090F",this.MaxStackLoops);this.MaxRecToDump=b.getRTCObj().GetConst("1EDC9C1F-11C6-4FDF-A4B2-0905D2CC6E2C",10);this.RequestsToPassive=b.getRTCObj().GetConst("062349E2-029E-4171-BADF-401D041F1E3B",50);this.RequestsToPerm=b.getRTCObj().GetConst("22E56642-C0DA-45A5-A1AD-F4FF05E8D38F",100);this.PassiveLevel=(this.TestEnabled?this.Level:DTTEngine.LEV_EXCEPT);this.PassiveMsgLevel=(this.TestEnabled?this.MsgLevel:DTTEngine.DTTMSG_WARN);this.PassiveTraceEnabled=this.TestEnabled;this.PermSaveToDB=(b.getRTCObj().GetConst("3CD4F00A-A42D-4CD0-B05F-5A5A8C45F295",false)!=0);this.HelpEnabled=(b.getRTCObj().GetConst("81048684-4515-4A09-872C-0D3FC2817664",this.TraceEnabled)!=0);this.HelpAutoSendMail=(b.getRTCObj().GetConst("A4FDFFD5-6590-40E0-B469-4B54ED031ADA",false)!=0);this.HelpSMTPServer=b.getRTCObj().GetConst("45949632-FE35-43E5-9E86-1200433A037A","");this.HelpSMTPUsername=b.getRTCObj().GetConst("8FADF024-10DB-40fa-90A4-3851B2960E86","");this.HelpSMTPPassword=b.getRTCObj().GetConst("FDFF0513-6FD7-49d1-8F45-9F1AB86D5291","");this.HelpAddress=b.getRTCObj().GetConst("769E5A70-9153-4075-8A74-91BF4E76E277","");this.HelpSubject=b.getRTCObj().GetConst("BBF7F8EF-C0E3-4C4C-9F40-F888A2018706","");this.HelpName=b.getRTCObj().GetConst("D2C579BC-9E31-4A77-B2AC-9D46310D9B58","");this.HelpDescription=b.getRTCObj().GetConst("1F9CB062-5F43-47E8-BA4A-BE84DB22BD99","");this.HelpRecallTo=b.getRTCObj().GetConst("7A90FA60-E29F-42B3-A206-C66BA869F095","");this.HelpReplyTo=b.getRTCObj().GetConst("92E2D505-5147-473E-B454-3E6B6337FBFC","");this.LastSentTime=new Date(0);this.LastSentReqID=-1};DTTEngine.prototype.InitDB=function(a,b){this.DB=a;this.DBClass=b;this.PrepareSQLcommands()};DTTEngine.prototype.Render=function(b,c,g){var a=null;var d=0;if(c.equals("")){b.WriteStrDbgMain("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgMain("<meta http-equiv='X-UA-Compatible' content='IE=EmulateIE7' />");b.WriteStrDbgMain("<title>Debug Window</title>");b.WriteStrDbgMain("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgMain("<script src='dttRD4.js' type='text/javascript'><\/script></head>");b.WriteStrDbgMain("<script>");b.WriteStrDbgMain(b.UrlForDTT(Glb.ITEM_DTT,"Req","","","ItemList")+";");b.WriteStrDbgMain(b.UrlForDTT(Glb.ITEM_DTT,"Cmd","","","CmdForm")+";");b.WriteStrDbgMain("<\/script>");b.WriteStrDbgMain("<frameset cols='"+(this.IsTouch()?"220px":"20%")+", *'>");if(this.RefDTTObj==null){b.WriteStrDbgMain("<frameset rows='*, 80' >")}b.WriteStrDbgMain("<frame name='ItemList' src='' noresize>");if(this.RefDTTObj==null){b.WriteStrDbgMain("<frame name='CmdForm' noresize scrolling=no src='' ></frameset>")}b.WriteStrDbgMain("<frame name='Detail' src=''>");b.WriteStrDbgMain("</frameset></html>")}else{if(c.equals("FORM")){try{if(g.GetAttribute("par1")=="FLTMSG"){this.ShowMsgLevel=new IDVariant(g.GetAttribute("par2")).intValue()}if(g.GetAttribute("par1")=="FLTIT"){this.ShowLevel=new IDVariant(g.GetAttribute("par2")).intValue()}}catch(h){}b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(this.ShowRequest);if(f!=null){f.RenderCaption(b,true,(this.RefDTTObj!=null))}}else{if(c.equals("RECUR")){this.ShowRecurr=!this.ShowRecurr;b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(this.ShowRequest);if(f!=null){f.RenderCaption(b,true,(this.RefDTTObj!=null))}}else{if(c.equals("Req")){this.RenderRequest(b)}else{if(c.equals("Cmd")){this.RenderCmdForm(b)}else{if(c.equals("CMDFRM")){this.LastCmdRes=this.ParseCommand(g.GetAttribute("par2"),b);this.RenderCmdForm(b)}else{if(c.equals("TIMER")){this.ShowTime=!this.ShowTime;this.RenderRequest(b)}else{if(c.equals("START")||c.equals("STOP")){this.DTTStarted=!this.DTTStarted;this.RenderRequest(b)}else{if(c.equals("PSHOW")){this.ProcShowed=!this.ProcShowed;this.RenderRequest(b)}else{if(c.length>3&&(c.substr(0,3).equals("COL")||c.substr(0,3).equals("VIS"))){this.ProcCommand(c,b);this.Render(b,"REQPRC"+c.substr(39));return}if(c.length>3&&c.substr(0,3).equals("RES")){this.ResetProcs(b);this.Render(b,"REQPRC"+c.substr(6));return}if(c.length>5&&(c.substr(0,5).equals("EXPIT")||c.substr(0,5).equals("CMPIT"))){d=c.indexOf("REF");if(d>=0){this.ShowRequest=c.substr(d+3);var f=this.RefDTTObj.GetRequest(this.ShowRequest);if(f!=null){f.ExpandItem(c.substr(5),c.substr(0,5).equals("EXPIT"),false)}}this.Render(b,"REF"+this.ShowRequest);return}if(c.length>3&&c.substr(0,3).equals("REQ")){this.ShowRequest=c.substr(6);if(c.length>6&&c.substr(3,3).equals("TOP")){b.WriteStrDbgReqTop("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqTop("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqTop("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(c.substr(6));if(f!=null){f.RenderCaption(b,false,(this.RefDTTObj!=null))}}else{if(c.length>6&&c.substr(3,3).equals("REF")){if(this.RefDTTObj!=null){a=this.RefDTTObj.GetRequest(c.substr(6))}else{a=null}b.WriteStrDbgReqRef("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqRef("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqRef("<script src='dttRD4.js' type='text/javascript'><\/script>");if(this.RefDTTObj!=null){b.WriteStrDbgReqRef("<script language='javascript' type='text/javascript'>");b.WriteStrDbgReqRef("function onBodyScroll() {");b.WriteStrDbgDetail(" try {");b.WriteStrDbgReqRef("  parent.ReqChk.document.body.scrollTop = parent.ReqRef.document.body.scrollTop;");b.WriteStrDbgReqRef("  parent.ReqChk.document.body.scrollLeft = parent.ReqRef.document.body.scrollLeft;");b.WriteStrDbgReqRef(" } catch (e) {}");b.WriteStrDbgReqRef("}");b.WriteStrDbgReqRef("<\/script>")}b.WriteStrDbgReqRef("</head>");var f=this.GetRequest(c.substr(6));if(f!=null){f.Render(b,this.ShowTime,"",a)}}else{if(c.length>6&&c.substr(3,3).equals("CHK")){a=this.GetRequest(c.substr(6));b.WriteStrDbgReqRef("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqRef("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqRef("<script src='dttRD4.js' type='text/javascript'><\/script>");b.WriteStrDbgReqRef("<script language='javascript' type='text/javascript'>");b.WriteStrDbgReqRef("function onBodyScroll() {");b.WriteStrDbgReqRef(" try {");b.WriteStrDbgReqRef("  parent.ReqRef.document.body.scrollTop = parent.ReqChk.document.body.scrollTop;");b.WriteStrDbgReqRef("  parent.ReqRef.document.body.scrollLeft = parent.ReqChk.document.body.scrollLeft;");b.WriteStrDbgReqRef(" } catch (e) {}");b.WriteStrDbgReqRef("}");b.WriteStrDbgReqRef("<\/script>");b.WriteStrDbgReqRef("</head>");var f=this.RefDTTObj.GetRequest(c.substr(6));if(f!=null){f.Render(b,this.ShowTime,"chk",a)}}else{if(c.length>6&&c.substr(3,3).equals("PRC")){b.WriteStrDbgReqPrc("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgReqPrc("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgReqPrc("<script src='dttRD4.js' type='text/javascript'><\/script>");var f=this.GetRequest(c.substr(6));if(f!=null){f.RenderProcs(b,this.Procs)}}}}}}else{if(c.length>6&&c.substr(0,6).equals("ROTATE")){this.flTestHorizontal=!this.flTestHorizontal;this.Render(b,c.substr(6))}else{b.WriteStrDbgDetail("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgDetail("<link rel=stylesheet type='text/css' href='dtt.css'>");b.WriteStrDbgDetail("<script src='dttRD4.js' type='text/javascript'><\/script>");b.WriteStrDbgDetail("<script>");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQTOP"+c,"","","ReqTop")+";");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQREF"+c,"","","ReqRef")+";");b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQPRC"+c,"","","ReqPrc")+";");if(this.RefDTTObj!=null){b.WriteStrDbgDetail(b.UrlForDTT(Glb.ITEM_DTT,"REQCHK"+c,"","","ReqChk")+";")}b.WriteStrDbgDetail("<\/script>");b.WriteStrDbgDetail("<frameset rows='25, *"+(this.ProcShowed?", "+this.GetRequest(c).ProcSize(this.Procs):"")+"' >");b.WriteStrDbgDetail("<frame name='ReqTop' frameborder=0 noresize scrolling=no src='' >");if(this.RefDTTObj!=null){b.WriteStrDbgDetail("<frameset "+(this.flTestHorizontal?"rows":"cols")+"='50%, 50%'>")}b.WriteStrDbgDetail("<frame name='ReqRef' src='' >");if(this.RefDTTObj!=null){b.WriteStrDbgDetail("<frame name='ReqChk' src='' >");b.WriteStrDbgDetail("</frameset>")}if(this.ProcShowed){b.WriteStrDbgDetail("<frame name='ReqPrc' frameborder=1 src='' >")}b.WriteStrDbgDetail("</frameset></html>")}}}}}}}}}}}};DTTEngine.prototype.RenderRequest=function(b){b.WriteStrDbgItemList("<html><head>");b.WriteStrDbgItemList("<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");b.WriteStrDbgItemList("<link rel=stylesheet type='text/css' href='dtt.css'></head>");b.WriteStrDbgItemList("<script language='javascript' src='dttRD4.js'><\/script>");b.WriteStrDbgItemList("<script language='javascript' type='text/javascript'>");b.WriteStrDbgItemList("var ReqsNum="+this.AttID+";\n");b.WriteStrDbgItemList("<\/script>");b.WriteStrDbgItemList("<body style='overflow:hidden;'>");b.WriteStrDbgItemList("<table class='SesHdr'><tr><td>Session</td><td>");b.WriteStrDbgItemList("<a href='javascript:showprof()'><img title='Show profile data' src='dttimg/timer.gif'></a>&nbsp;");if(this.DTTStarted){b.WriteStrDbgItemList("<a  href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"STOP")+"'><img title='DTT is enabled. Click to stop collecting debug data' src='dttimg/tstart.gif'></a>")}else{b.WriteStrDbgItemList("<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"START")+"'><img title='DTT is disabled. Click to start collecting debug data' src='dttimg/tstop.gif'></a>")}b.WriteStrDbgItemList("&nbsp;<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"PSHOW")+" gf(window.parent.frames,\"Detail\").resendLastEvent(\"Detail\");'><img title='Open/close method window' src='dttimg/tstmt.gif'></a>");b.WriteStrDbgItemList("</td></tr></table>");if(this.Requests.Count()==0){b.WriteStrDbgItemList("<br><center>(No requests available)</center>")}else{b.WriteStrDbgItemList("<div style='overflow-y:scroll; width:100%; height:98%'>");b.WriteStrDbgItemList("<table class='ReqList'>");for(var a=0;a<this.Requests.length;a++){var c=this.Requests[a];b.WriteStrDbgItemList("<tr><td>");b.WriteStrDbgItemList("<img src='dttimg/"+c.GetIcon()+"'></td><td>");b.WriteStrDbgItemList("<a title='"+Glb.HTMLEncode(c.Description)+"' href='javascript:showreq(\""+c.ID+"\")'>");b.WriteStrDbgItemList("<span id='R"+c.ID+"'");if(c.Matches==DTTRequest.REQ_DIFFERS){b.WriteStrDbgItemList(" style='background-color:yellow'")}else{if(c.Matches==DTTRequest.REQ_MISSING){b.WriteStrDbgItemList(" style='background-color:#FF8080'")}else{if(c.HasBP(b)){b.WriteStrDbgItemList(" style='background-color:lightgreen'")}}}b.WriteStrDbgItemList(">"+Glb.HTMLEncode(c.Name,false,true)+"</span>");if(this.ShowTime){b.WriteStrDbgItemList(" ("+c.ElapsedTime+" ms)")}b.WriteStrDbgItemList("</a></td></tr>")}b.WriteStrDbgItemList("</table>");b.WriteStrDbgItemList("</div>")}b.WriteStrDbgItemList("</body></html>")};DTTEngine.prototype.RenderCmdForm=function(a){a.WriteStrDbgCmdForm("<html><head>");a.WriteStrDbgCmdForm("<meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");a.WriteStrDbgCmdForm("<link rel=stylesheet type='text/css' href='dtt.css'></head>");a.WriteStrDbgCmdForm("<script src='dttRD4.js' type='text/javascript'><\/script>");a.WriteStrDbgCmdForm("<body class='CmdFrm' onload='document.getElementById('CMD').focus()'>");a.WriteStrDbgCmdForm("Command: (HM #, SM, AB g, RB, SS n)<br>");a.WriteStrDbgCmdForm("<input type='text' class='CmdEdit' id='CMD' name='CMD' style='width:100%'");a.WriteStrDbgCmdForm(' ondrop=\'gf(window.parent.frames,"Detail").resendLastEvent("Detail");gf(window.parent.frames,"ItemList").resendLastEvent("ItemList");\'');a.WriteStrDbgCmdForm("onkeypress='if (event.keyCode == 13) {"+a.UrlForDTT(Glb.ITEM_DTT,"CMDFRM","CMD","this.value","",false)+'; gf(window.parent.parent.frames,"Detail").resendLastEvent("Detail");gf(window.parent.frames,"ItemList").resendLastEvent("ItemList");}\'');a.WriteStrDbgCmdForm("><br>");a.WriteStrDbgCmdForm(this.LastCmdRes);a.WriteStrDbgCmdForm("</body></html>")};DTTEngine.prototype.GetRequest=function(a){try{var f=parseInt(a,10);for(var b=0;b<this.Requests.length;b++){var c=this.Requests[b];if(c.ID==f){return c}}}catch(d){WriteToConsoleError(d)}return null};DTTEngine.prototype.GetTicks=function(){if(this.AttRequest==null){return -1}else{return this.GetTickCount()-this.AttRequest.StartTicks-this.ProfileTicks}};DTTEngine.prototype.MaskDebugItems=function(a){if(!this.ItemCollect){return true}if(this.MaskGuid==null){this.MaskGuid=""}if(this.MaskGuid.equals(a)&&this.MaskIndLevel-1==this.CurrentIndLevel){this.MaskGuid="";this.MaskIndLevel=-1;return false}if(this.MaskIndLevel!=-1&&this.CurrentIndLevel>=this.MaskIndLevel){return true}return false};DTTEngine.prototype.Add=function(a,b,c){this.AddItem(c,DTTEngine.IT_USER,"",b,"",a)};DTTEngine.prototype.AddMsg=function(f,d,e,c,a,b){if(b==undefined){b=""}if(!this.ItemCollect){return}if(f<=this.MsgLevel){this.AddItem(f,DTTEngine.IT_MESSAGE,d,e,c,a,this.AdaptVariant(b))}else{this.AttItem=null}};DTTEngine.prototype.AddMsgToken=function(a,e,g){if(g==undefined){g=new IDVariant("")}if(!this.MaskDebugItems(a)&&(this.AttRequest!=null)){var c=null;var f=this.AttRequest.Items.length;for(var b=0;b<f;b++){c=this.AttRequest.Items[b];if(c.ItemType==DTTEngine.IT_MESSAGE){break}}if(c!=null){var d=new DTTItem();d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_MESSAGE_TK;d.MsgType=0;d.ObjGuid=(a==null?"":a);d.ObjName=(e==null?"":e);d.ObjType=0;d.ObjValue=this.AdaptVariant(g);if(c.SubItem==null){c.SubItem=new ArrayList()}c.SubItem.Add(d)}}else{AttItem=null}};DTTEngine.prototype.AddTraceItem=function(a,d,e,b,c){if(c==undefined){c=new IDVariant("")}if(this.TraceEnabled){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_TRACE,ObjGuid,d,e,b,this.AdaptVariant(c));return true}else{this.AttItem=null;return false}};DTTEngine.prototype.AddTraceToken=function(a,j,b,d,e){if(!(d instanceof IDVariant)){d=new IDVariant(d)}if(this.TraceEnabled&&!this.MaskDebugItems(a)&&this.AttRequest!=null){var h=null;var f=this.AttRequest.Items.length;for(var g=0;g<f;g++){h=this.AttRequest.Items[g];if(h.ItemType==DTTEngine.IT_TRACE){break}}if(h!=null){var c=new DTTItem();c.ItemType=DTTEngine.IT_TOKEN;c.IndLevel=this.CurrentIndLevel;c.MsgType=0;c.ObjGuid=a;c.ObjType=j;c.ObjName=b;c.ObjValue=this.AdaptVariant(d);c.ObjDescription=e;if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddTestItem=function(e,c,d,a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)=="number"){b=new IDVariant(b)}if(this.TestEnabled){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_TEST,e,c,d,a,b);return true}else{this.AttItem=null;return false}};DTTEngine.prototype.AddHelpItem=function(a,g,b,e,f){var d;var c;if(this.TestEnabled&&this.HelpGenerationActive&&this.AttRequest!=null){d=this.AttRequest.Items[0];c=new DTTHelpItem();if(a!=0){c.x=a}if(g!=0){c.y=g}if(b!=0){c.w=b}if(e!=0){c.h=e}c.Text=f;d.HelpItem=c}};DTTEngine.prototype.AddItem=function(g,f,d,e,c,a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)=="number"){b=new IDVariant(b)}if(this.AttRequest==null){return}if(!this.ItemCollect){return}if(c.length>255){c=c.substr(0,252)+"..."}if(a.length>255){a=a.substr(0,252)+"..."}this.AttItem=new DTTItem();this.AttItem.Visible=this.ItemVisible;this.AttItem.IndLevel=this.CurrentIndLevel;this.AttItem.MsgType=g;this.AttItem.ItemType=f;this.AttItem.ObjGuid=(d==null?"":d);this.AttItem.ObjType=e;this.AttItem.ObjName=(c==null?"":c);this.AttItem.ObjDescription=(a==null?"":a);this.AttItem.ObjValue=this.AdaptVariant(b);this.AttItem.TickCount=this.GetTicks();this.AttRequest.Add(this.AttItem)};DTTEngine.prototype.AddRequest=function(a){this.MainFrm=a;this.LoadProcs(a);if(this.Level==DTTEngine.LEV_NONE){return}if(!this.Enabled){return}this.AttID++;this.AttRequest=new DTTRequest();this.AttRequest.InitRequest(this.AttID);if(this.HelpGenerationActive){this.CreateNewHelpItem()}this.CurrentIndLevel=1;this.MaskGuid="";this.MaskIndLevel=-1;this.ItemVisible=true;this.LevelVisible=0;this.ItemCollect=this.DTTStarted;this.LevelCollect=(this.DTTStarted?0:-1);this.Requests.Add(this.AttRequest);this.AttItem=null};DTTEngine.prototype.CreateNewHelpItem=function(){if(this.AttRequest!=null){if(this.AttRequest.HelpItem==null){AttRequest.HelpItem=new DTTHelpItem();AttRequest.HelpItem.x=800;AttRequest.HelpItem.y=20;AttRequest.HelpItem.Delay=0;AttRequest.HelpVerItem=new DTTHelpItem();AttRequest.HelpVerItem.x=800;AttRequest.HelpVerItem.y=20;AttRequest.HelpVerItem.Delay=60}}};DTTEngine.prototype.CancelRequest=function(){if(this.AttRequest==null||!this.Enabled){this.MainFrm=null;return}if(this.Requests.Count()>0){this.Requests.RemoveAt(this.Requests.Count()-1)}this.AttID--;this.AttRequest=null;this.MainFrm=null};DTTEngine.prototype.EndRequest=function(g){if(g==undefined){g=true}var h=null;var f=null;if(this.AttRequest==null||!this.Enabled){if(g){this.MainFrm=null}return}this.AttRequest.EndRequest();if(this.HelpGenerationActive&&this.Requests.Count()>1){h=this.Requests[Requests.Count()-2];if(h.HelpVerItem!=null){if(h.HelpVerItem.Text.equals("")){var j="";var a=0;var e;var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){f=this.AttRequest.Items[b];if(f.ItemType==DTTEngine.IT_TEST&&f.ObjType!=DTTEngine.TST_TERM){a++}}e=1;for(var b=0;b<d;b++){f=this.AttRequest.Items[b];if(f.ItemType==DTTEngine.IT_TEST&&f.ObjType!=DTTEngine.TST_TERM){if(a>1){if(e>1){j=j+"<br>\r\n"}j=j+e+") ";e++}j=j+f.HelpItem.Text}}h.HelpVerItem.Text=j}}}if(this.AttRequest.Items.Count()==0&&this.DTTStarted&&this.AttRequest.NamePriority<DTTRequest.PRI_CMD){if(this.Requests.Count()>0){this.Requests.RemoveAt(Requests.Count()-1)}if(g){this.MainFrm=null}return}if(this.DTT2File){}if(this.TraceEnabled||this.TestEnabled){this.CompactRequests()}if(this.HelpAutoSendMail){var c=false;var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){f=this.AttRequest.Items[b];if(f.ItemType==DTTEngine.IT_LOOPDET||f.ItemType==DTTEngine.IT_EXCEPTION||f.ItemType==DTTEngine.IT_ERROR){c=true;break}}if(c){this.HelpSubject="Error occurred in application "+thisMainFrm.Caption();thisSendHelpMail(true)}}if(g){this.MainFrm=null}this.AttRequest=null};DTTEngine.prototype.SetRequestName=function(a,c,b){if(this.AttRequest!=null){this.AttRequest.SetName(a,c,b)}};DTTEngine.prototype.ShowReqErrors=function(){if(this.AttRequest==null){return}if(this.AttRequest.State==DTTEngine.DTTMSG_ERROR){var a=this.MainFrm;var b=false;if(a.UseRD&&a.ParamsObj().UseRD3&&a.ParamsObj().EnableRichTooltip){b=true}else{if(a.AlertMessage().stringValue().length==0){if(a.UseRD&&a.ParamsObj().UseRD3){b=true}else{if(a.UseRD&&!a.ParamsObj().UseRD3&&a.RDStatus==Glb.RD_ACTIVE){b=true}else{if(!a.UseRD){b=true}}}}}if(b){var c="Unexpected error occurred in the last request.\nOpen the debug window for details";if(a.UseRD&&a.ParamsObj().UseRD3&&a.ParamsObj().EnableRichTooltip){if(a.IsMobile()){a.ShowTooltip(c,a.Caption().stringValue(),"",-1,48,2,(this.Requests.Count>=3?0:500),10000,false,-1,-1,"error",false)}else{a.ShowTooltip(c,a.Caption().stringValue(),"header-debug-image",-1,-1,2,(this.Requests.Count>=3?0:500),10000,false,-1,-1,"error",true)}a.SoundAction("play","error")}else{a.set_AlertMessage(new IDVariant(c))}}}};DTTEngine.prototype.EnterProc=function(a,c,d,e,b){if(this.AttRequest!=null){if(!this.AttRequest.EnterProc(a,this)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_LOOPDET,a,e,c,"Stack loop",this.MaxStackLoops);return false}if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERPROC,a,e,c,d,b);var f=this.Procs[a];if(f!=null){if(this.ItemVisible&&!f.Visible){this.ItemVisible=false;this.LevelVisible=this.CurrentIndLevel}if(this.ItemCollect&&!f.Collect){this.ItemCollect=false;this.LevelCollect=this.CurrentIndLevel}}}else{this.AttItem=null}}this.CurrentIndLevel++;return true};DTTEngine.prototype.ExitProc=function(b,d,a,h,g){if(this.AttRequest!=null){var f=new Date().getTime();this.AttRequest.ExitProc(b);var e;var j=this.AttRequest.Items.Count();for(var c=0;c<j;c++){e=this.AttRequest.Items[c];if(e.ObjGuid.equals(b)&&e.ItemType==DTTEngine.IT_ENTERPROC&&this.CurrentIndLevel-1>=e.IndLevel){this.CurrentIndLevel=e.IndLevel;break}}if(!this.ItemVisible&&this.CurrentIndLevel<=this.LevelVisible){this.ItemVisible=true}if(!this.ItemCollect&&this.CurrentIndLevel<=this.LevelCollect){this.ItemCollect=true}if(!this.MaskDebugItems(b)){this.ProfileTicks=new Date().getTime()-f;this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_EXITPROC,b,h,d,a,g)}else{this.AttItem=null}}else{this.AttItem=null}this.ProfileTicks=0};DTTEngine.prototype.AddException=function(a,d,h,g,c){if(c==undefined){c=false}if(this.MaskDebugItems(a)){this.MaskGuid="";this.MaskIndLevel=-1}this.AddItem((c?DTTEngine.DTTMSG_WARN:DTTEngine.DTTMSG_ERROR),DTTEngine.IT_EXCEPTION,a,0,d,g.toString());if(g.stack){var f=g.stack.split("\n");for(var b=1;b<f.length;b++){this.AddParameter(this.Guid,"",b+"",f[b])}}};DTTEngine.prototype.AddBreak=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_BREAK,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.AddContinue=function(b,a,e){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_CONTINUE,b,0,a,e)}else{this.AttItem=null}if(this.AttRequest!=null){var d=null;for(var c=this.AttRequest.Items.Count()-1;c>=0;c--){d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&(d.ItemType==DTTEngine.IT_WHILE||d.ItemType==DTTEngine.IT_FOREACH||d.ItemType==DTTEngine.IT_FORI)&&this.CurrentIndLevel-1>=d.IndLevel){this.CurrentIndLevel=d.IndLevel+1;break}}}};DTTEngine.prototype.AddError=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_ERROR,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.AddForEach=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_FOREACH,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.AddIMDBDataSource=function(k,g){if(g==undefined){g=null}if(this.AttRequest!=null){var h=null;var j=this.AttRequest.Items.Count();for(var e=0;e<j;e++){h=this.AttRequest.Items[e];if(h.ItemType==DTTEngine.IT_QUERY||h.ItemType==DTTEngine.IT_FOREACH){break}}if(h!=null){if(!this.MaskDebugItems(h.ObjGuid)){var d=new DTTItem();var l="";var b=g;if(b==null){b=this.MainFrm.getIMDB()}d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_IMDBDATASRC;d.MsgType=DTTEngine.DTTMSG_INFO;d.RecordCount=b.TblNumRows(k);d.ObjType=b.TblNumField(k);d.SubItem=new ArrayList();var c=new DTTItem();l="";for(var f=0;f<b.TblNumField(k);f++){l+=(b.FldCode(k,f)+"§")}c.ObjValue=new IDVariant(l);d.SubItem.Add(c);b.TblMoveFirst(k,0);for(var a=1;a<=(b.TblNumRows(k)<this.MaxRecToDump?b.TblNumRows(k):this.MaxRecToDump);a++){c=new DTTItem();l="";for(var f=0;f<b.TblNumField(k);f++){l+=(b.Value(k,f,0)+"§")}c.ObjValue=new IDVariant(l);d.SubItem.Add(c);b.TblMoveNext(k,0)}b.TblMoveFirst(k,0);if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(d);if(d.RecordCount>1&&h.ObjType==DTTEngine.STMT_QRY_SELVAR){h.MsgType=DTTEngine.DTTMSG_WARN}}}}else{this.AttItem=null}};DTTEngine.prototype.AddDBDataSource=function(m,d){if(this.AttRequest!=null){var h=null;var k=this.AttRequest.Items.Count();for(var g=0;g<k;g++){h=this.AttRequest.Items[g];if(h.ItemType==DTTEngine.IT_QUERY||h.ItemType==DTTEngine.IT_FOREACH){break}}if(h!=null){if(h.ObjValue.stringValue().equals("")){h.ObjValue=new IDVariant(d)}if(!this.MaskDebugItems(h.ObjGuid)){try{var f=new DTTItem();var o;f.IndLevel=this.CurrentIndLevel;f.ItemType=DTTEngine.IT_DBDATASRC;f.MsgType=DTTEngine.DTTMSG_INFO;f.RecordCount=m.RecordCount();f.ObjType=m.GetNumFields();f.SubItem=new ArrayList();var c=new DTTItem();var l;o="";for(l=1;l<=m.GetNumFields();l++){o+=(m.GetName(l)+"§")}c.ObjValue=new IDVariant(o);f.SubItem.Add(c);if(m.RecordCount()>0){m.MoveFirst();for(var a=1;a<=(m.RecordCount()<this.MaxRecToDump?m.RecordCount():this.MaxRecToDump);a++){c=new DTTItem();o="";for(l=1;l<=m.GetNumFields();l++){var b=m.Get(l);if(b.Type==IDVariant.BLOB){o+="BLOB DATA§"}else{o+=(b.toString()+"§")}}c.ObjValue=new IDVariant(o);f.SubItem.Add(c);m.MoveNext()}m.MoveFirst()}if(h.SubItem==null){h.SubItem=new ArrayList()}h.SubItem.Add(f);if(f.RecordCount>1&&h.ObjType==DTTEngine.STMT_QRY_SELVAR){h.MsgType=DTTEngine.DTTMSG_WARN}}catch(j){}}}}else{this.AttItem=null}};DTTEngine.prototype.EndForEach=function(b,a,g,f){if(this.AttRequest!=null){var d=null;var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_FOREACH&&this.CurrentIndLevel-1>=d.IndLevel){this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDFOREACH,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddForI=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_FORI,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndForI=function(b,a,g,f){if(this.AttRequest!=null){var d=null;var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_FORI&&this.CurrentIndLevel-1>=d.IndLevel){this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDFORI,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.CheckLoop=function(a,e){if(this.AttRequest==null){return true}if(this.LoggedLoops>0&&e>this.LoggedLoops&&(this.MaskIndLevel==-1||this.CurrentIndLevel<this.MaskIndLevel)){this.MaskGuid=a;this.MaskIndLevel=this.CurrentIndLevel}if(this.MaxLoopCycles>0&&e>this.MaxLoopCycles){var c=null;var f="";var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){c=this.AttRequest.Items[b];if(c.IndLevel==this.CurrentIndLevel-1&&c.ObjGuid.equals(a)&&(c.ItemType==DTTEngine.IT_ENDFOREACH||c.ItemType==DTTEngine.IT_ENDWHILE||c.ItemType==DTTEngine.IT_ENDFORI)&&(this.MaskIndLevel==-1||this.CurrentIndLevel<this.MaskIndLevel)){f="STRANO ERRORE"}if(c.IndLevel==this.CurrentIndLevel-1&&c.ObjGuid.equals(a)&&(c.ItemType==DTTEngine.IT_FOREACH||c.ItemType==DTTEngine.IT_WHILE||c.ItemType==DTTEngine.IT_FORI)){this.AddItem(DTTEngine.DTTMSG_ERROR,DTTEngine.IT_LOOPDET,a,0,"",f,e-1);return false}}}if(this.MaskGuid!=a&&e>1){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_MESSAGE,a,199,"Iteration step","-------- End Iteration "+(e-1)+" --------")}return true};DTTEngine.prototype.AddIf=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_IF,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.EnterIf=function(b,a,c){this.CurrentIndLevel++;if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERIF,b,0,a,c)}else{this.AttItem=null}};DTTEngine.prototype.EnterElse=function(b,a,d,c){this.CurrentIndLevel++;if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERELSE,b,0,a,d)}else{this.AttItem=null}};DTTEngine.prototype.EndIfBlk=function(a){if(this.AttRequest!=null){var c=null;var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_IF&&this.CurrentIndLevel>=c.IndLevel){this.CurrentIndLevel=c.IndLevel;break}}if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDIF,a,0,"","")}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddSwitch=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_SWITCH,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EnterSwitch=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENTERSWITCH,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndSwitchBlk=function(a){if(this.AttRequest!=null){var c=null;var d=this.AttRequest.Items.Count();for(var b=0;b<d;b++){c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_SWITCH&&this.CurrentIndLevel>=c.IndLevel){this.CurrentIndLevel=c.IndLevel;break}}if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDSWITCH,a,0,"","")}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddReturn=function(b,a,d,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_RETURN,b,0,a,d,this.AdaptVariant(c))}else{this.AttItem=null}};DTTEngine.prototype.AddWhile=function(b,a,c){if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_WHILE,b,0,a,c)}else{this.AttItem=null}this.CurrentIndLevel++};DTTEngine.prototype.EndWhile=function(b,a,g,f){if(this.AttRequest!=null){var d=null;var e=this.AttRequest.Items.Count();for(var c=0;c<e;c++){d=this.AttRequest.Items[c];if(d.ObjGuid.equals(b)&&d.ItemType==DTTEngine.IT_WHILE&&this.CurrentIndLevel-1>=d.IndLevel){this.CurrentIndLevel=d.IndLevel;break}}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ENDWHILE,b,0,a,g,f)}else{this.AttItem=null}}else{this.AttItem=null}};DTTEngine.prototype.AddToken=function(h,a,j,b,d){if(typeof(d)!="object"){d=new IDVariant(d)}if(!this.MaskDebugItems(h)&&this.AttRequest!=null){var f=this.AttItem;if(h!=null&&!h.equals("")){var g=this.AttRequest.Items.Count();for(var e=0;e<g;e++){f=this.AttRequest.Items[e];if(f.ObjGuid.equals(h)){break}}}if(f!=null){var c=new DTTItem();c.ItemType=DTTEngine.IT_TOKEN;c.IndLevel=this.CurrentIndLevel;c.MsgType=DTTEngine.DTTMSG_INFO;c.ObjGuid=(a==null?"":a);c.ObjName=b;c.ObjType=j;c.ObjValue=this.AdaptVariant(d);if(f.SubItem==null){f.SubItem=new ArrayList()}f.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddQuery=function(b,a,d,c,e){if(!this.MaskDebugItems(b)){e=e.Replace("\r\n","");this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_QUERY,b,c,a,d,e)}else{this.AttItem=null}};DTTEngine.prototype.EndQuery=function(a){if(!this.MaskDebugItems(a)&&this.AttRequest!=null){var f=null;var g=this.AttRequest.Items.Count();for(var b=0;b<g;b++){f=this.AttRequest.Items[b];if(f.ObjGuid.equals(a)&&(f.ItemType==DTTEngine.IT_QUERY||f.ItemType==DTTEngine.IT_FOREACH)){break}}var h=0;if(f.ItemType==DTTEngine.IT_QUERY){switch(f.ObjType){case DTTEngine.STMT_QRY_DELETE:h=2000;break;case DTTEngine.STMT_QRY_UPDATE:h=2000;break;case DTTEngine.STMT_QRY_INSVAL:h=400;break;case DTTEngine.STMT_QRY_INSSEL:h=4000;break;case DTTEngine.STMT_QRY_SELVAR:h=400;break;case DTTEngine.STMT_QRY_SELECT:h=4000;break;case DTTEngine.STMT_QRY_SELCOL:h=4000;break}}else{h=4000}var e=null;g=this.AttRequest.Items.Count();for(var b=0;b<g;b++){e=this.AttRequest.Items[b];if(e.ItemType==DTTEngine.IT_ENDFOREACH||e.ItemType==DTTEngine.IT_ENDWHILE){break}if(e.ItemType==DTTEngine.IT_FOREACH||e.ItemType==DTTEngine.IT_WHILE){h/=4;break}}var d=this.GetTicks()-f.TickCount;if(d>h){var c=new DTTItem();c.IndLevel=this.CurrentIndLevel;c.ItemType=DTTEngine.IT_ENDQUERY;c.MsgType=DTTEngine.DTTMSG_WARN;c.ObjDescription="The query took too much: "+d+" ms";c.ObjValue=new IDVariant(d);f.MsgType=DTTEngine.DTTMSG_WARN;if(f.SubItem==null){f.SubItem=new ArrayList()}f.SubItem.Add(c)}}else{this.AttItem=null}};DTTEngine.prototype.AddSubProc=function(a,b,c){if(!this.MaskDebugItems(a)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_SUBPROC,a,0,b,c)}else{this.AttItem=null}};DTTEngine.prototype.AddParameter=function(f,b,d,e){if(e==undefined){e=new IDVariant(e)}if(!this.MaskDebugItems(f)&&this.AttRequest!=null){var g=this.AttItem;if(f!=null&&!f.equals("")){var h=this.AttRequest.Items.Count();for(var c=0;c<h;c++){g=this.AttRequest.Items[c];if(g.ObjGuid.equals(f)){break}}}if(g!=null){var a=new DTTItem();a.IndLevel=this.CurrentIndLevel;a.ItemType=DTTEngine.IT_PARAMETER;a.MsgType=DTTEngine.DTTMSG_INFO;a.ObjGuid=(b==null?"":b);a.ObjName=d;a.ObjType=0;a.ObjValue=this.AdaptVariant(e);if(g.SubItem==null){g.SubItem=new ArrayList()}g.SubItem.Add(a)}}else{this.AttItem=null}};DTTEngine.prototype.AddAssign=function(b,a,d,c){if(typeof(c)!="object"){c=new IDVariant(c)}if(!this.MaskDebugItems(b)){this.AddItem(DTTEngine.DTTMSG_INFO,DTTEngine.IT_ASSIGN,b,0,a,d,c)}else{this.AttItem=null}};DTTEngine.prototype.AddAssignNewValue=function(a,e,g){if(!this.MaskDebugItems(a)&&this.AttRequest!=null){var c=null;var f=this.AttRequest.Items.Count();for(var b=0;b<f;b++){c=this.AttRequest.Items[b];if(c.ObjGuid.equals(a)&&c.ItemType==DTTEngine.IT_ASSIGN){break}}if(c!=null){var d=new DTTItem();d.IndLevel=this.CurrentIndLevel;d.ItemType=DTTEngine.IT_PARAMETER;d.MsgType=0;d.ObjGuid=(e==null?"":e);d.ObjValue=this.AdaptVariant(g);if(c.SubItem==null){c.SubItem=new ArrayList()}c.SubItem.Add(d)}}else{this.AttItem=null}};DTTEngine.prototype.AdaptVariant=function(b){if(b==null){return new IDVariant("Null")}if(b instanceof IDVariant){if(b.Type==IDVariant.NULL){return new IDVariant("Null")}if(b.Type==IDVariant.BLOB){return new IDVariant("BLOB")}return new IDVariant(b)}if(b instanceof IDDocument){return new IDVariant(b.GetClass().GetClassName())}if(b instanceof Object&&b.toString){return new IDVariant(b.toString())}if(b instanceof Object&&b.constructor&&b.constructor.toString){var a=b.constructor.toString().match(/function\s*(\w+)/);if(a&&a.length==2){return new IDVariant(a[1])}}return new IDVariant(b+"")};DTTEngine.prototype.ParseCommand=function(k,m){var b;var d="";var j="";b=k.indexOf(" ");if(b==-1){d=k}else{d=k.substr(0,b).trim();j=k.substr(b+1).trim()}d=d.toUpperCase();var a=j;j=j.toUpperCase();if(d.equals("SM")){this.HiddenMessages.Clear();return"All messages shown"}else{if(d.equals("RB")){var q;if(j.equals("")){this.BreakPoints.Clear();q="All breakpoints removed"}else{q="Breakpoint "+j+" not found";for(var o=0;o<this.BreakPoints.length;o++){if(this.BreakPoints[o].equals(j)){this.BreakPoints.RemoveAt(o);q="Breakpoint "+j+" removed";break}}}for(var g=0;g<this.Requests.length;g++){var l=this.Requests[g];l.HasBP(m,true)}return q}else{if(d.equals("AB")){if(j.equals("")){return"Invalid breakpoint"}else{if(this.BreakPoints.Count()>7){return"Too many breakpoints (max 8)"}else{for(var o=0;o<this.BreakPoints.length;o++){if(this.BreakPoints[o].equals(j)){return""}}this.BreakPoints.Add(j);for(var g=0;g<this.Requests.length;g++){var l=this.Requests[g];l.HasBP(m,true)}return"Breakpoint "+j+" added"}}}else{if(d.equals("HM")){try{var f=parseInt(j,10);if(f>0&&f<1000){this.HiddenMessages.Add(f);return"message #"+j+" hidden"}else{return"Invalid message number"}}catch(h){return"Invalid message number"}}else{if(d.equals("SS")){if(!a.equals(m.Request.SESSNAME)){return"<SCRIPT>sendToApplication('IWDTT', '', '', '' , null, '"+a+"');</SCRIPT>"}else{return"Session debug already open"}}else{return k+" not recognized"}}}}}};DTTEngine.prototype.IsMsgHidden=function(b){for(var a=0;a<this.HiddenMessages.length;a++){if(this.HiddenMessages[a]==b){return true}}return false};DTTEngine.prototype.HideMessage=function(b){for(var a=0;a<this.HiddenMessages.length;a++){if(this.HiddenMessages[a]==b){return}}this.HiddenMessages.Add(b)};DTTEngine.prototype.CompactRequests=function(){if(this.Requests.Count()>this.RequestsToPassive){var d;var b=null;var c=null;for(var a=0;a<this.Requests.length;a++){d=this.Requests[a];if(b==null&&d.Condition==DTTRequest.REQ_ACTIVE){b=d;if(Requests.Count()<=this.RequestsToPerm){break}}if(c==null&&Requests.Count()>thisRequestsToPerm&&d.Condition==DTTRequest.REQ_PASSIVE){c=d}}if(b!=null){this.MoveReqToPassive(b)}if(c!=null){this.MoveReqToPermanent(c)}}};DTTEngine.prototype.MoveReqToPassive=function(c){var e;c.Condition=DTTRequest.REQ_PASSIVE;var b=new ArrayList();var a;var d=c.Items.length;for(itemi=0;itemi<d;itemi++){a=c.Items[itemi];e=false;if(a.ItemType==DTTEngine.IT_MESSAGE){e=(a.MsgType>this.PassiveMsgLevel)}else{if(a.ItemType==DTTEngine.IT_TRACE){e=!this.PassiveTraceEnabled}else{e=(a.Level()>this.PassiveLevel)}}if(!this.ItemToBeDeleted){b.Add(a)}}c.Items=b};DTTEngine.prototype.MoveReqToPermanent=function(b){this.Requests.Remove(b);if(this.DB!=null&&this.Enabled&&this.PermSaveToDB){try{this.MainFrm.OpenConnection(this.DB);this.DB.BeginTrans();this.CreateSession();b.SaveToDB(this);this.DB.CommitTrans()}catch(c){WriteToConsoleError(c);try{this.DB.RollbackTrans()}catch(a){}}}};DTTEngine.prototype.PrepareSQLcommands=function(){};DTTEngine.prototype.CreateSession=function(){if(this.SessionID==0){this.SQLSessInsert.ClearParameters();if(this.Requests.Count()==0){this.SQLSessInsert.AddParameter(IDL.Now())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Requests[0].StartTime))}if(this.Name.equals("")){this.SQLSessInsert.AddParameter(new IDVariant())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Name.length>50?this.Name.substr(0,50):this.Name))}this.SQLSessInsert.AddParameter(new IDVariant(this.UserID));if(this.Description.equals("")){this.SQLSessInsert.AddParameter(new IDVariant())}else{this.SQLSessInsert.AddParameter(new IDVariant(this.Description.length>250?this.Description.substr(0,250):this.Description))}var a=this.MainFrm;this.SQLSessInsert.AddParameter(new IDVariant(a.HostName.length>100?a.HostName.substr(0,100):a.HostName));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessInsert,false);var b=this.DB.ExecuteIDPS(this.SQLGetSessID,true);if(!b.EOF()){b.MoveFirst()}this.SessionID=b.Get(1).intValue()}};DTTEngine.prototype.SaveSession=function(a,g,h){var c="";var d="";var k;this.EndRequest(false);try{if(a||h){c=this.TakeSnapshot(a,h);if(h){d=c}}if(g){var b=this.Requests.length;for(var f=0;f<b;f++){k=this.Requests[f];if(k.Condition==DTTRequest.REQ_ACTIVE){this.MoveReqToPassive(k)}}if(!a){while(this.Requests.Count()>0){this.MoveReqToPermanent(this.Requests[0])}}else{this.Requests.Clear()}if(this.DB!=null&&this.SessionID!=0){var l=this.MainFrm;this.SQLSessUpdate.ClearParameters();this.SQLSessUpdate.AddParameter(IDL.Now());if(this.Name.length==0){this.SQLSessUpdate.AddParameter(new IDVariant("[Empty]"))}else{this.SQLSessUpdate.AddParameter(new IDVariant(this.Name.length>50?this.Name.substr(0,50):this.Name))}this.SQLSessUpdate.AddParameter(new IDVariant(this.UserID));if(this.Description.length==0){this.SQLSessUpdate.AddParameter(new IDVariant())}else{this.SQLSessUpdate.AddParameter(new IDVariant(this.Description.length>250?this.Description.substr(0,250):this.Description))}this.SQLSessUpdate.AddParameter(new IDVariant(l.HostName.length>100?l.HostName.substr(0,100):l.HostName));if(this.TestRunning){this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionTestSrcID))}else{this.SQLSessUpdate.AddParameter(new IDVariant())}this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionID));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessUpdate,false)}}}catch(j){WriteToConsoleError(j)}this.MainFrm=null;return d};DTTEngine.prototype.EndSession=function(a,b){if(b==undefined){b=true}this.MainFrm=a;if(this.RecordRunning||this.TestRunning){this.SaveSession(b,true,false);if(this.DB!=null&&this.TestRunning){this.UpdateFlags()}}if(this.TraceEnabled&&this.PermSaveToDB){while(this.Requests.Count()>0){var c=this.Requests[0];if(c.Condition==DTTRequest.REQ_ACTIVE){this.MoveReqToPassive(c)}this.MoveReqToPermanent(c)}if(this.DB!=null&&this.SessionID!=0){try{this.SQLSessUpdate.ClearParameters();this.SQLSessUpdate.AddParameter(IDL.Now());this.SQLSessUpdate.AddParameter(new IDVariant(this.Name.length==0?"[Empty]":(this.Name.length>50?this.Name.substr(0,50):Name)));this.SQLSessUpdate.AddParameter(new IDVariant(this.UserID));this.SQLSessUpdate.AddParameter(new IDVariant(this.Description.length==0?null:(this.Description.length>250?this.Description.substr(0,250):this.Description)));this.SQLSessUpdate.AddParameter(new IDVariant(a.HostName.length>100?a.HostName.substr(0,100):a.HostName));this.SQLSessUpdate.AddParameter(new IDVariant());this.SQLSessUpdate.AddParameter(new IDVariant(this.SessionID));this.MainFrm.OpenConnection(this.DB);this.DB.ExecuteIDPS(this.SQLSessUpdate,false)}catch(d){WriteToConsoleError("[DTTEngine::EndSession] Can't update the DTT Trace session (ID="+this.SessionID+"): "+d.message)}}}this.MainFrm=null;this.TestRunning=false};DTTEngine.prototype.UpdateFlags=function(){};DTTEngine.prototype.LoadFromDB=function(c,h,g){if(h==undefined){h=true}if(g==undefined){g=true}try{if(g){var d="select SessID, SessSnapshot from DTTSessions where SessID = "+c;var b=new IDPreparedStatement(true);b.SetCommand(this.SQL);this.MainFrm.OpenConnection(this.DB);var m=this.DB.ExecuteIDPS(b,true);if(!m.EOF()){m.MoveFirst()}var l=this.MainFrm;var a=Glb.SaveBlob(l,m.Get(2),new IDVariant(l.RealPath+"/temp")).stringValue();if(a.length>0){this.LoadSnapshot(a);this.SessionID=c;b.SetCommand("select SessName, SessDescr from DTTSessions where SessID = "+c);m=this.DB.ExecuteIDPS(b,true);if(!m.EOF()){m.MoveFirst()}this.Name=(m.Get(1).Type==IDVariant.NULL?"[Empty]":m.Get(1).stringValue());this.Description=m.Get(2).stringValue();return true}}this.Requests.Clear();this.AttID=0;this.Name="";this.UserID=0;this.Description="";this.SQLSessLoad.ClearParameters();this.SQLSessLoad.AddParameter(new IDVariant(c));this.MainFrm.OpenConnection(this.DB);var k=this.DB.ExecuteIDPS(this.SQLSessLoad,true);if(!k.EOF()){k.MoveFirst()}this.Name=k.Get(1).stringValue();this.UserID=k.Get(2).intValue();this.Description=k.Get(3).stringValue();this.SQLReqLoad.ClearParameters();this.SQLReqLoad.AddParameter(new IDVariant(c));var o=this.DB.ExecuteIDPS(this.SQLReqLoad,true);if(!o.EOF()){o.MoveFirst()}var j;while(!o.EOF()){j=new DTTRequest();j.LoadFromDB(this,o);this.AttID++;this.Requests.Add(j);o.MoveNext()}this.AttID++;this.Enabled=false;this.ShowLevel=DTTEngine.LEV_STATEM;this.ShowMsgLevel=DTTEngine.DTTMSG_INFO;return true}catch(f){WriteToConsoleError(f);return false}};DTTEngine.prototype.TakeSnapshot=function(g,h,a){if(a==undefined){a=false}var f;var m;var c="";try{f=new ProXMLDocument();m=f.CreateElement("Session");f.AppendChild(m);if(this.Requests.Count()==0){m.SetAttribute("StartTime",IDL.Now().stringValue())}else{m.SetAttribute("StartTime",this.Requests[0].StartTime.toString())}if(!this.Name.equals("")){m.SetAttribute("Name",this.Name)}m.SetAttribute("UserID",this.UserID+"");if(!this.Description.equals("")){m.SetAttribute("Description",this.Description)}m.SetAttribute("HostName",this.MainFrm.HostName);var l;var b=this.Requests.length;for(var d=0;d<b;d++){l=this.Requests[d];l.TakeSnapshot(f,m)}var k=this.FixedDebugFile;if((h||g)&&k.length==0){while(true){c="XML"+(Math.floor(Math.random()*2147483647))+(a?".zip":".xml");k=this.MainFrm.getRealPath()+"/temp/"+c}}if(a){}else{f.Save(k)}if(g&&this.SessionID==0){this.CreateSession()}if(g&&this.SessionID!=-1){var o=new IDCachedRowSet();this.MainFrm.OpenConnection(this.DB);o.setCommand("select SessID, SessSnapshot from DTTSessions where SessID = "+this.SessionID);o.setUpdatable();o.execute(new ArrayList(),this.DB);if(!o.EOF()){o.MoveFirst()}o.setTableName("DTTSessions");Glb.LoadBlob(this.MainFrm,o,2,k,this.DB)}if(!h){c=""}else{c="temp/"+c}return c}catch(j){WriteToConsoleError(j);return""}};DTTEngine.prototype.CompressStream=function(c,b,a){};DTTEngine.prototype.LoadSnapshot=function(a){var b;var g=null;var h=null;var d=null;try{b=new ProXMLDocument();b.Load(a);this.Requests.Clear();this.AttID=0;this.Name="";this.UserID=0;this.Description="";for(var c=0;c<b.ChildNodes.length;c++){g=b.ChildNodes[c];if(g.NodeType==1){break}}if(g==null){return}this.Name=g.GetAttribute("Name");this.UserID=new IDVariant(g.GetAttribute("UserID")).intValue();this.Description=g.GetAttribute("Description");for(var c=0;c<g.ChildNodes.length;c++){h=g.ChildNodes[c];if(h.NodeType==1){d=new DTTRequest();d.LoadSnapshot(h);this.AttID++;d.ID=this.AttID;this.Requests.Add(d)}}this.AttID++;this.Enabled=false;this.ShowLevel=DTTEngine.LEV_STATEM;this.ShowMsgLevel=DTTEngine.DTTMSG_INFO}catch(f){WriteToConsoleError(f)}};DTTEngine.prototype.CanSendHelpMail=function(b){var c=true;if(b){if(this.LastSentReqID!=-1){var a=(this.Requests.Count()>this.RequestsToPassive?this.RequestsToPassive:this.Requests.Count());c=((this.AttID-this.LastSentReqID)>a/2)}}else{if(this.LastSentTime.getTime()!=0){c=(new Date().getTime()-LastSentTime.getTime())>5*60*1000}}return c};DTTEngine.prototype.SendHelpMail=function(f){if(f==undefined){f=false}var k=new IDVariant(false);var c;var h="";var j=this.MainFrm;try{if(!this.CanSendHelpMail(f)){return false}h=j.RealPath+"/"+this.TakeSnapshot(false,true);if(this.HelpSubject.equals("")){this.HelpSubject=IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("6EADA0F9-2C85-40F5-9E49-EA399BA28F97","Help request from |1")),new IDVariant(this.HelpName)).stringValue()}if(this.HelpDescription.equals("")){this.HelpDescription=this.Description}c=new IDMailer();if(!this.HelpSMTPServer.equals("")){c.SetRelayServer(this.HelpSMTPServer,this.HelpSMTPUsername,this.HelpSMTPPassword)}if(!this.HelpAddress.equals("")){c.AddToAddress(this.HelpAddress)}if(!this.HelpReplyTo.equals("")){c.FromAddress=this.HelpReplyTo;c.AddReplyToAddress(this.HelpReplyTo)}else{var b=j.Caption().stringValue().toLowerCase();for(var d=0;d<b.length;d++){if(!((b.charCodeAt(d)>=32+65&&b.charCodeAt(d)<=32+90)||(b.charCodeAt(d)>=48&&b.charCodeAt(d)<=57))){b=b.substring(0,d)+String.fromCharCode(32)+b.substring(d+1)}}b="dtt@"+b.Replace(" ","")+".com";c.FromAddress=b}if(!this.HelpSubject.equals("")){c.Subject=this.HelpSubject}var l;var a="\r\n";l="Session data: "+a;l+=("   Session ID : "+this.SessionID+a);l+=("   Session Name : "+this.Name+a);l+=("   Session Description : "+this.Description+a);l+=("   Session User ID : "+this.UserID+a);l+=("   Session Host Address : "+j.HostName+a);l+=("------------------------------------------------------------------------"+a+a);if(f){l+=(j.RTCObj.GetConst("A29A4CF5-CA86-4F41-9DA8-D3E6A65A7637","This e-mail has been automatically sent because an error occurred")+a+a)}else{l+=(IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("74E56F3B-E786-40DE-9D78-34B192302EF3","The user |1 is requesting help. Please call |2")),new IDVariant(this.HelpName),new IDVariant(this.HelpRecallTo))+a+a)}l+=("------------------------------------------------------------------------"+a);l+=this.HelpDescription;c.Body=l;c.AddAttachment(h);j.OnSendHelpMail(c,new IDVariant(f),k);if(k.isTrue()){return false}c.SendMail();this.LastSentReqID=this.AttID;this.LastSentTime=new Date();if(!f){j.set_AlertMessage(new IDVariant(j.RTCObj.GetConst("46197C41-9EBF-460D-BECE-509C9401476F","La richiesta di aiuto è stata inoltrata con successo.")))}return true}catch(g){if(!f){j.set_AlertMessage(IDL.FormatMessage(new IDVariant(j.RTCObj.GetConst("474DFD5B-6AAA-4D65-A017-DED22B940B83","La richiesta di aiuto non è stata inoltrata. Contattare il servizio di assistenza (|1 - |2)")),new IDVariant(-1),new IDVariant(g.message)))}return false}};DTTEngine.prototype.GetDTTID=function(a,b){if(b==undefined){b=new IDVariant("")}if(typeof(b)!="object"){b=new IDVariant(b)}if(this.TestEnabled){return"id='"+this.Guid+(!b.stringValue().equals("")?"-"+b.stringValue():"")+"' "}else{return""}};DTTEngine.prototype.RenderTest=function(a,b){};DTTEngine.prototype.RenderTestCode=function(a){};DTTEngine.prototype.RenderHelp=function(a,b){};DTTEngine.prototype.CheckDiff=function(a,b,d){this.MainFrm=a;this.RefDTTObj=new DTTEngine();this.RefDTTObj.Init(0,0,false,false,false,a);this.RefDTTObj.InitDB(this.DB,this.DBClass);this.RefDTTObj.AddRequest(a);var c=RefDTTObj.LoadFromDB(d);this.RefDTTObj.EndRequest();var e=this.LoadFromDB(b);if(!e||!c){RefDTTObj=null;a.WriteStrDbgMain("<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'>");a.WriteStrDbgMain("<link rel=stylesheet type='text/css' href='dtt.css'></head>");a.WriteStrDbgMain("<body>");if(!c){a.WriteStrDbgMain("<b>Session "+d+" not found.</b><br>")}if(!e){a.WriteStrDbgMain("<b>Session "+b+" not found.</b><br>")}a.WriteStrDbgMain("</body></html>");this.MainFrm=null;return}this.ComputeDiff(RefDTTObj,this);this.Render(a,"");this.MainFrm=null};DTTEngine.prototype.ComputeDiff=function(b,f){var d;var c;var e=f.Requests.length;for(var a=0;a<e;a++){d=f.Requests[a];c=this.RefSess.GetRequest(d.ID+"");if(c!=null){d.CheckDiff(c)}}};DTTEngine.prototype.DumpGUIDsToFile=function(b,a){};DTTEngine.prototype.SetHelpSrc=function(a){if(this.AttRequest!=null){this.AttRequest.HelpHTML=a}};DTTEngine.prototype.ProcCommand=function(h,b){var k=h.substr(0,3);var e=h.substr(3,36);var j=this.Procs[e];if(j==null){j=new DTTItem();j.Collect=true;j.Visible=true;j.ObjGuid=e;this.Procs[e]=j}if(k.equals("VIS")){j.Visible=!j.Visible}if(k.equals("COL")){j.Collect=!j.Collect}this.SaveProcs(b);var f=this.Requests.length;for(var a=0;a<f;a++){var d=this.Requests[a];d.ProcCommand(h,this.Procs)}};DTTEngine.prototype.SaveProcs=function(a){};DTTEngine.prototype.LoadProcs=function(a){};DTTEngine.prototype.ResetProcs=function(c){var e=this.Procs.length;for(var a=0;a<e;a++){var g=this.Procs[a];if(!g.Visible){g.Visible=true;var f=this.Requests.length;for(var b=0;b<f;b++){var d=this.Requests[b];d.ProcCommand("VIS"+g.ObjGuid,this.Procs)}}if(!g.Collect){g.Collect=true;var f=this.Requests.length;for(var b=0;b<f;b++){var d=this.Requests[b];d.ProcCommand("COL"+g.ObjGuid,this.Procs)}}}this.Procs.Clear();this.SaveProcs(c)};DTTEngine.prototype.IsEmptyRequest=function(){if(this.AttRequest!=null){return this.AttRequest.Items.Count()==0}else{return true}};DTTEngine.prototype.IsTouch=function(){if(this.isTouch==undefined){if(!RD4_WebEntryPoint){this.isTouch=false}else{if(RD4_WebEntryPoint.BrowserInfo()<5){this.isTouch=false}else{if(RD4_WebEntryPoint.Request&&RD4_WebEntryPoint.Request.Headers.Referer&&RD4_WebEntryPoint.Request.Headers.Referer.length>0){this.isTouch=false}else{this.isTouch=(RD4_WebEntryPoint.BrowserInfo()>=5)}}}}return this.isTouch};function DTTHelpItem(){this.x=160;this.y=20;this.w=200;this.h=100;this.Delay=3;this.Text="";this.Hide=false}DTTHelpItem.prototype.TakeSnapshot=function(b,d,c){var a=b.CreateElement(c);d.AppendChild(a);a.SetAttribute("Left",this.x+"");a.SetAttribute("Top",this.y+"");a.SetAttribute("Width",this.w+"");a.SetAttribute("Height",this.h+"");a.SetAttribute("Text",this.Text);a.SetAttribute("Delay",this.Delay+"");a.SetAttribute("Hide",(this.Hide?"-1":"0"))};DTTHelpItem.prototype.LoadSnapshot=function(a){this.x=new IDVariant(a.GetAttribute("Left")).intValue();this.y=new IDVariant(a.GetAttribute("Top")).intValue();this.w=new IDVariant(a.GetAttribute("Width")).intValue();this.h=new IDVariant(a.GetAttribute("Height")).intValue();this.Text=a.GetAttribute("Text");this.Delay=new IDVariant(a.GetAttribute("Delay")).dblValue();this.Hide=new IDVariant(a.GetAttribute("Hide")).booleanValue()};function DTTItem(){this.IndLevel;this.MsgType;this.ItemType;this.ObjGuid="";this.ObjType;this.ObjName="";this.ObjDescription="";this.ObjValue=new IDVariant();this.RecordCount;this.TickCount;this.NumOpenDiv=0;this.Visible=true;this.Collect=true;this.TotalTickCount=0;this.NetTickCount=0;this.TotalNetTickCount=0;this.ForceCbp=-1;this.ItemID;this.SubItem;this.HelpItem=null}DTTItem.prototype.RenderDots=function(c,e,a,f,b){var d=this.IndLevel;if(this.ItemType==DTTEngine.IT_ENTERELSE){d--}var g=(a*(d-1)+4);c.WriteStrDbgReqRef("<div class='ItemList'><img align='absmiddle' src='dttimg/empty.gif'>");c.WriteStrDbgReqRef("<span style='width:"+(g+(f?78:0))+"px;display:inline-block'></span>");c.WriteStrDbgReqRef("<a href='javascript:"+c.UrlForDTT(Glb.ITEM_DTT,"EXPIT"+e+"REF"+b)+"' title='click to expand'>");c.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/dot.gif'>");c.WriteStrDbgReqRef("</a></div>")};DTTItem.prototype.Render=function(p,l,h,r,f,m,b,a,c,g,s){var e="";var o;var q;var j;var d=false;var k=false;this.NumOpenDiv=s;if(this.ItemType==DTTEngine.IT_NULL&&this.IndLevel==-999){return s}if(g!=null){d=g.ItemType==DTTEngine.IT_ENTERIF}if(this.ItemType==DTTEngine.IT_ENTERPROC||(this.ItemType==DTTEngine.IT_IF&&d)||this.ItemType==DTTEngine.IT_ENTERELSE||this.ItemType==DTTEngine.IT_FOREACH||this.ItemType==DTTEngine.IT_WHILE||this.ItemType==DTTEngine.IT_FORI||this.ItemType==DTTEngine.IT_SWITCH){k=true;s++}if(this.ItemType==DTTEngine.IT_ENTERIF){f.set(new IDVariant("enter.gif"));return s}o=this.IndLevel;if(this.ItemType==DTTEngine.IT_ENTERELSE){o--}q=(r*(o-1)+4);if(!f.toString().equals("")){q=q-16;if(q<0){q=0}}if(this.ForceCbp==-1){j=this.FindBP(p,this)}else{j=this.ForceCbp}e=this.GetNote(a);if(h>0&&((this.ItemType==DTTEngine.IT_ENTERPROC&&this.IndLevel==1)||(this.ItemType==DTTEngine.IT_NULL&&this.IndLevel==-1))){p.WriteStrDbgReqRef("<hr noshade color='gray' size=1px>")}if(!a){p.WriteStrDbgReqRef("<div id=dblk"+h+" class='"+this.GetItemClass()+"' style='"+(!e.equals("")?"border-left-color:blue;":"")+(j!=0?"background-color:"+this.Colors(j)+";":"")+"'>");if(m){p.WriteStrDbgReqRef("<span class='ItemTime' style='width:40px'>"+this.TickCount+"</span>");p.WriteStrDbgReqRef("<span class='ItemTime' style='width:40px'>");if(this.TickCount-b.intValue()>100){p.WriteStrDbgReqRef("("+(this.TickCount-b.intValue())+")")}p.WriteStrDbgReqRef("&nbsp;&nbsp;</span>");b.set(new IDVariant(this.TickCount))}if(!e.equals("")){p.WriteStrDbgReqRef("<a href='javascript:dt(\"it"+h+"\")'>")}if(this.MsgType==DTTEngine.DTTMSG_WARN||this.MsgType==DTTEngine.DTTMSG_ERROR){p.WriteStrDbgReqRef("<img name='"+(this.MsgType==DTTEngine.DTTMSG_WARN?"warn":"stop")+"' align='absmiddle' src='dttimg/"+this.GetIcon()+"'>")}else{p.WriteStrDbgReqRef("<img "+(j!=0?"name='brkpt' ":"")+"align='absmiddle' src='dttimg/"+this.GetIcon()+"'>")}if(!e.equals("")){p.WriteStrDbgReqRef("</a>")}p.WriteStrDbgReqRef("<span style='width:"+q+"px;display:inline-block'></span>");if(!f.toString().equals("")){p.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/"+f.toString()+"'>");f.set(new IDVariant(""))}if(!this.ObjGuid.equals("")&&!p.DTTObj.IsTouch()){p.WriteStrDbgReqRef("<a href='pgid://"+this.ObjGuid+"'>")}p.WriteStrDbgReqRef("<img "+(this.ItemType==DTTEngine.IT_ENTERPROC?"name='proc"+this.ObjGuid+"'":"")+" align='absmiddle' src='dttimg/"+this.GetObjIcon()+"'>");if(!this.ObjGuid.equals("")){p.WriteStrDbgReqRef("</a>")}if(k){p.WriteStrDbgReqRef("<img id=tblk"+h+l+" style='cursor:hand' onclick='de(\"blk"+h+"\");' align='absmiddle' src='dttimg/cmp.gif'>")}p.WriteStrDbgReqRef("&nbsp;<span title='"+this.GetTitle()+"'>"+this.GetName()+"</span></div>");if(!e.equals("")){p.WriteStrDbgReqRef("<div id='it"+h+l+"' style='left:"+(42+(r*(o-1))+(m?78:0))+"px' class='ItemNote'>");p.WriteStrDbgReqRef("<table cellpadding=1 cellspacing=0 class='NoteTbl'>"+e+"</table></div>")}}else{p.WriteStrDbgReqRef("<div class='ItemList' style='"+(j!=0?"background-color:"+this.Colors(j)+";":"")+"'>");p.WriteStrDbgReqRef("<img align='absmiddle' src='dttimg/empty.gif'></div>");if(!e.equals("")){p.WriteStrDbgReqRef("<div id='it"+h+l+"' style='left:"+(42+(r*(o-1))+(m?78:0))+"px' class='ItemNote'>");p.WriteStrDbgReqRef("<table cellpadding=1 cellspacing=0 class='NoteTbl' style='background-color:white;color:white'>"+e+"</table></div>")}}if(k){p.WriteStrDbgReqRef("<div id='blk"+h+l+"' style='display:block'>")}if(this.ItemType==DTTEngine.IT_ENTERELSE||this.ItemType==DTTEngine.IT_ENTERSWITCH){f.set(new IDVariant("enter.gif"))}return s};DTTItem.prototype.GetIcon=function(){switch(this.MsgType){case DTTEngine.DTTMSG_INFO:case DTTEngine.DTTMSG_VERB:return"info.gif";case DTTEngine.DTTMSG_ERROR:return"stop.gif";case DTTEngine.DTTMSG_WARN:return"warn.gif"}return""};DTTItem.prototype.GetObjIcon=function(){switch(this.ItemType){case DTTEngine.IT_LOOPDET:return"loopdet.gif";case DTTEngine.IT_ENTERPROC:switch(this.ObjType){case DTTEngine.PT_EVENT:return"event.gif";case DTTEngine.PT_EVENT_RECUR:return"event_recur.gif";case DTTEngine.PT_FUNCTION:return"funct.gif";case DTTEngine.PT_PROCEDURE:return"proc.gif";case DTTEngine.PT_PROC_ITEM:return"stmt.gif"}break;case DTTEngine.IT_EXITPROC:return"exit.gif";case DTTEngine.IT_IF:return"if.gif";case DTTEngine.IT_ENTERIF:return"enter.gif";case DTTEngine.IT_ENTERELSE:return"else.gif";case DTTEngine.IT_ENDIF:return"exit.gif";case DTTEngine.IT_ASSIGN:return"assign.gif";case DTTEngine.IT_ERROR:return"error.gif";case DTTEngine.IT_BREAK:return"break.gif";case DTTEngine.IT_CONTINUE:return"cont.gif";case DTTEngine.IT_EXCEPTION:return"stop.gif";case DTTEngine.IT_RETURN:return"return.gif";case DTTEngine.IT_SUBPROC:return"stmt.gif";case DTTEngine.IT_FOREACH:return"loop.gif";case DTTEngine.IT_ENDFOREACH:return"exit.gif";case DTTEngine.IT_DBDATASRC:return"query.gif";case DTTEngine.IT_IMDBDATASRC:return"query.gif";case DTTEngine.IT_WHILE:return"loop.gif";case DTTEngine.IT_ENDWHILE:return"exit.gif";case DTTEngine.IT_FORI:return"fori.gif";case DTTEngine.IT_ENDFORI:return"exit.gif";case DTTEngine.IT_SWITCH:return"switch.gif";case DTTEngine.IT_ENTERSWITCH:return"case.gif";case DTTEngine.IT_ENDSWITCH:return"exit.gif";case DTTEngine.IT_QUERY:switch(this.ObjType){case DTTEngine.STMT_QRY_DELETE:return"qrydel.gif";case DTTEngine.STMT_QRY_UPDATE:return"qryupd.gif";case DTTEngine.STMT_QRY_INSVAL:return"insval.gif";case DTTEngine.STMT_QRY_INSSEL:return"insrow.gif";case DTTEngine.STMT_QRY_SELVAR:return"selvar.gif";case DTTEngine.STMT_QRY_SELECT:return"query.gif";case DTTEngine.STMT_QRY_SELCOL:return"query.gif"}break;case DTTEngine.IT_ENDQUERY:return"query.gif";case DTTEngine.IT_MESSAGE:return"msg.gif";case DTTEngine.IT_USER:return"user.gif";case DTTEngine.IT_TRACE:switch(this.ObjType){case DTTEngine.TRC_ITMAIN:return"cliapp.gif";case DTTEngine.TRC_ITFORM:return"form.gif";case DTTEngine.TRC_ITFRAME:return"trace.gif";case DTTEngine.TRC_ITPANEL:return"panel.gif";case DTTEngine.TRC_ITTREE:return"tree.gif";case DTTEngine.TRC_ITTABBED:return"tabbed.gif";case DTTEngine.TRC_ITCOMMAND:return"command.gif";case DTTEngine.TRC_ITMENU:return"cmdset.gif";case DTTEngine.TRC_ITTOOLBAR:return"cmdset.gif";case DTTEngine.TRC_ITBUTBAR:return"cmdset.gif";case DTTEngine.TRC_ITCAPTBAR:return"cmdset.gif";case DTTEngine.TRC_ITERROR:return"warn.gif"}break}return""};DTTItem.prototype.GetName=function(d){if(d==undefined){d=false}var c="";var a="";var e=null;switch(this.ItemType){case DTTEngine.IT_LOOPDET:return"LOOP DETECTED (BREAK after "+this.ObjValue.ToString()+" loops - "+this.ObjDescription+")";case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_SUBPROC:c=(!this.ObjValue.ToString().equals("")?this.ObjValue.ToString()+".":"")+this.ObjName;a=" (";if(this.SubItem!=null){for(var b=0;b<this.SubItem.length;b++){e=this.SubItem[b];c+=a+e.ObjValue.ToString();a=", "}c=c+(this.SubItem.Count()>0?")":"")}return(d?c:Glb.HTMLEncode(c,true).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_EXITPROC:return"end";case DTTEngine.IT_ENTERIF:return"";case DTTEngine.IT_ENTERELSE:return"else";case DTTEngine.IT_ENDIF:return"end if";case DTTEngine.IT_ASSIGN:c=(d?this.ObjName:Glb.HTMLEncode(this.ObjName));if(this.SubItem!=null){e=this.SubItem[this.SubItem.Count()-1];if(d){c+="     "}else{c+="</span><span style='color:blue'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}c+=("["+(d?e.ObjValue.ToString():Glb.HTMLEncode(e.ObjValue.ToString(),true).replace(new RegExp(" ","g"),"&nbsp;"))+"]")}return c;case DTTEngine.IT_BREAK:return"break";case DTTEngine.IT_CONTINUE:return"continue";case DTTEngine.IT_EXCEPTION:return"("+(d?this.ObjName:Glb.HTMLEncode(this.ObjName))+") Err "+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString(),true))+": "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,true));case DTTEngine.IT_RETURN:return"return "+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString(),true).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_ENDFOREACH:return"end loop ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_ENDFORI:return"end loop ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_ENDWHILE:return"end while ("+(d?this.ObjValue.ToString():Glb.HTMLEncode(this.ObjValue.ToString()))+" loops)";case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:return IDL.Format(new IDVariant(this.ObjType),new IDVariant("000"),null).ToString()+" - "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,false).replace(new RegExp(" ","g"),"&nbsp;"));case DTTEngine.IT_ERROR:return(d?this.ObjName:Glb.HTMLEncode(this.ObjName))+": "+(d?this.ObjDescription:Glb.HTMLEncode(this.ObjDescription,false,true));case DTTEngine.IT_FOREACH:case DTTEngine.IT_QUERY:c=(d?this.ObjName:Glb.HTMLEncode(this.ObjName,false,true));if(this.SubItem!=null){for(var b=0;b<this.SubItem.length;b++){e=this.SubItem[b];if(e.ItemType==DTTEngine.IT_IMDBDATASRC||e.ItemType==DTTEngine.IT_DBDATASRC){c+=(" ("+e.RecordCount+" records)")}}}return c;case DTTEngine.IT_TRACE:c=Glb.HTMLEncode(this.ObjName);if(this.SubItem!=null){if(d){c+=("     ["+this.SubItem[0].ObjValue.stringValue()+"]")}else{c+=("</span><span style='color:blue'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;["+Glb.HTMLEncode(this.SubItem[0].ObjValue.stringValue(),true)+"]")}}return c;default:return(d?this.ObjName:Glb.HTMLEncode(this.ObjName))}};DTTItem.prototype.GetTitle=function(){switch(this.ItemType){case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:return"MsgID = "+this.ObjType+" - "+Glb.HTMLEncode(this.ObjName,false,true);case DTTEngine.IT_EXCEPTION:case DTTEngine.IT_ERROR:return"";default:return Glb.HTMLEncode(this.ObjDescription,false,true)}};DTTItem.prototype.GetNote=function(e){var c="";var d;var b;var g="";var f="";if(e){f=" style='background-color:white;color:white'"}switch(this.ItemType){case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_IF:case DTTEngine.IT_SUBPROC:case DTTEngine.IT_WHILE:case DTTEngine.IT_SWITCH:case DTTEngine.IT_ENTERSWITCH:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+"</td><td> = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}return c;case DTTEngine.IT_ASSIGN:c="<tr><td>Old Value = "+Glb.HTMLEncode(this.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_TOKEN){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}}return c;case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true)+"</td></tr>")}if(d.ItemType==DTTEngine.IT_MESSAGE_TK){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjName));if(!d.ObjValue.ToString().equals("")){c+=(" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;"))}c+="</td></tr>"}}}return c;case DTTEngine.IT_EXCEPTION:c="";if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<tr><td>"+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</td></tr>")}}}return c;case DTTEngine.IT_FOREACH:case DTTEngine.IT_FORI:case DTTEngine.IT_QUERY:if(this.ItemType==DTTEngine.IT_QUERY&&!this.ObjValue.ToString().equals("")){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(this.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"<br></div>")}if(this.SubItem!=null){for(var a=0;a<this.SubItem.length;a++){d=this.SubItem[a];if(d.ItemType==DTTEngine.IT_ENDQUERY){this.MsgType=DTTEngine.DTTMSG_WARN;c+=("<div class='Warn'"+(e?f:"")+">Query took too long to execute: "+d.ObjValue.ToString()+" ms</div>")}if(d.ItemType==DTTEngine.IT_PARAMETER){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</div>")}if(d.ItemType==DTTEngine.IT_TOKEN){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjName)+" = "+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"</div>")}if(d.ItemType==DTTEngine.IT_IMDBDATASRC||d.ItemType==DTTEngine.IT_DBDATASRC){if(this.ObjValue.ToString().equals("")&&!d.ObjValue.ToString().equals("")){c+=("<div class='SQL'"+(e?f:"")+">"+Glb.HTMLEncode(d.ObjValue.ToString(),true).Replace(" ","&nbsp;")+"<br></div>")}if(d.ItemType==DTTEngine.IT_IMDBDATASRC){c+=("<div class='SQL'"+(e?f:"")+">IMDB Data Source<br></div>")}if(d.SubItem!=null){if(d.SubItem.Count()>1){c+=("<table class='SQLTbl'"+(e?f:"")+">");for(b=0;b<d.SubItem.Count();b++){g=(d.SubItem[b]).ObjValue.ToString();if(g.length>0&&g.charAt(g.length-1)=="§"){g=g.substr(0,g.length-1)}g=Glb.HTMLEncode(g).Replace(" ","&nbsp;");g=g.Replace("&#167;","</td><td>");c+=("<tr><td>"+g+"</td></tr>")}c+="</table>"}}}}}return c;case DTTEngine.IT_TRACE:if(this.SubItem!=null){switch(ObjType){case DTTEngine.TRC_ITMAIN:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITFORM:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITPANEL:c=this.RenderPanelTrace();break;case DTTEngine.TRC_ITTREE:c=this.RenderTreeTrace();break;case DTTEngine.TRC_ITTABBED:c=this.RenderGenTrace();break;case DTTEngine.TRC_ITMENU:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITTOOLBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITBUTBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITCAPTBAR:c=this.RenderCmdTrace();break;case DTTEngine.TRC_ITERROR:c=this.RenderGenTrace();break}}return c}return""};DTTItem.prototype.Level=function(){switch(this.ItemType){case DTTEngine.IT_LOOPDET:case DTTEngine.IT_EXCEPTION:return DTTEngine.LEV_EXCEPT;case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_EXITPROC:return DTTEngine.LEV_PROCS;case DTTEngine.IT_IF:case DTTEngine.IT_ENTERIF:case DTTEngine.IT_ENTERELSE:case DTTEngine.IT_ENTERSWITCH:case DTTEngine.IT_ENDIF:case DTTEngine.IT_ERROR:case DTTEngine.IT_BREAK:case DTTEngine.IT_CONTINUE:case DTTEngine.IT_RETURN:case DTTEngine.IT_FOREACH:case DTTEngine.IT_ENDFOREACH:case DTTEngine.IT_WHILE:case DTTEngine.IT_ENDWHILE:case DTTEngine.IT_SWITCH:case DTTEngine.IT_ENDSWITCH:case DTTEngine.IT_FORI:case DTTEngine.IT_ENDFORI:return DTTEngine.LEV_CTRLBLCKS;case DTTEngine.IT_ASSIGN:case DTTEngine.IT_SUBPROC:return DTTEngine.LEV_STATEM;case DTTEngine.IT_QUERY:case DTTEngine.IT_ENDQUERY:return DTTEngine.LEV_QUERY}return 0};DTTItem.prototype.FindBP=function(a,e){var g=0;for(var c=0;c<a.DTTObj.BreakPoints.length;c++){var b=a.DTTObj.BreakPoints[c];g++;if(e.ObjGuid.equals(b)){return g}if(e.SubItem!=null){for(var d=0;d<e.SubItem.length;d++){var f=e.SubItem[d];if(f.ObjGuid.equals(b)){return g}}}}return 0};DTTItem.prototype.RenderGenTrace=function(){var e;var d="";var b="";var c="";for(var a=0;a<this.SubItem.length;a++){e=this.SubItem[a];c="";if(e.ForceCbp!=-1){c=" style='background-color:"+this.Colors(e.ForceCbp)+"'"}switch(e.ObjType){case DTTEngine.TRC_MAINCAPTION:case DTTEngine.TRC_FORMCAPTION:case DTTEngine.TRC_FRAMECAPTION:case DTTEngine.TRC_TABCAPTION:d+=("<tr><td><img src='dttimg/"+this.GetObjIcon()+"'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");b=e.GetExtToken("PG",false);if(!b.equals("")){d+=("<tr class='TraceToken'><td></td><td>Page Selected</td><td"+c+">= "+b+"</td></tr>")}break;case DTTEngine.TRC_MAININDIC:case DTTEngine.TRC_FORMINDIC:d+=("<tr><td><img src='dttimg/indic.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_FORMMESSAGE:d+=("<tr><td><img src='dttimg/msg.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_ERRNUMBER:d+=("<tr><td><img src='dttimg/stop.gif'></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break;case DTTEngine.TRC_ERRDESCR:d+=("<tr class='TraceToken'><td></td><td"+c+">");d+=(Glb.HTMLEncode(e.ObjName)+"</td><td"+c+">= "+Glb.HTMLEncode(e.ObjValue.stringValue())+"</td></tr>");break}}return d};DTTItem.prototype.RenderPanelTrace=function(){var o=0;var D;var I;var N;var j;var V;var E;var U;var Z="";var R;var g;var C;var B;var v;var q;var b="";var Q="";var ab;var l;var H;var W;var T;var F;var m;var t;var K;var J;var M;var Y;var L;var A;var f;var ac;var a=0;var X=0;var e=0;var P="";var k="";var S=null;var O=0;var G=0;var d="";var z="";H=-1;var aa=false;while(O<2){EndFor:{for(var u=0;u<this.SubItem.length;u++){S=this.SubItem[u];d="";z="";if(S.ForceCbp!=-1){d="background-color:"+this.Colors(S.ForceCbp);z=" style='"+d+"'"}switch(S.ObjType){case DTTEngine.TRC_PANCAPTION:if(O==0){o=(new IDVariant(S.GetExtToken("NF",true))).intValue();a=(o>0?(this.SubItem.Count()-1)/o:0);D=(new IDVariant(S.GetExtToken("LAY",true))).intValue();I=(new IDVariant(S.GetExtToken("U",true))).intValue()!=0;N=(new IDVariant(S.GetExtToken("D",true))).intValue()!=0;j=(new IDVariant(S.GetExtToken("I",true))).intValue()!=0;V=(new IDVariant(S.GetExtToken("S",true))).intValue()!=0;E=(new IDVariant(S.GetExtToken("L",true))).intValue()!=0;U=(new IDVariant(S.GetExtToken("ST",true))).intValue();R=(new IDVariant(S.GetExtToken("NR",true))).intValue();C=(new IDVariant(S.GetExtToken("AR",true))).intValue();g=(new IDVariant(S.GetExtToken("AP",true))).intValue();B=(new IDVariant(S.GetExtToken("PG",true))).intValue();v=(new IDVariant(S.GetExtToken("V",true))).intValue();q=(new IDVariant(S.GetExtToken("C",true))).intValue();b=S.GetExtToken("ERR",false);X=(new IDVariant(S.GetExtToken("TW",true))).intValue();e=(new IDVariant(S.GetExtToken("TH",true))).intValue();switch(U){case 0:Z="NONE";break;case 1:Z="QBE";break;case 2:Z="DATA";break;case 3:Z="UPDATED";break}P+=("<tr><td><img src='dttimg/panel.gif'></td><td colspan=2"+z+">");P+=(Glb.HTMLEncode(S.ObjValue.stringValue())+"</td></tr>");if(!I&&!j&&!N){P+=("<tr><td></td><td"+z+">Read Only</td><td class='TraceToken'"+z+">&nbsp;TRUE</td></tr>")}else{if(!I){P+=("<tr><td></td><td"+z+">Can Update</td><td class='TraceToken'"+z+">&nbsp;FALSE</td></tr>")}if(!j){P+=("<tr><td></td><td"+z+">Can Insert</td><td class='TraceToken'"+z+">&nbsp;FALSE</td></tr>")}if(!N){P+=("<tr><td></td><td"+z+">Can Delete</td><td class='TraceToken'"+z+">&nbsp;FALSE</td></tr>")}if(!V){P+=("<tr><td></td><td"+z+">Can Select</td><td class='TraceToken'"+z+">&nbsp;FALSE</td></tr>")}}if(E){P+=("<tr><td></td><td"+z+">Locked</td><td class='TraceToken'"+z+">&nbsp;TRUE</td></tr>")}P+=("<tr><td></td><td"+z+">Status</td><td class='TraceToken'"+z+">&nbsp;"+Z+"</td></tr>");P+=("<tr><td></td><td"+z+">Num. Rows</td><td class='TraceToken'"+z+">&nbsp;"+R+"</td></tr>");P+=("<tr><td></td><td"+z+">Actual Pos.</td><td class='TraceToken'"+z+">&nbsp;"+g+"</td></tr>");P+=("<tr><td></td><td"+z+">Selected Row</td><td class='TraceToken'"+z+">&nbsp;"+(C+1)+"</td></tr>");P+=("<tr><td></td><td"+z+">Selected Page</td><td class='TraceToken'"+z+">&nbsp;"+(B+1)+"</td></tr>");if(v==0){P+=("<tr><td></td><td"+z+">Visible</td><td class='TraceToken'"+z+">&nbsp;FALSE</td></tr>")}if(q!=0){P+=("<tr><td></td><td"+z+">Collapsed</td><td class='TraceToken'"+z+">&nbsp;TRUE</td></tr>")}ab=0;while(!b.equals("")){ab++;l=b.indexOf("§");if(l==-1){break}Q=b.substr(0,l);b=b.substr(l+1);if(!Q.equals("")){P+=("<tr><td></td><td"+z+">Error Row "+ab+"</td><td class='TraceToken'"+z+">&nbsp;"+Q+"</td></tr>")}}}break;case DTTEngine.TRC_PANFLDVALUE:if(H==-1){if(S.ObjDescription.indexOf("X=")!=-1){H=1;P+=("<tr><td colspan=3><br><div class='pantrc' style='width:"+X+"px;height:"+e+"px'>")}else{H=0;if(a>1){P+="<tr><td colspan=3><br><table cellpadding=3px cellspacing=0px style='border-collapse:collapse'>"}}}W=(new IDVariant(S.GetExtToken("E",true))).intValue()!=0;T=(new IDVariant(S.GetExtToken("V",true))).intValue()!=0;F=(new IDVariant(S.GetExtToken("P",true))).intValue()!=0;m=(new IDVariant(S.GetExtToken("VS",true))).intValue();t=(new IDVariant(S.GetExtToken("PI",true))).intValue();Q=S.GetExtToken("ERR",false);if(H==1){if(O==0){if(T&&F){K=(new IDVariant(S.GetExtToken("X",true))).intValue();J=(new IDVariant(S.GetExtToken("Y",true))).intValue();M=(new IDVariant(S.GetExtToken("W",true))).intValue();Y=(new IDVariant(S.GetExtToken("H",true))).intValue();L=(new IDVariant(S.GetExtToken("HX",true))).intValue();A=(new IDVariant(S.GetExtToken("HY",true))).intValue();f=(new IDVariant(S.GetExtToken("HW",true))).intValue();ac=(new IDVariant(S.GetExtToken("HH",true))).intValue();if(f!=0&&ac!=0){P+=("<div class='panhdr' style='left:"+L+"px;top:"+A+"px;width:"+f+"px;height:"+ac+"px;"+d+"'>");P+=(Glb.HTMLEncode(S.ObjName)+"</div>")}k="npf";if(!W){k="dpf"}if(t>0){k="lpf"}if(t==-1){k="spf"}P+=("<div title='"+Q+"' class='pan"+k+"' style='left:"+K+"px;top:"+J+"px;width:"+M+"px;height:"+Y+"px;"+d+"'>");P+=(Glb.HTMLEncode(t==-1?S.ObjName:S.ObjValue.stringValue())+"</div>")}}else{if(!T||!F){k="pfldhid";P+=("<tr><td"+z+"><img src='dttimg/"+k+".gif'></td><td"+(!W?" class='DisPFld'":"")+z+">"+Glb.HTMLEncode(S.ObjName)+"</td><td"+z+">");P+=(Glb.HTMLEncode(S.ObjValue.stringValue())+"</td></tr>");if(!Q.equals("")){P+=("<tr class='TraceToken'><td></td><td>Error</td><td>&nbsp;"+Q+"</td></tr>")}}}}else{if(a==1){k="pfield";if(t>0){k="pfldlook"}if(t==-1){k="pfldstat"}if(!T||!F){k="pfldhid"}P+=("<tr><td><img src='dttimg/"+k+".gif'></td><td"+(!W?" class='DisPFld'":"")+z+">"+Glb.HTMLEncode(S.ObjName)+"</td><td"+z+">");P+=(Glb.HTMLEncode(S.ObjValue.stringValue())+"</td></tr>");if(!Q.equals("")){P+=("<tr class='TraceToken'><td></td><td>Error</td><td>&nbsp;"+Q+"</td></tr>")}}else{k="npf";if(!W){k="dpf"}if(t>0){k="lpf"}if(t==-1){k="spf"}if(!T||!F){k="hpf"}if(G==0){P+="<tr>"}if(O==0){P+=("<td class='"+k+"h'>"+Glb.HTMLEncode(S.ObjName)+"</td>")}else{P+=("<td class='"+k+"' title='"+Q+"'>"+Glb.HTMLEncode(S.ObjValue.stringValue())+"</td>")}G++;if(G==o){G=0;P+="</tr>";if(O==0){aa=true;break}}}}break}if(aa){aa=false;break}}}if(H==0&&a==1){break}if(H==0&&O==1){P+="</table></td></tr>"}if(H==1&&O==0){P+="</div></td></tr>"}O++}return P};DTTItem.prototype.RenderTreeTrace=function(){var a;var c;var e;var j="";var h="";var d;var b;var g="";for(var f=0;f<this.SubItem.length;f++){b=this.SubItem[f];g="";if(b.ForceCbp!=-1){g=" style='background-color:"+this.Colors(b.ForceCbp)+"'"}switch(b.ObjType){case DTTEngine.TRC_TREECAPTION:a=(new IDVariant(b.GetExtToken("E",true))).intValue()!=0;c=(new IDVariant(b.GetExtToken("V",true))).intValue()!=0;if(!c){h="&nbsp;HIDDEN"}else{if(!a){h="&nbsp;DISABLED"}}j+=("<tr><td><img src='dttimg/tree.gif'></td><td"+g+">");j+=(Glb.HTMLEncode(b.ObjValue.stringValue())+"</td><td class='TraceToken'"+g+">"+h+"</td></tr>");break;case DTTEngine.TRC_TREENODE:e=(new IDVariant(b.GetExtToken("L",true))).intValue();d=(new IDVariant(b.GetExtToken("S",true))).intValue();j+=("<tr class='treetrc'><td></td><td "+(d==1?"class='selnode'":"")+g+"><span style='width:"+(16*e)+"'></span>");j+=(Glb.HTMLEncode(b.ObjValue.stringValue())+"</td><td></td></tr>");break}}return j};DTTItem.prototype.RenderCmdTrace=function(){var c;var f;var e="";var b="";var g;var d="";for(var a=0;a<this.SubItem.length;a++){g=this.SubItem[a];d="";if(g.ForceCbp!=-1){d=" style='background-color:"+this.Colors(g.ForceCbp)+"'"}c=(new IDVariant(g.GetExtToken("E",true))).intValue()!=0;f=(new IDVariant(g.GetExtToken("V",true))).intValue()!=0;if(!f){b="HIDDEN"}else{if(!c){b="DISABLED"}}if(!c||!f){switch(g.ObjType){case DTTEngine.TRC_CMDCAPTION:e+=("<tr><td><img src='dttimg/cmdset.gif'></td><td"+d+">");e+=(Glb.HTMLEncode(g.ObjValue.stringValue())+"</td><td class='TraceToken'"+d+">&nbsp;"+b+"</td></tr>");break;case DTTEngine.TRC_CMDCOMMAND:e+=("<tr><td><img src='dttimg/command.gif'></td><td"+d+">");e+=(Glb.HTMLEncode(g.ObjValue.stringValue())+"</td><td class='TraceToken'"+d+">&nbsp;"+b+"</td></tr>");break}}}return e};DTTItem.prototype.GetExtToken=function(b,a){var d;var c=-1;d=this.ObjDescription.indexOf(b+"=");if(d!=-1){if(a){try{c=this.ObjDescription.indexOf(" ",d)}catch(e){c=-1}}if(c==-1){c=this.ObjDescription.length}return this.ObjDescription.substr(d+b.length+1,c-(d+b.length+1))}return""};DTTItem.prototype.Val=function(a){try{return parseint(a,10)}catch(b){return 0}};DTTItem.prototype.SaveToDB=function(f,e,d){if(e.RequestID<1){return}f.SQLItemInsert.ClearParameters();f.SQLItemInsert.AddParameter(new IDVariant(this.IndLevel));f.SQLItemInsert.AddParameter(new IDVariant(this.ItemType));f.SQLItemInsert.AddParameter(new IDVariant(this.MsgType));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjGuid));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjType));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjName.length>250?this.ObjName.substr(0,250):this.ObjName));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjDescription.length>250?this.ObjDescription.substr(0,250):this.ObjDescription));f.SQLItemInsert.AddParameter(new IDVariant(this.ObjValue.ToString().length>250?this.ObjValue.ToString().substr(0,250):this.ObjValue.ToString()));f.SQLItemInsert.AddParameter(new IDVariant(this.RecordCount));f.SQLItemInsert.AddParameter(new IDVariant(this.TickCount));if(d==null){f.SQLItemInsert.AddParameter(new IDVariant())}else{f.SQLItemInsert.AddParameter(new IDVariant(d.ItemID))}f.SQLItemInsert.AddParameter(new IDVariant(e.RequestID));f.DB.ExecuteIDPS(f.SQLItemInsert,false);if(this.SubItem!=null){var a=f.DB.ExecuteIDPS(f.SQLGetItemID,true);if(!a.EOF()){a.MoveFirst()}ItemID=a.Get(1).intValue();var c;for(var b=0;b<this.SubItem.length;b++){c=this.SubItem[b];c.SaveToDB(f,e,this)}}};DTTItem.prototype.LoadFromDB=function(e,d,b,a){this.IndLevel=a.Get(2).intValue();this.ItemType=a.Get(3).intValue();this.MsgType=a.Get(4).intValue();this.ObjGuid=a.Get(5).stringValue();this.ObjType=a.Get(6).intValue();this.ObjName=a.Get(7).stringValue();this.ObjDescription=a.Get(8).stringValue();this.ObjValue=a.Get(9);this.RecordCount=a.Get(10).intValue();this.TickCount=a.Get(11).intValue();e.SQLSubItemLoad.ClearParameters();e.SQLSubItemLoad.AddParameter(new IDVariant(d.ID));e.SQLSubItemLoad.AddParameter(a.Get(1));var f=e.DB.ExecuteIDPS(e.SQLSubItemLoad,true);if(!f.EOF()){f.MoveFirst()}if(f.RecordCount()>0){this.SubItem=new ArrayList();var c;while(!f.EOF()){c=new DTTItem();c.LoadFromDB(e,d,this,f);this.SubItem.Add(c);f.MoveNext()}}};DTTItem.prototype.TakeSnapshot=function(a,d){var e=a.CreateElement("Item");d.AppendChild(e);e.SetAttribute("Level",this.IndLevel+"");e.SetAttribute("Type",this.ItemType+"");e.SetAttribute("MsgType",this.MsgType+"");e.SetAttribute("Guid",this.ObjGuid);e.SetAttribute("ObjType",this.ObjType+"");e.SetAttribute("Name",this.ObjName);e.SetAttribute("Description",this.ObjDescription);e.SetAttribute("Value",this.ObjValue.stringValue());e.SetAttribute("RecordCount",this.RecordCount+"");e.SetAttribute("Elapsed",this.TickCount+"");if(this.HelpItem!=null){this.HelpItem.TakeSnapshot(a,e,"HelpItem")}if(this.SubItem!=null){var c;for(var b=0;b<this.SubItem.length;b++){c=this.SubItem[b];c.TakeSnapshot(a,e)}}};DTTItem.prototype.LoadSnapshot=function(d,b){var e;var c;this.IndLevel=new IDVariant(d.GetAttribute("Level")).intValue();this.ItemType=new IDVariant(d.GetAttribute("Type")).intValue();this.MsgType=new IDVariant(d.GetAttribute("MsgType")).intValue();this.ObjGuid=d.GetAttribute("Guid");this.ObjType=new IDVariant(d.GetAttribute("ObjType")).intValue();this.ObjName=d.GetAttribute("Name");this.ObjDescription=d.GetAttribute("Description");this.ObjValue=new IDVariant(d.GetAttribute("Value"));this.RecordCount=new IDVariant(d.GetAttribute("RecordCount")).intValue();this.TickCount=new IDVariant(d.GetAttribute("Elapsed")).intValue();if(d.ChildNodes.length>0){this.SubItem=new ArrayList();for(var a=0;a<d.ChildNodes.length;a++){e=d.ChildNodes[a];if(e.NodeType==1){if(e.tagName.equals("HelpItem")){this.HelpItem=new DTTHelpItem();this.HelpItem.LoadSnapshot(e)}else{if(e.tagName.equals("Item")){c=new DTTItem();c.LoadSnapshot(e,this);this.SubItem.Add(c)}}}}}};DTTItem.prototype.RenderTestCode=function(c,b){if(this.ItemType!=DTTEngine.IT_TEST){return""}var d="";var a="";if(this.ObjValue.Type!=IDVariant.NULL&&!this.ObjValue.stringValue().equals("")){a="-"+this.ObjValue.stringValue()}switch(this.ObjType){case DTTEngine.TST_APPLOGUP:d=d+"    SetObjectValue('"+this.ObjGuid+"',"+Glb.JSEncode(this.ObjName)+");\r\n";break;case DTTEngine.TST_APPLOGIN:d=d+"    ClickObject('LOGIN');\r\n";break;case DTTEngine.TST_TERM:d=d+"    EndReplay();\r\n";if(c.NextSessionID!=-1){d=d+"    document.getElementById('stepname').innerHTML = 'Loading next test...';\r\n";d=d+"    var NextURL = '"+b.UrlFor(Glb.ITEM_TEST,"CP",true)+"' + RunMode + '"+c.NextSessionID+(c.HelpGenerationActive?"-H":"")+"';\r\n";d=d+"    document.location.assign(NextURL);\r\n"}else{d=d+"    if (ErrorMessages.length == 0) top.window.close();\r\n"}break;case DTTEngine.TST_LOGOFF:d=d+"    ClickObject('LOGOFF');\r\n";break;case DTTEngine.TST_FLDCHG:d=d+"    SetObjectValue("+Glb.JSEncode(this.ObjGuid+a)+","+Glb.JSEncode(this.ObjDescription)+");\r\n";break;default:d=d+"    ClickObject("+Glb.JSEncode(this.ObjGuid+a)+");\r\n";break}return d};DTTItem.prototype.IsPrintable=function(){if(this.ItemType==DTTEngine.IT_ENTERIF||this.ItemType==DTTEngine.IT_NULL||this.ItemType==DTTEngine.IT_TEST){return false}return true};DTTItem.prototype.Equals=function(a){if(this.ItemType!=a.ItemType||!this.ObjGuid.equals(a.ObjGuid)||this.ObjType!=a.ObjType){return false}return true};DTTItem.prototype.IsReallyTheSame=function(a){var d;var c;var h=true;if(this.ItemType==DTTEngine.IT_NULL||a.ItemType==DTTEngine.IT_NULL){return true}if(this.ItemType!=a.ItemType||!this.ObjGuid.equals(a.ObjGuid)||this.ObjType!=a.ObjType){return false}switch(this.ItemType){case DTTEngine.IT_ENTERPROC:case DTTEngine.IT_IF:case DTTEngine.IT_SUBPROC:case DTTEngine.IT_WHILE:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)||this.ObjType!=a.ObjType||(this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType||!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}break;case DTTEngine.IT_ASSIGN:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)||(this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.ItemType==DTTEngine.IT_TOKEN){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}}break;case DTTEngine.IT_EXCEPTION:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)){return false}case DTTEngine.IT_RETURN:if(!this.ObjValue.equals(a.ObjValue)){return false}case DTTEngine.IT_MESSAGE:case DTTEngine.IT_USER:if(!this.ObjName.equals(a.ObjName)||!this.ObjValue.equals(a.ObjValue)){return false}if(this.ObjType!=a.ObjType){return false}if(!this.ObjDescription.equals(a.ObjDescription)){return false}if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.ItemType==DTTEngine.IT_PARAMETER||f.ItemType==DTTEngine.IT_MESSAGE_TK){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}}}break;case DTTEngine.IT_FOREACH:case DTTEngine.IT_QUERY:if(!this.ObjValue.equals(a.ObjValue)){return false}if(this.ObjType!=a.ObjType){return false}if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(d=0;d<this.SubItem.Count();d++){var f=this.SubItem[d];var e=a.SubItem[d];if(f.ItemType!=e.ItemType){f.ForceCbp=1;e.ForceCbp=1;h=false}if(this.ItemType==DTTEngine.IT_FOREACH&&d==0){if(!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_ENDQUERY){if(!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_PARAMETER){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_TOKEN){if(!f.ObjName.equals(e.ObjName)||!f.ObjValue.equals(e.ObjValue)){f.ForceCbp=1;e.ForceCbp=1;h=false}}if(f.ItemType==DTTEngine.IT_IMDBDATASRC||f.ItemType==DTTEngine.IT_DBDATASRC){if(!f.ObjValue.equals(e.ObjValue)||(f.SubItem==null)!=(e.SubItem==null)){f.ForceCbp=1;e.ForceCbp=1;h=false}if(f.SubItem!=null){if(f.SubItem.Count()!=e.SubItem.Count()){f.ForceCbp=1;e.ForceCbp=1;return false}for(c=0;c<f.SubItem.Count();c++){var g=f.SubItem[c];var b=e.SubItem[c];if(!g.ObjValue.equals(b.ObjValue)){g.ForceCbp=1;b.ForceCbp=1;h=false}}}}}}break;case DTTEngine.IT_TRACE:if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){switch(this.ObjType){case DTTEngine.TRC_ITMAIN:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITFORM:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITPANEL:if(!this.IsReallyTheSamePanel(a)){return false}break;case DTTEngine.TRC_ITTREE:if(!this.IsReallyTheSameTree(a)){return false}break;case DTTEngine.TRC_ITTABBED:if(!this.IsReallyTheSameGen(a)){return false}break;case DTTEngine.TRC_ITMENU:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITTOOLBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITBUTBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITCAPTBAR:if(!this.IsReallyTheSameCmd(a)){return false}break;case DTTEngine.TRC_ITERROR:if(!this.IsReallyTheSameGen(a)){return false}break}}break}return h};DTTItem.prototype.IsReallyTheSameGen=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(d.ObjType!=c.ObjType){d.ForceCbp=1;c.ForceCbp=1;e=false}switch(d.ObjType){case DTTEngine.TRC_MAINCAPTION:case DTTEngine.TRC_FORMCAPTION:case DTTEngine.TRC_FRAMECAPTION:case DTTEngine.TRC_TABCAPTION:if(!d.ObjName.equals(c.ObjName)||!d.ObjValue.equals(c.ObjValue)||!d.ObjDescription.equals(c.ObjDescription)){d.ForceCbp=1;c.ForceCbp=1;e=false}break;case DTTEngine.TRC_MAININDIC:case DTTEngine.TRC_FORMINDIC:case DTTEngine.TRC_FORMMESSAGE:case DTTEngine.TRC_ERRNUMBER:case DTTEngine.TRC_ERRDESCR:if(!d.ObjName.equals(c.ObjName)||!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}break}}}return e};DTTItem.prototype.IsReallyTheSameTree=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count()){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(d.ObjType!=c.ObjType){d.ForceCbp=1;c.ForceCbp=1;e=false}switch(d.ObjType){case DTTEngine.TRC_TREECAPTION:if(!d.ObjDescription.equals(c.ObjDescription)){d.ForceCbp=1;c.ForceCbp=1;e=false}break;case DTTEngine.TRC_TREENODE:if(!d.ObjDescription.equals(c.ObjDescription)||!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}break}}}return e};DTTItem.prototype.IsReallyTheSameCmd=function(a){var b;var e=true;if((this.SubItem==null)!=(a.SubItem==null)){return false}if(this.SubItem!=null){if(this.SubItem.Count()!=a.SubItem.Count){return false}for(b=0;b<this.SubItem.Count();b++){var d=this.SubItem[b];var c=a.SubItem[b];if(!d.ObjDescription.equals(c.ObjDescription)||d.ObjType!=c.ObjType||d.ObjType==DTTEngine.TRC_CMDCAPTION||d.ObjType==DTTEngine.TRC_CMDCOMMAND){if(!d.ObjValue.equals(c.ObjValue)){d.ForceCbp=1;c.ForceCbp=1;e=false}}}}return e};DTTItem.prototype.IsReallyTheSamePanel=function(k){var f;var c;var g=new Array(2);var a=new Array(2);var b=new Array(2);var e=new Array(2);var j=new Array(2);c=true;if((this.SubItem==null)!=(k.SubItem==null)){return false}if(this.SubItem!=null){g[0]=-1;g[1]=-1;if(this.SubItem.Count()!=k.SubItem.Count()){return false}for(f=0;f<this.SubItem.Count();f++){var d=this.SubItem[f];var h=k.SubItem[f];if(d.ObjType!=h.ObjType){d.ForceCbp=1;h.ForceCbp=1;c=false}switch(d.ObjType){case DTTEngine.TRC_PANCAPTION:if(!d.ObjDescription.equals(h.ObjDescription)||!d.ObjValue.equals(h.ObjValue)){d.ForceCbp=1;h.ForceCbp=1;c=false}break;case DTTEngine.TRC_PANFLDVALUE:a[0]=(new IDVariant(d.GetExtToken("E",true))).intValue()!=0;b[0]=(new IDVariant(d.GetExtToken("V",true))).intValue()!=0;e[0]=(new IDVariant(d.GetExtToken("P",true))).intValue()!=0;j[0]=(new IDVariant(d.GetExtToken("VS",true))).intValue();if(g[0]==-1){if(d.ObjDescription.indexOf("X=")!=-1){g[0]=1}else{g[0]=0}}a[1]=(new IDVariant(h.GetExtToken("E",true))).intValue()!=0;b[1]=(new IDVariant(h.GetExtToken("V",true))).intValue()!=0;e[1]=(new IDVariant(h.GetExtToken("P",true))).intValue()!=0;j[1]=(new IDVariant(h.GetExtToken("VS",true))).intValue();if(g[1]==-1){if(h.ObjDescription.indexOf("X=")!=-1){g[1]=1}else{g[1]=0}}if(!d.ObjName.equals(h.ObjName)||!d.ObjValue.equals(h.ObjValue)||g[0]!=g[1]||a[0]!=a[1]||b[0]!=b[1]||e[0]!=e[1]||j[0]!=j[1]){d.ForceCbp=1;h.ForceCbp=1;c=false}break}}}return c};DTTItem.prototype.DumpGUIDsToFile=function(a){};DTTItem.prototype.Colors=function(a){switch(a){case 1:return"yellow";case 2:return"lightgreen";case 3:return"orange";case 4:return"lightblue";case 5:return"pink";case 6:return"#FF4040";case 7:return"#CC6600";case 8:return"#D0D0D0"}return""};DTTItem.prototype.RenderProc=function(b,a){b.WriteStrDbgReqPrc("<tr><td class='ProcItem' title='"+Glb.HTMLEncode(this.ObjDescription)+"'>");b.WriteStrDbgReqPrc("<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"COL"+this.ObjGuid+a)+"'><img align='absmiddle' alt='Collect debug data?' src='dttimg/"+(this.Collect?"myes":"mno")+".gif'></a>&nbsp;");b.WriteStrDbgReqPrc("<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"VIS"+this.ObjGuid+a)+";parent.ReqRef.resendLastEvent(\"ReqRef\");'><img align='absmiddle' alt='Show debug data?' src='dttimg/"+(this.Visible?"myes":"mno")+".gif'></a>&nbsp;");b.WriteStrDbgReqPrc("<img align='absmiddle' style='cursor:hand' onclick='findit(\"proc"+this.ObjGuid+"\")' src='dttimg/"+this.GetObjIcon()+"'>&nbsp;"+Glb.HTMLEncode(this.ObjValue+"."+this.ObjName));b.WriteStrDbgReqPrc("</td><td class=ProcTime>"+this.TotalNetTickCount+"</td><td class=ProcTime>"+this.TotalTickCount+"</td><td class=ProcTime>"+this.RecordCount+"</td><td class=ProcTool>&nbsp;</td></tr>")};DTTItem.prototype.GetItemClass=function(){switch(this.ItemType){case DTTEngine.IT_MESSAGE:return"ItemMsg";case DTTEngine.IT_QUERY:return"ItemQry";case DTTEngine.IT_USER:return"ItemUser";default:return"ItemList"}};DTTItem.prototype.SaveToFile=function(c,a,b){};function DTTRequest(){this.Items=new ArrayList();this.StackTrace=new ArrayList();this.Procs=new HashTableSrv();this.ID;this.Name;this.Description;this.State;this.Condition;this.HelpHTML;this.HelpHide=false;this.HelpItem;this.HelpVerItem;this.StartTime;this.StartTicks;this.ElapsedTime;this.NamePriority;this.Matches=DTTRequest.REQ_MATCHES;this.RequestID;this.iHasBP=-1;this.MaxIndLevel;this.ProcsScanned=false}DTTRequest.PRI_NONE=0;DTTRequest.PRI_ITEM=10;DTTRequest.PRI_DATA=30;DTTRequest.PRI_CMD=50;DTTRequest.REQ_MATCHES=0;DTTRequest.REQ_DIFFERS=1;DTTRequest.REQ_MISSING=2;DTTRequest.REQ_ACTIVE=1;DTTRequest.REQ_PASSIVE=2;DTTRequest.prototype.RenderCaption=function(b,a,d){var c;b.WriteStrDbgReqTop("</head>");if(a){b.WriteStrDbgReqTop("<body onload='refreshdetails(); ItemsCount="+this.Items.Count()+";'>")}else{b.WriteStrDbgReqTop("<body onload='ItemsCount="+this.Items.Count()+"'>")}b.WriteStrDbgReqTop("<table class='ReqHdr'><tr><td>Request ID: "+this.ID+" - Name: "+Glb.HTMLEncode(this.Name,false,true)+" - Elapsed: "+this.ElapsedTime+"ms</td><td>");if(this.State<=DTTEngine.DTTMSG_WARN){b.WriteStrDbgReqTop("<a href='javascript:findit(\"warn\")'><img title='Find the warning' src='dttimg/twarn.gif'></a>&nbsp;");if(this.State==DTTEngine.DTTMSG_ERROR){b.WriteStrDbgReqTop("<a href='javascript:findit(\"stop\")'><img title='Find the error' src='dttimg/tstop.gif'></a>&nbsp;")}}if(b.DTTObj.BreakPoints.Count()>0){b.WriteStrDbgReqTop("<a href='javascript:findit(\"brkpt\")'><img title='Find the next breakpoint' src='dttimg/command.gif'></a>&nbsp;")}if(d){b.WriteStrDbgReqTop('<a href="javascript:rotateView()"><img title="Rotate frames" src="dttimg/rotate.gif"></a>&nbsp;')}b.WriteStrDbgReqTop("<a href='javascript:showall(\"block\")'><img title='Show all notes' src='dttimg/showall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:showall(\"none\")'><img title='Hide all notes' src='dttimg/hideall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:expall(true)'><img title='Expand all blocks' src='dttimg/expall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;<a href='javascript:expall(false)'><img title='Compress all blocks' src='dttimg/cmpall.gif'></a>");b.WriteStrDbgReqTop("&nbsp;&nbsp;<a href='javascript:"+b.UrlForDTT(Glb.ITEM_DTT,"RECUR")+"'><img title='"+(b.DTTObj.ShowRecurr?"Hide":"Show")+" recurrent events' src='dttimg/trecur"+(b.DTTObj.ShowRecurr?"h":"")+".gif'></a>");b.WriteStrDbgReqTop("</td><td><form class='DttFlt' >");b.WriteStrDbgReqTop("<select class='DttFlt' title='Filter Messages' onchange='"+b.UrlForDTT(Glb.ITEM_DTT,"FORM","FLTMSG","this.value","",false)+"' name='FLTMSG'>");for(c=0;c<=b.DTTObj.MsgLevel;c++){b.WriteStrDbgReqTop("<option value='"+c+"'"+(b.DTTObj.ShowMsgLevel==c?" selected>":">"));switch(c){case 0:b.WriteStrDbgReqTop("None");break;case 1:b.WriteStrDbgReqTop("Error");break;case 2:b.WriteStrDbgReqTop("Warning");break;case 3:b.WriteStrDbgReqTop("Info");break;case 4:b.WriteStrDbgReqTop("Verbose");break}}b.WriteStrDbgReqTop("</select>&nbsp;");b.WriteStrDbgReqTop("<select class='DttFlt' title='Filter Items' onchange='"+b.UrlForDTT(Glb.ITEM_DTT,"FORM","FLTIT","this.value","",false)+"' name='FLTIT'>");for(c=0;c<=b.DTTObj.Level;c++){b.WriteStrDbgReqTop("<option value='"+c+"'"+(b.DTTObj.ShowLevel==c?" selected>":">"));switch(c){case 0:b.WriteStrDbgReqTop("None");break;case 1:b.WriteStrDbgReqTop("Exceptions");break;case 2:b.WriteStrDbgReqTop("Procedures");break;case 3:b.WriteStrDbgReqTop("Ctrl Blocks");break;case 4:b.WriteStrDbgReqTop("Queries");break;case 5:b.WriteStrDbgReqTop("Statements");break}}b.WriteStrDbgReqTop("</select>&nbsp;");b.WriteStrDbgReqTop("</form></td></tr></table></body></html>")};DTTRequest.prototype.Render=function(m,z,s,o){var y=0;var B=0;var g=null;var p=null;var v=null;var q=0;var d=new IDVariant("");var k=new IDVariant(0);var r=false;var b=false;var a=0;var l="";var e=null;var u=0;var x=0;if(o==null){m.WriteStrDbgReqRef("<body style='overflow:hidden;'>")}else{m.WriteStrDbgReqRef("<body onscroll='javascript:onBodyScroll()'>")}m.WriteStrDbgReqRef("<div style='overflow:scroll; width:"+(m.DTTObj.IsTouch()?"700px":"100%")+"; height:100%'>");q=16;y=0;if(this.MaxIndLevel>20){q=8}if(this.MaxIndLevel>40){q=4}if(this.MaxIndLevel>80){q=3}if(this.MaxIndLevel>120){q=2}if(this.MaxIndLevel>200){q=1}l="";for(var C=0;C<this.Items.Count();C++){g=this.Items[C];B++;b=false;if(g.ItemType!=DTTEngine.IT_TRACE){if(g.ItemType==DTTEngine.IT_MESSAGE||g.ItemType==DTTEngine.IT_USER){if(g.MsgType>m.DTTObj.ShowMsgLevel){b=true}if(m.DTTObj.IsMsgHidden(g.ObjType)){b=true}}else{if(g.Level()>m.DTTObj.ShowLevel){b=true}}if(g.ItemType==DTTEngine.IT_TEST){b=true}}if(g.ItemType==DTTEngine.IT_NULL){var f=g.ObjValue.Value;if(f.ItemType!=DTTEngine.IT_TRACE){if(f.ItemType==DTTEngine.IT_MESSAGE||f.ItemType==DTTEngine.IT_USER){if(f.MsgType>m.DTTObj.ShowMsgLevel){b=true}if(m.DTTObj.IsMsgHidden(f.ObjType)){b=true}}else{if(f.Level()>m.DTTObj.ShowLevel){b=true}}}if(f.ItemType==DTTEngine.IT_TEST){b=true}}if(!b&&!m.DTTObj.ShowRecurr){if(!l.equals("")){if(g.ItemType==DTTEngine.IT_EXITPROC&&g.ObjGuid.equals(l)&&g.ObjType==DTTEngine.PT_EVENT_RECUR){l=""}b=true}else{if(g.ItemType==DTTEngine.IT_ENTERPROC&&g.ObjType==DTTEngine.PT_EVENT_RECUR){l=g.ObjGuid;b=true}}}if(!b){if(v!=null&&!g.Visible&&v.Visible){}b=!g.Visible}if(!b){y++;r=false;a=g.ForceCbp;if(g.ItemType==DTTEngine.IT_NULL&&g.IndLevel!=-999){g=g.ObjValue.Value;a=g.ForceCbp;g.ForceCbp=-1;r=true}if(g.ItemType==DTTEngine.IT_IF){if(this.Items[C+1]!=undefined){e=this.Items[C+1]}else{e=null}}else{e=null}u=g.Render(m,s,y,q,d,z,k,r,v,e,u);if(g.ItemType==DTTEngine.IT_ENDIF||g.ItemType==DTTEngine.IT_EXITPROC||g.ItemType==DTTEngine.IT_BREAK||g.ItemType==DTTEngine.IT_CONTINUE){var t=null;for(var h=0;h<this.Items.Count();h++){p=this.Items[h];if(g.ItemType==DTTEngine.IT_ENDIF&&p.ItemType==DTTEngine.IT_IF&&p.ObjGuid.equals(g.ObjGuid)&&p.IndLevel==g.IndLevel){t=p}if(g.ItemType==DTTEngine.IT_EXITPROC&&p.ItemType==DTTEngine.IT_ENTERPROC&&p.ObjGuid.equals(g.ObjGuid)&&p.IndLevel<=g.IndLevel){t=p}if(g.ItemType==DTTEngine.IT_BREAK&&(p.ItemType==DTTEngine.IT_FOREACH||p.ItemType==DTTEngine.IT_WHILE||p.ItemType==DTTEngine.IT_FORI||p.ItemType==DTTEngine.IT_SWITCH)&&p.IndLevel<g.IndLevel){t=p}if(g.ItemType==DTTEngine.IT_CONTINUE&&(p.ItemType==DTTEngine.IT_FOREACH||p.ItemType==DTTEngine.IT_WHILE||p.ItemType==DTTEngine.IT_FORI)&&p.IndLevel<g.IndLevel){t=p}if(p==g){break}}if(t!=null){var A=u-1-(g.ItemType==DTTEngine.IT_BREAK||g.ItemType==DTTEngine.IT_CONTINUE?1:0);for(x=t.NumOpenDiv;x<=A;x++){m.WriteStrDbgReqRef("</div>");u=u-1}}}if(g.ItemType==DTTEngine.IT_ENDFOREACH||g.ItemType==DTTEngine.IT_ENDWHILE||g.ItemType==DTTEngine.IT_ENDFORI||g.ItemType==DTTEngine.IT_ENDSWITCH){m.WriteStrDbgReqRef("</div>");u=u-1}g.ForceCbp=a}v=g}m.WriteStrDbgReqRef("</div>");m.WriteStrDbgReqRef("</body></html>")};DTTRequest.prototype.GetTickCount=function(){return new Date().getTime()};DTTRequest.prototype.InitRequest=function(a){this.ID=a;this.Name="Request "+this.ID;this.StartTime=new Date();this.StartTicks=this.GetTickCount();this.NamePriority=DTTRequest.PRI_NONE;this.Condition=DTTRequest.REQ_ACTIVE;this.State=DTTEngine.DTTMSG_INFO};DTTRequest.prototype.EndRequest=function(){this.ElapsedTime=this.GetTickCount()-this.StartTicks;var b=new ArrayList();var c;for(var a=0;a<this.Items.Count();a++){c=this.Items[a];if(c.IndLevel>this.MaxIndLevel){this.MaxIndLevel=c.IndLevel}if(c.MsgType<this.State){this.State=c.MsgType}b.Insert(0,c)}this.Items=b};DTTRequest.prototype.SetName=function(c,b,a){if(a<=this.NamePriority){return}this.Name=c;this.Description=b;this.NamePriority=a};DTTRequest.prototype.Add=function(a){this.Items.Insert(0,a);if(a.MsgType<this.State){this.State=a.MsgType}};DTTRequest.prototype.EnterProc=function(a,b){this.StackTrace.Insert(0,a);var d=0;for(var c=0;c<this.StackTrace.length;c++){if(this.StackTrace[c].equals(a)){d++}}if(b.MaxStackLoops>0&&d>b.MaxStackLoops){return false}else{return true}};DTTRequest.prototype.ExitProc=function(a){for(var b=0;b<this.StackTrace.length;b++){if(this.StackTrace[b].equals(a)){this.StackTrace.Remove(a);return}}WriteToConsoleError("DTTRequest.ExitProc: Guid "+a+" not found!!!")};DTTRequest.prototype.GetIcon=function(a){if(a==undefined){a=0}if(this.Items.length==0){return"empty.gif"}switch(this.State){case DTTEngine.DTTMSG_INFO:return"info.gif";case DTTEngine.DTTMSG_ERROR:return"stop.gif";case DTTEngine.DTTMSG_WARN:return"warn.gif"}return""};DTTRequest.prototype.SaveToDB=function(c){if(c.SessionID<1){return}c.SQLReqInsert.ClearParameters();c.SQLReqInsert.AddParameter(new IDVariant(this.Name));c.SQLReqInsert.AddParameter(new IDVariant(this.Description));c.SQLReqInsert.AddParameter(new IDVariant(this.State));c.SQLReqInsert.AddParameter(new IDVariant(this.StartTime));c.SQLReqInsert.AddParameter(new IDVariant(this.ElapsedTime));c.SQLReqInsert.AddParameter(new IDVariant(c.SessionID));c.DB.ExecuteIDPS(c.SQLReqInsert,false);var a=c.DB.ExecuteIDPS(c.SQLGetReqID,true);if(!a.EOF()){a.MoveFirst()}this.RequestID=a.Get(1).intValue();var d;for(var b=0;b<this.Items.length;b++){d=this.Items[b];d.SaveToDB(c,this,null)}};DTTRequest.prototype.LoadFromDB=function(d,b){this.ID=b.Get(1).intValue();this.Name=b.Get(2).stringValue();this.Description=b.Get(3).stringValue();this.State=b.Get(4).intValue();this.StartTime=b.Get(5).dateValue();this.ElapsedTime=b.Get(6).intValue();d.SQLItemLoad.ClearParameters();d.SQLItemLoad.AddParameter(new IDVariant(this.ID));var f=d.DB.ExecuteIDPS(d.SQLItemLoad,true);if(!f.EOF()){f.MoveFirst()}if(f.RecordCount()>0){var e;while(!f.EOF()){e=new DTTItem();e.LoadFromDB(d,this,null,f);this.Items.Add(e);f.MoveNext()}}var a;this.MaxIndLevel=0;for(var c=0;c<this.Items.length;c++){a=this.Items[c];if(a.IndLevel>this.MaxIndLevel){this.MaxIndLevel=a.IndLevel}}};DTTRequest.prototype.TakeSnapshot=function(a,d){var e=a.CreateElement("Request");d.AppendChild(e);e.SetAttribute("Name",this.Name);e.SetAttribute("Description",this.Description);e.SetAttribute("State",this.State+"");e.SetAttribute("StartTime",this.DateToStr(this.StartTime));e.SetAttribute("ElapsedTime",this.ElapsedTime+"");e.SetAttribute("HelpHTML",this.HelpHTML);e.SetAttribute("HelpHide",this.HelpHide+"");if(this.HelpItem!=null){this.HelpItem.TakeSnapshot(a,e,"HelpItem");this.HelpVerItem.TakeSnapshot(a,e,"HelpVerifyItem")}var b;for(var c=0;c<this.Items.length;c++){b=this.Items[c];b.TakeSnapshot(a,e)}};DTTRequest.prototype.LoadSnapshot=function(d){var e;var b;this.Name=d.GetAttribute("Name");this.Description=d.GetAttribute("Description");this.State=new IDVariant(d.GetAttribute("State")).intValue();this.StartTime=StrToDate(d.GetAttribute("StartTime"));this.ElapsedTime=new IDVariant(d.GetAttribute("ElapsedTime")).intValue();this.HelpHTML=new IDVariant(d.GetAttribute("HelpHTML")).stringValue();this.HelpHide=(new IDVariant(d.GetAttribute("HelpHide")).intValue()!=0);if(d.ChildNodes.length>0){for(var a=0;a<d.ChildNodes.length;a++){e=d.ChildNodes[a];if(e.NodeType==3){if(e.tagName.equals("HelpItem")){this.HelpItem=new DTTHelpItem();this.HelpItem.LoadSnapshot(e)}else{if(e.tagName.equals("HelpVerifyItem")){this.HelpVerItem=new DTTHelpItem();this.HelpVerItem.LoadSnapshot(e)}else{if(e.tagName.equals("Item")){b=new DTTItem();b.LoadSnapshot(e,null);this.Items.Add(b)}}}}}}this.MaxIndLevel=0;for(var c=0;c<this.Items.length;c++){b=this.Items[c];if(b.IndLevel>this.MaxIndLevel){this.MaxIndLevel=b.IndLevel}}};DTTRequest.prototype.RenderTestCode=function(c,a){var e;var d="";var b=false;for(var f=0;f<this.Items.length;f++){e=this.Items[f];d=d+e.RenderTestCode(c,a);if(e.ItemType==DTTEngine.IT_TEST&&e.ObjType!=DTTEngine.TST_FLDCHG){b=true}}if(!b&&this.ID>1){d=d+"    ClickObjectByName('refx');\r\n"}return d};DTTRequest.prototype.CheckDiff=function(b){var e;var q;var f;var d;var c;var p;var m=0;var h=0;var l=this.GetDiffVector(b);for(var a=0;a<l.length;a++){p=l[a];f=(p.intValue()/1000000)+m;d=(p.intValue()%1000000)+h;if(f!=d){if(f>d){for(c=d;c<=f-1;c++){var g=this.Items[c];e=new DTTItem();e.ItemType=DTTEngine.IT_NULL;e.MsgType=DTTEngine.DTTMSG_WARN;e.ObjGuid=g.ObjGuid;if(!g.IsPrintable()){e.IndLevel=-999}else{if(g.ItemType==DTTEngine.IT_ENTERPROC&&g.IndLevel==1){e.IndLevel=-1}}e.ObjValue.Type=IDVariant.BLOB;e.ObjValue.Value=g;b.Items.Insert(c,e);this.Matches=DTTRequest.REQ_MISSING;g.ForceCbp=6}h=h+f-d}else{for(c=f;c<=d-1;c++){var o=b.Items[c];e=new DTTItem();e.ItemType=DTTEngine.IT_NULL;e.MsgType=DTTEngine.DTTMSG_WARN;e.ObjGuid=o.ObjGuid;if(!o.IsPrintable()){e.IndLevel=-999}else{if(o.ItemType==DTTEngine.IT_ENTERPROC&&o.IndLevel==1){e.IndLevel=-1}}e.ObjValue.Type=IDVariant.BLOB;e.ObjValue.Value=o;Items.Insert(c,e);this.Matches=DTTRequest.REQ_MISSING;o.ForceCbp=6}m=m+d-f}}else{e=this.Items[f];q=b.Items[d];if(!e.IsReallyTheSame(q)){e.ForceCbp=1;q.ForceCbp=1;if(this.Matches==DTTRequest.REQ_MATCHES){this.Matches=DTTRequest.REQ_DIFFERS}}}}};DTTRequest.prototype.GetDiffVector=function(a){var c;var b;var h;var e;var k;c=this.Items.Count();b=a.Items.Count();k=new Array(c+1);for(var d=0;d<c+1;d++){k[d]=new Array(b+1)}for(h=c-1;h>=0;h--){for(e=b-1;e>=0;e--){var g=this.Items[h];var l=a.Items[e];if(g.equals(l)){k[h][e]=1+k[h+1][e+1]}else{k[h][e]=(k[h+1][e]>k[h][e+1]?k[h+1][e]:k[h][e+1])}}}var f=new ArrayList();h=0;e=0;while(h<c&&e<b){var g=this.Items[h];var l=a.Items[e];if(g.equals(l)){f.Add(new IDVariant(h*1000000+e));h++;e++}else{if(k[h+1][e]>=k[h][e+1]){h++}else{e++}}}return f};DTTRequest.prototype.DumpGUIDsToFile=function(c){var a;for(var b=0;b<this.Items.length;b++){a=this.Items[b];a.DumpGUIDsToFile(c)}};DTTRequest.DateToStr=function(b){var a=IDL.FormatDate(b,"dd-MM-yyyy HH:mm:ss:FFF");if(a.length>11&&a.substr(11).equals("00:00:00")){a=a.substr(0,10)}return a};DTTRequest.StrToDate=function(c){var b;try{b=new Date(Date.parse(c))}catch(a){WriteToConsoleError("DTTRequest::StrToDate("+c+") can't convert to Date");b=new Date(0)}return b};DTTRequest.prototype.ExpandItem=function(h,g,a){var e=0;var j=0;var d=0;for(var b=0;b<this.Items.length;b++){var f=this.Items[b];j++;if(j==e){d=f.IndLevel}if(j>e){if(f.IndLevel==d){break}if(a||f.IndLevel==d+(f.ItemType==DTTEngine.IT_ENTERELSE?2:1)||!g){f.Visible=g}}}};DTTRequest.prototype.ScanProcs=function(j){var c=new ArrayList();var h=0;if(!this.ProcsScanned){this.ProcsScanned=true;for(var f=0;f<this.Items.length;f++){var e=this.Items[f];if(e.ItemType==DTTEngine.IT_ENTERPROC){var a=this.Procs[e.ObjGuid];if(a==null){a=new DTTItem();a.ItemType=DTTEngine.IT_ENTERPROC;a.ObjGuid=e.ObjGuid;a.ObjName=e.ObjName;a.ObjValue=e.ObjValue;a.ObjType=(e.ObjType==DTTEngine.PT_PROCEDURE?DTTEngine.PT_PROC_ITEM:e.ObjType);a.ObjDescription=e.ObjDescription;a.TickCount=e.TickCount;a.NetTickCount=e.TickCount;a.RecordCount=1;a.ItemID=h++;var d=j[e.ObjGuid];if(d==null){a.Visible=true;a.Collect=true}else{a.Visible=d.Visible;a.Collect=d.Collect}this.Procs[a.ObjGuid]=a}else{a.RecordCount++;if(a.TickCount==0){a.TickCount=e.TickCount}a.NetTickCount=e.TickCount}if(c.Count()>0){var g=c[c.Count()-1];g.TotalNetTickCount=g.TotalNetTickCount+(e.TickCount-g.NetTickCount);g.NetTickCount=0}c.Add(a)}if(e.ItemType==DTTEngine.IT_EXITPROC){var a=this.Procs[e.ObjGuid];if(a!=null){a.TotalTickCount=a.TotalTickCount+e.TickCount-a.TickCount;a.TickCount=0;a.TotalNetTickCount=a.TotalNetTickCount+(e.TickCount-a.NetTickCount)}while(c.Count()>0){var b;b=c[c.Count()-1];c.RemoveAt(c.Count()-1);var g=b;if(g.ObjGuid.equals(e.ObjGuid)){if(c.Count()>0){g=c[c.Count()-1];g.NetTickCount=e.TickCount}break}}}}}};DTTRequest.prototype.RenderProcs=function(a,b){this.ScanProcs(b);a.WriteStrDbgReqPrc("<table cellspacing=0 cellpadding=0 class='ProcTable'>");a.WriteStrDbgReqPrc("<tr><td class='ProcHdr'>Method Name</td><td class='ProcHdr' style='text-align:right'>Time</td>");a.WriteStrDbgReqPrc("<td class='ProcHdr' style='text-align:right'>Time Total</td><td class='ProcHdr' style='text-align:right'>Call Count</td>");a.WriteStrDbgReqPrc("<td class='ProcHdr' style='text-align:center'><a href='javascript:"+a.UrlForDTT(Glb.ITEM_DTT,"RESPRC"+this.ID)+"'><img alt='WARNING: Click to reset all methods status!' src='dttimg/mno.gif' border=0></a></td></tr>");var g=this.Procs.values();var e=0;while(e<this.Procs.count()){for(var d=0;d<g.length;d++){var f=g[d];if(f.ItemID==e){f.RenderProc(a,this.ID);break}}e++}};DTTRequest.prototype.ProcCommand=function(f,r){var m=f.substr(0,3);var k=f.substr(3,36);var a=this.Procs[k];if(a!=null){if(m.equals("VIS")){a.Visible=!a.Visible;var o=true;var l=false;var q=0;for(var j=0;j<this.Items.length;j++){var h=this.Items[j];if(o){if(h.ItemType==DTTEngine.IT_ENTERPROC||h.ItemType==DTTEngine.IT_EXITPROC){var d=r[h.ObjGuid];if(d!=null){if(!d.Visible){o=false;q=h.IndLevel;l=true}}}}else{if(h.IndLevel<=q){o=true}}h.Visible=o||l;l=false}}if(m.equals("COL")){a.Collect=!a.Collect}}};DTTRequest.prototype.HasBP=function(a,d){if(d==undefined){d=false}if(this.iHasBP==-1||d){for(var b=0;b<this.Items.length;b++){var c=this.Items[b];if(c.FindBP(a,c)!=0){this.iHasBP=1;return true}}this.iHasBP=0}return(this.iHasBP==0?false:true)};DTTRequest.prototype.ProcSize=function(a){var b;this.ScanProcs(a);b=this.Procs.count()*20+32;if(b>300){b=300}return b};DTTRequest.prototype.SaveToFile=function(a,b){};function GUID(){this.iGuid=this.NewGuid()}GUID.prototype.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d=="x"?b:(b&3|8);return a.toString(16)})};GUID.prototype.ToString=function(){return this.iGuid.toUpperCase()};GUID.prototype.toAscii85=function(){return GUID.GUID2DocID(this.iGuid)};GUID.encode85=function(d,e,c){var b=3+c*4;var a=(d[b]<0?d[b]+256:d[b])*16777216;b--;a+=(d[b]<0?d[b]+256:d[b])*65536;b--;a+=(d[b]<0?d[b]+256:d[b])*256;b--;a+=(d[b]<0?d[b]+256:d[b]);e[4+c*5]=String.fromCharCode((a/52200625)+40);a=a%52200625;e[3+c*5]=String.fromCharCode((a/614125)+40);a=a%614125;e[2+c*5]=String.fromCharCode((a/7225)+40);a=a%7225;e[1+c*5]=String.fromCharCode((a/85)+40);a=a%85;e[0+c*5]=String.fromCharCode((a)+40)};GUID.decode85=function(d,e,c){var b=4+c*5;var a=(d[b].charCodeAt(0)-40)*52200625;b--;a+=(d[b].charCodeAt(0)-40)*614125;b--;a+=(d[b].charCodeAt(0)-40)*7225;b--;a+=(d[b].charCodeAt(0)-40)*85;b--;a+=(d[b].charCodeAt(0)-40)*1;b--;e[3+c*4]=(a/16777216)&255;a=a%16777216;e[2+c*4]=(a/65536)&255;a=a%65536;e[1+c*4]=(a/256)&255;a=a%256;e[0+c*4]=(a)&255};GUID.HexFull=function(d,b){var c=d.toString(16).toUpperCase();for(var a=c.length;a<b;a++){c=c.insert(0,"0")}return c};GUID.GUID2Str=function(a){var f;var c;var b;var g;var e;var d=new Array(8);b=(a[0]<0?a[0]+256:a[0])+(a[1]<0?a[1]+256:a[1])*256;c=(a[2]<0?a[2]+256:a[2])+(a[3]<0?a[3]+256:a[3])*256;g=(a[4]<0?a[4]+256:a[4])+(a[5]<0?a[5]+256:a[5])*256;e=(a[6]<0?a[6]+256:a[6])+(a[7]<0?a[7]+256:a[7])*256;for(f=0;f<8;f++){d[f]=a[8+f]}var h="";h=h+GUID.HexFull(c,4);h=h+GUID.HexFull(b,4);h=h+"-";h=h+GUID.HexFull(g,4);h=h+"-";h=h+GUID.HexFull(e,4);h=h+"-";for(f=0;f<8;f++){h=h+GUID.HexFull((d[f]<0?d[f]+256:d[f]),2);if(f==1){h=h+"-"}}return h};GUID.GUID2DocID=function(c){var a=new Array(16);var d=new Array(20);a[0]=parseInt(c.substr(6,2),16);a[1]=parseInt(c.substr(4,2),16);a[2]=parseInt(c.substr(2,2),16);a[3]=parseInt(c.substr(0,2),16);a[4]=parseInt(c.substr(11,2),16);a[5]=parseInt(c.substr(9,2),16);a[6]=parseInt(c.substr(16,2),16);a[7]=parseInt(c.substr(14,2),16);a[8]=parseInt(c.substr(19,2),16);a[9]=parseInt(c.substr(21,2),16);a[10]=parseInt(c.substr(24,2),16);a[11]=parseInt(c.substr(26,2),16);a[12]=parseInt(c.substr(28,2),16);a[13]=parseInt(c.substr(30,2),16);a[14]=parseInt(c.substr(32,2),16);a[15]=parseInt(c.substr(34,2),16);GUID.encode85(a,d,0);GUID.encode85(a,d,1);GUID.encode85(a,d,2);GUID.encode85(a,d,3);var b=d.join("");return b};GUID.DocID2GUID=function(d){var a=new Array(20);var b=new Array(16);for(var c=0;c<20;c++){a[c]=d.charAt(c)}GUID.decode85(a,b,0);GUID.decode85(a,b,1);GUID.decode85(a,b,2);GUID.decode85(a,b,3);return GUID.GUID2Str(b)};function HashTableSrv(){Object.call(this)}HashTableSrv.prototype.count=function(){return Object.keys(this).length};HashTableSrv.prototype.add=function(a,b){this[a.toString()]=b};HashTableSrv.prototype.remove=function(a){delete this[a.toString()]};HashTableSrv.prototype.clear=function(){var b=Object.keys(this);for(var a=0;a<b.length;a++){delete this[b[a]]}};HashTableSrv.prototype.keys=function(){return Object.keys(this)};HashTableSrv.prototype.values=function(){var a=new Array();var c=Object.keys(this);for(var b=0;b<c.length;b++){a.push(this[c[b]])}return a};HashTableSrv.prototype.containsKey=function(a){return this[a]!==undefined};function IDArray(){this.arr=new ArrayList()}IDArray.prototype.Size=function(){return this.arr.Count()};IDArray.prototype.GetNative=function(){return this.arr};IDArray.prototype.set_Value=function(c,b){if(this.arr.length<=c.intValue()){for(var a=this.arr.Count();a<=c.intValue();a++){this.arr.Add(new IDVariant())}this.arr[c.intValue()]=b}else{this.arr[c.intValue()]=b}};IDArray.prototype.get_Value=function(b){var a=this.arr[b.intValue()];if(a==null){return new IDVariant()}if(a instanceof IDVariant){return a}return new IDVariant()};IDArray.prototype.add_Value=function(a){this.arr.Add(new IDVariant(a));return new IDVariant(this.Size()-1)};IDArray.prototype.Remove=function(a){this.arr.RemoveAt(a.intValue())};IDArray.prototype.Clear=function(){this.arr.Clear()};IDArray.prototype.set_Object=function(b,a){this.arr[b.intValue()]=a};IDArray.prototype.get_Object=function(a){return this.arr[a.intValue()]};IDArray.prototype.add_Object=function(a){this.arr.Add(a);return new IDVariant(this.Size()-1)};IDArray.prototype.Sort=function(){this.arr.Sort()};IDArray.prototype.FindValue=function(c,b){for(var a=0;a<this.arr.Count();a++){var d=this.arr.Get(a);if(d==null||!(d instanceof IDVariant)){continue}if(b&&d.compareTo(c)==0){return new IDVariant(a)}else{if(!b&&d.CompareToIgnoreCase(c)==0){return new IDVariant(a)}}}return new IDVariant(-1)};IDArray.prototype.FindObject=function(b){for(var a=0;a<this.arr.Count();a++){var c=this.arr.Get(a);if(c==null){continue}if(c==b){return new IDVariant(a)}}return new IDVariant(-1)};function IDCachedRowSetMetaData(){this.Columns=null;this.ColumnsMap=null}self.RowSetMetaDataImpl=IDCachedRowSetMetaData;IDCachedRowSetMetaData.prototype.setColumnName=function(b,a){if(b>0&&b<=this.Columns.length){this.Columns[b-1].ColumnName=a;this.ColumnsMap[a]=b-1}};IDCachedRowSetMetaData.prototype.setColumnType=function(b,a){if(b>0&&b<=this.Columns.length){this.Columns[b-1].DataType=IDCachedRowSetMetaData.GetCSharpType(a)}};IDCachedRowSetMetaData.prototype.setColumnCount=function(a){this.Columns=new Array(a);this.ColumnsMap=new HashTableSrv();for(var b=0;b<a;b++){var c=new Object();c.ColumnName="";c.DataType=IDVariant.NULL;c.MaxLength=0;this.Columns[b]=c}};IDCachedRowSetMetaData.prototype.getColumnName=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].ColumnName}};IDCachedRowSetMetaData.prototype.getColumnType=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].DataType}return null};IDCachedRowSetMetaData.prototype.getColumnCount=function(){return this.Columns.length};IDCachedRowSetMetaData.prototype.getColumnDisplaySize=function(a){if(a>0&&a<=this.Columns.length){return this.Columns[a-1].MaxLength}return -1};IDCachedRowSetMetaData.prototype.getScale=function(a){if(a>0&&a<=this.Columns.length){return -1}return -1};IDCachedRowSetMetaData.GetCSharpType=function(a){return a};IDCachedRowSetMetaData.GetSQLType=function(a){switch(a){case IDVariant.DECIMAL:return 2;case IDVariant.INTEGER:return 4;case IDVariant.FLOAT:return 8;case IDVariant.STRING:return 12;case IDVariant.DATETIME:return 93;case IDVariant.BLOB:return 2004}return -1};IDCachedRowSetMetaData.ToSQLType=function(a){switch(a){case 2:return IDVariant.DECIMAL;case 4:return IDVariant.INTEGER;case 8:return IDVariant.FLOAT;case 12:case -1:return IDVariant.STRING;case 93:return IDVariant.DATETIME;case -4:case 2004:return IDVariant.BLOB}return null};function MySQLResultSet(){this.insertId=0;this.rowsAffected=0;this.rows=new MySQLResultSetRowList()}function MySQLResultSetRowList(){}MySQLResultSetRowList.prototype=Array.prototype;MySQLResultSetRowList.prototype.item=function(a){return this[a]};function IDCachedRowSet(){this.IntDS=null;this.IntCmd=null;this.Parameters=null;this.MaxRows=0;this.ReadOnly=true;this.CurrentRow;this.CursorPos;this.flOpen=false;this.UnboundCols=null;this.TableName=null;this._insertRow=null;this.onInsertRow=false;this.pQuery=null;this.MetaData=null;this.SortCriteria=new Array(16);this.originalValues=new Array()}IDCachedRowSet.prototype.getCommand=function(){return this.IntCmd};IDCachedRowSet.prototype.checkCursor=function(){if(this.Bof()||this.EOF()){throw new Error("Invalid cursor position")}};IDCachedRowSet.prototype.checkIndex=function(a){if(a<1||(this.RecordCount()>0&&a>this.GetNumFields())){throw new Error("Invalid column index")}};IDCachedRowSet.prototype.setMaxRows=function(a){this.MaxRows=a};IDCachedRowSet.prototype.absolute=function(a){if(a>0){if(a>this.RecordCount()){this.CursorPos=IntDS.rows.length+1}else{this.CursorPos=a}}else{this.CursorPos=0}if(this.EOF()||this.Bof()){return false}return true};IDCachedRowSet.prototype.acceptChanges=function(b){if(b==undefined){b=null}if(this.onInsertRow){throw new Error("Invalid operation while on insert row")}if(b!=null){var a=(b.Transaction!=null);if(!a&&b.TransactionIsolation!=2){b.BeginTrans()}IDCachedRowSet.prototype.acceptChangesTR=function(){try{this.Update(b)}finally{if(!a&&b.TransactionIsolation!=2){b.CommitTrans()}}};b.ExecuteTrans(IDCachedRowSet.prototype.acceptChangesTR,this)}};IDCachedRowSet.prototype.deleteRow=function(){this.checkCursor();this.originalValues[this.CursorPos-1]=-2};IDCachedRowSet.prototype.execute=function(f,e){this.Parameters=new ArrayList();if(f!=null&&this.IntCmd.indexOf("?")!=-1){for(var b=0;b<f.Count();b++){var a=f[b];var d=null;if(a.Type==IDVariant.NULL){d=null}else{if(a.Type==IDVariant.DATETIME){d=IDL.CSql(a,IDL.FMT_DAT1,e).Replace("#","")}else{d=a.Value}}this.Parameters.Add(d)}}var c=false;if(e!=null){c=(e.Transaction!=null);if(!c&&e.TransactionIsolation!=2){e.BeginTrans()}}IDCachedRowSet.prototype.executeTR=function(){try{var g=e.ExecuteSQL(this.IntCmd,this.Parameters);this.populate(g)}finally{if(!c&&e.TransactionIsolation!=2&&e!=null){e.CommitTrans()}}};e.ExecuteTrans(IDCachedRowSet.prototype.executeTR,this);this.flOpen=true;this.CursorPos=0};IDCachedRowSet.prototype.findColumn=function(f){try{var a=this.getMetaData().ColumnsMap[f];if(a>=0){return a+1}a=this.getMetaData().ColumnsMap['"'+f+'"'];if(a>=0){return a+1}var d=this.getMetaData().ColumnsMap;var g=f.toLowerCase();for(var b in d){if(b.toLowerCase()==g||b.toLowerCase()=='"'+g+'"'){a=d[b];if(a>=0){return a+1}}}}catch(c){}return -1};IDCachedRowSet.prototype.getBinaryStream=function(c){var a=this.getBlob(this.GetName(c));if(a!=null){return a}return null};IDCachedRowSet.prototype.getBlob=function(a){this.checkIndex(a);this.checkCursor();return this.Get(a,IDVariant.BLOB).Value};IDCachedRowSet.prototype.getCurrentRow=function(){if(this.onInsertRow==true){return this._insertRow}return this.IntDS.rows.item(this.CursorPos-1)};IDCachedRowSet.prototype.getRow=function(){return this.CursorPos};IDCachedRowSet.prototype.insertRow=function(){if(this.onInsertRow==false){throw new Error("Not on insert row")}this.originalValues[this.RecordCount()]=-1;this.IntDS.rows.push(this._insertRow)};IDCachedRowSet.prototype.moveToCurrentRow=function(){if(this.onInsertRow!=false){this.CursorPos=this.CurrentRow;this.onInsertRow=false;this._insertRow=null}};IDCachedRowSet.prototype.moveToInsertRow=function(){if(this._insertRow==null){this._insertRow=new Object();for(var a=1;a<=this.getMetaData().getColumnCount();a++){this._insertRow[this.getMetaData().getColumnName(a)]=null}}this.onInsertRow=true;this.CurrentRow=this.CursorPos;this.CursorPos=-1};IDCachedRowSet.prototype.populate=function(h){if(this.ReadOnly){this.IntDS=h}else{this.IntDS=new MySQLResultSet();this.IntDS.rowsAffected=h.rowsAffected;try{this.IntDS.insertId=h.insertId}catch(f){}var c=h.rows.length;if(this.MaxRows>0){c=Math.min(c,this.MaxRows)}for(var b=0;b<c;b++){var k=new Object();var g=h.rows.item(b);var d=Object.keys(g);for(var a=0;a<d.length;a++){k[d[a]]=g[d[a]]}this.IntDS.rows.push(k)}}if(this.RecordCount()>0){this.flOpen=true;this.CursorPos=0}};IDCachedRowSet.prototype.refreshRow=function(){this.checkCursor();if(this.onInsertRow){throw new Error("Invalid cursor position.")}this.RejectRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.restoreOriginal=function(){for(var a=0;a<this.RecordCount();a++){this.RejectRowChanges(a)}};IDCachedRowSet.prototype.setCommand=function(a){if(this.IntCmd!=a){this.IntCmd=a;this.MetaData=null}};IDCachedRowSet.prototype.setOriginalRow=function(a){if(this.onInsertRow){throw new Error("Invalid operation on Insert Row")}this.AcceptRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.size=function(){try{if(this.IntDS!=null){return this.IntDS.rows.length}}catch(a){}return 0};IDCachedRowSet.prototype.setTableName=function(a){this.TableName=a};IDCachedRowSet.prototype.updateBinaryStream=function(d,c){this.checkIndex(d);this.checkCursor();var b=this.GetName(d);var e=this.getCurrentRow()[b];var a=c.stringValue();this.getCurrentRow()[b]=a;if(!this.onInsertRow&&a!=e){this.OnValueRowChange(this.CursorPos-1,b,e)}};IDCachedRowSet.prototype.updateNull=function(b){this.checkIndex(b);this.checkCursor();var a=this.GetName(b);var c=this.getCurrentRow()[a];this.getCurrentRow()[a]=null;if(!this.onInsertRow&&c!=null){this.OnValueRowChange(this.CursorPos-1,a,c)}};IDCachedRowSet.prototype.updateRow=function(){if(this.onInsertRow){throw new Error("updateRow called while on insert row")}};IDCachedRowSet.prototype.isColUnbound=function(a){if(this.UnboundCols!=null&&a<=this.UnboundCols.length){return this.UnboundCols[a-1]}else{return false}};IDCachedRowSet.prototype.setColUnbound=function(c,a){if(this.UnboundCols==null){this.UnboundCols=new Array(this.GetNumFields())}if(this.UnboundCols!=null&&c<=this.UnboundCols.length){this.UnboundCols[c-1]=a}};IDCachedRowSet.prototype.hasUnboundCol=function(){for(var a=0;a<this.UnboundCols.length;a++){if(this.UnboundCols[a]){return true}}return false};IDCachedRowSet.prototype.setOriginalValue=function(a){this.AcceptRowChanges(this.CursorPos-1)};IDCachedRowSet.prototype.getParams=function(){return this.Parameters};IDCachedRowSet.prototype.getMetaData=function(m){if(m==undefined){m=false}if(this.MetaData!=null){return this.MetaData}this.MetaData=new IDCachedRowSetMetaData();var p=this.GetColumnNamesByIntCmd();this.MetaData.setColumnCount(p.length);for(var e=0;e<p.length;e++){this.MetaData.setColumnName(e+1,p[e])}if(m){return this.MetaData}if(this.pQuery&&this.pQuery.Index==0&&this.pQuery.Parent){var a=this.pQuery.Parent;for(var d=1;d<=this.MetaData.getColumnCount();d++){for(var g=0;g<a.UMaster();g++){var k=a.MasterFields[g];if(k.Code==this.MetaData.getColumnName(d)){this.MetaData.setColumnType(d,k.DataType);break}}}}else{var h=this.MetaData.getColumnCount();for(var e=0;e<this.RecordCount();e++){var o=this.IntDS.rows.item(e);for(var d=1;d<=this.MetaData.getColumnCount();d++){var b=this.MetaData.getColumnName(d);var c=this.MetaData.getColumnType(d);if(c==Glb.DT_UNSPEC||c==Glb.DT_NUM_INTEGER||c==Glb.DT_NUM_FLOAT){var l=o[b];switch(typeof(l)){case"string":if(l.startsWith("QkxPQ")){c=Glb.DT_DOC_OLE}else{var j=l.replace(/,/g,".");var g=parseFloat(j);if(!isNaN(g)&&(g.toString()==j)){c=Glb.DT_NUM_FLOAT}else{c=Glb.DT_CHAR}}break;case"boolean":case"number":if(c!=Glb.DT_NUM_FLOAT){if(l%1==0){c=Glb.DT_NUM_INTEGER}else{c=Glb.DT_NUM_FLOAT}}break;case"object":if(l instanceof Date){c=Glb.DT_DATETIME}break}if(c!=Glb.DT_UNSPEC){this.MetaData.setColumnType(d,c);if(c!=Glb.DT_NUM_INTEGER&&c!=Glb.DT_NUM_FLOAT){h--}}}}if(h==0){break}}}return this.MetaData};IDCachedRowSet.prototype.setMetaData=function(a){this.IntDS=new MySQLResultSet();this.MetaData=a};IDCachedRowSet.prototype.setReadOnly=function(){this.ReadOnly=true};IDCachedRowSet.prototype.setUpdatable=function(){this.ReadOnly=false;if(this.IntDS&&!(this.IntDS instanceof MySQLResultSet)){this.populate(this.IntDS)}};IDCachedRowSet.prototype.CopyFrom=function(b){this.IntDS=new MySQLResultSet();for(var a=0;a<b.IntDS.rows.length;a++){this.IntDS.rows.push(b.IntDS.rows.item(a).clone())}this.MetaData=b.MetaData;this.IntCmd=b.IntCmd;this.MaxRows=b.MaxRows;this.ReadOnly=b.ReadOnly;this.onInsertRow=b.onInsertRow;this._insertRow=b._insertRow;this.CurrentRow=b.CurrentRow;this.CursorPos=b.CursorPos;this.TableName=b.TableName;this.UnboundCols=null;if(b.UnboundCols!=null){this.UnboundCols=b.UnboundCols.clone()}this.flOpen=b.flOpen};IDCachedRowSet.prototype.Get=function(b,c){if(c==undefined){c=0}var d;if(typeof(b)=="string"){d=this.findColumn(b)}if(typeof(b)=="number"){d=b}b=this.GetName(d);this.checkIndex(d);var a=IDVariant.convertObject(this.getCurrentRow()[b]);if(this.getMetaData().getColumnType(d)!=Glb.DT_UNSPEC&&a.Type!=IDVariant.NULL){a.changeType(IDL.DataType2IDVariantType(this.getMetaData().getColumnType(d)))}if(c!=0&&a.Type!=IDVariant.NULL){a.changeType(c)}return a};IDCachedRowSet.prototype.Set=function(c,b){var e;if(typeof(c)=="string"){e=this.findColumn(c)}if(typeof(c)=="number"){e=c}c=this.GetName(e);this.checkIndex(e);if(b.Type==IDVariant.BLOB){b.changeType(IDVariant.STRING);if(this.getMetaData().getColumnType(e)==Glb.DT_UNSPEC){this.getMetaData().setColumnType(e,Glb.DT_DOC_OLE)}}var d=this.getCurrentRow()[c];var a=b.Value;this.getCurrentRow()[c]=a;if(!this.onInsertRow&&a!=d){this.OnValueRowChange(this.CursorPos-1,c,d);if(this.pQuery!=null){this.pQuery.OnValueChange(this.CursorPos-1,e-1,b)}}if(this.isColUnbound(e)){this.setOriginalValue(e)}};IDCachedRowSet.prototype.GetNumFields=function(){if(this.getMetaData()){return this.getMetaData().getColumnCount()}else{return null}};IDCachedRowSet.prototype.GetName=function(a){this.checkIndex(a);if(this.getMetaData()){return this.getMetaData().getColumnName(a)}else{return null}};IDCachedRowSet.prototype.BookMark=function(){return this.getRow()};IDCachedRowSet.prototype.EOF=function(){return this.CursorPos>this.RecordCount()||this.RecordCount()==0};IDCachedRowSet.prototype.Bof=function(){return this.CursorPos==0||this.RecordCount()==0};IDCachedRowSet.prototype.MoveNext=function(){if(this.CursorPos<0||this.CursorPos>=this.RecordCount()+1){throw new Error("Invalid Cursor position")}if(this.CursorPos<=this.RecordCount()){this.CursorPos++}};IDCachedRowSet.prototype.MovePrevious=function(){if(this.CursorPos<=0||this.CursorPos>this.RecordCount()+1){throw new Error("Invalid Cursor position")}if(this.CursorPos>=1){this.CursorPos--}};IDCachedRowSet.prototype.MoveLast=function(){this.CursorPos=this.RecordCount()};IDCachedRowSet.prototype.MoveFirst=function(){this.CursorPos=1};IDCachedRowSet.prototype.IsOpen=function(){return this.IntDS!=null};IDCachedRowSet.prototype.RecordCount=function(){if(this.MaxRows>0){return Math.min(this.MaxRows,this.size())}else{return this.size()}};IDCachedRowSet.prototype.Close=function(){this.IntDS=null;this.flOpen=false};IDCachedRowSet.prototype.Dump=function(d){try{var f=0;this.MoveFirst();while(!this.EOF()&&f++<d){WriteToConsoleError("ROW "+f+" *******************************");for(var a=1;a<=this.GetNumFields();a++){WriteToConsoleError(this.GetName(a)+" = "+this.Get(a))}this.MoveNext()}}catch(b){WriteToConsoleError(b)}};IDCachedRowSet.prototype.AddRow=function(e){var b=new Object();this.IntDS.rows.push(b);for(var c=0;c<e.Count();c++){var d=this.GetName(c+1);if(e[c]!=null&&e[c] instanceof IDVariant){var a=new IDVariant(e[c]);if(a.Type!=IDVariant.NULL){a.changeType(IDL.DataType2IDVariantType(this.getMetaData().getColumnType(c+1)))}b[d]=a.Value}else{b[d]=e[c]}}this.flOpen=true};IDCachedRowSet.prototype.PrepareForValueSource=function(){this.IntDS=new MySQLResultSet();this.MetaData=new IDCachedRowSetMetaData();this.MetaData.setColumnCount(2);this.MetaData.setColumnName(1,"Code");this.MetaData.setColumnType(1,Glb.DT_CHAR);this.MetaData.setColumnName(2,"Description");this.MetaData.setColumnType(2,Glb.DT_CHAR)};IDCachedRowSet.prototype.AddValueSourceRow=function(a,b){var c=new Object();c[this.GetName(1)]=a;c[this.GetName(2)]=b;this.IntDS.rows.push(c)};IDCachedRowSet.prototype.GetObjectDirect=function(a,d){this.checkIndex(d);if(a>this.RecordCount()||this.RecordCount()==0||a==0){throw new Error("Invalid cursor position")}try{var c=this.IntDS.rows.item(a-1)[this.GetName(d)];return c}catch(b){return null}};IDCachedRowSet.prototype.SubstuteParameters=function(f,b){if(b==Glb.DBT_DB2400||b==Glb.DBT_ODBC){return f}var a=Glb.ParamsPrefixDB(b);var e=false;var d=1;for(var c=0;c<f.length;c++){if(f.charAt(c)=="'"){e=!e}else{if(!e&&f.charAt(c)=="?"){if(a=="?"&&c+1<f.length&&f.charAt(c+1)=="P"){continue}f=f.substr(0,c)+a+"P"+d+++f.substr(c+1)}}}return f};IDCachedRowSet.prototype.ClearSort=function(){for(var a=0;a<this.SortCriteria.length;a++){this.SortCriteria[a]=0}};IDCachedRowSet.prototype.SortBy=function(a){for(var b=0;b<this.SortCriteria.length;b++){if(this.SortCriteria[b]==0){if(a.Type==IDVariant.STRING){var c=a.stringValue().trim();if(c.toUpperCase().endsWith(" ASC")){this.SortCriteria[b]=this.findColumn(c.substr(0,c.length-4).trim())}else{if(c.toUpperCase().endsWith(" DESC")){this.SortCriteria[b]=-this.findColumn(c.substr(0,c.length-5).trim())}else{this.SortCriteria[b]=this.findColumn(c)}}}else{this.SortCriteria[b]=a.intValue()}break}}};IDCachedRowSet.prototype.GetSortCriteria=function(a){if(a>0&&a<=this.SortCriteria.length){return this.SortCriteria[a-1]}else{return 0}};IDCachedRowSet.prototype.EnableSort=function(){var b=this.SortCriteria;var f=this.getMetaData();var c=this.RecordCount();var e=new Array(c);for(var a=0;a<c;a++){e[a]=this.IntDS.rows.item(a)}function d(j,h){var g=0;for(var k=0;k<b.length&&g==0;k++){if(b[k]==0){continue}try{var m=j[f.getColumnName(Math.abs(b[k]))];var l=h[f.getColumnName(Math.abs(b[k]))];if(m==null){g=(l==null)?0:-1}else{if(l==null){g=(m==null)?0:1}else{if(typeof(m)=="string"&&typeof(l)=="string"){g=(String.compare(m,l,true))}else{if(m==l){g=0}else{g=(m>l?1:-1)}}}}if(b[k]<0){g=-g}}catch(o){WriteToConsoleError("Errore in Order By"+o)}}return g}e=e.sort(d);this.IntDS=new MySQLResultSet();for(var a=0;a<c;a++){this.IntDS.rows.push(e[a])}};IDCachedRowSet.prototype.getDebugInfo=function(b,d){var l="";try{if(d.length>0){var k=this.Get(d);l=k.getDebugInfo(b,"")}else{if(b==1){var h="";h+='<recordset count="'+this.RecordCount()+'" position="'+this.BookMark()+'" >';h+="<columns>";var j=this.GetNumFields();for(var g=0;g<j;g++){h+='<column name="'+this.GetName(g+1)+'" type="'+IDCachedRowSetMetaData.GetSQLType(this.getMetaData().getColumnType(g+1))+'" size="'+this.getMetaData().getColumnDisplaySize(g+1)+'" />'}h+="</columns>";h+="<rows>";for(var a=1;a<=this.RecordCount();a++){h+="<row";for(var g=1;g<=j;g++){var k=IDVariant.convertObject(this.GetObjectDirect(a,g));h+=" c"+g+'="'+IDVariant.encodeTextForXml(k.ToString())+'"'}h+=" />"}h+="</rows>";h+="</recordset>";l=h.toString()}else{l='<recordset count="'+this.RecordCount()+'" position="'+this.BookMark()+'" />'}}}catch(f){WriteToConsoleError(f)}return l};IDCachedRowSet.prototype.SaveToXML=function(c){if(c==undefined){c=false}if(this.IntDS==null){return""}if(this.getMetaData()==null){return""}try{var b=new XMLDoc();var a=b.AddNewElement("RS");this.SaveToXMLNode(a);return b.SaveToString()}catch(d){WriteToConsoleOutput(d);return""}};IDCachedRowSet.prototype.SaveToXMLNode=function(g){if(!this.IsOpen()){return}var e=this.getMetaData();var a=g.AddNewElement("MD");var j=this.GetNumFields();for(var f=1;f<=j;f++){var d=a.AddNewElement("Column");d.SetAttribute("Name",e.getColumnName(f));d.SetAttribute("Type",IDL.Type2DT(e.getColumnType(f)).toString())}var h=g.AddNewElement("Rows");for(var b=1;b<=this.size();b++){var l=h.AddNewElement("Row");l.set_IsArrayChild(true);for(var f=1;f<=j;f++){var k=IDVariant.convertObject(this.GetObjectDirect(b,f));if(k.Type!=IDVariant.NULL){if(k.Type==IDVariant.DATETIME){l.SetAttribute("c"+f,IDL.Format(k,new IDVariant("dd/mm/yyyy hh:nn:ss"),null).stringValue())}else{l.SetAttribute("c"+f,k.stringValue())}}}}};IDCachedRowSet.prototype.LoadFromXML=function(a,d){if(d==undefined){d=false}try{var c=new XMLDoc();if(!c.LoadFromString(a)){return false}if(!c.HasNextNode()){throw new Error("Empty XML document")}var b=c.GetNextNode();if(b.Name().equals("xml")){b=c.GetNextNode()}if(!b.Name().equals("RS")){throw new Error("Wrong node type: expected 'RS', got '"+b.Name()+"'")}this.LoadFromXMLNode(b);return true}catch(f){WriteToConsoleOutput(f);return false}};IDCachedRowSet.prototype.LoadFromXMLNode=function(h){this.IntDS=new MySQLResultSet();var a=h.GetNextNode();var c=0;if(a){if(!a.Name().equals("MD")){throw new Error("Wrong node type: expected 'MD', got '"+a.Name()+"'")}c=a.GetNode().childNodes.length;this.MetaData=new IDCachedRowSetMetaData();this.MetaData.setColumnCount(c);var g=new Array(c);for(var f=0;a.HasNextNode();f++){var b=a.GetNextNode();this.MetaData.setColumnName(f+1,b.GetAttribute("Name"));g[f]=parseInt(b.GetAttribute("Type"),10);this.MetaData.setColumnType(f+1,IDCachedRowSetMetaData.GetCSharpType(g[f]))}}this.RemoveAllRows();var j=h.GetNextNode();if(j){if(!j.Name().equals("Rows")){throw new Error("Wrong node type: expected 'Rows', got '"+j.Name()+"'")}while(j.HasNextNode()){var m=j.GetNextNode();if(!m.Name().equals("Row")){throw new Error("Wrong node type: expected 'Row', got '"+m.Name()+"'")}var l=new ArrayList();for(var f=0;f<c;f++){l.Add(new IDVariant())}for(var f=0;m.HasNextAttribute();f++){var k=new IDVariant();var d=new IDVariant();m.GetNextAttribute(d,k);if(d.stringValue().startsWith("c")){var e=parseInt(d.stringValue().substr(1),10);l[e-1]=k;if(g[e-1]==Glb.DT_DOC_OLE){k.Type=IDVariant.BLOB}}}this.AddRow(l)}}this.MoveFirst()};IDCachedRowSet.prototype.RemoveAllRows=function(){if(this.IntDS!=null){this.IntDS.rows.splice(0,this.IntDS.rows.length)}};IDCachedRowSet.prototype.Update=function(m){this.IntDS.insertId=0;this.IntDS.rowsAffected=0;if(this.originalValues.length==0){return}var c=null;for(var w=0;w<this.RecordCount();w++){var l=this.originalValues[w];if(l!==undefined){var b=this.IntDS.rows.item(w);var q=Object.keys(b);var s="";var t=new Array();switch(l){case -1:var x="";var u="";for(var g=0;g<q.length;g++){var h=q[g];var k=b[h];if(k===null||k===undefined||this.isColUnbound(g+1)){continue}x+=(x.length>0?", ":"")+h;u+=(u.length>0?", ":"")+"?";t.push(k)}if(x.length>0){s="INSERT INTO "+this.TableName+"("+x+") VALUES ("+u+")"}break;case -2:s="DELETE FROM "+this.TableName+" WHERE ";var q=Object.keys(b);for(var g=0;g<q.length;g++){if(this.isColUnbound(g+1)){continue}var h=q[g];var k=b[h];if(g>0){s+=" AND "}if(k===null){s+=h+" IS NULL"}else{s+=h+" = ?";t.push(k)}}break;default:var x="";var u="";var p=new Array();var q=Object.keys(b);for(var g=0;g<q.length;g++){if(this.isColUnbound(g+1)){continue}var h=q[g];var f=b[h];var j=(l[h]!==undefined?l[h]:b[h]);if(l[h]!==undefined&&l[h]!=b[h]){if(x.length>0){x+=", "}x+=h+" = ?";t.push(f)}if(u.length>0){u+=" AND "}if(j===null){u+=h+" IS NULL"}else{u+=h+" = ?";p.push(j)}}if(x.length>0){s="UPDATE "+this.TableName+" SET "+x+" WHERE "+u;t=t.concat(p)}break}if(s.length>0){for(var o=0;o<t.length;o++){var d=t[o];if(d instanceof Date){t[o]=IDL.CSql(new IDVariant(d),IDL.FMT_DAT1,m).Replace("#","")}}if(this.pQuery){var a=(l==-1?DTTEngine.STMT_QRY_INSVAL:(l==-2?DTTEngine.STMT_QRY_DELETE:DTTEngine.STMT_QRY_UPDATE));this.pQuery.Parent.MainFrm.DTTObj.AddQuery("RS.AcceptChanges",this.pQuery.Parent.GetDTTCaption()+" - "+(l==-2?"DeleteRecords":"UpdateRecords"),"RS.AcceptChanges",a,s);for(var o=0;o<t.length;o++){this.pQuery.Parent.MainFrm.DTTObj.AddParameter("RS.AcceptChanges",this.pQuery.Parent.GetDTTCaption(),"Param "+(o+1),t[o])}}c=m.ExecuteSQL(s,t);if(this.pQuery){this.pQuery.Parent.MainFrm.DTTObj.EndQuery("DB.AcceptChanges")}}if(l==-2){this.IntDS.rows.splice(w,1);this.originalValues.splice(w,1);w--}else{this.AcceptRowChanges(w)}}}if(c){try{this.IntDS.insertId=c.insertId}catch(r){}this.IntDS.rowsAffected=c.rowsAffected}};IDCachedRowSet.prototype.AcceptRowChanges=function(a){this.originalValues[a]=undefined};IDCachedRowSet.prototype.RejectRowChanges=function(d){var a=this.originalValues[d];if(a!==undefined){var f=this.IntDS.rows.item(d);var e=Object.keys(f);for(var b=0;b<e.length;b++){var c=e[b];if(a[c]!==undefined){f[c]=a[c]}}this.originalValues[d]=undefined}};IDCachedRowSet.prototype.OnValueRowChange=function(c,a,b){if(this.originalValues[c]==-1){return}if(this.originalValues[c]==undefined){this.originalValues[c]=new HashTableSrv()}if(this.originalValues[c][a]==undefined){this.originalValues[c][a]=b}};IDCachedRowSet.prototype.GetColumnNamesByIntCmd=function(){var m=new Array();if(this.IntCmd){var f=false;var q=0;var o=new Array();if(this.IntDS&&this.IntDS.rows.length>0){o=Object.keys(this.IntDS.rows.item(0))}for(var g=0;g<this.IntCmd.length;g++){var p=false;var d=false;var l=this.IntCmd.charAt(g);switch(l){case"'":f=!f;break;case"(":if(!f){q++}break;case")":if(!f){q--}break;case",":if(!f&&q==0){p=true}break;case"f":case"F":if(!f&&q==0&&this.IntCmd.substr(g-1,6).toUpperCase().trim()=="FROM"){p=true;d=true}break}if(p||g==this.IntCmd.length-1){if(g==this.IntCmd.length-1){g++}var r=this.IntCmd.substr(0,g).trimRight();var a=r.charAt(r.length-1)=='"';for(var e=r.length-2;e>0;e--){if(((IDL.IsWhiteSpace(r.charAt(e))||r.charAt(e)==",")&&!a)||(r.charAt(e)=='"'&&a)||r.charAt(e)=="."){var h=r.substring(e+1,r.length-(a?1:0));if(h=="*"){for(var b=0;b<o.length;b++){m.push(o[b])}}else{for(var b=0;b<o.length;b++){if(o[b].toUpperCase()==h.toUpperCase()){h=o[b];break}}m.push(h)}break}}if(d){break}}}}return m};function IDConnection(){this.IntCon=null;this.Parent=null;this.DBType=-1;this.Transaction=null;this.QuerySubstSrc=new ArrayList();this.QuerySubstVal=new ArrayList();this.MaxRows=0;this.UseLimitClause=true;this.TransCount=0;this.iRecordsAffected=0;this.TransactionIsolation=2}IDConnection.prototype.ClearSubstitutions=function(){this.QuerySubstSrc.Clear();this.QuerySubstVal.Clear()};IDConnection.prototype.AddSubstitution=function(c,b){var a=this.QuerySubstSrc.IndexOf(c);if(a>-1){this.QuerySubstVal[a]=b}else{this.QuerySubstSrc.Add(c);this.QuerySubstVal.Add(b)}};IDConnection.prototype.ApplySubstitutions=function(c){if(this.QuerySubstSrc.Count()==0&&(this.MaxRows==0||!this.UseLimitClause)){return c}var b=c;for(var a=0;a<this.QuerySubstSrc.Count();a++){var e=this.QuerySubstSrc[a];var d=this.QuerySubstVal[a];b=b.Replace(e,d)}if(this.UseLimitClause&&this.MaxRows>0&&b.substr(0,6).toLowerCase()=="select"){b+=" limit "+this.MaxRows}return b};IDConnection.prototype.set_CommandTimeout=function(a){};IDConnection.prototype.set_ConnectionTimeout=function(a){};IDConnection.prototype.CommandTimeout=function(){};IDConnection.prototype.ConnectionTimeout=function(){};IDConnection.prototype.RecordsAffected=function(){if(this.IntCon.rowsAffected){this.iRecordsAffected=this.IntCon.rowsAffected()}return this.iRecordsAffected};IDConnection.prototype.IsOpen=function(){return(this.IntCon!=null)};IDConnection.prototype.BeginTrans=function(){if(this.Transaction==null){this.Transaction=-1}else{throw new Error("Nested transaction not allowed")}this.TransCount++};IDConnection.prototype.ExecuteTrans=function(a,g,b,d){if(d==undefined){d=true}var c;try{if(this.Transaction==-1){try{var h=this;this.IntCon.transaction(function(e){h.Transaction=e;c=a.apply(g,b)})}catch(f){if(this.Rollbacked){this.Rollbacked=false}else{throw f}}finally{this.Transaction=null}}else{c=a.apply(g,b)}}finally{if(d){delete a}}return c};IDConnection.prototype.ExecuteSQL=function(b,c){var a=null;if(this.Transaction){a=this.Transaction.executeSql(b,c)}else{this.IntCon.transaction(function(d){a=d.executeSql(b,c)})}return a};IDConnection.prototype.CommitTrans=function(){if(this.Transaction!=null){this.Transaction=null}else{throw new Error("No pending transaction")}this.TransCount--};IDConnection.prototype.RollbackTrans=function(){if(this.Transaction!=null){this.Transaction=null;this.Rollbacked=true;this.TransCount--;throw new Error("RollbackTrans")}};IDConnection.prototype.SetRemote=function(a,b){};IDConnection.prototype.SetLocal=function(){};IDConnection.prototype.Execute=function(c){var b=0;var a=(this.Transaction!=null);if(!a&&this.TransactionIsolation!=2){this.BeginTrans()}this.MaxRows=0;IDConnection.prototype.ExecuteTR=function(){try{var d=this.ExecuteSQL(this.ApplySubstitutions(c));if(d){b=d.rowsAffected}}catch(f){throw f}finally{if(!a&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.ExecuteTR,this);if(!c.startsWith("set identity_insert")){this.iRecordsAffected=b}};IDConnection.prototype.OpenRSR=function(b){var c=new IDCachedRowSet();var a=(this.Transaction!=null);if(!a&&this.TransactionIsolation!=2){this.BeginTrans()}IDConnection.prototype.OpenRSRTR=function(){try{c=this.OpenRS(b)}finally{if(!a&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.OpenRSRTR,this);if(!c.EOF()){c.MoveFirst()}return c};IDConnection.prototype.OpenRS=function(b){var a=new IDCachedRowSet();a.setCommand(this.ApplySubstitutions(b));a.setMaxRows(this.MaxRows);a.execute(null,this);this.MaxRows=0;return a};IDConnection.prototype.Open=function(f,d,b,a){this.DBType=a;try{this.IntCon=TryOpenDatabase(f,"",this.Parent.DBName,49*1024*1024);return(this.IntCon!=null)}catch(c){WriteToConsoleError(c);throw c}};IDConnection.prototype.Close=function(){if(this.IntCon.close){this.IntCon.close()}this.IntCon=null};IDConnection.prototype.getConnection=function(){return this.IntCon};IDConnection.prototype.CallSP=function(b,c,d,a){};IDConnection.prototype.UpdateRS=function(a,b){b.setTableName(a);b.acceptChanges(this);return b};IDConnection.prototype.ExecuteIDPS=function(f,b){var c=(this.Transaction!=null);if(!c&&this.TransactionIsolation!=2){this.BeginTrans()}var a=null;try{IDConnection.prototype.ExecuteIDPSTR=function(){try{var j=new Array();for(var h=0;h<f.Parameters.Count();h++){var g=f.Parameters[h];if(g.Type==IDVariant.DATETIME){j.push(IDL.CSql(g,IDL.FMT_DAT1,this).Replace("#",""))}else{j.push(g.Value)}}var e=this.ExecuteSQL(f.Cmd,j);if(b){a=new IDCachedRowSet();a.setMaxRows(f.MaxRows);a.populate(e);if(!a.EOF()){a.MoveFirst()}}else{this.iRecordsAffected=e.rowsAffected;if(!c&&this.TransactionIsolation!=2){this.CommitTrans()}}if(f.AutoClose){f.Close()}}finally{if(b&&!c&&this.TransactionIsolation!=2){this.CommitTrans()}}};this.ExecuteTrans(IDConnection.prototype.ExecuteIDPSTR,this)}catch(d){if(f.AutoClose){f.Close()}throw d}return(b?a:null)};IDConnection.prototype.GetSchema=function(b,a){};IDConnection.prototype.GetTableSchema=function(a,b){};IDConnection.prototype.GetTablePK=function(a){};IDConnection.prototype.GetTableFK=function(b,a){};IDConnection.prototype.AdjustSchemaObject=function(d,e,b,f,g,a){var j="select sql from sqlite_master ";j+="where type = '"+g+"' ";j+="and name = '"+b+"'";if(g=="index"){j+=" and tbl_name = '"+f+"'"}var h=this.OpenRS(j);if(h.RecordCount()>0){h.MoveFirst();j=h.Get(1).stringValue();if(j!=a){if(g=="table"){this.ModifyTableSchema(d,b,j,a)}else{var c=b;d.DTTObj.AddQuery("DB.AdjustSchemaObject",g+" "+b+": updating schema","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_UPDATE,a);this.Execute("drop "+g+" "+c);this.Execute(a);d.DTTObj.EndQuery("DB.AdjustSchemaObject")}}}else{d.DTTObj.AddQuery("DB.AdjustSchemaObject",g+" "+b+": Creating new","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_INSVAL,a);this.Execute(a);d.DTTObj.EndQuery("DB.AdjustSchemaObject")}e.Add(b)};IDConnection.prototype.DropUselessObjects=function(e,g,c){var f="select name, tbl_name from sqlite_master";f+=" where type = '"+c+"'";f+=" and name not like 'sqlite%'";f+=" and name not like 'ZZ_%'";f+=" and name not like '__WebKit%'";f+=" and name not like 'android_%'";if(e.RTCObj.Enabled&&e.RTCObj.DB==this){f+=" and name not like 'RTC_%'";f+=" and name not like 'RTCU_%'"}var a=this.OpenRS(f);if(a.RecordCount()>0){a.MoveFirst()}while(!a.EOF()){var h=a.Get(1).stringValue();var b=a.Get(2).stringValue();var d=h;if(g.IndexOf(d)==-1){f="drop "+c+' "'+d+'"';e.DTTObj.AddQuery("DB.DropUselessObjects",c+" "+d+" is no more used: dropping","DB.AdjustSchemaObject",DTTEngine.STMT_QRY_DELETE,f);this.Execute(f);e.DTTObj.EndQuery("DB.DropUselessObjects")}a.MoveNext()}};IDConnection.prototype.ModifyTableSchema=function(g,l,d,a){var o=false;var f="";var j=new ArrayList();var m=new ArrayList();this.ExtractSqlToken(j,d);this.ExtractSqlToken(m,a);var c=this.PurgeList(j,m);if(c.Count()>0){o=true;f="need to drop or change";for(var e=0;e<c.Count();e++){var h=c[e];var p=h.indexOf(" ");var k=h;if(p>0){k=h.substr(0,p)}f+=" "+k}}else{c=this.PurgeList(m,j);for(var e=0;e<c.Count();e++){var u=c[e];var r=u.substr(0,11).toLowerCase();if(r=="primary key"||r=="foreign key"||r=="constraint "){f=r+" is changed";o=true;break}else{if(u.toLowerCase().indexOf("not null")>-1&&u.toLowerCase().indexOf("default")==-1){f=r+" is not null";o=true;break}else{var h=u;if(u.endsWith(",")){h=u.remove(u.length-1).trim()}var q="alter table "+l+" add column "+h;g.DTTObj.AddQuery("DB.ModifyTableSchema","Adding field "+h,"DB.ModifyTableSchema",DTTEngine.STMT_QRY_INSVAL,q);this.Execute(q);g.DTTObj.EndQuery("DB.ModifyTableSchema")}}}}if(o){this.Execute("alter table "+l+" rename to "+l+"_old");g.DTTObj.AddQuery("DB.ModifyTableSchema","Table "+l+": Recreating schema. Reason: "+f,"DB.ModifyTableSchema",DTTEngine.STMT_QRY_INSVAL,a);this.Execute(a);g.DTTObj.EndQuery("DB.ModifyTableSchema");this.MoveData(g,l,m,j);this.Execute("drop table "+l+"_old")}};IDConnection.prototype.MoveData=function(m,q,e,d){var r="insert into "+q+" select ";var l=true;for(var k=0;k<e.Count();k++){var t=e[k];var a=t.indexOf(" ");var c=t.substr(0,a).toLowerCase();if(c=="primary"||c=="foreign"||c=="constraint"){continue}if(!l){r+=", "}l=false;var o=t.substr(0,a+1);var h=false;for(var g=0;g<d.Count();g++){var f=d[g];if(f.startsWith(o)){h=true;break}}if(h){r+="["+t.substr(0,a)+"]"}else{o=t.toLowerCase();var b="NULL";if(o.indexOf("not null")>-1){a=o.indexOf("default");if(a>-1){b=t.substr(0,a).trim()}else{if(o.indexOf("varchar")>-1){b="'.'"}else{if(o.indexOf("date")>-1){b="CURRENT_DATE"}else{if(o.indexOf("time")>-1){b="CURRENT_TIME"}else{b="0"}}}}}r+=b}}r+=" from "+q+"_old";m.DTTObj.AddQuery("DB.MoveData","Table "+q+": Moving Data","DB.MoveData",DTTEngine.STMT_QRY_INSSEL,r);this.Execute(r);m.DTTObj.EndQuery("DB.MoveData")};IDConnection.prototype.ExtractSqlToken=function(f,e){var g=e.indexOf("(");var h=e.lastIndexOf(")");if(g==-1||h==-1||g>h){return}e=e.substr(g+1,h-g-1).trim();var d=false;var a=0;for(var b=0;b<e.length;b++){var j=e.charAt(b);if(j=="'"){d=!d}else{if(!d){if(j=="("){a++}else{if(j==")"){a--}else{if(j==","&&a==0){f.Add(e.substring(0,b).trim());e=e.substring(b+1);b=-1}}}}}}if(e.length>0){f.Add(e.trim())}};IDConnection.prototype.PurgeList=function(b,c){var a=new ArrayList();for(var d=0;d<b.Count();d++){var e=b[d];if(c.IndexOf(e)==-1){a.Add(e)}}return a};IDConnection.prototype.BackupDB=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("BACKUPDB",{CONNSTR:this.Parent.DefaultConnStr(),FILENAME:b});if(a!="OK"){throw new Error(a)}return}throw new Error("Backup not supported outside the Native Shell")};IDConnection.prototype.RestoreDB=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){this.Open(this.Parent.DefaultConnStr());this.Close();var a=RD4_WebEntryPoint.ShellObject.SendCmd("RESTOREDB",{CONNSTR:this.Parent.DefaultConnStr(),FILENAME:b});if(a!="OK"){throw new Error(a)}return}throw new Error("Restore not supported outside the Native Shell")};function IDFTP(){this.Index=0;if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_NEW");this.Index=parseInt(a,10);if(this.Index==0){throw new Error(a)}}}IDFTP.prototype.GetNative=function(){return this};IDFTP.prototype.PassiveMode=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_PASSIVEMODE",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.set_PassiveMode=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SETPASSIVEMODE",{INDEX:this.Index,MODE:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.IsConnected=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_ISCONNECTED",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.Connect=function(c,b,d,e){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CONNECT",{INDEX:this.Index,HOSTNAME:c.stringValue(),USERNAME:b.stringValue(),PASSWORD:d.stringValue(),TIMEOUT:e.intValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.Disconnect=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_DISCONNECT",{INDEX:this.Index});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.GetNumFiles=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETNUMFILES",{INDEX:this.Index});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.INTEGER)}else{return new IDVariant()}}return new IDVariant()};IDFTP.prototype.GetIsDirectory=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETISDIRECTORY",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return(a.substring(2)=="1")}else{return false}}return false};IDFTP.prototype.GetFileName=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILENAME",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDFTP.prototype.GetFileSize=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILESIZE",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.INTEGER)}else{return new IDVariant()}}};IDFTP.prototype.GetFileDateTime=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILEDATETIME",{INDEX:this.Index,FILE:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.DATETIME)}else{return new IDVariant()}}};IDFTP.prototype.PutFile=function(f,c,d,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(d.stringValue().length==0){var e=Math.max(c.stringValue().lastIndexOf("/"),c.stringValue().lastIndexOf("\\"));if(e!=-1){d=new IDVariant(c.stringValue().substring(e+1))}else{d=new IDVariant(c)}}var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_PUTFILE",{INDEX:this.Index,LOCALPATH:c.stringValue(),REMOTEPATH:d.stringValue(),ASYNC:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.GetFile=function(f,d,c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(c.stringValue().length==0){var e=Math.max(d.stringValue().lastIndexOf("/"),d.stringValue().lastIndexOf("\\"));if(e!=-1){c=new IDVariant(f.getRealPath()+"\\"+d.stringValue().substring(e+1))}else{c=new IDVariant(f.getRealPath()+"\\"+d.stringValue())}}var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_GETFILE",{INDEX:this.Index,REMOTEPATH:d.stringValue(),LOCALPATH:c.stringValue(),ASYNC:(b?"1":"0")});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.SetTransferType=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SETTRANSFERTYPE",{INDEX:this.Index,TYPE:b.intValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.DeleteRemoteFile=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_DELETEREMOTEFILE",{INDEX:this.Index,FILENAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.ChangeRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CHANGEREMOTEDIR",{INDEX:this.Index,REMOTEDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.SendCommand=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_SENDCOMMAND",{INDEX:this.Index,CMD:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.STRING)}else{return new IDVariant()}}};IDFTP.prototype.CreateRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_CREATEREMOTEDIR",{INDEX:this.Index,DIRNAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDFTP.prototype.RemoveRemoteDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("FTP_REMOVEREMOTEDIR",{INDEX:this.Index,DIRNAME:b.stringValue()});if(a!="OK"){throw new Error(a)}}};IDL.FMT_CHAR=0;IDL.FMT_NUM=1;IDL.FMT_DAT1=2;IDL.FMT_DAT2=3;IDL.FMT_DAT3=4;IDL.FMT_BOOL=5;IDL.FMT_DAT4=6;IDL.DatePatterns=new Array("dd/MM/yy","dd-MM-yy","dd/MM/yyyy","dd-MM-yyyy","yyyy/MM/dd","yyyy-MM-dd");IDL.TimePatterns=new Array("H:m:s","H.m.s","H:m","H.m");IDL.DayNameShort=new Array("Dom","Lun","Mar","Mer","Gio","Ven","Sab");IDL.DayNames=new Array("Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato");IDL.MonthNameShort=new Array("Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic");IDL.MonthNames=new Array("Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre");function IDL(){}IDL.NumericType=function(b,a){return(b.Type>a.Type)?b.Type:a.Type};IDL.Mod=function(b,a){return new IDVariant(b.intValue()%a.intValue(),1)};IDL.Pow=function(b,a){return new IDVariant(Math.pow(b.dblValue(),a.dblValue()))};IDL.Mul=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()*b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()*b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()*b.intValue(),a);default:return new IDVariant()}};IDL.Div=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()/b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()/b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(Math.floor(c.intValue()/b.intValue()),a);default:return new IDVariant()}};IDL.Add=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()+b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()+b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()+b.intValue(),a);case IDVariant.STRING:return new IDVariant(c.stringValue().concat(b.stringValue()),a);case IDVariant.DATETIME:var f=c.dateValue();var d=b.dblValue()*IDVariant.MILLIS_DAY;var e=new Date(f.getTime()+d);if(e.dstOffset()-f.dstOffset()){e=new Date(e.getTime()-(e.dstOffset()-f.dstOffset()))}return new IDVariant(e,a);default:return new IDVariant()}};IDL.Sub=function(c,b){var a=IDL.NumericType(c,b);switch(a){case IDVariant.DECIMAL:return new IDVariant(c.decValue()-b.decValue(),a);case IDVariant.FLOAT:return new IDVariant(c.dblValue()-b.dblValue(),a);case IDVariant.INTEGER:return new IDVariant(c.intValue()-b.intValue(),a);case IDVariant.DATETIME:if(c.Type==IDVariant.DATETIME&&b.Type==IDVariant.DATETIME){return new IDVariant((c.dateValue().getTime()-b.dateValue().getTime())/IDVariant.MILLIS_DAY)}else{var f=c.dateValue();var d=b.dblValue()*IDVariant.MILLIS_DAY;var e=new Date(f.getTime()-d);if(e.dstOffset()-f.dstOffset()){e=new Date(e.getTime()-(e.dstOffset()-f.dstOffset()))}return new IDVariant(e,a)}default:return new IDVariant()}};IDL.Neg=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(-a.decValue(),a.Type);case IDVariant.FLOAT:return new IDVariant(-a.dblValue(),a.Type);case IDVariant.INTEGER:return new IDVariant(-a.intValue(),a.Type);default:return new IDVariant()}};IDL.IsNumber=function(a){switch(a.Type){case IDVariant.STRING:var c=new IDVariant(a);var b=new IDVariant(a);c.changeType(IDVariant.INTEGER);b.changeType(IDVariant.FLOAT);return c.Type!=IDVariant.NULL||b.Type!=IDVariant.NULL;default:return true}};IDL.Rnd=function(){return new IDVariant(Math.random())};IDL.Abs=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(Math.abs(a.decValue()),a.Type);case IDVariant.FLOAT:return new IDVariant(Math.abs(a.dblValue()),a.Type);case IDVariant.INTEGER:return new IDVariant(Math.abs(a.intValue()),a.Type);default:return new IDVariant()}};IDL.Int=function(a){switch(a.Type){case IDVariant.DECIMAL:return new IDVariant(Math.floor(a.decValue()),1);case IDVariant.FLOAT:return new IDVariant(Math.floor(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Ceil=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:return new IDVariant(Math.ceil(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Floor=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:return new IDVariant(Math.floor(a.dblValue()),1);case IDVariant.INTEGER:return a;default:return new IDVariant()}};IDL.Round=function(c,b){var g=c.Type;var e=b.intValue();var a=c.dblValue();var f=Math.pow(10,e);a=a*f;a=Math.round(a);a=a/f;return new IDVariant(a)};IDL.Trunc=function(e,b){var a=e.dblValue();var f=b.intValue();var g=Math.pow(10,f);a=a*g;a=Math.floor(a);a=a/g;var c=new IDVariant(a);c.changeType(e.Type);return c};IDL.Sign=function(a){switch(a.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:if(a.dblValue()==0){return new IDVariant(0,1)}else{if(a.dblValue()>0){return new IDVariant(1,1)}else{return new IDVariant(-1,1)}}case IDVariant.INTEGER:if(a.intValue()==0){return new IDVariant(0,1)}else{if(a.intValue()>0){return new IDVariant(1,1)}else{return new IDVariant(-1,1)}}default:return new IDVariant()}};IDL.Sqrt=function(a){return new IDVariant(Math.sqrt(a.dblValue()))};IDL.Exp=function(a){return new IDVariant(Math.exp(a.dblValue()))};IDL.Log=function(a){return new IDVariant(Math.log(a.dblValue()))};IDL.Log10=function(a){return new IDVariant(Math.log(a.dblValue())/Math.log(10))};IDL.Sin=function(a){return new IDVariant(Math.sin(a.dblValue()))};IDL.Cos=function(a){return new IDVariant(Math.cos(a.dblValue()))};IDL.Tan=function(a){return new IDVariant(Math.tan(a.dblValue()))};IDL.ArcSin=function(a){return new IDVariant(Math.asin(a.dblValue()))};IDL.ArcCos=function(a){return new IDVariant(Math.acos(a.dblValue()))};IDL.ArcTan=function(a){return new IDVariant(Math.atan(a.dblValue()))};IDL.Cot=function(a){return new IDVariant(1/Math.tan(a.dblValue()))};IDL.Sinh=function(b){var a=b.dblValue();return new IDVariant(0.5*(Math.exp(a)-Math.exp(-a)))};IDL.Cosh=function(b){var a=b.dblValue();return new IDVariant(0.5*(Math.exp(a)+Math.exp(-a)))};IDL.Tanh=function(b){var a=b.dblValue();return new IDVariant((Math.exp(2*a)-1)/(Math.exp(2*a)+1))};IDL.PI=function(a){return new IDVariant(Math.PI)};IDL.ToDegrees=function(a){return new IDVariant(a.dblValue()*360/(2*Math.PI))};IDL.ToRadians=function(a){return new IDVariant(a.dblValue()*(2*Math.PI)/360)};IDL.Now=function(){var a=new Date().getTime();a=a-a%1000;return new IDVariant(new Date(a))};IDL.Today=function(){var a=new Date();return new IDVariant(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0))};IDL.Time=function(){var a=new Date();return new IDVariant(new Date(1899,11,30,a.getHours(),a.getMinutes(),a.getSeconds(),0))};IDL.ToDate=function(h,b,f){var g=h.intValue();var e=b.intValue();var a=f.intValue();var c=new IDVariant(new Date(g,e-1,a,0,0,0));return c};IDL.ToTime=function(c,a,b){return new IDVariant(new Date(1899,11,30,c.intValue(),a.intValue(),b.intValue(),0))};IDL.DateTimeEx=function(g,a,f,e,b,c){return new IDVariant(new Date(g.intValue(),a.intValue()-1,f.intValue(),e.intValue(),b.intValue(),c.intValue()))};IDL.Year=function(b){var a=new IDVariant(b.dateValue().getFullYear(),1);return a};IDL.Month=function(b){var a=new IDVariant(b.dateValue().getMonth()+1,1);return a};IDL.Day=function(b){var a=new IDVariant(b.dateValue().getDate(),1);return a};IDL.Hour=function(b){var a=new IDVariant(b.dateValue().getHours(),1);return a};IDL.Minute=function(b){var a=new IDVariant(b.dateValue().getMinutes(),1);return a};IDL.Second=function(b){var a=new IDVariant(b.dateValue().getSeconds(),1);return a};IDL.WeekDay=function(b){var a=new IDVariant(b.dateValue().getDay()+1,1);return a};IDL.YearDay=function(e){var c=new Date(e.dateValue().getFullYear(),0,1,0,0,0);var b=Math.floor((e.dateValue().getTime()-c.getTime())/IDVariant.MILLIS_DAY)+1;var a=new IDVariant(b,1);return a};IDL.Week=function(e){var c=e.dateValue();var a=new Date(c.getFullYear(),c.getMonth(),c.getDate());a.setDate(a.getDate()-((a.getDay()+6)%7)+3);var b=new Date(a.getFullYear(),0,4);b.setDate(b.getDate()-((b.getDay()+6)%7)+3);var f=(a-b)/(86400000*7);return new IDVariant(Math.round(1+f),1)};IDL.GetDate=function(a){return IDL.ToDate(IDL.Year(a),IDL.Month(a),IDL.Day(a))};IDL.GetTime=function(a){return IDL.ToTime(IDL.Hour(a),IDL.Minute(a),IDL.Second(a))};IDL.IsDate=function(b){switch(b.Type){case IDVariant.STRING:var a=IDL.ToDateTime(b);return(a.Type==IDVariant.DATETIME);default:return true}};IDL.DateAdd=function(j,h,e){var b=j.stringValue();var f=h.intValue();var c=e.dateValue();if(b=="yyyy"){c=new Date((c.getFullYear()+f),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="q"){c=new Date(c.getFullYear(),(c.getMonth()+f*3),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="m"){c=new Date(c.getFullYear(),(c.getMonth()+f),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="y"||b=="d"||b=="w"){c=new Date(c.getFullYear(),c.getMonth(),(c.getDate()+f),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="ww"){c=new Date(c.getFullYear(),c.getMonth(),(c.getDate()+f*7),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="h"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),(c.getHours()+f),c.getMinutes(),c.getSeconds(),c.getMilliseconds())}else{if(b=="n"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),(c.getMinutes()+f),c.getSeconds(),c.getMilliseconds())}else{if(b=="s"){c=new Date(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),(c.getSeconds()+f),c.getMilliseconds())}}}}}}}}var a=new IDVariant(c);return a};IDL.FillLR=function(j,g,d,a){var m=j.stringValue();var c=g.intValue();if(m.length>=c){return j}var h=" ";if(d.stringValue().length>0){h=d.stringValue().charAt(0)}var b="";for(var e=0;e<c-m.length;e++){b=b+h}var k=null;if(a){k=new IDVariant(b+m)}else{k=new IDVariant(m+b)}return k};IDL.Find=function(d,a,b){var g=0;if(b){g=b.intValue()}if(g>0){g=g-1}try{var c=d.stringValue().indexOf(a.stringValue(),g);return new IDVariant(c+1,1)}catch(f){return new IDVariant(0,1)}};IDL.ReverseFind=function(d,a,b){var g=d.stringValue().length;if(b){g=b.intValue()}if(g>0){g=g-1}try{var c=d.stringValue().lastIndexOf(a.stringValue(),g);return new IDVariant(c+1,1)}catch(f){return new IDVariant(0,1)}};IDL.SubStr=function(e,d,c){var g,f;var a=2147483647;if(c){a=c.intValue()}var b=e.stringValue();if(e.Type==IDVariant.NULL){return new IDVariant()}if(a<=0){return new IDVariant("")}g=d.intValue();if(g>0){g=g-1}f=((g+a)>2147483647?2147483647:g+a);if(g<0){g=0}if(f>b.length){f=b.length}return new IDVariant(e.stringValue().substr(g,f-g))};IDL.Left=function(b,a){return IDL.SubStr(b,new IDVariant(1),a)};IDL.Right=function(d,c){var a=c.intValue();var b=d.stringValue();if(a<=0){return new IDVariant("")}var e=b.length-a+1;return IDL.SubStr(d,new IDVariant(e))};IDL.Length=function(a){return new IDVariant(a.stringValue().length,1)};IDL.Lower=function(a){return new IDVariant(a.stringValue().toLowerCase())};IDL.Upper=function(a){return new IDVariant(a.stringValue().toUpperCase())};IDL.Replace=function(d,b,a){var e=d.stringValue();var c=b.stringValue();var f=a.stringValue();c=c.replace(/[-[\]{}()*+?.,\\^$|#\s]/gm,"\\$&");return new IDVariant(e.replace(new RegExp(c,"gm"),f))};IDL.IsWhiteSpace=function(a){return(" \t\n\v\f\r".indexOf(a)!=-1)};IDL.Trim=function(c,a,b){if(c.Type==IDVariant.NULL){return new IDVariant()}var d=c.stringValue();if(b){while(d.length>0&&IDL.IsWhiteSpace(d.charAt(d.length-1))){d=d.substring(0,d.length-1)}}if(a){while(d.length>0&&IDL.IsWhiteSpace(d.charAt(0))){d=d.substring(1,d.length)}}return new IDVariant(d.toString())};IDL.Replicate=function(b,g){var f=b.stringValue();var h;var a=g.intValue();if(f.length>0){h=f.charAt(0)}else{h=" "}var e="";for(var d=0;d<a;d++){e=e+h}return new IDVariant(e)};IDL.Substitute=function(f,h,d,b){var m=f.stringValue();var j=b.stringValue();var k=h.intValue();var c=d.intValue();var a=m.slice(0,k);var g=m.slice(k+c,m.length);var e=a.concat(j).concat(g);return new IDVariant(e)};IDL.ASCII=function(b){var a=b.stringValue();if(a.length>0){return new IDVariant(PdfFont.WinAnsiDecode(a.charAt(0)),1)}else{return new IDVariant()}};IDL.CHR=function(a){return new IDVariant(String.fromCharCode(a.intValue()))};IDL.ToInteger=function(a){if(a.Type==IDVariant.INTEGER){return a}else{return new IDVariant(a.intValue(),1)}};IDL.ToFloat=function(a){if(a.Type==IDVariant.FLOAT){return a}else{return new IDVariant(a.dblValue(),IDVariant.FLOAT)}};IDL.ToCurrency=function(a){if(a.Type==IDVariant.DECIMAL){return a}else{return new IDVariant(a.decValue(),IDVariant.DECIMAL)}};IDL.ToDateTime=function(d,c){if(d.Type==IDVariant.DATETIME){return d}else{if(d.Type==IDVariant.STRING){var h=d.stringValue();if(h.trim().length==0){return new IDVariant()}var f=h.trim().split(" ");if(f.length>2){return new IDVariant()}var b=null;if(c!=null){var e=c.stringValue();e=e.Replace("m","M");e=e.Replace("n","m");e=e.Replace("h","H");if(e.indexOf(" ")!=-1){var j=e.trim().split(" ");e=j[0]}b=IDL.applyPattern(f[0],e)}if(b==null){for(var g=0;g<IDL.DatePatterns.length;g++){b=IDL.applyPattern(f[0],IDL.DatePatterns[g]);if(b!=null){break}}}if(b==null&&f.length==1){for(var g=0;g<IDL.TimePatterns.length;g++){b=IDL.applyPattern(f[0],IDL.TimePatterns[g]);if(b!=null){return new IDVariant(b)}}}if(b==null){return new IDVariant()}var a=null;if(f.length==2){for(var g=0;g<IDL.TimePatterns.length;g++){a=IDL.applyPattern(f[1],IDL.TimePatterns[g]);if(a!=null){break}}if(a==null){return new IDVariant()}}if(f.length==1){return new IDVariant(b)}else{b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds());return new IDVariant(b)}}else{return new IDVariant(d.dateValue())}}};IDL.ToString=function(a){if(a.Type==IDVariant.STRING){return a}else{return new IDVariant(a.stringValue())}};IDL.NullValue=function(b,a){if(b.Type==IDVariant.NULL){return a}else{return b}};IDL.IsNull=function(a){return(a.Type==IDVariant.NULL)};IDL.Btv=function(a){if(a){return IDVariant.TRUE}else{return IDVariant.FALSE}};IDL.Quote=function(e){if(e instanceof IDVariant){e=e.stringValue()}var a=e;var d=0;while(d<a.length){if(a.charAt(d)=="'"){var b=a.slice(0,d)+"'";b=b+a.slice(d);a=b;d++}d++}a="'"+a+"'";return a};IDL.CSql=function(b,a,c){if(IDL.IsNull(b)){return"NULL"}var g=false;if(c!=null&&c.Unicode&&Glb.ClassDB(c.DBType)==Glb.DBC_SQLSRV){g=true}switch(a){case IDL.FMT_CHAR:return((g)?"N":"")+IDL.Quote(b);case IDL.FMT_NUM:if(b.Type==IDVariant.DECIMAL||b.Type==IDVariant.FLOAT||b.Type==IDVariant.INTEGER){return b.stringValue()}else{return new IDVariant(b.dblValue()).stringValue()}case IDL.FMT_DAT1:case IDL.FMT_DAT2:case IDL.FMT_DAT3:case IDL.FMT_DAT4:var e="";switch(a){case IDL.FMT_DAT1:e="#yyyy-mm-dd hh:nn:ss#";break;case IDL.FMT_DAT2:e="{'ts' \\'yyyy-mm-dd hh:nn:ss\\'}";break;case IDL.FMT_DAT3:e="'TO_TIMESTAMP'(\\'yyyy-mm-dd hh:nn:ss\\', \\''YYYY-MM-DD HH24:MI:SS\\'')";break;case IDL.FMT_DAT4:e="'DATETIME'(''yyyy-mm-dd hh:nn:ss'')";break}var d=IDL.Format(b,new IDVariant(e),null);return d.stringValue();case IDL.FMT_BOOL:if(b.booleanValue()){return"1 = 1"}else{return"0 = 1"}}return""};IDL.Format=function(h,c,k,b,m){if(b==undefined){b=new IDVariant()}if(m==undefined){m=new IDVariant()}var d=c.stringValue();if(d.length>0){if(h.Type==IDVariant.STRING){var l=new IDVariant(h);if(IDL.IsNumber(l)){l.changeType(IDVariant.DECIMAL)}else{if(IDL.IsDate(l)){l.changeType(IDVariant.DATETIME)}}h=l}switch(h.Type){case IDVariant.DECIMAL:case IDVariant.FLOAT:case IDVariant.INTEGER:try{var a=".";var f=",";if(b!=null&&b.Type!=IDVariant.NULL){a=b.stringValue()}else{if(k!=null){if(k instanceof WebEntryPointSrv){a=k.UseDecimalDot()?".":","}}}if(m!=null&&m.Type!=IDVariant.NULL){f=m.stringValue()}else{if(k!=null){if(k instanceof WebEntryPointSrv){f=k.UseDecimalDot()?",":"."}}}var j="";switch(h.Type){case IDVariant.DECIMAL:j=IDL.FormatNumber(h.decValue(),d,a,f);break;case IDVariant.FLOAT:j=IDL.FormatNumber(h.dblValue(),d,a,f);break;case IDVariant.INTEGER:j=IDL.FormatNumber(h.longValue(),d,a,f);break}return new IDVariant(j.toString())}catch(g){}break;case IDVariant.DATETIME:try{var j=IDL.FormatDate(h.dateValue(),d);return new IDVariant(j)}catch(g){}break}}return new IDVariant(h.stringValue())};IDL.FormatNumber=function(c,q,f,l){var p="";for(var r=0;r<q.length;r++){if(q.charAt(r)=="#"||q.charAt(r)=="0"){break}p+=q.charAt(r)}var d="";for(var r=q.length-1;r>=0;r--){if(q.charAt(r)=="#"||q.charAt(r)=="0"){break}d=q.charAt(r)+d}if(p.length>0||d.length>0){q=q.substr(p.length,q.length-p.length-d.length)}if(q.indexOf(";")!=-1){var g=q.split(";");if(c>0){q=g[0]}else{q=g[1]}}var m=q.split(".");var e=m[0];var s=(m.length>1?m[1]:"");c=Math.round(c*(Math.pow(10,s.length)))/Math.pow(10,s.length);m=c.toString().split(".");var o=m[0];var j=(m.length>1?m[1]:"");if(c<0){o=o.replace("-","")}var a="";for(var r=0;r<s.length;r++){if(s.charAt(r)=="0"){a=a+(j.charAt(r)==""?"0":j.charAt(r))}if(s.charAt(r)=="#"){a=a+(j.charAt(r)==""||j.charAt(r)=="0"?" ":j.charAt(r))}}a=IDL.Trim(new IDVariant(a),false,true).stringValue();a=a.replace(new RegExp(" ","g"),"0");var t="";var k=o.length-1;var b=e.length-1;if(o.length<=e.length){for(var r=0;b>=0;r++){var h="";if(b>=0){h=e.charAt(b)}else{if((r%3)==0){h=","}else{h=e.charAt(0)}}switch(h){case"0":t=(o.charAt(k)==""?"0":o.charAt(k))+t;k--;break;case"#":if(k<0){r=0}else{t=o.charAt(k)+t;k--}break;case",":if(k<0){r=0}else{t=l+t}break}b--}}else{t=o.toString()}if(c<0){t="-"+t}t=IDL.Trim(new IDVariant(t),true,false).stringValue();t=t.replace(new RegExp(" ","g"),"0");var u=t;if(a.length>0){u=u+f+a}u=p+u+d;return u};IDL.FormatDate=function(C,y){var B=C.getDate().toString();var D=C.getDate().toString();if(D.length<2){D="0"+D}var k=IDL.DayNameShort[C.getDay()];var g=IDL.DayNames[C.getDay()];var v=C.getMonth()+1;var A=(C.getMonth()+1).toString();if(A.length<2){A="0"+A}var c=IDL.MonthNameShort[C.getMonth()];var l=IDL.MonthNames[C.getMonth()];var t=C.getFullYear().toString().substring(2,4);var r=C.getFullYear().toString();var z=C.getHours().toString();var j=C.getHours().toString();if(j.length<2){j="0"+j}var u=C.getMinutes().toString();var f=C.getMinutes().toString();if(f.length<2){f="0"+f}var q=C.getSeconds().toString();var w=C.getSeconds().toString();if(w.length<2){w="0"+w}var o=false;var x="";for(var E=0;E<y.length;E++){var p=y.charAt(E);if(p=="'"){if(y.substr(E,2)=="''"){E+=1}else{p="";o=!o}}if(!o){switch(p){case"y":var e=y.substr(E,4);var b=y.substr(E,2);if(e=="yyyy"){p=r;E+=3}else{if(b=="yy"){p=t;E+=1}}break;case"m":var e=y.substr(E,4);var b=y.substr(E,3);var a=y.substr(E,2);if(e=="mmmm"){p=l;E+=3}else{if(b=="mmm"){p=c;E+=2}else{if(a=="mm"){p=A;E+=1}else{p=v}}}break;case"d":var e=y.substr(E,4);var b=y.substr(E,3);var a=y.substr(E,2);if(e=="dddd"){p=g;E+=3}else{if(b=="ddd"){p=k;E+=2}else{if(a=="dd"){p=D;E+=1}else{p=B}}}break;case"h":var e=y.substr(E,2);if(e=="hh"){p=j;E+=1}else{p=z}break;case"n":var e=y.substr(E,2);if(e=="nn"){p=f;E+=1}else{p=u}break;case"s":var e=y.substr(E,2);if(e=="ss"){p=w;E+=1}else{p=q}break}}x+=p}return x};IDL.StringToNumber=function(d,h,b,j){if(b==undefined){b=new IDVariant()}if(j==undefined){j=new IDVariant()}var c=false;if(h!=null&&h instanceof WebEntryPointSrv){c=h.UseDecimalDot()}var a=(b!=null&&b.Type!=IDVariant.NULL?b.stringValue():(c?".":","));var e=(j!=null&&j.Type!=IDVariant.NULL?j.stringValue():(c?",":"."));try{var g=parseFloat(d.stringValue(),10);return new IDVariant(g)}catch(f){return new IDVariant()}};IDL.NumberToString=function(f,h,b,j){if(b==undefined){b=new IDVariant()}if(j==undefined){j=new IDVariant()}var c=false;if(h!=null&&h instanceof WebEntryPointSrv){c=h.UseDecimalDot()}var a=(b!=null&&b.Type!=IDVariant.NULL?b.stringValue():(c?".":","));var d=(j!=null&&j.Type!=IDVariant.NULL?j.stringValue():(c?",":"."));var g;switch(f.Type){case IDVariant.INTEGER:g=f.intValue().toString();break;case IDVariant.FLOAT:g=f.dblValue().toString();break;case IDVariant.DECIMAL:g=f.decValue().toString();break;default:g=f.stringValue();break}if(d.length>0){var e=0;if(g.indexOf(a)!=-1){e=g.length-g.indexOf(a)-1}switch(f.Type){case IDVariant.INTEGER:g=f.intValue().toString();break;case IDVariant.FLOAT:g=f.dblValue().toString();break;case IDVariant.DECIMAL:g=f.decValue().toString();break;default:g=f.stringValue();break}}return new IDVariant(g)};IDL.FormatMessage=function(c,b,a,g,f,e,d){if(b==undefined){b=new IDVariant()}if(a==undefined){a=new IDVariant()}if(g==undefined){g=new IDVariant()}if(f==undefined){f=new IDVariant()}if(e==undefined){e=new IDVariant()}if(d==undefined){d=new IDVariant()}if(b!=null){c=IDL.Replace(c,new IDVariant("|1"),b)}if(a!=null){c=IDL.Replace(c,new IDVariant("|2"),a)}if(g!=null){c=IDL.Replace(c,new IDVariant("|3"),g)}if(f!=null){c=IDL.Replace(c,new IDVariant("|4"),f)}if(e!=null){c=IDL.Replace(c,new IDVariant("|5"),e)}if(d!=null){c=IDL.Replace(c,new IDVariant("|6"),d)}return c};IDL.Type2DT=function(a){return a};IDL.DT2Type=function(a){return a};IDL.QbeMatch=function(q,H,A,s,m){if(s==undefined){s=new IDVariant(";")}if(m==undefined){m=false}var h=H.stringValue();if(h.length==0){return true}var K="";var L=-1,J=-1;var Q=true;if(h.charAt(0)=="§"){h=h.substr(1);Q=false}var y=(A!=null&&A.ParamsObj().QBETrueLessThan);var N=false;do{var x=true;nextToken:{if(h.charAt(0)!="="||m){L=h.indexOf(s.stringValue(),L+1)}if(L>=0){K=h.substr(J+1,(L)-(J+1))}else{K=h.substr(J+1)}if(K.length>0){if(m){K="="+K}if(K.charAt(0)==">"){if(y){x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K.substr(1),q.Type))>0)}else{x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K.substr(1),q.Type))>=0)}if(q.Type==IDVariant.DATETIME){var M=IDL.ParsePartialDate(A,K.substr(1),(y?1:0));if(M.Type!=IDVariant.NULL){x=(q.CompareTo(M)>=0)}}break nextToken}if(K.charAt(0)=="<"){if(y){x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K.substr(1),q.Type))<0)}else{x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K.substr(1),q.Type))<=0)}if(q.Type==IDVariant.DATETIME){var M=IDL.ParsePartialDate(A,K.substr(1),(y?0:1));if(M.Type!=IDVariant.NULL){x=(q.CompareTo(M)<0)}}break nextToken}if(K.charAt(0)=="."){x=(q.stringValue().length!=0);break nextToken}if(K.charAt(0)=="!"){x=(q.Type==IDVariant.NULL||q.stringValue().length==0);break nextToken}if(K.charAt(0)=="#"){K=K.substr(1);if(Q&&q.Type==IDVariant.STRING){if(K.indexOf("*")==-1&&K.indexOf("%")==-1){K=K+"*"}K=K.replace(/\*/g,"%");var B=q.stringValue().toLowerCase();var O=K.toLowerCase();O="^"+O;O=O.replace(/\[!/g,"[^");O=O.replace(/#/g,"\\d");O=O.replace(/\?/g,".");O=O.replace(/%/g,".*");var g=O.length;for(var I=0;I<g-2;I++){if(O.charAt(I)=="["&&O.charAt(I+2)=="]"){var D=O.slice(0,I)+"\\"+O.slice(I+1,I+2)+O.slice(I+3);O=D}}x=!(new RegExp(O)).test(B)}else{x=(q.CompareTo(new IDVariant(K,q.Type))!=0);if(q.Type==IDVariant.DATETIME){var t=IDL.ParsePartialDate(A,K,0);var r=IDL.ParsePartialDate(A,K,1);if(t.Type!=IDVariant.NULL){x=(q.CompareTo(t)<0||q.CompareTo(r)>=0)}}}break nextToken}if(K.charAt(0)=="="){x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K.substr(1),q.Type))==0);break nextToken}if(q.Type==IDVariant.STRING&&K.charAt(K.length-1)=="&"){var C=q.stringValue();var j=K.substr(0,(K.length-1));x=(IDL.SoundEx(C)==IDL.SoundEx(j));break nextToken}var E;E=K.indexOf(":");if(E>=0){var z=false;if(q.Type==IDVariant.DATETIME){z=true;var t=IDL.ParsePartialDate(A,K.substr(0,E),0);var r=IDL.ParsePartialDate(A,K.substr(E+1),1);var o=(t.Type!=IDVariant.NULL||r.Type!=IDVariant.NULL);if(K.indexOf("/")!=-1||K.indexOf("-")!=-1||o){var P;var l=K.length;for(P=E+1;P<l;P++){if(K.charAt(P)==":"){E=P}else{if(K.charAt(P)=="/"||K.charAt(P)=="-"){break}}}if(P<=K.length){var e=new IDVariant(K.substr(0,E));var a=new IDVariant(K.substr(E+1));if(t.Type==IDVariant.NULL){e.changeType(IDVariant.DATETIME)}if(r.Type==IDVariant.NULL){a.changeType(IDVariant.DATETIME)}if(e.Type!=IDVariant.NULL&&a.Type!=IDVariant.NULL){if(t.Type==IDVariant.NULL&&r.Type==IDVariant.NULL){x=(q.CompareTo(e)>=0&&q.CompareTo(a)<=0)}else{if(t.Type==IDVariant.NULL){x=(q.CompareTo(e)>=0)}else{x=(q.CompareTo(t)>=0)}if(x){if(r.Type==IDVariant.NULL){x=(q.CompareTo(a)<=0)}else{x=(q.CompareTo(r)<0)}}}}else{if(e.Type!=IDVariant.NULL){if(t.Type==IDVariant.NULL){x=(q.CompareTo(e)>=0)}else{x=(q.CompareTo(t)>=0)}}else{if(a.Type!=IDVariant.NULL){if(r.Type==IDVariant.NULL){x=(q.CompareTo(a)<=0)}else{x=(q.CompareTo(r)<0)}}}}break nextToken}}else{var k=new ArrayList();var l=K.length;for(var P=0;P<l;P++){if(K.charAt(P)==":"){k.Add(P)}}if(k.Count()>2&&(k.Count()%2)==1){E=k[(k.Count()-1)/2];var f=new IDVariant(K.substr(0,E),q.Type);var b=new IDVariant(K.substr(E+1),q.Type);if(f.Type!=IDVariant.NULL&&b.Type!=IDVariant.NULL){x=(q.CompareTo(f)>=0&&q.CompareTo(b)<=0)}else{if(f.Type!=IDVariant.NULL){x=(q.CompareTo(f)>=0)}else{if(b.Type!=IDVariant.NULL){x=(q.CompareTo(b)<=0)}}}break nextToken}}}if(!z){if(q.Type==IDVariant.NULL){x=false}else{var f=new IDVariant(K.substr(0,E),q.Type);var b=new IDVariant(K.substr(E+1),q.Type);if(f.Type!=IDVariant.NULL&&b.Type!=IDVariant.NULL){x=(q.CompareTo(f)>=0&&q.CompareTo(b)<=0)}else{if(f.Type!=IDVariant.NULL){x=(q.CompareTo(f)>=0)}else{if(b.Type!=IDVariant.NULL){x=(q.CompareTo(b)<=0)}}}}break nextToken}}var u;u=K.indexOf(" ")>=0&&(K.indexOf(":")>=0||K.indexOf(".")>=0);var G=IDL.ParsePartialDate(A,K,0);var F=IDL.ParsePartialDate(A,K,1);if(q.Type==IDVariant.DATETIME&&G.Type!=IDVariant.NULL){x=(q.CompareTo(G)>=0&&q.CompareTo(F)<0);break nextToken}if(q.Type==IDVariant.DATETIME&&!u){var f=new IDVariant(K,q.Type);var b=new IDVariant(K+" 23:59:59",q.Type);x=(q.CompareTo(f)>=0&&q.CompareTo(b)<=0);break nextToken}else{if(Q&&q.Type==IDVariant.STRING){if(K.indexOf("*")==-1&&K.indexOf("%")==-1){K=K+"*"}K=K.replace(/\*/g,"%");var B=q.stringValue().toLowerCase();var O=K.toLowerCase();O="^"+O;O=O.replace(/\[!/g,"[^");O=O.replace(/#/g,"\\d");O=O.replace(/\?/g,".");O=O.replace(/%/g,".*");var g=O.length;for(var I=0;I<g-2;I++){if(O.charAt(I)=="["&&O.charAt(I+2)=="]"){var D=O.slice(0,I)+"\\"+O.slice(I+1,I+2)+O.slice(I+3);O=D}}x=(new RegExp(O,"m")).test(B)}else{x=(q.Type!=IDVariant.NULL&&q.CompareTo(new IDVariant(K,q.Type))==0)}break nextToken}}}J=L;N|=x}while(L>=0);return N};IDL.SoundEx=function(h){var j="";if(h!=null&&h.length>0){h=h.toLowerCase();j=j+h.substr(0,1);var g="";var d=h.length;for(var e=1;e<d;e++){var a=h.charAt(e);var f="";if("bfpv".indexOf(a)>-1){f="1"}else{if("cgjkqsxz".indexOf(a)>-1){f="2"}else{if("dt".indexOf(a)>-1){f="3"}else{if(a=="l"){f="4"}else{if("mn".indexOf(a)>-1){f="5"}else{if(a=="r"){f="6"}}}}}}if(f!=g){j=j+f}if(j.length==4){break}if(f!=""){g=f}}}if(j.length<4){var b=4-j.length;var c="";for(var e=0;e<b;e++){c=c+"0"}j=j+c}return j.toUpperCase()};IDL.DataType2IDVariantType=function(a){switch(a){case Glb.DT_BOOLEAN:case Glb.DT_NUM_INTEGER:return IDVariant.INTEGER;case Glb.DT_NUM_FLOAT:return IDVariant.FLOAT;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:return IDVariant.DECIMAL;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return IDVariant.STRING;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:return IDVariant.DATETIME;case Glb.DT_DOC_OLE:return IDVariant.BLOB}return IDVariant.NULL};IDL.ParsePartialDate=function(l,m,o){if(o==undefined){o=0}try{var j=new IDVariant();var k=new RegExp("^\\d{4}$","").exec(m);if(k!=null){j=IDL.ToDate(new IDVariant(m),new IDVariant(1),new IDVariant(1));if(o!=0){j=IDL.DateAdd(new IDVariant("yyyy"),new IDVariant(o),j)}return j}k=new RegExp("^(\\d{1,2})[\\/-](\\d{4})$","").exec(m);if(k!=null){j=IDL.ToDate(new IDVariant(k[2]),new IDVariant(k[1]),new IDVariant(1));if(o!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(o),j)}return j}if(l!=null){if(m.toLowerCase()==l.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false).toLowerCase()){j=IDL.Today()}else{if(m.toLowerCase()==l.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false).toLowerCase()){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today())}else{if(m.toLowerCase()==l.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false).toLowerCase()){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today())}}}if(j.Type!=IDVariant.NULL){if(o!=0){j=IDL.DateAdd(new IDVariant("d"),new IDVariant(o),j)}return j}var b=l.RTCObj.GetConst("FC8AF728-7517-4b68-B213-80CAE61F3D90","gen;feb;mar;apr;mag;giu;lug;ago;set;ott;nov;dic",false).split(";");var c=IDL.Year(IDL.Today());for(var g=0;g<b.length;g++){if(m.toLowerCase()==b[g].toLowerCase()){j=IDL.ToDate(c,new IDVariant(g+1),new IDVariant(1));if(o!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(o),j)}return j}}k=new RegExp("^([a-zA-Z]{3}) (\\d{4})$","").exec(m);if(k!=null){var a=k[1];var f=k[2];for(var g=0;g<b.length;g++){if(a.toLowerCase()==b[g].toLowerCase()){j=IDL.ToDate(new IDVariant(f),new IDVariant(g+1),new IDVariant(1));if(o!=0){j=IDL.DateAdd(new IDVariant("m"),new IDVariant(o),j)}return j}}}}}catch(h){}return new IDVariant()};IDL.HttpRequest=function(m,w,F,o,c){if(F==undefined){F=null}if(o==undefined){o=null;c=null}else{if(c==undefined){c=new IDVariant()}}var a=new XMLHttpRequest();var j=(F==null?"GET":"POST");if(F!=null){var v=F.get_Value(new IDVariant("ID_TYPE")).stringValue();if(v.length>0){j=v}}var h="";if(F!=null){var x=F.GetKeys();for(var D=0;D<x.Size();D++){var I=x.get_Value(new IDVariant(D));var f=I.stringValue();if(f.startsWith("ID_")){continue}if(h.length!=0){h+="&"}var g=F.get_Value(I).stringValue();h+=f+"="+encodeURIComponent(g)}}var C=w.stringValue();if(!C.toLowerCase().startsWith("http://")&&!C.toLowerCase().startsWith("https://")&&!C.toLowerCase().startsWith("blob:")){C="http://"+C}if(h.length>0){if(!j.equals("GET")){if(F!=null&&F.get_Value(new IDVariant("ID_BODY")).stringValue().length>0){C+=(C.indexOf("?")==-1?"?":"&")+h}}else{C+=(C.indexOf("?")==-1?"?":"&")+h}}if(o!=null&&c!=null){a.open(j,C,false,o,c)}else{a.open(j,C,false)}if(F!=null){var b=F.get_Value(new IDVariant("ID_TIMEOUT"));if(b.Type!=IDVariant.NULL){a.timeout=b.intValue()*1000}}if(F!=null){var s=F.get_Object(new IDVariant("ID_HEADERS"));if(s!=null){if(s instanceof IDVariant){var k=s.stringValue();if(k.length>0){var p=k.split("\n");for(var D=0;D<p.length;D++){var B=p[D].split(":");a.setRequestHeader(B[0],B.slice(1).join(":"))}}}else{if(s instanceof IDArray){var e=s;if(e.Size()>0){for(var D=0;D<e.Size();D++){var B=e.get_Value(new IDVariant(D)).stringValue().split(":");a.setRequestHeader(B[0],B.slice(1).join(":"))}}}}}}if(!j.equals("GET")){var H="application/x-www-form-urlencoded";if(F!=null){var r=F.get_Value(new IDVariant("ID_BODY")).stringValue();var z=F.get_Value(new IDVariant("ID_BODYTYPE")).stringValue();if(r.length>0){h=r;if(z.length>0){H=z}}}a.setRequestHeader("Content-Type",H);a.send(h)}else{a.send(null)}if(F!=null&&F.get_Value(new IDVariant("ID_NOERROR")).intValue()!=0){F.set_Value(new IDVariant("ID_RESPONSECODE"),new IDVariant(a.status))}var q;var l=a.getResponseHeader("Content-Type");var y=(!l||l.length==0||l.startsWith("text/")||l.startsWith("application/json"));if(F!=null){var d=F.get_Value(new IDVariant("ID_RESPONSETYPE")).stringValue();if(d.equals("TEXT")){y=true}else{if(d.equals("BLOB")){y=false}}}if(y){q=new IDVariant(a.responseText)}else{var E=false;if(m instanceof WebEntryPointSrv){E=m.ParamsObj().NativeBlob}var G="";if(!E){G+="B";G+="L";G+="O";G+="B";var A=w.stringValue();var u="";if(!A.toLowerCase().startsWith("blob:")&&A.lastIndexOf(".")>=0){u=A.substr(A.lastIndexOf(".")+1);if(u.indexOf("/")!=-1){u=""}}if(u.length==0&&m!=null&&m instanceof WebEntryPointSrv){u=m.GetExtensionFromMime(l)}if(u.length>12){u=u.substr(0,12)}if(u.length>0){G+=u}for(var D=G.length;D<16;D++){G+=String.fromCharCode(0)}}else{}for(var D=0;D<a.responseText.length;D++){G+=String.fromCharCode((a.responseText.charCodeAt(D)>>8)==247?(a.responseText.charCodeAt(D)&255):a.responseText.charCodeAt(D))}q=new IDVariant();q.Value=G;q.Type=IDVariant.BLOB}if(F!=null){var p=new IDArray();var s=a.getAllResponseHeaders().split("\n");for(var D=0;D<s.length;D++){if(s[D].length>0){p.add_Value(new IDVariant(s[D]))}}if(p.Size()>0){F.set_Object(new IDVariant("ID_HEADERS"),p)}}return q};IDL.ErrorNumber=function(c){try{var b=c.indexOf("-");if(b>0){var a=c.substr(0,b);var d=parseInt(a.trim(),10);if(isNaN(d)){d=-1}return new IDVariant(d)}}catch(f){}return new IDVariant(0)};IDL.applyPattern=function(w,t){try{var s=new Date(0,0,1,0,0,0);var k=-1;var a=-1;var h=-1;var f=-1;var b=-1;var g=-1;var m="";if(t.indexOf("/")!=-1){m="/"}else{if(t.indexOf("-")!=-1){m="-"}else{if(t.indexOf(":")!=-1){m=":"}else{if(t.indexOf(".")!=-1){m="."}}}}if(m==""){return null}var u=w.split(m);var c=t.split(m);if(u.length!=c.length||u.length<=1){return null}for(var o=0;o<c.length;o++){switch(c[o]){case"dd":var r=parseInt(u[o],10);if(isNaN(r)||r>31){return null}h=r;break;case"MM":var x=parseInt(u[o],10);if(isNaN(x)||x>12){return null}a=x-1;break;case"yy":var j=parseInt(u[o],10);if(isNaN(j)||j.toString().length!=2){return null}var q=1900;if(j<20){q=2000}k=j+q;break;case"yyyy":var j=parseInt(u[o],10);if(isNaN(j)||j.toString().length!=4){return null}k=j;break;case"H":case"HH":var d=parseInt(u[o],10);if(isNaN(d)||d>24){return null}f=d;break;case"m":case"mm":var p=parseInt(u[o],10);if(isNaN(p)||p>59){return null}b=p;break;case"s":case"ss":var l=parseInt(u[o],10);if(isNaN(l)||l>59){return null}g=l;break}}if((f!=-1||b!=-1||g!=-1)&&h==-1&&a==-1&&k==-1){h=30;a=11;k=1899}if(k!=-1){s.setFullYear(k)}if(a!=-1){s.setMonth(a)}if(h!=-1){s.setDate(h)}if(f!=-1){s.setHours(f)}if(b!=-1){s.setMinutes(b)}if(g!=-1){s.setSeconds(g)}if(k!=-1&&s.getFullYear()!=k){return null}if(a!=-1&&s.getMonth()!=a){return null}return s}catch(v){WriteToConsoleError(v);return null}};IDL.Sleep=function(b){if(b instanceof IDVariant){b=b.intValue()}var a=new Date().getTime();while((new Date()).getTime()-a<b){}};IDL.Like=function(c,a){var d=a.stringValue();if(d.indexOf("%")!=-1){d=d.Replace("%","*")}var b=c.stringValue().replace(/[-[\]{}()*+?.,\\^$|#\s]/gm,"\\$&");return(new RegExp("^"+d.Replace("\\.","\\\\.").Replace("\\*","(.){0,}").Replace("\\?","(.){1}")+"$","m").test(b))};IDL.Base64Encode=function(a){return btoa(unescape(encodeURIComponent(a)))};IDL.Base64Decode=function(a){return decodeURIComponent(escape(atob(a)))};function IDMailer(){this.Subject=null;this.Body=null;this.HTMLBody=null;this.FromAddress;this.FromName;this.TOs=new ArrayList();this.CCs=new ArrayList();this.BCCs=new ArrayList();this.ReplyTos=new ArrayList();this.Files=new ArrayList();this.FileNames=new ArrayList();this.FileCntTypes=new ArrayList();this.FileInlineDisposition=new ArrayList()}IDMailer.prototype.AddToAddress=function(a){this.TOs.Add(a)};IDMailer.prototype.AddCCAddress=function(a){this.CCs.Add(a)};IDMailer.prototype.AddBCCAddress=function(a){this.BCCs.Add(a)};IDMailer.prototype.AddReplyToAddress=function(a){this.ReplyTos.Add(a)};IDMailer.prototype.AddAttachment=function(b,a,d,c){this.Files.Add(b);this.FileNames.Add(a);this.FileCntTypes.Add(d);this.FileInlineDisposition.Add(c)};IDMailer.prototype.ResetContainers=function(){this.TOs.Clear();this.CCs.Clear();this.BCCs.Clear();this.ReplyTos.Clear();this.Files.Clear();this.FileNames.Clear();this.FileCntTypes.Clear();this.FileInlineDisposition.Clear()};IDMailer.prototype.SetRelayServer=function(b,e,d,a,c){};IDMailer.prototype.SendMail=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("SENDMAIL",{TOADDRS:this.TOs.join(";"),CCADDRS:this.CCs.join(";"),BCCADDRS:this.BCCs.join(";"),SUBJECT:this.Subject,BODY:this.Body,HTMLBody:this.HTMLBody,FILES:this.Files.join(";"),FILESNAME:this.FileNames.join(";"),FILESMIME:this.FileCntTypes.join(";"),FILESINLINE:this.FileInlineDisposition.join(";")});if(a!="OK"){throw new Error(a)}}};function IDMap(){}IDMap.prototype.Size=function(){return Object.keys(this).length};IDMap.prototype.ContainsKey=function(a){if(this[a.stringValue()]==undefined){return false}else{return true}};IDMap.FromEnum=function(c,b){var a=new IDMap();for(var d=0;d<c.length;d++){a.set_Value(c[d],(d<b.length)?b[d]:new IDVariant())}return a};IDMap.prototype.GetNative=function(){return this};IDMap.prototype.GetKeys=function(){var a=new IDArray();var c=Object.keys(this);for(var b=0;b<c.length;b++){a.add_Value(IDVariant.convertObject(c[b]))}return a};IDMap.prototype.set_Value=function(a,b){this[a.stringValue()]=b};IDMap.prototype.get_Value=function(a){try{var b=this[a.stringValue()];if(b==null||b==undefined){b=new IDVariant()}return b}catch(c){return new IDVariant()}};IDMap.prototype.Remove=function(a){if(this.ContainsKey(a)){delete this[a.stringValue()]}};IDMap.prototype.Clear=function(){var b=Object.keys(this);for(var a=0;a<b.length;a++){delete this[b[a]]}};IDMap.prototype.set_Object=function(a,b){this[a.stringValue()]=b};IDMap.prototype.get_Object=function(a){return this[a.stringValue()]};function IDPreparedStatement(a){this.Parameters=new ArrayList();this.Cmd=null;this.AutoClose=(a!=undefined?a:false);this.MaxRows=0}IDPreparedStatement.prototype.ClearParameters=function(){this.Parameters.Clear()};IDPreparedStatement.prototype.AddParameter=function(a){this.Parameters.Add(a)};IDPreparedStatement.prototype.SetCommand=function(a){this.Cmd=a};IDPreparedStatement.prototype.GetCommand=function(){return this.Cmd};IDPreparedStatement.prototype.ParameterCount=function(){return this.Parameters.Count()};IDPreparedStatement.prototype.GetParameter=function(a){return this.Parameters[a]};IDPreparedStatement.prototype.SetParameter=function(a,b){this.Parameters[a]=b};IDPreparedStatement.prototype.Close=function(){};IDPreparedStatement.prototype.ToString=function(){var c=this.Cmd+"\n";for(var b=0;b<this.Parameters.Count();b++){var a=this.Parameters[b];c+=("Par"+(b+1)+" = "+a+"\n")}return c+"\n"};IDVariant.NULL=0;IDVariant.INTEGER=1;IDVariant.FLOAT=2;IDVariant.DATETIME=3;IDVariant.DECIMAL=4;IDVariant.STRING=5;IDVariant.BLOB=6;IDVariant.MILLIS_DAY=86400000;IDVariant.VB_DAY_OFFS=25569;IDVariant.TMZ_OFFS=(new Date()).getTimezoneOffset()*60000;IDVariant.ConvertNullToValue=false;IDVariant.DefaultDateMask="dd/MM/yyyy";IDVariant.DefaultTimeMask="hh:mm";IDVariant.NumRegExp=new RegExp("[^-.,0-9]|.-.*","");function IDVariant(b,a){if(b==null){this.Value=null;this.Type=0;return}switch(typeof(b)){case"boolean":this.Type=1;this.Value=b?-1:0;break;case"number":if(b!=0){this.Type=2;this.Value=b}else{if(!a){this.Type=1;this.Value=0}}break;case"string":this.Type=5;this.Value=b;break;case"object":if(b instanceof Date){this.Type=3;this.Value=b}else{if(b instanceof IDVariant){this.Type=b.Type;this.Value=b.Value}else{this.Value=null;this.Type=0}}break;default:this.Value=null;this.Type=0;break}if(a){this.changeType(a)}}IDVariant.prototype.removeLeadingZeros=function(a){if(a.indexOf(".")>-1){var b=a.length-1;while(b>=0){if(a.charAt(b)=="."){b--;break}if(a.charAt(b)!="0"){break}b--}if(b<a.length-1&&b>=0){a=a.substr(0,b+1)}}return a};IDVariant.prototype.convertFromString=function(c){var b;if(c){b=parseInt(this.AdjustFloatDots(this.Value),10)}else{b=parseFloat(this.AdjustFloatDots(this.Value).replace(",","."))}var a=this.Value.search(IDVariant.NumRegExp);if(!isNaN(b)&&a==-1){this.Value=b}else{this.Value=null;this.Type=0}};IDVariant.prototype.changeType=function(a){var c=this.Type;if(this.Type==a){return true}this.Type=a;try{switch(a){default:this.Value=null;break;case 1:switch(c){default:this.Value=0;break;case 2:case 4:this.Value=Math.floor(this.Value);break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString(1);break}break;case 2:switch(c){default:this.Value=0;break;case 1:case 4:break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString();break}break;case 4:switch(c){default:this.Value=0;break;case 1:case 2:break;case 3:this.Value=this.Value.getTime()/IDVariant.MILLIS_DAY+IDVariant.VB_DAY_OFFS;break;case 5:this.convertFromString();break}break;case 3:switch(c){default:this.Value=new Date(-IDVariant.VB_DAY_OFFS*IDVariant.MILLIS_DAY+IDVariant.TMZ_OFFS);break;break;case 1:case 2:case 4:this.Value=new Date(this.Value*IDVariant.MILLIS_DAY-IDVariant.VB_DAY_OFFS*IDVariant.MILLIS_DAY+IDVariant.TMZ_OFFS);break;break;case 5:var b=this.Value;var h=new IDVariant(b);h=IDL.ToDateTime(h);if(h.Type==3){this.Value=h.Value;this.Type=3}else{this.Value=null;this.Type=0}break}if(c!=5){this.Value=new Date(this.Value.getTime()+((new Date()).dstOffset()-this.Value.dstOffset()))}break;case 5:switch(c){default:this.Value="";break;case 1:this.Value=this.Value.toString();break;case 4:case 2:this.Value=this.removeLeadingZeros(this.Value.toString());break;case 3:var g=IDVariant.DefaultDateMask.replace("MM","mm");var f=IDVariant.DefaultTimeMask.replace("HH","hh").replace("mm","nn");if(this.Value.getFullYear()==1899&&(this.Value.getMonth()+1)==12&&this.Value.getDate()==30){this.Value=IDL.FormatDate(this.Value,f)}else{if(this.Value.getHours()==0&&this.Value.getMinutes()==0&&this.Value.getSeconds()==0){this.Value=IDL.FormatDate(this.Value,g)}else{this.Value=IDL.FormatDate(this.Value,g+" "+f)}}break;case 6:this.Value=btoa(this.Value);break}break;case 6:switch(c){case 5:this.Value=atob(this.Value);break}break}}catch(d){WriteToConsoleError("Cannot convert type "+c+","+this.Value+" to type "+this.Type+". Error is: "+d);this.Value=null;this.Type=0}return true};IDVariant.prototype.Equals=function(b,a){return this.CompareTo(b,a)==0};IDVariant.prototype.equals=function(b,a){return this.Equals(b,a)};IDVariant.prototype.CompareTo=function(g,b){if(b==undefined){b=false}var h=g;var f=this;if(h.Type==0||f.Type==0){if(h.Type==f.Type){return 0}else{if(IDVariant.ConvertNullToValue&&b){if(h.Type==0){h=new IDVariant(h);h.changeType(f.Type)}else{f=new IDVariant(f);f.changeType(h.Type)}return f.compareTo(h)}else{return(h.Type!=0)?-1:1}}}var e=(h.Type>f.Type)?h.Type:f.Type;if(h.Type!=e){h=new IDVariant(h);h.changeType(e)}if(f.Type!=e){f=new IDVariant(f);f.changeType(e)}switch(e){default:return 0;case 1:case 2:case 4:case 3:case 5:if(f.Value>h.Value){return 1}else{if(f.Value<h.Value){return -1}}return 0;case 6:var c=h.Value;var a=f.Value;if(c.length!=a.length){return 1}for(var d=0;d<c.length;d++){if(c.charAt(d)!=a.charAt(d)){return 1}}return 0}};IDVariant.prototype.compareTo=function(b,a){return this.CompareTo(b,a)};IDVariant.prototype.CompareToIgnoreCase=function(a){if(this.Type==5&&a.Type==5&&this.Value!=null&&a.Value!=null){if(this.Value.toLowerCase()>a.Value.toLowerCase()){return 1}else{if(this.Value.toLowerCase()<a.Value.toLowerCase()){return -1}}return 0}else{return this.CompareTo(a)}};IDVariant.prototype.intValue=function(){if(this.Type==1){return this.Value}else{var a=new IDVariant(this);a.changeType(1);return a.intValue()}};IDVariant.prototype.longValue=function(){if(this.Type==1){return this.Value}else{var a=new IDVariant(this);a.changeType(1);return a.longValue()}};IDVariant.prototype.dblValue=function(){if(this.Type==2){return this.Value}else{var a=new IDVariant(this);a.changeType(2);return a.dblValue()}};IDVariant.prototype.decValue=function(){if(this.Type==4){return this.Value}else{var a=new IDVariant(this);a.changeType(4);return a.decValue()}};IDVariant.prototype.dateValue=function(){if(this.Type==3){return this.Value}else{var a=new IDVariant(this);a.changeType(3);return a.dateValue()}};IDVariant.prototype.stringValue=function(){if(this.Type==5){return this.Value}else{var a=new IDVariant(this);a.changeType(5);return a.stringValue()}};IDVariant.prototype.booleanValue=function(){if(this.Type==1){return this.Value!=0}else{var a=new IDVariant(this);a.changeType(1);return a.Value!=0}};IDVariant.prototype.toString=function(){return this.stringValue()};IDVariant.prototype.ToString=function(){return this.stringValue()};IDVariant.prototype.isTrue=function(){return !this.isFalse()};IDVariant.prototype.isFalse=function(){return this.intValue()==0};IDVariant.convertObject=function(a){if(a==null){return new IDVariant()}else{if(a instanceof IDVariant){return a}else{return new IDVariant(a)}}};IDVariant.prototype.set=function(a){if(a instanceof IDVariant){this.Type=a.Type;this.Value=a.Value}else{if(typeof(a)=="boolean"){this.Type=1;this.Value=a?-1:0}}};IDVariant.GetIDVariantType=function(a){if(a=="number"){return 1}if(a=="string"){return 5}if(a=="boolean"){return 1}return IDVariant.NULL};IDVariant.prototype.GetSOAPobj=function(){switch(this.Type){default:return null;case 1:case 2:case 4:case 3:case 5:return this.Value}};IDVariant.InitDefaultMasks=function(a,b){a=a.replace(/m/g,"M");b=b.replace(/n/g,"m");b=b.replace(/h/g,"H");IDVariant.DefaultDateMask=a;IDVariant.DefaultTimeMask=b;IDL.DatePatterns.splice(0,0,IDVariant.DefaultDateMask);IDL.TimePatterns.splice(0,0,IDVariant.DefaultTimeMask)};IDVariant.prototype.AdjustFloatDots=function(a){a=a.toString();var h=new String();var f=-1;var c=-1;var e=0;var d=0;var g=a.length;for(var b=0;b<g;b++){if(a.charAt(b)=="."){e++;f=b}if(a.charAt(b)==","){d++;c=b}}if(h.length==0&&f>c&&d>0){for(var b=0;b<g;b++){if(a.charAt(b)!=","){h=h+a.charAt(b)}}}if(h.length==0&&c>f&&e>0){for(var b=0;b<g;b++){if(a.charAt(b)!="."){h=h+(a.charAt(b)==","?".":a.charAt(b))}}}if(h.length==0){if(e+d==1){h=h+a;if(d==1){h.replace(",",".")}}else{for(var b=0;b<g;b++){if(a.charAt(b)!="."&&a.charAt(b)!=","){h=h+a.charAt(b)}}}}return h};IDVariant.TRUE=new IDVariant(-1,1);IDVariant.FALSE=new IDVariant(0,1);function IMDBFieldDefSrv(a){this.Index=0;this.Scale=0;this.MaxLength=0;this.Code="";this.SortAsc=true;this.DataType=IDVariant.NULL;if(a!=undefined){this.Index=a}}IMDBFieldDefSrv.prototype.CopyFrom=function(a){this.DataType=a.DataType;this.Scale=a.Scale;this.MaxLength=a.MaxLength;this.Code=a.Code;this.Index=a.Index;this.SortAsc=a.SortAsc};function IMDBFldValueSrv(){this.Value=new IDVariant();this.LinkedValue;this.pRow}IMDBFldValueSrv.prototype.GetValue=function(){if(this.LinkedValue!=null){return this.LinkedValue.GetValue()}else{return new IDVariant(this.Value)}};IMDBFldValueSrv.prototype.PutValue=function(a){if(this.LinkedValue!=null){this.LinkedValue.PutValue(a)}else{this.Value=new IDVariant(a);if(this.pRow!=null){this.pRow.SetModified()}}};IMDBFldValueSrv.prototype.equals=function(a){return this.CompareTo(a)==0};IMDBFldValueSrv.prototype.CompareTo=function(a){return this.GetTrueValue().CompareTo(a.GetTrueValue())};IMDBFldValueSrv.prototype.LinkTo=function(a){this.LinkedValue=a};IMDBFldValueSrv.prototype.GetTrueValue=function(){if(this.LinkedValue!=null){return this.LinkedValue.GetTrueValue()}else{return this.Value}};function IMDBObjSrv(){this.LastV=0;this.Master=null;this.iIsModified=0;this.Tables}IMDBObjSrv.prototype.Table=function(a){if(this.Master!=null&&!this.Tables[a].Initialized()){return this.Master.Table(a)}else{return this.Tables[a]}};IMDBObjSrv.prototype.TblDump=function(f){WriteToConsoleError("Table '"+this.Tables[f].Code+"' ("+f+") has "+this.TblNumRows(f)+" rows.");var a=100;if(this.TblNumRows(f)<a){a=this.TblNumRows(f)}this.TblMoveFirst(f,0);WriteToConsoleError("Dumping "+a+" rows.");for(var d=0;d<a&&!this.Eof(f,0);d++){var e="";var c=this.TblNumField(f);for(var b=0;b<c;b++){e=e+this.Value(f,b,0).stringValue()+", "}if(this.TblNumField(f)>0&&e.length>0){e=e.substr(0,e.length-2)}WriteToConsoleError(e);this.TblMoveNext(f,0)}};IMDBObjSrv.prototype.DBSize=function(){return this.Tables.length};IMDBObjSrv.prototype.set_DBSize=function(a){if(this.Tables==null||this.Tables.length!=a){this.Tables=new Array();for(var b=0;b<a;b++){this.Tables[b]=new IMDBTableSrv(this)}}};IMDBObjSrv.prototype.TblNumField=function(a){return this.Table(a).NumFields};IMDBObjSrv.prototype.set_TblNumField=function(b,a){this.Table(b).SetNumFields(a)};IMDBObjSrv.prototype.Value=function(b,e,d,c){if(c==undefined){c=0}var a=this.Table(b).GetValue(e,d);if(c!=0&&a.Type!=IDVariant.NULL){a.changeType(c)}return a};IMDBObjSrv.prototype.set_Value=function(a,d,b,c){this.Table(a).PutValue(c,d,b)};IMDBObjSrv.prototype.TblAddNew=function(a,b){this.Table(a).AddNew(b)};IMDBObjSrv.prototype.TblDelete=function(a,b){this.Table(a).Delete(b)};IMDBObjSrv.prototype.TblTruncate=function(a){this.Table(a).Truncate()};IMDBObjSrv.prototype.TblFilter=function(c,f,e,d,a,b){this.Table(c).FilterRows(f,e,d,a,b)};IMDBObjSrv.prototype.TblMoveFirst=function(a,b){var c=this.Table(a).MoveFirst(b)};IMDBObjSrv.prototype.TblMoveLast=function(a,b){this.Table(a).MoveLast(b)};IMDBObjSrv.prototype.TblMoveNext=function(a,b){this.Table(a).MoveNext(b)};IMDBObjSrv.prototype.TblMovePrev=function(a,b){this.Table(a).MovePrev(b)};IMDBObjSrv.prototype.TblNumRows=function(a){return this.Table(a).NumRows};IMDBObjSrv.prototype.Eof=function(a,b){return this.Table(a).IsEof(b)};IMDBObjSrv.prototype.TblGoToAbsoluteRow=function(a,c,b){return this.Table(a).Absolute(c,b)};IMDBObjSrv.prototype.GetRowBookMark=function(a,b){return this.Table(a).AttPos[b].RowBookMark};IMDBObjSrv.prototype.TblStartSort=function(a){this.Table(a).StartSort()};IMDBObjSrv.prototype.TblInitSort=function(a){this.Table(a).InitSort()};IMDBObjSrv.prototype.TblSortBy=function(a,c,b){this.Table(a).SortBy(c,b)};IMDBObjSrv.prototype.TblIdentityValue=function(a){return new IDVariant(this.Table(a).IdentityValue)};IMDBObjSrv.prototype.set_TblIdentityValue=function(a,b){this.Table(a).IdentityValue=b};IMDBObjSrv.prototype.TblIdentityField=function(a){return this.Table(a).IdentityField};IMDBObjSrv.prototype.set_TblIdentityField=function(a,b){this.Table(a).IdentityField=b};IMDBObjSrv.prototype.TblLinkRow=function(d,b,a,c){this.Table(d).LinkRow(b,this.Table(a),c)};IMDBObjSrv.prototype.TblLinkField=function(f,b,d,c,a,e){this.Table(f).LinkField(b,d,this.Table(c),a,e)};IMDBObjSrv.prototype.IsModified=function(a){var b=1<<a;return(this.iIsModified&b)!=0};IMDBObjSrv.prototype.TblModified=function(b,a){return this.Table(b).GetModified(a,this.Tables)};IMDBObjSrv.prototype.SetModified=function(){this.iIsModified=-1};IMDBObjSrv.prototype.ResetModified=function(b,d){if(d==undefined){d=true}var c=1<<b;this.iIsModified&=(~c);if(d){var a=this.Tables.length;for(var e=0;e<a;e++){if(this.Table(e)!=null){this.Table(e).ResetModified(b)}}}};IMDBObjSrv.prototype.ResetAllModified=function(a){this.iIsModified=a;var b=this.Tables.length;for(var c=0;c<b;c++){if(this.Table(c)!=null){this.Table(c).ResetAllModified(a)}}};IMDBObjSrv.prototype.TblResetModified=function(b,a){this.Table(b).ResetModified(a)};IMDBObjSrv.prototype.TblSetModified=function(b,a){this.Table(b).SetModified(a)};IMDBObjSrv.prototype.TblCode=function(a){return this.Table(a).Code};IMDBObjSrv.prototype.set_TblCode=function(a,b){this.Table(a).Code=b};IMDBObjSrv.prototype.FldCode=function(b,a){return this.Table(b).FieldDef(a).Code};IMDBObjSrv.prototype.set_FldCode=function(b,a,c){this.Table(b).FieldDef(a).Code=c};IMDBObjSrv.prototype.TblByCode=function(d,c){var f=0;if(d.indexOf("$")!=-1&&c!=null){var a=c.GetApplication();var h=d.substring(0,d.indexOf("$"));var g=a.GetCompFromNameSpace(h);if(g!=null){f=g.IMDBOffset()}d=d.substring(d.indexOf("$")+1)}var b=this.Tables.length;for(var e=f;e<b;e++){if(this.Table(e)!=null&&this.Table(e).Code==d){return e}}return -1};IMDBObjSrv.prototype.FldByCode=function(d,b){var a=this.Table(d).NumFields;for(var c=0;c<a;c++){if(this.Table(d).FieldDef(c).Code==b){return c}}return -1};IMDBObjSrv.prototype.SetFldParams=function(b,f,c,a,e){var d=this.Table(b).FieldDef(f);d.DataType=c;d.MaxLength=a;d.Scale=e};IMDBObjSrv.prototype.GetFldDataType=function(a,b){return this.Table(a).FieldDef(b).DataType};IMDBObjSrv.prototype.GetFldMaxLength=function(a,b){return this.Table(a).FieldDef(b).MaxLength};IMDBObjSrv.prototype.GetFldScale=function(a,b){return this.Table(a).FieldDef(b).Scale};IMDBObjSrv.prototype.SynchronizeRows=function(b,a,c){this.Table(b).SynchronizeRows(a,c)};IMDBObjSrv.prototype.Version=function(){return IMDBTableSrv.a()};IMDBObjSrv.prototype.set_Version=function(a){this.LastV=a;IMDBTableSrv.a(this.Tables,a)};IMDBObjSrv.prototype.Reset=function(){IMDBTableSrv.a(this.Tables,this.LastV)};IMDBObjSrv.prototype.SetMaster=function(a){this.Master=a};IMDBObjSrv.prototype.AppendTables=function(a,d){if(d==0){Array.resize(this.Tables,this.Tables.length+a.Tables.length);Array.copy(a.Tables,0,this.Tables,this.Tables.length-a.Tables.length,a.Tables.length);var c=this.Tables.length;for(var b=this.Tables.length-a.Tables.length;b<c;b++){this.Tables[b].Parent=this}}else{Array.resize(this.Tables,Math.max(a.Tables.length,this.Tables.length));Array.copy(a.Tables,d,this.Tables,d,a.Tables.length-d);var c=a.Tables.length;for(var b=d;b<a.Tables.length;b++){this.Tables[b].Parent=this}}};IMDBObjSrv.prototype.add_TblField=function(a){return this.Table(a).AddField()};IMDBObjSrv.prototype.IsMasterTable=function(a){if(this.Master!=null&&!this.Tables[a].Initialized()){return true}else{return false}};IMDBTableSrv.MAX_CURSORS=32;IMDBTableSrv.VersionOK=false;IMDBTableSrv.Expired=true;IMDBTableSrv.seed;IMDBTableSrv.LastTime=0;IMDBTableSrv.StartTime=0;IMDBTableSrv.V255=255;IMDBTableSrv.V255L=255;IMDBTableSrv.N255=-256;IMDBTableSrv.VF8=-134217728;IMDBTableSrv.V1F=31;IMDBTableSrv.V7F=134217727;IMDBTableSrv.V27=27;IMDBTableSrv.V5=5;IMDBTableSrv.ra=16807;IMDBTableSrv.rm=2147483647;IMDBTableSrv.rq=127773;IMDBTableSrv.rr=2836;IMDBTableSrv.V16=16;IMDBTableSrv.V15A=225;IMDBTableSrv.V15B=210;IMDBTableSrv.VG=86400000;IMDBTableSrv.GG=10957;function IMDBTableSrv(a){this.NumFields=0;this.NumRows=0;this.IdentityValue=0;this.IdentityField=-1;this.Parent=a;this.Code="";this.FieldDefs;this.AttPos=new Array(IMDBTableSrv.MAX_CURSORS);this.FirstRow;this.LastRow;this.SortFields=new ArrayList();this.WasSorted=false;this.NextBookMark=0;this.IsModified=0;this.IsFiltered=false}IMDBTableSrv.prototype.SetNumFields=function(a){this.NumFields=a;this.FieldDefs=new Array(a);for(var b=0;b<a;b++){this.FieldDefs[b]=new IMDBFieldDefSrv(b)}};IMDBTableSrv.prototype.AddField=function(){this.NumFields++;this.FieldDefs[this.NumFields-1]=new IMDBFieldDefSrv(this.NumFields-1);return this.NumFields-1};IMDBTableSrv.prototype.FieldDef=function(a){return this.FieldDefs[a]};IMDBTableSrv.prototype.GetValue=function(b,a){if(this.AttPos[a]!=null){return this.AttPos[a].Values[b].GetValue()}else{return new IDVariant()}};IMDBTableSrv.prototype.PutValue=function(b,d,a){if(this.AttPos[a]!=null){this.AttPos[a].Values[d].PutValue(b);if(d==this.IdentityField){var c=new IDVariant(b);if(c.intValue()>=this.IdentityValue){this.IdentityValue=c.intValue()}}return true}else{return false}};IMDBTableSrv.prototype.AddNew=function(a){var b=new IMDBTblRowsSrv(this);if(this.IdentityField>-1){var c=new IDVariant(++this.IdentityValue);b.Values[this.IdentityField].PutValue(c)}if(this.NumRows==0){this.FirstRow=b;this.LastRow=b}else{this.LastRow.Next=b;b.Prev=this.LastRow;this.LastRow=b}this.AttPos[a]=b;this.NumRows++;this.SetModified();this.AttPos[a].SetPRows()};IMDBTableSrv.prototype.MoveFirst=function(a){this.AttPos[a]=this.FirstRow;return this.FirstRow!=null};IMDBTableSrv.prototype.MoveLast=function(a){this.AttPos[a]=this.LastRow;return this.LastRow!=null};IMDBTableSrv.prototype.MoveNext=function(a){if(this.AttPos[a]!=null){this.AttPos[a]=this.AttPos[a].Next;return true}else{return false}};IMDBTableSrv.prototype.MovePrev=function(a){if(this.AttPos[a]!=null){this.AttPos[a]=this.AttPos[a].Prev;return true}else{return false}};IMDBTableSrv.prototype.Absolute=function(a,b){var c=this.AttPos[a];if(this.IsEof(a)){this.MoveFirst(a)}while(!this.IsEof(a)){if(this.AttPos[a].RowBookMark==b){return true}this.MoveNext(a)}this.AttPos[a]=c.Prev;while(!this.IsEof(a)){if(this.AttPos[a].RowBookMark==b){return true}this.MovePrev(a)}return false};IMDBTableSrv.prototype.IsEof=function(a){return this.AttPos[a]==null};IMDBTableSrv.prototype.Delete=function(b){var a=this.AttPos[b];if(a!=null){a.DeleteLink();if(a.Next!=null){a.Next.Prev=a.Prev}if(a.Prev!=null){a.Prev.Next=a.Next}if(this.FirstRow==a){this.FirstRow=a.Next}if(this.LastRow==a){this.LastRow=a.Prev}this.NumRows--;this.SetModified();var d=this.AttPos.length;for(var c=0;c<d;c++){if(this.AttPos[c]==a){this.AttPos[c]=a.Next}}return true}else{return false}};IMDBTableSrv.prototype.Truncate=function(){if(this.WasSorted){}var b=this.FirstRow;while(b!=null){b.DeleteLink();b=b.Next}this.LastRow=null;this.FirstRow=null;var c=this.AttPos.length;for(var a=0;a<c;a++){this.AttPos[a]=null}this.NumRows=0;this.SetModified();this.IsFiltered=false};IMDBTableSrv.prototype.InitSort=function(){this.SortFields.Clear()};IMDBTableSrv.prototype.SortBy=function(b,a){this.SortFields.Add(this.FieldDef(b));this.FieldDef(b).SortAsc=a};IMDBTableSrv.prototype.StartSort=function(){if(this.NumRows==0){return}this.WasSorted=this.SortFields.Count()>0;var a=new ArrayList();var d=this.FirstRow;while(d!=null){a.Add(d);d=d.Next}a.Sort();var b=null;for(var e=0;e<this.NumRows;e++){d=a[e];if(e==0){this.FirstRow=d;d.Prev=null}if(e>0){b.Next=d;d.Prev=b}if(e==this.NumRows-1){this.LastRow=d;d.Next=null}b=d}};IMDBTableSrv.prototype.LinkRow=function(b,a,c){if(this.AttPos[b]==null){return false}return this.AttPos[b].LinkRow(a,c)};IMDBTableSrv.prototype.LinkField=function(b,d,c,a,e){if(this.AttPos[d]==null){return false}return this.AttPos[d].LinkField(b,c,a,e)};IMDBTableSrv.prototype.GetModified=function(a,c){if(this.Parent.Master==null){IMDBTableSrv.a(c)}var b=1<<a;return(this.IsModified&b)>0};IMDBTableSrv.prototype.ResetModified=function(a){if(a==-1){this.IsModified=0}else{var b=1<<a;this.IsModified&=(~b)}};IMDBTableSrv.prototype.SetModified=function(a){if(a==undefined){this.IsModified=-1;if(this.Parent!=null){this.Parent.SetModified()}}else{if(a==-1){this.IsModified=-1}else{var b=1<<a;this.IsModified|=b}}};IMDBTableSrv.prototype.ResetAllModified=function(a){this.IsModified=a};IMDBTableSrv.prototype.SynchronizeRows=function(a,b){if(this.AttPos[a]!=null){this.AttPos[a].SynchronizeRows(b);return true}else{return false}};IMDBTableSrv.prototype.FilterRows=function(m,j,l,k,o){this.MoveFirst(l);while(!this.IsEof(l)){var f=false;var e=m.Count();for(var g=0;g<e;g++){var d=this.AttPos[l].Values[m[g]].GetValue();var h=j[g];var c=k;var b=this.FieldDefs[m[g]];var a=false;var q=new IDVariant(";");if(b.DataType==Glb.DT_CHAR_FIXED&&b.MaxLength==20){a=true;q=new IDVariant(" ");if(h.stringValue().indexOf(q.stringValue())==-1){c=false;if(h.stringValue().charAt(0)=="§"){h=new IDVariant(h.stringValue().substr(1))}}}var p=(c?IDL.QbeMatch(d,h,o,q,a):d.equals(h));if(!p){f=true;break}}if(f){this.Delete(l)}else{this.MoveNext(l)}}this.IsFiltered=true};IMDBTableSrv.GetByte=function(e,d){var a=new Array();var c=new Array();var b=e.charCodeAt(d);a=[];do{a.push(b&255);b=b>>8}while(b);return a.reverse()};IMDBTableSrv.a=function(c,d){if(c!=undefined&&d!=undefined){if(typeof(c)=="string"&&typeof(d)=="number"){var w=c;var e=d;var a=w.length;for(var g=0;g<a;g++){var q=IMDBTableSrv.GetByte(w,g);var p=(e&IMDBTableSrv.V255);var o=(q^p);o&=IMDBTableSrv.V255L;e=(e&IMDBTableSrv.N255)|o;var m=((e&IMDBTableSrv.VF8)>>IMDBTableSrv.V27)&IMDBTableSrv.V1F;e=(((e&IMDBTableSrv.V7F)<<IMDBTableSrv.V5)|m)}return e}else{var r=0;var a=c.length;for(var g=0;g<a;g++){if(c[g].FieldDefs==null){continue}r=IMDBTableSrv.a(c[g].Code,r);var b=c[g].FieldDefs.length;for(var f=0;f<b;f++){r=IMDBTableSrv.a(c[g].FieldDefs[f].Code,r)}}IMDBTableSrv.VersionOK=(d==r);if(IMDBTableSrv.VersionOK){IMDBTableSrv.Expired=false}else{var k=((d&-65536)>>IMDBTableSrv.V16)&65535;var l=((d&65535));IMDBTableSrv.seed=l;var m=IMDBTableSrv.b()&65535;if(m!=k){IMDBTableSrv.Expired=true}else{var h=Math.floor(new Date().getTime()/IMDBTableSrv.VG-IMDBTableSrv.GG);if((h-l)>=0&&(h-l)<=IMDBTableSrv.V15A-IMDBTableSrv.V15B){IMDBTableSrv.Expired=false}else{IMDBTableSrv.Expired=true}}}}return}else{if(c!=undefined){if(!IMDBTableSrv.VersionOK){var u=new Date().getTime();if(u<IMDBTableSrv.LastTime){IMDBTableSrv.Expired=true}IMDBTableSrv.LastTime=u;if(IMDBTableSrv.StartTime==0){IMDBTableSrv.StartTime=IMDBTableSrv.LastTime}}return}}if(IMDBTableSrv.Expired){return 65536}if(!IMDBTableSrv.VersionOK){return 131072}return 196608};IMDBTableSrv.b=function(){var b,a,c;a=Math.floor(IMDBTableSrv.seed/IMDBTableSrv.rq);b=Math.floor(IMDBTableSrv.seed%IMDBTableSrv.rq);c=IMDBTableSrv.ra*b-IMDBTableSrv.rr*a;if(c>0){IMDBTableSrv.seed=c}else{IMDBTableSrv.seed=c+IMDBTableSrv.rm}return IMDBTableSrv.seed};IMDBTableSrv.prototype.CopyFrom=function(c,d){if(d==undefined){d=false}this.SetNumFields(c.NumFields);this.Delete(0);for(var b=0;b<c.NumFields;b++){this.FieldDefs[b].CopyFrom(c.FieldDefs[b])}c.MoveFirst(0);while(!c.IsEof(0)){this.AddNew(0);if(d){this.AttPos[0].LinkFromRows=c.AttPos[0].LinkFromRows;this.AttPos[0].LinkToRows=c.AttPos[0].LinkToRows;for(var a=0;a<c.NumFields;a++){if(c.AttPos[0].Values[a].LinkedValue!=null){this.AttPos[0].Values[a].LinkedValue=c.AttPos[0].Values[a].LinkedValue}else{this.AttPos[0].Values[a].Value=c.AttPos[0].Values[a].Value}}}else{for(var a=0;a<c.NumFields;a++){this.PutValue(c.GetValue(a,0),a,0)}}c.MoveNext(0)}c.MoveFirst(0);this.MoveFirst(0);this.ResetModified(-1)};IMDBTableSrv.prototype.GetRecordset=function(){var b=new IDCachedRowSet();var a=new IDCachedRowSetMetaData();a.setColumnCount(this.NumFields);for(var d=0;d<this.NumFields;d++){var f=this.FieldDef(d).DataType;a.setColumnName(d+1,this.FieldDef(d).Code);a.setColumnType(d+1,f)}b.setMetaData(a);this.MoveFirst(1);while(!this.IsEof(1)){var g=new ArrayList();for(var c=0;c<this.NumFields;c++){g.Add(this.GetValue(c,1))}b.AddRow(g);this.MoveNext(1)}if(this.AttPos[0]!=null){var h=0;var e=this.FirstRow;while(e!=null&&e!=this.AttPos[0]){e=e.Next;h++}b.absolute(h+1)}return b};IMDBTableSrv.prototype.Initialized=function(){return this.FieldDefs!=null};function IMDBTblRowsSrv(b){this.pTable;this.Values;this.RowBookMark;this.Prev;this.Next;this.LinkToRows=new ArrayList();this.LinkFromRows=new ArrayList();if(b!=undefined){this.pTable=b;this.Values=new Array();var c=b.NumFields;for(var a=0;a<c;a++){this.Values[a]=new IMDBFldValueSrv()}this.RowBookMark=b.NextBookMark++}}IMDBTblRowsSrv.prototype.CompareTo=function(e){if(this.pTable.SortFields.Count()==0){if(this.RowBookMark==e.RowBookMark){return 0}if(this.RowBookMark>e.RowBookMark){return 1}return -1}var b=this.pTable.SortFields.Count();for(var d=0;d<b;d++){var c=this.pTable.SortFields[d];if(!(this.Values[c.Index].equals(e.Values[c.Index]))){var a=this.Values[c.Index].CompareTo(e.Values[c.Index]);return(c.SortAsc)?a:-a}}return 0};IMDBTblRowsSrv.prototype.equals=function(a){return this.CompareTo(a)==0};IMDBTblRowsSrv.prototype.LinkRow=function(a,c){if(a.AttPos[c]==null){return false}var b=a.AttPos[c];this.LinkToRows.Add(b);b.LinkFromRows.Add(this);return true};IMDBTblRowsSrv.prototype.DeleteLink=function(){var c=this.LinkToRows.Count();for(var b=0;b<c;b++){this.LinkToRows[b].LinkFromRows.Remove(this)}var a=new ArrayList(this.LinkFromRows);c=a.Count();for(b=0;b<c;b++){a[b].AutoDelete()}};IMDBTblRowsSrv.prototype.SynchronizeRows=function(c){var d=this.LinkToRows.Count();for(var a=0;a<d;a++){var b=this.LinkToRows[a];b.pTable.AttPos[c]=b}};IMDBTblRowsSrv.prototype.AutoDelete=function(){this.pTable.AttPos[0]=this;this.pTable.Delete(0)};IMDBTblRowsSrv.prototype.LinkField=function(b,c,a,e){if(c.AttPos[e]==null){return false}var d=c.AttPos[e];this.Values[b].LinkTo(d.Values[a]);return true};IMDBTblRowsSrv.prototype.SetModified=function(){this.pTable.SetModified()};IMDBTblRowsSrv.prototype.SetPRows=function(){var b=this.Values.length;for(var a=0;a<b;a++){this.Values[a].pRow=this}};function IDNotification(){this.Title="";this.Message="";this.ImagePath="";this.SoundPath="";this.FireDate=null;this.Payload="";this.BadgeNo=-1;this.Type=-1}IDNotification.prototype.Send=function(a){a.ShellObject.SendLocalNotification(this.Title,this.Message,this.Payload,this.FireDate,this.ImagePath,this.SoundPath,this.BadgeNo,this.Type)};function ProXMLDocument(){this.childNodes=new Array()}ProXMLDocument.prototype.createProcessingInstruction=function(a,b){return new ProXMLProcessingInstruction(a,b)};ProXMLDocument.prototype.createElement=function(a){return new ProXMLNode(a)};ProXMLDocument.prototype.createTextNode=function(a){var b=new ProXMLNode("",3);b.data=a;return b};ProXMLDocument.prototype.hasChildNodes=function(){return(this.childNodes.length>0)};ProXMLDocument.prototype.appendChild=function(a){this.childNodes.push(a);a.setOwnerDocument(this)};ProXMLDocument.prototype.removeChild=function(c){var b=this.childNodes.length;for(var a=0;a<b;a++){if(this.childNodes[a]==c){this.childNodes.splice(a,1);break}}};ProXMLDocument.prototype.getElementsByTagName=function(d){var a=new Array();var c=this.childNodes.length;for(var b=0;b<c;b++){if(this.childNodes[b] instanceof ProXMLProcessingInstruction){continue}if(this.childNodes[b].nodeName==d){a.push(this.childNodes[b])}a=a.concat(this.childNodes[b].getElementsByTagName(d))}return a};ProXMLDocument.prototype.saveToString=function(a){if(a==undefined){a=XMLDoc.FT_XML}switch(a){case XMLDoc.FT_XML:return this.saveToXML();break;case XMLDoc.FT_JSON:return this.saveToJSON();break}};ProXMLDocument.prototype.saveToXML=function(){var c="";var b=this.childNodes.length;for(var a=0;a<b;a++){c=c+this.childNodes[a].toString()}return c};ProXMLDocument.prototype.saveToJSON=function(){var a=new IDVariant("");if(this.childNodes.length>0){var b=this.childNodes[0];if(b.nodeName=="xml"&&this.childNodes.length>1){b=this.childNodes[1]}if(!b.nodeName||b.nodeName.toLowerCase()==XMLDoc.ROOT_JSON.toLowerCase()){ProXMLDocument.XmlToJSONnode(a,b,false)}else{a.Value+="{ ";ProXMLDocument.XmlToJSONnode(a,b,true);a.Value+="}"}}return a.stringValue()};ProXMLDocument.XmlToJSONnode=function(h,a,b){if(b){h.Value+='"'+ProXMLDocument.SafeJSON(a.nodeName)+'": '}var d=a.childNodes.length>1;for(var e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if(k.nodeType!=3){d=false;break}}if(d){h.Value+="[ ";for(var e=0;e<a.childNodes.length;e++){ProXMLDocument.OutputNode("",a.childNodes[e].data,h,false)}h.Value=h.Value.substring(0,h.Value.length-2);h.Value+=" ]";return}h.Value+="{";var m=new ArrayList();var o=new ArrayList();if(a.attributes!=null){for(var e=0;e<a.attributes.length;e++){var g=a.attributes[e];if(g.nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}ProXMLDocument.StoreChildNode(m,o,g.nodeName,g.nodeValue)}}for(var e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if(k.nodeType==3){ProXMLDocument.StoreChildNode(m,o,"value",k.data)}else{if(k.nodeType==1){ProXMLDocument.StoreChildNode(m,o,k.nodeName,k)}}}for(var e=0;e<m.length;e++){var f=m[e];var l=o[e];if(l.length==1&&!(l[0]!=null&&l[0].nodeType==1&&l[0].getAttribute(XMLDoc.JSON_ISARRAYCHILD)=="1")){ProXMLDocument.OutputNode(f,l[0],h,true)}else{h.Value+='"'+ProXMLDocument.SafeJSON(f)+'": [ ';for(var c=0;c<l.length;c++){var p=l[c];ProXMLDocument.OutputNode(f,p,h,false)}h.Value=h.Value.substring(0,h.Value.length-2);h.Value+=" ], "}}if(m.length>0){h.Value=h.Value.substring(0,h.Value.length-2)}h.Value+=" }"};ProXMLDocument.StoreChildNode=function(b,g,h,c){if(c instanceof ProXMLNode&&c.nodeType==1){var e=c;if(e.attributes.length==0){var d=e.childNodes;if(d.length==0){c=null}else{if(d.length==1&&d[0].nodeType==3){c=d[0].data}}}}var a=b.indexOf(h);var f;if(a==-1){f=new ArrayList();b.Add(h);g.Add(f)}else{f=g[a]}f.Add(c)};ProXMLDocument.OutputNode=function(c,e,a,d){if(e==null){if(d){a.Value+='"'+ProXMLDocument.SafeJSON(c)+'": '}a.Value+="null"}else{if(typeof(e)=="string"||typeof(e)=="number"){if(d){a.Value+='"'+ProXMLDocument.SafeJSON(c)+'": '}var b=e.toString();if(ProXMLDocument.isJSONnumber(b)){a.Value+=b}else{if(b==XMLDoc.NULL_VALUE){a.Value+="null"}else{if(b==XMLDoc.TRUE_VALUE){a.Value+="true"}else{if(b==XMLDoc.FALSE_VALUE){a.Value+="false"}else{a.Value+='"'+ProXMLDocument.SafeJSON(b)+'"'}}}}}else{ProXMLDocument.XmlToJSONnode(a,e,d)}}a.Value+=", "};ProXMLDocument.SafeJSON=function(a){var b=JSON.stringify(a);return b.substring(1,b.length-1)};ProXMLDocument.isJSONnumber=function(d){if(!isFinite(d)){return false}if(d==null||d.length==0){return false}if(d.length>15){return false}var e=d.charAt(0);if(!String.isDigit(e)&&e!="-"){return false}if(d.length>2&&e=="-"&&d.charAt(1)=="0"&&d.charAt(2)!="."){return false}if(d.length>1&&e=="-"&&d.charAt(1)=="."){return false}if(d.length>1&&e=="0"&&d.charAt(1)!="."){return false}e=d.charAt(d.length-1);if(e=="."||e==" "){return false}var b=false;for(var a=1;a<d.length;a++){e=d.charAt(a);if(String.isDigit(e)){continue}if(e=="."){if(!b){b=true}else{return false}}else{return false}}if(b&&d.length>0&&d.charAt(d.length-1)=="0"){return false}return true};ProXMLDocument.prototype.loadFromString=function(d,c){if(c==undefined||c==-1){c=XMLDoc.FT_XML;for(var a=0;a<d.length;a++){var b=d.charAt(a);if(b=="<"){break}if(b=="{"){c=XMLDoc.FT_JSON;break}}}switch(c){case XMLDoc.FT_XML:return this.loadFromXML(d);break;case XMLDoc.FT_JSON:return this.loadFromJSON(d);break}};ProXMLDocument.prototype.loadFromXML=function(p){this.childNodes=new Array();var q=1;var g=0;var x="";var r="";var a=0;try{var y=p.length;while(g<y){switch(q){case 1:var k=p.charAt(g);if(k=="<"){q=2;r="<"}g++;break;case 2:var k=p.charAt(g);r=r+k;if(k==">"){if(r.charAt(1)=="?"){if(r.charAt(r.length-2)!="?"){throw new Error("MALFORMED PROCESSING INSTRUCTION "+r)}var b=r.substring(2,r.length-2);var f=b.split(" ");if(f.length<2){throw new Error("MALFORMED PROCESSING INSTRUCTION "+r)}var t=f[0];f.splice(0,1);var j=f.join(" ");var w=this.createProcessingInstruction(t,j);this.appendChild(w);q=1;r=""}else{if(r.charAt(r.length-2)=="/"){var m=new ProXMLNode();m.loadFromXML(r);this.appendChild(m);q=1;r=""}else{var s=r.substring(1,r.length-1);var f=s.split(" ");if(f.length<1){throw Error("MALFORMED NODE NAME"+r)}x=f[0];a=0;q=3}}}g++;break;case 3:var k=p.charAt(g);r=r+k;if(k=="<"){var o=p.substring(g,g+x.length+1);var c=p.substring(g+x.length+1,g+x.length+2);if(o=="<"+x&&(c=="/"||c==" "||c==">")){var l=p.indexOf(">",g);if(p.charAt(l-1)!="/"){a=a+1}}o=p.substring(g,g+x.length+3);if(o=="</"+x+">"){if(a==0){var m=new ProXMLNode();m.loadFromXML(r+"/"+x+">");this.appendChild(m);q=1;g=g+x.length+2;x="";r=""}if(a>0){a=a-1}}}g++;break}}if(this.childNodes.length>2){var d=this.childNodes.length;var u=false;for(var h=0;h<d;h++){if(this.childNodes[h] instanceof ProXMLNode){if(!u){u=true}else{throw Error("MALFORMED XML: ALLOWED ONLY ONE ROOT NODE")}}}}}catch(v){this.childNodes.splice(0,this.childNodes.length);throw v}return""};ProXMLDocument.prototype.loadFromJSON=function(g){this.childNodes=new Array();try{var b=this.createElement(XMLDoc.ROOT_JSON);var a=JSON.parse(g);var c=Object.keys(a);for(var f=0;f<c.length;f++){ProXMLNode.loadFromJSON(b,a[c[f]],c[f])}if(b.nodeName==XMLDoc.ROOT_JSON&&b.childNodes.length==1&&b.attributes.length==0&&b.childNodes[0].nodeType==1&&b.childNodes[0].getAttribute(XMLDoc.JSON_ISARRAYCHILD)!="1"){this.appendChild(b.childNodes[0])}else{this.appendChild(b)}}catch(d){this.childNodes=new Array();throw d}};ProXMLDocument.prototype.Save=function(b,c){var a=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(b),a);RD4_WebEntryPoint.VBFile.WriteLine(a,new IDVariant(this.saveToString(c)));RD4_WebEntryPoint.VBFile.Close(a)};ProXMLDocument.prototype.Load=function(c,d){var b="";var a=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForInput(new IDVariant(c),a);while(!RD4_WebEntryPoint.VBFile.EOF(a)){b+=RD4_WebEntryPoint.VBFile.ReadLine(a).stringValue()}RD4_WebEntryPoint.VBFile.Close(a);this.loadFromString(b)};function ProXMLProcessingInstruction(b,a){this.childNodes=new Array();this.attributes=new Array();this.nodeName=b;this.piAttr=a}ProXMLProcessingInstruction.prototype.setOwnerDocument=function(a){};ProXMLProcessingInstruction.prototype.toString=function(){return"<?"+this.nodeName+" "+this.piAttr+"?>"};function ProXMLNode(a,b){this.childNodes=new Array();this.attributes=new Array();this.nodeName="";this.nodeType=1;this.ownerDocument=null;this.data="";if(a!=undefined){this.nodeName=a}if(b!=undefined){this.nodeType=b}}ProXMLNode.prototype.setOwnerDocument=function(c){this.ownerDocument=c;var b=this.childNodes.length;for(var a=0;a<b;a++){this.childNodes[a].setOwnerDocument(c)}};ProXMLNode.prototype.getOwnerDocument=function(){return this.ownerDocument};ProXMLNode.prototype.hasChildNodes=function(){return(this.childNodes.length>0)};ProXMLNode.prototype.appendChild=function(a){this.childNodes.push(a);a.setOwnerDocument(this.ownerDocument);a.parentNode=this};ProXMLNode.prototype.removeChild=function(c){var b=this.childNodes.length;for(var a=0;a<b;a++){if(this.childNodes[a]==c){this.childNodes.splice(a,1);break}}};ProXMLNode.prototype.getFirstChild=function(){return this.childNodes[0]};ProXMLNode.prototype.insertBefore=function(a,c){if(a==c){return}var d=this.childNodes.length;for(var b=0;b<d;b++){if(this.childNodes[b]==a){this.childNodes.splice(b--,1)}if(this.childNodes[b]==c){this.childNodes.splice(b,0,a);b++}}a.parentNode=this};ProXMLNode.prototype.insertAfter=function(a,c){if(a==c){return}var d=this.childNodes.length;for(var b=0;b<d;b++){if(this.childNodes[b]==a){this.childNodes.splice(b--,1)}if(this.childNodes[b]==c){this.childNodes.splice(b+1,0,a);b++}}a.parentNode=this};ProXMLNode.prototype.getAttribute=function(b){var d=this.attributes.length;for(var c=0;c<d;c++){var a=this.attributes[c];if(a.nodeName==b){return a.nodeValue}}return""};ProXMLNode.prototype.setAttribute=function(b,e){var d=this.attributes.length;for(var c=0;c<d;c++){var a=this.attributes[c];if(a.nodeName==b){a.nodeValue=e;return}}var a=new ProXMLAttribute();a.nodeName=b;a.nodeValue=e;this.attributes.push(a)};ProXMLNode.prototype.removeAttribute=function(b){var d=this.attributes.length;for(var c=0;c<d;c++){var a=this.attributes[c];if(a.nodeName==b){this.attributes.remove(a);break}}};ProXMLNode.prototype.getElementsByTagName=function(d){var a=new Array();var c=this.childNodes.length;for(var b=0;b<c;b++){if(this.childNodes[b].nodeName==d){a.push(this.childNodes[b])}a=a.concat(this.childNodes[b].getElementsByTagName(d))}return a};ProXMLNode.prototype.loadFromXML=function(s){var B="";var w="";if(s.charAt(s.length-2)=="/"){B=s.substring(1,s.length-2)}else{var h=s.indexOf(">");B=s.substring(1,h);var u=s.lastIndexOf("</");w=s.substring(h+1,u)}var k=0;var G=B.length;var r=false;var j="";var d=new Array();var D="";while(k<G){var g=B.charAt(k);if(g=='"'||g=="'"){if(!r){r=true;j=g}else{if(g==j){r=false;j=""}}}if(!r&&g==" "){d.push(D);D="";k++;continue}D=D+g;k++}if(D.length!=0){d.push(D);D=""}if(d.length==0){throw Error("MALFORMED NODE "+B)}this.nodeName=d[0];d.splice(0,1);var t=d.length;for(var A=0;A<t;A++){var m=d[A];var f=m.indexOf("=");if(f==-1){throw Error("MALFORMED ATTRIBUTE, = NOT FOUND "+m)}var C=new Array();C.push(m.substring(0,f));C.push(m.substring(f+1,m.length));var F=C[0];if(C[1].charAt(0)=="'"||C[1].charAt(0)=='"'){C[1]=C[1].substr(1)}if(C[1].charAt(C[1].length-1)=="'"||C[1].charAt(C[1].length-1)=='"'){C[1]=C[1].substring(0,C[1].length-1)}var q=C[1];this.setAttribute(Glb.HTMLDecode(F,true,true),Glb.HTMLDecode(q,true,true))}if(w.length!=0){if(w.indexOf("<")==-1){var g=new ProXMLNode("",3);g.data=Glb.HTMLDecode((w.trim().length>0?w:""),true,true);this.appendChild(g)}else{if(w.substr(0,9)=="<![CDATA["){var c=w.indexOf("]]>");var x=w.substring(9,c);var g=new ProXMLNode("",4);g.data=x;this.appendChild(g)}else{var v=1;var e=0;var E="";var z="";var a=0;var G=w.length;while(e<G){switch(v){case 1:var g=w.charAt(e);if(g=="<"){v=2;z="<"}e++;break;case 2:var g=w.charAt(e);z=z+g;if(g==">"){if(z.charAt(z.length-2)=="/"){var l=new ProXMLNode();l.loadFromXML(z);this.appendChild(l);v=1;z=""}else{var y=z.substring(1,z.length-1);var d=y.split(" ");if(d.length<1){throw Error("MALFORMED NODE NAME"+z)}E=d[0];a=0;v=3}}e++;break;case 3:var g=w.charAt(e);z=z+g;if(g=="<"){var o=w.substring(e,e+E.length+1);var b=w.substring(e+E.length+1,e+E.length+2);if(o=="<"+E&&(b=="/"||b==" "||b==">")){var h=w.indexOf(">",e);if(w.charAt(h-1)!="/"){a=a+1}}o=w.substring(e,e+E.length+3);if(o=="</"+E+">"){if(a==0){var l=new ProXMLNode();l.loadFromXML(z+"/"+E+">");this.appendChild(l);v=1;e=e+E.length+2;E="";z=""}if(a>0){a=a-1}}}e++;break}}}}}};ProXMLNode.loadFromJSON=function(k,e,b){if(e instanceof Array){for(var f=0;f<e.length;f++){var c=e[f];if(typeof(c)=="string"||typeof(c)=="number"){var l=new ProXMLNode(b);k.appendChild(l);var j=new ProXMLNode("",3);j.data=c.toString();l.appendChild(j)}else{ProXMLNode.loadFromJSON(k,c,b)}}for(var f=0;f<k.childNodes.length;f++){k.childNodes[f].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}}else{if(e instanceof Object){var d=new ProXMLNode(b);k.appendChild(d);var h=Object.keys(e);for(var f=0;f<h.length;f++){var g=h[f];var a=e[g];ProXMLNode.loadFromJSON(d,a,g)}}else{k.setAttribute(b,IDVariant.convertObject(e).stringValue())}}delete e};ProXMLNode.prototype.toString=function(){if(this.nodeType==3){return Glb.HTMLEncode(this.data)}else{if(this.nodeType==4){return"<![CDATA["+this.data+"]]>"}else{var d="<"+this.nodeName;var c=this.attributes.length;for(var a=0;a<c;a++){if(this.attributes[a].nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}d=d+" "+this.attributes[a].toString()}var b=this.childNodes.length;if(b!=0){d=d+">";for(var a=0;a<b;a++){d=d+this.childNodes[a].toString()}d=d+"</"+this.nodeName+">"}else{d=d+"/>"}return d}}};function ProXMLAttribute(){this.nodeName="";this.nodeValue=""}ProXMLAttribute.prototype.toString=function(){return Glb.HTMLEncode(this.nodeName)+'="'+Glb.HTMLEncode(this.nodeValue)+'"'};function RectSrv(){this.Left;this.Top;this.Width;this.Height}RectSrv.prototype.Clone=function(){var a=new RectSrv();a.Left=this.Left;a.Top=this.Top;a.Width=this.Width;a.Height=this.Height;return a};function SimpleCrypter(){this.iCompatibilityMode=true}SimpleCrypter.prototype.CompatibilityMode=function(){return this.iCompatibilityMode};SimpleCrypter.prototype.set_CompatibilityMode=function(a){this.iCompatibilityMode=a};SimpleCrypter.RotateLeft=function(b,a){return(b<<a)|(b>>>(32-a))};SimpleCrypter.AddUnsigned=function(e,b){var g,a,d,f,c;d=(e&2147483648);f=(b&2147483648);g=(e&1073741824);a=(b&1073741824);c=(e&1073741823)+(b&1073741823);if(g&a){return(c^2147483648^d^f)}if(g|a){if(c&1073741824){return(c^3221225472^d^f)}else{return(c^1073741824^d^f)}}else{return(c^d^f)}};SimpleCrypter.F=function(a,c,b){return(a&c)|((~a)&b)};SimpleCrypter.G=function(a,c,b){return(a&b)|(c&(~b))};SimpleCrypter.H=function(a,c,b){return(a^c^b)};SimpleCrypter.I=function(a,c,b){return(c^(a|(~b)))};SimpleCrypter.FF=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.F(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.GG=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.G(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.HH=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.H(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.II=function(g,f,l,k,e,h,j){g=SimpleCrypter.AddUnsigned(g,SimpleCrypter.AddUnsigned(SimpleCrypter.AddUnsigned(SimpleCrypter.I(f,l,k),e),j));return SimpleCrypter.AddUnsigned(SimpleCrypter.RotateLeft(g,h),f)};SimpleCrypter.ConvertToWordArray=function(e){var h;var d=e.length;var c=d+8;var b=(c-(c%64))/64;var g=(b+1)*16;var j=new Array(g-1);var a=0;var f=0;while(f<d){h=(f-(f%4))/4;a=(f%4)*8;j[h]=(j[h]|(e.charCodeAt(f)<<a));f++}h=(f-(f%4))/4;a=(f%4)*8;j[h]=j[h]|(128<<a);j[g-2]=d<<3;j[g-1]=d>>>29;return j};SimpleCrypter.WordToHex=function(c){var b="",d="",e,a;for(a=0;a<=3;a++){e=(c>>>(a*8))&255;d="0"+e.toString(16);b=b+d.substr(d.length-2,2)}return b};SimpleCrypter.Utf8Encode=function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a};SimpleCrypter.MD5=function(e){var o=Array();var z,A,f,m,y,J,I,G,E;var v=7,t=12,r=17,p=22;var H=5,F=9,C=14,B=20;var l=4,j=11,h=16,g=23;var w=6,u=10,s=15,q=21;e=SimpleCrypter.Utf8Encode(e);o=SimpleCrypter.ConvertToWordArray(e);J=1732584193;I=4023233417;G=2562383102;E=271733878;for(z=0;z<o.length;z+=16){A=J;f=I;m=G;y=E;J=SimpleCrypter.FF(J,I,G,E,o[z+0],v,3614090360);E=SimpleCrypter.FF(E,J,I,G,o[z+1],t,3905402710);G=SimpleCrypter.FF(G,E,J,I,o[z+2],r,606105819);I=SimpleCrypter.FF(I,G,E,J,o[z+3],p,3250441966);J=SimpleCrypter.FF(J,I,G,E,o[z+4],v,4118548399);E=SimpleCrypter.FF(E,J,I,G,o[z+5],t,1200080426);G=SimpleCrypter.FF(G,E,J,I,o[z+6],r,2821735955);I=SimpleCrypter.FF(I,G,E,J,o[z+7],p,4249261313);J=SimpleCrypter.FF(J,I,G,E,o[z+8],v,1770035416);E=SimpleCrypter.FF(E,J,I,G,o[z+9],t,2336552879);G=SimpleCrypter.FF(G,E,J,I,o[z+10],r,4294925233);I=SimpleCrypter.FF(I,G,E,J,o[z+11],p,2304563134);J=SimpleCrypter.FF(J,I,G,E,o[z+12],v,1804603682);E=SimpleCrypter.FF(E,J,I,G,o[z+13],t,4254626195);G=SimpleCrypter.FF(G,E,J,I,o[z+14],r,2792965006);I=SimpleCrypter.FF(I,G,E,J,o[z+15],p,1236535329);J=SimpleCrypter.GG(J,I,G,E,o[z+1],H,4129170786);E=SimpleCrypter.GG(E,J,I,G,o[z+6],F,3225465664);G=SimpleCrypter.GG(G,E,J,I,o[z+11],C,643717713);I=SimpleCrypter.GG(I,G,E,J,o[z+0],B,3921069994);J=SimpleCrypter.GG(J,I,G,E,o[z+5],H,3593408605);E=SimpleCrypter.GG(E,J,I,G,o[z+10],F,38016083);G=SimpleCrypter.GG(G,E,J,I,o[z+15],C,3634488961);I=SimpleCrypter.GG(I,G,E,J,o[z+4],B,3889429448);J=SimpleCrypter.GG(J,I,G,E,o[z+9],H,568446438);E=SimpleCrypter.GG(E,J,I,G,o[z+14],F,3275163606);G=SimpleCrypter.GG(G,E,J,I,o[z+3],C,4107603335);I=SimpleCrypter.GG(I,G,E,J,o[z+8],B,1163531501);J=SimpleCrypter.GG(J,I,G,E,o[z+13],H,2850285829);E=SimpleCrypter.GG(E,J,I,G,o[z+2],F,4243563512);G=SimpleCrypter.GG(G,E,J,I,o[z+7],C,1735328473);I=SimpleCrypter.GG(I,G,E,J,o[z+12],B,2368359562);J=SimpleCrypter.HH(J,I,G,E,o[z+5],l,4294588738);E=SimpleCrypter.HH(E,J,I,G,o[z+8],j,2272392833);G=SimpleCrypter.HH(G,E,J,I,o[z+11],h,1839030562);I=SimpleCrypter.HH(I,G,E,J,o[z+14],g,4259657740);J=SimpleCrypter.HH(J,I,G,E,o[z+1],l,2763975236);E=SimpleCrypter.HH(E,J,I,G,o[z+4],j,1272893353);G=SimpleCrypter.HH(G,E,J,I,o[z+7],h,4139469664);I=SimpleCrypter.HH(I,G,E,J,o[z+10],g,3200236656);J=SimpleCrypter.HH(J,I,G,E,o[z+13],l,681279174);E=SimpleCrypter.HH(E,J,I,G,o[z+0],j,3936430074);G=SimpleCrypter.HH(G,E,J,I,o[z+3],h,3572445317);I=SimpleCrypter.HH(I,G,E,J,o[z+6],g,76029189);J=SimpleCrypter.HH(J,I,G,E,o[z+9],l,3654602809);E=SimpleCrypter.HH(E,J,I,G,o[z+12],j,3873151461);G=SimpleCrypter.HH(G,E,J,I,o[z+15],h,530742520);I=SimpleCrypter.HH(I,G,E,J,o[z+2],g,3299628645);J=SimpleCrypter.II(J,I,G,E,o[z+0],w,4096336452);E=SimpleCrypter.II(E,J,I,G,o[z+7],u,1126891415);G=SimpleCrypter.II(G,E,J,I,o[z+14],s,2878612391);I=SimpleCrypter.II(I,G,E,J,o[z+5],q,4237533241);J=SimpleCrypter.II(J,I,G,E,o[z+12],w,1700485571);E=SimpleCrypter.II(E,J,I,G,o[z+3],u,2399980690);G=SimpleCrypter.II(G,E,J,I,o[z+10],s,4293915773);I=SimpleCrypter.II(I,G,E,J,o[z+1],q,2240044497);J=SimpleCrypter.II(J,I,G,E,o[z+8],w,1873313359);E=SimpleCrypter.II(E,J,I,G,o[z+15],u,4264355552);G=SimpleCrypter.II(G,E,J,I,o[z+6],s,2734768916);I=SimpleCrypter.II(I,G,E,J,o[z+13],q,1309151649);J=SimpleCrypter.II(J,I,G,E,o[z+4],w,4149444226);E=SimpleCrypter.II(E,J,I,G,o[z+11],u,3174756917);G=SimpleCrypter.II(G,E,J,I,o[z+2],s,718787259);I=SimpleCrypter.II(I,G,E,J,o[z+9],q,3951481745);J=SimpleCrypter.AddUnsigned(J,A);I=SimpleCrypter.AddUnsigned(I,f);G=SimpleCrypter.AddUnsigned(G,m);E=SimpleCrypter.AddUnsigned(E,y)}var D=SimpleCrypter.WordToHex(J)+SimpleCrypter.WordToHex(I)+SimpleCrypter.WordToHex(G)+SimpleCrypter.WordToHex(E);return D.toLowerCase()};SimpleCrypter.des_createKeys=function(E){var D=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964);var C=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697);var B=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272);var A=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144);var y=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256);var w=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488);var u=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746);var t=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568);var s=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578);var q=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488);var f=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800);var e=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744);var d=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128);var c=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261);var r=E.length>8?3:1;var h=new Array(32*r);var g=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0);var v,b,l=0,k=0,x;for(var o=0;o<r;o++){var a=(E.charCodeAt(l++)<<24)|(E.charCodeAt(l++)<<16)|(E.charCodeAt(l++)<<8)|E.charCodeAt(l++);var z=(E.charCodeAt(l++)<<24)|(E.charCodeAt(l++)<<16)|(E.charCodeAt(l++)<<8)|E.charCodeAt(l++);x=((a>>>4)^z)&252645135;z^=x;a^=(x<<4);x=((z>>>-16)^a)&65535;a^=x;z^=(x<<-16);x=((a>>>2)^z)&858993459;z^=x;a^=(x<<2);x=((z>>>-16)^a)&65535;a^=x;z^=(x<<-16);x=((a>>>1)^z)&1431655765;z^=x;a^=(x<<1);x=((z>>>8)^a)&16711935;a^=x;z^=(x<<8);x=((a>>>1)^z)&1431655765;z^=x;a^=(x<<1);x=(a<<8)|((z>>>20)&240);a=(z<<24)|((z<<8)&16711680)|((z>>>8)&65280)|((z>>>24)&240);z=x;for(var p=0;p<g.length;p++){if(g[p]){a=(a<<2)|(a>>>26);z=(z<<2)|(z>>>26)}else{a=(a<<1)|(a>>>27);z=(z<<1)|(z>>>27)}a&=-15;z&=-15;v=D[a>>>28]|C[(a>>>24)&15]|B[(a>>>20)&15]|A[(a>>>16)&15]|y[(a>>>12)&15]|w[(a>>>8)&15]|u[(a>>>4)&15];b=t[z>>>28]|s[(z>>>24)&15]|q[(z>>>20)&15]|f[(z>>>16)&15]|e[(z>>>12)&15]|d[(z>>>8)&15]|c[(z>>>4)&15];x=((b>>>16)^v)&65535;h[k++]=v^x;h[k++]=b^(x<<16)}}return h};SimpleCrypter.Des=function(l,h,L,g,r,I){var z=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756);var y=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344);var x=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584);var v=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928);var u=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080);var t=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312);var s=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154);var q=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);var w=SimpleCrypter.des_createKeys(l);var E=0,J,H,f,N,M,e,D,a;var F,C,K,c;var B,d;var o=h.length;var b=0;var G=w.length==32?3:9;if(G==3){a=L?new Array(0,32,2):new Array(30,-2,-2)}else{a=L?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2)}if(I==2){h+="        "}else{if(I==1){f=8-(o%8);h+=String.fromCharCode(f,f,f,f,f,f,f,f);if(f==8){o+=8}}else{if(!I){h+="\0\0\0\0\0\0\0\0"}}}var p="";var k="";if(g==1){F=(r.charCodeAt(E++)<<24)|(r.charCodeAt(E++)<<16)|(r.charCodeAt(E++)<<8)|r.charCodeAt(E++);K=(r.charCodeAt(E++)<<24)|(r.charCodeAt(E++)<<16)|(r.charCodeAt(E++)<<8)|r.charCodeAt(E++);E=0}while(E<o){e=(h.charCodeAt(E++)<<24)|(h.charCodeAt(E++)<<16)|(h.charCodeAt(E++)<<8)|h.charCodeAt(E++);D=(h.charCodeAt(E++)<<24)|(h.charCodeAt(E++)<<16)|(h.charCodeAt(E++)<<8)|h.charCodeAt(E++);if(g==1){if(L){e^=F;D^=K}else{C=F;c=K;F=e;K=D}}f=((e>>>4)^D)&252645135;D^=f;e^=(f<<4);f=((e>>>16)^D)&65535;D^=f;e^=(f<<16);f=((D>>>2)^e)&858993459;e^=f;D^=(f<<2);f=((D>>>8)^e)&16711935;e^=f;D^=(f<<8);f=((e>>>1)^D)&1431655765;D^=f;e^=(f<<1);e=((e<<1)|(e>>>31));D=((D<<1)|(D>>>31));for(H=0;H<G;H+=3){B=a[H+1];d=a[H+2];for(J=a[H];J!=B;J+=d){N=D^w[J];M=((D>>>4)|(D<<28))^w[J+1];f=e;e=D;D=f^(y[(N>>>24)&63]|v[(N>>>16)&63]|t[(N>>>8)&63]|q[N&63]|z[(M>>>24)&63]|x[(M>>>16)&63]|u[(M>>>8)&63]|s[M&63])}f=e;e=D;D=f}e=((e>>>1)|(e<<31));D=((D>>>1)|(D<<31));f=((e>>>1)^D)&1431655765;D^=f;e^=(f<<1);f=((D>>>8)^e)&16711935;e^=f;D^=(f<<8);f=((D>>>2)^e)&858993459;e^=f;D^=(f<<2);f=((e>>>16)^D)&65535;D^=f;e^=(f<<16);f=((e>>>4)^D)&252645135;D^=f;e^=(f<<4);if(g==1){if(L){F=e;K=D}else{e^=C;D^=c}}var A=String.fromCharCode((e>>>24),((e>>>16)&255),((e>>>8)&255),(e&255),(D>>>24),((D>>>16)&255),((D>>>8)&255),(D&255));k+=A;b+=8;if(b==512){p+=k;k="";b=0}}return p+k};SimpleCrypter.prototype.Encrypt=function(c,a){try{var b=SimpleCrypter.MD5(c);return SimpleCrypter.Des(b.substring(0,24),a,true)}catch(d){return""}};SimpleCrypter.prototype.Decrypt=function(g,b){try{var d=SimpleCrypter.MD5(g);var f=SimpleCrypter.Des(d.substring(0,24),b,false);var a=f.length;for(var c=f.length-1;c>=0;c--){if(f.charCodeAt(c)==0){a=c}else{break}}return f.substring(0,a)}catch(h){return""}};function Shell(a){this.MainFrm=a;this.iVersion;this.iHasCamera;this.iDeviceID;this.iDeviceName}Shell.prototype.SendCmd=function(f,h){var b=self._ShellURL+"?_CMD="+f;if(h){var e=Object.keys(h);for(var d=0;d<e.length;d++){var c=e[d];var g=h[c];if(g!=null){b+="&"+c+"="+IDL.Base64Encode(g)}}}var a=new XMLHttpRequest();a.open("GET",b,false);a.send(null);return a.responseText};Shell.prototype.IsInsideShell=function(){return(self._ShellURL!=undefined)};Shell.prototype.IsInsideCaravel=function(){if(this.iIsInsideCaravel==undefined){if(this.IsInsideShell()){switch(parseInt(this.SendCmd("ISINSIDECARAVEL"))){case 0:this.iIsInsideCaravel=IDVariant.FALSE;break;case 1:this.iIsInsideCaravel=IDVariant.TRUE;break;default:this.iIsInsideCaravel=new IDVariant();break}}else{this.iIsInsideCaravel=new IDVariant()}}return this.iIsInsideCaravel};Shell.prototype.Version=function(){if(this.iVersion==undefined){this.iVersion=new IDVariant(this.IsInsideShell()?this.SendCmd("GETVER"):"")}return this.iVersion};Shell.prototype.HasCamera=function(){if(this.iHasCamera==undefined){this.iHasCamera=(this.IsInsideShell()&&this.SendCmd("HASCAMERA")=="OK")}return this.iHasCamera};Shell.prototype.DeviceID=function(){if(this.iDeviceID==undefined){this.iDeviceID=new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICEID"}):"")}return this.iDeviceID};Shell.prototype.DeviceName=function(){if(this.iDeviceName==undefined){this.iDeviceName=new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICENAME"}):"")}return this.iDeviceName};Shell.prototype.DeviceIP=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"DEVICEIP"}):"")};Shell.prototype.SynchServer=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETSETTING",{KEY:"SYNCSRV"}):"")};Shell.prototype.NetworkStatus=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("NETSTATUS"):"")};Shell.prototype.TakePicture=function(b,d,a,f,e){if(this.IsInsideShell()){var c=this.SendCmd("TAKEPICT",{NAME:b.stringValue(),QUALITY:d.intValue(),WIDTH:a.intValue(),HEIGHT:f.intValue(),CAMERAROLL:(e?-1:0)});return new IDVariant(c=="OK"?"":c)}else{return new IDVariant()}};Shell.prototype.RecStart=function(a){if(this.IsInsideShell()){var b=this.SendCmd("RECSTART",{NAME:a.stringValue()});return new IDVariant(b=="OK"?"":b)}else{return new IDVariant()}};Shell.prototype.RecStop=function(){if(this.IsInsideShell()){var a=this.SendCmd("RECSTOP");return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PlayStart=function(b){if(b.Type!=IDVariant.BLOB){return}if(this.IsInsideShell()){var a=this.SendCmd("PLAYSTART",{DATA:btoa(b.Value.substring(16))});return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PlayStop=function(){if(this.IsInsideShell()){var a=this.SendCmd("PLAYSTOP");return new IDVariant(a=="OK"?"":a)}else{return new IDVariant()}};Shell.prototype.PhoneCall=function(a){if(this.IsInsideShell()){this.SendCmd("PHONECALL",{NUM:a.stringValue()})}};Shell.prototype.PhoneSMS=function(b,a){if(this.IsInsideShell()){this.SendCmd("PHONESMS",{NUM:b.stringValue(),TXT:a.stringValue()})}};Shell.prototype.DenyOrientation=function(a){if(this.IsInsideShell()){this.SendCmd("DENYOR",{OR:a.intValue()})}};Shell.prototype.BatteryLevel=function(){if(this.IsInsideShell()){return new IDVariant(this.SendCmd("BATTERYLEV"))}return new IDVariant(0)};Shell.prototype.BatteryStatus=function(){if(this.IsInsideShell()){return new IDVariant(this.SendCmd("BATTERYSTAT"))}return new IDVariant(0)};Shell.prototype.IsServerReachable=function(b,a){if(this.IsInsideShell()){return(this.SendCmd("ISSERVERREACHABLE",{URL:b.stringValue(),TIMEOUT:a.intValue()})=="OK")}return false};Shell.prototype.CanStandBy=function(a){if(this.IsInsideShell()){this.SendCmd("CANSTANDBY",{ENABLED:(a?"-1":"0")})}};Shell.prototype.GetFile=function(d,c,b){if(this.IsInsideShell()){var a=this.SendCmd("DOWNLOADFILE",{URL:d.stringValue(),FILENAME:c.stringValue(),ASYNC:(b?-1:0)});if(a!="OK"){throw new Error(a)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.PutFile=function(c,d,b){if(this.IsInsideShell()){var a=this.SendCmd("UPLOADFILE",{FILENAME:c.stringValue(),URL:d.stringValue(),ASYNC:(b?-1:0)});if(a!="OK"){throw new Error(a)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.BackupFile=function(b,a){if(this.IsInsideShell()){this.SendCmd("BACKUP",{FILENAME:b.stringValue(),BACKUP:(a?-1:0)})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.OpenFileIn=function(a){if(this.IsInsideShell()){this.SendCmd("OPENIN",{FILENAME:a.stringValue()})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.ScanBarcode=function(b,a){if(this.IsInsideShell()){this.SendCmd("SCANBARCODE",{TYPES:b.intValue(),USESHUTTER:(a?-1:0)})}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetAlbumCount=function(){if(this.IsInsideShell()){var a=this.SendCmd("GETALBUMCOUNT");if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(parseInt(a.substring(2),10))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetAlbumID=function(b){if(this.IsInsideShell()){var a=this.SendCmd("GETALBUMID",{INDEX:b.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoCount=function(b){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTOCOUNT",{IDALBUM:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(parseInt(a.substring(2),10))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoID=function(b,c){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTOID",{IDALBUM:b.stringValue(),INDEX:c.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoDateTime=function(b,c){if(this.IsInsideShell()){var a=this.SendCmd("GETPHOTODATETIME",{IDALBUM:b.stringValue(),IDPHOTO:c.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2),IDVariant.DATETIME)}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhotoThumbnail=function(e,b,d,c){if(this.IsInsideShell()){if(c.stringValue().trim().length==0){c=new IDVariant(e.getRealPath()+"/temp")}var a=this.SendCmd("GETPHOTOTHUMBNAIL",{IDALBUM:b.stringValue(),IDPHOTO:d.stringValue(),PATH:c.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetPhoto=function(g,c,e,d,f,b,h){if(this.IsInsideShell()){if(d.stringValue().trim().length==0){d=new IDVariant(g.getRealPath()+"/temp")}var a=this.SendCmd("GETPHOTO",{IDALBUM:c.stringValue(),IDPHOTO:e.stringValue(),PATH:d.stringValue(),QUALITY:f.intValue(),WIDTH:b.intValue(),HEIGHT:h.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.PutPhoto=function(b){if(this.IsInsideShell()){var a=this.SendCmd("PUTPHOTO",{FILENAME:b.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.HttpRequest=function(e,m,t,f,b){var h={URL:m};if(f&&f.Type!=IDVariant.NULL){h.__USERNAME__=f.stringValue()}if(b&&b.Type!=IDVariant.NULL){h.__PASSWORD__=b.stringValue()}if(t){var o=t.GetKeys();for(var s=0;s<o.Size();s++){var u=o.get_Value(new IDVariant(s));var v=t.get_Value(u);if(v instanceof IDVariant&&v.Type!=IDVariant.NULL){h[u.stringValue()]=v.stringValue()}else{if(v instanceof IDArray&&u.stringValue()=="ID_HEADERS"){var c="";for(var r=0;r<v.Size();r++){if(r>0){c+="\n"}c+=v.get_Value(new IDVariant(r)).stringValue()}h[u.stringValue()]=c}}}}var p=RD4_WebEntryPoint.ShellObject.SendCmd("HTTPREQ",h);if(p.indexOf("|")==-1&&p.indexOf("|",p.indexOf("|")+1)==-1){throw new Error(p)}var d=parseInt(p.substring(0,p.indexOf("|")));p=p.substring(p.indexOf("|")+1);var l=p.substring(0,p.indexOf("|"));p=p.substring(p.indexOf("|")+1);var q=p;var a=new IDVariant();a.Type=d;a.Value=IDL.Base64Decode(l);if(t){var g=new IDArray();var k=q.split("\n");for(var s=0;s<k.length;s++){if(k[s].length>0){if(k[s].length>16&&k[s].substring(0,16)=="ID_RESPONSECODE:"){t.set_Value(new IDVariant("ID_RESPONSECODE"),new IDVariant(k[s].substring(17)));continue}else{g.add_Value(new IDVariant(k[s]))}}}if(g.Size()>0){t.set_Object(new IDVariant("ID_HEADERS"),g)}}return a};Shell.prototype.SendMail=function(p,q,t,c,a,w,h,u,l,s,j,d,g,m,e,f,v,o,b,r){if(this.IsInsideShell()){var k=this.SendCmd("IMAP_SENDMAIL",{SERVER:p.stringValue(),PORT:q.stringValue(),USESSL:t.stringValue(),USERNAME:c.stringValue(),PASSWORD:a.stringValue(),FROM:w.stringValue(),SUBJECT:h.stringValue(),HTMLBODY:u.stringValue(),TEXTBODY:l.stringValue(),TOS:s.stringValue(),CCS:j.stringValue(),BCCS:d.stringValue(),REPLYTO:g.stringValue(),ATTACHLIST:m.stringValue(),SAVEONLY:e.stringValue(),SAVETOMAILBOX:f.stringValue(),INCOMINGSERVER:v.stringValue(),INCOMINGPORT:o.stringValue(),INCOMINGSSL:b.stringValue(),MAILBOXNAME:r.stringValue()});if(k.substring(0,2)!="OK"){throw new Error(k)}if(k.length>2){return new IDVariant(k.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetMailboxes=function(e,g,d,b,c,f){if(this.IsInsideShell()){var a=this.SendCmd("IMAP_GETMAILBOXES",{SERVER:e.stringValue(),PORT:g.stringValue(),USESSL:d.stringValue(),USERNAME:b.stringValue(),PASSWORD:c.stringValue(),MAILBOXNAME:f.stringValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.ReadEmails=function(d,c,f,a,e,g,j,h,b){if(this.IsInsideShell()){var k=this.SendCmd("IMAP_READEMAILS",{SERVER:d.stringValue(),PORT:c.stringValue(),USESSL:f.stringValue(),USERNAME:a.stringValue(),PASSWORD:e.stringValue(),MAILBOXNAME:g.stringValue(),HEADERSONLY:(j?1:0),LASTREADID:h.intValue(),MAXROWS:b.intValue()});if(k.substring(0,2)!="OK"){throw new Error(k)}if(k.length>2){return new IDVariant(k.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetSingleEmail=function(f,h,e,b,d,g,c){if(this.IsInsideShell()){var a=this.SendCmd("IMAP_GETSINGLEEMAIL",{SERVER:f.stringValue(),PORT:h.stringValue(),USESSL:e.stringValue(),USERNAME:b.stringValue(),PASSWORD:d.stringValue(),MAILBOXNAME:g.stringValue(),MAILID:c.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.MoveEmail=function(f,e,h,a,g,d,c,b){if(this.IsInsideShell()){var j=this.SendCmd("IMAP_MOVEEMAIL",{SERVER:f.stringValue(),PORT:e.stringValue(),USESSL:h.stringValue(),USERNAME:a.stringValue(),PASSWORD:g.stringValue(),SOURCEMAILBOX:d,DESTMAILBOX:c.stringValue(),EMAILID:b.stringValue()});if(j.substring(0,2)!="OK"){throw new Error(j)}if(j.length>2){return new IDVariant(j.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetEmailAttachments=function(f,h,e,b,d,g,c){if(this.IsInsideShell()){var a=this.SendCmd("IMAP_GETEMAILATTACHMENTS",{SERVER:f.stringValue(),PORT:h.stringValue(),USESSL:e.stringValue(),USERNAME:b.stringValue(),PASSWORD:d.stringValue(),MAILBOXNAME:g.stringValue(),MAILID:c.intValue()});if(a.substring(0,2)!="OK"){throw new Error(a)}if(a.length>2){return new IDVariant(a.substring(2))}else{return new IDVariant()}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.DownloadAttachment=function(f,e,h,b,g,j,d,c,a){if(this.IsInsideShell()){var k=this.SendCmd("IMAP_DOWNLOADATTACHMENT",{SERVER:f.stringValue(),PORT:e.stringValue(),USESSL:h.stringValue(),USERNAME:b.stringValue(),PASSWORD:g.stringValue(),MAILBOXNAME:j.stringValue(),MAILID:d.intValue(),ATTACHMENTID:c.intValue(),SAVETOPATH:a.stringValue()});if(k!="OK"){throw new Error(k)}return new IDVariant()}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetDNID=function(){return new IDVariant(this.IsInsideShell()?this.SendCmd("GETDNID"):"")};Shell.prototype.SendLocalNotification=function(f,c,e,g,b,h,d,a){if(this.IsInsideShell()){var j=this.SendCmd("SENDLOCALNOTIF",{TITLE:f,TEXT:c,PAYLOAD:e,DATE:(!g?"":IDL.Format(new IDVariant(g),new IDVariant("dd/mm/yyyy hh:nn:ss")).stringValue()),IMAGE:b,SOUND:h,BADGE:d,TYPE:a});if(j!="OK"){throw new Error(j)}}else{throw new Error("Not supported outside the Native Shell")}};Shell.prototype.GetContacts=function(){var o=new IDArray();if(this.IsInsideShell()){var g=this.SendCmd("GETCONTACTS");var h=new XMLDoc();h.LoadFromString(g);var p=null;while(h.HasNextNode()&&!p){var b=h.GetNextNode();if(b.Type()==1){p=b}}while(p.HasNextNode()){var d=p.GetNextNode();var c=new Shell.Contact();o.add_Object(c);c.FirstName=new IDVariant(d.GetAttribute("FIRSTNAME"));if(c.FirstName.Type==5&&c.FirstName.stringValue().length==0){c.FirstName=new IDVariant()}c.LastName=new IDVariant(d.GetAttribute("LASTNAME"));if(c.LastName.Type==5&&c.LastName.stringValue().length==0){c.LastName=new IDVariant()}c.Company=new IDVariant(d.GetAttribute("COMPANY"));if(c.Company.Type==5&&c.Company.stringValue().length==0){c.Company=new IDVariant()}c.Birthday=new IDVariant(d.GetAttribute("BIRTHDAY"));if(c.Birthday.Type==5&&c.Birthday.stringValue().length==0){c.Birthday=new IDVariant()}else{c.Birthday.changeType(IDVariant.DATETIME)}c.Note=new IDVariant(d.GetAttribute("NOTE"));if(c.Note.Type==5&&c.Note.stringValue().length==0){c.Note=new IDVariant()}while(d.HasNextNode()){var r=d.GetNextNode();if(r.Name()=="Phones"){c.Phones=new IDMap();while(r.HasNextNode()){var s=r.GetNextNode();var k=new IDVariant(s.GetAttribute("LABEL"));var m=new IDVariant(s.GetAttribute("NUMBER"));if(c.Phones.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.Phones.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.Phones.set_Value(k,m)}}else{if(r.Name()=="Emails"){c.EMails=new IDMap();while(r.HasNextNode()){var a=r.GetNextNode();var k=new IDVariant(a.GetAttribute("LABEL"));var q=new IDVariant(a.GetAttribute("EMAIL"));if(c.EMails.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.EMails.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.EMails.set_Value(k,q)}}else{if(r.Name()=="Addresses"){c.Addresses=new IDMap();while(r.HasNextNode()){var l=r.GetNextNode();var k=new IDVariant(l.GetAttribute("LABEL"));var j=new Shell.ContactAddress();j.Street=new IDVariant(l.GetAttribute("STREET"));if(j.Street.Type==5&&j.Street.stringValue().length==0){j.Street=new IDVariant()}j.City=new IDVariant(l.GetAttribute("CITY"));if(j.City.Type==5&&j.City.stringValue().length==0){j.City=new IDVariant()}j.State=new IDVariant(l.GetAttribute("STATE"));if(j.State.Type==5&&j.State.stringValue().length==0){j.State=new IDVariant()}j.ZIP=new IDVariant(l.GetAttribute("ZIP"));if(j.ZIP.Type==5&&j.ZIP.stringValue().length==0){j.ZIP=new IDVariant()}j.Country=new IDVariant(l.GetAttribute("COUNTRY"));if(j.Country.Type==5&&j.Country.stringValue().length==0){j.Country=new IDVariant()}if(c.Addresses.ContainsKey(k)){for(var e=1;e<10;e++){var f=k.stringValue()+e;if(!c.Addresses.ContainsKey(new IDVariant(f))){k=new IDVariant(f);break}}}c.Addresses.set_Object(k,j)}}}}}}}return o};Shell.Contact=function(){this.FirstName;this.LastName;this.Company;this.Birthday;this.Note};Shell.Contact.prototype.GetPhones=function(){return this.Phones};Shell.Contact.prototype.GetEmail=function(){return this.EMails};Shell.Contact.prototype.GetAddresses=function(){return this.Addresses};Shell.ContactAddress=function(){this.Street;this.City;this.State;this.ZIP;this.Country};function StringTokenizer(){this.str="";this.delim=",";this.quote='"';this.p=-1;this.UseDecimalDot=true;this.stok=false;this.allowSpaces=false}StringTokenizer.prototype.setString=function(b,a,c){if(a==undefined){a=new IDVariant(",")}if(c==undefined){c=new IDVariant('"')}this.str=b.stringValue();this.p=-1;if(a.stringValue().length>0){this.delim=a.stringValue().charAt(0)}if(c.stringValue().length>0){this.quote=c.stringValue().charAt(0)}this.stok=this.str.length>0};StringTokenizer.prototype.hasNext=function(){return this.p+1<this.str.length};StringTokenizer.prototype.next=function(){var f=this.p+1;var e=false;var a=false;var b=this.str.length;while(f<b){if(this.str.charAt(f)==this.quote){e=!e;a=true}if(!e){if(this.str.charAt(f)==this.delim){break}}f++}var d,c;d=this.p+1;c=f-1;this.p=f;if(this.delim!=" "){while(d<this.str.length){if(this.str.charAt(d)==this.quote){d++;break}if(this.str.charAt(d)!=" "||this.allowSpaces){break}d++}while(c>=0&&this.str.length>0){if(this.str.charAt(c)==this.quote){c--;break}if(this.str.charAt(c)!=" "||this.allowSpaces){break}c--}}var g="";if(c+1>d){g=this.str.substr(d,c+1-d)}d=1;while(d<g.length-1){if(g.charAt(d)==this.quote&&g.charAt(d+1)==this.quote){g=g.remove(d,1)}d++}if(g.length==0&&!a){return new IDVariant()}else{return new IDVariant(g)}};StringTokenizer.prototype.addToken=function(c){if(this.str.length>0||this.stok){this.str+=this.delim}this.stok=true;if(c.Type==IDVariant.NULL){return}if(c.Type==IDVariant.STRING){var a=c.stringValue();var b=0;while(b<a.length){if(a.charAt(b)==this.quote){a=a.insert(b++,this.quote)}b++}a=a.insert(0,this.quote);a=a.concat(this.quote);this.str+=a}else{if(c.Type==IDVariant.DATETIME){var f=IDL.Format(c,new IDVariant("yyyy-mm-dd hh:nn:ss")).stringValue();if(f.substr(11).equals("00:00:00")){f=f.substr(0,10)}if(f.substr(0,10).equals("1899-12-30")){if(f.length>10){f=f.substr(11)}else{f=""}}this.str+=f}else{if(c.Type==IDVariant.FLOAT||c.Type==IDVariant.DECIMAL){var e=c.stringValue();if(!this.UseDecimalDot){e=e.replace(new RegExp("//.","g"),",")}this.str+=e}else{this.str+=c.stringValue()}}}};StringTokenizer.prototype.getString=function(){return new IDVariant(this.str)};StringTokenizer.prototype.Count=function(){var b=this.p;this.p=-1;var a=0;while(this.hasNext()){a++;this.next()}this.p=b;return new IDVariant(a)};function VBFiles(){}VBFiles.prototype.CurDir=function(){return new IDVariant()};VBFiles.prototype.Dir=function(a,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(a!=undefined&&b!=undefined){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR",{NAMEFILTER:a.stringValue(),ATTRIBUTES:b.intValue()}))}else{if(a!=undefined){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR",{NAMEFILTER:a.stringValue()}))}else{return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIR"))}}}return new IDVariant()};VBFiles.MkDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_MKDIR",{NEWDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.RmDir=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_RMDIR",{NEWDIR:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.FileDateTime=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILEDATETIME",{THEFILE:a.stringValue()}),IDVariant.DATETIME)}return new IDVariant()};VBFiles.FileLen=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILELEN",{THEFILE:a.stringValue()}),IDVariant.INTEGER)}return new IDVariant()};VBFiles.FileExt=function(b){var d="";var a=b.stringValue();var c=a.lastIndexOf(".");if(c>-1){d=a.substr(c+1)}return new IDVariant(d)};VBFiles.GetAttr=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_GETATTR",{THEFILE:a.stringValue()}),IDVariant.INTEGER)}return new IDVariant()};VBFiles.FileExists=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FILEEXISTS",{THEFILE:a.stringValue()})=="OK")}return false};VBFiles.DirectoryExists=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_DIRECTORYEXISTS",{THEFILE:a.stringValue()})=="OK")}return false};VBFiles.Kill=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_KILL",{THEFILE:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.Rename=function(b,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_RENAME",{THEFILE:b.stringValue(),NEWNAME:c.stringValue()});if(a!="OK"){throw new Error(a)}return true}return false};VBFiles.prototype.FreeFile=function(){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_FREEFILE"),IDVariant.INTEGER)}return new IDVariant()};VBFiles.prototype.Close=function(b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_CLOSE",{FILENUM:b.intValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.EOF=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_EOF",{FILENUM:a.intValue()})=="OK")}return true};VBFiles.prototype.OpenForInput=function(b,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_OPENFORINPUT",{THEFILE:b.stringValue(),FILENUM:c.intValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.OpenForOutput=function(b,d,c){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_OPENFOROUTPUT",{THEFILE:b.stringValue(),FILENUM:d.intValue(),FLFORAPPEND:c?"1":"0"});if(a!="OK"){throw new Error(a)}return true}};VBFiles.prototype.ReadLine=function(a){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_READLINE",{FILENUM:a.intValue()}))}return new IDVariant()};VBFiles.prototype.WriteLine=function(c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_WRITELINE",{FILENUM:c.intValue(),TEXT:b.stringValue()});if(a!="OK"){throw new Error(a)}return true}};VBFiles.Shell=function(Command){eval(Command)};XMLDoc.FT_XML=0;XMLDoc.FT_JSON=1;XMLDoc.ROOT_JSON="Root_JSON";XMLDoc.JSON_IGNORENAME="JSON_IGNORENAME";XMLDoc.JSON_ISARRAYCHILD="JSON_ISARRAYCHILD";XMLDoc.UNIX_EPOCH=new Date(0);XMLDoc.NULL_VALUE="~~IOTNULL~~";XMLDoc.TRUE_VALUE="~~TRUE~~";XMLDoc.FALSE_VALUE="~~FALSE~~";function XMLDoc(){this.XMLdoc;this.ChildIndex=0;this.XMLdoc=new ProXMLDocument();var a=this.XMLdoc.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');this.XMLdoc.appendChild(a)}XMLDoc.prototype.GetDocument=function(){return this.XMLdoc};XMLDoc.prototype.GetRootNode=function(){for(var a=0;a<this.XMLdoc.childNodes.length;a++){if(this.XMLdoc.childNodes[a].nodeType==1){return new XMLNode(this.XMLdoc.childNodes[a])}}return null};XMLDoc.prototype.AddNewElement=function(b){var a=this.XMLdoc.createElement(b);this.XMLdoc.appendChild(a);return new XMLNode(a)};XMLDoc.prototype.RemoveNode=function(b){for(var a=0;a<this.ChildIndex;a++){if(this.XMLdoc.childNodes[a]==b.GetNode()){this.ChildIndex--;break}}this.XMLdoc.removeChild(b.GetNode())};XMLDoc.prototype.Save=function(a,b){this.XMLdoc.Save(a,b)};XMLDoc.prototype.Load=function(a,b){this.XMLdoc.Load(a,b)};XMLDoc.prototype.Reset=function(){this.ChildIndex=0};XMLDoc.prototype.HasNextNode=function(){return this.ChildIndex<this.XMLdoc.childNodes.length};XMLDoc.prototype.GetNextNode=function(){if(this.HasNextNode()){return new XMLNode(this.XMLdoc.childNodes[this.ChildIndex++])}else{return null}};XMLDoc.prototype.SaveToString=function(a){return this.XMLdoc.saveToString(a)};XMLDoc.prototype.SaveToStream=function(a,b){};XMLDoc.prototype.LoadFromString=function(a,b){try{this.XMLdoc.loadFromString(a,b);this.Reset();return true}catch(c){WriteToConsoleError("Cannot load XML, Error is: "+c);return false}};XMLDoc.prototype.Validate=function(a){return true};XMLDoc.prototype.SaveToJSON=function(){return this.XMLdoc.saveToJSON()};XMLDoc.SerializeJsonDate=function(a){return"/Date("+(a.getTime()-XMLDoc.UNIX_EPOCH.getTime())+")/"};XMLDoc.DeserializeJsonDate=function(b){var a=parseInt(b.substr(6,b.indexOf(")")-6));return new Date(a+XMLDoc.UNIX_EPOCH.getTime())};function XMLNode(a){this.XMLnode;this.ChildIndex=0;this.AttrIndex=0;this.XMLnode=a}XMLNode.prototype.GetNode=function(){return this.XMLnode};XMLNode.prototype.Name=function(){if(this.XMLnode==null){return null}return this.XMLnode.nodeName};XMLNode.prototype.Value=function(){if(this.XMLnode.nodeType==1&&this.XMLnode.childNodes.length==1&&(this.XMLnode.childNodes[0].nodeType==3||this.XMLnode.childNodes[0].nodeType==4)){return this.XMLnode.childNodes[0].data}return this.XMLnode.data};XMLNode.prototype.set_Value=function(a){if(this.XMLnode.nodeType==3||this.XMLnode.nodeType==4){this.XMLnode.data=a}};XMLNode.prototype.Type=function(){return this.XMLnode.nodeType};XMLNode.prototype.IsElement=function(){return this.Type()==1};XMLNode.prototype.IsText=function(){return this.Type()==3||this.Type()==4};XMLNode.prototype.AddNewElement=function(b){var c=this.XMLnode.ownerDocument;if(c==null){return null}var a=c.createElement(b);this.XMLnode.appendChild(a);return new XMLNode(a)};XMLNode.prototype.AddTextNode=function(c,e){var f=this.XMLnode.ownerDocument;var b=f.createTextNode(e);var a=f.createElement(c);a.appendChild(b);this.XMLnode.appendChild(a);return new XMLNode(a)};XMLNode.prototype.RemoveNode=function(b){for(var a=0;a<this.ChildIndex;a++){if(this.XMLnode.childNodes[a]==b.GetNode()){this.ChildIndex--;break}}this.XMLnode.removeChild(b.GetNode())};XMLNode.prototype.Reset=function(){this.ChildIndex=0;this.AttrIndex=0};XMLNode.prototype.HasNextNode=function(){return this.ChildIndex<this.XMLnode.childNodes.length};XMLNode.prototype.HasNextAttribute=function(){if(!this.IsElement()){return false}else{return this.AttrIndex<this.XMLnode.attributes.length}};XMLNode.prototype.GetNextNode=function(){if(this.HasNextNode()){return new XMLNode(this.XMLnode.childNodes[this.ChildIndex++])}else{return null}};XMLNode.prototype.GetNextAttribute=function(a,b){if(this.HasNextAttribute()){var c=this.XMLnode.attributes[this.AttrIndex++];if(c.nodeName==XMLDoc.JSON_ISARRAYCHILD){this.GetNextAttribute(a,b);return}a.set(new IDVariant(c.nodeName));b.set(new IDVariant(c.nodeValue))}else{a.changeType(IDVariant.NULL);b.changeType(IDVariant.NULL)}};XMLNode.prototype.GetAttribute=function(a){if(this.IsElement()){return this.XMLnode.getAttribute(a)}else{return null}};XMLNode.prototype.SetAttribute=function(a,b){if(this.IsElement()){this.XMLnode.setAttribute(a,b)}};XMLNode.prototype.RemoveAttribute=function(a){if(this.IsElement()){this.XMLnode.removeAttribute(a)}};XMLNode.prototype.ToString=function(){return this.toString()};XMLNode.prototype.toString=function(){var a=this.Name();var d=this.Value();if(this.IsElement()){var f=a;var g=this.XMLnode.attributes;var c=": ";var b=g.length;for(var e=0;e<b;e++){if(g[e].nodeName.equals(XMLDoc.JSON_ISARRAYCHILD)){continue}f=f+(c+g[e].nodeName+"="+g[e].nodeValue);c=", "}return f}else{return"* "+a+((d!=null)?" = "+d:"")}};XMLNode.prototype.SaveToString=function(){return this.XMLnode.toString()};XMLNode.prototype.IsArrayChild=function(){return(this.GetAttribute(XMLDoc.JSON_ISARRAYCHILD)=="1")};XMLNode.prototype.set_IsArrayChild=function(a){if(a){this.SetAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}else{this.RemoveAttribute(XMLDoc.JSON_ISARRAYCHILD)}};function ACommandSrv(){this.IdxForm=0;this.RoleEnabled=true;this.RoleVisible=true;this.Caption="";this.ToolTip="";this.iGuid;this.Parent;this.Index;this.Expanded;this.Level;this.ToolCont=-1;this.ToolContCode=null;this.CmdCode=null;this.Code=null;this.iBadge="";this.IsMenu;this.IsToolbar;this.ShowNames;this.RequireConfirmation=false;this.UseHilight=false;this.ToolName;this.Image;this.Accell=null;this.FormList=false;this.Width=0;this.FKNum=0;this.iAllowPWA=false;this.iEnabled=new Array(1);this.iVisible=new Array(1);this.iChecked=new Array(1);this.iCommands=new Array(0);this.CmdIter=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.CMD_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_URGENT;this.ExpandEventDef=RD3Glb.EVENT_CLIENTSIDE;this.ExpandAnimationDef=null;this.PopupAnimationDef=null;this.CanDrag=false;this.CanDrop=false}ACommandSrv.prototype.CopyFrom=function(d,b,a){this.IdxForm=a;this.RoleEnabled=d.RoleEnabled;this.RoleVisible=d.RoleVisible;this.Caption=d.Caption;this.ToolTip=d.ToolTip;this.iGuid=d.iGuid;this.Parent=d.Parent;this.Index=d.Index;this.Expanded=d.Expanded;this.Level=d.Level;this.ToolCont=d.ToolCont;this.ToolContCode=d.ToolContCode;this.CmdCode=d.CmdCode;this.Code=d.Code;this.IsMenu=d.IsMenu;this.IsToolbar=d.IsToolbar;this.ShowNames=d.ShowNames;this.RequireConfirmation=d.RequireConfirmation;this.UseHilight=d.UseHilight;this.ToolName=d.ToolName;this.Image=d.Image;this.Width=d.Width;this.FKNum=d.FKNum;this.iAllowPWA=d.iAllowPWA;this.iEnabled=d.iEnabled.slice(0);this.iVisible=d.iVisible.slice(0);this.iChecked=d.iChecked.slice(0);this.iCommands=new Array(d.iCommands.length);for(var c=0;c<d.iCommands.length;c++){if(d.iCommands[c]!=null){this.iCommands[c]=new ACommandSrv();b.Add(this.iCommands[c]);this.iCommands[c].CopyFrom(d.iCommands[c],b,a);this.iCommands[c].Parent=this}}this.CmdIter=d.CmdIter;this.ClickEventDef=d.ClickEventDef;this.ExpandEventDef=d.ExpandEventDef;this.ExpandAnimationDef=d.ExpandAnimationDef;this.PopupAnimationDef=d.PopupAnimationDef};ACommandSrv.prototype.uCommands=function(){return this.iCommands.length};ACommandSrv.prototype.bCommands=function(a){return this.iCommands[a]};ACommandSrv.prototype.bEnabled=function(b){var a;if(!this.bVisible(b)){a=false}else{if(this.Parent==null){a=true}else{a=this.Parent.bEnabled(b)}}if(a){if(!this.RoleEnabled){a=false}else{a=this.iEnabled[(this.iAllowPWA)?b:0]}}return a};ACommandSrv.prototype.set_bEnabled=function(c,a){if(this.iEnabled[(this.iAllowPWA)?c:0]!=a){this.iEnabled[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.CMD_ENABLED)}};ACommandSrv.prototype.bVisible=function(b){var a;if(!this.RoleVisible){a=false}else{if(this.iAllowPWA){a=this.iVisible[b]}else{if(this.IdxForm!=b&&this.IdxForm>0){a=false}else{a=this.iVisible[0]}}}if(a&&this.Parent!=null){a=this.Parent.bVisible(b)}return a};ACommandSrv.prototype.set_bVisible=function(c,a){if(this.iVisible[(this.iAllowPWA)?c:0]!=a){this.iVisible[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.CMD_VISIBLE)}};ACommandSrv.prototype.bChecked=function(a){return this.iChecked[(this.iAllowPWA)?a:0]};ACommandSrv.prototype.set_bChecked=function(c,a){if(this.iChecked[(this.iAllowPWA)?c:0]!=a){this.iChecked[(this.iAllowPWA)?c:0]=a}};ACommandSrv.prototype.bCaption=function(){return this.Caption};ACommandSrv.prototype.set_bCaption=function(a){if(this.Caption!=a){this.Caption=a;this.RD3Change(RD3Glb.CMD_CAPTION)}};ACommandSrv.prototype.bToolTip=function(){return this.ToolTip};ACommandSrv.prototype.set_bToolTip=function(a){if(this.ToolTip!=a){this.ToolTip=a;this.RD3Change(RD3Glb.CMD_TOOLTIP)}};ACommandSrv.prototype.bImage=function(){return this.Image};ACommandSrv.prototype.set_bImage=function(a){if(this.Image==null||!this.Image.equals(a)){this.Image=a;this.RD3Change(RD3Glb.CMD_IMAGE)}};ACommandSrv.prototype.bToolName=function(){return this.ToolName};ACommandSrv.prototype.set_bToolName=function(a){if(this.ToolName!=a){this.ToolName=a;this.RD3Change(RD3Glb.CMD_TOOLNAME)}};ACommandSrv.prototype.set_AllowPWA=function(c,a){this.iAllowPWA=a;if(a){this.iEnabled=new bool[c.ParamsObj().MAX_FORMS+1];this.iVisible=new bool[c.ParamsObj().MAX_FORMS+1];this.iChecked=new bool[c.ParamsObj().MAX_FORMS+1]}};ACommandSrv.prototype.IsEnabled=function(a){if(this.Parent!=null){return this.bEnabled(a)&&this.Parent.IsEnabled(a)}else{return this.bEnabled(a)}};ACommandSrv.prototype.InitStatus=function(c,a,d){if(this.IdxForm==0){for(var b=0;b<this.iEnabled.length;b++){this.iEnabled[b]=c;this.iVisible[b]=a;this.iChecked[b]=d}}else{if(this.iAllowPWA){this.iVisible[this.IdxForm]=a;this.iEnabled[this.IdxForm]=c;this.iChecked[this.IdxForm]=d}else{this.iVisible[0]=a;this.iEnabled[0]=c;this.iChecked[0]=d}}};ACommandSrv.prototype.Commands=function(a){return this.iCommands[a]};ACommandSrv.prototype.set_Commands=function(c,a){this.iCommands[c]=a};ACommandSrv.prototype.AddCommand=function(a){this.iCommands[this.CmdIter++]=a};ACommandSrv.prototype.MaxCommands=function(){return this.iCommands.length-1};ACommandSrv.prototype.SetNumCommands=function(a){if(a>0){this.iCommands=new Array(a)}else{this.iCommands=null}this.CmdIter=0};ACommandSrv.prototype.Expand=function(){if(this.iCommands.length==0){return false}else{this.Expanded=!this.Expanded;this.RD3Change(RD3Glb.CMD_EXPANDED);return true}};ACommandSrv.prototype.IsCmdSet=function(){return this.iCommands.length>0};ACommandSrv.prototype.GetIndex=function(){if(this.Parent!=null){for(var a=0;a<this.Parent.iCommands.length;a++){if(this.Parent.iCommands[a]==this){return a}}}return -1};ACommandSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ACommandSrv.prototype.GetRD3Name=function(){return(this.Level==1)?"cms":"cmd"};ACommandSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ACommandSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(f){if(this.ClickEventDef!=RD3Glb.EVENT_URGENT){e.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ExpandEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("exe",this.ExpandEventDef.toString())}if(this.ExpandAnimationDef!=null){e.SetAttribute("exa",this.ExpandAnimationDef)}if(this.PopupAnimationDef!=null){e.SetAttribute("poa",this.PopupAnimationDef)}}var a=(f)?e:c;for(var b=0;b<this.iCommands.length;b++){d|=this.iCommands[b].RD3RenderDifferences(a,f)}return d};ACommandSrv.prototype.SetRD3Property=function(c,e,d){switch(c){case RD3Glb.CMD_IDXFORM:if(this.IdxForm==0&&d){break}e.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.CMD_CAPTION:if(this.Caption.length==0&&d){break}e.SetAttribute("cap",this.Caption);break;case RD3Glb.CMD_TOOLTIP:if(this.ToolTip.length==0&&d){break}e.SetAttribute("tip",this.ToolTip);break;case RD3Glb.CMD_IDX:if(this.Index==0&&d){break}e.SetAttribute("idx",this.Index.toString());break;case RD3Glb.CMD_EXPANDED:if(!this.Expanded&&d){break}e.SetAttribute("exp",this.Expanded?"1":"0");break;case RD3Glb.CMD_LEVEL:if(this.Level==1&&d){break}e.SetAttribute("lev",this.Level.toString());break;case RD3Glb.CMD_ISMENU:if(this.IsMenu&&d){break}e.SetAttribute("ism",this.IsMenu?"1":"0");break;case RD3Glb.CMD_ISTOOLBAR:if(!this.IsToolbar&&d){break}e.SetAttribute("ist",this.IsToolbar?"1":"0");break;case RD3Glb.CMD_SHOWNAMES:if(!this.ShowNames&&d){break}e.SetAttribute("shn",this.ShowNames?"1":"0");break;case RD3Glb.CMD_REQUIRECONFIRMATION:if(!this.RequireConfirmation&&d){break}e.SetAttribute("rqc",this.RequireConfirmation?"1":"0");break;case RD3Glb.CMD_TOOLNAME:if((this.ToolName==null||this.ToolName.equals(""))&&d){break}e.SetAttribute("tnm",this.ToolName);break;case RD3Glb.CMD_IMAGE:if((this.Image==null||this.Image.equals(""))&&d){break}e.SetAttribute("img",this.Image);break;case RD3Glb.CMD_ENABLED:var a=this.iEnabled[0]&&this.RoleEnabled;if(a&&d){break}e.SetAttribute("ena",a?"1":"0");break;case RD3Glb.CMD_VISIBLE:var a=this.iVisible[0]&&this.RoleVisible;if(a&&d){break}e.SetAttribute("vis",a?"1":"0");break;case RD3Glb.CMD_CONFIRMTEXT:break;case RD3Glb.CMD_TOOLCONT:if(this.ToolCont==-1&&d){break}e.SetAttribute("cnt",this.ToolCont.toString());break;case RD3Glb.CMD_FKNUM:if(this.FKNum==0&&d){break}e.SetAttribute("fkn",this.FKNum.toString());break;case RD3Glb.CMD_CMDCODE:if((this.CmdCode==null||this.CmdCode.length==0)&&d){break}e.SetAttribute("cco",(this.CmdCode!=null)?this.CmdCode:"");break;case RD3Glb.CMD_WIDTH:if(this.Width==0&&d){break}e.SetAttribute("wid",this.Width.toString());break;case RD3Glb.CMD_TOOLHL:if(this.UseHilight==false&&d){break}e.SetAttribute("thl",this.UseHilight?"1":"0");break;case RD3Glb.CMD_FORMLIST:if(this.FormList==false&&d){break}e.SetAttribute("fli",this.FormList?"1":"0");break;case RD3Glb.CMD_ACCELL:if((this.Accell==null||this.Accell.length==0)&&d){break}if(this.Accell!=null){e.SetAttribute("acc",this.Accell)}break;case RD3Glb.CMD_CANDRAG:if(this.CanDrag==false&&d){break}e.SetAttribute("cdg",this.CanDrag?"1":"0");break;case RD3Glb.CMD_CANDROP:if(this.CanDrop==false&&d){break}e.SetAttribute("cdp",this.CanDrop?"1":"0");break;case RD3Glb.CMD_BADGE:if(this.iBadge.length==0&&d){break}e.SetAttribute("bdg",this.iBadge);break}};ACommandSrv.prototype.PrepareForAutocollapse=function(a){if(this.IsMenu){this.ExpandEventDef=RD3Glb.EVENT_ACTIVE;if(a>this.Level){for(var b=0;b<this.iCommands.length;b++){if(this.iCommands[b]!=null){this.iCommands[b].PrepareForAutocollapse(a)}}}}};ACommandSrv.prototype.Badge=function(){return this.iBadge};ACommandSrv.prototype.set_Badge=function(a){if(this.iBadge!=a){this.iBadge=a;this.RD3Change(RD3Glb.CMD_BADGE)}};function ADynQuerySrv(a){this.SQL;this.ConnDB;this.RS=new IDCachedRowSet();this.IMDBTable=-1;this.iGuid;this.ParentRep=null;this.Parent=a;this.RSParam=new ArrayList();this.QueryParameters=new ArrayList()}ADynQuerySrv.prototype.SetQuery=function(c,a,b){this.SQL=c;this.ConnDB=a;this.RS.setReadOnly();if(this.ParentRep==null){this.PrepareParam(this.Parent.Parent.IMDB,b)}};ADynQuerySrv.prototype.PrepareParam=function(c,l){var p=-1;var m=-1;var h=true;while(h||(p>-1&&m>-1)){h=false;p=this.SQL.indexOf("~~",p+1);m=this.SQL.indexOf("~~",p+1);if(p>=0&&m>=0){var q=this.SQL.substr(p+2,m-(p+2));this.SQL=this.SQL.substr(0,p)+"?"+this.SQL.substr(m+2);var b=new PQueryParamSrv();this.QueryParameters.Add(b);var d=q.lastIndexOf(".");if(d>=0){var a=0;try{a=parseInt(q.substr(0,d),10)}catch(g){}if(a>0){b.RepIdx=a;var k=this.ParentRep.Parent.Parent.FindObjByID(b.RepIdx);if(b.RepIdx>-1){b.FldIdx=k.DSE.GetFldIdx(q.substr(d+1))}}else{b.TblIdx=c.TblByCode(q.substr(0,d),l);if(b.TblIdx>-1){b.FldIdx=c.FldByCode(b.TblIdx,q.substr(d+1))}}}if(b.FldIdx>-1){b.AttValue=new IDVariant();if(b.RepIdx>-1){var k=this.ParentRep.Parent.Parent.FindObjByID(b.RepIdx);k.DSE.GetFieldValue(b.AttValue,b.FldIdx);var j=new IDVariant();var o=new IDVariant();var f=new IDVariant();k.DSE.GetFldParam(b.FldIdx,j,o,f);b.DataType=j.intValue();b.MaxLength=o.intValue();b.vScale=f.intValue()}else{b.DataType=c.GetFldDataType(b.TblIdx,b.FldIdx);b.MaxLength=c.GetFldMaxLength(b.TblIdx,b.FldIdx);b.vScale=c.GetFldScale(b.TblIdx,b.FldIdx)}}}}};ADynQuerySrv.prototype.UpdateParam=function(b,e){var h=e;if(this.ParentRep!=null){this.PrepareParam(this.Parent.Parent.IMDB,b)}for(var f=0;f<this.QueryParameters.Count();f++){var a=this.QueryParameters[f];if(a.RepIdx>-1&&a.FldIdx>-1){var c=this.ParentRep.Parent.Parent.FindObjByID(a.RepIdx);var d=new IDVariant();c.DSE.GetFieldValue(d,a.FldIdx);if(d.CompareTo(a.AttValue)!=0&&!(a.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){a.AttValue=d;h=true}}if(a.TblIdx>-1&&a.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(a.TblIdx,0)||e){if(!this.Parent.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0).equals(a.AttValue)){a.AttValue=this.Parent.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);h=true}}}}this.RSParam.Clear();if(h){for(var g=0;g<this.QueryParameters.Count();g++){var a=this.QueryParameters[g];this.RSParam.Add(a.AttValue)}}return h};ADynQuerySrv.prototype.FindData=function(b,a){try{if(!this.ConnDB.IsOpen()){b.OpenConnection(this.ConnDB)}b.DTTObj.AddQuery(this.iGuid,a+" - Find data",a+" find data",DTTEngine.STMT_QRY_SELECT,this.SQL);try{for(var f=0;f<this.RSParam.Count();f++){var c=this.RSParam[f];b.DTTObj.AddParameter(this.iGuid,this.iGuid,"Param "+f+1,c)}}catch(g){}this.RS.setCommand(this.ConnDB.ApplySubstitutions(this.SQL));this.RS.execute(this.RSParam,this.ConnDB);if(!this.RS.EOF()){this.RS.MoveFirst()}b.DTTObj.AddDBDataSource(this.RS,this.SQL);b.DTTObj.EndQuery(this.iGuid);return true}catch(d){b.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",156,a+" - Find data",a+" - Error: "+d.message);b.DTTObj.AddParameter("","","SQL",new IDVariant(this.SQL));WriteToConsoleError(d);return false}};ADynQuerySrv.prototype.GetHashKey=function(c){var b="";try{for(var a=1;a<=this.RS.GetNumFields();a++){if(c.Count()==0){b+=this.RS.Get(a).stringValue()}else{if(c.Contains(this.RS.GetName(a))){b+=this.RS.Get(a).stringValue()}}}}catch(d){}return b};ADynQuerySrv.prototype.SelectRow=function(d,c,a){if(this.IMDBTable==-1){return}for(var b=0;b<c.TblNumField(this.IMDBTable);b++){c.Value(this.IMDBTable,b,0).changeType(IDVariant.NULL)}try{this.RS.absolute(d);for(var b=0;b<c.TblNumField(this.IMDBTable);b++){c.set_Value(this.IMDBTable,b,0,this.RS.Get(b+1))}}catch(f){}};function AFrameSrv(a){this.Caption="";this.Vertical=false;this.ChildFrame1=null;this.ChildFrame2=null;this.Description=null;this.Width=0;this.Height=0;this.FixedWidth=0;this.FixedHeight=0;this.OriginalHeight=0;this.OriginalWidth=0;this.MinWidth=0;this.MaxWidth=0;this.MinHeight=0;this.MaxHeight=0;this.FormFactor=0;this.Parent=null;this.Content=null;this.Index=a;this.InTabbed=false;this.TabIdx=0;this.Exposed=true;this.FrHidden=false;this.FrBorder=false;this.IsSubFrame=false;this.HasBorder=false;this.iUseSmallIcon=-1;this.HasCaptionToolbar=-1;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.AFR_MAXPROP);this.RD3NewObj=false;this.RD3DelObj=false}AFrameSrv.prototype.GetTotalSize=function(){var c=new RectSrv();if(this.ChildFrame1!=null&&this.ChildFrame2!=null){var b=this.ChildFrame1.GetTotalSize();var a=this.ChildFrame2.GetTotalSize();if(this.Vertical){c.Width=(b.Width>a.Width?b.Width:a.Width);c.Height=b.Height+a.Height}else{c.Height=(b.Height>a.Height?b.Height:a.Height);c.Width=b.Width+a.Width}}else{c.Width=this.FixedWidth;c.Height=this.FixedHeight;if(this.Content!=null){if(this.Content instanceof IDPanelSrv){var d=this.Content.GetBoundRect();c.Width=d.Width+Glb.PAN_OFFS_X;c.Height=d.Height+Glb.PAN_OFFS_PAGEY+Glb.PAN_OFFS_Y}if(this.Content instanceof ATreeSrv){c.Width=this.Content.Width;c.Height=this.Content.Height}if(this.Content instanceof OTabViewSrv){if(this.Content.SelectedTab>0){var e=this.Content.GetItem(this.Content.SelectedTab);c=e.GetTotalSize();c.Height=c.Height+Glb.PAN_OFFS_PAGEY}}}}return c};AFrameSrv.prototype.set_Caption=function(a){if(!this.Caption.equals(a)){this.Caption=a;this.RD3Change(RD3Glb.AFR_CAPTION)}};AFrameSrv.prototype.set_SubFrame=function(a){this.IsSubFrame=a};AFrameSrv.prototype.ProcessRequest=function(a,c,b){if(!b){if(this.HasCaptionToolbar==1){a.CmdObj.ProcessCaptionRequest(this.Index,this.Parent,a)}if(a.GetParameter("exp"+this.Index+".x")!=null){this.Content.set_Collapsed(false)}if(a.GetParameter("col"+this.Index+".x")!=null){this.Content.set_Collapsed(true)}}if(this.Content!=null&&((this.Content.Visible&&!this.Content.Collapsed)||!b)){this.Content.ProcessRequest(a,this.Parent,c,b)}};AFrameSrv.prototype.DTTTrace=function(a){};AFrameSrv.prototype.UpdateFrame=function(){};AFrameSrv.prototype.UseSmallIcon=function(a){if(this.iUseSmallIcon==-1){this.iUseSmallIcon=(a.ParamsObj().UseSmallIcon||this.IsSubFrame)?1:0}return this.iUseSmallIcon!=0};AFrameSrv.prototype.PUseSmallIcon=function(){return this.iUseSmallIcon!=0};AFrameSrv.prototype.set_PUseSmallIcon=function(a){this.iUseSmallIcon=(a)?1:0;this.RD3Change(RD3Glb.AFR_USESMALLICON)};AFrameSrv.prototype.Resize=function(a,c){if(this.OriginalHeight==0){this.OriginalHeight=this.Height}if(this.OriginalWidth==0){this.OriginalWidth=this.Width}var g=(this.OriginalHeight>120)?128:this.OriginalHeight+8;var m=(this.OriginalWidth>120)?128:this.OriginalWidth+8;if(a>this.MaxWidth&&this.MaxWidth>0){a=this.MaxWidth}if(a<this.MinWidth){a=this.MinWidth}if(c>this.MaxHeight&&this.MaxHeight>0){c=this.MaxHeight}if(c<this.MinHeight){c=this.MinHeight}if(c<g){c=g}if(a<m){a=m}var e=1;var o=1;if(a!=this.Width&&this.Width!=0){e=(a+0)/this.Width}if(c!=this.Height&&this.Height!=0){o=(c+0)/this.Height}if(this.ChildFrame1!=null){if(this.Vertical){var j=Math.floor(c*this.FormFactor);j=j-(j%4);this.ChildFrame1.Resize(a,j);a=this.ChildFrame1.Width;this.ChildFrame2.Resize(a,c-this.ChildFrame1.Height);if(this.ChildFrame2.Height!=c-this.ChildFrame1.Height){this.ChildFrame1.Resize(a,c-this.ChildFrame2.Height);this.ChildFrame2.Resize(this.ChildFrame2.Width,this.ChildFrame2.Height)}if(this.ChildFrame2.Width!=a){a=this.ChildFrame2.Width;this.ChildFrame1.Resize(a,this.ChildFrame1.Height)}c=this.ChildFrame1.Height+this.ChildFrame2.Height;a=(this.ChildFrame1.Width>this.ChildFrame2.Width?this.ChildFrame1.Width:this.ChildFrame2.Width)}else{var j=Math.floor(a*this.FormFactor);j=j-(j%4);this.ChildFrame1.Resize(j,c);c=this.ChildFrame1.Height;this.ChildFrame2.Resize(a-this.ChildFrame1.Width,c);if(this.ChildFrame2.Width!=a-this.ChildFrame1.Width){this.ChildFrame1.Resize(a-this.ChildFrame2.Width,c);this.ChildFrame2.Resize(this.ChildFrame2.Width,this.ChildFrame2.Height)}if(this.ChildFrame2.Height!=c){c=this.ChildFrame2.Height;this.ChildFrame1.Resize(this.ChildFrame1.Width,c)}a=this.ChildFrame1.Width+this.ChildFrame2.Width;c=(this.ChildFrame1.Height>this.ChildFrame2.Height?this.ChildFrame1.Height:this.ChildFrame2.Height)}}this.Width=a;this.Height=c;var b=8;var l=8;if((this.Content instanceof IDPanelSrv||this.Content instanceof OBookSrv)&&!this.FrHidden){if(this.Parent!=null){l=(this.UseSmallIcon(this.Parent.MainFrm)?28:38)}else{l=(this.PUseSmallIcon()?28:38)}}if(this.Content instanceof OTabViewSrv){l=28}var k=this.Width-b;var f=this.Height-l;if(this.Content!=null){this.Content.Resize(k,f)}this.Width=k+b;this.Height=f+l;this.FixedHeight=this.Height;this.FixedWidth=this.Width};AFrameSrv.prototype.GetRD3Ident=function(){if(this.Content==null){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FormIdx}else{return this.Content.GetRD3Ident()}};AFrameSrv.prototype.GetRD3Name=function(){if(this.Content==null){return"wfr"}else{return this.Content.GetRD3Name()}};AFrameSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AFrameSrv.prototype.RD3RenderDifferences=function(b,e){if(this.RD3DelObj){return false}this.DTTTrace(this.Parent.MainFrm);var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.OriginalHeight==0){this.OriginalHeight=this.Height}if(this.OriginalWidth==0){this.OriginalWidth=this.Width}d.SetAttribute("orh",this.OriginalHeight.toString());d.SetAttribute("orw",this.OriginalWidth.toString())}if(this.Content!=null){c|=(this.Content.RD3RenderDifferences(d,b,e)!=null)}return c};AFrameSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.AFR_CAPTION:if(this.Caption.length==0&&b){break}c.SetAttribute("cap",this.Caption);break;case RD3Glb.AFR_VERTICAL:if(!this.Vertical&&b){break}c.SetAttribute("ver",this.Vertical?"1":"0");break;case RD3Glb.AFR_WIDTH:if(this.Width==0&&b){break}c.SetAttribute("wid",this.Width.toString());break;case RD3Glb.AFR_HEIGHT:if(this.Height==0&&b){break}var d=this.Height;if(this.Content instanceof IDPanelSrv){if(this.Content.MainFrm.IsMobile()&&this.Content.IsShowingGrouping()&&this.Content.Queries[0].RecordCount()==this.Content.NumRows){var e=this.Content.GroupRoot.getLabelNumber();d+=(e*this.Content.MaxHRow)}}c.SetAttribute("hei",d.toString());break;case RD3Glb.AFR_MINWIDTH:if(this.MinWidth==0&&b){break}c.SetAttribute("miw",this.MinWidth.toString());break;case RD3Glb.AFR_MINHEIGHT:if(this.MinHeight==0&&b){break}c.SetAttribute("mih",this.MinHeight.toString());break;case RD3Glb.AFR_MAXWIDTH:if(this.MaxWidth==9999&&b){break}c.SetAttribute("maw",this.MaxWidth.toString());break;case RD3Glb.AFR_MAXHEIGHT:if(this.MaxHeight==9999&&b){break}c.SetAttribute("mah",this.MaxHeight.toString());break;case RD3Glb.AFR_FRHIDDEN:if(!this.FrHidden&&b){break}c.SetAttribute("ocn",this.FrHidden?"1":"0");break;case RD3Glb.AFR_USESMALLICON:if(!this.UseSmallIcon(this.Parent.MainFrm)&&b){break}c.SetAttribute("smi",this.UseSmallIcon(this.Parent.MainFrm)?"1":"0");break;case RD3Glb.AFR_CHILD1:if(this.ChildFrame1==null){break}c.SetAttribute("fr1",this.ChildFrame1.GetRD3Ident());break;case RD3Glb.AFR_CHILD2:if(this.ChildFrame2==null){break}c.SetAttribute("fr2",this.ChildFrame2.GetRD3Ident());break;case RD3Glb.AFR_FRBORDER:if(!this.FrBorder){break}c.SetAttribute("frb",this.FrBorder?"1":"0");break}};AGraphSrv.JFREECHART=1;AGraphSrv.FUSIONCHART=2;AGraphSrv.OPENSOURCECHART=3;AGraphSrv.EXTLIBRARY=4;AGraphSrv.JQPLOT=5;AGraphSrv.BARCHART=1;AGraphSrv.BAR3DCHART=2;AGraphSrv.LINECHART=3;AGraphSrv.AREACHART=4;AGraphSrv.PIECHART=5;AGraphSrv.PIE3DCHART=6;AGraphSrv.RINGCHART=7;AGraphSrv.TIMELINECHART=8;AGraphSrv.TIMEBARCHART=9;AGraphSrv.XYLINECHART=10;AGraphSrv.SCATTERCHART=11;AGraphSrv.SPIDERWEBCHART=12;AGraphSrv.FL_GRH_TOOLTIP=1048576;AGraphSrv.FL_GRH_SHOWXAXIS=2097152;AGraphSrv.FL_GRH_SHOWYAXIS=4194304;AGraphSrv.FL_GRH_SHOWGRIDX=8388608;AGraphSrv.FL_GRH_SHOWGRIDY=16777216;AGraphSrv.FL_GRH_ACTIVE=33554432;AGraphSrv.HORIZONTAL=0;AGraphSrv.VERTICAL=1;AGraphSrv.NONE=1;AGraphSrv.LEFT=2;AGraphSrv.TOP=3;AGraphSrv.RIGTH=4;AGraphSrv.BOTTOM=5;AGraphSrv.CENTER=6;AGraphSrv.OK=40;AGraphSrv.DATAERROR=41;AGraphSrv.CHARTTYPEERROR=42;AGraphSrv.GENERICERROR=43;AGraphSrv.LIBRARYERROR=44;AGraphSrv.FORMATNOTSUPPORTEDERROR=45;AGraphSrv.YEAR=0;AGraphSrv.MONTH=1;AGraphSrv.DAY=2;AGraphSrv.HOUR=3;AGraphSrv.MINUTE=4;AGraphSrv.WEEK=5;AGraphSrv.JPG=0;AGraphSrv.PNG=1;function AGraphSrv(a){WebFrameSrv.call(this,a);this.libraryUsed=AGraphSrv.JQPLOT;this.QueryObj=new ADynQuerySrv(this);this.IMDBDataSource=-1;this.GraphCode="";this.libraryObj=new GraphLibraryJQPlot();this.libraryObj.setMainFrm(this.MainFrm);this.outputFormat=AGraphSrv.PNG;this.prefix="";this.GraErrTxt=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.GRA_MAXPROPS);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ShowAnimationDef=null}AGraphSrv.prototype=new WebFrameSrv();AGraphSrv.prototype.Init=function(a){this.Parent=a};AGraphSrv.prototype.GetCaption=function(){if(this.FrIndex!=-1&&this.FrIndex<this.Parent.Frames.length){return this.Parent.Frames[FrIndex].Caption}else{return this.Code}};AGraphSrv.prototype.Description=function(){return(this.libraryObj!=null?this.libraryObj.getSubtitle():"")};AGraphSrv.prototype.set_TitleDescription=function(a,c){if(this.libraryObj!=null){var b=this.libraryObj.getTitle();var d=this.libraryObj.getSubtitle();if(!b.equals(a)||!d.equals(c)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTitleandSubtitle(a,c)}};AGraphSrv.prototype.Title=function(){return(this.libraryObj!=null?this.libraryObj.getTitle():"")};AGraphSrv.prototype.set_Title=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getTitle();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTitle(a)}};AGraphSrv.prototype.ChartType=function(){return(this.libraryObj!=null?this.libraryObj.getChartType():-1)};AGraphSrv.prototype.set_ChartType=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getChartType();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setChartType(a)}};AGraphSrv.prototype.AxisXVisible=function(){return(this.libraryObj!=null?this.libraryObj.getXAxisVisible():false)};AGraphSrv.prototype.set_AxisXVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getXAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setXAxisVisible(b)}};AGraphSrv.prototype.LabelAxisX=function(){return(this.libraryObj!=null?this.libraryObj.getLabelXAxis():"")};AGraphSrv.prototype.set_LabelAxisX=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelXAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelXAxis(a)}};AGraphSrv.prototype.GridXVisible=function(){return(this.libraryObj!=null?this.libraryObj.getXGridVisible():false)};AGraphSrv.prototype.set_GridXVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getXGridVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setXGridVisible(b)}};AGraphSrv.prototype.VisualStyleAxisX=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleXAxis():-1)};AGraphSrv.prototype.set_VisualStyleAxisX=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleXAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleXAxis(a)}};AGraphSrv.prototype.AxisYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getYAxisVisible():false)};AGraphSrv.prototype.set_AxisYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getYAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setYAxisVisible(b)}};AGraphSrv.prototype.LabelAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getLabelYAxis():"")};AGraphSrv.prototype.set_LabelAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelYAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelYAxis(a)}};AGraphSrv.prototype.GridYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getYGridVisible():false)};AGraphSrv.prototype.set_GridYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getYGridVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setYGridVisible(b)}};AGraphSrv.prototype.VisualStyleAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleYAxis():-1)};AGraphSrv.prototype.set_VisualStyleAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleYAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleYAxis(a)}};AGraphSrv.prototype.LabelDualAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getDualLabelYAxis():"")};AGraphSrv.prototype.set_LabelDualAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getDualLabelYAxis();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setDualLabelYAxis(a)}};AGraphSrv.prototype.DualAxisYVisible=function(){return(this.libraryObj!=null?this.libraryObj.getDualYAxisVisible():false)};AGraphSrv.prototype.set_DualAxisYVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getDualYAxisVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setDualYAxisVisible(b)}};AGraphSrv.prototype.VisualStyleDualAxisY=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleDualYAxis():-1)};AGraphSrv.prototype.set_VisualStyleDualAxisY=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleDualYAxis();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleDualYAxis(a)}};AGraphSrv.prototype.VisualStyleChart=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStyleChart():-1)};AGraphSrv.prototype.set_VisualStyleChart=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStyleChart();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStyleChart(a);this.libraryObj.setVisualStyleXAxis(a);this.libraryObj.setVisualStyleYAxis(a);this.libraryObj.setVisualStylePieGraph(a)}};AGraphSrv.prototype.BorderVisible=function(){return(this.libraryObj!=null?this.libraryObj.getBorderVisible():false)};AGraphSrv.prototype.set_BorderVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getBorderVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setBorderVisible(b)}};AGraphSrv.prototype.Alpha=function(){return(this.libraryObj!=null?this.libraryObj.getAlpha():0)};AGraphSrv.prototype.set_Alpha=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getAlpha();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setAlpha(b)}};AGraphSrv.prototype.Orientation=function(){return(this.libraryObj!=null?this.libraryObj.getOrientation():-1)};AGraphSrv.prototype.set_Orientation=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getOrientation();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setOrientation(a)}};AGraphSrv.prototype.VisualStylePieGraph=function(){return(this.libraryObj!=null?this.libraryObj.getVisualStylePieGraph():-1)};AGraphSrv.prototype.set_VisualStylePieGraph=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getVisualStylePieGraph();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setVisualStylePieGraph(a)}};AGraphSrv.prototype.PiePercentVisible=function(){return(this.libraryObj!=null?this.libraryObj.getPercentVisible():false)};AGraphSrv.prototype.set_PiePercentVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getPercentVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setPercentVisible(b)}};AGraphSrv.prototype.AutoRangeX=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeX():false)};AGraphSrv.prototype.activateAutoRangeX=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeX()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeX()}};AGraphSrv.prototype.AutoRangeY=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeY():false)};AGraphSrv.prototype.activateAutoRangeY=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeY()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeY()}};AGraphSrv.prototype.AutoRangeDualY=function(){return(this.libraryObj!=null?this.libraryObj.AutoRangeDualY():false)};AGraphSrv.prototype.activateAutoRangeDualY=function(){if(this.libraryObj!=null){if(!this.libraryObj.AutoRangeDualY()){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.activateAutoRangeDualY()}};AGraphSrv.prototype.minValueX=function(){return(this.libraryObj!=null?this.libraryObj.minValueX():-1)};AGraphSrv.prototype.maxValueX=function(){return(this.libraryObj!=null?this.libraryObj.maxValueX():-1)};AGraphSrv.prototype.set_RangeX=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueX();var a=this.libraryObj.maxValueX();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeX(b,d)}};AGraphSrv.prototype.minValueY=function(){return(this.libraryObj!=null?this.libraryObj.minValueY():-1)};AGraphSrv.prototype.maxValueY=function(){return(this.libraryObj!=null?this.libraryObj.maxValueY():-1)};AGraphSrv.prototype.set_RangeY=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueY();var a=this.libraryObj.maxValueY();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeY(b,d)}};AGraphSrv.prototype.minValueDualY=function(){return(this.libraryObj!=null?this.libraryObj.minValueDualY():-1)};AGraphSrv.prototype.maxValueDualY=function(){return(this.libraryObj!=null?this.libraryObj.maxValueDualY():-1)};AGraphSrv.prototype.set_RangeDualY=function(b,d){if(this.libraryObj!=null){var c=this.libraryObj.minValueDualY();var a=this.libraryObj.maxValueDualY();if(c!=b||a!=d){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setRangeDualY(b,d)}};AGraphSrv.prototype.NumSeries=function(){return(this.libraryObj!=null?this.libraryObj.getNumSeries():-1)};AGraphSrv.prototype.set_NumSeries=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getNumSeries();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setNumSeries(b)}};AGraphSrv.prototype.SerieLabel=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieLabel(a):"")};AGraphSrv.prototype.set_SerieLabel=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieLabel(c);if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setSerieLabel(c,a)}};AGraphSrv.prototype.SerieType=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieType(a):-1)};AGraphSrv.prototype.set_SerieType=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieType(c);if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setSerieType(c,a)}};AGraphSrv.prototype.SerieDualAxis=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieDualYAxis(a):false)};AGraphSrv.prototype.set_SerieDualAxis=function(c,b){if(this.libraryObj!=null){var a=this.libraryObj.getSerieDualYAxis(c);if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setSerieDualYAxis(c,b)}};AGraphSrv.prototype.LabelOrientation=function(){return(this.libraryObj!=null?this.libraryObj.getLabelOrientation():-1)};AGraphSrv.prototype.set_LabelOrientation=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getLabelOrientation();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLabelOrientation(a)}};AGraphSrv.prototype.set_Height=function(a){if(this.Height!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_HEIGHT);this.UpdateGraph(this.Parent.MainFrm);WebFrameSrv.prototype.set_Height.call(this,a)}};AGraphSrv.prototype.set_Width=function(a){if(this.Width!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_WIDTH);this.UpdateGraph(this.Parent.MainFrm);WebFrameSrv.prototype.set_Width.call(this,a)}};AGraphSrv.prototype.VisualStyleSerie=function(a){return(this.libraryObj!=null?this.libraryObj.getSerieVisualStyle(a):-1)};AGraphSrv.prototype.set_VisualStyleSerie=function(c,a){if(this.libraryObj!=null){var b=this.libraryObj.getSerieVisualStyle(c);if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setSerieVisualStyle(c,a)}};AGraphSrv.prototype.LegendVisible=function(){return(this.libraryObj!=null?this.libraryObj.getLegendVisible():false)};AGraphSrv.prototype.set_LegendVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getLegendVisible();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLegendVisible(b)}};AGraphSrv.prototype.LegendPosition=function(){return(this.libraryObj!=null?this.libraryObj.getLegendPosition():-1)};AGraphSrv.prototype.set_LegendPosition=function(c){if(c==AGraphSrv.NONE&&this.libraryObj!=null){var a=this.libraryObj.getLegendVisible();if(a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLegendVisible(false);return}if(this.libraryObj!=null){var a=this.libraryObj.getLegendVisible();var b=this.libraryObj.getLegendPosition();if(!a||b!=c){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setLegendVisible(true);this.libraryObj.setLegendPosition(c)}};AGraphSrv.prototype.StackedChart=function(){return(this.libraryObj!=null?this.libraryObj.getStackedChart():false)};AGraphSrv.prototype.set_StackedChart=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getStackedChart();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_SWF)}this.libraryObj.setStackedChart(b)}};AGraphSrv.prototype.Explosion=function(a){return(this.libraryObj!=null?this.libraryObj.getExplosion(a):0)};AGraphSrv.prototype.set_Explosion=function(b,c){if(this.libraryObj!=null){var a=this.libraryObj.getExplosion(b);if(a!=c){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setExplosion(b,c)}};AGraphSrv.prototype.ShowShapes=function(){return(this.libraryObj!=null?this.libraryObj.getShowPoints():false)};AGraphSrv.prototype.set_ShowShapes=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getShowPoints();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setShowPoints(b)}};AGraphSrv.prototype.LabelValuesVisible=function(){return(this.libraryObj!=null?this.libraryObj.getShowValueLabel():false)};AGraphSrv.prototype.set_LabelValuesVisible=function(b){if(this.libraryObj!=null){var a=this.libraryObj.getShowValueLabel();if(a!=b){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setShowValueLabel(b)}};AGraphSrv.prototype.TimePeriod=function(){return(this.libraryObj!=null?this.libraryObj.getTimePeriod():-1)};AGraphSrv.prototype.set_TimePeriod=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getTimePeriod();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setTimePeriod(a)}};AGraphSrv.prototype.Hyperlink=function(){return(this.libraryObj!=null?this.libraryObj.getHyperlink():false)};AGraphSrv.prototype.set_Hyperlink=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getHyperlink();if(b!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP);this.RD3Change(RD3Glb.GRA_ACTIVE)}this.libraryObj.setHyperlink(a);this.Enabled=a}};AGraphSrv.prototype.OutputFormat=function(a){return this.outputFormat};AGraphSrv.prototype.set_OutputFormat=function(a){if(this.outputFormat!=a){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.outputFormat=a};AGraphSrv.prototype.getLibrary=function(){return this.libraryUsed};AGraphSrv.prototype.setLibrary=function(a){};AGraphSrv.prototype.getChartObject=function(){return(this.libraryObj!=null?this.libraryObj.getChartObject():null)};AGraphSrv.prototype.getGraphFile=function(){return(this.libraryObj!=null?this.libraryObj.getGraphFile():"")};AGraphSrv.prototype.setGraphFile=function(a){if(this.libraryObj!=null){var b=this.libraryObj.getGraphFile();if(!b.equals(a)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}this.libraryObj.setGraphFile(a)}};AGraphSrv.prototype.SetQuery=function(d,a,b,c){this.QueryObj.SetQuery(d,a,b);this.QueryObj.iGuid=c;return AGraphSrv.OK};AGraphSrv.prototype.SetIMDBTable=function(a){this.QueryObj.IMDBTable=a;return AGraphSrv.OK};AGraphSrv.prototype.UpdateGraph=function(c,b){if(b==undefined){b=false}if(!this.Visible||this.Collapsed){c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"AGraph.UpdateGraph","Graph "+this.GetCaption()+": update not performed (the graph is either invisible, collapsed or not exposed)");return AGraphSrv.OK}try{if(this.IMDBDataSource==-1){this.UpdateGraphDB(c,this.iGuid,b)}else{this.UpdateGraphIMDB(c,b)}}catch(g){var a="";var h="";var f="";var d="";a="Internal error while creating image";h="<br><br>Internal error while creating image.<br><br>"+g.message;f="<br><br>Internal error while creating image.<br><br>Contact the provider of the application and report this error";d="Internal error while creating image.\n\n"+g.stack;if(a.length>0){c.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,72,"AGraph.UpdateGraph","Graph "+this.GetCaption()+": "+a);c.DTTObj.AddException(this.iGuid,"AGraph.UpdateGraph","",g)}if(f.length>0){this.GraErrTxt=f}if(this.GraErrTxt.length>0){this.RD3Change(RD3Glb.GRA_ERRTXT)}if(d.length>0){WriteToConsoleError(d)}}return AGraphSrv.OK};AGraphSrv.prototype.UpdateGraphDB=function(b,e,d){if(!this.QueryObj.RS.IsOpen()){d=true}d|=this.QueryObj.UpdateParam(b,d);if(d&&this.QueryObj.FindData(b,"Graph "+this.Code)){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}if(this.RD3Changed||d){if(this.QueryObj.RS.RecordCount()==0){this.libraryObj.setGraphFile("");return true}var a=this.Width;var c=this.Height;if(b.ParamsObj().UseRD3){a-=4;c-=4}if(a>0&&c>0){this.libraryObj.drawGraph(this.QueryObj.RS,a,c,this.outputFormat)}}return true};AGraphSrv.prototype.UpdateGraphIMDB=function(b,e){var c=this.Parent.IMDB;if(c.TblModified(this.IMDBDataSource,Glb.GlbRefModIdx)){e=true}if(e){this.RD3Change(RD3Glb.GRA_FILE);this.RD3Change(RD3Glb.GRA_CODICE);this.RD3Change(RD3Glb.GRA_MAP)}if(this.RD3Changed||e){if(c.TblNumRows(this.IMDBDataSource)==0){this.libraryObj.setGraphFile("");return true}var a=this.Width;var d=this.Height;if(b.ParamsObj().UseRD3){a-=4;d-=4}if(a>0&&d>0){this.libraryObj.drawGraph(c,this.IMDBDataSource,a,d,this.outputFormat)}}return true};AGraphSrv.prototype.SelectPoint=function(e,d,a){if(this.IMDBDataSource==-1){this.QueryObj.SelectRow(e,d,a)}else{var c=1;var b=this.QueryObj.IMDBTable;d.TblMoveFirst(this.IMDBDataSource,0);while(c<e){d.TblMoveNext(this.IMDBDataSource,0);c=c+1}for(c=0;c<d.TblNumField(this.IMDBDataSource);c++){d.set_Value(b,c,0,d.Value(this.IMDBDataSource,c,0))}}};AGraphSrv.prototype.set_Legenda=function(a){if(a==AGraphSrv.NONE){this.set_LegendVisible(false)}else{this.set_LegendVisible(true);this.set_LegendPosition(a)}};AGraphSrv.prototype.set_Flags=function(a){if((a&AGraphSrv.FL_GRH_TOOLTIP)>0){}this.set_AxisXVisible((a&AGraphSrv.FL_GRH_SHOWXAXIS)>0);this.set_AxisYVisible((a&AGraphSrv.FL_GRH_SHOWYAXIS)>0);this.set_GridXVisible((a&AGraphSrv.FL_GRH_SHOWGRIDX)>0);this.set_GridYVisible((a&AGraphSrv.FL_GRH_SHOWGRIDY)>0);this.set_Hyperlink((a&AGraphSrv.FL_GRH_ACTIVE)>0)};AGraphSrv.getFont=function(d){var b=new Object();b.FontFamily="Tahoma";b.Size=10;try{var a=d.split(",");if(a.length==3){b.FontFamily=a[0];b.Size=parseInt(a[2],10)}}catch(c){}return b};AGraphSrv.getColor=function(a){throw"Not implemented : AGraphSrv::getColor"};AGraphSrv.prototype.FireGraphClick=function(c,a){var d=parseInt(c.substr(1,2),10);var b=parseInt(c.substr(4),10);this.SelectPoint(b,this.Parent.IMDB,a);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,108,"AGraph.FireGraphClick","Graph "+this.Code+": Fire GraphClick event");this.Parent.OnGraphClick(this,new IDVariant(d),new IDVariant(b))};AGraphSrv.prototype.copyFrom=function(d,a){a.setTitle(d.getTitle());a.setChartType(d.getChartType());a.setNumSeries(d.getNumSeries());a.setLegendVisible(d.getLegendVisible());a.setLegendPosition(d.getLegendPosition());a.setBorderVisible(d.getBorderVisible());a.setAlpha(d.getAlpha());a.setTooltipsVisible(d.getTooltipsVisible());a.setOrientation(d.getOrientation());a.setShowPoints(d.getShowPoints());a.setShowValueLabel(d.getShowValueLabel());a.setTimePeriod(d.getTimePeriod());a.setUrlString(this.prefix,this.FrIndex,this.Parent.FormIdx);a.setHyperlink(d.getHyperlink());a.setVisualStyleChart(d.getVisualStyleChart());a.setStackedChart(d.getStackedChart());a.setLabelXAxis(d.getLabelXAxis());a.setVisualStyleXAxis(d.getVisualStyleXAxis());a.setLabelOrientation(d.getLabelOrientation());a.setXAxisVisible(d.getXAxisVisible());if(!d.AutoRangeX()){a.setRangeX(d.minValueX(),d.maxValueX())}a.setXGridVisible(d.getXGridVisible());a.setLabelYAxis(d.getLabelYAxis());a.setVisualStyleYAxis(d.getVisualStyleYAxis());a.setYAxisVisible(d.getYAxisVisible());if(!d.AutoRangeY()){a.setRangeY(d.minValueY(),d.maxValueY())}a.setYGridVisible(d.getYGridVisible());a.setVisualStylePieGraph(d.getVisualStylePieGraph());a.setPercentVisible(d.getPercentVisible());var c=d.getGraphFile();a.setGraphFile(c);for(var b=1;b<=d.getNumSeries();b++){a.setSerieLabel(b,d.getSerieLabel(b))}for(var b=1;b<=d.getNumSeries();b++){a.setExplosion(b,d.getExplosion(b))}for(var b=1;b<=d.getNumSeries();b++){a.setSerieVisualStyle(b,d.getSerieVisualStyle(b))}for(var b=1;b<=d.getNumSeries();b++){a.setSerieType(b,d.getSerieType(b))}a.setDualYAxisVisible(d.getDualYAxisVisible());a.setDualLabelYAxis(d.getDualLabelYAxis());for(var b=1;b<=d.getNumSeries();b++){a.setSerieDualYAxis(b,d.getSerieDualYAxis(b))}};AGraphSrv.prototype.getWebFileName=function(a){if(this.libraryObj!=null){if(this.IMDBDataSource==-1){this.UpdateGraphDB(a,this.iGuid,false)}else{this.UpdateGraphIMDB(a,false)}return this.libraryObj.getGraphFile()}else{return""}};AGraphSrv.prototype.GetRD3Name=function(){return"gra"};AGraphSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AGraphSrv.prototype.RD3RenderDifferences=function(f,c,e){var d=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,c,e);if(f==null){f=a}d|=(a!=null);if(f==null&&this.RD3Changed){f=c.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());a=f}if(e||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||e){this.SetRD3Property(b,f,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){f.SetAttribute("clk",this.ClickEventDef)}if(this.ShowAnimationDef!=null){f.SetAttribute("sha",this.ShowAnimationDef)}}return d?a:null};AGraphSrv.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.GRA_LIBRARY:d.SetAttribute("lib",this.getLibrary());break;case RD3Glb.GRA_ACTIVE:d.SetAttribute("ena",this.Enabled?"1":"0");break;case RD3Glb.GRA_FILE:var b=this.libraryObj.getGraphFile();d.SetAttribute("fil",b);break;case RD3Glb.GRA_CODICE:d.SetAttribute("cod",this.GraphCode+"_"+this.Parent.FormIdx);break;case RD3Glb.GRA_MAP:break;case RD3Glb.GRA_HEIGHT:d.SetAttribute("ghe",this.Height);break;case RD3Glb.GRA_WIDTH:d.SetAttribute("gwi",this.Width);break;case RD3Glb.GRA_ERRTXT:if(this.GraErrTxt!=null&&this.GraErrTxt!=""){d.SetAttribute("ger",this.GraErrTxt)}break}};AGraphSrv.prototype.RD3Resize=function(a,c,b){this.Height=c;this.Width=a;this.RD3Change(RD3Glb.GRA_HEIGHT);this.RD3Change(RD3Glb.GRA_WIDTH);this.RD3Change(RD3Glb.GRA_MAP);this.UpdateGraph(this.MainFrm,true);WebFrameSrv.prototype.RD3Resize.call(this,a,c,b)};AGraphSrv.prototype.RD3RawClick=function(a,j,g,m,f,l,d){var c=d.GetAttribute("par4");var e=-1;var h=-1;if(c!=""){e=parseInt(c.substr(1,2),10);h=parseInt(c.substr(4),10)}var k=new IDVariant();if(this.MainFrm!=null){var b=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(b,"Graph"+this.Code+" "+b,DTTRequestSrv.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Graph."+b,"Graph "+this.Code+": firing event "+b)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(e),new IDVariant(h),k)}else{this.Parent.OnMouseClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(e),new IDVariant(h),k)}return k.isTrue()};function GraphLibraryJQPlot(){this.ChartJS;this.w;this.GraphFile="";this.series=1;this.ColLabels;this.SeriesTypes;this.SeriesDualYAxis;this.prefixString="";this.frame=1;this.formIdx=0;this.graficoMisto=false;this.graficoMisto3D=false;this.titolo="";this.sottotitolo="";this.tipoGrafico=AGraphSrv.CHARTTYPEERROR;this.asseXVisibile=true;this.asseXLabel="";this.asseYVisibile=true;this.asseYLabel="";this.dualAsseYVisibile=false;this.dualAsseYLabel="";this.mostraValori=false;this.LegendaVisibile=true;this.posizioneLegenda=AGraphSrv.BOTTOM;this.explosions;this.explosionPixel=20;this.bordoVisibile=true;this.trasparenza=1;this.hyperlink=false;this.visibilitaPunti=true;this.tooltips=true;this.orientation=AGraphSrv.VERTICAL;this.direzioneLabel=AGraphSrv.HORIZONTAL;this.showPercentValues=false;this.showYGrid=false;this.showXGrid=false;this.MinValueY=0;this.MaxValueY=0;this.autoRangeY=true;this.dualMinValueY=0;this.dualMaxValueY=0;this.dualAutoRangeY=true;this.xValues=new ArrayList();this.yValues=new ArrayList();this.yValues.Add(new ArrayList());this.stackedCharts=false;this.dualYAxis=false;this.timePeriod=AGraphSrv.DAY;this.visualStyleGrafico=-1;this.visualStyleAsseX=-1;this.visualStyleAsseY=-1;this.visualStyleAsseYDuale=-1;this.visualStylePieGraph=-1;this.seriesVisualStyle;this.width=800;this.heigth=600}GraphLibraryJQPlot.prototype.setTitleandSubtitle=function(a,b){this.titolo=a;this.sottotitolo=b};GraphLibraryJQPlot.prototype.getSubtitle=function(){return this.sottotitolo};GraphLibraryJQPlot.prototype.setTitle=function(a){this.titolo=a};GraphLibraryJQPlot.prototype.getTitle=function(){return this.titolo};GraphLibraryJQPlot.prototype.setChartType=function(a){this.tipoGrafico=a};GraphLibraryJQPlot.prototype.getChartType=function(){return this.tipoGrafico};GraphLibraryJQPlot.prototype.setXAxisVisible=function(a){this.asseXVisibile=a};GraphLibraryJQPlot.prototype.getXAxisVisible=function(){return this.asseXVisibile};GraphLibraryJQPlot.prototype.setLabelXAxis=function(a){this.asseXLabel=a};GraphLibraryJQPlot.prototype.getLabelXAxis=function(){return this.asseXLabel};GraphLibraryJQPlot.prototype.setVisualStyleXAxis=function(a){this.visualStyleAsseX=a};GraphLibraryJQPlot.prototype.getVisualStyleXAxis=function(){return this.visualStyleAsseX};GraphLibraryJQPlot.prototype.setYAxisVisible=function(a){this.asseYVisibile=a};GraphLibraryJQPlot.prototype.getYAxisVisible=function(){return this.asseYVisibile};GraphLibraryJQPlot.prototype.setLabelYAxis=function(a){this.asseYLabel=a};GraphLibraryJQPlot.prototype.getLabelYAxis=function(){return this.asseYLabel};GraphLibraryJQPlot.prototype.setVisualStyleYAxis=function(a){this.visualStyleAsseY=a};GraphLibraryJQPlot.prototype.getVisualStyleYAxis=function(){return this.visualStyleAsseY};GraphLibraryJQPlot.prototype.setVisualStyleDualYAxis=function(a){this.visualStyleAsseYDuale=a};GraphLibraryJQPlot.prototype.getVisualStyleDualYAxis=function(){return this.visualStyleAsseYDuale};GraphLibraryJQPlot.prototype.setDualYAxisVisible=function(a){this.dualAsseYVisibile=a};GraphLibraryJQPlot.prototype.getDualYAxisVisible=function(){return this.dualAsseYVisibile};GraphLibraryJQPlot.prototype.setDualLabelYAxis=function(a){this.dualAsseYLabel=a};GraphLibraryJQPlot.prototype.getDualLabelYAxis=function(){return this.dualAsseYLabel};GraphLibraryJQPlot.prototype.setVisualStyleChart=function(a){this.visualStyleGrafico=a};GraphLibraryJQPlot.prototype.getVisualStyleChart=function(){return this.visualStyleGrafico};GraphLibraryJQPlot.prototype.setGraphFile=function(a){this.GraphFile=a};GraphLibraryJQPlot.prototype.getGraphFile=function(){return this.GraphFile};GraphLibraryJQPlot.prototype.setNumSeries=function(f){var b=this.ColLabels;this.ColLabels=new Array(f);for(var d=0;d<f;d++){this.ColLabels[d]=""}var a=this.seriesVisualStyle;this.seriesVisualStyle=new Array(f);for(var d=0;d<f;d++){this.seriesVisualStyle[d]=-1}var c=this.SeriesTypes;this.SeriesTypes=new Array(f);for(var d=0;d<f;d++){this.SeriesTypes[d]=-1}var e=this.SeriesDualYAxis;this.SeriesDualYAxis=new Array(f);for(var d=0;d<f;d++){this.SeriesDualYAxis[d]=false}if(b!=null){for(var d=0;d<Math.min(b.length,this.ColLabels.length);d++){this.ColLabels[d]=b[d]}}if(a!=null){for(var d=0;d<Math.min(a.length,this.seriesVisualStyle.length);d++){this.seriesVisualStyle[d]=a[d]}}if(c!=null){for(var d=0;d<Math.min(c.length,this.SeriesTypes.length);d++){this.SeriesTypes[d]=c[d]}}if(e!=null){for(var d=0;d<Math.min(e.length,this.SeriesDualYAxis.length);d++){this.SeriesDualYAxis[d]=e[d]}}this.yValues=new ArrayList(f);for(var d=0;d<f;d++){this.yValues.Add(new ArrayList())}this.series=f};GraphLibraryJQPlot.prototype.getNumSeries=function(){if(this.ColLabels==null){return 0}return this.ColLabels.length};GraphLibraryJQPlot.prototype.setSerieLabel=function(b,a){if((this.ColLabels==null)||(this.ColLabels.length<b)){return}this.ColLabels[b-1]=a};GraphLibraryJQPlot.prototype.getSerieLabel=function(a){if(a>this.ColLabels.length){return""}return this.ColLabels[a-1]};GraphLibraryJQPlot.prototype.setSerieType=function(b,a){if((this.SeriesTypes==null)||(this.SeriesTypes.length<b)){return}this.SeriesTypes[b-1]=a};GraphLibraryJQPlot.prototype.getSerieType=function(a){if(a>this.SeriesTypes.length){return -1}return this.SeriesTypes[a-1]};GraphLibraryJQPlot.prototype.setSerieDualYAxis=function(b,a){if(this.ColLabels==null||b<1||b>this.ColLabels.length){return}this.SeriesDualYAxis[b-1]=a;if(a){this.setDualYAxisVisible(true)}};GraphLibraryJQPlot.prototype.getSerieDualYAxis=function(a){if(a>this.ColLabels.length){return false}return this.SeriesDualYAxis[a-1]};GraphLibraryJQPlot.prototype.setSerieVisualStyle=function(b,a){this.seriesVisualStyle[b-1]=a};GraphLibraryJQPlot.prototype.getSerieVisualStyle=function(a){return this.seriesVisualStyle[a-1]};GraphLibraryJQPlot.prototype.setLegendVisible=function(a){this.LegendaVisibile=a};GraphLibraryJQPlot.prototype.getLegendVisible=function(){return this.LegendaVisibile};GraphLibraryJQPlot.prototype.setLegendPosition=function(a){this.posizioneLegenda=a};GraphLibraryJQPlot.prototype.getLegendPosition=function(){return this.posizioneLegenda};GraphLibraryJQPlot.prototype.setLabelOrientation=function(a){this.direzioneLabel=a};GraphLibraryJQPlot.prototype.getLabelOrientation=function(){return this.direzioneLabel};GraphLibraryJQPlot.prototype.setStackedChart=function(a){this.stackedCharts=a};GraphLibraryJQPlot.prototype.getStackedChart=function(){return this.stackedCharts};GraphLibraryJQPlot.prototype.setOutputFormat=function(a){};GraphLibraryJQPlot.prototype.getOutputFormat=function(){return -1};GraphLibraryJQPlot.prototype.setExplosion=function(a,b){};GraphLibraryJQPlot.prototype.getExplosion=function(a){return 0};GraphLibraryJQPlot.prototype.setBorderVisible=function(a){this.bordoVisibile=a};GraphLibraryJQPlot.prototype.getBorderVisible=function(){return this.bordoVisibile};GraphLibraryJQPlot.prototype.setAlpha=function(a){this.trasparenza=a};GraphLibraryJQPlot.prototype.getAlpha=function(){return this.trasparenza};GraphLibraryJQPlot.prototype.setUrlString=function(b,c,a){};GraphLibraryJQPlot.prototype.setHyperlink=function(a){this.hyperlink=a};GraphLibraryJQPlot.prototype.getHyperlink=function(){return this.hyperlink};GraphLibraryJQPlot.prototype.setTooltipsVisible=function(a){this.tooltips=a};GraphLibraryJQPlot.prototype.getTooltipsVisible=function(){return this.tooltips};GraphLibraryJQPlot.prototype.setShowPoints=function(a){this.visibilitaPunti=a};GraphLibraryJQPlot.prototype.getShowPoints=function(){return this.visibilitaPunti};GraphLibraryJQPlot.prototype.setOrientation=function(a){this.orientation=a};GraphLibraryJQPlot.prototype.getOrientation=function(){return this.orientation};GraphLibraryJQPlot.prototype.setPercentVisible=function(a){this.showPercentValues=a};GraphLibraryJQPlot.prototype.getPercentVisible=function(){return this.showPercentValues};GraphLibraryJQPlot.prototype.activateAutoRangeX=function(){return};GraphLibraryJQPlot.prototype.AutoRangeX=function(){return true};GraphLibraryJQPlot.prototype.activateAutoRangeY=function(){this.autoRangeY=true};GraphLibraryJQPlot.prototype.AutoRangeY=function(){return this.autoRangeY};GraphLibraryJQPlot.prototype.activateAutoRangeDualY=function(){this.dualAutoRangeY=true};GraphLibraryJQPlot.prototype.AutoRangeDualY=function(){return this.dualAutoRangeY};GraphLibraryJQPlot.prototype.setRangeX=function(a,b){return};GraphLibraryJQPlot.prototype.maxValueX=function(){return 0};GraphLibraryJQPlot.prototype.minValueX=function(){return 0};GraphLibraryJQPlot.prototype.setRangeY=function(a,b){this.autoRangeY=false;this.MinValueY=a;this.MaxValueY=b};GraphLibraryJQPlot.prototype.maxValueY=function(){return this.MaxValueY};GraphLibraryJQPlot.prototype.minValueY=function(){return this.MinValueY};GraphLibraryJQPlot.prototype.setRangeDualY=function(a,b){this.dualAutoRangeY=false;this.dualMinValueY=a;this.dualMaxValueY=b};GraphLibraryJQPlot.prototype.maxValueDualY=function(){return this.dualMaxValueY};GraphLibraryJQPlot.prototype.minValueDualY=function(){return this.dualMinValueY};GraphLibraryJQPlot.prototype.setShowValueLabel=function(a){this.mostraValori=a};GraphLibraryJQPlot.prototype.getShowValueLabel=function(){return this.mostraValori};GraphLibraryJQPlot.prototype.setXGridVisible=function(a){this.showXGrid=a};GraphLibraryJQPlot.prototype.getXGridVisible=function(){return this.showXGrid};GraphLibraryJQPlot.prototype.setYGridVisible=function(a){this.showYGrid=a};GraphLibraryJQPlot.prototype.getYGridVisible=function(){return this.showYGrid};GraphLibraryJQPlot.prototype.setTimePeriod=function(a){this.timePeriod=a};GraphLibraryJQPlot.prototype.getTimePeriod=function(){return this.timePeriod};GraphLibraryJQPlot.prototype.setVisualStylePieGraph=function(a){this.visualStylePieGraph=a};GraphLibraryJQPlot.prototype.getVisualStylePieGraph=function(){return this.visualStylePieGraph};GraphLibraryJQPlot.prototype.getChartObject=function(){return null};GraphLibraryJQPlot.prototype.getImageMap=function(a){return""};GraphLibraryJQPlot.prototype.setMainFrm=function(a){this.w=a};GraphLibraryJQPlot.prototype.getMainFrm=function(){return this.w};GraphLibraryJQPlot.prototype.UpdateGraphRS=function(h,g){this.xValues.Clear();for(var k=0;k<this.yValues.Count();k++){this.yValues[k].Clear()}if(h.GetNumFields()<(this.series+1)){return AGraphSrv.DATAERROR}if(this.tipoGrafico==AGraphSrv.PIE3DCHART||this.tipoGrafico==AGraphSrv.PIECHART||this.tipoGrafico==AGraphSrv.RINGCHART){h.MoveFirst();while(!h.EOF()){this.xValues.Add(h.Get(1));this.yValues[0].Add(h.Get(2));h.MoveNext()}return AGraphSrv.OK}if(this.tipoGrafico==AGraphSrv.SCATTERCHART||this.tipoGrafico==AGraphSrv.XYLINECHART){var j=new Array(series);var d=new ArrayList();for(var e=1;e<=this.series;e++){j[e-1]=new HashTableSrv();h.MoveFirst();while(!h.EOF()){var b=h.Get((e*2)-1).dblValue();if(!d.Contains(b)){d.Add(b)}j[e-1].add(b,h.Get(e*2));h.MoveNext()}}d.Sort();for(var c=0;c<d.Count();c++){var f=d[c];this.xValues.Add(new IDVariant(f));for(var e=0;e<this.series;e++){var a=f;if(j[e].ContainsKey(a)){this.yValues[e].Add(j[e][a])}else{this.yValues[e].Add(new IDVariant())}}}}else{for(var e=1;e<=this.series;e++){h.MoveFirst();while(!h.EOF()){if(e==1){this.xValues.Add(h.Get(1))}this.yValues[e-1].Add(h.Get(e+1));h.MoveNext()}}}return AGraphSrv.OK};GraphLibraryJQPlot.prototype.UpdateGrahpIMDB=function(f,e,h){this.xValues.Clear();for(var k=0;k<this.yValues.Count();k++){this.yValues[k].Clear()}if(f.TblNumField(e)<(this.series+1)){return AGraphSrv.DATAERROR}if((this.tipoGrafico==AGraphSrv.PIE3DCHART)||(this.tipoGrafico==AGraphSrv.PIECHART)||(this.tipoGrafico==AGraphSrv.RINGCHART)){f.TblMoveFirst(e,0);while(!f.Eof(e,0)){this.xValues.Add(f.Value(e,0,0));this.yValues[0].Add(f.Value(e,1,0));f.TblMoveNext(e,0)}return AGraphSrv.OK}if((this.tipoGrafico==AGraphSrv.SCATTERCHART)||(this.tipoGrafico==AGraphSrv.XYLINECHART)){var j=new HashTableSrv();var c=new ArrayList();for(var d=1;d<=this.series;d++){j.add(d-1,new HashTableSrv());f.TblMoveFirst(e,0);while(!f.Eof(e,0)){var a=f.Value(e,(d*2)-2,0).dblValue();if(!c.Contains(a)){c.Add(a)}j[d-1].add(a,f.Value(e,(d*2)-1,0));f.TblMoveNext(e,0)}}c.Sort();for(var b=0;b<c.Count();b++){var g=c[b];this.xValues.Add(new IDVariant(g));for(var d=1;d<=this.series;d++){if(j[d-1].containsKey(g)){this.yValues[d-1].Add(j[d-1][g])}else{this.yValues[d-1].Add(new IDVariant())}}}}else{for(var d=1;d<=this.series;d++){f.TblMoveFirst(e,0);while(!f.Eof(e,0)){if(d==1){this.xValues.Add(f.Value(e,0,0))}this.yValues[d-1].Add(f.Value(e,d,0));f.TblMoveNext(e,0)}}}return AGraphSrv.OK};GraphLibraryJQPlot.prototype.drawGraph=function(d,e,a,f,c){if(d instanceof IDCachedRowSet){var b=d;c=f;f=a;a=e;this.width=a;this.heigth=f;this.UpdateGraphRS(b,this.ColLabels)}else{this.width=a;this.heigth=f;this.UpdateGrahpIMDB(d,e,this.ColLabels)}this.setGraphFile(this.CreateJS());return AGraphSrv.OK};GraphLibraryJQPlot.prototype.CreateJS=function(){var q="";q+="[";for(var v=0;v<this.series;v++){q+=(v!=0?",":"");q+="[";var s=0;for(var o=0;o<this.yValues[v].length;o++){var g=this.yValues[v][o];if(g.Type==IDVariant.NULL&&(this.tipoGrafico==AGraphSrv.XYLINECHART||this.tipoGrafico==AGraphSrv.SCATTERCHART)){continue}var t=g.stringValue();if(!IDL.IsNumber(g)){t="'"+t+"'"}if(g.Type==IDVariant.NULL){t="null"}q+=(s!=0?",":"");switch(this.tipoGrafico){case AGraphSrv.XYLINECHART:case AGraphSrv.SCATTERCHART:q+=("["+this.ReplaceSpecialChars(this.xValues[s]).stringValue()+","+t+"]");break;case AGraphSrv.TIMELINECHART:case AGraphSrv.TIMEBARCHART:var x=new IDVariant(this.xValues[s]);var u=new IDVariant("mm/dd/yyyy");switch(this.timePeriod){case AGraphSrv.YEAR:u=new IDVariant("yyyy");break;case AGraphSrv.MONTH:u=new IDVariant("mm/yyyy");break}x=IDL.Format(x,u,null);q+=("['"+this.ReplaceSpecialChars(x).stringValue()+"',"+t+"]");break;case AGraphSrv.PIECHART:case AGraphSrv.PIE3DCHART:case AGraphSrv.RINGCHART:q+=("['"+this.ReplaceSpecialChars(this.xValues[s]).stringValue()+"',"+t+"]");break;default:q+=t;break}s++}q+="]"}q+="]";q+=", {";q+=("stackSeries: "+(this.stackedCharts?"true":"false")+", ");q+="title: {";q+="text: '"+this.ReplaceSpecialChars(this.titolo).stringValue()+"',";q+="show: "+(this.titolo==""?"false":"true");if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var e=AGraphSrv.getFont(w.Font(Glb.VISFNT_HEAD));q+=(",fontFamily: '"+e.FontFamily+"',");q+=("fontSize: '"+e.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(w.Color(Glb.VISCLR_FOREHEAD))+"'");var r="left";var f=w.Alignment(Glb.VISALI_HDRLIST);if(f==Glb.VISALN_CX){r="center"}if(f==Glb.VISALN_DX){r="right"}q+=", textAlign: '"+r+"'"}else{q+=",fontFamily: 'Tahoma'";q+=",fontSize: '8pt'"}q+="},";q+="axes: {";q+=(this.orientation==AGraphSrv.VERTICAL?"xaxis:":"yaxis:")+" {";q+="show: "+(!this.asseXVisibile?"false":"true")+",";q+="label: '"+this.ReplaceSpecialChars(this.asseXLabel).stringValue()+"',";q+="showLabel: true";if(this.tipoGrafico==AGraphSrv.BAR3DCHART||this.tipoGrafico==AGraphSrv.BARCHART||this.tipoGrafico==AGraphSrv.AREACHART||this.tipoGrafico==AGraphSrv.LINECHART){q+=",ticks: [";for(var v=0;v<this.xValues.Count();v++){q+=(v!=0?",":"");q+=("'"+this.ReplaceSpecialChars(this.xValues[v]).stringValue()+"'")}q+="]";q+=", renderer: $.jqplot.CategoryAxisRenderer"}else{if(this.tipoGrafico==AGraphSrv.TIMEBARCHART||this.tipoGrafico==AGraphSrv.TIMELINECHART){q+=", renderer: $.jqplot.DateAxisRenderer"}}if(this.direzioneLabel!=0){q+=",tickRenderer: $.jqplot.CanvasAxisTickRenderer"}else{q+=",tickRenderer: $.jqplot.AxisTickRenderer"}q+=",tickOptions : {";q+="angle: "+this.direzioneLabel;if(this.tipoGrafico==AGraphSrv.TIMEBARCHART||this.tipoGrafico==AGraphSrv.TIMELINECHART){var p="%d/%m/%Y";switch(this.timePeriod){case AGraphSrv.YEAR:p="%Y";break;case AGraphSrv.MONTH:p="%m/%Y";break}q+=",formatString:'"+p+"'"}if(this.visualStyleAsseX!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseX);var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(w.Font(j));q+=(",fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(w.Color(d))+"'");q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(w.Font(j));q+=",labelOptions : {";q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(w.Color(d))+"'");q+="}"}else{q+=",fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}q+="},";q+=(this.orientation==AGraphSrv.VERTICAL?"yaxis:":"xaxis:")+" {";q+=("show: "+(!this.asseYVisibile?"false":"true")+",");q+=("label: '"+this.ReplaceSpecialChars(this.asseYLabel).stringValue()+"',");q+="showLabel: true,";q+="labelRenderer: $.jqplot.CanvasAxisLabelRenderer";if(this.visualStyleAsseY!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseY);q+=", tickOptions : {";var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(w.Font(j));q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(w.Color(d))+"'");q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(w.Font(j));q+=",labelOptions : {";q+=("fontFamily: '"+c.FontFamily+"',");q+=("fontSize: '"+c.Size+"pt' ,");q+=("textColor: '"+Glb.GetWebColor(w.Color(d))+"'");q+="}"}else{q+=", tickOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}if(!this.autoRangeY){q+=", min: '"+this.MinValueY+"',";q+="max: '"+this.MaxValueY+"',";q+="autoscale: false"}q+="}";this.dualYAxis=false;for(var h=0;h<this.SeriesDualYAxis.length;h++){this.dualYAxis|=this.SeriesDualYAxis[h]}if(this.dualYAxis&&this.dualAsseYVisibile){q+=",y2axis: {";q+="show: "+(!this.dualAsseYVisibile?"false":"true")+",";q+="label: '"+this.dualAsseYLabel+"',";q+="showLabel: true,";q+="labelRenderer: $.jqplot.CanvasAxisLabelRenderer";if(this.visualStyleAsseYDuale!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleAsseYDuale);q+=", tickOptions : {";var j=Glb.VISFNT_VALUE;var d=Glb.VISCLR_FOREVALUE;var c=AGraphSrv.getFont(w.Font(j));q+="fontFamily: '"+c.FontFamily+"',";q+="fontSize: '"+c.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(w.Color(d))+"'";q+="}";j=Glb.VISFNT_NOTNULL;d=Glb.VISCLR_FOREHEADNN;c=AGraphSrv.getFont(w.Font(j));q+=",labelOptions : {";q+="fontFamily: '"+c.FontFamily+"',";q+="fontSize: '"+c.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(w.Color(d))+"'";q+="}"}else{q+=", tickOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}";q+=",labelOptions : {";q+="fontFamily: 'Tahoma'";q+=",fontSize: '8pt'";q+="}"}q+="}"}q+="},";q+="grid: {";q+="drawGridlines : "+(!this.showYGrid?"false":"true");if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);q+=", gridLineColor : '"+Glb.GetWebColor(w.CBorColor(Glb.VISCBOR_TOP))+"',";var b=Math.floor(((w.CBorWidth(Glb.VISCBOR_TOP)/4)/72)*96);if(b>5){b=5}q+="gridLineWidth: "+b+",";q+="background : '"+Glb.GetWebColor(w.Color(Glb.VISCLR_BACKPANEL))+"',";q+="drawBorder : "+(w.BorderType(Glb.VISBDI_VALUE)==Glb.VISBRD_NONE?"false":"true")+",";q+="borderColor : '"+Glb.GetWebColor(w.Color(Glb.VISCLR_BORDERS))+"'"}q+="},";if(this.LegendaVisibile){q+="legend: {";q+="show  : "+(!this.LegendaVisibile?"false":"true")+",";var l="s";switch(this.posizioneLegenda){case AGraphSrv.TOP:l="n";break;case AGraphSrv.LEFT:l="w";break;case AGraphSrv.RIGTH:l="e";break}q+="placement: 'outsideGrid',";q+="location :'"+l+"'";if(this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.PIE3DCHART&&this.tipoGrafico!=AGraphSrv.RINGCHART){q+=",renderer: $.jqplot.EnhancedLegendRenderer";if(this.posizioneLegenda==AGraphSrv.BOTTOM||this.posizioneLegenda==AGraphSrv.TOP){q+=",rendererOptions: {numberRows:1}"}}if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);var k=AGraphSrv.getFont(w.Font(Glb.VISFNT_GROUP));q+=", fontFamily: '"+k.FontFamily+"',";q+="fontSize: '"+k.Size+"pt' ,";q+="textColor: '"+Glb.GetWebColor(w.Color(Glb.VISCLR_FOREGROUP))+"', ";q+="background: '"+Glb.GetWebColor(w.Color(Glb.VISCLR_BACKGROUP))+"'"}q+="},"}if(this.tooltips&&this.tipoGrafico!=AGraphSrv.PIECHART&&this.tipoGrafico!=AGraphSrv.RINGCHART&&this.tipoGrafico!=AGraphSrv.PIE3DCHART&&this.tipoGrafico!=AGraphSrv.AREACHART){q+="highlighter: {";q+="show  : true";q+="},"}q+="seriesDefaults: {";if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);q+="pointLabels: { show: "+(((w.Flags()&Glb.FL_VIS_SHOWVALUE)>0)?"true":"false")+", location:'n'}"}q+="},";q+="series:[";for(var v=0;v<this.series;v++){var a=this.tipoGrafico;if(this.SeriesTypes[v]!=-1){this.tipoSerie=this.SeriesTypes[v]}q+=(v!=0?",":"");q+="{";q+="show : true,";q+="xaxis : 'xaxis',";q+=("yaxis : '"+(this.SeriesDualYAxis[v]?"y2axis":"yaxis")+"',");q+="label : '"+this.ReplaceSpecialChars(this.ColLabels[v]).stringValue()+"'";var m=null;if(this.seriesVisualStyle[v]!=-1){m=this.w.VisualStyleList.VisualAttribute(this.seriesVisualStyle[v]);q+=",color :'"+Glb.GetWebColor(m.Color(Glb.VISCLR_BACKVALUE))+"'"}switch(a){case AGraphSrv.AREACHART:q+=",fill: true";if(!this.stackedCharts){q+=",fillAlpha:0.7, shadow:false"}break;case AGraphSrv.BAR3DCHART:case AGraphSrv.TIMEBARCHART:case AGraphSrv.BARCHART:q+=",renderer : $.jqplot.BarRenderer,";q+="rendererOptions : {";q+="barDirection: '"+(this.orientation==AGraphSrv.VERTICAL?"vertical":"horizontal")+"'";q+="}";break;case AGraphSrv.TIMELINECHART:case AGraphSrv.XYLINECHART:case AGraphSrv.LINECHART:break;case AGraphSrv.PIE3DCHART:case AGraphSrv.PIECHART:q+=",renderer : $.jqplot.PieRenderer,";q+="rendererOptions : {";q+="fill: true,";q+="dataLabels: '"+(this.showPercentValues?"percent":"value")+"'";if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);if((w.Flags()&Glb.FL_VIS_SHOWVALUE)>0){q+=",showDataLabels: true"}}q+="}";break;case AGraphSrv.RINGCHART:q+=",renderer : $.jqplot.DonutRenderer,";q+="rendererOptions : {";q+="fill: true,";q+="dataLabels: '"+(this.showPercentValues?"percent":"value")+"'";if(this.visualStyleGrafico!=-1){var w=this.w.VisualStyleList.VisualAttribute(this.visualStyleGrafico);if((w.Flags()&Glb.FL_VIS_SHOWVALUE)>0){q+=",showDataLabels: true"}}q+="}";break}q+="}"}q+="]";q+="}";return q};GraphLibraryJQPlot.prototype.ReplaceSpecialChars=function(b){if(typeof b=="string"){b=new IDVariant(b)}var a=IDL.Replace(b,new IDVariant("'"),new IDVariant("&#39;"));return a};AIndicatorSrv.STYLE_TIME=6;AIndicatorSrv.STYLE_DATE=7;function AIndicatorSrv(){this.iGuid;this.IdxForm=0;this.Index;this.Width=0;this.Alignment;this.ToolTip;this.Style;this.Code;this.iAllowPWA;this.iEnabled=new Array(1);this.iVisible=new Array(1);this.iText=new Array(1);this.iImage=new Array(1);this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.IND_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_ACTIVE}AIndicatorSrv.prototype.bEnabled=function(a){return this.iEnabled[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bEnabled=function(c,a){this.iEnabled[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_ENABLED)};AIndicatorSrv.prototype.bVisible=function(a){if(this.iAllowPWA){return this.iVisible[a]}else{if(this.IdxForm!=a&&this.IdxForm>0){return false}else{return this.iVisible[0]}}};AIndicatorSrv.prototype.set_bVisible=function(c,a){this.iVisible[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_VISIBLE)};AIndicatorSrv.prototype.bText=function(a){return this.iText[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bText=function(c,a){this.iText[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_TEXT)};AIndicatorSrv.prototype.bImage=function(a){return this.iImage[(this.iAllowPWA)?a:0]};AIndicatorSrv.prototype.set_bImage=function(c,a){this.iImage[(this.iAllowPWA)?c:0]=a;this.RD3Change(RD3Glb.IND_IMAGE)};AIndicatorSrv.prototype.set_AllowPWA=function(c,a){this.iAllowPWA=a;if(a){this.iEnabled=new Array(c.ParamsObj().MAX_FORMS+1);this.iVisible=new Array(c.ParamsObj().MAX_FORMS+1);this.iText=new Array(c.ParamsObj().MAX_FORMS+1);this.iImage=new Array(c.ParamsObj().MAX_FORMS+1)}};AIndicatorSrv.prototype.InitStatus=function(d,a,c){if(this.IdxForm==0){for(var b=0;b<this.iEnabled.length;b++){this.iEnabled[b]=d;this.iVisible[b]=a;this.iImage[b]=c;this.iText[b]=""}}else{if(this.iAllowPWA){this.iVisible[this.IdxForm]=a;this.iEnabled[this.IdxForm]=d;this.iImage[this.IdxForm]=c;this.iText[this.IdxForm]=""}else{this.iVisible[0]=a;this.iEnabled[0]=d;this.iImage[0]=c;this.iText[0]=""}}};AIndicatorSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};AIndicatorSrv.prototype.GetRD3Name=function(){return"ind"};AIndicatorSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AIndicatorSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){d.SetAttribute("clk",this.ClickEventDef.toString())}}return c};AIndicatorSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.IND_IDXFORM:if(this.IdxForm==0&&b){break}c.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.IND_WIDTH:if(this.Width==0&&b){break}c.SetAttribute("wid",this.Width.toString());break;case RD3Glb.IND_ALIGN:if(this.Alignment==Glb.VISALN_SX&&b){break}c.SetAttribute("ali",this.Alignment.toString());break;case RD3Glb.IND_TOOLTIP:if((this.ToolTip==null||this.ToolTip.equals(""))&&b){break}c.SetAttribute("tip",this.ToolTip);break;case RD3Glb.IND_STYLE:if(this.Style==-1&&b){break}c.SetAttribute("sty",this.Style.toString());break;case RD3Glb.IND_ENABLED:if(this.bEnabled(0)&&b){break}c.SetAttribute("ena",this.bEnabled(0)?"1":"0");break;case RD3Glb.IND_VISIBLE:if(this.bVisible(0)&&b){break}c.SetAttribute("vis",this.bVisible(0)?"1":"0");break;case RD3Glb.IND_TEXT:if((this.bText(0)==null||this.bText(0)=="")&&b){break}c.SetAttribute("cap",this.bText(0));break;case RD3Glb.IND_IMAGE:if((this.bImage(0)==null||this.bImage(0)=="")&&b){break}c.SetAttribute("img",this.bImage(0));break}};AMessageSrv.MSG_INFO=1;AMessageSrv.MSG_WARN=2;AMessageSrv.MSG_STOP=3;function AMessageSrv(){this.Source=null;this.SrcErr=null;this.Code="";this.Text="";this.Icon="";this.NumRow=0;this.Type=0;this.RIndex=Math.random();this.Parent=null;this.Activable=false;this.AutoDelete=true;this.RD3Rendered=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.MSG_MAXPROPS)}AMessageSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.RIndex};AMessageSrv.prototype.GetRD3Name=function(){return"msg"};AMessageSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};AMessageSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||c){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){}this.RD3Rendered=true;return c};AMessageSrv.prototype.SetRD3Property=function(b,d,c){switch(b){case RD3Glb.MSG_CODE:if(this.Code.length==0&&c){break}d.SetAttribute("cod",this.Code);break;case RD3Glb.MSG_TEXT:if(this.Text.length==0){d.SetAttribute("txt","")}else{var a="<b>"+(this.Source.ToString?this.Source.ToString():Source);if(this.NumRow>0){a+=" [";a+=IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1")),new IDVariant(this.NumRow)).stringValue();a+="]"}a+=":</b> ";a+=this.Text;d.SetAttribute("txt",a)}break;case RD3Glb.MSG_ICON:if(this.Icon.length==0&&c){break}d.SetAttribute("img",this.Icon);break;case RD3Glb.MSG_TYPE:if(this.Type==3&&c){break}d.SetAttribute("typ",this.Type.toString());break;case RD3Glb.MSG_TEMPORARY:if(this.AutoDelete&&c){break}d.SetAttribute("tem",this.AutoDelete?"1":"0");break}};function RoleItemsSrv(){this.iForm;this.PObj;this.RObj;this.Type;this.Flags;this.oGuid="";this.fGuid=""}function ARoleSrv(){this.Items=new Array();this.Parent;this.Code;this.iGuid}ARoleSrv.prototype.SetItemCount=function(b){if(b>0){this.Items=new Array(b+1);for(var a=1;a<this.Items.length;a++){this.Items[a]=new RoleItemsSrv()}}};ARoleSrv.prototype.SetItem=function(g,d,e,b,a,c){this.Items[g].PObj=e;this.Items[g].iForm=d;this.Items[g].RObj=b;this.Items[g].Type=a;this.Items[g].Flags=c};ARoleSrv.prototype.Apply=function(d,c,h){var l=new ArrayList();var k=(d==0?"MainFrm":c.Caption().ToString());h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",117,"ARole.Apply","Applying role "+this.Code.ToString()+" to form "+k);for(var f=0;f<this.Items.length;f++){if(this.Items[f]==null){continue}if(d>0&&this.Items[f].fGuid.length>0){if(c.RTCGuid.equals(this.Items[f].fGuid)){this.Items[f].iForm=c.FormIdx;this.Items[f].fGuid=""}}if(d>65535){d=d%65536}if(this.Items[f].iForm==d){switch(this.Items[f].Type){case Glb.ROI_COMMAND:if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<h.CmdObj.CmdLin.length;e++){if(this.Items[f].oGuid.equals(h.CmdObj.CmdLin[e].iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Command "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Command "+h.CmdObj.CmdLin[this.Items[f].RObj].Caption,this.DecodeFlags(this.Items[f].Flags,false));h.CmdObj.CommandApplyRole(this.Items[f].RObj,(this.Items[f].Flags&Glb.OBJ_ENABLED)!=0,(this.Items[f].Flags&Glb.OBJ_VISIBLE)!=0)}break;case Glb.ROI_CMDSET:if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<h.CmdObj.CmdSets.length;e++){if(this.Items[f].oGuid.equals(h.CmdObj.CmdSets[e].iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Command Set "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Command set "+h.CmdObj.CmdSets[this.Items[f].RObj].Caption,this.DecodeFlags(this.Items[f].Flags,false));h.CmdObj.CmdSetApplyRole(this.Items[f].RObj,(this.Items[f].Flags&Glb.OBJ_ENABLED)!=0,(this.Items[f].Flags&Glb.OBJ_VISIBLE)!=0)}break;case Glb.ROI_PFIELD:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UFields();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_FIELD,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Field "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel field "+a.bFields(this.Items[f].RObj).GetDTTCaption(),this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_FIELD,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PPAGE:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UPages();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_PAGE,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Page "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel page "+a.bPages(this.Items[f].RObj).Header,this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_PAGE,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PGROUP:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=0;e<a.UGroups();e++){if(this.Items[f].oGuid.equals(a.GetRTCGuid(Glb.OBJ_GROUP,e))){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Panel Group "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel group "+a.bGroups(this.Items[f].RObj).Header,this.DecodeFlags(this.Items[f].Flags,false));a.SetRoleFlags(Glb.OBJ_GROUP,this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_PANEL:var a=this.SearchObject(this.Items[f].PObj,c);if(a!=null){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Panel "+a.GetDTTCaption(),this.DecodeFlags(this.Items[f].Flags,true));a.SetRoleFlags(Glb.OBJ_PANEL,0,this.Items[f].Flags,Glb.PAN_CANSELECT|Glb.PAN_CANUPDATE|Glb.PAN_CANDELETE|Glb.PAN_CANINSERT|Glb.OBJ_VISIBLE)}else{l.Add("Panel "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_TREEITEM:var o=this.SearchObject(this.Items[f].PObj,c);if(o!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<o.ItemList.length;e++){if(this.Items[f].oGuid.equals(o.GetItem(e).iGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Tree Item "+this.Items[f].oGuid+" not found")}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){h.DTTObj.AddParameter("",this.Items[f].fGuid,"Tree item "+o.GetItem(this.Items[f].RObj).Name,this.DecodeFlags(this.Items[f].Flags,false));o.SetRoleFlags(this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Tree "+this.Items[f].PObj+" not found in the form "+k)}break;case Glb.ROI_QRYWL:h.QwlRoles[this.Items[f].PObj]=this.Items[f].iForm;break;case Glb.ROI_REPORT:case Glb.ROI_SECTION:case Glb.ROI_RPTBOX:case Glb.ROI_RPTSPAN:var m=c.SearchBook(this.Items[f].PObj);if(m!=null){if(this.Items[f].oGuid.length>0){this.Items[f].RObj=-1;for(var e=1;e<=m.GetNumObjects();e++){if(m.GetRTCGuid(e).equals(this.Items[f].oGuid)){this.Items[f].RObj=e;break}}if(this.Items[f].RObj==-1){l.Add("Object "+this.Items[f].oGuid+" not found in book "+m.GetName())}this.Items[f].oGuid=""}if(this.Items[f].RObj!=-1){switch(this.Items[f].Type){case Glb.ROI_REPORT:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book report "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_SECTION:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book section "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_RPTBOX:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book box "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break;case Glb.ROI_RPTSPAN:h.DTTObj.AddParameter("",this.Items[f].fGuid,"Book span "+m.GetName()+"."+this.Items[f].RObj,this.DecodeFlags(this.Items[f].Flags,false));break}m.SetRoleFlags(this.Items[f].RObj,this.Items[f].Flags,Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE)}}else{l.Add("Book "+this.Items[f].PObj+" not found in the form "+k)}break}}}if(l.Count>0){for(f=0;f<l.Count();f++){var g=l[f];h.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",118,"ARole.Apply","Role "+this.Code.ToString()+": "+g)}}};ARoleSrv.prototype.SearchObject=function(e,d){for(var a=1;a<d.Frames.length;a++){var b=d.Frames[a];if(b.Content!=null){var c=b.Content.SearchObject(e);if(c!=null){return c}}}return null};ARoleSrv.prototype.AddRTCItem=function(f,h,e,c,g){var b=new Array(this.Items.length+1);for(var a=0;a<this.Items.length;a++){b[a]=this.Items[a]}this.Items=b;var d=new RoleItemsSrv();this.Items[this.Items.length-1]=d;d.fGuid=h;d.oGuid=f;d.Type=c;d.Flags=g;d.PObj=e;if(d.fGuid.length>0){d.iForm=-1}if(d.Type==Glb.ROI_QRYWL){d.iForm=0;d.PObj=d.oGuid}};ARoleSrv.prototype.DecodeFlags=function(c,a){var b="";if(!a){if((c&Glb.OBJ_ENABLED)>0){b="Enabled "}else{b="Disabled "}if((c&Glb.OBJ_VISIBLE)>0){b+="Visible"}else{b+="Hidden"}}else{if((c&Glb.PAN_CANSELECT)>0){b+="CanSelect "}if((c&Glb.PAN_CANUPDATE)>0){b+="CanUpdate "}if((c&Glb.PAN_CANDELETE)>0){b+="CanDelete "}if((c&Glb.PAN_CANINSERT)>0){b+="CanInsert "}b+=((c&Glb.OBJ_VISIBLE)>0?"Visible":"Hidden")}return new IDVariant(b)};function ASubFormSrv(a){WebFrameSrv.call(this,a);this.pSubForm=null;this.SubFormChanged=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.SUF_MAXPROPS)}ASubFormSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];ASubFormSrv[obj]=WebFrameSrv[obj]}ASubFormSrv.prototype.Init=function(a,b){this.pSubForm=a;this.pSubForm.ParentSuf=this;if(this.pSubForm.Frames==null){this.pSubForm.SetSubMainFrm(b,b.IMDB)}};ASubFormSrv.prototype.set_Flags=function(a){};ASubFormSrv.prototype.set_Height=function(a){if(this.Height!=a){this.RD3Change(RD3Glb.SUF_HEIGHT);WebFrameSrv.prototype.set_Height.call(this,a);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}}};ASubFormSrv.prototype.set_Width=function(a){if(this.Width!=a){this.RD3Change(RD3Glb.SUF_WIDTH);WebFrameSrv.prototype.set_Width.call(this,a);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}}};ASubFormSrv.prototype.SendMessage=function(f,e,d,c,b,h,g){if(d==undefined){d=null}if(c==undefined){c=new IDVariant()}if(b==undefined){b=new IDVariant()}if(h==undefined){h=new IDVariant()}if(g==undefined){g=new IDVariant()}var a=null;if(e!=null&&e instanceof WebFormSrv){a=e}if(this.pSubForm!=null){this.pSubForm.OnSendMessage(f,a,d,c,b,h,g)}};ASubFormSrv.prototype.GetIntForm=function(){return this.pSubForm};ASubFormSrv.prototype.SetIntForm=function(a){if(a!=this.pSubForm){if(a!=null){this.Init(a,a.MainFrm)}else{this.pSubForm=null}this.SubFormChanged=true}};ASubFormSrv.prototype.GetRD3Name=function(){return"suf"};ASubFormSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ASubFormSrv.prototype.RD3RenderDifferences=function(g,d,f){var e=false;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,g,d,f);if(g==null){g=a}e|=(a!=null);if(g==null&&(this.RD3Changed||this.SubFormChanged)){g=d.AddNewElement("chg");g.SetAttribute("id",this.GetRD3Ident());a=g}if(f||this.RD3Changed){for(var c=0;c<this.RD3PropChg.length;c++){if(this.RD3PropChg[c]||f){this.SetRD3Property(c,g,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(this.SubFormChanged){f=true;this.SubFormChanged=false;g.SetAttribute("csf",(this.pSubForm!=null?"1":"0"));e=true}if(this.pSubForm!=null){var b=(f?g:d);e|=this.pSubForm.RD3RenderDifferences(b,f)}return e?a:null};ASubFormSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.SUF_HEIGHT:c.SetAttribute("suh",this.Height.toString());break;case RD3Glb.SUF_WIDTH:c.SetAttribute("suw",this.Width.toString());break}};ASubFormSrv.prototype.RD3Resize=function(a,c,b){this.Height=c;this.Width=a;this.RD3Change(RD3Glb.SUF_HEIGHT);this.RD3Change(RD3Glb.SUF_WIDTH);WebFrameSrv.prototype.RD3Resize.call(this,a,c,b);if(this.pSubForm!=null){this.pSubForm.Resize(this.Width,this.Height)}};ASubFormSrv.prototype.RD3EndRequest=function(){if(this.pSubForm!=null){var b=this.Parent;while(b!=null&&b.ParentSuf!=null&&b.ParentSuf.Parent!=null){b=b.ParentSuf.Parent}for(var a=0;a<this.pSubForm.Frames.length;a++){if(this.pSubForm.Frames[a]!=null&&this.pSubForm.Frames[a].Content!=null){if(b==this.MainFrm.ActiveForm()&&this.pSubForm.Frames[a].Content instanceof IDPanelSrv){this.pSubForm.Frames[a].Content.RD3Validate=true}this.pSubForm.Frames[a].Content.RD3EndRequest()}}}};function ATimerSrv(){this.IdxForm=0;this.Index;this.Code;this.iGuid;this.NumTicks;this.AttTicks;this.Interval;this.MilliSec=0;this.LastMilliSec;this.LastTick;this.NextTick;this.InitialEnabled=false;this.ServerSession=false;this.iEnabled=false;this.iPermanent=false;this.iActive=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TIM_MAXPROP);this.TickEventDef=RD3Glb.EVENT_ACTIVE}ATimerSrv.prototype.Active=function(){return this.iActive};ATimerSrv.prototype.set_Active=function(a){if(this.iActive!=a){this.RD3Change(RD3Glb.TIM_ENABLED)}this.iActive=a;if(a&&this.InitialEnabled){this.set_bEnabled(true)}};ATimerSrv.prototype.bEnabled=function(){return this.iEnabled&&this.Active()};ATimerSrv.prototype.set_bEnabled=function(a){if(this.iEnabled!=a){this.RD3Change(RD3Glb.TIM_ENABLED)}this.iEnabled=a;if(this.iEnabled&&this.AttTicks==0&&this.NumTicks>0){this.AttTicks=this.NumTicks}if(this.iEnabled&&!this.iPermanent){this.LastMilliSec=(new Date()).getTime();this.LastTick=this.LastMilliSec;this.NextTick=this.LastMilliSec+1000*this.Interval}};ATimerSrv.prototype.bPermanent=function(){return this.iPermanent};ATimerSrv.prototype.set_bPermanent=function(a){this.iPermanent=a};ATimerSrv.prototype.Tick=function(b){var a;var c=false;var e=null;if(!this.iActive||!this.iEnabled){return}if(this.Interval==0){a=(new Date()).getTime();if(a-this.LastMilliSec>this.MilliSec){this.LastMilliSec=a;c=true;if(this.IdxForm>0){e=b.GetForm(this.IdxForm,0,false)}b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,34,"ATimer.Tick","Timer "+this.Code+" expired");if(e==null){b.TimerTickCB(this.Index)}else{e.TimerTickCB(this.Index)}}}else{var d=(new Date()).getTime();if(d>this.NextTick){this.LastTick=d;if(this.NextTick==0){this.NextTick=d}while(this.NextTick<=d){this.NextTick+=1000*this.Interval}c=true;if(this.IdxForm>0){e=b.GetForm(this.IdxForm,0,false)}if(e==null){b.TimerTickCB(this.Index)}else{e.TimerTickCB(this.Index)}}}if(c){this.AttTicks--;if(this.AttTicks==0){this.set_bEnabled(false)}}};ATimerSrv.prototype.CopyFrom=function(a){this.IdxForm=a.IdxForm;this.Index=a.Index;this.Code=a.Code;this.iGuid=a.iGuid;this.NumTicks=a.NumTicks;this.AttTicks=a.AttTicks;this.Interval=a.Interval;this.MilliSec=a.MilliSec;this.LastMilliSec=a.LastMilliSec;this.LastTick=a.LastTick;this.NextTick=a.NextTick;this.InitialEnabled=a.InitialEnabled;this.ServerSession=a.ServerSession;this.iEnabled=a.iEnabled;this.iPermanent=a.iPermanent;this.iActive=a.iActive};ATimerSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ATimerSrv.prototype.GetRD3Name=function(){return"tim"};ATimerSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATimerSrv.prototype.RD3Tick=function(a){var b=null;if(!this.iActive||!this.iEnabled){return}if(this.IdxForm>0){b=a.GetFormByIndex(this.IdxForm,a.GetLiveForms())}if(b==null){a.TimerTickCB(this.Index)}else{b.TimerTickCB(this.Index)}};ATimerSrv.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.TickEventDef!=RD3Glb.EVENT_ACTIVE){d.SetAttribute("tke",this.TickEventDef.toString())}}return c};ATimerSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TIM_IDXFORM:if(this.IdxForm==0&&b){break}c.SetAttribute("frm",this.IdxForm.toString());break;case RD3Glb.TIM_NUMTICKS:if(this.NumTicks==0&&b){break}c.SetAttribute("num",this.NumTicks.toString());break;case RD3Glb.TIM_INTERVAL:if(this.MilliSec==0){c.SetAttribute("int",(this.Interval*1000).toString())}else{c.SetAttribute("int",this.MilliSec.toString())}break;case RD3Glb.TIM_ENABLED:if(!this.bEnabled()&&b){break}c.SetAttribute("ena",this.bEnabled()?"1":"0");break}};function ATreeItemSrv(){this.ItemList=new Array(0);this.QueryObj;this.QueryList=new HashTableSrv();this.iCN;this.iSQL;this.iIMDBTable=-1;this.iSeq=0;this.Parent;this.Derived;this.Tooltip="";this.Name="";this.HasTooltip;this.Image="";this.ItemIndex;this.RoleFlags=-1;this.iGuid;this.iQueryGuid;this.TreeObj;this.PKColumns=new ArrayList();this.HashKey=""}ATreeItemSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATreeItemSrv()}};ATreeItemSrv.prototype.SetItem=function(b,a){this.ItemList[b]=a};ATreeItemSrv.prototype.SetQuery=function(d,a,b,c){this.iSQL=d;this.iCN=a;this.iQueryGuid=c};ATreeItemSrv.prototype.AddPK=function(a){this.PKColumns.Add(a)};ATreeItemSrv.prototype.SetIMDBTable=function(a){this.iIMDBTable=a};ATreeItemSrv.prototype.HasQuery=function(){return this.iIMDBTable!=-1};ATreeItemSrv.prototype.UpdateItem=function(g,h,e){if((this.RoleFlags&Glb.OBJ_VISIBLE)==0){g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,110,"ATreeItem.UpdateItem","Can't update (item invisible for current role)");return}if(!this.HasQuery()){var j=this.ItemIndex+this.iSeq;var a=this.TreeObj.GetNode(j);if(a!=null){if(a.Parent!=h){a=null}}if(a==null){this.iSeq=this.iSeq+1;j=this.ItemIndex+this.iSeq;a=new ATreeNodeSrv();a.Key=j;a.Image=this.Image;if(h==null){a.HashKey=this.HashKey}else{a.HashKey=h.HashKey+this.HashKey}a.Name=this.Name;a.Tooltip=this.Tooltip;a.CanBeChecked=true;a.TreeObj=this.TreeObj;a.Parent=h;a.AlreadyExpanded=!(this.ItemList.length>0||this.Derived!=null);this.TreeObj.AddNode(a)}else{if(e){if(a.AlreadyExpanded){a.RemoveChildren();for(var c=1;c<this.ItemList.length;c++){this.ItemList[c].UpdateItem(g,a,true)}}}}}else{var b=false;this.GetQuery(h,g);if(!this.QueryObj.RS.IsOpen()){b=true}var f=this.QueryObj.UpdateParam(g,e||b);b=b||f;if(b){if(h==null){var d=new ArrayList();for(var c=0;c<this.TreeObj.Nodes.Count();c++){var a=this.TreeObj.Nodes[c];if(a.Key.substr(0,6).equals(this.ItemIndex)){d.Add(a)}}for(var c=0;c<d.Count();c++){var a=d[c];this.TreeObj.RemoveNode(a)}}this.FillTree(g,h)}}};ATreeItemSrv.prototype.FillTree=function(f,g){if(this.QueryObj.FindData(f,"Tree item "+this.Name)){try{while(!this.QueryObj.RS.EOF()){this.iSeq=this.iSeq+1;var j=this.ItemIndex+this.iSeq;var b=new ATreeNodeSrv();b.Key=j;b.Tag=this.QueryObj.RS.BookMark();b.AlreadyExpanded=!(this.ItemList.length>0||this.Derived!=null);b.Name=this.QueryObj.RS.Get(1).stringValue();b.Image=this.Image;b.CanBeChecked=true;b.Parent=g;b.TreeObj=this.TreeObj;if(this.HasTooltip){b.Tooltip=this.QueryObj.RS.Get(this.QueryObj.RS.GetNumFields()).stringValue()}if(this.QueryObj.RS.findColumn("ICON")!=-1){var h=this.QueryObj.RS.Get("ICON").stringValue();if(h.length>0){b.Image=h}}b.HashKey="";if(this.QueryObj.RS.findColumn("HASH")!=-1){var k=this.QueryObj.RS.Get("HASH").stringValue();if(k.length>0){b.HashKey=k}}if(this.QueryObj.RS.findColumn("CANCHECK")!=-1){var a=this.QueryObj.RS.Get("CANCHECK");b.CanBeChecked=(a.intValue()!=0)}if(b.HashKey.equals("")){b.HashKey=this.QueryObj.GetHashKey(this.PKColumns)}if(this.QueryObj.RS.findColumn("BADGE")!=-1){var c=this.QueryObj.RS.Get("BADGE").stringValue();if(c.length>0){b.Badge=c}}this.TreeObj.AddNode(b);this.QueryObj.RS.MoveNext()}}catch(d){}}};ATreeItemSrv.prototype.Expand=function(a,c){if(c.AlreadyExpanded){return}this.SetIMDB(c,a);for(var b=1;b<this.ItemList.length;b++){this.ItemList[b].UpdateItem(a,c,false)}if(this.Derived!=null){this.UpdateItem(a,c,false)}};ATreeItemSrv.prototype.SetIMDB=function(d,a){if(this.HasQuery()){this.GetQuery(d.Parent,a);try{this.QueryObj.RS.absolute(d.Tag);this.QueryObj.SelectRow(this.QueryObj.RS.BookMark(),this.TreeObj.Parent.IMDB,a)}catch(c){}if(this.Derived!=null){if(this.Derived.Parent!=null){var b=d.Parent;while(!b.Key.substr(0,6).equals(this.Derived.Parent.ItemIndex)){b=b.Parent;if(b==null){break}}if(b!=null){this.Derived.Parent.SetIMDB(b,a)}}}else{if(this.Parent!=null){this.Parent.SetIMDB(d.Parent,a)}}}};ATreeItemSrv.prototype.GetQuery=function(c,b){var a=".";if(c!=null){a=c.Key}this.QueryObj=null;this.QueryObj=this.QueryList[a];if(this.QueryObj==null){this.QueryObj=new ADynQuerySrv(this.TreeObj);this.QueryObj.SetQuery(this.iSQL,this.iCN,b);this.QueryObj.iGuid=this.iQueryGuid;this.QueryObj.IMDBTable=this.iIMDBTable;this.QueryList[a]=this.QueryObj}};function ATreeNodeSrv(){this.Key;this.AlreadyExpanded=false;this.Expanded=false;this.Name;this.Tooltip="";this.Image;this.Parent=null;this.Nodes=null;this.Tag=0;this.TreeObj=null;this.HashKey;this.Doc=null;this.ColIdx=0;this.CanBeChecked=true;this.UpdateCount=0;this.ChildrenUpdCount=0;this.iSelected=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TRN_MAXPROPS);this.RD3ResendNodes=false;this.Badge=""}ATreeNodeSrv.prototype.Selected=function(){if(this.Doc!=null){return this.Doc.Selected()}else{return this.iSelected}};ATreeNodeSrv.prototype.set_Selected=function(a){if(this.iSelected!=a){this.iSelected=a;if(this.Doc!=null){this.Doc.set_Selected(a)}this.RD3Change(RD3Glb.TRN_SELECTED)}};ATreeNodeSrv.prototype.AddNode=function(a){if(this.Nodes==null){this.Nodes=new ArrayList()}this.Nodes.Add(a);this.TreeObj.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeNodeSrv.prototype.RemoveChildren=function(){if(this.Nodes==null){return}for(var a=0;a<this.Nodes.Count();a++){var b=this.Nodes[a];this.TreeObj.RemoveNode(b)}this.Nodes.Clear();this.Nodes=null;this.TreeObj.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeNodeSrv.prototype.ToggleExpansion=function(a,b){if(b==undefined){b=false}if(!this.AlreadyExpanded){this.TreeObj.Expand(a,this);this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED)}else{this.Expanded=!this.Expanded;if(b&&this.TreeObj.ActivateOnExpand){this.TreeObj.FireNodeClick(this,a)}}this.DOUpdateIcon();this.RD3Change(RD3Glb.TRN_EXPANDED)};ATreeNodeSrv.prototype.DTTTrace=function(a,c,d){if(d){var b="L="+c+(this.TreeObj.SelectedNode==this?" S=1":"");a.DTTObj.AddTraceToken("",DTTEngine.TRC_TREENODE,"Tree.Node",this.Name+(this.Selected()?" (Selected)":""),b)}};ATreeNodeSrv.prototype.SetDocument=function(a){this.Doc=a;a.set_UIBound(true);this.UpdateCount=-1;this.DOUpdateNode(null)};ATreeNodeSrv.prototype.DOUpdateNode=function(h){var m=null;if(this.Parent!=null){m=this.Parent.Doc}if(this.Doc!=null){if(this.UpdateCount!=this.Doc.UpdateCount()){var o=null;if(this.ColIdx>0){o=this.Parent.Doc.GetCollByIndex(this.ColIdx)}this.Name=this.Doc.GetName(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Image=this.Doc.GetIcon(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Tooltip=this.Doc.GetTooltip(0,o,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);this.Badge=this.Doc.GetNamedPropertyValue("BADGE").stringValue();this.RD3Change(RD3Glb.TRN_CAPTION);this.RD3Change(RD3Glb.TRN_IMAGE);this.RD3Change(RD3Glb.TRN_TOOLTIP);this.RD3Change(RD3Glb.TRN_SELECTED);this.RD3Change(RD3Glb.TRN_BADGE);this.UpdateCount=this.Doc.UpdateCount()}if(this.AlreadyExpanded){var d=this.Doc.GetMD();var e=0;for(var g=1;g<=d.GetNumColl();g++){var b=this.Doc.GetCollByIndex(g);if(b.Visible()){b.set_UIBound(true);e+=b.UpdateCount()}}if(this.Nodes!=null){for(var g=0;g<this.Nodes.Count();g++){var a=this.Nodes[g];if(a.Doc!=null&&a.Doc.Deleted()){e=-1;break}}}else{for(var g=1;g<=d.GetNumColl();g++){var b=this.Doc.GetCollByIndex(g);if(b.Visible()){b.set_UIMode(true);var k=b.Count();b.set_UIMode(false);if(k>0){this.AlreadyExpanded=false;this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);break}}}}if(e!=this.ChildrenUpdCount&&h!=null){var j=false;for(var g=0;g<h.Count();g++){var a=this.NodesToRefresh[g];if(this.IsParent(a)){j=true;break}}if(!j){h.Add(this)}}return true}}return false};ATreeNodeSrv.prototype.DOClick=function(){if(this.Doc!=null){this.Doc.OnClick()}};ATreeNodeSrv.prototype.DOExpand=function(){if(this.Doc!=null&&!this.AlreadyExpanded){this.AlreadyExpanded=true;this.Expanded=true;this.Doc.OnExpand();var f=this.Doc.GetMD();this.ChildrenUpdCount=0;for(var a=1;a<=f.GetNumColl();a++){var j=this.Doc.GetCollByIndex(a);if(j.Visible()){if(j.Parent()!=null&&!j.Parent().Inserted()){try{j.Parent().LoadCollectionDirect(j,0,true)}catch(b){WriteToConsoleError(b)}}j.set_UIBound(true);j.set_UIMode(true);j.MoveFirst();this.ChildrenUpdCount+=j.UpdateCount();while(!j.IsEof()){var g=j.GetAt();var h=this.TreeObj.DOCreateRootNode(g,this,a);if(h!=null){h.AlreadyExpanded=!g.MayHaveChildren()}j.MoveNext()}j.set_UIMode(false)}}this.DOUpdateIcon();this.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);this.RD3Change(RD3Glb.TRN_EXPANDED)}};ATreeNodeSrv.prototype.IsParent=function(b){var a=this;while(a!=null){a=a.Parent;if(a==b){return true}}return false};ATreeNodeSrv.prototype.DOUpdateIcon=function(){if(this.Doc!=null){var a=null;if(this.ColIdx>0){a=this.Parent.Doc.GetCollByIndex(this.ColIdx)}var b=this.Image;this.Image=this.Doc.GetIcon((this.Expanded?1:0),a,this.TreeObj.Parent.FormIdx&65535,this.TreeObj.FrIndex);if(!(new IDVariant(b)).equals(new IDVariant(this.Image),true)){this.RD3Change(RD3Glb.TRN_IMAGE)}}};ATreeNodeSrv.prototype.GetRD3Name=function(){return"trn"};ATreeNodeSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Key+":"+this.TreeObj.FrIndex+":"+this.TreeObj.Parent.FormIdx};ATreeNodeSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATreeNodeSrv.prototype.isRD3Changed=function(a){return this.RD3PropChg[a]};ATreeNodeSrv.prototype.RD3RenderDifference=function(d,g,h,e){this.DTTTrace(this.TreeObj.MainFrm,h,e);var j=(this.RD3PropChg[RD3Glb.TRN_ALREADYEXPANDED]&&this.AlreadyExpanded)||this.RD3ResendNodes;var a=null;if(g){a=d.AddNewElement(this.GetRD3Name())}if(a==null&&(this.RD3Changed||j)){a=d.AddNewElement("chg")}if(a!=null){a.SetAttribute("id",this.GetRD3Ident())}var f=this.RD3Changed;if(g||this.RD3Changed){for(var c=0;c<this.RD3PropChg.length;c++){if(this.RD3PropChg[c]||g){this.SetRD3Property(c,a,g)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(this.Nodes!=null){var b=(g||j)?a:d;for(var c=0;c<this.Nodes.Count();c++){f|=this.Nodes[c].RD3RenderDifference(b,g||j,h+1,e)}}this.RD3ResendNodes=false;return f};ATreeNodeSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TRN_ALREADYEXPANDED:if(this.AlreadyExpanded==false&&b){break}c.SetAttribute("aex",this.AlreadyExpanded?"1":"0");break;case RD3Glb.TRN_EXPANDED:if(this.Expanded==false&&b){break}c.SetAttribute("exp",this.Expanded?"1":"0");break;case RD3Glb.TRN_CAPTION:if(this.Name==""&&b){break}c.SetAttribute("cap",this.Name);break;case RD3Glb.TRN_TOOLTIP:if(this.Tooltip==""&&b){break}c.SetAttribute("tip",this.Tooltip);break;case RD3Glb.TRN_IMAGE:if(this.Image==""&&b){break}c.SetAttribute("img",this.Image);break;case RD3Glb.TRN_CANCHECK:if(this.CanBeChecked==true&&b){break}c.SetAttribute("cch",this.CanBeChecked?"1":"0");break;case RD3Glb.TRN_SELECTED:if(!this.Selected()&&b){break}c.SetAttribute("sel",this.Selected()?"1":"0");break;case RD3Glb.TRN_BADGE:if(this.Badge==""&&b){break}c.SetAttribute("bdg",this.Badge);break}};function ATreeSrv(a){WebFrameSrv.call(this,a);this.ItemList;this.Nodes=new ArrayList();this.SelectedNode;this.iCollapsed=false;this.iEnabled=false;this.IsDO=false;this.NCounter=0;this.iSelectMulti=false;this.SelectedNodes=new ArrayList();this.iDragAndDrop=false;this.ActivateOnExpand=true;this.iIsActive=false;this.CtxMenuIdx=-1;this.UpdCount=0;this.IDColl=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TRE_MAXPROPS);this.RD3ResendNodes=false;this.NotifyFinalSelection=false;this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ExpandEventDef=RD3Glb.EVENT_ACTIVE;this.FirstExpandDef=RD3Glb.EVENT_ACTIVE;this.CheckEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE;this.ExpandAnimationDef=null;this.Visible=true;this.set_Enabled(true)}ATreeSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];ATreeSrv[obj]=WebFrameSrv[obj]}ATreeSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATreeItemSrv()}};ATreeSrv.prototype.SetItem=function(b,a){this.ItemList[b]=a;a.TreeObj=this};ATreeSrv.prototype.GetItem=function(a){return this.ItemList[a]};ATreeSrv.prototype.Enabled=function(){return this.iEnabled};ATreeSrv.prototype.set_Enabled=function(a){if(this.iEnabled!=a){this.iEnabled=a;this.RD3Change(RD3Glb.TRE_ENABLED)}};ATreeSrv.prototype.SelectMulti=function(){return this.iSelectMulti};ATreeSrv.prototype.set_SelectMulti=function(a){if(this.iSelectMulti!=a){this.iSelectMulti=a;this.RD3Change(RD3Glb.TRE_SELECTMULTI)}};ATreeSrv.prototype.Collapsed=function(){return this.iCollapsed};ATreeSrv.prototype.set_Collapsed=function(a){if(this.iCollapsed!=a){WebFrameSrv.prototype.set_Collapsed.call(this,a);if(this.Collapsed==a){this.iCollapsed=a;this.RD3Change(RD3Glb.WFR_COLLAPSED)}}};ATreeSrv.prototype.DragAndDrop=function(){return this.iDragAndDrop};ATreeSrv.prototype.set_DragAndDrop=function(a){if(this.iDragAndDrop!=a){this.iDragAndDrop=a;this.RD3Change(RD3Glb.TRE_DRAGANDDROP)}};ATreeSrv.prototype.Refresh=function(m,a,g){if(a==undefined){a=new IDVariant()}if(g==undefined){g=true}var d=null;var c=null;var f="";if(this.SelectedNode!=null){f=this.SelectedNode.HashKey}if(!a.stringValue().equals("")){d=this.GetNodeByHash(m,a.stringValue(),false,false);if(d==null){m.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,184,"ATree.Refresh","Tree "+this.Code+": can't find root node with Hash = "+a+". Refresh all tree")}}else{d=null}if(g){c=new ArrayList();if(d==null){this.GetExpandedState(m,null,c,0)}else{this.GetExpandedState(m,d.Parent,c,0)}if(m.IsMobile()){m.RD3AddEvent("resetTree",this.GetRD3Ident())}}if(d==null){for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].Parent==null){this.ItemList[e].UpdateItem(m,null,true)}}var l=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}else{var k=new ArrayList();if(d.Nodes!=null){for(var j=0;j<d.Nodes.Count();j++){var o=d.Nodes[j];var p=parseInt(o.Key.substr(1,5),10);var b=this.ItemList[p];if(!k.Contains(b)){k.Add(b)}}}d.RemoveChildren();for(var h=0;h<k.Count();h++){var b=k[h];b.UpdateItem(m,d,true)}}if(g){if(d==null){this.ExpandNodes(m,null,c,0)}else{this.ExpandNodes(m,d.Parent,c,0)}}this.SelectedNode=null;if(!f.equals("")){d=this.GetNodeByHash(m,f,false,false);if(d!=null){this.FireNodeClick(d,m)}else{m.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,185,"ATree.Refresh","Tree "+this.Code+": can't find old selected node with Hash = "+f)}}};ATreeSrv.prototype.GetExpandedState=function(b,d,g,f){for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];if(a.Parent==d&&a.Expanded){var c=null;if(g.Count()<=f){c=new ArrayList();for(var e=g.Count();e<=f;e++){g.Add(null)}g[f]=c}else{c=g[f]}if(!c.Contains(a.HashKey)){c.Add(a.HashKey);this.GetExpandedState(b,a,g,f+1)}else{b.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,186,"ATree.GetExpandedState","Tree "+this.Code+": the Hash function has the same value for different nodes (HashKey = "+a.HashKey+")")}}}};ATreeSrv.prototype.ExpandNodes=function(f,j,b,g){for(var d=0;d<this.Nodes.Count();d++){var h=this.Nodes[d];if(h.Parent==j){var e=(g<b.Count()?b[g]:null);if(e!=null&&e.indexOf(h.HashKey)!=-1){var a=this.Nodes.Count();if(!h.Expanded){var c=parseInt(h.Key.substr(1,5),10);this.ItemList[c].Expand(f,h);h.AlreadyExpanded=true;h.Expanded=true;h.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);h.RD3Change(RD3Glb.TRN_EXPANDED)}this.ExpandNodes(f,h,b,g+1);if(a!=this.Nodes.Count()){d--}}}}};ATreeSrv.prototype.UpdateTree=function(b){if(!this.IsDO){for(var d=1;d<this.ItemList.length;d++){if(this.ItemList[d].Parent==null){this.ItemList[d].UpdateItem(b,null,false)}}}else{var e=this.ActiveDocument();var g=false;if(this.IDColl!=null){this.IDColl.set_UIMode(true);if(this.IDColl.UpdateCount()!=this.UpdCount){g=true;this.UpdCount=this.IDColl.UpdateCount()}if(!g){this.IDColl.MoveFirst();while(!this.IDColl.IsEof()){if(this.IDColl.GetAt().Deleted()||this.IDColl.GetAt().Hidden()){g=true;break}this.IDColl.MoveNext()}}this.IDColl.set_UIMode(false)}if(g){this.DOCreateRootNodes(this.IDColl)}var j=new ArrayList();for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];a.DOUpdateNode(j)}for(var h=0;h<j.Count();h++){var a=j[h];this.DORefresh(a.Doc,true)}var f=e!=null;while(e!=this.ActiveDocument()&&e!=null){this.DOActivate(e);if(e!=this.ActiveDocument()){e=e.Parent()}}if(this.ActiveDocument()==null&&f&&this.Nodes.Count()>0){this.DOActivate(this.Nodes[0].Doc)}}};ATreeSrv.prototype.Expand=function(a,d){var b=new IDVariant();if(this.IsDO){this.Parent.OnTreeExpandDoc(this,d.Doc,b)}else{this.Parent.OnTreeExpandNode(this,new IDVariant(d.HashKey),b)}if(b.isFalse()){if(this.IsDO){d.DOExpand()}else{var c=parseInt(d.Key.substr(1,5),10);this.ItemList[c].Expand(a,d);d.AlreadyExpanded=true;d.Expanded=true;d.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);d.RD3Change(RD3Glb.TRN_EXPANDED)}if(this.ActivateOnExpand){this.FireNodeClick(d,a)}}};ATreeSrv.prototype.NodeClick=function(a,c){if(this.IsDO){return true}else{var b=parseInt(c.Key.substr(1,5),10);this.ItemList[b].SetIMDB(c,a);return((this.ItemList[b].RoleFlags&Glb.OBJ_ENABLED)!=0)}};ATreeSrv.prototype.FireNodeClick=function(c,a){var b=new IDVariant();if(this.IsDO){this.Parent.OnTreeActivateDoc(this,c.Doc,b)}else{this.Parent.OnTreeActivateNode(this,new IDVariant(c.HashKey),b)}if(b.isFalse()){if(this.SelectedNode!=c){this.SelectedNode=c}if(this.IsDO){c.DOClick()}else{this.Parent.NodeClick(this,c)}}this.RD3Change(RD3Glb.TRE_SELECTEDNODE)};ATreeSrv.prototype.FireOnDrop=function(b,d,f,e,c,a){this.Parent.OnTreeDropNode(this,new IDVariant(b),new IDVariant(d),new IDVariant(f),new IDVariant(e),new IDVariant(c),new IDVariant(a))};ATreeSrv.prototype.FireOnDropDoc=function(b,f,h,g,a,c){this.Parent.OnTreeDropDoc(this,b,f,new IDVariant(h),new IDVariant(g),new IDVariant(a),c);if(c.isFalse()){try{f.OnDrop(b,new IDVariant(h),new IDVariant(g),new IDVariant(a),c);if(c.isFalse()){var k=MDOInit.StandardDrop(b,f,h,g,a);if(k!=null){this.UpdateTree(null);this.DOActivate(k)}}}catch(j){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,j.message,"","TREE",0,false)}}};ATreeSrv.prototype.FireOnChangeExpandNode=function(c,b,a){this.Parent.OnTreeChangeExpandNode(this,new IDVariant(c),new IDVariant(b),a)};ATreeSrv.prototype.FireOnChangeExpandDoc=function(c,b,a){this.Parent.OnTreeChangeExpandDoc(this,c,new IDVariant(b),a)};ATreeSrv.prototype.AddNode=function(b){this.Nodes.Add(b);if(b.Parent!=null){b.Parent.AddNode(b)}else{var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}};ATreeSrv.prototype.RemoveNode=function(b){this.Nodes.Remove(b);b.RemoveChildren();if(!this.IsDO&&b.Selected()){this.SelectedNodes.Remove(b.HashKey)}if(this.SelectedNode==b){this.SelectedNode=null;this.RD3Change(RD3Glb.TRE_SELECTEDNODE)}if(b.Parent==null){var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}};ATreeSrv.prototype.GetNode=function(a){for(var b=0;b<this.Nodes.Count();b++){var c=this.Nodes[b];if(c.Key.equals(a)){return c}}return null};ATreeSrv.prototype.ProcessRequest=function(f,e,a,c){var h=new IDVariant();if(c){var j=false;for(var d=0;d<this.Nodes.Count();d++){var b=this.Nodes[d];var g=f.GetParameter("F"+e.FormIdx+"N"+this.FrIndex+"N"+b.Key+"S");if(g!=null){if(g.length>0&&!b.Selected()){j=true;f.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+b.Name+" ("+(this.IsDO?"DO":"Hash = "+b.HashKey)+") selected");f.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+b.Name+" ("+(this.IsDO?"DO":"Hash = "+b.HashKey)+") selected","",b.Key+"chk");f.DTTObj.AddHelpItem(0,0,0,0,"Seleziona il nodo "+b.Name+" dell'albero");h=new IDVariant();if(this.IsDO){if(b.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,b.Doc,new IDVariant(true),h,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(b.HashKey),new IDVariant(true),h,new IDVariant(false))}if(h.isFalse()){b.set_Selected(true);if(this.IsDO){if(b.Doc!=null){b.Doc.set_Selected(true)}}else{this.SelectedNodes.Add(b.HashKey)}}}if(g.length==0&&b.Selected()){j=true;f.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+b.Name+" ("+(this.IsDO?"DO":"Hash = "+b.HashKey)+") unselected");f.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+b.Name+" ("+(this.IsDO?"DO":"Hash = "+b.HashKey)+") unselected","",b.Key+"chk");f.DTTObj.AddHelpItem(0,0,0,0,"Deseleziona il nodo "+b.Name+" dell'albero");h=new IDVariant();if(this.IsDO){if(b.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,b.Doc,new IDVariant(false),h,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(b.HashKey),new IDVariant(false),h,new IDVariant(false))}if(h.isFalse()){b.set_Selected(false);if(this.IsDO){if(b.Doc!=null){b.Doc.set_Selected(false)}}else{this.SelectedNodes.Remove(b.HashKey)}}}}}if(j){if(this.IsDO){this.Parent.OnTreeChangeSelDoc(this,null,new IDVariant(false),h,new IDVariant(true))}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(),new IDVariant(false),h,new IDVariant(true))}}}};ATreeSrv.prototype.SearchObject=function(a){if(a.equals(this.Code)||(this.iGuid!=null&&this.iGuid.equals(a))){return this}else{return null}};ATreeSrv.prototype.HasCaptionCommands=function(){return true};ATreeSrv.prototype.SetRoleFlags=function(a,b,c){this.ItemList[a].RoleFlags=this.ItemList[a].RoleFlags&(~c);this.ItemList[a].RoleFlags=this.ItemList[a].RoleFlags|b};ATreeSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITTREE,"ATree.Render","")){var c=this.Parent;var b="E="+(this.Enabled()?-1:0)+" V="+(this.Visible?-1:0);a.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_TREECAPTION,"Tree.Caption",c.Frames[this.FrIndex].Caption,b);return true}else{return false}};ATreeSrv.prototype.IsActive=function(){return this.iIsActive};ATreeSrv.prototype.set_IsActive=function(a){if(this.iIsActive!=a){this.iIsActive=a;this.RD3Change(RD3Glb.TRE_CHECKACTIVE)}};ATreeSrv.prototype.SetDocument=function(b){this.Nodes.Clear();this.IDColl=null;this.IsDO=true;if(b!=null){this.DOCreateRootNode(b)}var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeSrv.prototype.SetCollection=function(b){this.Nodes.Clear();this.IDColl=null;this.IsDO=true;if(b!=null){this.DOCreateRootNodes(b)}var a=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true};ATreeSrv.prototype.DOCreateRootNode=function(f,e,c){if(e==undefined){e=null}if(c==undefined){c=0}if(f.Deleted()){return null}var g=new ATreeNodeSrv();this.NCounter=this.NCounter+1;g.Key=this.NCounter+"";g.ColIdx=c;g.TreeObj=this;g.Parent=e;g.AlreadyExpanded=!f.MayHaveChildren();g.SetDocument(f);var a=f.GetPropertyIndex("DO_CANCHECK",false,true);g.CanBeChecked=true;if(a>0){var b=f.GetPropByIndex(a);if(b.Type!=IDVariant.NULL){g.CanBeChecked=(b.intValue()!=0)}}this.AddNode(g);return g};ATreeSrv.prototype.DOCreateRootNodes=function(g){g.set_UIBound(true);g.set_UIMode(true);g.MoveFirst();while(!g.IsEof()){if(g==this.IDColl){var b=g.GetAt();var f=this.DOGetNode(b);if(b.Deleted()){if(f!=null){this.RemoveNode(f)}}else{if(f!=null){if(f.Parent!=null){f=null}}if(f==null){this.DOCreateRootNode(b)}}}else{this.DOCreateRootNode(g.GetAt())}g.MoveNext()}if(g==this.IDColl){var a=new ArrayList(this.Nodes);for(var e=0;e<a.Count();e++){var f=a[e];if(f.Doc!=null){if(f.Doc.Deleted()||f.Doc.Hidden()){this.RemoveNode(f)}}if(f.Doc!=null&&f.Parent==null){if(f.Doc.ParentCollection()!=this.IDColl){this.RemoveNode(f)}}}}this.IDColl=g;this.UpdCount=g.UpdateCount();g.set_UIMode(false)};ATreeSrv.prototype.DOGetNode=function(a){for(var c=0;c<this.Nodes.Count();c++){var b=this.Nodes[c];if(b.Doc==a){return b}}return null};ATreeSrv.prototype.DOActivate=function(g){var e=null;var c=new ArrayList();if(this.MainFrm.IsMobile()){e=this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident());for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.Expanded){f.Expanded=false;c.Add(f)}}}var h=this.DOFindAndExpandNode(g);if(h!=null){this.FireNodeClick(h,null)}else{if(e!=null){e.DontSend=true}}if(this.MainFrm.IsMobile()){for(var j=0;j<c.Count();j++){var b=this.Nodes[j];if(!b.Expanded){b.RD3Change(RD3Glb.TRN_EXPANDED)}else{b.RD3Change(RD3Glb.TRN_EXPANDED,false)}}var a=false;for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.isRD3Changed(RD3Glb.TRN_EXPANDED)){a=true;break}}if(a){for(var j=0;j<this.Nodes.Count();j++){var f=this.Nodes[j];if(f.Expanded){f.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(e!=null){e.DontSend=true}}}};ATreeSrv.prototype.DOExpand=function(g,e){if(e==undefined){e=true}var j=null;var m=new ArrayList();if(this.MainFrm.IsMobile()){if(g==null&&e){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't Expand all tree in a Mobile Application");return}j=this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident());for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.Expanded){c.Expanded=false;m.Add(c)}}}if(g==null){var l=0;var b=new ArrayList();while(l!=this.Nodes.Count()){l=this.Nodes.Count();for(var h=0;h<this.Nodes.Count();h++){var a=this.Nodes[h];if((e&&!a.AlreadyExpanded)||(!e&&a.Expanded)){b.Add(a)}}for(var h=0;h<b.Count();h++){var a=b[h];if(e){a.DOExpand()}if(a.Expanded!=e){a.Expanded=e;a.RD3Change(RD3Glb.TRN_EXPANDED)}}}}else{if(this.MainFrm.IsMobile()){this.DOFindAndExpandNode(g)}var a=this.DOGetNode(g);if(a!=null){if(e&&!a.AlreadyExpanded){a.DOExpand()}if(a.Expanded!=e){a.Expanded=e;a.RD3Change(RD3Glb.TRN_EXPANDED)}}if(this.MainFrm.IsMobile()){for(var h=0;h<m.Count();h++){var k=this.Nodes[h];if(!k.Expanded){k.RD3Change(RD3Glb.TRN_EXPANDED)}else{k.RD3Change(RD3Glb.TRN_EXPANDED,false)}}var f=false;for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.isRD3Changed(RD3Glb.TRN_EXPANDED)){f=true;break}}if(f){for(var h=0;h<this.Nodes.Count();h++){var c=this.Nodes[h];if(c.Expanded){c.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(j!=null){j.DontSend=true}}}}};ATreeSrv.prototype.ActiveDocument=function(){if(this.SelectedNode!=null){return this.SelectedNode.Doc}return null};ATreeSrv.prototype.set_ActiveDocument=function(a){this.DOActivate(a)};ATreeSrv.prototype.DORefresh=function(h,g){if(g==undefined){g=false}var l=this.MainFrm.IsMobile();var b=new ArrayList();var e=new ArrayList();var f=this.ActiveDocument();for(var k=0;k<this.Nodes.Count();k++){var m=this.Nodes[k];if(m.Expanded){b.Add(m.Doc);if(l){m.Expanded=false}}}if(l){this.MainFrm.RD3AddEvent("resetTree",this.GetRD3Ident())}if(h==null){for(var k=0;k<this.Nodes.Count();k++){var m=this.Nodes[k];if(m.Doc!=null&&m.Doc.Parent()==null){e.Add(m.Doc)}}var j=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());this.RD3ResendNodes=true}else{e.Add(h)}for(var k=0;k<e.Count();k++){var a=e[k];var c=this.DOGetNode(a);if(c!=null){c.DOUpdateNode(null);if(g&&c.AlreadyExpanded){c.RemoveChildren();c.AlreadyExpanded=!c.Doc.MayHaveChildren();if(c.Expanded){c.Expanded=false;c.DOExpand()}c.RD3Change(RD3Glb.TRN_ALREADYEXPANDED);c.RD3Change(RD3Glb.TRN_EXPANDED)}}}for(var k=0;k<b.Count();k++){var a=b[k];var c=this.DOGetNode(a);if(c!=null&&!c.Expanded){if(c.AlreadyExpanded){c.Expanded=true;c.DOUpdateIcon();c.RD3Change(RD3Glb.TRN_EXPANDED)}else{c.DOExpand()}}}if(f!=null&&f!=this.ActiveDocument()){var c=this.DOGetNode(f);if(c!=null){this.SelectedNode=c;this.RD3Change(RD3Glb.TRE_SELECTEDNODE)}}};ATreeSrv.prototype.DOFindAndExpandNode=function(c){var f=null;var e=null;var b=new ArrayList();var a=c;while(a!=null){f=this.DOGetNode(a);if(f==null){b.Add(a);a=a.Parent()}else{break}}while(a!=c&&f!=null&&b.Count()>0){f.DOUpdateNode(null);if(!f.AlreadyExpanded){f.DOExpand()}a=b[b.Count()-1];b.RemoveAt(b.Count()-1);f=this.DOGetNode(a)}f=this.DOGetNode(c);if(f!=null){e=f.Parent}while(e!=null){if(!e.Expanded){e.Expanded=true;e.DOUpdateIcon();e.RD3Change(RD3Glb.TRN_EXPANDED)}e=e.Parent}if(f!=null){if(f.Doc==c){return f}else{return null}}else{return null}};ATreeSrv.prototype.GetNodeByHash=function(p,k,h,r){if(h==undefined){h=false}if(r==undefined){r=true}var s=new ArrayList();try{if(!r){var g=false;for(var m=0;m<this.Nodes.Count();m++){var a=this.Nodes[m];if(a.Expanded){if(!g&&s.Contains(a.HashKey)){g=true;break}s.Add(a.HashKey)}}if(g){p.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,186,"ATree.GetNodeByHash","Tree "+this.Code+": the Hash function has the same value for different nodes (HashKey = "+a.HashKey+")")}}var l=false;var o=null;var q=0;var d=0;while(!l){l=true;for(var b=d;b<this.Nodes.Count();b++){if(this.Nodes[b].HashKey.equals(k)){o=this.Nodes[b];break}}if(o==null&&h){q=this.Nodes.Count();for(var b=d;b<this.Nodes.Count();b++){if(!this.Nodes[b].AlreadyExpanded){var c=this.Nodes.Count();this.Nodes[b].ToggleExpansion(p);d=b;if(this.Nodes.Count()!=c){l=false;break}}}}}if(o!=null){var a=o.Parent;while(a!=null){if(!s.Contains(a.HashKey)){s.Add(a.HashKey)}a=a.Parent}for(var m=0;m<this.Nodes.Count();m++){a=this.Nodes[m];if(!s.Contains(a.HashKey)&&a.Expanded){a.Expanded=false;a.RD3Change(RD3Glb.TRN_EXPANDED)}if(s.Contains(a.HashKey)&&!a.Expanded){a.ToggleExpansion(p)}}return o}}catch(f){}return null};ATreeSrv.prototype.ActivateNode=function(b,c,g,e){if(g==undefined){g=false}if(e==undefined){e=true}this.RD3Change(RD3Glb.TRE_SELECTEDNODE);var d=null;if(b.IsMobile()){e=true;d=b.RD3AddEvent("resetTree",this.GetRD3Ident())}var f=this.GetNodeByHash(b,c.stringValue(),g,e);if(f!=null){if(this.SelectedNode!=f){this.FireNodeClick(f,b)}else{if(d!=null){d.DontSend=true}b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,175,"ATree.ActivateNode","Tree "+this.Code+": node with Hash = "+c+" is already activated")}}else{if(d!=null){d.DontSend=true}b.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,176,"ATree.ActivateNode","Tree "+this.Code+": can't find tree node with Hash = "+c)}if(b.IsMobile()){var a=false;for(var h=0;h<this.Nodes.Count();h++){n=this.Nodes[h];if(n.isRD3Changed(RD3Glb.TRN_EXPANDED)){a=true;break}}if(a){for(var h=0;h<this.Nodes.Count();h++){n=this.Nodes[h];if(n.Expanded){n.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{if(d!=null){d.DontSend=true}}}};ATreeSrv.prototype.GetActiveNode=function(){if(this.SelectedNode!=null){return new IDVariant(this.SelectedNode.HashKey)}return new IDVariant("")};ATreeSrv.prototype.GetParentNode=function(b){for(var c=0;c<this.Nodes.Count();c++){var a=this.Nodes[c];if(a.HashKey.equals(b.stringValue())){break}}if(a!=null){if(a.Parent!=null){return new IDVariant(a.Parent.HashKey)}}return new IDVariant("")};ATreeSrv.prototype.GetChildrenCount=function(b){if(b.stringValue().equals("")){return new IDVariant(this.Nodes.Count())}else{var a=null;for(var c=0;c<this.Nodes.Count();c++){a=this.Nodes[c];if(a.HashKey.equals(b.stringValue())){break}}if(a!=null){if(a.Nodes!=null){return new IDVariant(a.Nodes.Count())}}}return new IDVariant(0)};ATreeSrv.prototype.GetChildrenNode=function(c,b){if(c.stringValue().equals("")){return new IDVariant(this.Nodes[b.intValue()].HashKey)}else{var a=null;for(var d=0;d<this.Nodes.Count();d++){a=this.Nodes[d];if(a.HashKey.equals(c.stringValue())){break}}if(a!=null){if(a.Nodes!=null){return new IDVariant(a.Nodes[b.intValue()].HashKey)}}}return new IDVariant("")};ATreeSrv.prototype.GetSelectedCount=function(){if(this.SelectMulti()&&!this.IsDO){return new IDVariant(this.SelectedNodes.Count())}return new IDVariant(0)};ATreeSrv.prototype.GetSelectedNode=function(a){if(this.SelectMulti()&&!this.IsDO){return new IDVariant(this.SelectedNodes[a.intValue()])}return new IDVariant("")};ATreeSrv.prototype.ExpandNode=function(h,e,b,j){if(b==undefined){b=true}if(j==undefined){j=true}if(e.stringValue().equals("")){j=false}var c=null;var k=false;var g=null;if(h.IsMobile()){j=true;if(e.stringValue().equals("")&&b){h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't Expand all tree in a Mobile Application");return}g=h.RD3AddEvent("resetTree",this.GetRD3Ident());var c=this.GetNodeByHash(h,e.stringValue(),e.stringValue().equals(""),false);if(c!=null&&c.Expanded&&b){k=true;c=null}}c=this.GetNodeByHash(h,e.stringValue(),e.stringValue().equals(""),j);if(!e.stringValue().equals("")){if(c!=null){if(b!=c.Expanded||(b&&!c.AlreadyExpanded)){c.ToggleExpansion(h)}}else{h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,177,"ATree.ExpandNode","Tree "+this.Code+": can't find tree node with Hash = "+e);if(g!=null){g.DontSend=true}}if(h.IsMobile()){if(k){g.DontSend=true;return}var d=false;for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.isRD3Changed(RD3Glb.TRN_EXPANDED)){d=true;break}}if(d){for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(a.Expanded){a.RD3Change(RD3Glb.TRN_EXPANDED)}}}else{g.DontSend=true}}}else{for(var f=0;f<this.Nodes.Count();f++){var a=this.Nodes[f];if(b!=a.Expanded||(b&&!a.AlreadyExpanded)){a.ToggleExpansion(h)}}}};ATreeSrv.prototype.SelectNode=function(a,b,d){if(d==undefined){d=true}var c=this.GetNodeByHash(a,b.stringValue(),false,false);if(c!=null){if(!c.Selected()&&d){c.set_Selected(true);if(this.IsDO){if(c.Doc!=null){c.Doc.set_Selected(true)}}else{this.SelectedNodes.Add(c.HashKey)}}if(c.Selected()&&!d){c.set_Selected(false);if(this.IsDO){if(c.Doc!=null){c.Doc.set_Selected(false)}}else{this.SelectedNodes.Remove(c.HashKey)}}}else{a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,178,"ATree.SelectNode","Tree "+this.Code+": can't find tree node with Hash = "+b)}};ATreeSrv.prototype.SelectAll=function(b){for(var c=0;c<this.Nodes.Count();c++){var a=this.Nodes[c];if(b==0){if(a.Selected()){this.SelectedNodes.Remove(a.HashKey)}a.set_Selected(false)}else{if(b==1){if(a.Selected()){this.SelectedNodes.Remove(a.HashKey)}else{this.SelectedNodes.Add(a.HashKey)}a.set_Selected(!a.Selected())}else{if(b==2){if(!a.Selected()){this.SelectedNodes.Add(a.HashKey)}a.set_Selected(true)}}}}};ATreeSrv.prototype.ExpandNodesLevel=function(a,f,e){if(e==undefined){e=true}for(var h=0;h<this.Nodes.Count();h++){var g=this.Nodes[h];var c=0;var d=g;while(d.Parent!=null){d=d.Parent;c++;if(c>f){break}}if((e&&c<f)||(!e&&c>=f)){if(e!=g.Expanded||(e&&!g.AlreadyExpanded)){var b=g.Expanded;g.ToggleExpansion(a);if(b!=g.Expanded){h=-1}}}}};ATreeSrv.prototype.GetRD3Name=function(){return"tre"};ATreeSrv.prototype.GetRD3NodeIdent=function(a){for(var c=0;c<this.Nodes.Count();c++){var b=this.Nodes[c];if(b.HashKey.equals(a)){return b.GetRD3Ident()+":txt"}}return""};ATreeSrv.prototype.GetRD3DocIdent=function(a){var b=this.DOGetNode(a);if(b!=null){return b.GetRD3Ident()+":txt"}return""};ATreeSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATreeSrv.prototype.RD3RenderDifferences=function(c,h,k){var l=0;var a=this.DTTTrace(this.MainFrm);var j=this.RD3Changed;var b=WebFrameSrv.prototype.RD3RenderDifferences.call(this,c,h,k);if(c==null){c=b}j|=(b!=null);if(c==null&&(this.RD3Changed||this.RD3ResendNodes)){c=h.AddNewElement("chg");c.SetAttribute("id",this.GetRD3Ident());b=c}if(k||this.RD3Changed){for(var f=0;f<this.RD3PropChg.length;f++){if(this.RD3PropChg[f]||k){this.SetRD3Property(f,c,k)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(k){if(this.IsActive()){this.CheckEventDef|=RD3Glb.EVENT_IMMEDIATE}if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ExpandEventDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("xpc",this.ExpandEventDef.toString())}if(this.FirstExpandDef!=RD3Glb.EVENT_ACTIVE){c.SetAttribute("fex",this.FirstExpandDef.toString())}if(this.CheckEventDef!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){c.SetAttribute("chc",this.CheckEventDef.toString())}if(this.ExpandAnimationDef!=null){c.SetAttribute("exa",this.ExpandAnimationDef)}}var e=(k||this.RD3ResendNodes)?c:h;var g=this.RD3ResendNodes||k;for(var f=0;f<this.Nodes.Count();f++){var d=this.Nodes[f];if(d.Parent==null){j|=d.RD3RenderDifference(e,g,l,a)}}this.RD3ResendNodes=false;return j?b:null};ATreeSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TRE_SELECTEDNODE:if(this.SelectedNode==null&&b){break}c.SetAttribute("sel",(this.SelectedNode==null)?"":this.SelectedNode.GetRD3Ident());break;case RD3Glb.TRE_CTXMENUIDX:if(this.CtxMenuIdx==0&&b){break}c.SetAttribute("cms","cms:"+this.CtxMenuIdx);break;case RD3Glb.TRE_SELECTMULTI:if(!this.SelectMulti()&&b){break}c.SetAttribute("mul",this.SelectMulti()?"1":"0");break;case RD3Glb.TRE_DRAGANDDROP:if(!this.DragAndDrop()&&b){break}c.SetAttribute("ded",this.DragAndDrop()?"1":"0");break;case RD3Glb.TRE_ACTIVATEONEXPAND:if(this.ActivateOnExpand&&b){break}c.SetAttribute("aoe",this.ActivateOnExpand?"1":"0");break;case RD3Glb.TRE_CHECKACTIVE:if(!this.IsActive()&&b){break}c.SetAttribute("act",this.IsActive()?"1":"0");break;case RD3Glb.TRE_ENABLED:if(this.iEnabled&&b){break}c.SetAttribute("ena",this.Enabled()?"1":"0");break}};ATreeSrv.prototype.RD3SelectNode=function(b,c){var d=this.GetNode(b);if(d!=null&&d.Selected()!=c){this.NotifyFinalSelection=true;if(c){this.MainFrm.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") selected");this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") selected","",d.Key+"chk");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona il nodo "+d.Name+" dell'albero")}else{this.MainFrm.DTTObj.SetRequestName("Tree Selection","Tree "+this.Code+" node selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,174,"ATree.ProcessRequest","Tree "+this.Code+": node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") unselected");this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TREENCHK,"Tree node "+d.Name+" ("+(this.IsDO?"DO":"Hash = "+d.HashKey)+") unselected","",d.Key+"chk");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Deseleziona il nodo "+d.Name+" dell'albero")}var a=new IDVariant();if(this.IsDO){if(d.Doc!=null){this.Parent.OnTreeChangeSelDoc(this,d.Doc,new IDVariant(c),a,new IDVariant(false))}}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(d.HashKey),new IDVariant(c),a,new IDVariant(false))}if(a.isFalse()){d.set_Selected(c);if(this.IsDO){if(d.Doc!=null){d.Doc.set_Selected(c)}}else{if(c){this.SelectedNodes.Add(d.HashKey)}else{this.SelectedNodes.Remove(d.HashKey)}}}else{d.RD3Change(RD3Glb.TRN_SELECTED)}}};ATreeSrv.prototype.RD3EndRequest=function(){if(this.NotifyFinalSelection){this.NotifyFinalSelection=false;if(this.IsDO){this.Parent.OnTreeChangeSelDoc(this,null,new IDVariant(false),new IDVariant(),new IDVariant(true))}else{this.Parent.OnTreeChangeSelNode(this,new IDVariant(),new IDVariant(false),new IDVariant(),new IDVariant(true))}}};ATreeSrv.prototype.RD3RawClick=function(b,h,g,q,f,p,d){var a=d.GetAttribute("par4");var m=a.indexOf(":");var l=a.indexOf(":",m+1);var e="";var j=null;if(m>-1&&l>-1){var k=a.substr(m+1,l-m-1);var c=this.GetNode(k);if(c!=null){j=c.Doc;e=c.HashKey}}var o=new IDVariant();if(this.MainFrm!=null){var c=(p)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(c,"Tree"+this.Code+" "+c,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Tree."+c,"Tree "+this.Code+": firing event "+c)}if(p){this.Parent.OnMouseDoubleClick(this,new IDVariant(b),new IDVariant(h),new IDVariant(g),new IDVariant(q),new IDVariant(f),new IDVariant(e),j,o)}else{this.Parent.OnMouseClick(this,new IDVariant(b),new IDVariant(h),new IDVariant(g),new IDVariant(q),new IDVariant(f),new IDVariant(e),j,o)}return o.isTrue()};ATreeSrv.prototype.GenericDrag=function(c,m){var j=parseInt(c.GetAttribute("par1"),10);var q=c.GetAttribute("obn");var d=c.GetAttribute("oid");var o=this.MainFrm.RD3FindNode(q);var e=new ArrayList();e.Add(o);if(this.SelectMulti()){for(var g=0;g<this.SelectedNodes.Count();g++){var f=this.SelectedNodes[g];var b=this.GetNodeByHash(this.MainFrm,f,false,false);if(b!=null){e.Add(b)}}}for(var g=0;g<e.Count();g++){var b=e[g];this.MainFrm.ActivedDocument=b.Doc;this.MainFrm.ActivedProperty=null;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"ATree.OnGenericDrag","Tree "+this.Code+": firing event OnGenericDrag");var p=new IDVariant();this.Parent.OnGenericDrag(this,p,new IDVariant(j),new IDVariant(b.HashKey));if(m instanceof WebFrameSrv){var a=m;if(d.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var h=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;h.GenericDrop(c,p)}else{a.GenericDrop(c,p)}}if(m instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(m,p)}}};ATreeSrv.prototype.GenericDrop=function(a,m){var l=parseInt(a.GetAttribute("par4"),10);var j=parseInt(a.GetAttribute("par5"),10);var c=parseInt(a.GetAttribute("par1"),10);var p=parseInt(a.GetAttribute("par2"),10);var h=parseInt(a.GetAttribute("par3"),10);var b=a.GetAttribute("oid");var k=this.MainFrm.RD3FindNode(b);this.MainFrm.DTTObj.SetRequestName("Generic Drop","Tree "+this.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"ATree.OnGenericDrop","Tree "+this.Code+": firing event OnGenericDrop");var o=new IDVariant();this.Parent.OnGenericDrop(this,m,o,new IDVariant(c),new IDVariant(l),new IDVariant(j),new IDVariant(p),new IDVariant(h),new IDVariant(k.HashKey),k.Doc);if(o.isFalse()&&this.MainFrm.ActivedDocument!=null&&k.Doc!=null){try{k.Doc.OnDrop(this.MainFrm.ActivedDocument,new IDVariant(this.MainFrm.ShiftKey()),new IDVariant(this.MainFrm.AltKey()),new IDVariant(this.MainFrm.CtrlKey()),o);if(o.isFalse()){var g=MDOInit.StandardDrop(this.MainFrm.ActivedDocument,k.Doc,this.MainFrm.ShiftKey(),this.MainFrm.AltKey(),this.MainFrm.CtrlKey());if(g!=null){this.UpdateTree(null);this.DOActivate(g)}}}catch(f){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,f.message,"","TREE",0,false)}}};function CmdHandlerSrv(a){this.CmdSets=new Array();this.CmdLin=new Array();this.MainFrm=a;this.iSuppressMenu=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.CMH_MAXPROP);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.SuppressMenuAnimationDef=null;if(a!=undefined){if(a.ParamsObj().MAX_COMMAND_SETS>0){this.CmdSets=new Array(a.ParamsObj().MAX_COMMAND_SETS+1)}if(a.ParamsObj().MAX_COMMANDS>0){this.CmdLin=new Array(a.ParamsObj().MAX_COMMANDS+1)}}}CmdHandlerSrv.prototype.AppendTo=function(a){};CmdHandlerSrv.prototype.SuppressMenu=function(){return this.iSuppressMenu};CmdHandlerSrv.prototype.set_SuppressMenu=function(a){if(this.iSuppressMenu!=a){this.iSuppressMenu=a;if(a){this.MainFrm.ResizeClient(this.MainFrm.ScreenW()+this.MainFrm.MenuW,this.MainFrm.ScreenH(),true)}else{this.MainFrm.ResizeClient(this.MainFrm.ScreenW()-this.MainFrm.MenuW,this.MainFrm.ScreenH(),true)}this.RD3Change(RD3Glb.CMH_SUPPRMENU)}};CmdHandlerSrv.prototype.set_CmdEnabled=function(b,a){this.CmdLin[b].set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdChecked=function(a,b){this.CmdLin[a].set_bChecked(this.MainFrm.ActiveFormIdx(),b)};CmdHandlerSrv.prototype.set_CmdVisible=function(b,a){this.CmdLin[b].set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdExpanded=function(c,a){if(this.CmdLin[c].uCommands()>0&&this.CmdLin[c].Expanded!=a){var b=new IDVariant();this.MainFrm.OnCmdSetChangeExpand(this.CmdLin[c],new IDVariant(a),b);if(b.isFalse()){this.AutoCollapse(this.CmdLin[c]);this.CmdLin[c].Expanded=a;this.CmdLin[c].RD3Change(RD3Glb.CMD_EXPANDED)}}};CmdHandlerSrv.prototype.set_CmdCaption=function(b,a){this.CmdLin[b].set_bCaption(a)};CmdHandlerSrv.prototype.set_CmdToolTip=function(b,a){this.CmdLin[b].set_bToolTip(a)};CmdHandlerSrv.prototype.set_CmdBadge=function(b,a){this.CmdLin[b].set_Badge(a)};CmdHandlerSrv.prototype.set_CmdSetEnabled=function(a,b){this.CmdSets[a].set_bEnabled(this.MainFrm.ActiveFormIdx(),b)};CmdHandlerSrv.prototype.set_CmdSetVisible=function(b,a){this.CmdSets[b].set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.set_CmdWidth=function(b,a){this.CmdLin[b].Width=a};CmdHandlerSrv.prototype.set_CmdSetExpanded=function(c,b){if(this.CmdSets[c].Expanded!=b){var a=new IDVariant();if(this.CmdSets[c].IdxForm>0){var d=this.MainFrm.GetForm(this.CmdSets[c].IdxForm);if(d!=null){d.OnCmdSetChangeExpand(this.CmdSets[c],new IDVariant(b),a)}}else{this.MainFrm.OnCmdSetChangeExpand(this.CmdSets[c],new IDVariant(b),a)}if(a.isFalse()){this.AutoCollapse(this.CmdSets[c]);this.CmdSets[c].Expand()}}};CmdHandlerSrv.prototype.set_CmdSetCaption=function(a,b){this.CmdSets[a].set_bCaption(b)};CmdHandlerSrv.prototype.set_CmdSetToolTip=function(a,b){this.CmdSets[a].set_bToolTip(b)};CmdHandlerSrv.prototype.set_CmdSetBadge=function(b,a){this.CmdSets[b].set_Badge(a)};CmdHandlerSrv.prototype.CmdEnabled=function(a){return this.CmdLin[a].bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdChecked=function(a){return this.CmdLin[a].bChecked(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdVisible=function(a){return this.CmdLin[a].bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdExpanded=function(a){return this.CmdLin[a].Expanded};CmdHandlerSrv.prototype.CmdCaption=function(a){return this.CmdLin[a].Caption};CmdHandlerSrv.prototype.CmdToolTip=function(a){return this.CmdLin[a].ToolTip};CmdHandlerSrv.prototype.CmdBadge=function(a){return this.CmdLin[a].iBadge};CmdHandlerSrv.prototype.CmdSetEnabled=function(a){return this.CmdSets[a].bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdSetVisible=function(a){return this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.CmdSetExpanded=function(a){return this.CmdSets[a].Expanded};CmdHandlerSrv.prototype.CmdSetCaption=function(a){return this.CmdSets[a].Caption};CmdHandlerSrv.prototype.CmdSetToolTip=function(a){return this.CmdSets[a].ToolTip};CmdHandlerSrv.prototype.CmdSetBadge=function(a){return this.CmdSets[a].iBadge};CmdHandlerSrv.prototype.CmdClick=function(f){var b=new IDVariant(0);var a=-1;var e=null;var d=this.CmdLin[f].Parent;for(var c=0;c<d.uCommands();c++){if(d.bCommands(c).Index==f){a=c;break}}if(this.CmdLin[f].Parent.IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,d.iGuid,188,"CmdHandler.CmdClick","MainFrm: Fire CmdSet "+d.Code+".OnCommand Event");this.MainFrm.OnCmdSetCommand(this.CmdLin[f].Parent,new IDVariant(f),new IDVariant(a),b)}else{e=this.MainFrm.GetFormByIndex(this.CmdLin[f].Parent.IdxForm,this.MainFrm.GetLiveForms());if(e!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,d.iGuid,188,"CmdHandler.CmdClick","Form "+e.Caption()+": Fire CmdSet "+d.Code+".OnCommand Event");e.OnCmdSetCommand(this.CmdLin[f].Parent,new IDVariant(f),new IDVariant(a),b)}}if(b.isFalse()){if(this.CmdLin[f].Parent.IdxForm==0){this.MainFrm.CmdClickCB(f)}else{if(e!=null){e.CmdClickCB(f)}}}};CmdHandlerSrv.prototype.CmdSetApplyRole=function(c,a,b){this.CmdSets[c].RoleEnabled=a;this.CmdSets[c].RoleVisible=b;this.CmdSets[c].RD3Change(RD3Glb.CMD_ENABLED);this.CmdSets[c].RD3Change(RD3Glb.CMD_VISIBLE)};CmdHandlerSrv.prototype.CommandApplyRole=function(b,a,c){this.CmdLin[b].RoleEnabled=a;this.CmdLin[b].RoleVisible=c;this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED);this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE)};CmdHandlerSrv.prototype.UserEvent=function(c){if(c.equals(".")){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddTestItem("ERROR",DTTEngine.TST_ERROR,"Error back button detected","")}return}var j=parseInt(c.substr(1),10);if(j>0){switch(c.charAt(0)){case"S":if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[j].iGuid,9,"CmdHandler.UserEvent",(this.CmdSets[j].Expanded?"Collapse":"Expand")+" menu command "+this.CmdSets[j].Caption);this.MainFrm.DTTObj.SetRequestName((this.CmdSets[j].Expanded?"Collapse":"Expand")+" Menu ",(this.CmdSets[j].Expanded?"Collapse":"Expand")+" Menu "+this.CmdSets[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdSets[j].iGuid,DTTEngine.TST_CMDSET,"Command set "+this.CmdSets[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(this.CmdSets[j].Expanded?"Chiudi":"Apri")+" il menu "+this.CmdSets[j].Caption)}var b=this.CmdSets[j].Expanded;this.set_CmdSetExpanded(j,!this.CmdSets[j].Expanded);if(this.CmdSets[j].Expanded==b&&this.CmdSets[j].ExpandEventDef==RD3Glb.EVENT_ACTIVE){this.CmdSets[j].RD3Change(RD3Glb.CMD_EXPANDED)}break;case"M":if(this.CmdLin[j].uCommands()==0){var a=this.MainFrm.ActiveFormIdx();if(this.CmdLin[j].Parent!=null){if(this.CmdLin[j].Parent.IdxForm!=a){if(!this.MainFrm.ParamsObj().UseRD3){var h=this.MainFrm.DockedForm();if(h!=null){a=h.FormIdx}}else{for(var d=0;d<this.MainFrm.StackForm.Count();d++){var h=this.MainFrm.StackForm[d];if(h.Docked&&this.CmdLin[j].Parent.IdxForm==h.FormIdx){a=h.FormIdx;break}}}}if(this.CmdLin[j].Parent.IdxForm!=a){var g=new ArrayList();for(var d=0;d<this.MainFrm.StackForm.Count();d++){var h=this.MainFrm.StackForm[d];if(h.Docked||h==this.MainFrm.ActiveForm()){h.GetSubForm(g)}}for(var d=0;d<g.Count();d++){var h=g[d];if(this.CmdLin[j].Parent.IdxForm==h.FormIdx){a=h.FormIdx;break}}}}if(this.CmdLin[j].bVisible(a)&&this.CmdLin[j].bEnabled(a)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdLin[j].iGuid,10,"CmdHandler.UserEvent","Command "+this.CmdLin[j].Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+this.CmdLin[j].Caption,"Menu "+this.CmdLin[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdLin[j].iGuid,DTTEngine.TST_CMD,"Command "+this.CmdLin[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+this.CmdLin[j].Caption)}this.CmdClick(j)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.CmdLin[j].iGuid,11,"CmdHandler.UserEvent","Command "+this.CmdLin[j].Caption+" either invisible or disabled")}}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdLin[j].iGuid,9,"CmdHandler.UserEvent",(this.CmdLin[j].Expanded?"Collapse":"Expand")+" menu command "+this.CmdLin[j].Caption);this.MainFrm.DTTObj.SetRequestName((this.CmdLin[j].Expanded?"Collapse":"Expand")+" Menu ",(this.CmdLin[j].Expanded?"Collapse":"Expand")+" Menu "+this.CmdLin[j].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.CmdLin[j].iGuid,DTTEngine.TST_CMDSET,"Command set "+this.CmdLin[j].Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(this.CmdLin[j].Expanded?"Chiudi":"Apri")+" il menu "+this.CmdLin[j].Caption)}var e=this.CmdLin[j].Expanded;this.set_CmdExpanded(j,!this.CmdLin[j].Expanded);if(this.CmdLin[j].Expanded==e&&this.CmdLin[j].ExpandEventDef==RD3Glb.EVENT_ACTIVE){this.CmdLin[j].RD3Change(RD3Glb.CMD_EXPANDED)}}break}}};CmdHandlerSrv.prototype.ProcessRequest=function(f,d,a){for(var b=0;b<=this.CmdSets[f].MaxCommands();b++){var g=this.CmdSets[f].Commands(b);var e=a.GetParameter("M"+g.Index);if(e!=null&&e.length>0){if(g.bVisible(d.FormIdx)&&g.bEnabled(d.FormIdx)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,g.iGuid,17,"CmdHandler.ProcessRequest","Command "+g.Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+g.Caption,"Menu "+g.Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(g.iGuid,DTTEngine.TST_CMD,"Command "+g.Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+g.Caption)}d.CmdClickCB(g.Index)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,g.iGuid,18,"CmdHandler.ProcessRequest","Command "+g.Caption+" either invisible or disabled")}}}}};CmdHandlerSrv.prototype.IsToolbarPresent=function(){for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]==null){continue}if(this.CmdSets[a].IsToolbar&&this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())&&this.CmdSets[a].ToolCont==-1){return true}}return false};CmdHandlerSrv.prototype.IsMenuPresent=function(){if(this.iSuppressMenu){return false}for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]==null){continue}if(this.CmdSets[a].IsMenu&&this.CmdSets[a].bVisible(this.MainFrm.ActiveFormIdx())){return true}}return false};CmdHandlerSrv.prototype.HasCaptionToolbar=function(b,d,a){for(var c=1;c<this.CmdSets.length;c++){if(this.CmdSets[c]==null){continue}if(this.CmdSets[c].IsToolbar&&this.CmdSets[c].IdxForm==b&&(this.CmdSets[c].ToolCont==d||(a!=null&&this.CmdSets[c].ToolContCode!=null&&this.CmdSets[c].ToolContCode.equals(a)))){this.CmdSets[c].ToolCont=d;this.CmdSets[c].RD3Change(RD3Glb.CMD_TOOLCONT);return 1}}return 0};CmdHandlerSrv.prototype.ProcessCaptionRequest=function(h,f,a){for(var d=1;d<this.CmdSets.length;d++){if(this.CmdSets[d]==null){continue}if(this.CmdSets[d].IsToolbar&&this.CmdSets[d].IdxForm==f.FormIdx&&this.CmdSets[d].ToolCont==h){for(var e=0;e<=this.CmdSets[d].MaxCommands();e++){var k=this.CmdSets[d].Commands(e);var g=a.GetParameter("M"+k.Index+".x");if(g!=null&&g.length>0){if(k.bVisible(f.FormIdx)&&k.bEnabled(f.FormIdx)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,k.iGuid,15,"CmdHandler.ProcessCaptionRequest","Command "+k.Caption+" received");this.MainFrm.DTTObj.SetRequestName("Menu "+k.Caption,"Menu "+k.Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(k.iGuid,DTTEngine.TST_CMD,"Command "+k.Caption+" action","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Clicca sulla voce di menu "+k.Caption)}var b=new IDVariant(0);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,188,"CmdHandler.ProcessCaptionRequest","Form "+f.Caption()+": Fire CmdSet "+this.CmdSets[d].Code+".OnCommand Event")}f.OnCmdSetCommand(this.CmdSets[d],new IDVariant(k.Index),new IDVariant(e),b);if(b.isFalse()){f.CmdClickCB(k.Index)}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,k.iGuid,16,"CmdHandler.ProcessCaptionRequest","Command "+k.Caption+" either invisible or disabled")}}}}}}};CmdHandlerSrv.prototype.ResetRoles=function(a){for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].IdxForm==0&&this.CmdLin[b].uCommands()>0){this.CmdLin[b].RoleEnabled=a.GlbRoleCmdLinEnabled;this.CmdLin[b].RoleVisible=a.GlbRoleCmdLinEnabled;this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED)}}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null){continue}if(this.CmdSets[b].IdxForm==0&&this.CmdSets[b].uCommands()>0){this.CmdSets[b].RoleEnabled=a.GlbRoleCmdSetEnabled;this.CmdSets[b].RoleVisible=a.GlbRoleCmdSetEnabled;this.CmdSets[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdSets[b].RD3Change(RD3Glb.CMD_ENABLED)}}for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].IdxForm==0&&this.CmdLin[b].uCommands()==0){this.CmdLin[b].RoleEnabled=a.GlbRoleCommandEnabled;this.CmdLin[b].RoleVisible=a.GlbRoleCommandEnabled;this.CmdLin[b].RD3Change(RD3Glb.CMD_VISIBLE);this.CmdLin[b].RD3Change(RD3Glb.CMD_ENABLED)}}};CmdHandlerSrv.prototype.DTTTrace=function(a,d,f){if(this.CmdSets[d].IdxForm!=this.MainFrm.ActiveFormIdx()&&this.CmdSets[d].IdxForm!=0){return}var e=(!this.CmdSets[d].bEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bVisible(this.MainFrm.ActiveFormIdx()));if(!e){for(var b=0;b<this.CmdSets[d].uCommands();b++){if(!this.CmdSets[d].bCommands(b).IsEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())){e=true;break}}}if(!e){return}if(a.DTTObj.AddTraceItem(this.CmdSets[d].iGuid,f,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Render":"CommandSet.Render"),"")){var c="E="+(this.CmdSets[d].bEnabled(this.MainFrm.ActiveFormIdx())?-1:0)+" V="+(this.CmdSets[d].bVisible(this.MainFrm.ActiveFormIdx())?-1:0);a.DTTObj.AddTraceToken(this.CmdSets[d].iGuid,DTTEngine.TRC_CMDCAPTION,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Caption":"CommandSet.Caption"),this.CmdSets[d].Caption,c);for(b=0;b<this.CmdSets[d].uCommands();b++){if(!this.CmdSets[d].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())||!this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())){c="E="+(this.CmdSets[d].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())?-1:0)+" V="+(this.CmdSets[d].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())?-1:0);a.DTTObj.AddTraceToken(this.CmdSets[d].bCommands(b).iGuid,DTTEngine.TRC_CMDCOMMAND,(f==DTTEngine.TRC_ITBUTBAR?"ButtonBar.Button":"CommandSet.Cmd"),this.CmdSets[d].bCommands(b).Caption,c)}}}};CmdHandlerSrv.prototype.ExecCmdCode=function(b){for(var a=1;a<this.CmdLin.length;a++){if(this.CmdLin[a]==null){continue}if(this.CmdLin[a].CmdCode!=null&&this.CmdLin[a].CmdCode.equals(b)){if(CmdEnabled(a)){this.CmdClick(a);this.ShowMenu(a)}return true}}return false};CmdHandlerSrv.prototype.ShowMenu=function(f){var b=new Array(16);var g=this.CmdLin[f];var a=0;do{g=g.Parent;b[a++]=g;if(g!=null){if(!g.Expanded){g.Expand()}}}while(g!=null);for(var h=1;h<this.CmdSets.length;h++){if(this.CmdSets[h]==null){continue}var e=false;for(var d=0;d<a;d++){if(b[d]==this.CmdSets[h]){e=true;break}}if(!e&&this.CmdSets[h].Expanded){this.CmdSets[h].Expand()}}for(var h=1;h<this.CmdLin.length;h++){if(this.CmdLin[h]==null){continue}var e=false;for(var d=0;d<a;d++){if(b[d]==this.CmdLin[h]){e=true;break}}if(!e&&this.CmdLin[h].Expanded){this.CmdLin[h].Expand()}}};CmdHandlerSrv.prototype.GetIdx=function(a){return this.CmdLin[a].Index};CmdHandlerSrv.prototype.SetCmdCaption=function(b,c,a){if(!this.CmdSets[b].bCommands(c).Caption.equals(a)){this.CmdSets[b].bCommands(c).Caption=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_CAPTION)}};CmdHandlerSrv.prototype.GetCmdCaption=function(a,b){return this.CmdSets[a].bCommands(b).Caption};CmdHandlerSrv.prototype.SetCmdTooltip=function(b,c,a){if(!this.CmdSets[b].bCommands(c).ToolTip.equals(a)){this.CmdSets[b].bCommands(c).ToolTip=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_TOOLTIP)}};CmdHandlerSrv.prototype.GetCmdTooltip=function(a,b){return this.CmdSets[a].bCommands(b).ToolTip};CmdHandlerSrv.prototype.SetCmdIcon=function(b,c,a){if(this.CmdSets[b].bCommands(c).Image==null||!this.CmdSets[b].bCommands(c).Image.equals(a)){this.CmdSets[b].bCommands(c).Image=a;this.CmdSets[b].bCommands(c).RD3Change(RD3Glb.CMD_IMAGE)}};CmdHandlerSrv.prototype.GetCmdIcon=function(a,b){return this.CmdSets[a].bCommands(b).Image};CmdHandlerSrv.prototype.SetCmdVisible=function(b,c,a){this.CmdSets[b].bCommands(c).set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdVisible=function(a,b){return this.CmdSets[a].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdEnabled=function(b,c,a){this.CmdSets[b].bCommands(c).set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdEnabled=function(a,b){return this.CmdSets[a].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdCode=function(b,c,a){if(this.CmdSets[b].bCommands(c).CmdCode==null||!this.CmdSets[b].bCommands(c).CmdCode.equals(a)){this.CmdSets[b].bCommands(c).CmdCode=a}};CmdHandlerSrv.prototype.GetCmdCode=function(a,b){return this.CmdSets[a].bCommands(b).CmdCode};CmdHandlerSrv.prototype.GetCommandsCount=function(a){return this.CmdSets[a].uCommands()};CmdHandlerSrv.prototype.SetCmdCaption2=function(b,c,a){if(!this.CmdLin[b].bCommands(c).Caption.equals(a)){this.CmdLin[b].bCommands(c).Caption=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_CAPTION)}};CmdHandlerSrv.prototype.GetCmdCaption2=function(a,b){return this.CmdLin[a].bCommands(b).Caption};CmdHandlerSrv.prototype.SetCmdTooltip2=function(b,c,a){if(!this.CmdLin[b].bCommands(c).ToolTip.equals(a)){this.CmdLin[b].bCommands(c).ToolTip=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_TOOLTIP)}};CmdHandlerSrv.prototype.GetCmdTooltip2=function(a,b){return this.CmdLin[a].bCommands(b).ToolTip};CmdHandlerSrv.prototype.SetCmdIcon2=function(b,c,a){if(this.CmdLin[b].bCommands(c).Image==null||!this.CmdLin[b].bCommands(c).Image.equals(a)){this.CmdLin[b].bCommands(c).Image=a;this.CmdLin[b].bCommands(c).RD3Change(RD3Glb.CMD_IMAGE)}};CmdHandlerSrv.prototype.GetCmdIcon2=function(a,b){return this.CmdLin[a].bCommands(b).Image};CmdHandlerSrv.prototype.SetCmdVisible2=function(b,c,a){this.CmdLin[b].bCommands(c).set_bVisible(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdVisible2=function(a,b){return this.CmdLin[a].bCommands(b).bVisible(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdEnabled2=function(b,c,a){this.CmdLin[b].bCommands(c).set_bEnabled(this.MainFrm.ActiveFormIdx(),a)};CmdHandlerSrv.prototype.GetCmdEnabled2=function(a,b){return this.CmdLin[a].bCommands(b).bEnabled(this.MainFrm.ActiveFormIdx())};CmdHandlerSrv.prototype.SetCmdCode2=function(b,c,a){if(this.CmdLin[b].bCommands(c).CmdCode==null||!this.CmdLin[b].bCommands(c).CmdCode.equals(a)){this.CmdLin[b].bCommands(c).CmdCode=a}};CmdHandlerSrv.prototype.GetCmdCode2=function(a,b){return this.CmdLin[a].bCommands(b).CmdCode};CmdHandlerSrv.prototype.GetCommandsCount2=function(a){return this.CmdLin[a].uCommands()};CmdHandlerSrv.prototype.OpenPopup=function(d,g,c,h,e,a){if(a==undefined){a=null}var b=this.MainFrm.ActiveForm();if(a!=null&&a instanceof WebFormSrv){b=a}if(b!=null){if(c>=0&&h>=0){this.ShowPopup(d,"F"+c+"C"+h+"R"+e,b.FormIdx,g)}else{this.ShowPopup(d,null,b.FormIdx,g)}}};CmdHandlerSrv.prototype.ShowPopup=function(g,c,f,q){if(q==undefined){q=1}if(f==undefined){f=-1}if(typeof(f)=="number"){if(c==null){var k;if(f>0){k=this.MainFrm.GetFormByIndex(f,this.MainFrm.GetLiveForms())}else{k=this.MainFrm.ActiveForm()}if(k!=null){c=this.MainFrm.ActiveForm().ActiveElement}else{c=""}}var r=new IDVariant(0);var d=new IDVariant(q);this.FireOnOpenPopup(g,f,d,r);if(r.isFalse()){this.MainFrm.MenuIdx=g+":"+c+":"+f+"|"+d.intValue();var h=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());h.SetAttribute("dir",d.toString());h.SetAttribute("form","frm:"+f);var l="";if(c.startsWith("M")){var e=parseInt(c.substr(1),10);c=this.CmdLin[e].GetRD3Ident();l="menu"}if(c.startsWith("F")){var a=c.indexOf("B");if(a>-1){l="box";c=l+":"+c.substr(a)+":"+c.substr(1,a-1)+":"+f.toString()}a=c.indexOf("C");if(a>-1){var o=c.indexOf("R");var j=parseInt(c.substr(o+1),10);if(!isNaN(j)){l="fld";c=l+":"+c.substr(a+1,o-a-1)+":"+c.substr(1,a-1)+":"+f.toString();var b=this.MainFrm.RD3FindField(c);if(b!=null){if(b.IdxPanel>=0){l="val";c=l+":"+(j+1)+":"+b.Index+":"+b.Parent.FrIndex+":"+b.Parent.Parent.FormIdx}}}}}if(c.startsWith("A")){var a=c.indexOf("C");if(a>-1){var o=c.indexOf("R");l="fld";c=l+":"+c.substr(a+1,o-a-1)+":"+c.substr(1,a-1)+":"+f.toString()}}h.SetAttribute("objid",c);h.SetAttribute("objtype",l)}}else{if(typeof(f)=="object"){var m=f;var r=new IDVariant(0);var d=new IDVariant(q);var f=((m instanceof WebFormSrv)?m.FormIdx:0);this.FireOnOpenPopup(g,f,d,r);if(r.isFalse()){var h=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());h.SetAttribute("dir",d.toString());h.SetAttribute("objid",c)}}}};CmdHandlerSrv.prototype.ShowPopupXY=function(g,f,b,h){var c=new IDVariant(0);var d=new IDVariant(0);var a=((f instanceof WebFormSrv)?f.FormIdx:0);this.FireOnOpenPopup(g,a,d,c);if(c.isFalse()){var e=this.MainFrm.RD3AddEvent("popup",this.CmdSets[g].GetRD3Ident());e.SetAttribute("dir",d.toString());e.SetAttribute("xpos",b.toString());e.SetAttribute("ypos",h.toString())}};CmdHandlerSrv.prototype.FireOnOpenPopup=function(d,a,e,b){if(this.CmdSets[d].IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,187,"CmdHandler.FireOnOpenPopup","MainFrm: Fire CmdSet "+this.CmdSets[d].Code+".OnOpenPopup Event");this.MainFrm.OnOpenPopup(this.CmdSets[d],e,b)}else{var c;if(a>0){c=this.MainFrm.GetFormByIndex(a,this.MainFrm.GetLiveForms())}else{c=this.MainFrm.ActiveForm()}if(c!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.CmdSets[d].iGuid,187,"CmdHandler.FireOnOpenPopup","Form "+c.Caption()+": Fire CmdSet "+this.CmdSets[d].Code+".OnOpenPopup Event");c.OnOpenPopup(this.CmdSets[d],e,b)}}};CmdHandlerSrv.prototype.AutoCollapse=function(d){if(!d.Expanded&&d.Level<=this.MainFrm.MenuAutoCollapse){var a=new ArrayList();var c=d.Parent;while(c!=null){a.Add(c);c=c.Parent}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null){continue}this.CollapseButThose(this.CmdSets[b],a)}}};CmdHandlerSrv.prototype.CollapseButThose=function(b,c){if(b.Expanded){if(!c.Contains(b)){b.Expand()}else{for(var a=0;a<b.iCommands.length;a++){this.CollapseButThose(b.iCommands[a],c)}}}};CmdHandlerSrv.prototype.GetCommandByCode=function(a){for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].CmdCode!=null&&this.CmdLin[b].CmdCode.equals(a)){return this.CmdLin[b]}}return null};CmdHandlerSrv.prototype.OpenMultipleFormCS=function(e,g){var d=e&65535;var f=0;var a=0;for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]!=null&&this.CmdSets[b].IdxForm==d){if(f==0){f=b}a++}}if(a==0){return 0}for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]!=null&&this.CmdSets[b].IdxForm==e){return b-f}}var c=Glb.GetObjects(this.CmdSets,a);if(c==0){c=this.CmdSets.length;Array.resize(this.CmdSets,c+a)}for(var b=a-1;b>=0;b--){this.CmdSets[c+b]=new ACommandSrv();this.CmdSets[c+b].CopyFrom(this.CmdSets[f+b],g,e);this.CmdSets[c+b].Index=c+b}return c-f};CmdHandlerSrv.prototype.OpenMultipleFormCL=function(l,a){var j=l&65535;var e=0;for(var d=1;d<this.CmdLin.length;d++){var g=false;var b=this.CmdLin[d];while(b!=null){if(b.IdxForm==j){g=true;break}b=b.Parent}if(g){e=d;break}}for(var f=1;f<this.CmdLin.length;f++){var g=false;var b=this.CmdLin[f];while(b!=null){if(b.IdxForm==l){g=true;break}b=b.Parent}if(g){return f-e}}if(a.Count()==0){return 0}var k=Glb.GetObjects(this.CmdLin,a.Count());if(k==0){k=this.CmdLin.length;Array.resize(this.CmdLin,k+a.Count())}for(var d=0;d<a.Count();d++){var h=a[d];this.CmdLin[k+d]=h;h.Index=k+d}return k-e};CmdHandlerSrv.prototype.CloseMultipleForm=function(c){for(var a=1;a<this.CmdLin.length;a++){if(this.CmdLin[a]!=null){var d=false;var b=this.CmdLin[a];while(b!=null){if(b.IdxForm==c){d=true;break}b=b.Parent}if(d){this.CmdLin[a]=null}}}for(var a=1;a<this.CmdSets.length;a++){if(this.CmdSets[a]!=null&&this.CmdSets[a].IdxForm==c){this.CmdSets[a]=null}}};CmdHandlerSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()};CmdHandlerSrv.prototype.GetRD3Name=function(){return"cmh"};CmdHandlerSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};CmdHandlerSrv.prototype.RD3RenderDifferences=function(e,l,j){var b=null;if(l){b=e.AddNewElement(this.GetRD3Ident())}if(b==null&&this.RD3Changed){b=e.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var k=this.RD3Changed;if(l||this.RD3Changed){for(var d=0;d<this.RD3PropChg.length;d++){if(this.RD3PropChg[d]||l){this.SetRD3Property(d,b,l)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(l){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(this.SuppressMenuAnimationDef!=null){b.SetAttribute("sma",this.SuppressMenuAnimationDef)}}var c=(l)?b:e;for(var d=this.CmdSets.length-1;d>=1;d--){var h=this.CmdSets[d];if(h==null){continue}if(j>0&&h.IdxForm!=j){continue}if(h.IsMenu){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITMENU)}else{if(h.IsToolbar&&h.ToolCont==-1){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITTOOLBAR)}else{if(h.IsToolbar){var a=false;if(this.MainFrm.ActiveForm()!=null&&h.IdxForm==this.MainFrm.ActiveForm().FormIdx){a=true}for(var m=0;m<this.MainFrm.StackForm.Count();m++){var g=this.MainFrm.StackForm[m];if(g.Docked&&g.FormIdx==h.IdxForm){a=true;break}}if(a){this.DTTTrace(this.MainFrm,d,DTTEngine.TRC_ITCAPTBAR)}}}}k|=h.RD3RenderDifferences(c,l)}if(!l&&b!=null){e.RemoveNode(b);e.GetNode().appendChild(b.GetNode())}return k};CmdHandlerSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.CMH_SUPPRMENU:if(!this.iSuppressMenu&&b){break}c.SetAttribute("sup",this.iSuppressMenu?"1":"0");break}};CmdHandlerSrv.prototype.GenericDrag=function(c,a,h){var l=-1;var g=a.Parent;for(var e=0;e<g.uCommands();e++){if(g.bCommands(e).Index==a.Index){l=e;break}}var k=new IDVariant();if(a.Parent.IdxForm==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.iGuid,188,"CmdHandler.GenericDrag","MainFrm: Fire CmdSet "+a.Parent.Code+".OnGenericDrag Event");this.MainFrm.OnCmdSetGeneralDrag(a.Parent,k,new IDVariant(a.Index),new IDVariant(l))}else{var j=this.MainFrm.GetFormByIndex(a.Parent.IdxForm,this.MainFrm.GetLiveForms());if(j!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.iGuid,188,"CmdHandler.GenericDrag","Form "+j.Caption()+": Fire CmdSet "+a.Parent.Code+".GenericDrag Event");j.OnCmdSetGeneralDrag(a.Parent,k,new IDVariant(a.Index),new IDVariant(l))}}if(h instanceof WebFrameSrv){var b=h;var d=c.GetAttribute("oid");if(d.startsWith("tab")&&b.Parent!=null&&b.FrIndex>-1&&b.Parent.Frames[b.FrIndex].InTabbed&&b.Parent.Frames[b.Parent.Frames[b.FrIndex].TabIdx]!=null){var f=b.Parent.Frames[b.Parent.Frames[b.FrIndex].TabIdx].Content;f.GenericDrop(c,k)}else{b.GenericDrop(c,k)}}if(h instanceof ACommandSrv){this.GenericDrop(h,k)}};CmdHandlerSrv.prototype.GenericDrop=function(b,a){var c=-1;var f=b.Parent;for(var d=0;d<f.uCommands();d++){if(f.bCommands(d).Index==b.Index){c=d;break}}if(b.Parent.IdxForm==0){this.MainFrm.DTTObj.SetRequestName("Generic Drop","CmdSet"+b.Parent.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.iGuid,188,"Acommand.GenericDrop","MainFrm: Fire CmdSet "+b.Parent.Code+".OnGenericDrop Event");this.MainFrm.OnCmdSetGeneralDrop(b.Parent,a,new IDVariant(b.Index),new IDVariant(c))}else{var e=this.MainFrm.GetFormByIndex(b.Parent.IdxForm,this.MainFrm.GetLiveForms());if(e!=null){this.MainFrm.DTTObj.SetRequestName("Generic Drop","CmdSet"+b.Parent.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.iGuid,188,"CmdHandler.GenericDrop","Form "+e.Caption()+": Fire CmdSet "+b.Parent.Code+".OnGenericDrop Event");e.OnCmdSetGeneralDrop(b.Parent,a,new IDVariant(b.Index),new IDVariant(c))}}};CmdHandlerSrv.prototype.GetCommandSets=function(b){var a=new IDArray();for(var c=1;c<this.CmdSets.length;c++){if(this.CmdSets[c]!=null&&this.CmdSets[c].IdxForm==b){a.add_Object(this.CmdSets[c])}}return a};CmdHandlerSrv.prototype.GetCommandByDBCode=function(a){for(var b=1;b<this.CmdSets.length;b++){if(this.CmdSets[b]==null||this.CmdSets[b].Code==null){continue}if(this.CmdSets[b].Code.equals(a)){return this.CmdSets[b]}}for(var b=1;b<this.CmdLin.length;b++){if(this.CmdLin[b]==null){continue}if(this.CmdLin[b].Code.equals(a)){return this.CmdLin[b]}}return null};CmdHandlerSrv.prototype.GenericCmdExpanded=function(a){if(a.uCommands()==0){return false}if(a.Level==1){return this.CmdSetExpanded(a.Index)}else{return this.CmdExpanded(a.Index)}};CmdHandlerSrv.prototype.set_GenericCmdExpanded=function(b,a){if(b.uCommands()==0){return}if(b.Level==1){this.set_CmdSetExpanded(b.Index,a)}else{this.set_CmdExpanded(b.Index,a)}};CmdHandlerSrv.prototype.CommandClick=function(a){if(a.uCommands()>0){return}this.CmdClick(a.Index)};function KnownErrors(){this.Header="";this.ErrCode=new Array(Glb.DBT_MAXDBTYPES);this.Description="";this.Effect="";this.Actions="";this.DBOper=0;this.Context=""}function ErrorHandlerSrv(c){this.UnexpectedApplicationTSA;this.UnexpectedDatabaseTSA;this.KnownErrorTSA;this.KErrors=new Array(6);this.TechSuppType=0;this.MainFrm=c;this.ErrorNumber;this.ErrorDescription;this.ErrorSource;this.ErrorConnection;this.ErrorDBOper;this.ErrorDBType;this.ErrorException;this.ErrorHeader;this.ErrorEffects;this.ErrorActions;this.flIsError;this.Semaphore=false;for(var b=0;b<this.KErrors.length;b++){this.KErrors[b]=new KnownErrors();for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-1}}}ErrorHandlerSrv.prototype.Init=function(){var b=-1;this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("334D5951-7BAD-4444-B5AB-D271A1942991","Errore imprevisto");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("AA37ED80-4FFF-4e69-BD4F-65ECA1ADE181","L'operazione non può essere completata.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("FE1CECD1-2FB4-4291-B10C-FCB3093D893F","1) Controlla i dati inseriti e riprova.<BR>2) Riprova più tardi.<BR>3) Richiedi supporto tecnico.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("EB82C1FF-6FBC-41b2-8630-3A55100F9AB3","Dati duplicati");this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=2627;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=2627;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=1;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=1;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=0;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-105121349;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("1A413AF1-8D5E-4906-A3CC-D3BFF0D6A2C8","Esiste già un'altra riga con gli stessi dati identificativi. ");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("043D1E3B-32D8-4485-A38E-C5147F4AB4DA","Non posso inserire o aggiornare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("A7B5392D-F82C-409f-AE7D-AD89A7E82E26","Cambia i valori dei dati identificativi della riga e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("7AD9B3CC-771A-4005-A242-4794C53BA7F1","Rilevati dati collegati");this.KErrors[b].DBOper=Glb.PANOP_DELETE;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=547;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=2292;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=2292;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=-1612;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-534971980;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("256A93D4-7C6C-452d-BF48-0D6E774B84D1","Il database contiene altri dati collegati a quello in fase di cancellazione.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("607A5133-84B2-44fb-9514-A72D1BF8DFBC","Non posso cancellare la riga richiesta.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("275B7DA0-2153-42fb-B52F-5883456BB99A","Cancella prima gli altri dati collegati e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("6EEB0870-47CD-4e2f-99B7-69F8464B42FB","Dati correlati inesistenti");this.KErrors[b].ErrCode[Glb.DBI_SQLSRV6]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV7]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV2K]=547;this.KErrors[b].ErrCode[Glb.DBI_SQLSRV05]=547;this.KErrors[b].ErrCode[Glb.DBI_ORACLE7]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE8]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE9]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE10]=2291;this.KErrors[b].ErrCode[Glb.DBI_ORACLE11]=2291;this.KErrors[b].ErrCode[Glb.DBI_ACCESS97]=-1613;this.KErrors[b].ErrCode[Glb.DBI_ACCESS2K]=-535037517;this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("6FF4CBF8-AD34-4acc-BC3C-6740453DEEAC","Il database non contiene i dati correlati indicati.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("B40AE904-E285-48a9-AA11-A3E993732B91","Non posso inserire o aggiornare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("8307D495-E052-402d-98C7-7AE3CB83671B","Modifica i valori dei dati correlati, oppure inserisci i nuovi dati correlati richiesti nelle relative videate.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("6E900A2B-70E6-4b12-B066-4E5AD1A1C5BB","Errore nei parametri di ricerca!");for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-542379020}this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("A981150D-E216-4bf3-B769-B0F025AE18A8","I parametri di ricerca contengono dati errati.");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("A158B32B-223C-425a-8B79-2C3EF75DF67C","Non posso cercare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("8599406C-D202-4afe-8551-E0BB65DA2440","Controlla i parametri di ricerca e riprova.");this.KErrors[++b].Header=this.MainFrm.RTCObj.GetConst("1F9BDBA6-A602-4342-A5C6-240594AA7C7A","Dati già modificati!");for(var a=0;a<Glb.DBT_MAXDBTYPES;a++){this.KErrors[b].ErrCode[a]=-100001}this.KErrors[b].Description=this.MainFrm.RTCObj.GetConst("9F5D6236-FBC3-47d2-A012-F74A66DFCE25","La riga in fase di modifica era già stata cambiata da un altro utente");this.KErrors[b].Effect=this.MainFrm.RTCObj.GetConst("BF6E4F9F-21AC-40d6-A132-E80DA8B28DCC","Non posso modificare i dati come richiesto.");this.KErrors[b].Actions=this.MainFrm.RTCObj.GetConst("095FFFB6-27B2-406f-9CC3-F0CBB361221E","Riesegui la ricerca in modo da vedere i nuovi dati, poi sarà possibile modificarli.")};ErrorHandlerSrv.prototype.Render3=function(b){this.DTTTrace(this.MainFrm);b.SetAttribute("hdr",this.ErrorHeader);b.SetAttribute("num",this.ErrorNumber.toString());b.SetAttribute("des",this.ErrorDescription);b.SetAttribute("eff",this.ErrorEffects);b.SetAttribute("act",this.ErrorActions);b.SetAttribute("src",this.ErrorSource);if(this.ErrorException!=null&&this.MainFrm.ParamsObj().ICDebug==1){if(this.ErrorException!=null&&this.ErrorException.message!=this.ErrorDescription){b.SetAttribute("erm",this.ErrorException.message)}var a=this.ErrorException.stack;b.SetAttribute("exc",a)}};ErrorHandlerSrv.prototype.ClearError=function(){this.flIsError=false};ErrorHandlerSrv.prototype.IsError=function(){return this.flIsError};ErrorHandlerSrv.prototype.PanelError=function(d,f,a,b,c,g){WriteToConsoleError(g);this.GetErrorParam(f,a,b,c,g,d.GetRTCGuid(Glb.OBJ_PANEL,0));this.MainFrm.TraceError(g)};ErrorHandlerSrv.prototype.ProcError=function(a,c,b){WriteToConsoleError(b);this.GetErrorParam(null,0,0,a+" - "+c,b,"");this.MainFrm.TraceError(b)};ErrorHandlerSrv.prototype.GetErrorParam=function(r,s,b,l,t,o){if(this.Semaphore){return}this.ErrorNumber=0;this.ErrorDescription=null;this.ErrorException=t;if(t!=null){this.ErrorDescription=t.message;this.ErrorNumber=ErrorHandlerSrv.GetErrorNumber(t)}this.ErrorSource=l;this.ErrorConnection=r;this.ErrorDBOper=b;this.ErrorDBType=s;var a=0;var m=this.ErrorDBType;while(m>0){a=a+1;m=m>>1}var v=-1;for(var q=0;q<this.KErrors.length;q++){if(this.KErrors[q].ErrCode[a]==this.ErrorNumber&&(this.KErrors[q].DBOper==0||this.KErrors[q].DBOper==this.ErrorDBOper)&&(this.KErrors[q].Context==null||this.KErrors[q].Context.length==0||this.Context.equals(this.KErrors[q].Context))){v=q;this.ErrorHeader=this.KErrors[v].Header;this.ErrorEffects=this.KErrors[v].Effect;this.ErrorActions=this.KErrors[v].Actions;this.ErrorDescription=this.KErrors[v].Description;break}}if(v==-1){for(var q=0;q<this.KErrors.length;q++){for(var p=0;p<Glb.DBT_MAXDBTYPES;p++){if(this.KErrors[q].ErrCode[p]!=-1){break}}if(p==Glb.DBT_MAXDBTYPES&&(this.KErrors[q].Context==null||this.KErrors[q].Context.length==0||o.equals(this.KErrors[q].Context))){v=q}switch(this.ErrorDBOper){case Glb.PANOP_FIND:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("FCFC62DA-1CEA-4300-817C-7A1701CC8A22","Non posso cercare i dati.",true);break;case Glb.PANOP_DELETE:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("0B6EDF83-52B0-4706-B249-F15FBC0B6347","Non posso cancellare la riga selezionata.",true);break;case Glb.PANOP_UPDATE:this.ErrorEffects=this.MainFrm.RTCObj.GetConst("DB2DD729-2623-43BB-95E5-93606D10A4DB","Non posso inserire o aggiornare i dati.",true);break;default:if(v!=-1){this.ErrorEffects=this.KErrors[v].Effect}break}if(v!=-1){this.ErrorHeader=this.KErrors[v].Header;this.ErrorActions=this.KErrors[v].Actions}}}if(this.ErrorHeader==null){this.ErrorHeader=""}if(this.ErrorActions==null){this.ErrorActions=""}if(this.ErrorEffects==null){this.ErrorEffects=""}var d=new IDVariant(this.ErrorHeader);var k=new IDVariant(this.ErrorNumber);var f=new IDVariant(this.ErrorDescription);var g=new IDVariant(this.ErrorEffects);var h=new IDVariant(this.ErrorActions);var c=new IDVariant(this.ErrorSource);var w=new IDVariant(false);this.Semaphore=true;this.MainFrm.OnException(d,k,f,g,h,c,w);this.Semaphore=false;if(!w.booleanValue()){this.ErrorHeader=d.stringValue();this.ErrorNumber=k.intValue();this.ErrorDescription=f.stringValue();this.ErrorEffects=g.stringValue();this.ErrorActions=h.stringValue();this.ErrorSource=c.stringValue();this.flIsError=true;var u=this.MainFrm.RD3AddEvent("error","");u.CanSendInFulltree=true}};ErrorHandlerSrv.prototype.ShowMessage=function(f,j,a,g,b,c,e,d){this.ErrorHeader=f;this.ErrorNumber=j;this.ErrorDescription=a;this.ErrorEffects=g;this.ErrorActions=b;this.ErrorSource=c;this.flIsError=true;var h=this.MainFrm.RD3AddEvent("error","");h.CanSendInFulltree=true};ErrorHandlerSrv.prototype.ConfigureErrorMessages=function(c){this.KErrors=new Array(c.RecordCount());for(var b=0;b<this.KErrors.length;b++){this.KErrors[b]=new KnownErrors()}try{var d=0;while(!c.EOF()){this.KErrors[d].Actions=c.Get("RTC_Actions").stringValue();this.KErrors[d].Context=c.Get("RTC_Context").stringValue();this.KErrors[d].DBOper=c.Get("RTC_DBOper").intValue();this.KErrors[d].Description=c.Get("RTC_Description").stringValue();this.KErrors[d].Effect=c.Get("RTC_Effect").stringValue();this.KErrors[d].Header=c.Get("RTC_Header").stringValue();for(var b=1;b<Glb.DBT_MAXDBTYPES;b++){this.KErrors[d].ErrCode[b]=-1;var a=c.Get("RTC_ErrCode"+(b));if(a.Type!=IDVariant.NULL){this.KErrors[d].ErrCode[b]=a.intValue()}}d++;c.MoveNext()}}catch(f){WriteToConsoleError(f)}};ErrorHandlerSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem("",DTTEngine.TRC_ITERROR,"Error.Render","")){a.DTTObj.AddTraceToken("",DTTEngine.TRC_ERRNUMBER,"Number",this.ErrorNumber,"");a.DTTObj.AddTraceToken("",DTTEngine.TRC_ERRDESCR,"Description",this.ErrorDescription,"")}};ErrorHandlerSrv.GetErrorNumber=function(a){return a.code};function Glb(){}Glb.FKMaxNum=12;Glb.GlbRefModIdx=1;Glb.ITEM_MENU="IWMenu";Glb.ITEM_SBIND="IWSbInd";Glb.ITEM_FORM="IWForm";Glb.ITEM_BLOB="IWBlob";Glb.ITEM_FORMLIST="IWFormList";Glb.ITEM_UPLOAD="IWUpload";Glb.ITEM_FILES="IWFiles";Glb.ITEM_TREE_EXP="IWTreeExp";Glb.ITEM_TREE_CLICK="IWTreeClick";Glb.ITEM_TREE_DROP="IWTreeDrop";Glb.ITEM_GRAPH_CLICK="IWGraphClick";Glb.ITEM_APP="IWApp";Glb.ITEM_LOGIN="IWLogin";Glb.ITEM_LOGOFF="IWLogoff";Glb.ITEM_DTT="IWDTT";Glb.ITEM_TEST="IWTest";Glb.ITEM_HELP="IWHelp";Glb.ITEM_FRAMES="IWFrames";Glb.ITEM_RD="IWRD";Glb.ITEM_RD3="RD3";Glb.ITEM_W3C="IW3C";Glb.ITEM_STREAM="IWStream";Glb.ITEM_SYNC="SYNC";Glb.ITEM_OWA="OWA";Glb.ITEM_OAUTH="OAUTH";Glb.ROI_COMMAND=1;Glb.ROI_CMDSET=2;Glb.ROI_PFIELD=3;Glb.ROI_PPAGE=4;Glb.ROI_PGROUP=5;Glb.ROI_PANEL=6;Glb.ROI_TREEITEM=7;Glb.ROI_QRYWL=8;Glb.ROI_REPORT=9;Glb.ROI_SECTION=10;Glb.ROI_RPTBOX=11;Glb.ROI_RPTSPAN=12;Glb.ROI_OBJECT=13;Glb.DBT_ACCESS97=1;Glb.DBT_ORACLE7=2;Glb.DBT_ORACLE8=4;Glb.DBT_SQLSRV6=8;Glb.DBT_SQLSRV7=16;Glb.DBT_ODBC=32;Glb.DBT_ACCESS2K=64;Glb.DBT_SQLSRV2K=128;Glb.DBT_SQLSRV05=256;Glb.DBT_ORACLE9=512;Glb.DBT_ORACLE10=1024;Glb.DBT_ORACLE11=2048;Glb.DBT_DB2400=4096;Glb.DBT_DB2UDB=8192;Glb.DBT_POSTG8=16384;Glb.DBT_MYSQL5=32768;Glb.DBT_SQLITE=65536;Glb.DBI_ACCESS97=1;Glb.DBI_ORACLE7=2;Glb.DBI_ORACLE8=3;Glb.DBI_SQLSRV6=4;Glb.DBI_SQLSRV7=5;Glb.DBI_ODBC=6;Glb.DBI_ACCESS2K=7;Glb.DBI_SQLSRV2K=8;Glb.DBI_SQLSRV05=9;Glb.DBI_ORACLE9=10;Glb.DBI_ORACLE10=11;Glb.DBI_ORACLE11=12;Glb.DBI_DB2400=13;Glb.DBI_DB2UDB=14;Glb.DBI_POSTG8=15;Glb.DBI_MYSQL5=16;Glb.DBI_SQLITE=17;Glb.DBT_MAXDBTYPES=18;Glb.DBC_ACCESS=(Glb.DBT_ACCESS97|Glb.DBT_ACCESS2K);Glb.DBC_ORACLE=(Glb.DBT_ORACLE7|Glb.DBT_ORACLE8|Glb.DBT_ORACLE9|Glb.DBT_ORACLE10|Glb.DBT_ORACLE11);Glb.DBC_ODBC=(Glb.DBT_ODBC);Glb.DBC_SQLSRV=(Glb.DBT_SQLSRV6|Glb.DBT_SQLSRV7|Glb.DBT_SQLSRV2K|Glb.DBT_SQLSRV05);Glb.DBC_DB2=(Glb.DBT_DB2400|Glb.DBT_DB2UDB);Glb.DBC_POSTGRES=(Glb.DBT_POSTG8);Glb.DBC_MYSQL=(Glb.DBT_MYSQL5);Glb.DBC_SQLITE=(Glb.DBT_SQLITE);Glb.OBJ_RECT=-2;Glb.OBJ_PANEL=-1;Glb.OBJ_PAGE=0;Glb.OBJ_GROUP=1;Glb.OBJ_FIELD=2;Glb.OBJ_QUERY=3;Glb.RESMODE_NONE=1;Glb.RESMODE_MOVE=2;Glb.RESMODE_STRETCH=3;Glb.FRESMODE_NONE=1;Glb.FRESMODE_EXTEND=2;Glb.FRESMODE_STRETCH=3;Glb.PAN_QBEFORM=65536;Glb.PAN_SCROLLREC=131072;Glb.PAN_HASFORM=262144;Glb.PAN_HASLIST=524288;Glb.PAN_STARTFORM=1048576;Glb.PAN_CANUPDATE=2097152;Glb.PAN_CANDELETE=4194304;Glb.PAN_CANINSERT=8388608;Glb.PAN_CANSELECT=16777216;Glb.PAN_AUTOSAVE=33554432;Glb.PAN_USERETURN=32768;Glb.PAN_USETAB=16384;Glb.PAN_CANSORT=8192;Glb.PAN_SORTALWAYS=4096;Glb.PAN_LIKESEARCH=1024;Glb.PAN_NEWINSMODE=512;Glb.PAN_FREEWHENHID=256;Glb.PS_NONE=0;Glb.PS_QBE=1;Glb.PS_DATA=2;Glb.PS_UPDATE=3;Glb.INITST_SEARCH=1;Glb.INITST_DATA=2;Glb.INITST_INSERT=3;Glb.INITST_NEWROW=4;Glb.INITST_SETFIND=5;Glb.INITST_SETFINDAL=6;Glb.OBJ_ENABLED=1;Glb.OBJ_VISIBLE=2;Glb.OBJ_VERTICAL=4;Glb.FLD_ISKEY=2048;Glb.FLD_LISTLIST=65536;Glb.FLD_INLIST=131072;Glb.FLD_INFORM=262144;Glb.FLD_NOHDRLIST=524288;Glb.FLD_NOHDRFORM=1048576;Glb.FLD_VERTHDRLIST=2097152;Glb.FLD_VERTHDRFORM=4194304;Glb.FLD_AUTOLOOKUP=8388608;Glb.FLD_NOACTD=16777216;Glb.FLD_ACTIVE=33554432;Glb.FLD_SUPERACTIVE=67108864;Glb.FLD_ISAGGR=32768;Glb.FLD_ISOPT=16384;Glb.FLD_ISDESCR=8192;Glb.FLD_CANACTIVATE=4096;Glb.PANEL_LIST=0;Glb.PANEL_FORM=1;Glb.PCM_FORMLIST=1;Glb.PCM_SEARCH=2;Glb.PCM_FIND=4;Glb.PCM_INSERT=8;Glb.PCM_DELETE=16;Glb.PCM_CANCEL=32;Glb.PCM_REQUERY=64;Glb.PCM_UPDATE=128;Glb.PCM_DUPLICATE=256;Glb.PCM_LOOKUP=512;Glb.PCM_BLOBEDIT=1024;Glb.PCM_BLOBDELETE=2048;Glb.PCM_BLOBNEW=4096;Glb.PCM_BLOBSAVEAS=8192;Glb.PCM_PRINT=16384;Glb.PCM_GROUP=32768;Glb.PCM_ATTACH=65536;Glb.PCM_CSV=131072;Glb.PCM_CUSTOM1=262144;Glb.PCM_CUSTOM2=524288;Glb.PCM_CUSTOM3=1048576;Glb.PCM_CUSTOM4=2097152;Glb.PCM_CUSTOM5=4194304;Glb.PCM_CUSTOM6=8388608;Glb.PCM_CUSTOM7=16777216;Glb.PCM_CUSTOM8=33554432;Glb.PCM_NAVIGATION=1073741824;Glb.TABOR_TOP=1;Glb.TABOR_LEFT=2;Glb.TABOR_BOTTOM=3;Glb.TABOR_RIGHT=4;Glb.SCRZONE_VISTAB=0;Glb.SCRZONE_HIDTAB=1;Glb.SCRZONE_AUTTAB=2;Glb.SCRZONE_PINNEDZONE=0;Glb.SCRZONE_UNPINNEDZONE=1;Glb.SCRZONE_HIDDENZONE=2;Glb.SCRZONE_SELECTEDMENU=-1;Glb.SCRZONE_SELECTEDNONE=-2;Glb.SCRZONE_SWIPENONE=1;Glb.SCRZONE_SWIPECOLLAPSABLE=2;Glb.SCRZONE_SWIPEHIDE=3;Glb.SCRZONE_VERTICALPOPOVER=0;Glb.SCRZONE_VERTICALCOLLAPSE=1;Glb.SCRZONE_VERTICALHIDE=2;Glb.SCRZONE_VERTICALNOCHANGE=3;Glb.PCI_FORMLIST=1;Glb.PCI_SEARCH=2;Glb.PCI_FIND=3;Glb.PCI_INSERT=4;Glb.PCI_DELETE=5;Glb.PCI_CANCEL=6;Glb.PCI_REQUERY=7;Glb.PCI_UPDATE=8;Glb.PCI_DUPLICATE=9;Glb.PCI_LOOKUP=10;Glb.PCI_BLOBEDIT=11;Glb.PCI_BLOBDELETE=12;Glb.PCI_BLOBNEW=13;Glb.PCI_BLOBSAVEAS=14;Glb.PCI_DUMMY=15;Glb.PCI_ATTACH=16;Glb.PCI_CSV=17;Glb.PANOP_FIND=1;Glb.PANOP_UPDATE=2;Glb.PANOP_DELETE=3;Glb.OPEN_MODALALT=-1;Glb.OPEN_MDI=0;Glb.OPEN_MODAL=1;Glb.OPEN_POPUP=2;Glb.BORDER_NONE=1;Glb.BORDER_THIN=2;Glb.BORDER_THICK=3;Glb.ERRTOOLTIP_OVER=1;Glb.ERRTOOLTIP_FOCUS=2;Glb.ERRTOOLTIP_IMMEDIATE=3;Glb.CLIVISPROP_HASCAPTION=1;Glb.CLIVISPROP_MENUBTN=2;Glb.CLIVISPROP_HASICON=4;Glb.CLIVISPROP_HASTITLE=8;Glb.CLIVISPROP_COMMAND=16;Glb.CLIVISPROP_CLOSEBTN=32;Glb.CLIVISPROP_HELPBTN=64;Glb.CLIVISPROP_DEBUGBTN=128;Glb.CLIVISPROP_ICONCLK=256;Glb.CLIVISPROP_AJAXIND=512;Glb.CLIVISPROP_TOOLBAR=1024;Glb.CLIVISPROP_STATUSBAR=2048;Glb.FORMVISPROP_HASCAPTION=1;Glb.FORMVISPROP_RESIZABLE=2;Glb.FORMVISPROP_MOVEABLE=4;Glb.FORMVISPROP_MINBTN=8;Glb.FORMVISPROP_MAXBTN=16;Glb.FORMVISPROP_CLOSEBTN=32;Glb.FORMVISPROP_CONFIRMBTN=64;Glb.FORMVISPROP_HELPBTN=128;Glb.FORMVISPROP_DEBUGBTN=256;Glb.FORMVISPROP_HASICON=512;Glb.FORMVISPROP_SHOWMESS=1024;Glb.FORMVISPROP_HASBACKBUT=2048;Glb.FLDVISPROP_CANSORT=1;Glb.FLDVISPROP_AUTOCLUSTER=2;Glb.FLDVISPROP_ONEACHKEY=4;Glb.FLDVISPROP_ONLYICON=8;Glb.FLDVISPROP_SHOWACT=16;Glb.FLDVISPROP_MANDATORY=32;Glb.FLDVISPROP_POPUPCONTROL=64;Glb.FLDVISPROP_HYPERLINK=128;Glb.PFLVISPROP_EXPORTNAMES=256;Glb.PFLVISPROP_AUTOTAB=512;Glb.PANVISPROP_HILITEROW=8192;Glb.SQL_SELECT=0;Glb.SQL_FROM=1;Glb.SQL_WHERE=2;Glb.SQL_GROUPBY=3;Glb.SQL_HAVING=4;Glb.SQL_ORDERBY=5;Glb.SQL_MAXQUERIES=6;Glb.VISCLR_FOREVALUE=1;Glb.VISCLR_FOREHEAD=2;Glb.VISCLR_FOREGROUP=3;Glb.VISCLR_BACKVALUE=4;Glb.VISCLR_ALTVALUE=5;Glb.VISCLR_BACKPANEL=6;Glb.VISCLR_BACKHEAD=7;Glb.VISCLR_BACKGROUP=8;Glb.VISCLR_HILIGHT=9;Glb.VISCLR_EDITING=10;Glb.VISCLR_BORDERS=11;Glb.VISCLR_BACKGRPFORM=12;Glb.VISCLR_FOREGRPFORM=13;Glb.VISCLR_BACKQBE=14;Glb.VISCLR_BACKREADONLY=15;Glb.VISCLR_HILIGHTREADONLY=16;Glb.VISCLR_BACKHEADFORM=17;Glb.VISCLR_ALTREADONLY=18;Glb.VISCLR_FOREHEADNN=19;Glb.VISCLR_ERRVALUE=20;Glb.VISCLR_WARNVALUE=21;Glb.VISCLR_ERRBACK=22;Glb.VISCLR_WARNBACK=23;Glb.VISFNT_VALUE=1;Glb.VISFNT_HEAD=2;Glb.VISFNT_GROUP=3;Glb.VISFNT_ERR=4;Glb.VISFNT_WARN=5;Glb.VISFNT_NOTNULL=6;Glb.VISCTRL_AUTO=1;Glb.VISCTRL_EDIT=2;Glb.VISCTRL_COMBO=3;Glb.VISCTRL_CHECK=4;Glb.VISCTRL_OPTION=5;Glb.VISCTRL_BUTTON=6;Glb.VISCTRL_HTMLEDIT=7;Glb.VISALN_AUTO=1;Glb.VISALN_SX=2;Glb.VISALN_CX=3;Glb.VISALN_DX=4;Glb.VISALN_JX=5;Glb.VISBRD_NONE=1;Glb.VISBRD_HORIZ=2;Glb.VISBRD_VERT=3;Glb.VISBRD_FRAME=4;Glb.VISBRD_SUNKEN=5;Glb.VISBRD_RAISED=6;Glb.VISBRD_ETCHED=7;Glb.VISBRD_BUMP=8;Glb.VISBRD_CUSTOM=9;Glb.VISBDI_VALUE=1;Glb.VISBDI_HEAD=2;Glb.VISBDI_GROUP=3;Glb.VISBDI_HDRFORM=4;Glb.VISBDI_GRPFORM=5;Glb.VISBDI_VALFORM=6;Glb.VISALI_VALUE=1;Glb.VISALI_HDRLIST=2;Glb.VISALI_HDRFORM=3;Glb.HDRGRP_NOHDR=1;Glb.HDRGRP_ONBORDER=2;Glb.HDRGRP_OUTER=3;Glb.HDRGRP_INNER=4;Glb.FL_VIS_PASSWORD=65536;Glb.FL_VIS_SHOWVALUE=131072;Glb.FL_VIS_SHOWDESCR=262144;Glb.FL_VIS_SHOWIMAGE=524288;Glb.FL_VIS_HYPERLINK=2097152;Glb.FL_VIS_EMBEDFONT=4194304;Glb.VISCBOR_TOP=1;Glb.VISCBOR_RIGHT=2;Glb.VISCBOR_BOTTOM=3;Glb.VISCBOR_LEFT=4;Glb.VISCTYP_SOLID=1;Glb.VISCTYP_DOTTED=2;Glb.VISCTYP_DASHED=3;Glb.VISCTYP_DOUBLE=4;Glb.VISGRADDIR_NONE=1;Glb.VISGRADDIR_HORIZ=2;Glb.VISGRADDIR_VERT=3;Glb.DT_UNSPEC=0;Glb.DT_NUM_INTEGER=1;Glb.DT_NUM_FLOAT=2;Glb.DT_NUM_FIXED=3;Glb.DT_NUM_CURRENCY=4;Glb.DT_CHAR=5;Glb.DT_CHAR_FIXED=12;Glb.DT_DATE=6;Glb.DT_TIME=7;Glb.DT_DATETIME=8;Glb.DT_DOC_TEXT=9;Glb.DT_DOC_OLE=10;Glb.DT_BOOLEAN=11;Glb.DT_OBJECT=13;Glb.DTC_NUMBER=1;Glb.DTC_DATE=2;Glb.DTC_CHAR=3;Glb.DTC_DOC=4;Glb.DTC_BOOL=5;Glb.DTC_NONE=6;Glb.TRANSF_NULL=0;Glb.TRANSF_NONE=1;Glb.TRANSF_TRIM=2;Glb.TRANSF_SUBSTR=3;Glb.TRANSF_ITOD=4;Glb.TRANSF_CTOD=5;Glb.TRANSF_C2TOI=6;Glb.MAX_PANEL_STRING=8;Glb.MASTER_ROWNAME=-1;Glb.FRAMETYPE_BUTTON=39;Glb.FRAMETYPE_PANEL=40;Glb.FRAMETYPE_GRAPH=43;Glb.FRAMETYPE_TREE=44;Glb.FRAMETYPE_TABBED=46;Glb.FORMDOCK_NONE=1;Glb.FORMDOCK_LEFT=2;Glb.FORMDOCK_RIGHT=3;Glb.FORMDOCK_TOP=4;Glb.FORMDOCK_BOTTOM=5;Glb.HEADER_GAP=4;Glb.SELECT_OFFSET=20;Glb.SCROLL_OFFSET=18;Glb.PAN_OFFS_X=8;Glb.PAN_OFFS_Y=24;Glb.PAN_OFFS_PAGEY=20;Glb.IMDB_CURSOR=10;Glb.RD_DISABLED=0;Glb.RD_FRAMES=1;Glb.RD_ACTIVE=2;Glb.WEBVALID_NONE=0;Glb.WEBVALID_STRICT=1;Glb.WEBSTY_DIV=0;Glb.WEBSTY_INP=1;Glb.WEBSTY_SPAN=2;Glb.WEBSTY_SEL=3;Glb.WEBSTY_TEXT=4;Glb.BRWCLS_IENORMAL=0;Glb.BRWCLS_IESTRICT=1;Glb.BRWCLS_FIREFOX=2;Glb.BRWSCL_NONE=0;Glb.BRWSCL_SYMBIAN=1;Glb.BRWSCL_SAFARI=2;Glb.BRWSCL_OPERA=3;Glb.ENG_IE=1;Glb.ENG_MOZ=2;Glb.FORMTOOL_NONE=0;Glb.FORMTOOL_LEFT=1;Glb.FORMTOOL_RIGHT=2;Glb.FORMTOOL_DISTRUB=3;Glb.WS_NORMAL=0;Glb.WS_MAXIMIZE=1;Glb.WS_MINIMIZE=2;Glb.FORMSCROLL_NONE=0;Glb.FORMSCROLL_HORIZ=1;Glb.FORMSCROLL_VERT=2;Glb.FORMSCROLL_BOTH=3;Glb.MENUTYPE_LEFTSB=1;Glb.MENUTYPE_RIGHTSB=2;Glb.MENUTYPE_MENUBAR=3;Glb.MENUTYPE_TASKBAR=4;Glb.MENUTYPE_GROUPED=5;Glb.MENUTYPE_GROUPEDR=6;Glb.GetWebColor=function(b){if(b==-1){return"transparent"}else{var c=((b&255)<<16)|(b&65280)|((b&16711680)>>16);var d=c.toString(16);var a="";while(a.length<6-d.length){a+="0"}return"#"+a+d}};Glb.ClassDT=function(a){switch(a){case Glb.DT_NUM_CURRENCY:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_INTEGER:return Glb.DTC_NUMBER;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:return Glb.DTC_DATE;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return Glb.DTC_CHAR;case Glb.DT_DOC_OLE:return Glb.DTC_DOC;case Glb.DT_UNSPEC:return Glb.DTC_NONE;case Glb.DT_BOOLEAN:return Glb.DTC_BOOL;default:return Glb.DTC_NONE}};Glb.ToSql=function(c,b,a){switch(c.Type){case IDVariant.STRING:return IDL.CSql(c,IDL.FMT_CHAR,a);case IDVariant.DATETIME:switch(Glb.ClassDB(b)){case Glb.DBC_ACCESS:return IDL.CSql(c,IDL.FMT_DAT1,a);case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:return IDL.CSql(c,IDL.FMT_DAT3,a);case Glb.DBC_SQLITE:return IDL.CSql(c,IDL.FMT_DAT4,a);default:return IDL.CSql(c,IDL.FMT_DAT2,a)}default:return IDL.CSql(c,IDL.FMT_NUM,a)}};Glb.AddCRFormula=function(b,a,c){return b+a+"= "+c+"||"};Glb.SQLWhereClause=function(b){var a=b.stringValue();if(a.length<3){return new IDVariant("1=1")}else{return new IDVariant(a.substr(6))}};Glb.IsFormUpdated=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentModified()){return true}}}return false};Glb.IsFormInError=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentInError()){return true}}}return false};Glb.UpdateForm=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){if(b[a].Content.IsContentModified()){b[a].Content.PanelCommand(Glb.PCM_UPDATE)}}}};Glb.ReleaseForm=function(b){for(var a=1;a<b.length;a++){if(b[a].Content!=null&&b[a].Content instanceof IDPanelSrv){b[a].Content.ReleaseLock()}}};Glb.CheckFrmRole=function(a,c){var b=c[a];if(b==null){return false}else{return b>=0}};Glb.SaveBlob=function(o,f,p,d,l){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()&&!l){return new IDVariant(RD4_WebEntryPoint.ShellObject.SendCmd("SAVEBLOB",{BLOB:btoa(f.Value),PATH:(p?p.stringValue():""),FILENAME:(d?d.stringValue():"")}))}if(p==undefined){p=new IDVariant()}if(d==undefined){d=null}if(l==undefined){l=false}if(f.Type!=IDVariant.BLOB){return new IDVariant("")}var t=o.ParamsObj().NativeBlob;try{var r=f.Value;if(!t&&r.length<16){return new IDVariant("")}if(t||r.substr(0,4)=="BLOB"){var b;if(t){b="bin"}else{var m=Math.min(r.indexOf(String.fromCharCode(0)),15);b=r.substring(4,m);r=r.substr(16)}if(l){var h="data:";var c=o.GetMimeType(b);if(c==null){c="application/octet-stream"}h+=c;h+=";base64,";h+=btoa(r);return new IDVariant(h)}else{var q=new Uint8Array(r.length);for(var g=0;g<r.length;g++){q[g]=r.charCodeAt(g)}var j=new BlobBuilder();j.append(q.buffer);var c=o.GetMimeType(b);var a=j.getBlob(c);return new IDVariant(URL.createObjectURL(a))}}else{return new IDVariant("")}}catch(k){WriteToConsoleError(k);return new IDVariant("")}};Glb.LoadBlob=function(o,q,g,k,c){if(!(q instanceof IDCachedRowSet)){k=q}var d="";if(k instanceof IDVariant){d=k.stringValue()}else{if(typeof(k)=="string"){d=k}}if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var r=new IDVariant();r.Type=IDVariant.BLOB;r.Value=atob(RD4_WebEntryPoint.ShellObject.SendCmd("LOADBLOB",{FILENAME:d}));return r}try{var r="";if(d.startsWith("http:")||d.startsWith("https:")||d.startsWith("blob:")){var m=new IDMap();m.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));m.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("BLOB"));var l=IDL.HttpRequest(o,new IDVariant(d),m);r=l.Value}else{if(d.startsWith("data:")){k={};k.FileName="";k.ContentType=d.substr("data:".length,d.indexOf(";")-"data:".length);k.Content=atob(d.substr(d.indexOf(";")+"base64,".length+1));k.ContentLength=k.Content.length}else{if(k instanceof IDVariant){throw new Error("LoadBlob from file path not supported outside the Native Shell")}}if(!o.ParamsObj().NativeBlob){r="BLOB";var a="";if(k.FileName.length>0){var b=k.FileName.lastIndexOf(".");if(b>-1){a=k.FileName.substr(b+1)}}if(a.length==0&&o!=null&&o instanceof WebEntryPointSrv){a=o.GetExtensionFromMime(k.ContentType)}if(a.length>12){a=a.substr(0,12)}r+=a;for(var h=r.length;h<16;h++){r+=String.fromCharCode(0)}}r+=k.Content}var f=new IDVariant(r);f.Type=IDVariant.BLOB;if(q instanceof IDCachedRowSet){q.updateBinaryStream(g,f);q.updateRow();q.acceptChanges(c)}return f}catch(j){WriteToConsoleError(j);throw j}};Glb.CopyFile=function(c,b){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("VBFILE_COPYFILE",{DESTNAME:c,SRCNAME:b});if(a!="OK"){throw new Error(a)}return}};Glb.HTMLEncode=function(j,h,b,c){if(j==null){return""}if(j instanceof IDVariant){j=j.stringValue()}if(j.toString){j=j.toString()}if(h==undefined){h=false}if(b==undefined){b=false}if(c==undefined){c=false}var f="";var g=j.length;for(var e=0;e<g;e++){var a=j.charAt(e);var d=j.charCodeAt(e);if(c&&!(a==9||a==10||a==13||(a>=32&a<=55295)||(a>=57344&&a<=65533))){continue}if(b){if(d>126||d<=13){f=f+"&#"+d+";"}else{f=f+a}}else{switch(a){case'"':f=f+"&quot;";break;case"&":f=f+"&amp;";break;case"<":f=f+"&lt;";break;case">":f=f+"&gt;";break;case"\n":if(h){f=f+"<br/>"}else{f=f+"&#xA;"}break;case"\r":if(!h){f=f+"&#xD;"}break;default:if(d>126||d<=13){f=f+"&#"+d+";"}else{f=f+a}break}}}return f};Glb.HTMLDecode=function(k,h,b){if(k==null){return""}if(h==undefined){h=false}if(b==undefined){b=false}var e="";for(var d=0;d<k.length;d++){var a=k.charAt(d);if(a=="&"&&d<k.length-1&&k.charAt(d+1)=="#"){var g="";var j=false;for(d+=2;d<k.length;d++){if(k.charAt(d)!=";"){g+=k.charAt(d)}else{j=(g.length>0);break}}if(j){var f="";if(g.toLowerCase().startsWith("x")){f=new Number("0"+g)}else{f=new Number(g)}if(!isNaN(f)){e+=String.fromCharCode(f)}else{j=false}}if(!j){e+=a;d-=g.length+2}}else{if(h&&a=="&"&&k.substr(d,4)=="&lt;"){e+="<";d+=3}else{if(h&&a=="&"&&k.substr(d,4)=="&gt;"){e+=">";d+=3}else{if(h&&a=="&"&&k.substr(d,6)=="&quot;"){e+='"';d+=5}else{if(h&&a=="&"&&k.substr(d,5)=="&amp;"){e+="&";d+=4}else{if(b&&a=="&"&&d<k.length-1){var g="&";for(d+=1;d<k.length;d++){if(k.charAt(d)!=";"){g=g+k.charAt(d)}else{g=g+k.charAt(d);switch(g){case"&quot;":e=e+'"';break;case"&amp;":e=e+"&";break;case"&lt;":e=e+"<";break;case"&gt;":e=e+">";break}break}}}else{e=e+a}}}}}}}return e};Glb.URLDecode=function(a){return decodeURIComponent(a)};Glb.URLEncode=function(a){return encodeURIComponent(a)};Glb.GetLIV=function(e,b,d,f){var h="";switch(b){case Glb.DBT_ACCESS97:case Glb.DBT_ODBC:h="select max("+f+") from "+d;break;case Glb.DBT_ACCESS2K:case Glb.DBT_SQLSRV6:case Glb.DBT_SQLSRV7:case Glb.DBT_SQLSRV2K:case Glb.DBT_SQLSRV05:h="select @@identity as ident";break;case Glb.DBT_ORACLE7:case Glb.DBT_ORACLE8:case Glb.DBT_ORACLE9:case Glb.DBT_ORACLE10:case Glb.DBT_ORACLE11:h="select "+d+(f.length>0?"_"+f:"")+".currval from dual";break;case Glb.DBT_DB2400:h="select ZZ_VAL from ZZ_SEQUENCE where ZZ_SEQ='"+d.toUpperCase()+"'";break;case Glb.DBT_DB2UDB:h="select IDENTITY_VAL_LOCAL() from "+d.toUpperCase()+" fetch first 1 row only";break;case Glb.DBT_POSTG8:h="select lastval()";break;case Glb.DBT_MYSQL5:h="select LAST_INSERT_ID()";break;case Glb.DBT_SQLITE:h="select last_insert_rowid()";break}if(h.length>0){var c=new IDCachedRowSet();try{var a=new IDVariant();c=e.OpenRSR(h);if(!c.EOF()){a=c.Get(1)}c.Close();return a}catch(g){WriteToConsoleError(g)}}return new IDVariant()};Glb.ClassDB=function(a){switch(a){case Glb.DBT_ACCESS97:case Glb.DBT_ACCESS2K:return Glb.DBC_ACCESS;case Glb.DBT_SQLSRV6:case Glb.DBT_SQLSRV7:case Glb.DBT_SQLSRV2K:case Glb.DBT_SQLSRV05:return Glb.DBC_SQLSRV;case Glb.DBT_ORACLE7:case Glb.DBT_ORACLE8:case Glb.DBT_ORACLE9:case Glb.DBT_ORACLE10:case Glb.DBT_ORACLE11:return Glb.DBC_ORACLE;case Glb.DBT_DB2400:case Glb.DBT_DB2UDB:return Glb.DBC_DB2;case Glb.DBT_POSTG8:return Glb.DBC_POSTGRES;case Glb.DBT_MYSQL5:return Glb.DBC_MYSQL;case Glb.DBT_SQLITE:return Glb.DBC_SQLITE;case Glb.DBT_ODBC:return Glb.DBC_ODBC;default:return 0}};Glb.ParamsPrefixDB=function(a){switch(Glb.ClassDB(a)){case Glb.DBC_ACCESS:case Glb.DBC_SQLSRV:return"@";case Glb.DBC_DB2:if(a==Glb.DBT_DB2UDB){return"@"}else{return":"}case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:case Glb.DBC_ODBC:return":";case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:return"?";default:return":"}};Glb.GetTD=function(f,g,a,c,e){var b=null;if(f.Type==IDVariant.NULL){return new IDVariant()}switch(g){case Glb.TRANSF_NULL:case Glb.TRANSF_NONE:b=new IDVariant(f);break;case Glb.TRANSF_TRIM:b=IDL.Trim(f,true,true);break;case Glb.TRANSF_SUBSTR:b=IDL.SubStr(f,new IDVariant(c),new IDVariant(e));break;case Glb.TRANSF_ITOD:var d=f.intValue();if(d==0){return new IDVariant()}if(String.compare(a,"YYYYMMDD",true)==0){b=IDL.ToDate(new IDVariant(d/10000),new IDVariant((d%10000)/100),new IDVariant(d%100))}else{if(String.compare(a,"YYMMDD",true)==0){b=IDL.ToDate(new IDVariant(d/10000+1900),new IDVariant((d%10000)/100),new IDVariant(d%100))}else{b=new IDVariant(f);b.changeType(IDVariant.DATETIME)}}break;case Glb.TRANSF_CTOD:break;case Glb.TRANSF_C2TOI:break}if(b==null){b=new IDVariant()}return b};Glb.GetTI=function(o,j,c,m,g,f){switch(c){case Glb.TRANSF_NULL:case Glb.TRANSF_NONE:case Glb.TRANSF_TRIM:return j;case Glb.TRANSF_SUBSTR:var p=o.stringValue();var l=j.stringValue();while(p.length<g-1){p+=" "}while(l.length<f){l+=" "}var b=p.substr(0,g-1);b+=l.substr(0,f);if(p.length>g+f-1){b+=p.substr(g+f-1)}return new IDVariant(b);case Glb.TRANSF_ITOD:if(j.Type==IDVariant.NULL){return new IDVariant(0)}var d=j.dateValue();if(String.compare(m,"YYYYMMDD",true)==0){return new IDVariant(d.Year*10000+d.Month*100+d.Day)}if(String.compare(m,"YYMMDD",true)==0){return new IDVariant((d.Year-1900)*10000+d.Month*100+d.Day)}var e=new IDVariant(j);e.changeType(IDVariant.INTEGER);return e;case Glb.TRANSF_CTOD:return IDL.Format(j,new IDVariant(m),null);case Glb.TRANSF_C2TOI:var k=o.stringValue();var h=j.intValue();while(k.length<g+1){k+=" "}k=k.substr(0,g-1)+String.fromCharCode(h%256)+k.substr(g);k=k.substr(0,g)+String.fromCharCode(h/256)+k.substr(g+1);return new IDVariant(k)}return new IDVariant(j)};Glb.IsJSharpAvailable=function(){return false};Glb.GetObjects=function(d,g){var f=0;var c=0;for(var e=1;e<d.length;e++){if(d[e]==null){if(c==0){c=e}f++;if(f==g){return c}}else{c=0;f=0}}return 0};Glb.IsHTML=function(a){};Glb.RGB=function(f,e,c,d){if(d==undefined){d=100}return(d<<24)+(c<<16)+(e<<8)+f};Glb.BGRToARGB=function(a){var b={};b.R=a&255;b.G=(a&65280)>>8;b.B=(a&16711680)>>16;b.A=(a&4278190080)>>24;b.A=Math.floor(b.A*2.55);if(b.A>255){b.A=255}return b};Glb.HSB=function(e,l,f){if(e<0||e>360){throw new Error("The parameter Hue is out of range 0-360 (h="+e+")")}if(l<0||l>1){throw new Error("The parameter Saturation is out of range 0-1 (s="+l+")")}if(f<0||f>1){throw new Error("The parameter Brightness is out of range 0-1 (b="+f+")")}var a=f;var c=f;var k=f;if(l!=0){var g=f;var j=f*l;var d=f-j;if(e<60){a=g;c=e*j/60+d;k=d}else{if(e<120){a=-(e-120)*j/60+d;c=g;k=d}else{if(e<180){a=d;c=g;k=(e-120)*j/60+d}else{if(e<240){a=d;c=-(e-240)*j/60+d;k=g}else{if(e<300){a=(e-240)*j/60+d;c=d;k=g}else{if(e<=360){a=g;c=d;k=-(e-360)*j/60+d}else{a=0;c=0;k=0}}}}}}}return Glb.RGB(Math.round(a*255),Math.round(c*255),Math.round(k*255))};Glb.RGBtoHSB=function(a,f,m){var h,e,l;var o=new Array(3);var p=(a>f)?a:f;if(m>p){p=m}var j=(a<f)?a:f;if(m<j){j=m}l=p*1/255;if(p!=0){e=(p-j)*1/p}else{e=0}if(e==0){h=0}else{var c=((p-a)*1/(p-j));var k=((p-f)*1/(p-j));var d=((p-m)*1/(p-j));if(a==p){h=d-k}else{if(f==p){h=2+c-d}else{h=4+k-c}}h=h/6;if(h<0){h=h+1}}o[0]=h;o[1]=e;o[2]=l;return o};Glb.GetColorRed=function(a){return(Glb.BGRToARGB(a).R)};Glb.GetColorGreen=function(a){return(Glb.BGRToARGB(a).G)};Glb.GetColorBlue=function(a){return(Glb.BGRToARGB(a).B)};Glb.GetColorHue=function(a){var b=Glb.BGRToARGB(a);return Math.floor(Glb.RGBtoHSB(b.R,b.G,b.B)[0]*360)};Glb.GetColorSaturation=function(a){var b=Glb.BGRToARGB(a);return(Glb.RGBtoHSB(b.R,b.G,b.B))[1]};Glb.GetColorBrightness=function(a){var b=Glb.BGRToARGB(a);return(Glb.RGBtoHSB(b.R,b.G,b.B))[2]};Glb.WebColorToInt=function(a){if(a.equals("transparent")){return -1}else{var b=parseInt(a.replace("#",""),16);b=Glb.BGRToARGB(b);return Glb.RGB(b.B,b.G,b.R)}};function IDLocation(){this.Status=new IDVariant();this.Latitude=new IDVariant();this.Longitude=new IDVariant();this.Accuracy=new IDVariant();this.Altitude=new IDVariant();this.AltitudeAccuracy=new IDVariant();this.Heading=new IDVariant();this.Speed=new IDVariant();this.TStamp=new IDVariant()}IDLocation.prototype.init=function(c,b){if(c=="err"){this.Status=new IDVariant(b);this.Status.changeType(IDVariant.INTEGER)}else{this.Status=new IDVariant(0);var a=new StringTokenizer();a.setString(new IDVariant(b),new IDVariant("|"));this.Latitude=a.next();this.Latitude.changeType(IDVariant.FLOAT);this.Longitude=a.next();this.Longitude.changeType(IDVariant.FLOAT);this.Accuracy=a.next();this.Accuracy.changeType(IDVariant.FLOAT);this.Altitude=a.next();this.Altitude.changeType(IDVariant.FLOAT);this.AltitudeAccuracy=a.next();this.AltitudeAccuracy.changeType(IDVariant.FLOAT);this.Heading=a.next();this.Heading.changeType(IDVariant.FLOAT);this.Speed=a.next();this.Speed.changeType(IDVariant.FLOAT);this.TStamp=a.next();this.TStamp.changeType(IDVariant.DATETIME)}};function IDDeviceMotion(){this.AlphaOrientation=new IDVariant();this.BetaOrientation=new IDVariant();this.GammaOrientation=new IDVariant();this.XAcceleration=new IDVariant();this.YAcceleration=new IDVariant();this.ZAcceleration=new IDVariant();this.XGAcceleration=new IDVariant();this.YGAcceleration=new IDVariant();this.ZGAcceleration=new IDVariant();this.AlphaRotationRate=new IDVariant();this.BetaRotationRate=new IDVariant();this.GammaRotationRate=new IDVariant();this.CompassHeading=new IDVariant();this.CompassAccuracy=new IDVariant();this.MilliSecondsTime=new IDVariant()}IDDeviceMotion.prototype.init=function(b){var a=new StringTokenizer();a.setString(new IDVariant(b),new IDVariant("|"));this.XAcceleration=a.next();this.XAcceleration.changeType(IDVariant.FLOAT);this.YAcceleration=a.next();this.YAcceleration.changeType(IDVariant.FLOAT);this.ZAcceleration=a.next();this.ZAcceleration.changeType(IDVariant.FLOAT);this.XGAcceleration=a.next();this.XGAcceleration.changeType(IDVariant.FLOAT);this.YGAcceleration=a.next();this.YGAcceleration.changeType(IDVariant.FLOAT);this.ZGAcceleration=a.next();this.ZGAcceleration.changeType(IDVariant.FLOAT);this.AlphaRotationRate=a.next();this.AlphaRotationRate.changeType(IDVariant.FLOAT);this.BetaRotationRate=a.next();this.BetaRotationRate.changeType(IDVariant.FLOAT);this.GammaRotationRate=a.next();this.GammaRotationRate.changeType(IDVariant.FLOAT);this.AlphaOrientation=a.next();this.AlphaOrientation.changeType(IDVariant.FLOAT);this.BetaOrientation=a.next();this.BetaOrientation.changeType(IDVariant.FLOAT);this.GammaOrientation=a.next();this.GammaOrientation.changeType(IDVariant.FLOAT);this.CompassHeading=a.next();this.CompassHeading.changeType(IDVariant.FLOAT);this.CompassAccuracy=a.next();this.CompassAccuracy.changeType(IDVariant.FLOAT);this.MilliSecondsTime=a.next();this.MilliSecondsTime.changeType(IDVariant.INTEGER)};IDPanelSrv.EM_MSGBOX=0;IDPanelSrv.EM_MESSAGE=1;IDPanelSrv.EM_FIELD=2;IDPanelSrv.EM_NONE=3;IDPanelSrv.RT_LEFT=0;IDPanelSrv.RT_TOP=1;IDPanelSrv.RT_WIDTH=2;IDPanelSrv.RT_HEIGHT=3;function IDPanelSrv(b,d,a,e){WebFrameSrv.call(this,d);this.iStatus=Glb.PS_NONE;this.Flags=0;this.DesignFlags=-1;this.RoleFlags=-1;this.PanelMode=-1;this.NumRows=0;this.MaxHRow=0;this.PanelPage=0;this.HeaderSize=0;this.ShowToolbar=true;this.ShowStatusbar=true;this.ShowRowSelector=true;this.DynamicRows=0;this.DynamicHeight=false;this.Freezed=false;this.InitStatus=Glb.INITST_SEARCH;this.NumPagPerLine=0;this.QBEEmpty=b.ParamsObj().PanelQBEEmpty;this.DisableNotification=false;this.ListLeft=0;this.ListTop=0;this.ListWidth=0;this.ListHeight=0;this.OriginalListHeight=0;this.OriginalBoundHeight=0;this.LastDynRows=0;this.OrgDynRows=0;this.AttR=0;this.ListP=1;this.ListR=0;this.VListResizeMode=0;this.HListResizeMode=0;this.LastColumnStretched=0;this.LastResizeWidth=0;this.LastResizeHeight=0;this.LastDeltaY=0;this.iVisualStyle=0;this.Fields;this.Pages;this.Groups;this.Queries;this.MasterFields;this.PresentFields;this.SortingList=new ArrayList();this.RowErrors;this.RDRowSel=new Array(0);this.ValidatingRow=-1;this.IndText="";this.MasterRowName="";this.InfoPriority=0;this.BoundRect;this.AutoSaveSamFl=false;this.NeedAutoSave=false;this.EnabledCommands=b.ParamsObj().PanelCommandMask;this.FinalUpdate=false;this.EditUpdErrorMode=b.ParamsObj().EditUpdErrorMode;this.EditInsErrorMode=b.ParamsObj().EditInsErrorMode;this.FinalUpdErrorMode=b.ParamsObj().FinalUpdErrorMode;this.FinalInsErrorMode=b.ParamsObj().FinalInsErrorMode;this.ConfirmDelete=b.ParamsObj().PanelConfirmDelete;this.HighlightDelete=b.ParamsObj().PanelHighlightDelete;this.iFixedCols=0;this.IMDB;this.MstTblIndex=0;this.mMstTblIndex=0;this.MasterDocMod;this.LastExtDoc=null;this.LastExtSchema=null;this.UseIMDB;this.VS;this.MyBook=null;this.LastMasterDocument=null;this.MasterPanelIdx=0;this.MasterPanelCode=null;this.iDetailCollection=-1;this.WasHidden=false;this.ScrollPos=-1;this.QBETip="";this.QBETipText="";this.iRowUpdateCount;this.ExportLabel=new IDVariant();this.iEnableInsertWhenLocked=b.ParamsObj().PanelEnableInsertWhenLocked;this.iEnableMultipleSel=b.ParamsObj().EnablePanelMultiSelection;this.iShowMultipleSel=b.ParamsObj().ShowPanelMultiSelection;this.iActiveMultipleSel=b.ParamsObj().ActivePanelMultiSelection;this.SelectedRows;this.iSelectAllOnlyVisible=b.ParamsObj().SelectAllOnlyVisible;this.FormTabOrder;this.ListTabOrder;this.FirstListFld=null;this.LastListFld=null;this.ActivateRightClick=false;this.GroupingList=new ArrayList();this.iEnabledGrouping=false;this.iShowGroups=false;this.GroupRoot;this.SendPositions=false;this.ForceSendPosition=false;this.DisableLookups=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PAN_MAXPROPS);this.RD3ListCache=null;this.RD3FormCache=null;this.RD3UpdateCount=null;this.RowSelectEventDef=RD3Glb.EVENT_ACTIVE;this.ScrollEventDef=RD3Glb.EVENT_ACTIVE;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.PageClickEventDef=RD3Glb.EVENT_ACTIVE;this.MultiSelEventDef=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_CLIENTSIDE;this.FocusEventDef=RD3Glb.EVENT_CLIENTSIDE;this.TextSelectionEventDef=RD3Glb.EVENT_DEFERRED;this.ChangeLayoutAnimationDef=null;this.QBETipAnimationDef=null;this.RD3Validate=false;this.RD3ChangeSel=false;this.RD3SendChange=false;this.RD3Sendmulti=false;this.BlockingCommands=Glb.PCM_FIND|Glb.PCM_REQUERY|Glb.PCM_DELETE|Glb.PCM_UPDATE|Glb.PCM_PRINT|Glb.PCM_CSV|Glb.PCM_ATTACH;this.ReorderColumn=false;this.ResizeColumn=false;this.TooltipOnEachRow=b.ParamsObj().TooltipOnEachRow;this.ResOnlyVisFlds=false;this.iVisualFlags=0;this.iLoadingPolicy=b.ParamsObj().LoadingPolicy;this.iPullToRefresh=b.ParamsObj().PullToRefresh;this.FrIndex=a;this.Code=e;if(d.OpenAs!=Glb.OPEN_MDI){if(this.Lockable&&!b.IsMobile()){this.iLocked=false}}}IDPanelSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];IDPanelSrv[obj]=WebFrameSrv[obj]}IDPanelSrv.prototype.SearchObject=function(a){if(a.equals(this.Code)||(this.iGuid!=null&&this.iGuid.equals(a))){return this}else{return null}};IDPanelSrv.prototype.set_ShowInfoMessages=function(a){if(this.ShowInfoMessages&&!a){this.SetInfoMessage("")}this.ShowInfoMessages=a;this.RD3Change(RD3Glb.PAN_INFOMSG)};IDPanelSrv.prototype.Page=function(){return this.PanelPage};IDPanelSrv.prototype.set_Page=function(b){var a=new IDVariant();if(this.PanelPage!=b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,61,"IDPanel.OnChangePage","Panel "+this.GetDTTCaption()+": active page changing to "+this.Pages[b].Header+"; fire OnChangePage event")}this.Parent.OnChangePage(this,new IDVariant(b),a)}if(a.isFalse()){this.PanelPage=b;this.RD3Change(RD3Glb.PAN_PANELPAGE);this.CalcLayout();this.SetInput()}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,75,"IDPanel.OnChangePage","Panel "+this.GetDTTCaption()+": page changing canceled")}}};IDPanelSrv.prototype.set_LoadingPolicy=function(a){if(this.iLoadingPolicy!=a){this.iLoadingPolicy=a;this.RD3Change(RD3Glb.PAN_LOADPOL)}};IDPanelSrv.prototype.LoadingPolicy=function(){return this.iLoadingPolicy};IDPanelSrv.prototype.set_PullToRefresh=function(a){if(this.iPullToRefresh!=a){this.iPullToRefresh=a;this.RD3Change(RD3Glb.PAN_PULLREF)}};IDPanelSrv.prototype.PullToRefresh=function(){return this.iPullToRefresh};IDPanelSrv.prototype.Layout=function(){return this.PanelMode};IDPanelSrv.prototype.set_Layout=function(d){var b=new IDVariant();if((d==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_HASLIST)==0)||(d==Glb.PANEL_FORM&&(this.Flags&Glb.PAN_HASFORM)==0)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,70,"IDPanel.Layout","Panel "+this.GetDTTCaption()+": can't change layout to "+(d==Glb.PANEL_FORM?"Form":"List")+" because it has not been defined at design time")}return}if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)&&(this.PanelMode!=d)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,62,"IDPanel.OnChangeLayout","Panel "+this.GetDTTCaption()+": changing layout; fire OnChangeLayout event")}this.Parent.OnChangeLayout(this,new IDVariant(d),b);if(b.isFalse()){if(this.PanelMode==Glb.PANEL_LIST&&this.iStatus==Glb.PS_DATA){this.ListP=this.Queries[0].ActualPosition;this.ListR=this.AttR;if(this.AttR>0){this.ScrollRecBy(this.AttR,this.MainFrm)}this.AttR=0;this.RD3Change(RD3Glb.PAN_ACTUALROW)}this.PanelMode=d;this.UpdateDynRows(-1);this.CalcLayout();this.RD3Change(RD3Glb.PAN_PANELMODE);var c=this.Queries[0].GetAttRecNumber();if(this.MainFrm.IsMobile()&&d==Glb.PANEL_LIST){c=this.ListP;this.AttR=this.ListR}if(this.PanelMode==Glb.PANEL_LIST&&this.iStatus==Glb.PS_DATA){if(c-this.ListP>=this.NumRows){this.AttR=this.NumRows-1;c-=this.AttR}else{if(c-this.ListP<0){this.AttR=0}else{if(!this.MainFrm.IsMobile()){this.AttR=c-this.ListP;c=this.ListP}}}if(c>this.Queries[0].RecordCount()){c=this.Queries[0].RecordCount();this.AttR=0}this.RD3Change(RD3Glb.PAN_ACTUALROW)}this.Queries[0].ScrollTo(c);this.UpdateDynRows(this.Queries[0].RecordCount());if(this.iStatus==Glb.PS_DATA){var a=this.Queries[0].RecordCount();this.Queries[0].FillPanel(this.MainFrm);if(this.Queries[0].RecordCount()!=a){this.RD3Change(RD3Glb.PAN_TOTALROWS)}}this.ReValidate();if(this.HasFocus()){this.Parent.FocusPriority=0}this.SetInput(-1,this.FocusedColumn(),1,true)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,76,"IDPanel.OnChangeLayout","Panel "+this.GetDTTCaption()+": layout change canceled")}}}else{if(this.iStatus==Glb.PS_UPDATE&&this.PanelMode!=d){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.RD3Change(RD3Glb.PAN_ACTUALROW)}}};IDPanelSrv.prototype.RefreshLookup=function(c,a){if(c==undefined){c=null}if(a==undefined){a=null}if(this.DisableLookups){return}for(var b=1;b<this.Queries.length;b++){var d=false;if(c==null&&a==null){d=true}else{if(c!=null&&this.Queries[b].MstTableName!=null&&String.compare(c,this.Queries[b].MstTableName,true)==0){d=true}else{if(a!=null&&this.Queries[b].MstTableName!=null&&String.compare(a,this.Queries[b].MstTableName,true)==0){d=true}}}if(d){this.Queries[b].ClearLookupBuffer()}}this.Queries[0].DoUpdateLookups(-1,this.MainFrm)};IDPanelSrv.prototype.RefreshDynProp=function(){this.ReValidate();if(this.MainFrm.ParamsObj().UseRD3){var a=1;if(this.Status()!=Glb.PS_QBE){a=this.Queries[0].RecordCount()+this.NumRows}this.RD3ListCache=new BitArray(a);this.RD3FormCache=new BitArray(a)}};IDPanelSrv.prototype.PanelCommand=function(l,e,j){if(e==undefined){e=0}if(j==undefined){j=false}var p=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": received command "+this.DecodeCommand(l)+"; fire OnPanelCommand event"+(j?" (USER operation)":""))}this.Parent.OnPanelCommand(this,new IDVariant(l),p,new IDVariant(j));if(p.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": command canceled")}return false}switch(l){case Glb.PCM_NAVIGATION:switch(e){case 0:this.ScrollRecTo(0,this.MainFrm);this.SetInput(0,this.FocusedColumn(),1,false);this.SendPositions=true;break;case 1:if(this.PanelMode==Glb.PANEL_FORM){this.ScrollRecTo(this.Queries[0].RecordCount(),this.MainFrm)}else{this.ScrollRecTo(this.Queries[0].RecordCount()-this.NumRows+1,this.MainFrm);this.SetInput(this.NumRows-1,this.FocusedColumn(),1,false)}this.SendPositions=true;break;case 2:var f=this.NumRows-((this.NumRows>1)?1:0);var g=this.Queries[0].ActualPosition;var m=this.Queries[0].RecordCount();if(g+f+this.NumRows>m){this.ScrollRecTo(m-this.NumRows+1,this.MainFrm);if(this.PanelMode==Glb.PANEL_LIST&&this.AttR!=this.NumRows-1&&g>m-this.NumRows){this.SetInput(this.NumRows-1,this.FocusedColumn(),1,false)}}else{if(f>0){this.ScrollRecBy(f,this.MainFrm)}}this.SendPositions=true;break;case 3:var f=this.NumRows-((this.NumRows>1)?1:0);var g=this.Queries[0].ActualPosition;this.ScrollRecBy(-f,this.MainFrm);if(this.PanelMode==Glb.PANEL_LIST&&this.AttR>0&&g==1){this.SetInput(0,this.FocusedColumn(),1,false)}this.SendPositions=true;break}break;case Glb.PCM_FIND:this.FindData(this.MainFrm,false,false);this.SetInput();this.SendPositions=true;break;case Glb.PCM_SEARCH:if(this.Queries[0].IsDO&&this.Queries[0].IsMasterDO&&this.Queries[0].DocTempl==null){this.SetDocumentClass(0,this.Queries[0].MstTableName)}this.EnterQBE();this.SetInput();this.SendPositions=true;break;case Glb.PCM_DELETE:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){this.MultipleDelete(this.MainFrm)}else{this.DeleteRecord(this.MainFrm)}this.SendPositions=false;if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupRoot!=null&&this.Status()!=Glb.PS_QBE){this.RefreshGrouping(false)}break;case Glb.PCM_REQUERY:this.RefreshQuery(this.MainFrm);if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupRoot!=null&&this.Status()!=Glb.PS_QBE){this.RefreshGrouping(false)}this.SendPositions=false;break;case Glb.PCM_CANCEL:var b=this.IsNewRow(this.AttR);if(!b&&this.Queries[0].IsDO){var h=this.GetDocument(this.AttR);if(h!=null){b=h.Inserted()}}this.CancelUpdate(this.MainFrm);if(this.iLockable()&&this.MainFrm.IsMobile()&&this.Status()==Glb.PS_DATA){this.set_Locked(true);if(b&&(this.Flags&Glb.PAN_QBEFORM)!=0){this.set_Layout(Glb.PANEL_LIST)}}this.SendPositions=false;break;case Glb.PCM_UPDATE:this.UpdateRecords(this.MainFrm);if(this.iLockable()&&this.MainFrm.IsMobile()&&this.Status()==Glb.PS_DATA){this.set_Locked(true)}this.SendPositions=false;break;case Glb.PCM_INSERT:this.GoInsertRecord(this.MainFrm);this.SendPositions=true;break;case Glb.PCM_DUPLICATE:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){var o=0;if(!this.IsDO()){for(var a=0;a<this.SelectedRows.length;a++){o+=this.SelectedRows[a]==true?1:0}}else{var k=this.Queries[0].IDColl;if(k!=null){k.set_UIMode(true);k.MoveFirst();while(k.GetAt()!=null){var h=k.GetAt();o+=h.Selected()==true?1:0;k.MoveNext()}k.set_UIMode(false)}}if(o==0&&this.MainFrm.ParamsObj().UseRD3){this.SendPositions=true;break}this.MultipleDuplicate(this.MainFrm)}else{this.DuplicateRecord(this.MainFrm)}this.SendPositions=true;break;case Glb.PCM_PRINT:this.PrintBook(this.MainFrm);this.SendPositions=false;break;case Glb.PCM_FORMLIST:this.set_Layout((this.PanelMode==Glb.PANEL_LIST)?Glb.PANEL_FORM:Glb.PANEL_LIST);this.SendPositions=true;break;case Glb.PCM_ATTACH:this.OpenAttachmentForm();this.SendPositions=false;break;case Glb.PCM_CSV:if(this.EnableMultipleSel()&&this.ShowMultipleSel()){var o=0;if(!this.IsDO()){for(var a=0;a<this.SelectedRows.length;a++){o+=this.SelectedRows[a]==true?1:0}}else{var k=this.Queries[0].IDColl;if(k!=null){k.set_UIMode(true);k.MoveFirst();while(k.GetAt()!=null){var h=k.GetAt();o+=h.Selected()==true?1:0;k.MoveNext()}k.set_UIMode(false)}}if(o==0&&this.MainFrm.ParamsObj().UseRD3){this.SendPositions=false;break}}this.ExportData();this.SendPositions=false;break;case Glb.PCM_GROUP:this.HandleGrouping();break}return true};IDPanelSrv.prototype.SetInput=function(c,x,g,f,y){if(c==undefined){c=-1}if(x==undefined){x=-1}if(g==undefined){g=1}if(f==undefined){f=true}if(y==undefined){y=false}if(g<2&&(!this.Visible||this.Collapsed||!this.Exposed())){return}if(this.Parent!=null&&(y||g>this.Parent.FocusPriority||(g==this.Parent.FocusPriority&&c==this.AttR))){if(c==-1){c=this.AttR}if(x==-1){x=0;if(!f){f=true}}if(f){var s=x;var r=-1;var k=false;while(s<this.Fields.length){var o=s;if(this.IsAdvTabOrderEnabled()){o=this.GetTabOrderFieldIdx(s,this.PanelMode)}if(this.Fields[o].IsPresent()&&(this.Fields[o].IsEnabled(c)||(this.Fields[o].IsEnabledButton()&&this.PanelMode!=Glb.PANEL_LIST&&!this.MainFrm.IsMobile()))){x=o;k=true;break}else{if(this.Fields[o].IsPresent()&&this.Fields[o].ValueList.Count()==0&&r==-1){r=o}}s++}if(!k){for(s=0;s<this.Fields.length;s++){var o=s;if(this.IsAdvTabOrderEnabled()){o=this.GetTabOrderFieldIdx(s,this.PanelMode)}if(this.Fields[o].IsPresent()&&this.Fields[o].IsVisible(c)&&this.Fields[o].IsReadOnly(this.Fields[o].VisualStyle,c)){x=o;k=true;break}}}if(!k&&r>-1){x=r}}this.Parent.FocusPriority=g;var t=true;if(g==1&&g==this.Parent.FocusPriority&&c==this.AttR){var v=this.Parent.ActiveElement;if(v.length>5&&v.startsWith("F")){var d=v.indexOf("C");var b=v.indexOf("R");try{var h=parseInt(v.substr(1,d-1),10);var l=parseInt(v.substr(d+1,b-d-1),10);var q=parseInt(v.substr(b+1),10);var m=this.Parent.Frames[h].Content;var a=m.bFields(l);var w=a.bValues(q);if(w.GetErrorType()!=IDDocument.ERR_NONE&&h==this.FrIndex){t=false}}catch(u){}}}if(t){this.Parent.ActiveElement="F"+this.FrIndex+"C"+x+"R"+c}this.set_SelectedRow(c)}};IDPanelSrv.prototype.UpdatePanel=function(g){var r=false;var l;if(this.IMDB==null){return}if(this.Freezed){g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update not performed (the panel is freezed)");return}if((this.Flags&Glb.PAN_FREEWHENHID)!=0){if(!this.Visible||this.Collapsed||!this.Exposed()){this.WasHidden=true;g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update not performed (the panel is either invisible, collapsed or not exposed)");return}}var q=this.Queries[0].RecordCount();var s=this.Queries[0].GetAttRecNumber()+this.AttR;var o=(this.iStatus==Glb.PS_QBE);o=o||(s>q&&(this.Flags&Glb.PAN_CANINSERT)!=0);o=o||(s<=q&&(this.Flags&Glb.PAN_CANUPDATE)!=0);if(!o&&this.IsDO()&&(this.GetDocument(this.AttR)!=null)){o=o||(this.GetDocument(this.AttR).Inserted()&&(this.Flags&Glb.PAN_CANINSERT)!=0)}if(o){if(this.MstTblIndex>-1&&this.IMDB.TblModified(this.MstTblIndex,Glb.GlbRefModIdx)&&this.UseIMDB){for(var v=0;v<this.MasterFields.length;v++){var k=(this.MasterFields[v].UpdateField());r=r||k}if(r){this.SetRDRowSel(this.AttR,true);this.SetModified(g);this.FireOnChangeRow();if(this.Status()==Glb.PS_UPDATE&&(this.Flags&Glb.PAN_AUTOSAVE)!=0&&!this.AutoSaveSamFl){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false}else{this.ReValidate()}}}}else{g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,73,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": the selected row is not updateable; skipping IMDB check")}l=true;if((this.iStatus==Glb.PS_QBE||this.iStatus==Glb.PS_DATA)){if(this.UseIMDB){if(this.Queries[0].UpdateParam(this.WasHidden)){var u=this.Queries[0].GetAttRecNumber();this.Queries[0].CloseData();this.SaveQBE(2);var f=false;if((this.Flags&Glb.PAN_QBEFORM)!=0){f=true;this.Flags&=~(Glb.PAN_QBEFORM)}var e=this.FindData(g,false,true);l=false;if(f){this.Flags|=Glb.PAN_QBEFORM}if(this.SortingList.Count()>0){this.EnableSorting()}if(!e){this.ScrollRecTo(u,g)}}}}if(this.Queries[0].CollIsModified()){this.set_Status(Glb.PS_DATA);this.RD3Change(RD3Glb.PAN_STATUS);this.ResetRD3Cache();var a=this.Queries[0].RecordCount();var p=this.Queries[0].ActualPosition;this.Queries[0].BlobCache.Clear();this.ScrollRecBy(0,this.MainFrm);if(this.Queries[0].RecordCount()!=a){this.ResetRD3Cache();this.ScrollRecTo(p,this.MainFrm);this.UpdateDynRows(this.Queries[0].RecordCount())}}else{var c=false;for(var v=0;v<this.NumRows;v++){var d=this.GetDocument(v);if(d!=null){if(d.UpdateCount()!=this.RowUpdateCount(v)){c=true;this.RD3ListCache[this.Queries[0].GetAttRecNumber()+v-1]=false;this.RD3FormCache[this.Queries[0].GetAttRecNumber()+v-1]=false;for(var t=0;t<this.Fields.length;t++){if(this.Fields[t].IsNamed){this.Fields[t].Values[v].RD3Change(RD3Glb.VAL_TEXT)}}}}}if(c){this.set_Status(Glb.PS_DATA);this.RD3Change(RD3Glb.PAN_STATUS);this.Queries[0].BlobCache.Clear();this.ScrollRecBy(0,this.MainFrm)}}this.SearchForMasterPanel();if(l&&this.UseIMDB){for(var v=1;v<this.Queries.length;v++){if(this.Queries[v].FieldIndex==-1){if(this.Queries[v].CheckIMDBLookupParam()){this.Queries[0].DoUpdateLookups(-1,g);break}}else{if((this.Fields[this.Queries[v].FieldIndex].Flags&Glb.FLD_AUTOLOOKUP)>0){if(this.Queries[v].CheckIMDBLookupParam()){this.Queries[0].DoUpdateLookups(-1,g);break}}}}}if(this.InitStatus==Glb.INITST_SEARCH&&this.iStatus==Glb.PS_QBE&&(this.Flags&Glb.PAN_QBEFORM)!=0&&this.PanelMode==Glb.PANEL_LIST&&!this.MainFrm.IsMobile()){this.set_Layout(Glb.PANEL_FORM)}if(this.InitStatus!=Glb.INITST_SEARCH&&this.iStatus==Glb.PS_QBE){var h="";switch(this.InitStatus){case Glb.INITST_DATA:h="Find Data";break;case Glb.INITST_INSERT:h="Insert";break;case Glb.INITST_NEWROW:h="New Row";break;case Glb.INITST_SETFIND:h="Set Values & Find";break;case Glb.INITST_SETFINDAL:h="Set Values & Find Always";break}g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,74,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": handling Initial Status ("+h+")");switch(this.InitStatus){case Glb.INITST_SETFIND:if(this.HasQBE()){this.FindData(this.MainFrm,false,false)}break;case Glb.INITST_DATA:this.FindData(this.MainFrm,false,false);if(this.iStatus==Glb.PS_DATA&&(this.Flags&Glb.PAN_QBEFORM)!=0&&this.PanelMode==Glb.PANEL_LIST&&this.Queries[0].RecordCount()==1&&!this.MainFrm.IsMobile()){this.set_Layout(Glb.PANEL_FORM)}break;case Glb.INITST_SETFINDAL:this.FindData(this.MainFrm,false,false);this.SaveQBE(3);break;case Glb.INITST_INSERT:case Glb.INITST_NEWROW:this.GoInsertRecord(this.MainFrm);this.set_Locked(false);break}this.InitStatus=Glb.INITST_SEARCH;if(this.MainFrm.IsMobile()&&this.PanelMode==Glb.PANEL_LIST){if(((this.Flags&Glb.PAN_HASFORM)>0&&(this.Flags&Glb.PAN_STARTFORM)>0)){this.set_Layout(Glb.PANEL_FORM)}}}this.UpdateIndicator(false);if(!this.IsDO()){var b=this.SelectedRows;this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);for(var v=0;v<Math.min((b==null?0:b.length),this.SelectedRows.length);v++){this.SelectedRows[v]=b[v]}if(this.MainFrm.ParamsObj().UseRD3&&!this.RD3Sendmulti){if(b==null||b.length!=this.SelectedRows.length){this.RD3Sendmulti=true}else{for(var v=0;v<this.SelectedRows.length&&!this.RD3Sendmulti;v++){this.RD3Sendmulti|=(this.SelectedRows[v]!=b[v])}}}}};IDPanelSrv.prototype.MasterRS=function(){return this.Queries[0].RS};IDPanelSrv.prototype.set_MasterRS=function(a){this.Queries[0].RS=a;this.UpdateDynRows(this.Queries[0].RecordCount());this.set_Status(Glb.PS_DATA);this.ScrollRecTo(0,this.MainFrm);this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);this.Queries[0].LookupRows=null;if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupingList.Count()>0){this.RefreshGrouping(true)}else{if(this.SortingList.Count()>0){this.EnableSorting()}}this.ResetRD3Cache()};IDPanelSrv.prototype.GetWhereClause=function(){return new IDVariant(this.Queries[0].LastWhereClause)};IDPanelSrv.prototype.Header=function(a,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[b].Header;case Glb.OBJ_GROUP:return this.Groups[b].Header;case Glb.OBJ_FIELD:return this.Fields[b].Header}return""};IDPanelSrv.prototype.set_Header=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].Header=b;this.Pages[c].RD3Change(RD3Glb.PPG_HEADER);break;case Glb.OBJ_GROUP:this.Groups[c].Header=b;this.Groups[c].RD3Change(RD3Glb.PGR_HEADER);break;case Glb.OBJ_FIELD:this.Fields[c].Header=b;this.Fields[c].AbbrHeaderForm=b;this.Fields[c].AbbrHeaderList=b;this.Fields[c].RD3Change(RD3Glb.FLD_HEADER);this.Fields[c].RD3Change(RD3Glb.FLD_FORMHEADER);this.Fields[c].RD3Change(RD3Glb.FLD_LISTHEADER);break}};IDPanelSrv.prototype.FieldVisible=function(b,a){return this.Fields[b].IsVisible(a)&&this.Fields[b].IsPresent()};IDPanelSrv.prototype.SetAbbrHeader=function(a,d,c,b){if(c==Glb.PANEL_LIST){this.Fields[d].AbbrHeaderList=b;this.Fields[d].RD3Change(RD3Glb.FLD_LISTHEADER)}else{this.Fields[d].AbbrHeaderForm=b;this.Fields[d].RD3Change(RD3Glb.FLD_FORMHEADER)}};IDPanelSrv.prototype.ToolTip=function(b,c){switch(b){case Glb.OBJ_PAGE:return this.Pages[c].Tooltip;case Glb.OBJ_GROUP:return this.Groups[c].Tooltip;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){return this.Fields[c].Tooltip}else{var a=this.Fields[c].bValues(this.ValidatingRow).LastTooltip;if(a==null||a.length==0){a=this.Fields[c].Tooltip}return a}}return""};IDPanelSrv.prototype.set_ToolTip=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].Tooltip=b;this.Pages[c].RD3Change(RD3Glb.PPG_TOOLTIP);break;case Glb.OBJ_GROUP:this.Groups[c].Tooltip=b;this.Groups[c].RD3Change(RD3Glb.PGR_TOOLTIP);break;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){this.Fields[c].Tooltip=b;this.Fields[c].RD3Change(RD3Glb.FLD_TOOLTIP)}else{this.Fields[c].Values[this.ValidatingRow].Tooltip=b}break}};IDPanelSrv.prototype.VisualStyle=function(b,c){switch(b){case Glb.OBJ_PANEL:return this.iVisualStyle;case Glb.OBJ_PAGE:return this.Pages[c].VisualStyle;case Glb.OBJ_GROUP:return this.Groups[c].VisualStyle;case Glb.OBJ_FIELD:if(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1){return this.Fields[c].VisualStyle}else{var a=this.Fields[c].bValues(this.ValidatingRow).LastVisualStyle;if(a==-1){return this.Fields[c].VisualStyle}else{return a}}}return 0};IDPanelSrv.prototype.set_VisualStyle=function(a,c,b){switch(a){case Glb.OBJ_PANEL:this.iVisualStyle=b;this.RD3Change(RD3Glb.PAN_VISUALSTYLE);break;case Glb.OBJ_PAGE:this.Pages[c].VisualStyle=b;this.Pages[c].RD3Change(RD3Glb.PPG_VISUALSTYLE);break;case Glb.OBJ_GROUP:this.Groups[c].VisualStyle=b;this.Groups[c].RD3Change(RD3Glb.PGR_VISUALSTYLE);break;case Glb.OBJ_FIELD:this.Fields[c].SetVisualStyle(b);break}};IDPanelSrv.prototype.SetFieldPage=function(a,c,b){this.Fields[a].Page=c;this.Fields[a].Group=b;this.Fields[a].RD3Change(RD3Glb.FLD_PAGE);this.Fields[a].RD3Change(RD3Glb.FLD_GROUP)};IDPanelSrv.prototype.SetFieldQBEEnabled=function(b,a){this.Fields[b].QBEEnabled=a;this.Fields[b].RD3Change(RD3Glb.FLD_QBEENAB)};IDPanelSrv.prototype.SetFieldActive=function(a,b){this.SetFlags(Glb.OBJ_FIELD,a,(b?Glb.FLD_ACTIVE:0),Glb.FLD_ACTIVE)};IDPanelSrv.prototype.SetFieldSuperActive=function(b,a){this.SetFlags(Glb.OBJ_FIELD,b,(a?Glb.FLD_SUPERACTIVE:0),Glb.FLD_SUPERACTIVE)};IDPanelSrv.prototype.SetFieldSort=function(a,b){this.Fields[a].SortFld=b;this.Fields[b].SortFld=a};IDPanelSrv.prototype.SetFieldPrimaryIndex=function(a,b){this.Fields[a].PriIdx=b};IDPanelSrv.prototype.SetFieldPanel=function(d,e,f,c,b,h,g,a){if(c!=null&&c.length>0){this.Fields[d].Code=c}this.Fields[d].DataType=b;if(f!=null&&f.length>0){this.Fields[d].Expr=f}this.Fields[d].MaxLength=h;this.Fields[d].vScale=g;this.Fields[d].IdxPanel=e;this.Fields[d].iVisualFlags=a;this.Fields[d].RD3Change(RD3Glb.FLD_MAXLENGTH);this.Fields[d].RD3Change(RD3Glb.FLD_DATATYPE);this.Fields[d].RD3Change(RD3Glb.FLD_VISPROP);if((a&Glb.FLDVISPROP_ONEACHKEY)>0){this.SetFieldSuperActive(d,true)}if((a&Glb.FLDVISPROP_SHOWACT)==0){this.SetFieldActivator(d,-1)}};IDPanelSrv.prototype.SetFieldUnbound=function(b,a){this.Fields[b].Unbound=a;this.Fields[b].CauseValidation=false};IDPanelSrv.prototype.SetFieldValidation=function(b,a){this.Fields[b].CauseValidation=a};IDPanelSrv.prototype.SetFieldTransformation=function(d,c,a,b){this.Fields[d].Transformation=c;this.Fields[d].TrFormat=a;this.Fields[d].TrOffset=b};IDPanelSrv.prototype.SetSubFrame=function(a,b){this.Fields[a].SubFrame=b};IDPanelSrv.prototype.GetFlags=function(b,c){var a=0;switch(b){case Glb.OBJ_PANEL:a=this.Flags;break;case Glb.OBJ_PAGE:a=this.Pages[c].Flags;break;case Glb.OBJ_GROUP:a=this.Groups[c].Flags;break;case Glb.OBJ_FIELD:if(!(this.ValidatingRow==-1||this.Fields[c].IdxPanel==-1)){a=this.Fields[c].GetDynFlags()}else{a=this.Fields[c].Flags}break}return a};IDPanelSrv.prototype.SetFlags=function(g,k,b,c){var d=0;var j=false;var h=false;var f=true;var e=true;var a=this.PanelMode!=-1;if(g==Glb.OBJ_FIELD){h=!(this.ValidatingRow==-1||this.Fields[k].IdxPanel==-1);if(a&&this.Fields[k].IdxPanel!=-1){f=this.Fields[k].IsPresent()}}switch(g){case Glb.OBJ_PANEL:d=this.Flags;break;case Glb.OBJ_PAGE:d=this.Pages[k].Flags;break;case Glb.OBJ_GROUP:d=this.Groups[k].Flags;break;case Glb.OBJ_FIELD:if(h){d=this.Fields[k].GetDynFlags()}else{d=this.Fields[k].Flags}break}if((d&c)!=b){j=true}d=d&(~c);d=d|b;switch(g){case Glb.OBJ_PANEL:this.Flags=d;if(j&&(c&Glb.PAN_CANUPDATE)!=0){this.RD3Change(RD3Glb.PAN_CANUPDATE)}if(j&&(c&Glb.PAN_CANDELETE)!=0){this.RD3Change(RD3Glb.PAN_CANDELETE)}if(j&&(c&Glb.PAN_CANINSERT)!=0){this.RD3Change(RD3Glb.PAN_CANINSERT)}if(j&&(c&Glb.PAN_CANSORT)!=0){this.RD3Change(RD3Glb.PAN_CANSORT)}if(j&&(c&Glb.PAN_CANSELECT)!=0){this.RD3Change(RD3Glb.PAN_CANSEARCH)}if(j&&(c&Glb.PAN_SCROLLREC)!=0){this.RD3Change(RD3Glb.PAN_HASSCROLLBAR)}break;case Glb.OBJ_PAGE:this.Pages[k].Flags=d;this.Pages[k].RD3Change(RD3Glb.PPG_FLAGS);break;case Glb.OBJ_GROUP:this.Groups[k].Flags=d;this.Groups[k].RD3Change(RD3Glb.PGR_FLAGS);break;case Glb.OBJ_FIELD:if(h){this.Fields[k].SetDynFlags(b,c)}else{if(j&&(c&Glb.OBJ_VISIBLE)!=0){this.Fields[k].RD3Change(RD3Glb.FLD_VISIBLE)}if(j&&(c&Glb.OBJ_ENABLED)!=0){this.Fields[k].RD3Change(RD3Glb.FLD_ENABLED)}if(j&&(c&Glb.FLD_SUPERACTIVE)!=0){this.Fields[k].RD3Change(RD3Glb.FLD_SUPERACTIVE)}this.Fields[k].Flags=d}break}this.EnableRoleFlags(g,k);if(g==Glb.OBJ_FIELD){if(a&&this.Fields[k].IdxPanel!=-1){e=this.Fields[k].IsPresent()}}if(this.PanelMode!=-1){a=f||e}if(j&&this.PanelMode!=-1&&!h&&a){this.CalcLayout()}};IDPanelSrv.prototype.SetRoleFlags=function(c,e,a,d){var b=0;switch(c){case Glb.OBJ_PANEL:b=this.RoleFlags;break;case Glb.OBJ_PAGE:b=this.Pages[e].RoleFlags;break;case Glb.OBJ_GROUP:b=this.Groups[e].RoleFlags;break;case Glb.OBJ_FIELD:b=this.Fields[e].RoleFlags;break}b=b&(~d);b=b|a;switch(c){case Glb.OBJ_PANEL:this.RoleFlags=b;break;case Glb.OBJ_PAGE:this.Pages[e].RoleFlags=b;break;case Glb.OBJ_GROUP:this.Groups[e].RoleFlags=b;break;case Glb.OBJ_FIELD:this.Fields[e].RoleFlags=b;break}switch(c){case Glb.OBJ_PANEL:if(this.DesignFlags==-1){this.DesignFlags=this.Flags}else{this.Flags=this.DesignFlags}break;case Glb.OBJ_PAGE:if(this.Pages[e].DesignFlags==-1){this.Pages[e].DesignFlags=this.Pages[e].Flags}else{this.Pages[e].Flags=this.Pages[e].DesignFlags}break;case Glb.OBJ_GROUP:if(this.Groups[e].DesignFlags==-1){this.Groups[e].DesignFlags=this.Groups[e].Flags}else{this.Groups[e].Flags=this.Groups[e].DesignFlags}break;case Glb.OBJ_FIELD:if(this.Fields[e].DesignFlags==-1){this.Fields[e].DesignFlags=this.Fields[e].Flags}else{this.Fields[e].Flags=this.Fields[e].DesignFlags}break}this.EnableRoleFlags(c,e);if(this.PanelMode!=-1){this.set_Visible((this.Flags&Glb.OBJ_VISIBLE)!=0);this.CalcLayout()}};IDPanelSrv.prototype.EnableRoleFlags=function(c,e){var b=0;var a=0;var d=0;switch(c){case Glb.OBJ_PANEL:d=Glb.PAN_CANDELETE|Glb.PAN_CANSELECT|Glb.PAN_CANUPDATE|Glb.PAN_CANINSERT|Glb.OBJ_VISIBLE;break;default:d=Glb.OBJ_ENABLED|Glb.OBJ_VISIBLE;break}switch(c){case Glb.OBJ_PANEL:b=this.Flags;break;case Glb.OBJ_PAGE:b=this.Pages[e].Flags;break;case Glb.OBJ_GROUP:b=this.Groups[e].Flags;break;case Glb.OBJ_FIELD:b=this.Fields[e].Flags;break}switch(c){case Glb.OBJ_PANEL:a=b&this.RoleFlags;break;case Glb.OBJ_PAGE:a=b&this.Pages[e].RoleFlags;break;case Glb.OBJ_GROUP:a=b&this.Groups[e].RoleFlags;break;case Glb.OBJ_FIELD:a=b&this.Fields[e].RoleFlags;break}b=b&(~d);b=b|(a&d);switch(c){case Glb.OBJ_PANEL:this.Flags=b;break;case Glb.OBJ_PAGE:this.Pages[e].Flags=b;this.Pages[e].RD3Change(RD3Glb.PPG_FLAGS);break;case Glb.OBJ_GROUP:this.Groups[e].Flags=b;this.Groups[e].RD3Change(RD3Glb.PGR_FLAGS);break;case Glb.OBJ_FIELD:this.Fields[e].Flags=b;break}};IDPanelSrv.prototype.SetHeaderSize=function(b,d,c,a){switch(b){case Glb.OBJ_PANEL:this.HeaderSize=a;this.RD3Change(RD3Glb.PAN_HEADERSIZE);break;case Glb.OBJ_GROUP:if(c==0){this.Groups[d].HeaderWidth=a}else{this.Groups[d].HeaderHeight=a}break;case Glb.OBJ_FIELD:this.Fields[d].SetHeaderSize(c,a);break}};IDPanelSrv.prototype.SetHeaderPos=function(b,d,c,a){switch(b){case Glb.OBJ_GROUP:if(c==Glb.PANEL_LIST){this.Groups[d].ListHdrPos=a;this.Groups[d].RD3Change(RD3Glb.PGR_LISTHDERPOS)}else{this.Groups[d].FormHdrPos=a;this.Groups[d].RD3Change(RD3Glb.PGR_FORMHDRPOS)}break}};IDPanelSrv.prototype.GetImage=function(a,c,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[c].Image;case Glb.OBJ_GROUP:return this.Groups[c].Image;case Glb.OBJ_FIELD:return this.Fields[c].Image;case Glb.OBJ_PANEL:return this.iImage}return""};IDPanelSrv.prototype.SetImage=function(b,e,d,a,c){if(c==undefined){c=false}switch(b){case Glb.OBJ_PAGE:this.Pages[e].Image=a;this.Pages[e].RD3Change(RD3Glb.PPG_IMAGE);break;case Glb.OBJ_GROUP:this.Groups[e].Image=a;this.Groups[e].RD3Change(RD3Glb.PGR_IMAGE);break;case Glb.OBJ_FIELD:this.Fields[e].Image=a;this.Fields[e].UseHilight=c;this.Fields[e].RD3Change(RD3Glb.FLD_IMAGE);this.Fields[e].RD3Change(RD3Glb.FLD_USEHL);break;case Glb.OBJ_PANEL:this.iImage=a;this.RD3FrameChange(RD3Glb.WFR_IMAGE);break}};IDPanelSrv.prototype.ImageResizeMode=function(a){return this.Fields[a].ImageResMode};IDPanelSrv.prototype.set_ImageResizeMode=function(b,a){if(this.Fields[b].ImageResMode!=a){this.Fields[b].ImageResMode=a;this.Fields[b].RD3Change(RD3Glb.FLD_IMGRESMODE)}};IDPanelSrv.prototype.SetIMDB=function(d,b,c){if(c==undefined){c=true}this.IMDB=d;this.UseIMDB=c;this.MstTblIndex=this.IMDB.TblByCode(b,this.MainFrm);this.mMstTblIndex=this.MstTblIndex;if(this.MstTblIndex>-1&&this.InitStatus!=Glb.INITST_SETFIND&&this.InitStatus!=Glb.INITST_SETFINDAL){for(var a=0;a<this.IMDB.TblNumField(this.MstTblIndex)-1;a++){this.IMDB.set_Value(this.MstTblIndex,a,0,new IDVariant())}}};IDPanelSrv.prototype.SetDOIMDB=function(b){for(var a=1;a<this.Queries.length;a++){if(this.Queries[a].IDColl!=null){this.Queries[a].IDColl.set_imdb(b)}if(this.Queries[a].Document!=null){this.Queries[a].Document.SetMainFrm(this.MainFrm,b)}}};IDPanelSrv.prototype.SetQuery=function(e,a,d,b,c){if(a==-1){this.Queries[e].AIQuery=d;this.Queries[e].AIFieldIndex=b}else{this.Queries[e].SetText(a,d);this.Queries[e].FieldIndex=b;if(a==0){this.Queries[e].iGuid=c}}};IDPanelSrv.prototype.SetQueryText=function(c,a,b){this.Queries[c].SetText(a,b)};IDPanelSrv.prototype.GetQueryText=function(b,a){return this.Queries[b].Text[a]};IDPanelSrv.prototype.SetQueryDB=function(c,b,a){this.Queries[c].DB=b;this.Queries[c].DBType=a};IDPanelSrv.prototype.SetQueryLKE=function(b,c,a){this.Queries[b].AddLKEParam(c,a)};IDPanelSrv.prototype.SetQueryIMDB=function(b,c,a){this.Queries[b].IMDBDataSource=c;this.Queries[b].IMDBPrimaryTable=a;if(!this.MainFrm.IsMobile()){if(this.iLocked){this.RD3FrameChange(RD3Glb.WFR_LOCKED);this.iLocked=false}if(this.Lockable){this.Lockable=false;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)}}if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}};IDPanelSrv.prototype.SetQueryVisibleColumn=function(b,a){this.Queries[b].AddVisibleColumn(a)};IDPanelSrv.prototype.SetQueryHeaderColumn=function(b,a,c){this.Queries[b].AddHeaderColumn(a,c)};IDPanelSrv.prototype.SetQueryDecodeColumn=function(a,b){this.Queries[a].SetDecodeColumn(b)};IDPanelSrv.prototype.SetMasterTable=function(b,a){this.Queries[b].MstTableName=a};IDPanelSrv.prototype.SetMaxRows=function(a){this.Queries[0].MaxRows=a};IDPanelSrv.prototype.GetMasterTable=function(a){return this.Queries[a].MstTableName};IDPanelSrv.prototype.SetRect=function(h,k,f,d,e,j,b,c,g){var a=new RectSrv();a.Left=d;a.Width=j;a.Height=b;a.Top=e;if(d instanceof IDVariant){switch(h){case Glb.OBJ_FIELD:a.Left=(d.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListLeft:this.Fields[k].FormLeft):d.intValue());a.Width=(j.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListWidth:this.Fields[k].FormWidth):j.intValue());a.Top=(e.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListTop:this.Fields[k].FormTop):e.intValue());a.Height=(b.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Fields[k].ListHeight:this.Fields[k].FormHeight):b.intValue());c=(c.Type==IDVariant.NULL?this.Fields[k].HResMode[f]:c.intValue());g=(g.Type==IDVariant.NULL?this.Fields[k].VResMode[f]:g.intValue());break;case Glb.OBJ_GROUP:a.Left=(d.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListLeft:this.Groups[k].FormLeft):d.intValue());a.Width=(j.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListWidth:this.Groups[k].FormWidth):j.intValue());a.Top=(e.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListTop:this.Groups[k].FormTop):e.intValue());a.Height=(b.Type==IDVariant.NULL?(f==Glb.PANEL_LIST?this.Groups[k].ListHeight:this.Groups[k].FormHeight):b.intValue());break;case Glb.OBJ_PANEL:a.Left=(d.Type==IDVariant.NULL?this.ListLeft:d.intValue());a.Width=(j.Type==IDVariant.NULL?this.ListWidth:j.intValue());a.Top=(e.Type==IDVariant.NULL?this.ListTop:e.intValue());a.Height=(b.Type==IDVariant.NULL?this.ListHeight:b.intValue());c=(c.Type==IDVariant.NULL?this.HListResizeMode:c.intValue());g=(g.Type==IDVariant.NULL?this.VListResizeMode:g.intValue());break;case Glb.OBJ_RECT:a.Left=(d.Type==IDVariant.NULL?this.BoundRect.Left:d.intValue());a.Width=(j.Type==IDVariant.NULL?this.BoundRect.Width:j.intValue());a.Top=(e.Type==IDVariant.NULL?this.BoundRect.Top:e.intValue());a.Height=(b.Type==IDVariant.NULL?this.BoundRect.Height:b.intValue());break}}switch(h){case Glb.OBJ_FIELD:this.Fields[k].SetRect(f,a,c,g);break;case Glb.OBJ_GROUP:this.Groups[k].set_GrpRect(f,a);break;case Glb.OBJ_PANEL:this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.HListResizeMode=c;this.VListResizeMode=g;this.RD3Change(RD3Glb.PAN_LISTLEFT);this.RD3Change(RD3Glb.PAN_LISTTOP);this.RD3Change(RD3Glb.PAN_LISTWIDTH);this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.RD3Change(RD3Glb.PAN_HRESMODE);this.RD3Change(RD3Glb.PAN_VRESMODE);break;case Glb.OBJ_RECT:this.BoundRect=a;this.LastResizeHeight=a.Height;this.LastResizeWidth=a.Width;break}};IDPanelSrv.prototype.SetSize=function(c,a){switch(c){case Glb.OBJ_FIELD:this.Fields=new Array(a);break;case Glb.OBJ_PAGE:this.Pages=new Array(a);break;case Glb.OBJ_GROUP:this.Groups=new Array(a);break;case Glb.OBJ_QUERY:this.Queries=new Array(a);break}for(var b=0;b<a;b++){switch(c){case Glb.OBJ_FIELD:this.Fields[b]=new PFieldSrv();this.Fields[b].Index=b;this.Fields[b].Parent=this;this.Fields[b].set_MultiSelectionComboBox(this.MainFrm.ParamsObj().MultiSelectionComboBox);break;case Glb.OBJ_PAGE:this.Pages[b]=new PPageSrv();this.Pages[b].Index=b;this.Pages[b].Parent=this;break;case Glb.OBJ_GROUP:this.Groups[b]=new PGroupSrv();this.Groups[b].Index=b;this.Groups[b].Parent=this;this.Groups[b].set_Collapsible(this.MainFrm.ParamsObj().UseCollapsableGroups);break;case Glb.OBJ_QUERY:this.Queries[b]=new PQuerySrv();this.Queries[b].Index=b;this.Queries[b].Parent=this;break}}if(this.MainFrm.IsMobile()&&this.ObjType==Glb.OBJ_QUERY){this.Queries[0].MaxRows=1000}};IDPanelSrv.prototype.set_SetString=function(b,a){if(b==-1){this.MasterRowName=a}};IDPanelSrv.prototype.SetValueListItem=function(c,b,a,g,d,h,f){this.Fields[c].AddVLItem(b,a,g,d,h);this.Fields[c].RD3Change(RD3Glb.FLD_VALUELIST);if(!f){for(var e=0;e<this.NumRows;e++){this.Fields[c].bValues(e).SearchValueList()}}};IDPanelSrv.prototype.ClearValueList=function(a){this.Fields[a].ValueList=new ArrayList();this.Fields[a].RD3Change(RD3Glb.FLD_VALUELIST);for(var b=0;b<this.NumRows;b++){this.Fields[a].bValues(b).ValueListIndexes=new Array(0)}};IDPanelSrv.prototype.SetNumRow=function(b,d,c,a){if(c==Glb.PANEL_LIST){this.Fields[d].ListNumRow=a;this.Fields[d].RD3Change(RD3Glb.FLD_LISTNUMROWS)}else{this.Fields[d].FormNumRow=a;this.Fields[d].RD3Change(RD3Glb.FLD_FORMNUMROWS)}};IDPanelSrv.prototype.SetRowSelector=function(a){this.ShowRowSelector=a;this.RD3Change(RD3Glb.PAN_SHOWROWSELECTOR);this.CalcLayout()};IDPanelSrv.prototype.UFields=function(){return this.Fields.length};IDPanelSrv.prototype.UQueries=function(){return this.Queries.length};IDPanelSrv.prototype.UPages=function(){return this.Pages.length};IDPanelSrv.prototype.UGroups=function(){return this.Groups.length};IDPanelSrv.prototype.UMaster=function(){return this.MasterFields.length};IDPanelSrv.prototype.bFields=function(a){return this.Fields[a]};IDPanelSrv.prototype.bQueries=function(a){return this.Queries[a]};IDPanelSrv.prototype.bMaster=function(a){return this.MasterFields[a]};IDPanelSrv.prototype.bGroups=function(a){return this.Groups[a]};IDPanelSrv.prototype.bPages=function(a){return this.Pages[a]};IDPanelSrv.prototype.CalcLayout=function(){if(this.PanelMode==-1){if(((this.Flags&Glb.PAN_HASFORM)>0&&(this.Flags&Glb.PAN_STARTFORM)>0)||(this.Flags&Glb.PAN_HASLIST)==0){this.PanelMode=Glb.PANEL_FORM}else{this.PanelMode=Glb.PANEL_LIST}this.set_Visible((this.Flags&Glb.OBJ_VISIBLE)!=0);for(var k=0;k<this.Fields.length;k++){this.Fields[k].QBELike=this.MainFrm.ParamsObj().PanelsLikeSearch}if(this.GroupingEnabled()&&this.ShowGroups()&&this.SortingList.Count()>0){this.set_ShowGroups(true)}}this.FirstListFld=null;this.LastListFld=null;var q=this.MaxHRow;this.MaxHRow=0;var s=(this.ShowRowSelector)?Glb.SELECT_OFFSET:0;var o=this.PanelMode;this.PanelMode=Glb.PANEL_LIST;var p=-1;for(var k=0;k<this.Fields.length;k++){var j=this.GetTabOrderFieldIdx(k,this.PanelMode);if(this.Fields[j].IsPresent()&&(this.Fields[j].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[j].Flags&Glb.FLD_LISTLIST)>0){var h=this.Fields[j].ListWidth;this.Fields[j].ListLeft=s+this.ListLeft;s=s+h;this.ScrollPos=s+this.ListLeft;if(this.Fields[j].ListHeight>this.MaxHRow){this.MaxHRow=this.Fields[j].ListHeight}if(this.Fields[j].Group!=-1&&this.Fields[j].Group!=p){this.Groups[this.Fields[j].Group].ListLeft=this.Fields[j].ListLeft-((this.ShowRowSelector)?Glb.SELECT_OFFSET:0);p=this.Fields[j].Group}if(this.Fields[j].IdxPanel!=-1){if(this.FirstListFld==null){this.FirstListFld=this.Fields[j]}this.LastListFld=this.Fields[j]}}}if(q!=this.MaxHRow){this.RD3Change(RD3Glb.PAN_MAXHROW)}this.PanelMode=o;var a=this.NumRows;if(this.NumRows==0||this.PanelMode==Glb.PANEL_FORM||this.MaxHRow>0){this.NumRows=1}if(this.MaxHRow>0){var f=0;for(var k=0;k<this.Fields.length;k++){f=1;if(this.PanelMode==Glb.PANEL_LIST&&(this.Fields[k].Flags&Glb.FLD_INLIST)!=0&&this.Fields[k].IdxPanel>=0&&(this.Fields[k].Flags&Glb.FLD_LISTLIST)!=0){f=Math.floor((this.ListHeight-(this.Fields[k].ListTop-this.ListTop)-this.MaxHRow)/(this.MaxHRow+this.OffsetRow()))+1;f=(f>1)?f:1}this.NumRows=(this.NumRows>f)?this.NumRows:f}}if(a!=this.NumRows){this.RD3Change(RD3Glb.PAN_NUMROWS)}for(var k=0;k<this.Fields.length;k++){this.Fields[k].set_BuffSize(this.NumRows)}var b=new Array(this.NumRows);for(var k=0;k<this.NumRows;k++){if(this.RowErrors!=null&&k<this.RowErrors.length&&this.RowErrors[k]!=null){b[k]=this.RowErrors[k]}else{b[k]=""}}this.RowErrors=b;var e=new Array(this.NumRows);for(var k=0;k<this.NumRows;k++){if(this.RDRowSel!=null&&k<this.RDRowSel.length){e[k]=this.RDRowSel[k]}}this.RDRowSel=e;if(this.iRowUpdateCount==null||this.iRowUpdateCount.length!=this.NumRows){this.iRowUpdateCount=new Array(this.NumRows);for(var k=0;k<this.NumRows;k++){this.iRowUpdateCount[k]=-1}}if(this.AttR>=this.NumRows){this.AttR=0}var c=0,d=0;for(var k=0;k<this.Fields.length;k++){if(this.Fields[k].IsPresent()&&this.Fields[k].IdxPanel==0){c=c+1}if(this.Fields[k].IdxPanel==0){d=d+1}}this.MasterFields=new Array(d);this.PresentFields=new Array(c);c=0;d=0;for(var k=0;k<this.Fields.length;k++){this.Fields[k].UpdateSubFrame();if(this.Fields[k].IsPresent()&&this.Fields[k].IdxPanel==0){this.PresentFields[c]=this.Fields[k];this.Fields[k].MstCol=c;c=c+1}if(this.Fields[k].IdxPanel==0){this.MasterFields[d]=this.Fields[k];d=d+1}if(this.Fields[k].Group>-1){this.Groups[this.Fields[k].Group].Page=this.Fields[k].Page}}if(this.iStatus==Glb.PS_NONE){if(this.Parent!=null&&this.Parent.OpenAs!=Glb.OPEN_MDI){this.Parent.CloseOnSelection=this.isSimpleList()}if(this.DynamicRows==0&&this.MainFrm.ParamsObj().AutoDynRows>0&&(this.isSimpleList()||this.MainFrm.IsMobile())){this.SetDynRows(this.MainFrm.ParamsObj().AutoDynRows,true)}var r=this.InitStatus;if(this.InitStatus==Glb.INITST_SETFIND||this.InitStatus==Glb.INITST_SETFINDAL){this.InitStatus=Glb.INITST_SEARCH;this.iStatus=Glb.PS_QBE;this.UpdatePanel(this.MainFrm);this.iStatus=Glb.PS_NONE;this.SaveQBE(1)}this.InitStatus=r;this.EnterQBE()}this.UpdateIndicator(false)};IDPanelSrv.prototype.SetModified=function(a){if(this.iStatus==Glb.PS_DATA){this.set_Status(Glb.PS_UPDATE)}if((this.Flags&Glb.PAN_AUTOSAVE)!=0&&this.iStatus==Glb.PS_UPDATE&&!this.AutoSaveSamFl){this.NeedAutoSave=true}for(var b=1;b<this.UQueries();b++){if(this.Queries[b].FieldIndex==-1){this.Queries[b].UpdateLookup(-1,a)}}};IDPanelSrv.prototype.ProcessRequest=function(k,f,t,d){var y=false;var G=false;var B=false;this.NeedAutoSave=false;if(d){this.InfoPriority=0;for(var C=0;C<this.Fields.length;C++){var l=this.Fields[C].ProcessRequest(k,f,t);if(l&&!G&&this.VS.ControlType(this.Fields[C].VisualStyle)==Glb.VISCTRL_CHECK){G=true}y=y||l}for(var C=1;C<this.Queries.length;C++){if(this.Queries[C].UpdateLKE(k)){y=true}}if(y){if(G&&this.iStatus!=Glb.PS_UPDATE&&(this.Flags&Glb.PAN_CANINSERT)!=0){var c=true;var z=this.Queries[0].GetAttRecNumber();var v=this.Queries[0].RecordCount();for(var C=0;C<this.NumRows;C++){var b=this.IsRowModified(C);c=c||b;if(!b&&C+z>v){for(var A=0;A<this.Fields.length;A++){this.Fields[A].bValues(C).Clear()}}}if(!c){y=false}}}if(y){this.SetModified(k)}this.ReValidate();var a=this.AttR;if(this.ShowRowSelector){if(!k.ParamsObj().UseFastRowSelector){var u=k.GetParameter("S"+this.FrIndex);if(u!=null&&u.length>0){this.AttR=parseInt(u.substr(1),10);this.SetInput();k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption());B=true}}else{for(var A=0;A<this.NumRows;A++){if(k.GetParameter("S"+this.FrIndex+"R"+A+".x")!=null){this.AttR=A;this.SetInput();var g=false;if(f!=null){if(f.OpenAs!=Glb.OPEN_MDI&&f.CloseOnSelection){k.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",A);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(A+1)+" nel pannello "+this.GetDTTCaption());g=true}}if(!g){k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption())}B=true;this.AcknowledgeWarnings();break}}}if(this.AttR>=this.NumRows||this.AttR<0){this.AttR=0}}if(this.EnableMultipleSel()){if(this.ShowMultipleSel()){var F=false;for(var A=0;A<this.NumRows;A++){var o=k.GetParameter("CHK"+this.FrIndex+"R"+A);if(o!=null){if(this.RD3MultiSel(A,o.length>0)){F=true}}}if(F){var H=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,true,H)}}if(k.GetParameter("chks"+this.FrIndex+".x")!=null){this.RD3PanelCommand("seltog")}if(k.GetParameter("chkn"+this.FrIndex+".x")!=null){this.RD3PanelCommand("selnone")}if(k.GetParameter("chka"+this.FrIndex+".x")!=null){this.RD3PanelCommand("selall")}}if(!B){if(f.ActiveElement.length>5&&f.ActiveElement.substr(0,("F"+this.FrIndex+"C").length).equals("F"+this.FrIndex+"C")){var z=f.ActiveElement.indexOf("R");if(z>0){try{var A=parseInt(f.ActiveElement.substr(z+1),10);if(A>=0&&A<this.NumRows&&A!=this.AttR){var v=f.ActiveElement.indexOf("C");v=parseInt(f.ActiveElement.substr(v+1,z-(v+1)),10);if(v>=0&&v<this.Fields.length){if(this.Fields[v].IsReadOnly(this.Fields[v].VisualStyle,this.AttR)){this.AttR=A;k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to Cursor change",DTTRequest.PRI_DATA);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected by pressing ENTER onto the field "+this.Fields[v].GetDTTCaption(),"",this.AttR);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption()+" premendo ENTER sul campo "+this.Fields[v].GetDTTCaption())}}}}catch(E){}}}}var q=false;for(var C=0;C<this.Fields.length&&!q;C++){for(var A=0;A<this.NumRows;A++){if(this.Fields[C].CanActivate(A)&&this.Fields[C].IdxPanel!=-1){if(k.GetParameter("A"+this.FrIndex+"C"+C+"R"+A+".x")!=null){this.AttR=A;k.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to field activation",DTTRequest.PRI_DATA);q=true;break}}}}if(a!=this.AttR||y){k.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,37,"IDPanel.ProcessRequest","Panel "+this.GetDTTCaption()+": selected Row = "+(this.AttR+1));this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}if(B){this.FireOnSelectingRow()}}if(this.WasHidden&&!d){k.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update performed for the first time (the panel was either invisible, collapsed or not exposed)");this.UpdatePanel(k);this.WasHidden=false}if(!d){this.ReValidate();if(k.GetParameter("lck"+this.FrIndex+".x")!=null){this.RD3PanelCommand("lock")}if(k.GetParameter("unl"+this.FrIndex+".x")!=null){this.RD3PanelCommand("unlock")}if(k.GetParameter("top"+this.FrIndex+".x")!=null){this.RD3PanelCommand("top")}if(k.GetParameter("bottom"+this.FrIndex+".x")!=null){this.RD3PanelCommand("bottom")}if(k.GetParameter("next"+this.FrIndex+".x")!=null){this.RD3PanelCommand("next")}if(k.iwrd_wce.startsWith("PAN"+this.FrIndex+":MOV")){if(PanelCommand(Glb.PCM_NAVIGATION,4,true)){this.ScrollRecTo(parseInt(k.iwrd_wce.substr(("PAN"+this.FrIndex+":MOV").length),10),k)}}if(k.GetParameter("prev"+this.FrIndex+".x")!=null){this.RD3PanelCommand("prev")}if(k.GetParameter("find"+this.FrIndex+".x")!=null){this.RD3PanelCommand("find")}if(k.GetParameter("search"+this.FrIndex+".x")!=null){this.RD3PanelCommand("search")}if(k.GetParameter("delete"+this.FrIndex+".x")!=null){this.RD3PanelCommand("delete")}if(k.GetParameter("refresh"+this.FrIndex+".x")!=null){this.RD3PanelCommand("refresh")}if(k.GetParameter("cancel"+this.FrIndex+".x")!=null){this.RD3PanelCommand("cancel")}if(k.GetParameter("save"+this.FrIndex+".x")!=null){this.RD3PanelCommand("save")}if(k.GetParameter("insert"+this.FrIndex+".x")!=null){this.RD3PanelCommand("insert")}if(k.GetParameter("dupl"+this.FrIndex+".x")!=null){this.RD3PanelCommand("dupl")}if(k.GetParameter("print"+this.FrIndex+".x")!=null){this.RD3PanelCommand("print")}if(k.GetParameter("csv"+this.FrIndex+".x")!=null){this.RD3PanelCommand("csv")}if(k.GetParameter("att"+this.FrIndex+".x")!=null){this.RD3PanelCommand("attach")}if(k.GetParameter("list"+this.FrIndex+".x")!=null){this.RD3PanelCommand("list")}for(var x=0;x<WebFrameSrv.MAX_CUSTOMCOMMANDS;x++){var h=Glb.PCM_CUSTOM1<<x;if(this.IsCommandEnabled(h)&&WebFrameSrv.CustomCommands[x]!=null){if(k.GetParameter("cc"+(x+1)+this.FrIndex+".x")!=null){k.DTTObj.SetRequestName("Command "+WebFrameSrv.CustomCommands[x].Caption,"Panel "+this.GetDTTCaption()+": custom command "+WebFrameSrv.CustomCommands[x].Caption,DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cc"+(x+1));k.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone "+WebFrameSrv.CustomCommands[x].Caption+" nella toolbar del pannello "+this.GetDTTCaption()+" ("+WebFrameSrv.CustomCommands[x].ToolTip+")");this.PanelCommand(h,0,true)}}}for(var C=0;C<this.Pages.length;C++){if(k.GetParameter("page"+this.FrIndex+"_"+C+".x")!=null){k.DTTObj.SetRequestName("Change Page","Panel "+this.GetDTTCaption()+": go to page "+this.Pages[C].Header,DTTRequest.PRI_CMD);this.set_Page(C);k.DTTObj.AddTestItem(this.Pages[C].iGuid,DTTEngine.TST_PANCHGPG,"Panel "+this.GetDTTCaption()+" change page","");k.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone CHANGE-PAGE nella toolbar del pannello "+this.GetDTTCaption());break}}for(var C=0;C<this.Fields.length;C++){if(this.Fields[C].DataType==Glb.DT_DOC_OLE&&this.Status()==Glb.PS_DATA){if(k.GetParameter("delblob"+this.FrIndex+"_"+C+".x")!=null){this.RD3PanelCommand("delblob"+C);break}if(k.GetParameter("uplblob"+this.FrIndex+"_"+C+".x")!=null){this.RD3PanelCommand("upload"+C);break}}else{var u=k.GetParameter("sort"+this.FrIndex+"_"+C+".x");if(u!=null&&u.length>0){var D=parseInt(k.GetParameter("sort"+this.FrIndex+"_"+C+".y"),10);this.RD3Sort(C,D)}}}var q=false;for(var C=0;C<this.Fields.length&&!q;C++){for(var A=0;A<this.NumRows;A++){if(this.Fields[C].CanActivate(A)){if(k.GetParameter("A"+this.FrIndex+"C"+C+"R"+A+".x")!=null){k.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[C].GetDTTCaption()+" activated for row"+(A+1),DTTRequest.PRI_CMD);k.DTTObj.AddTestItem(this.Fields[C].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[C].GetDTTCaption()+" activation","",A+"act");k.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[C].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga "+(A+1))+" nel panello "+this.GetDTTCaption());this.Fields[C].Activate(A);q=true;break}}}}if(f.OpenAs!=Glb.OPEN_MDI&&f.CloseOnSelection){for(var A=0;A<this.NumRows;A++){if(k.GetParameter("S"+this.FrIndex+"R"+A+".x")!=null){k.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);if(!k.ParamsObj().UseFastRowSelector){k.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",A);k.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(A+1)+" nel pannello "+this.GetDTTCaption())}this.MainFrm.UnloadForm(f.FormIdx,true);break}}}}if(this.NeedAutoSave){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}this.UpdateIndicator(false);for(var C=0;C<this.Fields.length;C++){if(this.Fields[C].SubFrame>0){f.Frames[this.Fields[C].SubFrame].ProcessRequest(k,t,d)}}};IDPanelSrv.prototype.GetBoundRect=function(b){if(b==undefined){b=false}if(this.BoundRect!=null&&this.BoundRect.Width>0&&this.BoundRect.Height>0&&!b){return this.BoundRect}else{var e=new RectSrv();var d=new RectSrv();for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].IsPresent()){d=this.Fields[c].GetValueRect(this.PanelMode,this.NumRows-1);if(d.Left+d.Width>e.Width){e.Width=d.Left+d.Width}if(d.Top+d.Height>e.Height){e.Height=d.Top+d.Height}d=this.Fields[c].GetHeaderRect(this.PanelMode);if(d.Left+d.Width>e.Width){e.Width=d.Left+d.Width}if(d.Top+d.Height>e.Height){e.Height=d.Top+d.Height}}}if(this.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_SCROLLREC)!=0){var a=this.ScrollPos+Glb.SCROLL_OFFSET;if(e.Width<a){e.Width=a}}e.Width=e.Width+2*Glb.HEADER_GAP;e.Height=e.Height+2*Glb.HEADER_GAP;return e}};IDPanelSrv.prototype.FindData=function(c,g,b){var f=false;if(this.iStatus!=Glb.PS_QBE&&!b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,78,"IDPanel.FindData","Panel "+this.GetDTTCaption()+": can't find data (status <> QBE)")}return f}if(this.iStatus==Glb.PS_QBE){this.SaveQBE(1)}if(this.Queries[0].FindData(c,g)){if(this.QBEEmpty&&this.Queries[0].RecordCount()==0&&!b&&!g&&this.Queries[0].NumQBEParameters>0){this.MainFrm.set_AlertMessage(new IDVariant(c.RTCObj.GetConst("D6CE2977-47A4-4BB4-BB6A-D28B1F5D63EB","Nessun dato trovato. Modificate i criteri di ricerca oppure premete F7 per inserire un nuovo dato")));this.iStatus=Glb.PS_DATA;this.RD3Change(RD3Glb.PAN_STATUS);this.EnterQBE();this.RefreshDynProp();return f}if(this.Queries[0].IMDBDataSource==-1||this.iStatus==Glb.PS_QBE){var a=this.iStatus;this.iStatus=Glb.PS_QBE;this.QBETip=this.GetQBETips();this.QBETipText=this.GetQBETips(false);this.RD3Change(RD3Glb.PAN_QBETIP);this.iStatus=a}this.set_Status(Glb.PS_DATA);this.Queries[0].FillPanel(c);if(this.MainFrm.IsMobile()&&this.OrgDynRows>0){var e=this.ActualPosition();if(e>this.Queries[0].RecordCount()){e=this.Queries[0].RecordCount()}if(e<=this.OrgDynRows){this.SetDynRows(this.OrgDynRows,this.DynamicHeight)}}if(this.IsDO()){this.UpdateDynRows(this.Queries[0].RecordCount())}if(!this.IsDO()){this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows);if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}var h=this.AttR;var d=this.ActualPosition();this.FireAfterFind((g)?Glb.PCM_INSERT:Glb.PCM_FIND);if(this.GroupingEnabled()&&this.ShowGroups()&&this.GroupingList.Count()>0){this.RefreshGrouping(true)}f=(h!=this.AttR)||(d!=this.ActualPosition());if((this.Flags&Glb.PAN_QBEFORM)!=0&&!g&&(this.Queries[0].RecordCount()>1||this.MainFrm.IsMobile())){this.set_Layout(Glb.PANEL_LIST)}this.ReValidate();this.ResetRD3Cache()}return f};IDPanelSrv.prototype.ScrollRecBy=function(d,a,b,c){if(b==undefined){b=true}if(c==undefined){c=true}if(!b||this.iStatus==Glb.PS_DATA){this.Queries[0].ScrollBy(d);this.Queries[0].FillPanel(a,c);this.ReValidate()}else{if(this.iStatus==Glb.PS_UPDATE){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}}};IDPanelSrv.prototype.ScrollRecTo=function(c,a,b){if(b==undefined){b=true}if(!b||this.iStatus==Glb.PS_DATA){this.Queries[0].ScrollTo(c);this.Queries[0].FillPanel(a);this.ReValidate()}else{if(this.iStatus==Glb.PS_UPDATE){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}}};IDPanelSrv.prototype.UpdateIndicator=function(f){this.IndText="";if(!f){var d=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var e="";switch(this.iStatus){case Glb.PS_QBE:this.IndText=this.MainFrm.RTCObj.GetConst("B04012F8-21CC-45C3-9879-B32D52AF4061","Inserisci criteri di ricerca");e=this.MainFrm.RTCObj.GetConst("ED702DCB-EEFD-42B0-BF49-02CF6B902BD4","Inserisci nella riga evidenziata i criteri di ricerca, poi premi il tasto <img "+d+' src="images/find_sm.gif" alt=""> per cercare i dati nel database.');break;case Glb.PS_UPDATE:this.IndText=this.MainFrm.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","DATI MODIFICATI");e=this.MainFrm.RTCObj.GetConst("4F66F26E-D6C9-471C-8C2C-B63B0BB83E31","Hai modificato i dati visualizzati; se vuoi registrarli nel database premi <img "+d+' src="images/update_sm.gif" alt="">, se vuoi annullare le modifiche premi <img '+d+' src="images/cancel_sm.gif" alt="">.');break;case Glb.PS_DATA:var g=this.Queries[0].RecordCount();var b=this.Queries[0].GetAttRecNumber()+this.AttR;if(g==-1){this.IndText=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB",new IDVariant("Riga |1")),new IDVariant(b),null,null,null,null,null).stringValue()}else{if(b<=g){this.IndText=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576",new IDVariant("Riga |1 di |2")),new IDVariant(b),new IDVariant(g),null,null,null,null).stringValue();if(this.Queries[0].IDColl!=null&&this.Queries[0].IDColl.HasMoreElements){this.IndText+="+"}}else{this.IndText=this.MainFrm.RTCObj.GetConst("6ABFFB5D-2E2C-40EF-AD39-9FADA6B96563","Nuova Riga")}}if(this.Locked()&&this.Lockable){e=this.MainFrm.RTCObj.GetConst("12218460-A979-4AE4-A515-C2691BC5365E","Per modificare i dati visualizzati devi prima sbloccare il pannello premendo <img "+d+' src="images/lock_sm.gif" alt="">.')}else{if(!this.Locked()){if(b>g){e=this.MainFrm.RTCObj.GetConst("5F525AD6-9B6B-422A-BE62-1AAF758DD5B5","Puoi inserire una nuova riga scrivendo i dati direttamente qui. Per salvarli premi il tasto <img "+d+' src="images/update_sm.gif" alt="">.')}else{if(this.Parent.OpenAs!=Glb.OPEN_MDI){if(this.ShowRowSelector){if(this.isSimpleList()&&this.Parent.CloseOnSelection){e=this.MainFrm.RTCObj.GetConst("76DF611E-651B-47E1-BD35-AF20C5C0A701","Cliccando un tasto <img "+d+' src="images/rs.gif" alt=""> riporterai i dati selezionati nella videata sottostante.')}else{if(this.Parent.VisualFlag(Glb.FORMVISPROP_CONFIRMBTN)!=0){e=this.MainFrm.RTCObj.GetConst("CAFC58E3-A710-4182-95C1-02790F6E2CB0","Seleziona una riga premendo <img "+d+' src="images/rs.gif" alt="">, poi premi <img '+d+' src="images/myes_sm.gif" alt=""> per riportare i dati nella videata sottostante.')}}}else{if(this.isSimpleList()&&this.Parent.CloseOnSelection){e=this.MainFrm.RTCObj.GetConst("55EFD258-557A-476B-847A-75FD6513B9AB","Facendo doppio click su una cella riporterai i dati selezionati nella videata sottostante.")}else{if(this.Parent.VisualFlag(Glb.FORMVISPROP_CONFIRMBTN)!=0){e=this.MainFrm.RTCObj.GetConst("CDB6D1ED-65FE-4E9C-AFC4-8420A0DA42AB","Seleziona una riga posizionando il cursore su una cella, poi premi <img "+d+' src="images/myes_sm.gif" alt=""> per riportare i dati nella videata sottostante.')}}}}else{e=IDL.FormatMessage(this.MainFrm.RTCObj.GetConst("C52DA618-C8C9-4FF0-A3A6-81445E3B054E",new IDVariant("Sono state trovate |1 righe; puoi scorrerle con i tasti freccia, oppure modificare i dati")),new IDVariant(g),null,null,null,null,null).stringValue()}}}}if(this.Parent.HasOtherMessages(this)){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,41,"IDPanel.UpdateIndicator","Panel "+this.GetDTTCaption()+": hide info message "+e)}e=""}break}if(this.Queries[0].IsMasterDO){if(this.Queries[0].IDColl==null){this.IndText=""}var a=false;if(this.Queries[0].DocTempl!=null){a=this.Queries[0].IDColl.IsModified()}else{var c=this.GetDocument();if(c!=null){a=c.IsModified()}}if(a!=this.MasterDocMod){this.MasterDocMod=a;this.RD3Change(RD3Glb.PAN_STATUS);this.SetRDRowSel(-1,true)}if(a&&this.Queries[0].DocTempl!=null){this.SetRDRowSel(-1,true)}if(a){this.IndText=this.MainFrm.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","MODIFICATO");e=this.MainFrm.RTCObj.GetConst("4F66F26E-D6C9-471C-8C2C-B63B0BB83E31","Hai modificato i dati visualizzati; se vuoi registrarli nel database premi <img "+d+' src="images/update_sm.gif" alt="">, se vuoi annullare le modifiche premi <img '+d+' src="images/cancel_sm.gif" alt="">.')}}this.SetInfoMessage(e,0)}};IDPanelSrv.prototype.EnterQBE=function(){if(this.iStatus!=Glb.PS_DATA&&this.iStatus!=Glb.PS_NONE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,42,"IDPanel.EnterQBE","Panel "+this.GetDTTCaption()+" status is not DATA (Current status = "+this.DecodeStatus(this.iStatus)+")")}return}if(this.Queries.length>0){this.Queries[0].CloseData();if((this.Flags&Glb.PAN_QBEFORM)!=0){this.set_Layout(Glb.PANEL_FORM)}this.SaveQBE(2);this.AttR=0;this.Queries[0].UpdateIMDB(0,true,true,true);this.set_Status(Glb.PS_QBE);this.ResetRD3Cache();this.Queries[0].DoUpdateLookups(0,this.MainFrm);if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}}};IDPanelSrv.prototype.DeleteRecord=function(j,e){if(e==undefined){e=false}var k=new IDVariant();var g=true;if(this.iStatus!=Glb.PS_DATA||(this.Flags&Glb.PAN_CANDELETE)==0){g=false}if(this.Queries[0].GetAttRecNumber()+this.AttR>this.Queries[0].RecordCount()){g=false}if(g){if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}this.FireBeforeDelete(k);if(k.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,79,"IDPanel.DeleteRecord","Panel "+this.GetDTTCaption()+": record delete canceled")}g=false}}if(g){if(!(this.Queries[0].DeleteRecord(j))){g=false;if(!this.IsDO()){this.Queries[0].RefreshQuery(j)}else{var f=this.GetDocument();if(f!=null){this.DumpDocErrors(f,this.AttR,true,null)}}}}if(g){if(!this.IsDO()){for(var c=this.Queries[0].GetAttRecNumber()+this.AttR-1;c<this.SelectedRows.length-1;c++){this.SelectedRows[c]=this.SelectedRows[c+1]}this.SelectedRows[this.SelectedRows.length-1]=false;if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}this.FireAfterDelete();this.ClearRD3Cache(this.Queries[0].GetAttRecNumber()+this.AttR);this.RD3Change(RD3Glb.PAN_TOTALROWS);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_STATUS)}if(!e&&this.SortingList!=null&&this.SortingList.Count()>0){this.EnableSorting()}var a=0;if(!e){var b=this.Queries[0].GetAttRecNumber();var h=this.Queries[0].RecordCount();if(b+this.NumRows>h){a=h-(b+this.NumRows)+1}}this.ScrollRecBy(a,j);if(!e){var b=this.Queries[0].GetAttRecNumber();var h=this.Queries[0].RecordCount();if(b==1&&this.AttR>=h){this.SetInput(h-1,this.FocusedColumn(),1,false)}this.SetInfoMessage(j.RTCObj.GetConst("3B24C9F0-A217-41B3-BC27-D02224BCE92E","La riga è stata cancellata come richiesto."));if(!this.IsIMDB()&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.MainFrm.SoundAction("play","delete")}this.UpdateDynRows(this.Queries[0].RecordCount())}}return g};IDPanelSrv.prototype.RefreshQuery=function(a){var b=true;if(this.iStatus==Glb.PS_QBE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,80,"IDPanel.RefreshQuery","Panel "+this.GetDTTCaption()+": refresh not done (status = QBE)")}b=false}if(b&&this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(b&&this.Queries[0].RefreshQuery(a)){this.set_Status(Glb.PS_DATA);this.ResetRD3Cache();this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),a);if(!this.IsDO()){this.SelectedRows=new Array(this.Queries[0].RecordCount()+this.NumRows)}this.FireAfterFind(Glb.PCM_REQUERY);this.ReValidate();this.SetInfoMessage(a.RTCObj.GetConst("D6EBD0AE-8610-419F-B17C-6B89516A780F","I dati sono stati riletti dal database."));if(!this.IsDO()&&this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}else{b=false}};IDPanelSrv.prototype.CancelUpdate=function(b){if(this.iStatus==Glb.PS_QBE){this.SaveQBE(3);this.Queries[0].DoUpdateLookups(0,this.MainFrm);this.Queries[0].UpdateIMDB(0,true,true,true);this.SetInfoMessage(b.RTCObj.GetConst("B9659CF1-1CF2-43f1-A8B8-BC093C796877","I criteri di ricerca sono stati azzerati"));return}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.Queries[0].IsDO){if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.RestoreOriginal();this.Queries[0].IDColl.ClearErrors();this.ResetRD3Cache();this.Queries[0].BlobCache.Clear()}else{var f=this.GetDocument();if(f!=null){if(f.IsModified()){this.ResetRD3Cache();this.Queries[0].BlobCache.Clear()}f.RestoreOriginal();f.ClearErrors()}}this.ReleaseLock()}var a=this.iStatus;this.RD3ClearLookups();this.iStatus=Glb.PS_DATA;this.ScrollRecBy(0,b,false);this.iStatus=a;this.set_Status(Glb.PS_DATA);this.SetRDRowSel(-1,true);this.RD3Change(RD3Glb.PAN_STATUS);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_TOTALROWS)}var c=this.Queries[0].ActualPosition;var e=this.Queries[0].RecordCount();if(c>e){this.ScrollRecBy(c-e,b,false)}this.SetInfoMessage(b.RTCObj.GetConst("DDF707E9-8BED-48E6-B60E-2FE128DAD5C9","Le modifiche ai dati sono state annullate"));this.UpdateDynRows(this.Queries[0].RecordCount())};IDPanelSrv.prototype.UpdateRecords=function(g,s,l){if(s==undefined){s=false}if(l==undefined){l=null}var k=true;var t=false;if(this.iStatus!=Glb.PS_UPDATE){k=this.Queries[0].IsDO;if(!k&&this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,81,"IDPanel.UpdateRecords","Panel "+this.GetDTTCaption()+": update not done (status <> UPDATED)")}}this.FinalUpdate=!s||!this.Queries[0].IsDO;this.ReValidate();if(this.iStatus==Glb.PS_UPDATE&&this.IsPanelInError()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,82,"IDPanel.UpdateRecords","Panel "+this.GetDTTCaption()+": update not done (panel is in error state)")}k=false}if(this.MainFrm.ParamsObj().UseRD3&&this.Queries[0].IsMasterDO&&!s){this.Parent.RemovePanelTempMsg(this)}if(k){if(!this.Queries[0].UpdateRecords(g)){k=false}}if(!this.Queries[0].IsMasterDO&&!s&&this.MasterPanelIdx>0){if(k){if(this.Queries[0].IDColl!=null){if(l==null){l=new ArrayList()}}this.Parent.Frames[this.MasterPanelIdx].Content.UpdateRecords(this.MainFrm,false,l);this.RD3Change(RD3Glb.PAN_STATUS)}else{if(this.Queries[0].IDColl!=null){this.DumpCollErrors(this.Queries[0].IDColl,true,null,l)}else{this.DumpDocErrors(this.GetDocument(),this.AttR,true,l)}}}else{if(l!=null){var q=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": Updating Master Document -> Firing OnPanelCommand(PCM_UPDATE) event")}this.Parent.OnPanelCommand(this,new IDVariant(Glb.PCM_UPDATE),q,new IDVariant(false));if(q.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": Updating Master Document canceled")}return false}}}if(this.Queries[0].IsMasterDO&&!s){if(this.Queries[0].DocTempl!=null||this.CanSaveMasterDoc()){var A=this.GetDocument();var C=new ArrayList();if(this.Queries[0].DocTempl!=null){k=this.Queries[0].IDColl.Validate(0)}else{if(A!=null){A.ReconnectChildren(9999);k=A.Validate(0,9999,true)}else{k=false}}var r="";if(k){try{if(this.Queries[0].DocTempl!=null){k=this.Queries[0].IDColl.SaveToDB(9999,false)}else{k=A.SaveToDB(9999,false)}if(k&&this.MainFrm!=null){g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,189,"IDPanel.UpdateRecords","Panel "+this.GetDTTCaption()+": refreshing "+this.Queries[0].MstTableName+" lookups");this.Queries[0].RefreshAllLookups()}if(k){this.ReleaseLock()}g.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,59,"IDPanel.FireAfterCommit","Panel "+this.GetDTTCaption()+": Fire AfterCommit After Document Saving");this.Parent.AfterCommit(this,new IDVariant(1),new IDVariant(0))}catch(z){r=z.message;k=false}}if(!k){t=true;var c=null;if(this.Queries[0].DocTempl==null){this.DumpDocErrors(A,this.AttR,true,l);c=A.GetFailedDoc()}else{var f=this.Parent.Messages.Count();this.DumpCollErrors(this.Queries[0].IDColl,true,null,l);c=this.Queries[0].IDColl.GetFailedDoc();if(f==this.Parent.Messages.Count()&&this.MainFrm.ParamsObj().AllowMasterPanelNav){var b=this.Queries[0].IDColl.UIMode();var v=this.Queries[0].IDColl.AbsolutePosition();this.Queries[0].IDColl.set_UIMode(true);this.Queries[0].IDColl.MoveFirst();var o=0;var h=false;while(!this.Queries[0].IDColl.IsEof()){var D=this.Queries[0].IDColl.GetAt();if(D.HasErrors()){h=true;break}this.Queries[0].IDColl.MoveNext();o++}this.Queries[0].IDColl.set_UIMode(b);this.Queries[0].IDColl.set_AbsolutePosition(v);if(h){if(o+1<this.Queries[0].GetAttRecNumber()||o+1>this.Queries[0].GetAttRecNumber()+this.NumRows){this.ScrollRecTo(o+1,this.MainFrm,false);this.set_SelectedRow(0)}else{if(o+1-this.Queries[0].GetAttRecNumber()!=this.AttR){this.set_SelectedRow(o+1-this.Queries[0].GetAttRecNumber())}}this.DumpCollErrors(this.Queries[0].IDColl,true,null,l);c=this.Queries[0].IDColl.GetFailedDoc()}}}var q=new IDVariant(true);var B=new IDVariant(true);g.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.GetDTTCaption()+": Fire OnDBError Event");this.Parent.OnDBError(this,q,B,new IDVariant(),new IDVariant(r!=null?r:""),new IDVariant(),new IDVariant(Glb.PANOP_UPDATE),c)}}}if(k){this.set_Status(Glb.PS_DATA);this.ScrollRecBy(0,g,true,!s);this.SetInfoMessage(g.RTCObj.GetConst("F2967EE7-7E44-494E-851E-C92610167032","Le modifiche ai dati sono state registrate nel database"));if(!s&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.MainFrm.SoundAction("play","update")}}else{if(t||this.IsPanelInError()){var a=null;var u=false;var p=-1;var m=-1;for(var y=0;y<this.NumRows&&!u;y++){for(var x=0;x<this.Fields.length&&!u;x++){if(this.Fields[x].bValues(y).IsError()){if(a==null){a=this.Fields[x];m=x;p=y}if(this.Fields[x].Page==this.Page()){u=true}}}}if(!u&&a!=null&&a.Page!=-1&&a.Page!=this.Page()){this.set_Page(a.Page);if(this.Page()==a.Page){this.SetInput(p,m,1)}}if(this.CanAddErrMsg(-1,IDPanelSrv.EM_MSGBOX)&&this.MainFrm!=null){g.set_AlertMessage(new IDVariant(g.RTCObj.GetConst("2B8EC54C-226D-46B7-AF0B-47A1489AAAEC","Impossibile salvare i dati. E' necessario prima correggere gli errori indicati nella barra dei messaggi.")))}else{this.SetInfoMessage(g.RTCObj.GetConst("E785334F-B7B1-4BF9-9E32-8C3101DDB78C","Non è stato possibile registrare i dati nel database per gli indicati motivi."))}}}this.SetRDRowSel(-1,true);this.RD3Change(RD3Glb.PAN_TOTALROWS);return k};IDPanelSrv.prototype.GoInsertRecord=function(a){var c=true;if(this.iStatus==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.GoInsertRecord","Panel "+this.GetDTTCaption()+": insert not done (status = UPDATED)")}c=false}if(c&&(this.Locked()&&this.EnableInsertWhenLocked())){this.set_Locked(false);if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.GoInsertRecord","Panel "+this.GetDTTCaption()+": insert not done (locked = true)")}c=false}}if(c&&this.iStatus==Glb.PS_QBE){var b=this.InitStatus;this.FindData(a,true,false);if(this.iStatus!=Glb.PS_DATA){c=false}if(b!=this.InitStatus&&b==Glb.INITST_NEWROW){this.InitStatus=Glb.INITST_NEWROW}}if(c){if((this.Flags&Glb.PAN_QBEFORM)!=0){this.set_Layout(Glb.PANEL_FORM)}if(this.MainFrm.IsMobile()&&this.DynamicRows<=this.Queries[0].RecordCount()){this.SetDynRows(this.Queries[0].RecordCount()+1,this.DynamicHeight)}if(!this.MainFrm.IsMobile()||this.Layout()==Glb.PANEL_FORM){this.ScrollRecTo(2147483647,a)}var d=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(d<0){d=0}if(d>this.NumRows-1){d=this.NumRows-1}this.AttR=d;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();if((this.Flags&Glb.PAN_NEWINSMODE)!=0||this.InitStatus==Glb.INITST_NEWROW){this.MasterFields[0].bValues(this.AttR).Modified=true;this.MasterFields[0].bValues(this.AttR).Text="§";this.SetModified(a);this.ReValidate();if(this.MasterFields[0].bValues(this.AttR).Text.equals("§")){this.MasterFields[0].bValues(this.AttR).Text="";if(!this.Queries[0].IsDO){this.MasterFields[0].bValues(this.AttR).Modified=false}else{if((this.Flags&Glb.PAN_AUTOSAVE)!=0){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}}}}}};IDPanelSrv.prototype.DuplicateRecord=function(a){var c=true;var g=new Array(this.UMaster());if(this.iStatus==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.DuplicateRecord","Panel "+this.GetDTTCaption()+": duplicate not done (status = UPDATED)")}c=false}if(this.IsNewRow()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,83,"IDPanel.DuplicateRecord","Panel "+this.GetDTTCaption()+": duplicate not done (empty row selected)")}c=false}if(c){if(!this.Queries[0].IsDO){var e=false;for(var b=0;b<this.UMaster();b++){if(!this.MasterFields[b].Unbound&&this.MasterFields[b].Index!=this.Queries[0].AIFieldIndex){if(!e&&(this.MasterFields[b].Flags&Glb.FLD_ISDESCR)!=0&&Glb.ClassDT(this.MasterFields[b].DataType)==Glb.DTC_CHAR&&(this.MasterFields[b].MaxLength>=this.MasterFields[b].bValues(this.AttR).Value.stringValue().length+7)){e=true;g[b]=IDL.Add(this.MasterFields[b].bValues(this.AttR).Value,new IDVariant(" (Copy)"))}else{g[b]=this.MasterFields[b].bValues(this.AttR).Value}}else{g[b]=new IDVariant()}}if(this.Queries[0].RecordCount()+1>this.NumRows){this.ScrollRecTo(this.Queries[0].RecordCount()+2-this.NumRows,a)}var f=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(f<0){f=0}if(f>this.NumRows-1){f=this.NumRows-1}this.AttR=f;this.SetInput();for(var b=0;b<this.UMaster();b++){this.MasterFields[b].bValues(this.AttR).SetNewValue(g[b])}this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetModified(a);this.ReValidate();this.SetRDRowSel(this.AttR,true)}else{var h=this.GetDocument();if(this.Queries[0].IDColl!=null&&h!=null){this.ClearRD3Cache(this.Queries[0].GetAttRecNumber()+this.AttR);this.RD3Change(RD3Glb.PAN_TOTALROWS);h.Duplicate(9999,this.Queries[0].IDColl);this.SetRDRowSel(this.AttR+1,true);this.Queries[0].LastRC++;this.ScrollRecBy(1,this.MainFrm)}}}};IDPanelSrv.prototype.FireDBError=function(b,a,d,c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,64,"IDPanel.FireDBError","Panel "+this.GetDTTCaption()+": Fire DBError Event")}this.Parent.DBError(this,b,new IDVariant(a),new IDVariant(d),c)};IDPanelSrv.prototype.DownloadBlob=function(a,b){var f=false;var e=-1;var g=-1;for(var d=0;d<this.UMaster()&&e==-1;d++){if(this.MasterFields[d].DataType==Glb.DT_DOC_OLE){for(var c=0;c<this.NumRows;c++){if(this.MasterFields[d].bValues(c).Value.intValue()==a){e=c;g=d;break}}}}if(e!=this.AttR&&e>-1){this.Queries[0].UpdateIMDB(e,true,false,false)}f=this.Queries[0].DownloadBlob(a,b,false);if(f){this.MasterFields[g].bValues(e).RD3Change(RD3Glb.VAL_TEXT)}if(e!=this.AttR&&e>-1){this.Queries[0].UpdateIMDB(this.AttR,true,false,false);this.IMDB.TblResetModified(this.MstTblIndex,-1)}return f};IDPanelSrv.prototype.CanAddErrMsg=function(e,c){if(e==undefined){e=-1}if(c==undefined){c=IDPanelSrv.EM_MESSAGE}var a;var b=this.IsNewRow(e);if(!b&&this.Queries[0].IsDO){var f=this.GetDocument(e);if(f!=null){b=f.Inserted()}}if(this.FinalUpdate){if(this.AutoSaveSamFl&&c==IDPanelSrv.EM_MSGBOX){a=false}else{if(b){a=this.FinalInsErrorMode<=c}else{a=this.FinalUpdErrorMode<=c}}}else{if(b){a=this.EditInsErrorMode<=c}else{a=this.EditUpdErrorMode<=c}}return a};IDPanelSrv.prototype.SetFieldErrorText=function(e,g,b,h,a){if(b==undefined){b=IDDocument.ERR_ERROR}if(h==undefined){h=false}if(a==undefined){a=null}var f=this.ValidatingRow>-1?this.ValidatingRow:this.AttR;var d=false;if(!this.Fields[e].bValues(f).SetError(g,b)){if(this.CanAddErrMsg()){if(!h){this.Parent.SetMessage(this.Fields[e],b==IDDocument.ERR_ERROR?AMessageSrv.MSG_STOP:AMessageSrv.MSG_WARN,g,"","VAL",(this.NumRows>1)?f+1:0,false,a);d=true}if(this.Fields[e].IsPresent()&&this.Fields[e].IsVisible(f)&&(b==IDDocument.ERR_ERROR||b==IDDocument.ERR_WARNACK)){var c=this.ValidatingRow;this.ValidatingRow=-1;this.SetInput(f,e,1,false);this.ValidatingRow=c}}}this.RDRowSel[f]=true;return d};IDPanelSrv.prototype.SetErrorText=function(b){var a=this.ValidatingRow>-1?this.ValidatingRow:this.AttR;this.RowErrors[a]=b;this.RDRowSel[a]=true;if(this.CanAddErrMsg()){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,b,"","VAL",(this.NumRows>1)?this.ValidatingRow+1:0,false)}};IDPanelSrv.prototype.FireValidateCell=function(d,c,a,b,f,e){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,65,"IDPanel.FireValidateCell","Panel "+this.GetDTTCaption()+": Fire ValidateCell Event")}this.Parent.ValidateCell(this,d,c,a,b,f,e)};IDPanelSrv.prototype.FireValidateRow=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,66,"IDPanel.FireValidateRow","Panel "+this.GetDTTCaption()+": Fire ValidateRow Event")}this.Parent.ValidateRow(this,a)};IDPanelSrv.prototype.IsRowInError=function(b){if(this.RowErrors[b].length>0){return true}for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].bValues(b).IsError()){return true}}return false};IDPanelSrv.prototype.IsPanelInError=function(){for(var a=0;a<this.NumRows;a++){if(this.IsRowInError(a)){return true}}return false};IDPanelSrv.prototype.GetRowError=function(a){return this.RowErrors[a]};IDPanelSrv.prototype.SetRowError=function(b,c){var a=true;if(c.length!=0){a=this.CanAddErrMsg()}this.RowErrors[b]=c;if(a){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,c,"","VAL",(this.NumRows>1)?b+1:0,false)}};IDPanelSrv.prototype.ReValidate=function(){var o=new IDVariant();var k=false;var g=false;var a=false;var d=false;var b=this.Queries[0].RecordCount();var c=this.Queries[0].GetAttRecNumber();for(var e=0;e<this.Fields.length;e++){this.Fields[e].ResetDynProp()}if(this.iStatus==Glb.PS_UPDATE&&this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.MainFrm!=null&&!this.DisableNotification){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,69,"IDPanel.ReValidate","Panel "+this.GetDTTCaption()+": Fire OnDynamicProperties Event for rows = 1 to "+this.NumRows)}for(var f=0;f<this.NumRows;f++){this.Queries[0].UpdateIMDB(f,true,false,true);this.ValidatingRow=f;k=false;if(this.iStatus==Glb.PS_UPDATE){k=this.RowErrors[f].length>0;if(!k){g=true;for(var e=0;e<this.MasterFields.length;e++){g&=this.MasterFields[e].bValues(f).Text.length==0;if(this.MasterFields[e].bValues(f).NotValidated||this.MasterFields[e].bValues(f).IsError()||(this.MasterFields[e].bValues(f).Modified&&!this.MasterFields[e].bValues(f).Value.equals(this.MasterFields[e].bValues(f).LastValue))){k=true}}if((c+this.ValidatingRow)>b){k=!g;if(g){this.RowErrors[f]="";for(var l=0;l<this.Fields.length;l++){if(this.bFields(l).IdxPanel!=0){this.bFields(l).bValues(f).ClearError()}}}}}}if(k){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,39,"IDPanel.ReValidate","Panel "+this.GetDTTCaption()+": revalidating row "+(this.ValidatingRow+1))}a=this.RowErrors[f].length>0;this.RowErrors[f]="";for(var l=0;l<this.Fields.length;l++){if(this.bFields(l).IdxPanel!=0){this.bFields(l).bValues(f).ClearError()}}for(var e=0;e<this.Fields.length;e++){if((c+this.ValidatingRow)>b||this.Fields[e].bValues(f).NotValidated||this.Fields[e].bValues(f).IsError()||(this.Fields[e].bValues(f).Modified&&!this.Fields[e].bValues(f).Value.equals(this.Fields[e].bValues(f).LastValue))||(this.Fields[e].bValues(f).Modified&&a)){this.Fields[e].ValidateCell(this.ValidatingRow)}}for(var e=1;e<this.Queries.length;e++){this.Queries[e].ValidateLookup(f)}this.FireValidateRow(o);if(this.LastMasterDocument!=null){var p=new IDVariant();if(!this.LastMasterDocument.GetLock(9999,"",p)){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,p.ToString(),"","VAL",(this.NumRows>1)?f+1:0,false)}}for(var e=0;e<this.UMaster();e++){if(this.bMaster(e).IdxPanel==0){var h=this.bMaster(e).UpdateField(f);d=d||h}}}if(!this.DisableNotification){this.Parent.DynamicProperties(this)}for(var e=0;e<this.Fields.length;e++){this.Fields[e].bValues(f).SaveDynProp()}}this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.ValidatingRow=-1;if(d){this.SetModified(this.MainFrm)}return d};IDPanelSrv.prototype.IsRowModified=function(c){var d=false;var a=true;for(var b=0;b<this.UMaster();b++){d=d||this.bMaster(b).bValues(c).Modified;a=a&&this.bMaster(b).bValues(c).IsEmptyValue();if(d&&!a){break}}return d&&!a};IDPanelSrv.prototype.FireCellActivated=function(b,a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,44,"IDPanel.FireCellActivated","Panel "+this.GetDTTCaption()+": Fire CellActivated Event (Current Row = "+(this.ValidatingRow+1)+", Column Index = "+(b.intValue()+1)+")")}this.Parent.CellActivated(this,b,a)};IDPanelSrv.prototype.FireBeforeFind=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,45,"IDPanel.FireBeforeFind","Panel "+this.GetDTTCaption()+": Fire BeforeFind Event")}this.Parent.BeforeFind(this,a)};IDPanelSrv.prototype.FireOnChangeRow=function(){if(!this.DisableNotification){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,46,"IDPanel.FireOnChangeRow","Panel "+this.GetDTTCaption()+": Fire OnChangeRow Event")}this.AdjustExtProp();this.Parent.OnChangeRow(this);if(this.IsDO()){this.RD3Change(RD3Glb.PAN_ENABLEDCOMMANDS)}}};IDPanelSrv.prototype.FireBeforeUpdate=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,47,"IDPanel.FireBeforeUpdate","Panel "+this.GetDTTCaption()+": Fire BeforeUpdate Event")}this.Parent.BeforeUpdate(this,a)};IDPanelSrv.prototype.FireBeforeInsert=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,50,"IDPanel.FireBeforeInsert","Panel "+this.GetDTTCaption()+": Fire BeforeInsert Event")}this.Parent.BeforeInsert(this,a)};IDPanelSrv.prototype.FireBeforeDelete=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,51,"IDPanel.FireBeforeDelete","Panel "+this.GetDTTCaption()+": Fire BeforeDelete Event")}this.Parent.BeforeDelete(this,a)};IDPanelSrv.prototype.FireAfterFind=function(a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,56,"IDPanel.FireAfterFind","Panel "+this.GetDTTCaption()+": Fire AfterFind Event")}this.Parent.AfterFind(this,new IDVariant(a))};IDPanelSrv.prototype.FireOnSelectingRow=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,57,"IDPanel.FireOnSelectingRow","Panel "+this.GetDTTCaption()+": Fire OnSelectingRow Event")}this.Parent.OnSelectingRow(this)};IDPanelSrv.prototype.FireOnSorting=function(b,a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,172,"IDPanel.FireOnSorting","Panel "+this.GetDTTCaption()+": Fire OnSorting Event")}this.Parent.OnSorting(this,new IDVariant(b),a)};IDPanelSrv.prototype.FireOnChangeSelection=function(f,b,d,e,c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,190,"IDPanel.FireOnChangeSelection","Panel "+this.GetDTTCaption()+": Fire OnChangeSelection "+(d?"final":"")+" Event")}var a=this.ValidatingRow;if(!d){this.Queries[0].UpdateIMDB(f-this.Queries[0].GetAttRecNumber(),true,false,e);this.ValidatingRow=f-this.Queries[0].GetAttRecNumber()}this.Parent.OnChangeSelection(this,new IDVariant(b),new IDVariant(d),c);if(!d){this.Queries[0].UpdateIMDB(this.AttR,true,false,e);this.ValidatingRow=a}};IDPanelSrv.prototype.FireAfterUpdate=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,52,"IDPanel.FireAfterUpdate","Panel "+this.GetDTTCaption()+": Fire AfterUpdate Event")}this.Parent.AfterUpdate(this)};IDPanelSrv.prototype.FireAfterInsert=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,54,"IDPanel.FireAfterInsert","Panel "+this.GetDTTCaption()+": Fire AfterInsert Event")}this.Parent.AfterInsert(this)};IDPanelSrv.prototype.FireAfterDelete=function(){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,55,"IDPanel.FireAfterDelete","Panel "+this.GetDTTCaption()+": Fire AfterDelete Event")}this.Parent.AfterDelete(this)};IDPanelSrv.prototype.FireCreateDocument=function(b,a){this.MainFrm.CreateDocument(b,a)};IDPanelSrv.prototype.set_Status=function(b){var a=this.iStatus;this.iStatus=b;if(b!=a){this.RD3Change(RD3Glb.PAN_STATUS);if(b!=Glb.PS_QBE){this.InitStatus=Glb.INITST_SEARCH}if(this.GroupingEnabled()&&this.ShowGroups()&&this.iStatus==Glb.PS_QBE){this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident())}if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,36,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": status changed from "+this.DecodeStatus(a)+" to "+this.DecodeStatus(b))}this.Parent.OnChangeStatus(this,new IDVariant(a))}};IDPanelSrv.prototype.Status=function(){return this.iStatus};IDPanelSrv.prototype.OffsetRow=function(){return this.VS.RowOffset(this.iVisualStyle)};IDPanelSrv.prototype.OffsetHeader=function(){return this.VS.HeaderOffset(this.iVisualStyle)};IDPanelSrv.prototype.BackColor=function(){return this.VS.Color(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.BackGradColor=function(){if(this.BackColor()!=-1){return this.VS.GradCol(this.iVisualStyle,Glb.VISCLR_BACKPANEL)}else{return -1}};IDPanelSrv.prototype.BackGradDir=function(){return this.VS.GradDir(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.Opacity=function(){return this.VS.Opacity(this.iVisualStyle,Glb.VISCLR_BACKPANEL)};IDPanelSrv.prototype.ResetSortList=function(){for(var a=0;a<this.SortingList.Count();a++){var b=this.SortingList[a];if(b.SortMode!=0){b.RD3Change(RD3Glb.FLD_SORTMODE)}b.SortMode=0;if(b.SortFld!=-1){if(this.Fields[b.SortFld].SortMode!=0){this.Fields[b.SortFld].RD3Change(RD3Glb.FLD_SORTMODE)}this.Fields[b.SortFld].SortMode=0}}this.SortingList.Clear()};IDPanelSrv.prototype.AddToSortList=function(c,b){var a=this.Fields[c];if(a.SortFld!=-1){a=this.Fields[a.SortFld]}if(a.IdxPanel!=0){return}if(this.SortingList.IndexOf(a)==-1){this.SortingList.Add(a)}a.RD3Change(RD3Glb.FLD_SORTMODE);a.SortMode=(b)?1:-1;this.Fields[c].RD3Change(RD3Glb.FLD_SORTMODE);this.Fields[c].SortMode=(b)?1:-1};IDPanelSrv.prototype.EnableSorting=function(){if(this.iStatus!=Glb.PS_DATA){return}var d=(this.SelectedRows!=null?this.SelectedRows.clone():null);var e=(this.Queries[0].LookupRows!=null?this.Queries[0].LookupRows.clone():null);var c=new ArrayList();if(this.GroupingEnabled()&&this.ShowGroups()&&this.Status()!=Glb.PS_QBE&&this.GroupingList.Count()>0){for(var a=0;a<this.GroupingList.Count();a++){var g=this.GroupingList[a];if(g.SortFld!=-1){g=this.Fields[g.SortFld]}c.Add(g)}}c.AddRange(this.SortingList);var h=this.SortingList;this.SortingList=c;if(this.Queries[0].EnableSorting(c)){this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),this.MainFrm);this.ResetRD3Cache()}this.SortingList=h;if(this.Queries[0].IMDBDataSource!=-1){this.SelectedRows=new Array(this.SelectedRows.length);if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}else{if(!this.IsDO()){if(e!=null){this.SelectedRows=new Array(this.SelectedRows.length);for(var b=0;b<this.SelectedRows.length;b++){if(b<e.length){this.SelectedRows[e[b]-1]=d[b]}else{this.SelectedRows[b]=false}}}if(this.Queries[0].LookupRows!=null){d=this.SelectedRows.clone();for(var b=0;b<this.SelectedRows.length;b++){if(b<this.Queries[0].LookupRows.length){this.SelectedRows[b]=d[this.Queries[0].LookupRows[b]-1]}else{this.SelectedRows[b]=false}}}if(this.MainFrm.ParamsObj().UseRD3){this.RD3Sendmulti=true}}}};IDPanelSrv.prototype.SaveQBE=function(b){var c="";switch(b){case 1:c="Saving";break;case 2:c="Loading";break;case 3:c="Clearing";break}if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,38,"IDPanel.SaveQBE","Panel "+this.GetDTTCaption()+": "+c+" QBE criteria")}for(var a=0;a<this.UMaster();a++){switch(b){case 1:if((this.MasterFields[a].Flags&Glb.FLD_AUTOLOOKUP)!=0&&!this.MasterFields[a].iMultiCriteria){this.MasterFields[a].LastQBE=this.MasterFields[a].bValues(0).Value.stringValue()}else{this.MasterFields[a].LastQBE=this.MasterFields[a].bValues(0).Text}this.MasterFields[a].LastQBEPos=this.MasterFields[a].bValues(0).ValueListIndexes;break;case 2:this.MasterFields[a].bValues(0).SetNewText(this.MasterFields[a].LastQBE,(this.MasterFields[a].Flags&Glb.FLD_AUTOLOOKUP)!=0&&!this.MasterFields[a].iMultiCriteria);this.MasterFields[a].bValues(0).ValueListIndexes=this.MasterFields[a].LastQBEPos;break;case 3:this.MasterFields[a].LastQBE="";this.MasterFields[a].LastQBEPos=new Array(0);this.MasterFields[a].iMultiCriteria=false;if(this.iStatus==Glb.PS_QBE){this.MasterFields[a].bValues(0).Clear()}this.QBETip="";this.QBETipText="";this.RD3Change(RD3Glb.PAN_QBETIP);break}}};IDPanelSrv.prototype.QBEFilter=function(a){return this.Fields[a].LastQBE};IDPanelSrv.prototype.set_QBEFilter=function(g,e,b){if(b==undefined){b=true}this.Fields[g].LastQBE=e;if(this.iStatus==Glb.PS_QBE){this.Fields[g].bValues(0).SetNewText(e,false);this.Queries[0].UpdateIMDB(0,true,false,false)}if(e.length==0||(e.charAt(0)=="="&&!this.Fields[g].HasConcept("DO_ID"))){this.Fields[g].iMultiCriteria=false}else{this.Fields[g].iMultiCriteria=(e.indexOf(this.Fields[g].GetQBESep())>0)}if(this.MainFrm.IsMobile()&&b){for(var a=0;a<this.Fields.length;a++){var d=this.Fields[a];if((d.Flags&Glb.FLD_INLIST)!=0&&(d.Flags&Glb.FLD_LISTLIST)!=0&&Glb.ClassDT(d.DataType)==Glb.DTC_CHAR){if(g==a){var c=this.MainFrm.RD3AddEvent("searchval",this.GetRD3Ident());c.SetAttribute("val",e)}break}}}};IDPanelSrv.prototype.UploadBlob=function(b,d,e){var a=e.QueryString.WCE;for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].bValues(this.AttR).Uploading||this.Fields[c].GetRD3Ident().equals(a)){this.Queries[0].UploadBlob(this.Fields[c].bValues(this.AttR).Value.intValue(),b,this.Fields[c].MaxUploadSize);this.Fields[c].bValues(this.AttR).Uploading=false;this.Fields[c].bValues(this.AttR).RD3Change(RD3Glb.VAL_TEXT);break}}};IDPanelSrv.prototype.SetFieldBlobSize=function(d,a,c,b){if(a instanceof IDVariant){a=(a.Type==IDVariant.NULL?this.Fields[d].MaxAutoShowSize:a.intValue());c=(c.Type==IDVariant.NULL?this.Fields[d].MaxUploadSize:c.intValue())}this.Fields[d].MaxAutoShowSize=a;if(c==0||c>1024*this.MainFrm.ParamsObj().MaxRequestSize){c=1024*this.MainFrm.ParamsObj().MaxRequestSize;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,197,"PField.SetBlobSize","Field "+this.Fields[d].GetDTTCaption()+": MaxUploadSize set to MaxRequestSize = "+this.MainFrm.ParamsObj().MaxRequestSize+"KB")}}this.Fields[d].MaxUploadSize=c;this.Fields[d].BlobNewWindow=b};IDPanelSrv.prototype.SetFieldBlobExtensions=function(c,a,b){this.Fields[c].UploadExtensions=a;this.Fields[c].UploadDescription=b};IDPanelSrv.prototype.SetFieldMultiUpload=function(c,b,a){if(this.Fields[c].IdxPanel==-1){this.Fields[c].MultiUpload=true;this.Fields[c].MaxUploadFiles=b;if(a==0||a>1024*this.MainFrm.ParamsObj().MaxRequestSize){if(this.MainFrm!=null&&a>0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,197,"PField.SetMultiUpload","Field "+this.Fields[c].GetDTTCaption()+": MaxSize set to MaxRequestSize = "+this.MainFrm.ParamsObj().MaxRequestSize+"KB")}a=1024*this.MainFrm.ParamsObj().MaxRequestSize}this.Fields[c].MaxUploadSize=a}};IDPanelSrv.prototype.MaxLength=function(a){return this.Fields[a].MaxLength};IDPanelSrv.prototype.set_MaxLength=function(b,a){this.Fields[b].MaxLength=a;this.Fields[b].RD3Change(RD3Glb.FLD_MAXLENGTH)};IDPanelSrv.prototype.FieldText=function(a){if(this.Fields[a].IdxPanel==-1){return this.Fields[a].Header}else{if(this.ValidatingRow==-1){return this.Fields[a].bValues(this.AttR).Text}else{if(this.Fields[a].bValues(this.ValidatingRow).NotValidated){return this.Fields[a].bValues(this.ValidatingRow).LastText}else{return this.Fields[a].bValues(this.ValidatingRow).Text}}}};IDPanelSrv.prototype.set_FieldText=function(b,a){if(this.Fields[b].IdxPanel==-1){if(!this.Fields[b].Header.equals(a)){this.Fields[b].Header=a;this.Fields[b].RD3Change(RD3Glb.FLD_HEADER)}}else{if(this.ValidatingRow==-1){this.Fields[b].bValues(this.AttR).Text=a;this.Fields[b].bValues(this.AttR).RD3Change(RD3Glb.VAL_TEXT)}else{this.Fields[b].bValues(this.ValidatingRow).DynText=true;this.Fields[b].bValues(this.ValidatingRow).Text=a;this.Fields[b].bValues(this.ValidatingRow).RD3Change(RD3Glb.VAL_TEXT)}}};IDPanelSrv.prototype.set_FieldCode=function(b,a){this.Fields[b].Code=a};IDPanelSrv.prototype.HasCaptionCommands=function(){return this.ShowToolbar};IDPanelSrv.prototype.Value=function(a){if(this.MstTblIndex>-1){var b=this.IMDB.FldByCode(this.MstTblIndex,a);if(b>-1){return this.IMDB.Value(this.MstTblIndex,b,0)}}return new IDVariant()};IDPanelSrv.prototype.set_Value=function(a,b){if(this.MstTblIndex>-1){var c=this.IMDB.FldByCode(this.MstTblIndex,a);if(c>-1){this.IMDB.set_Value(this.MstTblIndex,c,0,b)}}};IDPanelSrv.prototype.OrgValue=function(a){if(this.ValidatingRow==-1){return this.Fields[a].bValues(this.AttR).OrgValue}else{return this.Fields[a].bValues(this.ValidatingRow).OrgValue}};IDPanelSrv.prototype.UpdateDynRows=function(b){if(this.DynamicRows==0||this.PanelMode==Glb.PANEL_FORM){if(this.OriginalListHeight>0&&this.BoundRect!=null){this.ListHeight=this.OriginalListHeight;this.BoundRect.Height=this.OriginalBoundHeight;this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT)}if(this.DynamicHeight&&this.Parent!=null){if(this.Parent.Frames[this.FrIndex].OriginalHeight>0){this.Parent.Frames[this.FrIndex].FixedHeight=this.Parent.Frames[this.FrIndex].OriginalHeight}}return}if(b>-1){var a=(this.Flags&Glb.PAN_CANINSERT)!=0;if(this.MainFrm.IsMobile()){if((this.Flags&Glb.PAN_HASFORM)==0){a&=!this.Locked()}else{if(this.iLockable()&&this.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.PAN_HASFORM)!=0){a=false}}}if(a){if(this.DynamicRows==b&&this.MainFrm.IsMobile()){this.SetDynRows(b+1,this.DynamicHeight,false)}b++}if(b>this.DynamicRows){b=this.DynamicRows}if(b<1){b=1}this.LastDynRows=b}else{if(this.LastDynRows>0){b=this.LastDynRows}else{b=this.NumRows}}if(b!=this.NumRows||this.OriginalListHeight==0){this.RD3Change(RD3Glb.PAN_LISTHEIGHT);this.RD3Change(RD3Glb.PAN_NUMROWS);this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT)}if(this.OriginalListHeight==0&&this.BoundRect!=null){this.OriginalListHeight=this.ListHeight;this.OriginalBoundHeight=this.BoundRect.Height}this.ListHeight=this.HeaderSize+this.OffsetRow()+b*(this.MaxHRow+this.OffsetRow())+this.OffsetHeader();this.CalcLayout();if(this.DynamicHeight&&this.Parent!=null){if(this.Parent.Frames[this.FrIndex].OriginalHeight==0){this.Parent.Frames[this.FrIndex].OriginalHeight=this.Parent.Frames[this.FrIndex].FixedHeight}this.Parent.Frames[this.FrIndex].FixedHeight=this.ListTop+this.ListHeight+24;if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].FixedHeight+=12;if(!this.MainFrm.ParamsObj().Theme.equals("seattle")){this.Parent.Frames[this.FrIndex].FixedHeight+=4}}this.Parent.Frames[this.FrIndex].Height=this.Parent.Frames[this.FrIndex].FixedHeight;if(this.BoundRect!=null){this.BoundRect.Height=this.ListTop+this.ListHeight+24}}};IDPanelSrv.prototype.SetDynRows=function(c,a,b){if(b==undefined){b=true}if(this.DynamicRows!=c){this.DynamicRows=c;this.DynamicHeight=a;if(this.OrgDynRows==0){this.OrgDynRows=this.DynamicRows}this.RD3Change(RD3Glb.PAN_DYNAMICROWS);this.RD3Change(RD3Glb.PAN_DYNAMICHEIGHT);if(b&&this.Status()==Glb.PS_DATA){this.UpdateDynRows(this.Queries[0].RecordCount());this.ScrollRecTo(this.Queries[0].GetAttRecNumber(),this.MainFrm)}if(this.DynamicRows>0&&this.VListResizeMode!=Glb.RESMODE_NONE){this.VListResizeMode=Glb.RESMODE_NONE;this.RD3Change(RD3Glb.PAN_VRESMODE)}}};IDPanelSrv.prototype.FindField=function(b){if(b==null){return -1}for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].Code.equals(b)){return a}}return -1};IDPanelSrv.prototype.FieldCode=function(a){return this.bMaster(a).Code};IDPanelSrv.prototype.IsNewRow=function(c){if(c==undefined){c=-1}var b=c;if(b==-1){b=this.ValidatingRow}if(b==-1){b=this.AttR}var d=this.Queries[0].RecordCount();var a=this.Queries[0].GetAttRecNumber()+b;return a>d};IDPanelSrv.prototype.set_Visible=function(a){a=a&&((this.RoleFlags&Glb.OBJ_VISIBLE)!=0);if(this.Visible!=a){WebFrameSrv.prototype.set_Visible.call(this,a);for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].SubFrame>0){this.Parent.Frames[this.Fields[b].SubFrame].Content.set_Visible(a)}}if(this.Parent!=null&&this.Parent.Frames[this.FrIndex].InTabbed&&this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx]!=null){this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx].Content.ChangeItemVisibility(this.FrIndex,this.MainFrm)}}};IDPanelSrv.prototype.set_Collapsed=function(b){if(this.Collapsed!=b){WebFrameSrv.prototype.set_Collapsed.call(this,b);if(this.Collapsed==b){for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].SubFrame>0){this.Parent.Frames[this.Fields[a].SubFrame].Content.set_Collapsed(b)}}}}};IDPanelSrv.prototype.GetContentSize=function(){var c=new RectSrv();var b=new RectSrv();for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IsPresent()){b=this.Fields[a].GetValueRect(this.PanelMode,0);if(b.Left+b.Width>c.Width){c.Width=b.Left+b.Width}if(b.Top+b.Height>c.Height){c.Height=b.Top+b.Height}b=this.Fields[a].GetHeaderRect(this.PanelMode);if(b.Left+b.Width>c.Width){c.Width=b.Left+b.Width}if(b.Top+b.Height>c.Height){c.Height=b.Top+b.Height}}}c.Width=c.Width+Glb.HEADER_GAP;c.Height=c.Height+Glb.HEADER_GAP;if(this.BoundRect!=null){if(c.Height<this.BoundRect.Height){c.Height=this.BoundRect.Height}if(c.Width<this.BoundRect.Width){c.Width=this.BoundRect.Width}}this.BoundRect=c;return c};IDPanelSrv.prototype.Locked=function(){if(this.Queries[0].IsDO&&this.Queries[0].Document==null&&this.Queries[0].IDColl==null){return true}return this.iLocked};IDPanelSrv.prototype.set_Locked=function(a){if(a==this.iLocked){return}var b=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,67,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": "+(a?"locking":"unlocking")+"; fire OnChangeLocking event")}this.Parent.OnChangeLocking(this,new IDVariant(a),b);if(b.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,40,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": "+(a?"locking":"unlocking")+" canceled")}return}var e=this.Queries[0].IsDO;if(e){if(this.Queries[0].Document==null&&this.Queries[0].IDColl==null&&!a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,40,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": cannot unlock a NULL document panel")}return}if(a){var d=this.GetDocument();if(d!=null){if(d.IsModified()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,85,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": can't be locked (document is modified!)")}return}}}if(this.Queries[0].IsMasterDO&&!this.MainFrm.IsMobile()){for(var c=0;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c]!=null&&this.Parent.Frames[c].Content!=null&&this.Parent.Frames[c].Content!=this){if(this.Parent.Frames[c].Content instanceof IDPanelSrv){var g=this.Parent.Frames[c].Content;if(g.Queries[0].IsDO&&!g.Queries[0].IsMasterDO){g.set_Locked(a)}}}}}}else{if(!a){if(!this.CanBeUnlocked()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,85,"IDPanel.SetLocked","Panel "+this.GetDTTCaption()+": can't be unlocked (there is an UPDATED panel that can't be locked)")}return}for(var c=0;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c]!=null&&this.Parent.Frames[c].Content!=null&&this.Parent.Frames[c].Content!=this){if(this.Parent.Frames[c].Content instanceof IDPanelSrv){var g=this.Parent.Frames[c].Content;if(g.Lockable){g.set_Locked(true)}}}}}}this.iLocked=a;this.RD3FrameChange(RD3Glb.WFR_LOCKED);this.UpdateDynRows(this.Queries[0].RecordCount());if(this.Lockable){var f=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");if(this.Locked()){this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("5D4E319E-B352-4196-AC50-1EA42CE3BC70","Ora NON è possibile modificare i dati, premi il tasto <img "+f+' src="images/lock_sm.gif" alt=""> per modificarli.'))}else{this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("12862811-7F29-4CDE-A9A3-EF9C3A2A669F","Ora è possibile modificare i dati, premi il tasto <img "+f+' src="images/unlk_sm.gif" alt=""> per bloccare il pannello.'))}}};IDPanelSrv.prototype.ToString=function(){if(this.FrIndex>0){return this.Parent.Frames[this.FrIndex].Caption}else{return this.MasterRowName}};IDPanelSrv.prototype.isSimpleList=function(){if(this.PanelMode==Glb.PANEL_FORM){return false}for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IsPresent()&&(this.Fields[a].Flags&Glb.FLD_LISTLIST)==0&&this.Fields[a].IdxPanel>-1){return false}}return true};IDPanelSrv.prototype.SetInfoMessage=function(a,c,b){if(typeof(a)=="number"){if((c==null||c.equals(""))&&this.InfoPriority<=b){this.InfoPriority=b;this.Parent.SetMessage(this,a,c,"","INFO",0,false)}else{if(this.Visible&&!this.Collapsed&&this.Exposed()){if(this.InfoPriority<=b){this.InfoPriority=b;this.Parent.SetMessage(this,a,c,"","INFO",0,false)}}}}else{b=c;c=a;if(b==undefined){b=1}if(this.ShowInfoMessages){this.SetInfoMessage(AMessageSrv.MSG_INFO,c,b)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,86,"IDPanel.SetInfoMessage","Panel "+this.GetDTTCaption()+": can't add info message (Panel.ShowInfoMessage = FALSE)");this.MainFrm.DTTObj.AddParameter(this.iGuid,this.iGuid,"Message",new IDVariant(c))}}};IDPanelSrv.prototype.ActualPosition=function(a){if(a==undefined){a=false}return this.Queries[0].GetAttRecNumber()+this.AttR};IDPanelSrv.prototype.set_ActualPosition=function(c,d){if(typeof(c)=="number"&&d==undefined){d=c;c=false}var b=-1;if(this.Status()!=Glb.PS_DATA){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"IDPanel.ActualPosition","Panel "+this.GetDTTCaption()+" - Cannot set Actual Position while Status != DATA")}return}if(c){this.ForceSendPosition=true}if(this.IsShowingGrouping()&&!this.DisableLookups){this.ScrollRecTo(d,this.MainFrm);return}var a=this.Queries[0].GetAttRecNumber();if((d>=a&&d<a+this.NumRows)){if(d-a!=this.AttR){b=d-a;this.Queries[0].UpdateIMDB(this.AttR,true,true,false)}}else{this.ScrollRecTo(d,this.MainFrm);b=d-this.Queries[0].GetAttRecNumber();if(this.AttR>=this.NumRows){b=this.NumRows-1}}if(b>-1){this.set_SelectedRow(b)}};IDPanelSrv.prototype.SelectedRow=function(a){if(a==undefined){a=false}return this.AttR};IDPanelSrv.prototype.set_SelectedRow=function(c,b){if(typeof(c)=="number"&&b==undefined){b=c;c=false}var a=this.AttR;this.AttR=b;if(this.AttR>=this.NumRows||this.AttR<0){this.AttR=0}if(this.AttR!=a&&this.ValidatingRow==-1){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}if(this.AttR!=a){if(this.Parent.FocusPriority<=1){this.Parent.FocusPriority=0}this.SetInput()}this.RD3Change(RD3Glb.PAN_ACTUALROW);if(c){this.ForceSendPosition=true}};IDPanelSrv.prototype.GetValidatingRow=function(){return this.ValidatingRow};IDPanelSrv.prototype.GetNumRows=function(){return this.Queries[0].RecordCount()};IDPanelSrv.prototype.GetValueAt=function(b,a){return this.Fields[b].bValues(a-1).Value};IDPanelSrv.prototype.GetLastValue=function(a){return this.Fields[a].bValues((this.ValidatingRow==-1?this.AttR:this.ValidatingRow)).LastValue};IDPanelSrv.prototype.GetOrgValue=function(a){return this.Fields[a].bValues((this.ValidatingRow==-1?this.AttR:this.ValidatingRow)).OrgValue};IDPanelSrv.prototype.CanSaveMasterDoc=function(){for(var a=0;a<this.Parent.Frames.length;a++){if(this.Parent.Frames[a]!=null&&this.Parent.Frames[a].Content!=null){if(this.Parent.Frames[a].Content instanceof IDPanelSrv){var b=this.Parent.Frames[a].Content;if(b!=this&&b.Queries[0].IsDO){if(b.Status()==Glb.PS_UPDATE){return false}}}}}return true};IDPanelSrv.prototype.Exposed=function(){if(this.iExposed&&!this.Parent.Frames[this.FrIndex].Exposed){this.iExposed=false}return WebFrameSrv.prototype.Exposed.call(this)};IDPanelSrv.prototype.set_Exposed=function(a){if(a&&!this.Exposed()){for(var b=1;b<this.Parent.Frames.length;b++){if(this.Parent.Frames[b]!=null&&this.Parent.Frames[b].Content!=null&&this.Parent.Frames[b].Content instanceof IDPanelSrv&&this.Parent.Frames[b].Content!=this&&this.Parent.Frames[b].Content.HasFocus()){if(!this.Parent.Frames[b].Content.Exposed()){this.SetInput()}break}}}WebFrameSrv.prototype.set_Exposed.call(this,a);for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].SubFrame>0&&this.Fields[b].IsPresent()){this.Parent.Frames[this.Fields[b].SubFrame].Exposed=a;this.Parent.Frames[this.Fields[b].SubFrame].Content.set_Exposed(a)}}};IDPanelSrv.prototype.GetRTCGuid=function(a,b){switch(a){case Glb.OBJ_PAGE:return this.Pages[b].iGuid;case Glb.OBJ_GROUP:return this.Groups[b].iGuid;case Glb.OBJ_FIELD:return this.Fields[b].iGuid;default:return this.iGuid}};IDPanelSrv.prototype.SetRTCGuid=function(a,c,b){switch(a){case Glb.OBJ_PAGE:this.Pages[c].iGuid=b;break;case Glb.OBJ_GROUP:this.Groups[c].iGuid=b;break;case Glb.OBJ_FIELD:this.Fields[c].iGuid=b;break;default:this.iGuid=b;break}};IDPanelSrv.prototype.SetBook=function(a){this.MyBook=a};IDPanelSrv.prototype.PrintBook=function(h){if(this.MyBook==null){return}var j=new IDVariant();var a=new IDVariant(IDREGlb.PRN_PDF);var b=new IDVariant(true);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,68,"IDPanel.PrintBook","Panel "+this.GetDTTCaption()+": Fire OnPrint Event")}this.Parent.OnPrint(this,j,a,b);if(j.isFalse()){this.MyBook.set_PrintDestination(a.intValue());var d=false;if(this.Queries[0].IsDO){var f=this.MyBook.Book.ReportsList[0];if(f.DSE instanceof CDSEDO&&f.DSE.MstTableName.equals(this.Queries[0].MstTableName)){if(this.Queries[0].IDColl!=null){this.MyBook.set_ReportCollection(f.GetID(),this.Queries[0].IDColl)}else{this.MyBook.set_ReportCollection(f.GetID(),this.Queries[0].Document)}d=true}}if(!d){var g=(b.isTrue()&&this.Queries[0].LastWhereClause.length>6?this.Queries[0].LastWhereClause.substr(6):"");var e=(b.isTrue()?this.SortingListStr():"");this.MyBook.SetReportWhereClause(-1,g,e,false)}if(a.intValue()==3){this.MyBook.PrintBook(1,-1);h.set_RedirectTo(new IDVariant(this.MyBook.GetWebFileName()));h.set_RedirectNewWindow(true)}else{if(a.intValue()==IDREGlb.PRN_SCREEN&&this.Parent.FormWidth>0&&this.Parent.FormHeight>0){var c;if(this.MainFrm.iParamsObj.UseRD3){c=(this.MyBook.HideBorder()?0:6)+10}else{c=(this.MyBook.HideBorder()?8:0)}this.MyBook.SetSize(this.Parent.FormWidth-c,this.Parent.FormHeight-c)}this.MyBook.PrintBook(1,1)}}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,88,"IDPanel.PrintBook","Panel "+this.GetDTTCaption()+": print canceled")}}};IDPanelSrv.prototype.GetDTTCaption=function(){return this.ToString()};IDPanelSrv.prototype.DecodeStatus=function(a){switch(a){case Glb.PS_DATA:return"Data";case Glb.PS_QBE:return"QBE";case Glb.PS_UPDATE:return"Updated"}return""+a};IDPanelSrv.prototype.DecodeCommand=function(a){switch(a){case Glb.PCM_FIND:return"Find";case Glb.PCM_SEARCH:return"Search";case Glb.PCM_DELETE:return"Delete";case Glb.PCM_REQUERY:return"Re-query";case Glb.PCM_CANCEL:return"Cancel";case Glb.PCM_UPDATE:return"Update";case Glb.PCM_INSERT:return"Insert";case Glb.PCM_DUPLICATE:return"Duplicate";case Glb.PCM_PRINT:return"Print";case Glb.PCM_FORMLIST:return(this.PanelMode==Glb.PANEL_LIST?"Form":"List");case Glb.PCM_NAVIGATION:return"Navigate";case Glb.PCM_CSV:return"Export"}return""+a};IDPanelSrv.prototype.DTTTrace=function(h){if(h.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITPANEL,"Panel.Render","")){var k=this.Parent.Frames[this.FrIndex].Caption;if(!this.IndText.equals("")&&this.ShowStatusbar&&!this.Collapsed){k+=(": "+this.IndText)}var b="NF="+this.Fields.length+" LAY="+this.PanelMode+" U="+((this.Flags&Glb.PAN_CANUPDATE)!=0?-1:0)+" D="+((this.Flags&Glb.PAN_CANDELETE)!=0?-1:0)+" I="+((this.Flags&Glb.PAN_CANINSERT)!=0?-1:0)+" S="+((this.Flags&Glb.PAN_CANSELECT)!=0?-1:0)+" L="+(this.Locked()?-1:0)+" ST="+this.iStatus+" NR="+this.Queries[0].RecordCount()+" AP="+this.Queries[0].GetAttRecNumber()+" AR="+this.AttR+" PG="+this.PanelPage+" V="+(this.Visible?-1:0)+" C="+(this.Collapsed?-1:0)+" E="+(this.Exposed()?-1:0);if(this.PanelMode==Glb.PANEL_FORM){var j=this.GetBoundRect();b+=(" TW="+j.Width+" TH="+j.Height)}var f=" ERR=";for(var a=0;a<this.NumRows;a++){f+=(this.RowErrors[a]+"§")}h.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_PANCAPTION,"Panel.Caption",k,b+f);var d=0;var c=this.NumRows;if(h.DTTObj.TraceRecToDump==1||(h.DTTObj.TraceRecToDump>1&&this.PanelMode==Glb.PANEL_FORM)){d=this.AttR;c=this.AttR}else{if(h.DTTObj.TraceRecToDump>1){c=(c<h.DTTObj.TraceRecToDump?c:h.DTTObj.TraceRecToDump)-1}}if(h.DTTObj.TraceRecToDump>0){for(var a=d;a<=c;a++){for(var g=0;g<this.Fields.length;g++){b="E="+(this.Fields[g].IsEnabled(a)?-1:0)+" V="+(this.Fields[g].IsVisible(a)?-1:0)+" P="+(this.Fields[g].IsPresent()?-1:0)+" VS="+this.Fields[g].GetVisualStyle(a)+" PI="+this.Fields[g].IdxPanel;if(this.Fields[g].IsVisible(a)&&this.PanelMode==Glb.PANEL_FORM){var e=this.Fields[g].GetValueRect(this.PanelMode,this.AttR);b+=(" X="+e.Left+" Y="+e.Top+" H="+e.Height+" W="+e.Width);if(this.Fields[g].IdxPanel!=-1&&(this.Fields[g].Flags&Glb.FLD_NOHDRFORM)==0){e=this.Fields[g].GetHeaderRect(this.PanelMode);b+=(" HX="+e.Left+" HY="+e.Top+" HH="+e.Height+" HW="+e.Width)}}if(this.Fields[g].bValues(a).IsError()){b+=(" ERR="+this.Fields[g].bValues(a).GetErrorText())}h.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_PANFLDVALUE,(this.Fields[g].IdxPanel==-1?this.Fields[g].Header:(this.PanelMode==Glb.PANEL_LIST?this.Fields[g].AbbrHeaderList:this.Fields[g].AbbrHeaderForm)),(this.Fields[g].DataType==Glb.DT_DOC_OLE?new IDVariant("BLOB"):this.Fields[g].bValues(a).Value),b)}}}}};IDPanelSrv.prototype.SetQueryDocument=function(b,a,d){var c=this.AttR;if(b==0){if(this.Status()==Glb.PS_UPDATE){this.CancelUpdate(this.MainFrm)}if(this.Status()==Glb.PS_DATA){this.EnterQBE()}this.SaveQBE(3)}this.Queries[b].Document=a;this.Queries[b].IDColl=null;this.Queries[b].DocTempl=null;if(b==0){this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE);if(d!=this.Queries[0].IsMasterDO){this.RD3Change(RD3Glb.PAN_MASTER)}this.Queries[0].IsMasterDO=d;if(!d){if(this.Lockable&&!this.MainFrm.IsMobile()){this.Lockable=false;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)}if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}}else{if(a!=null){this.iImage=a.GetIcon()}}}if(a!=null){a.set_UIBound(true)}if(b==0){this.FindData(this.MainFrm,false,false);if(c>=0&&c<this.NumRows){this.AttR=c}}};IDPanelSrv.prototype.SetQueryCollection=function(k,p,c){if(c==undefined){c=false}var h=this.AttR;var o=this.Queries[k].GetAttRecNumber();if(k==0){if(!c){if(this.Status()==Glb.PS_UPDATE){this.CancelUpdate(this.MainFrm)}if(this.Status()==Glb.PS_DATA){this.EnterQBE()}}this.SaveQBE(3)}this.Queries[k].IDColl=p;p.set_ShowDeleted(false);p.set_UIBound(true);var d=this.Queries[k].DocTempl;this.Queries[k].DocTempl=null;this.Queries[k].Document=null;if(c!=this.Queries[0].IsMasterDO){this.RD3Change(RD3Glb.PAN_MASTER)}this.Queries[k].IsMasterDO=c;if(k==0){this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE);if(!c){if(this.Lockable&&!this.MainFrm.IsMobile()){this.Lockable=false;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)}if(this.ShowInfoMessages){this.set_ShowInfoMessages(false)}if((this.Flags&Glb.PAN_CANSELECT)!=0&&this.Queries[0].DocFilter==null){var g=new IDCollection();this.FireCreateDocument(g,this.Queries[0].MstTableName);g.MoveFirst();var e=g.GetAt();if(e==null){WriteToConsoleError("PANEL: cannot create a "+this.Queries[0].MstTableName)}else{e.Clear();e.SetMainFrm(this.MainFrm,this.IMDB)}this.Queries[0].DocFilter=e}}var m=this.FindData(this.MainFrm,false,true);if(h>=0&&h<this.NumRows&&!m){this.AttR=h;if(p.Count()>0&&o+this.AttR>p.Count()){o=p.Count()-this.NumRows+1;if(o<1){o=1;this.AttR=p.Count()-1}else{this.AttR=this.NumRows-1}}}this.UpdateDynRows(this.Queries[0].RecordCount());if(!m){this.ScrollRecTo(o,this.MainFrm)}if(this.SortingList.Count()!=0){this.EnableSorting()}if(this.SortingList.Count()==0&&p.Count()>0){p.MoveFirst();var l=p.GetAt();var j="";var b=l.GetMD();for(var f=0;f<p.SortCriteria.length;f++){if(p.SortCriteria[f]==0){break}var a=b.GetProp(Math.abs(p.SortCriteria[f]));j+=(j.length==0?"":", ")+a.ObjTag+(p.SortCriteria[f]>0?" asc":" desc")}if(j.length>0){this.set_SortingListStr(j)}}this.SetRDRowSel(-1,true)}if(k==0&&c){this.Queries[k].DocTempl=d;this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE)}};IDPanelSrv.prototype.SetDocumentClass=function(b,a){this.Queries[b].MstTableName=a;this.Queries[b].IsDO=true;this.Queries[b].MaxRows=0;try{var f=new IDCollection();this.FireCreateDocument(f,a);f.MoveFirst();var d=f.GetAt();if(d==null){WriteToConsoleError("PANEL: cannot create a "+a)}else{d.Clear();d.SetMainFrm(this.MainFrm,this.IMDB)}if(b==0){this.Queries[b].Document=null;this.Queries[b].IDColl=new IDCollection();this.Queries[b].IDColl.set_UIBound(true);this.Queries[b].IDColl.set_MainFrm(this.MainFrm);this.Queries[b].IDColl.set_imdb(this.IMDB);this.Queries[b].DocTempl=d;this.Queries[b].IsMasterDO=true;this.RD3Change(RD3Glb.PAN_HASDOCTEMPLATE)}else{this.Queries[b].Document=d;d.set_Inserted(false)}}catch(c){WriteToConsoleError(c)}};IDPanelSrv.prototype.SetDOWhereClause=function(a){this.Queries[0].Text[Glb.SQL_WHERE]=a};IDPanelSrv.prototype.GetDocument=function(a){if(a==undefined){a=-1}var c=null;if(a==-1){if(this.ValidatingRow!=-1){a=this.ValidatingRow}else{a=this.AttR}}if(this.Queries[0].IDColl!=null){var b=this.Queries[0].GetAttRecNumber()+a;if(b<=this.Queries[0].RecordCount()){var e=this.Queries[0].IDColl.UIMode();if(!e){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(b);c=this.Queries[0].IDColl.GetAt();if(!e){this.Queries[0].IDColl.set_UIMode(false)}}}else{if(a==0){c=this.Queries[0].Document}}return c};IDPanelSrv.prototype.SetDocument=function(a){this.SetQueryDocument(0,a,false)};IDPanelSrv.prototype.AddLookupParam=function(b,a,e,d,c){if(c==undefined){c=false}this.Queries[b].AddLookupParam(a,e,d,c)};IDPanelSrv.prototype.AddLookupValue=function(b,c,a){this.Queries[b].AddLookupValue(c,a)};IDPanelSrv.prototype.SetLookupDocument=function(a){if(a!=null){var c=a.TypeName();for(var b=1;b<this.Queries.length;b++){if(this.Queries[b].IsDO&&this.Queries[b].MstTableName.equals(c)){this.Queries[b].IsDO=true;this.Queries[b].Document=a}}}};IDPanelSrv.prototype.pDocument=function(){return this.GetDocument()};IDPanelSrv.prototype.set_pDocument=function(a){this.SetDocument(a)};IDPanelSrv.prototype.pCollection=function(){return this.Queries[0].IDColl};IDPanelSrv.prototype.set_pCollection=function(a){this.SetQueryCollection(0,a)};IDPanelSrv.prototype.FieldValue=function(a){return new IDVariant(this.Fields[a].bValues(this.AttR).Value)};IDPanelSrv.prototype.set_FieldValue=function(a,b){if(this.Fields[a].UpdateField(b)){this.SetModified(this.MainFrm);this.ReValidate()}};IDPanelSrv.prototype.RowUpdateCount=function(a){return this.iRowUpdateCount[a]};IDPanelSrv.prototype.set_RowUpdateCount=function(a,b){this.iRowUpdateCount[a]=b};IDPanelSrv.prototype.SetCommandEnabled=function(c,a){var b=this.EnabledCommands;this.EnabledCommands=(this.EnabledCommands&(~c))|((a)?c:0);if(b!=this.EnabledCommands){this.RD3Change(RD3Glb.PAN_ENABLEDCOMMANDS)}};IDPanelSrv.prototype.IsCommandEnabled=function(a){return(this.EnabledCommands&a)!=0};IDPanelSrv.prototype.FixedCols=function(){return this.iFixedCols};IDPanelSrv.prototype.set_FixedCols=function(a){if(this.iFixedCols!=a){this.iFixedCols=a;this.RD3Change(RD3Glb.PAN_FIXEDCOLS)}};IDPanelSrv.prototype.AdjustExtProp=function(){var v=null;var h=null;var o=false;var s=false;var x=this.GetDocument(0);if(x==null){x=this.Queries[0].DocTempl}if(x!=null){v=x.GetMD();if((v.Services&MDOInit.SERV_EXTSCHEMA)==0){s=true}}else{s=true}if(!s){try{h=x.GetExtSchema()}catch(w){WriteToConsoleError(w)}}var q=this.LastExtDoc==x;var A=this.LastExtSchema==h;if(q&&A){return}this.LastExtDoc=x;if(h!=null){this.LastExtSchema=h}if(s){for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].IdxPanel==0){if(this.Fields[u].IsExtended){this.SetFlags(Glb.OBJ_FIELD,u,0,Glb.OBJ_VISIBLE)}}else{if(this.Fields[u].IdxPanel>0){var B=this.Queries[this.Fields[u].IdxPanel].GetMstField();if(B!=null){if(B.IsExtended){this.SetFlags(Glb.OBJ_FIELD,u,0,Glb.OBJ_VISIBLE);this.Fields[u].ExtendLookup(null,false)}}}}}return}for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].IdxPanel==0){var t=this.Fields[u].GetDOIdx(x);if(t>0){var a=v.GetProp(t);if(a.ExtPropIdx>0){o=true;this.Fields[u].IsExtended=true;if(h!=null){if(a.ExtPropIdx<=h.GetNumProp()){f=h.GetProp(a.ExtPropIdx);o=(f.DTString=="DO");this.Fields[u].AbbrHeaderForm=f.UIName;this.Fields[u].AbbrHeaderList=f.UIName;this.Fields[u].Header=f.UIName;this.Fields[u].RD3Change(RD3Glb.FLD_HEADER);this.Fields[u].RD3Change(RD3Glb.FLD_FORMHEADER);this.Fields[u].RD3Change(RD3Glb.FLD_LISTHEADER);this.Fields[u].IDLista=f.IDList;if(this.MainFrm.IsMobile()&&f.IDList!=""&&!A){this.Fields[u].IDLista="";this.ClearValueList(u);var m=v.DBObj;if(m==null){m=x.GetDBObj()}if(m!=null){var y="";try{y="select DO_CODE, DO_DESCRIPTION from DO_VALUES where DO_LISTID = "+IDL.Quote(new IDVariant(f.IDList));var k=new IDVariant();x.OnSQLQuery(new IDVariant(y),new IDVariant(MDOInit.QRY_LOADVALUELIST),k);if(k.stringValue()!=""){y+=" and ";y+=k}y+=" order by DO_SEQ";var b=m.OpenRS(y);x.AfterSQLQuery(new IDVariant(y),new IDVariant(MDOInit.QRY_LOADVALUELIST),b,new IDVariant());var r=b.RecordCount();var z=0;if(!b.EOF()){b.MoveFirst()}while(!b.EOF()){z++;this.SetValueListItem(u,b.Get("DO_CODE"),b.Get("DO_DESCRIPTION").stringValue(),"","",-1,z<r);b.MoveNext()}}catch(w){x.AfterSQLQuery(new IDVariant(y),new IDVariant(MDOInit.QRY_LOADVALUELIST),null,new IDVariant(w.toString()));this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,61,"IDPanel.AdjustExtProp","Panel "+this.GetDTTCaption()+": cannot load value list for extended properties. Error is "+w.message)}}}else{if(this.MainFrm.IsMobile()&&f.IDList==""){this.ClearValueList(u)}}this.SetFlags(Glb.OBJ_FIELD,u,(f.Nullable?Glb.FLD_ISOPT:0)|((f.ReadOnly&&!x.Inserted())?0:Glb.OBJ_ENABLED),Glb.FLD_ISOPT|Glb.OBJ_ENABLED);if(f.MaxLength>0){this.Fields[u].MaxLength=f.MaxLength;this.Fields[u].RD3Change(RD3Glb.FLD_MAXLENGTH)}this.Fields[u].DataType=f.DataType;this.Fields[u].RD3Change(RD3Glb.FLD_DATATYPE);if(f.Mask!=null&&f.Mask.length>0){this.Fields[u].Mask=f.Mask;this.Fields[u].RD3Change(RD3Glb.FLD_MASK)}}}if(o){this.Fields[u].IDLista=""}this.SetFlags(Glb.OBJ_FIELD,u,(o)?0:Glb.OBJ_VISIBLE,Glb.OBJ_VISIBLE);if(f!=null&&f.Lookup!=null&&f.Lookup.length>0){this.SetFlags(Glb.OBJ_FIELD,u,0,Glb.FLD_NOACTD)}else{this.SetFlags(Glb.OBJ_FIELD,u,Glb.FLD_NOACTD,Glb.FLD_NOACTD)}}}}else{if(this.Fields[u].IdxPanel>0){var B=this.Queries[this.Fields[u].IdxPanel].GetMstField();if(B!=null){if(B.IsExtended){o=true;var f=null;var t=B.GetDOIdx(x);if(t>0&&h!=null){var a=v.GetProp(t);if(a.ExtPropIdx>0&&a.ExtPropIdx<=h.GetNumProp()){f=h.GetProp(a.ExtPropIdx)}}if(B.IDLista.length>0){o=false}if(f!=null&&f.LinkedDoc!=null){o=false;var g=this.Fields[u].GetValueRect(Glb.PANEL_FORM,0);var p=B.GetValueRect(Glb.PANEL_FORM,0);var l=false;if(g.Top==p.Top&&g.Height==p.Height&&(this.Fields[u].Flags&Glb.FLD_NOHDRFORM)!=0){l=true}this.Fields[u].ExtendLookup(f.LinkedDoc,l|this.Fields[u].flLookupExtended)}else{this.Fields[u].ExtendLookup(null,false)}if(f!=null&&f.Lookup!=null&&f.Lookup.length>0){this.SetFlags(Glb.OBJ_FIELD,u,0,Glb.FLD_NOACTD)}else{this.SetFlags(Glb.OBJ_FIELD,u,Glb.FLD_NOACTD,Glb.FLD_NOACTD)}this.SetFlags(Glb.OBJ_FIELD,u,((o)?0:Glb.OBJ_VISIBLE)|(B.Flags&Glb.OBJ_ENABLED),Glb.OBJ_VISIBLE|Glb.OBJ_ENABLED)}}}}}};IDPanelSrv.prototype.HasFocus=function(){if(this.Parent==null){return false}var a=this.Parent.ActiveElement.indexOf("C");if(a>=0&&this.Parent.ActiveElement.substr(0,a).equals("F"+this.FrIndex)){return true}return false};IDPanelSrv.prototype.SearchForMasterPanel=function(){var a=false;if(this.MasterPanelCode!=null){a=true;var b=this.Parent.SearchPanel(this.MasterPanelCode);if(b!=null){this.MasterPanelIdx=b.FrIndex;this.MasterPanelCode=null}}if(this.MasterPanelIdx>0){this.CheckMasterDocument(a)}};IDPanelSrv.prototype.CheckMasterDocument=function(b){var a=this.Parent.Frames[this.MasterPanelIdx].Content;var j=a.GetDocument();if(j!=this.LastMasterDocument||b){this.LastMasterDocument=j;if(j==null){this.SetQueryDocument(0,null,false)}else{var k=null;if(this.iDetailCollection!=-1){k=j.GetCollByIndex(this.iDetailCollection)}else{var f=j.GetMD();for(var g=1;g<=f.GetNumColl();g++){var c=f.GetColl(g);if(c.ChildrenName.equals(this.Queries[0].MstTableName)){k=j.GetCollByIndex(g);break}}}if(k!=null){k.ClearSort();if(this.Queries[0].DOSortCriteria!=null){for(var l=0;l<this.Queries[0].DOSortCriteria.Count();l++){var o=this.Queries[0].DOSortCriteria[l];k.SortBy(o)}}try{if(!j.Inserted()){var m=j.UpdateCount();j.LoadCollectionDirect(k,0,true);if(j.UpdateCount()!=m){a.UpdatePanel(this.MainFrm)}}}catch(h){}this.SetQueryCollection(0,k)}}this.set_Locked(a.Locked())}};IDPanelSrv.prototype.SetDetailCollection=function(a){if(this.iDetailCollection!=a.intValue()){this.iDetailCollection=a.intValue();if(this.MasterPanelIdx==0&&this.MasterPanelCode!=null){this.SearchForMasterPanel()}this.CheckMasterDocument(true)}};IDPanelSrv.prototype.DumpDocErrors=function(h,H,f,r){var F=new ArrayList();var b=new ArrayList();var w=new ArrayList();var q=false;if(h.HasErrors(true)){var g=this.ValidatingRow;this.ValidatingRow=H;for(var z=0;z<this.Fields.length;z++){if(this.Fields[z].IdxPanel==0){var A=this.Fields[z].GetDOIdx(h);if(A>-1&&(this.Fields[z].Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0){w.Add(A);var s=h.GetPropDOError(A);if(s!=null&&(s.ErrType==IDDocument.ERR_ERROR||!s.Ack)){this.SetFieldErrorText(this.Fields[z].Index,s.Text,s.ErrType,s.Shown,s)}}}if(this.Fields[z].IdxPanel>0){q=b.IndexOf(this.Fields[z].IdxPanel)==-1;if(q){this.Queries[this.Fields[z].IdxPanel].GetRelevantDocProp(F,h);var d="";var G=9999;var a=true;for(var u=0;u<F.Count();u++){var p=F[u];var s=h.GetPropDOError(p);w.Add(p);if(s!=null){a&=s.Shown;if(d.length>0){d+=" - "}d+=s.Text;if(s.ErrType<G){G=s.ErrType}}}if(d.length>0){var E=z;var l=(this.Fields[z].IsVisible(H)?4:0);l+=(this.Fields[z].IsEnabled(H)?2:0);l+=((this.Fields[z].Flags&Glb.FLD_ISOPT)==0?1:0);for(var t=z+1;t<this.Fields.length;t++){if(this.Fields[t].IdxPanel==this.Fields[E].IdxPanel){var C=(this.Fields[t].IsVisible(H)?4:0);C+=(this.Fields[t].IsEnabled(H)?2:0);C+=((this.Fields[t].Flags&Glb.FLD_ISOPT)==0?1:0);if(C>l){E=t;l=C}}}var m=this.SetFieldErrorText(this.Fields[E].Index,d,G,a);if(m){for(var B=0;B<F.Count();B++){var p=F[B];var s=h.GetPropDOError(p);if(s!=null){s.Shown=true}}}}b.Add(this.Fields[z].IdxPanel)}}}F.Clear();var y=h.GetMD();var D="";for(var z=1;z<=y.GetNumProp();z++){q=w.IndexOf(z)==-1;if(q){var s=h.GetPropDOError(z);if(s!=null&&s.ErrType==IDDocument.ERR_ERROR&&!s.Shown){if(D.length>0){D=D+", "}D=D+"<b>"+y.GetProp(z).UIName+"</b>: "+s.Text;s.Shown=true}}}F.Clear();h.GetDocErrors(F);z=0;var D="";for(var x=0;x<F.Count();x++){var o=F[x];if(D.length>0){D+=", "}D+=o}if(D.length>0){this.SetRowError(this.ValidatingRow,D)}this.ValidatingRow=g}if(f){this.DumpChildrenError(h,true,r)}};IDPanelSrv.prototype.DumpCollErrors=function(f,p,h,a){var g=0;var k=null;var j=null;var m=null;var l=null;var b=this.ActualPosition()-this.AttR-1;f.set_ShowDeleted(true);f.MoveFirst();g=0;while(!f.IsEof()){k=f.GetAt();if(h==null||h==k){if(k.HasErrors()){if(g>=b&&g<b+this.NumRows){this.DumpDocErrors(k,g-b,false,a)}else{l=new ArrayList();k.GetDocErrors(l);j="";for(var o=0;o<l.Count();o++){m=l[o];if(j.length>0){j+="\n"}j+=(k.GetName(1)+m)}if(j.length>0){this.Parent.SetMessage(this,AMessageSrv.MSG_STOP,j,"","DOC",g+1,false)}}}if(p){this.DumpChildrenError(k,true,a)}}f.MoveNext();g++}f.set_ShowDeleted(false)};IDPanelSrv.prototype.DumpChildrenError=function(g,B,l){var s=0;var t=g.GetMD();var o=null;var j=null;var x=null;var m=null;if(!B&&g.HasErrors()){for(s=1;s<=t.GetNumProp();s++){m=g.GetPropDOError(s);if(m!=null&&!m.Shown){x=m.Text;var h=false;if(g.ParentCollection()!=null){var r=null;for(var u=1;u<this.Parent.Frames.length;u++){if(this.Parent.Frames[u].Content!=null&&this.Parent.Frames[u].Content instanceof IDPanelSrv){var q=this.Parent.Frames[u].Content;if(q.MasterPanelIdx>0&&q.pCollection()==g.ParentCollection()){r=q;break}}}if(r!=null){var b=g.ParentCollection().FindDoc(g);var f=r.ValidatingRow;r.ValidatingRow=b==0?b:b-1;for(var z=0;z<r.UFields();z++){if(r.bFields(z).IdxPanel==0){var w=r.bFields(z).GetDOIdx(g);if(w>-1&&(r.bFields(z).Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0&&w==s){if(m.ErrType==IDDocument.ERR_ERROR||!m.Ack){r.SetFieldErrorText(r.bFields(z).Index,m.Text,m.ErrType,m.Shown,m);r.SetRDRowSel(r.ValidatingRow,true);h=true;break}}}}r.ValidatingRow=f}}if(!h){this.Parent.SetMessage(t.GetProp(s).UIName,m.ErrType==IDDocument.ERR_ERROR?AMessageSrv.MSG_STOP:AMessageSrv.MSG_WARN,x,"","VAL",0,false)}m.Shown=true}}o=new ArrayList();g.GetDocErrors(o);x="";for(var k=0;k<o.Count();k++){j=o[k];if(x.length>0){x+="\n"}x+=j}if(x.length>0){this.Parent.SetMessage(g,AMessageSrv.MSG_STOP,x,"","DOC",0,false)}}var A;var y;for(s=1;s<=t.GetNumColl();s++){A=g.GetCollByIndex(s);var a=(l!=null&&l.Contains(A));A.set_ShowDeleted(true);A.MoveFirst();while(!A.IsEof()){y=A.GetAt();if(!a||y.Deleted()||y.Hidden()){this.DumpChildrenError(y,false,l)}A.MoveNext()}A.set_ShowDeleted(false)}};IDPanelSrv.prototype.DumpDOErrors=function(b,a){if(b==undefined){b=null}if(a==undefined){a=false}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}if(this.Queries[0].IDColl!=null){this.DumpCollErrors(this.Queries[0].IDColl,true,b,null)}else{if((this.Queries[0].Document!=null)&&(b==null||b==this.Queries[0].Document)){this.DumpDocErrors(this.Queries[0].Document,this.AttR,a,null)}}};IDPanelSrv.prototype.HasQBE=function(d){if(d==undefined){d=true}for(var c=0;c<this.MasterFields.length;c++){var b=this.MasterFields[c].bValues(0).Text;if(b.length>0&&(this.MasterFields[c].ValueList.Count()==0||!d)){return true}}return false};IDPanelSrv.prototype.OpenAttachmentForm=function(){try{var b=this.GetDocument();if(b!=null&&this.MainFrm.DocHelper!=null){this.MainFrm.DocHelper.OpenAttachmentForm(b)}}catch(a){}};IDPanelSrv.prototype.AddDOSortCriteria=function(a){this.Queries[0].AddDOSortCriteria(a)};IDPanelSrv.prototype.SetCmdIdx=function(b,c,a){this.Fields[c].CmdIdx=a;if(this.Fields[c].IdxPanel==-1){this.Fields[c].Tooltip=b.CmdObj.CmdLin[a].ToolTip;this.Fields[c].RD3Change(RD3Glb.FLD_TOOLTIP)}};IDPanelSrv.prototype.IsIMDB=function(){return(this.Queries[0].IMDBDataSource>-1)};IDPanelSrv.prototype.IsDO=function(){return this.Queries[0].IsDO};IDPanelSrv.prototype.SetFieldEditor=function(b,a){if(a!=this.Fields[b].EditorType){this.Fields[b].EditorType=a;this.Fields[b].RD3Change(RD3Glb.FLD_EDITORTYPE);if(this.MainFrm.ParamsObj().UseIDEditor){this.Fields[b].setFieldEditor()}}};IDPanelSrv.prototype.ObjRect=function(b,d,c,a){switch(b){case Glb.OBJ_RECT:switch(c){case IDPanelSrv.RT_WIDTH:return(this.BoundRect!=null?this.BoundRect.Width:(this.MainFrm.ParamsObj().UseRD3?this.Parent.Frames[this.FrIndex].Width:0));case IDPanelSrv.RT_HEIGHT:return(this.BoundRect!=null?this.BoundRect.Height:(this.MainFrm.ParamsObj().UseRD3?this.Parent.Frames[this.FrIndex].Height:0))}break;case Glb.OBJ_PANEL:switch(c){case IDPanelSrv.RT_LEFT:return this.ListLeft;case IDPanelSrv.RT_TOP:return this.ListTop;case IDPanelSrv.RT_WIDTH:return this.ListWidth;case IDPanelSrv.RT_HEIGHT:return this.ListHeight}break;case Glb.OBJ_GROUP:switch(c){case IDPanelSrv.RT_LEFT:return this.Groups[d].GrpRect(a).Left;case IDPanelSrv.RT_TOP:return this.Groups[d].GrpRect(a).Top;case IDPanelSrv.RT_WIDTH:return this.Groups[d].GrpRect(a).Width;case IDPanelSrv.RT_HEIGHT:return this.Groups[d].GrpRect(a).Height}break;case Glb.OBJ_FIELD:switch(c){case IDPanelSrv.RT_LEFT:return this.Fields[d].FldRect(a).Left;case IDPanelSrv.RT_TOP:return this.Fields[d].FldRect(a).Top;case IDPanelSrv.RT_WIDTH:return this.Fields[d].FldRect(a).Width;case IDPanelSrv.RT_HEIGHT:return this.Fields[d].FldRect(a).Height}break}return 0};IDPanelSrv.prototype.set_ObjRect=function(h,l,k,e,g){var f=0;var a=new RectSrv();if(this.ObjRect(h,l,k,e)==g){return}switch(h){case Glb.OBJ_RECT:switch(k){case IDPanelSrv.RT_WIDTH:if(this.BoundRect!=null){this.BoundRect.Width=g}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].Width=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_WIDTH)}break;case IDPanelSrv.RT_HEIGHT:if(this.BoundRect!=null){this.BoundRect.Height=g}if(this.MainFrm.ParamsObj().UseRD3){this.Parent.Frames[this.FrIndex].Height=g;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT)}break}break;case Glb.OBJ_PANEL:if(e==Glb.PANEL_LIST){switch(k){case IDPanelSrv.RT_LEFT:this.ListLeft=g;this.RD3Change(RD3Glb.PAN_LISTLEFT);break;case IDPanelSrv.RT_TOP:f=g-this.ListTop;this.ListTop=g;this.RD3Change(RD3Glb.PAN_LISTTOP);for(var d=0;d<this.Fields.length;d++){if((this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)!=0){a=this.Fields[d].FldRect(e);a.Top=a.Top+f;this.Fields[d].set_FldRect(e,a)}}for(var d=0;d<this.Groups.length;d++){for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].Group==d&&(this.Fields[b].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[b].Flags&Glb.FLD_LISTLIST)!=0){a=this.Groups[d].GrpRect(e);a.Top=a.Top+f;if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[d].set_GrpRect(e,a);break}}}break;case IDPanelSrv.RT_HEIGHT:this.ListHeight=g;this.RD3Change(RD3Glb.PAN_LISTHEIGHT);break}this.CalcLayout();this.ScrollRecBy(0,this.MainFrm)}break;case Glb.OBJ_GROUP:var c=false;if(e==Glb.PANEL_LIST){for(var d=0;d<this.Fields.length;d++){if(this.Fields[d].Group==l&&(this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)==0){c=true;break}}}if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(c||k==IDPanelSrv.RT_HEIGHT))){a=this.Groups[l].GrpRect(e);switch(k){case IDPanelSrv.RT_LEFT:f=g-a.Left;a.Left=g;break;case IDPanelSrv.RT_TOP:f=g-a.Top;a.Top=g;break;case IDPanelSrv.RT_WIDTH:f=g-a.Width;a.Width=g;break;case IDPanelSrv.RT_HEIGHT:f=g-a.Height;a.Height=g;break}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[l].set_GrpRect(e,a);if(k==IDPanelSrv.RT_LEFT||k==IDPanelSrv.RT_TOP){for(var d=0;d<this.Fields.length;d++){if(this.Fields[d].Group==l){a=this.Fields[d].FldRect(e);if(k==IDPanelSrv.RT_LEFT){a.Left=a.Left+f}else{a.Top=a.Top+f}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Fields[d].set_FldRect(e,a)}}}}break;case Glb.OBJ_FIELD:a=this.Fields[l].FldRect(e);switch(k){case IDPanelSrv.RT_LEFT:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Left;a.Left=g}break;case IDPanelSrv.RT_TOP:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Top;a.Top=g}break;case IDPanelSrv.RT_WIDTH:f=g-a.Width;a.Width=g;break;case IDPanelSrv.RT_HEIGHT:if(e==Glb.PANEL_FORM||(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0)){f=g-a.Height;a.Height=g}break}if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)==0){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Fields[l].set_FldRect(e,a);if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){for(var d=l+1;d<this.Fields.length;d++){if((this.Fields[d].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[d].Flags&Glb.FLD_LISTLIST)!=0){a=this.Fields[d].FldRect(e);a.Left=a.Left+f;this.Fields[d].set_FldRect(e,a)}}for(var d=0;d<this.Groups.length;d++){for(var b=l+1;b<this.Fields.length;b++){if(this.Fields[b].Group==d&&this.Fields[l].Group!=d&&(this.Fields[b].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[b].Flags&Glb.FLD_LISTLIST)!=0){a=this.Groups[d].GrpRect(e);a.Left=a.Left+f;if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[d].set_GrpRect(e,a);break}}}}if(this.Fields[l].Group!=-1){a=this.Groups[this.Fields[l].Group].GrpRect(e);switch(k){case IDPanelSrv.RT_LEFT:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Left=a.Left+f}else{if(this.Fields[l].FldRect(e).Left<a.Left){a.Left=this.Fields[l].FldRect(e).Left}}break;case IDPanelSrv.RT_TOP:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Top=a.Top+f}else{if(this.Fields[l].FldRect(e).Top<a.Top){a.Top=this.Fields[l].FldRect(e).Top}}break;case IDPanelSrv.RT_WIDTH:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Width=a.Width+f}else{if(this.Fields[l].FldRect(e).Left+this.Fields[l].FldRect(e).Width>a.Left+a.Width){a.Width=this.Fields[l].FldRect(e).Left+this.Fields[l].FldRect(e).Width-a.Left}}break;case IDPanelSrv.RT_HEIGHT:if(e==Glb.PANEL_LIST&&(this.Fields[l].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[l].Flags&Glb.FLD_LISTLIST)!=0){a.Height=a.Height+f}else{if(this.Fields[l].FldRect(e).Top+this.Fields[l].FldRect(e).Height>a.Top+a.Height){a.Height=this.Fields[l].FldRect(e).Top+this.Fields[l].FldRect(e).Height-a.Top}}break}if(e==Glb.PANEL_LIST){a.Left=a.Left-(this.ShowRowSelector?Glb.SELECT_OFFSET:0)}this.Groups[this.Fields[l].Group].set_GrpRect(e,a)}break}};IDPanelSrv.prototype.EnableInsertWhenLocked=function(){return this.iEnableInsertWhenLocked};IDPanelSrv.prototype.set_EnableInsertWhenLocked=function(a){if(this.iEnableInsertWhenLocked!=a){this.iEnableInsertWhenLocked=a;this.RD3Change(RD3Glb.PAN_ENABLEINSERTLOCKED)}};IDPanelSrv.prototype.EnableMultipleSel=function(){return this.iEnableMultipleSel};IDPanelSrv.prototype.set_EnableMultipleSel=function(a){if(this.EnableMultipleSel()!=a){if(!a){this.set_ShowMultipleSel(false)}this.iEnableMultipleSel=a;this.RD3Change(RD3Glb.PAN_ENABLEMULTIPLESEL)}};IDPanelSrv.prototype.ShowMultipleSel=function(a){if(a==undefined){a=true}if(this.EnableMultipleSel()&&(!a||this.PanelMode==Glb.PANEL_LIST)){return this.iShowMultipleSel}return false};IDPanelSrv.prototype.set_ShowMultipleSel=function(c,b){if(b==undefined){b=false}if(this.EnableMultipleSel()&&c!=this.ShowMultipleSel()){var a=new IDVariant(false);if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnShowMultipleSelection","Panel "+this.GetDTTCaption()+": fire OnShowMultipleSelection event")}this.Parent.OnShowMultipleSelection(this,new IDVariant(c),a,new IDVariant(b));if(a.isFalse()){this.iShowMultipleSel=c}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnShowMultipleSelection","Panel "+this.GetDTTCaption()+": ShowMultipleSelection canceled")}}this.RD3Change(RD3Glb.PAN_SHOWMULTIPLESEL)}};IDPanelSrv.prototype.ActiveMultipleSel=function(){if(this.EnableMultipleSel()&&this.PanelMode==Glb.PANEL_LIST){return this.iActiveMultipleSel}return false};IDPanelSrv.prototype.set_ActiveMultipleSel=function(a){if(this.EnableMultipleSel()&&a!=this.ActiveMultipleSel()){this.iActiveMultipleSel=a}};IDPanelSrv.prototype.SelectAllOnlyVisible=function(){return this.iSelectAllOnlyVisible};IDPanelSrv.prototype.set_SelectAllOnlyVisible=function(a){if(this.SelectAllOnlyVisible()!=a){this.iSelectAllOnlyVisible=a;this.RD3Change(RD3Glb.PAN_SELALLONLYVIS)}};IDPanelSrv.prototype.IsRowSelected=function(a){if(a==undefined){a=-1}try{if(a==-1){if(this.ValidatingRow!=-1){if(this.Queries[0].GetAttRecNumber()>=1){a=this.Queries[0].GetAttRecNumber()+this.ValidatingRow}}else{a=this.Queries[0].GetAttRecNumber()+this.AttR}}if(a>0){if(this.IsDO()){if(a<=this.Queries[0].RecordCount()&&this.Queries[0].IDColl!=null){var f=this.Queries[0].IDColl.UIMode();if(!f){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(a);var c=this.Queries[0].IDColl.GetAt();if(!f){this.Queries[0].IDColl.set_UIMode(false)}if(c!=null){return c.Selected()}}}else{return this.SelectedRows[a-1]}}}catch(b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,191,"IDPanel.IsRowSelected","Panel "+this.GetDTTCaption()+": can't read the "+(a!=-1?"row "+a:"current row")+" selected property - "+b.message)}}return false};IDPanelSrv.prototype.SetRowSelected=function(g,f,a){if(f==undefined){f=-1}if(a==undefined){a=true}try{if(f==-1){if(this.ValidatingRow!=-1){if(this.Queries[0].GetAttRecNumber()>=1){f=this.Queries[0].GetAttRecNumber()+this.ValidatingRow}}else{f=this.Queries[0].GetAttRecNumber()+this.AttR}}if(f>0&&this.IsRowSelected(f)!=g){var b=new IDVariant(0);this.FireOnChangeSelection(f,g,false,false,b);if(b.isFalse()){if(this.IsDO()){if(f<=this.Queries[0].RecordCount()&&this.Queries[0].IDColl!=null){var k=this.Queries[0].IDColl.UIMode();if(!k){this.Queries[0].IDColl.set_UIMode(true)}this.Queries[0].IDColl.set_AbsolutePosition(f);var j=this.Queries[0].IDColl.GetAt();if(!k){this.Queries[0].IDColl.set_UIMode(false)}if(j!=null){j.set_Selected(g)}}}else{this.SelectedRows[f-1]=g}}if(a){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row",f.toString());if(b.isFalse()){c.SetAttribute("value",g?"1":"0")}else{c.SetAttribute("value",!g?"1":"0")}}if(f-this.Queries[0].GetAttRecNumber()>=0&&f-this.Queries[0].GetAttRecNumber()<this.NumRows){this.RDRowSel[f-this.Queries[0].GetAttRecNumber()]=true}}}catch(h){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,192,"IDPanel.SetRowSelected","Panel "+this.GetDTTCaption()+": can't "+(g?"select":"deselect")+" the "+(f!=-1?"row "+f:"current row")+" - "+h.message)}}};IDPanelSrv.prototype.ChangeSelection=function(e){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row","-1");c.SetAttribute("value",e.toString());for(var b=1;b<=this.Queries[0].RecordCount();b++){var d=(e==0?false:(e==1?!this.IsRowSelected(b):true));if(!this.SelectAllOnlyVisible()||(b>=this.ActualPosition()-this.AttR&&b<this.ActualPosition()-this.AttR+this.NumRows)){this.SetRowSelected(d,b,false)}if(d!=this.IsRowSelected(b)){var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.SetAttribute("row",b.toString());c.SetAttribute("value",this.IsRowSelected(b)?"1":"0")}}var a=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,false,a);this.SetRDRowSel(-1,true)};IDPanelSrv.prototype.MultipleDelete=function(p){var q=this.Queries[0].GetAttRecNumber();var m=this.AttR;if(this.IsDO()){var k=this.Queries[0].IDColl;if(k!=null){if(this.MainFrm.ParamsObj().UseRD3){this.Parent.RemovePanelTempMsg(this)}var g=0;var a=k.GetCollection();for(var f=0;f<a.Count();f++){var j=a[f];if(j.Selected()){this.Queries[0].UpdateIMDB(g,true,false,true);this.ValidatingRow=g;var r=new IDVariant();this.FireBeforeDelete(r);if(r.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,79,"IDPanel.DeleteRecord","Panel "+this.GetDTTCaption()+": record delete canceled")}}else{j.set_Deleted(true)}}g++}this.ValidatingRow=-1;if(this.Queries[0].IsMasterDO){var l;try{l=k.SaveToDB()}catch(h){l=false}if(l){if(this.Queries[0].DocTempl!=null){k.PurgeDeleted()}}else{k.set_ShowDeleted(true);k.MoveFirst();while(k.GetAt()!=null){var j=k.GetAt();if(j.Selected()){j.set_Deleted(false)}k.MoveNext()}k.set_ShowDeleted(false)}}}this.ScrollRecTo(q,p)}else{for(var g=0;g<this.SelectedRows.length;g++){if(this.SelectedRows[g]){this.ScrollRecTo(g+1,p);this.AttR=0;this.Queries[0].UpdateIMDB(this.AttR,true,false,true);if(this.DeleteRecord(p,true)){g--}}}}if(this.SortingList!=null&&this.SortingList.Count()>0){this.EnableSorting()}this.ClearRD3Cache();this.AttR=m;var b=q;var o=this.Queries[0].RecordCount();if(b+this.NumRows>=o){q=o-this.NumRows+1}this.ScrollRecTo(q,p);b=this.Queries[0].GetAttRecNumber();o=this.Queries[0].RecordCount();if(b==1&&this.AttR>=o){this.SetInput(o-1,this.FocusedColumn(),1,false)}this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.SetInfoMessage(p.RTCObj.GetConst("108F1F2C-659E-4780-91F3-776EFC76C7F9","Le righe selezionate sono state cancellate come richiesto."));if(!this.IsIMDB()&&(!this.IsDO()||this.Queries[0].IsMasterDO)){this.MainFrm.SoundAction("play","delete")}this.UpdateDynRows(this.Queries[0].RecordCount())};IDPanelSrv.prototype.MultipleDuplicate=function(p){if(this.Status()==Glb.PS_UPDATE){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,193,"IDPanel.MultipleDuplicate","Panel "+this.GetDTTCaption()+": duplicate not done (status = UPDATED)")}return}if(!this.IsDO()){var q=new ArrayList();var s;for(var a=0;a<this.SelectedRows.length;a++){if(this.SelectedRows[a]){var b=new ArrayList();q.Add(b);var f=false;for(var h=0;h<this.UMaster();h++){if(!this.MasterFields[h].Unbound&&this.MasterFields[h].Index!=this.Queries[0].AIFieldIndex){this.Queries[0].ScrollTo(a+1);if(this.Queries[0].IMDBDataSource>-1){s=this.IMDB.Value(this.Queries[0].IMDBDataSource,this.MasterFields[h].GetIMDBIdx(),Glb.IMDB_CURSOR)}else{try{s=this.Queries[0].RS.Get(this.MasterFields[h].GetRSIdx(this.Queries[0].RS))}catch(j){s=new IDVariant()}}if(!f&&(this.MasterFields[h].Flags&Glb.FLD_ISDESCR)!=0&&Glb.ClassDT(this.MasterFields[h].DataType)==Glb.DTC_CHAR&&(this.MasterFields[h].MaxLength>=s.stringValue().length+7)){f=true;b.Add(new IDVariant(s+" (Copy)"))}else{b.Add(s)}}else{b.Add(new IDVariant())}}}}if(this.Queries[0].RecordCount()+q.Count()>this.NumRows){this.ScrollRecTo(this.Queries[0].RecordCount()+q.Count()+1-this.NumRows,p)}else{this.ScrollRecTo(0,p)}var a=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(a<0){a=0}if(a>this.NumRows-1){a=this.NumRows-1}this.AttR=a;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();a=1;for(var m=0;m<q.Count();m++){var b=q[m];var h=0;for(var o=0;o<b.Count();o++){s=b[o];this.MasterFields[h].bValues(this.AttR+a-1).SetNewValue(s);h=h+1}if(this.AttR+a-1==this.NumRows-1&&q.Count()!=a){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,194,"IDPanel.MultipleDuplicate","Panel "+this.GetDTTCaption()+": can't duplicate all rows because there are not enough empty rows in the panel ("+q.Count()+" rows to be duplicated and only "+a+" duplicated)")}break}a++}this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetModified(p);this.ReValidate()}else{this.ScrollRecTo(2147483647,p);var a=this.Queries[0].RecordCount()-this.Queries[0].GetAttRecNumber()+1;if(a<0){a=0}if(a>this.NumRows-1){a=this.NumRows-1}this.AttR=a;this.Queries[0].UpdateIMDB(this.AttR,true,true,true);this.SetInput();var l=this.Queries[0].IDColl;if(l!=null){l.set_UIMode(true);l.MoveFirst();while(l.GetAt()!=null){var k=l.GetAt();if(k.Selected()){var g=k.Duplicate(9999);try{l.Add(g)}catch(j){}}l.MoveNext()}l.set_UIMode(false)}}};IDPanelSrv.prototype.IsAdvTabOrderEnabled=function(){if(this.FormTabOrder==null||this.ListTabOrder==null){return false}else{return true}};IDPanelSrv.prototype.SetTabOrder=function(a,d,c){if(c==Glb.PANEL_FORM){if(this.FormTabOrder==null){this.FormTabOrder=new Array(this.UFields()+1);for(var b=0;b<this.UFields()+1;b++){this.FormTabOrder[b]=0}}this.FormTabOrder[d]=a}else{if(this.ListTabOrder==null){this.ListTabOrder=new Array(this.UFields()+1);for(var b=0;b<this.UFields()+1;b++){this.ListTabOrder[b]=0}}this.ListTabOrder[d]=a}};IDPanelSrv.prototype.GetTabOrderFieldIdx=function(a,b){if(this.IsAdvTabOrderEnabled()){if(b==Glb.PANEL_FORM){return this.FormTabOrder[a]}else{return this.ListTabOrder[a]}}else{return a}};IDPanelSrv.prototype.GetFieldIdxTabOrder=function(a,c){if(this.IsAdvTabOrderEnabled()){var b=0;for(b=0;b<(c==Glb.PANEL_LIST?this.ListTabOrder.length:this.FormTabOrder.length);b++){if((c==Glb.PANEL_LIST?this.ListTabOrder[b]:this.FormTabOrder[b])==a){break}}return b}else{return a}};IDPanelSrv.prototype.MoveField=function(a,f,d){if(f==undefined){f=-1}if(d==undefined){d=Glb.PANEL_LIST}if(this.IsAdvTabOrderEnabled()){var e=this.GetFieldIdxTabOrder(a,d);var c;if(f==-1){c=(d==Glb.PANEL_LIST?this.ListTabOrder.length:this.FormTabOrder.length)-1}else{c=this.GetFieldIdxTabOrder(f,d)}if(e==c||e==c-1){return}this.Fields[this.ListTabOrder[e]].UserChangedField=true;this.Fields[this.ListTabOrder[c]].UserChangedField=true;if(e>c){for(var b=e-1;b>=c;b--){if(d==Glb.PANEL_LIST){this.ListTabOrder[b+1]=this.ListTabOrder[b];this.Fields[this.ListTabOrder[b+1]].UserChangedField=true}else{this.FormTabOrder[b+1]=this.FormTabOrder[b]}}}else{for(var b=e+1;b<c;b++){if(d==Glb.PANEL_LIST){this.ListTabOrder[b-1]=this.ListTabOrder[b];this.Fields[this.ListTabOrder[b-1]].UserChangedField=true}else{this.FormTabOrder[b-1]=this.FormTabOrder[b]}}c--}if(d==Glb.PANEL_LIST){this.ListTabOrder[c]=a}else{this.FormTabOrder[c]=a}this.CalcLayout()}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,196,"IDPanel.MoveField","Panel "+this.GetDTTCaption()+": before moving fields you must enable advanced tab order!")}}};IDPanelSrv.prototype.SetFieldActivator=function(a,c,b){if(b==undefined){b=null}if(this.Fields[a].ActImg!=b){this.Fields[a].ActImg=b;this.Fields[a].RD3Change(RD3Glb.FLD_ACTIMAGE)}if(this.Fields[a].ActWidth!=c){this.Fields[a].ActWidth=c;this.Fields[a].RD3Change(RD3Glb.FLD_ACTWIDTH)}};IDPanelSrv.prototype.AcknowledgeWarnings=function(){var c=this.GetDocument();if(this.Status()==Glb.PS_UPDATE||c!=null){var a=this.ValidatingRow;this.ValidatingRow=this.AttR;for(var b=0;b<this.Fields.length;b++){this.Fields[b].bValues(this.AttR).SetAck(true)}this.ValidatingRow=a}if(c!=null){c.AcknowledgeWarnings()}};IDPanelSrv.prototype.FocusedColumn=function(){var b=-1;if(this.HasFocus()){var a=this.Parent.ActiveElement.indexOf("R");var d=this.Parent.ActiveElement.indexOf("C");if(a>0&&d>0){try{b=parseInt(this.Parent.ActiveElement.substr(d+1,a-(d+1)),10)}catch(c){}}}return b};IDPanelSrv.prototype.SortingListStr=function(){var b="";for(var a=0;a<this.SortingList.Count();a++){var c=this.SortingList[a];if(c.SortMode!=0&&c.IdxPanel==0){if(b.length>0){b+=", "}b+=c.Code+(c.SortMode>0?"":" desc")}}return b};IDPanelSrv.prototype.set_SortingListStr=function(e){var a=new StringTokenizer();a.setString(new IDVariant(e));this.ResetSortList();while(a.hasNext()){var c=a.next().stringValue();var d=true;if(c.length>=4&&String.compare(c.substr(c.length-4,4)," asc",true)==0){d=true;c=c.substr(0,c.length-4)}if(c.length>=5&&String.compare(c.substr(c.length-5,5)," desc",true)==0){d=false;c=c.substr(0,c.length-5)}c=IDL.Trim(new IDVariant(c),true,true).stringValue();for(var b=0;b<this.MasterFields.length;b++){if(this.MasterFields[b].Code.equals(c)){this.AddToSortList(this.MasterFields[b].Index,d);break}}}this.EnableSorting()};IDPanelSrv.prototype.SetRDRowSel=function(f,a){var d;var c;if((this.PanelMode==Glb.PANEL_FORM&&!this.MainFrm.ParamsObj().UseRD3)||this.Fields.length==0){return}if(f==-1){d=0;c=this.RDRowSel.length-1}else{d=f;c=f}for(var e=d;e<=c&&e<this.RDRowSel.length;e++){this.RDRowSel[e]=a;if(a){this.Fields[0].Values[e].RD3Change(RD3Glb.VAL_ROWSEL)}}};IDPanelSrv.prototype.Resize=function(b,c){var h=this.MainFrm.ParamsObj().UseRD3;var e=this.PanelMode;var d=this.NumRows;var a=this.GetBoundRect();if(this.LastResizeWidth==0){this.LastResizeWidth=a.Width;this.LastResizeHeight=c}var g=0;var j=0;if(!h){if(this.Pages.length>0){j=4;g=Glb.PAN_OFFS_PAGEY;if(this.NumPagPerLine>0&&this.Pages.length>this.NumPagPerLine){g=Glb.PAN_OFFS_PAGEY*Math.floor((this.Pages.length+0)/this.NumPagPerLine)}}}if((this.Flags&Glb.PAN_HASFORM)!=0){this.ResizeForm(b-this.LastResizeWidth,c-this.LastResizeHeight,b-j,c-g)}if((this.Flags&Glb.PAN_HASLIST)!=0){this.ResizeList(b-this.LastResizeWidth,c-this.LastResizeHeight,b-j,c-g)}this.PanelMode=e;this.CalcLayout();for(var f=0;f<this.Groups.length;f++){this.Groups[f].Resize()}if(this.NumRows!=d){this.ScrollRecBy(0,this.MainFrm)}this.BoundRect=a;this.BoundRect.Width+=(b-this.LastResizeWidth);this.BoundRect.Height+=(c-this.LastResizeHeight);this.LastResizeHeight=c;this.LastResizeWidth=b};IDPanelSrv.prototype.ResizeForm=function(e,d,h,a){this.PanelMode=Glb.PANEL_FORM;var b=this.GetBoundRect(true);var k=b.Width-this.LastResizeWidth;var j=b.Height-this.LastResizeHeight;if(k<0){k=0}if(j<0){j=0}if(e>0&&k>0){e-=k;if(e<0){e=0}}if(d>0&&j>0){d-=j;if(d<0){d=0}}if(e!=0||d!=0){for(var g=0;g<this.Fields.length;g++){this.Fields[g].Resize(e,d,Glb.PANEL_FORM)}}var f=k;var c=j;b=this.GetBoundRect(true);k=b.Width-h;j=b.Height-a;var m=0;if(e<0&&k>f){m=k-f}var l=0;if(d<0&&j>c){l=j-c}if(m>0||l>0){for(var g=0;g<this.Fields.length;g++){this.Fields[g].Resize(m,l,Glb.PANEL_FORM)}}};IDPanelSrv.prototype.ResizeList=function(e,d,y,v){this.PanelMode=Glb.PANEL_LIST;var w=this.PanelPage;var o=this.GetBoundRect(true);d+=this.LastDeltaY;this.LastDeltaY=0;var p=o.Width-this.LastResizeWidth;var m=o.Height-this.LastResizeHeight;if(p<0){p=0}if(m<0){m=0}if(e>0&&p>0){e-=p;if(e<0){e=0}}if(d>0&&m>0){d-=m;if(d<0){d=0}}if(this.MaxHRow>0){if(d>0){this.LastDeltaY=d%(this.MaxHRow+this.OffsetRow());d-=this.LastDeltaY}if(d<0){this.LastDeltaY=(-d)%(this.MaxHRow+this.OffsetRow());this.LastDeltaY=(this.MaxHRow+this.OffsetRow())-this.LastDeltaY;d-=this.LastDeltaY}}if((this.Flags&Glb.PAN_SCROLLREC)!=0&&this.FixedCols()==0){y+=Glb.SCROLL_OFFSET}var s=e;if(e!=0){if(this.HListResizeMode==Glb.RESMODE_MOVE){this.ListLeft=this.ListLeft+e;this.RD3Change(RD3Glb.PAN_LISTLEFT)}if(this.HListResizeMode==Glb.RESMODE_STRETCH){var z=e;this.ListWidth+=z;this.RD3Change(RD3Glb.PAN_LISTWIDTH);var B=-1;var h=-1;var q=0;var A;for(var t=0;t<this.Pages.length;t++){A=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==t&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){A=A+this.Fields[u].ListWidth}}if(A>q){h=t;this.PanelPage=t;q=A}}s=z;var b=true;while(z!=0&&b){b=false;for(var u=0;u<this.Fields.length;u++){var t=(u+this.LastColumnStretched)%(this.Fields.length);var x=this.Fields[t];if(x.CanResizeList(z,h)){b=true;B=t;if(z>0){x.ListWidth++;x.RD3Change(RD3Glb.FLD_LISTWIDTH);z--}else{x.ListWidth--;x.RD3Change(RD3Glb.FLD_LISTWIDTH);z++}}if(z==0){break}}}if(B>-1){this.LastColumnStretched=B+1}if(!b){s-=z;this.ListWidth-=z;this.RD3Change(RD3Glb.PAN_LISTWIDTH)}var a=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==-1&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){a=a+this.Fields[u].ListWidth}}for(var t=0;t<this.Pages.length;t++){if(t!=h){A=0;for(var u=0;u<this.Fields.length;u++){if(this.Fields[u].Page==t&&(this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){A=A+this.Fields[u].ListWidth}}z=this.ListWidth-(A+a);while(z!=0&&b){b=false;for(var u=0;u<this.Fields.length;u++){var x=this.Fields[u];if(x.Page==t){if(x.CanResizeList(z,t)){b=true;if(z>0){x.ListWidth++;x.RD3Change(RD3Glb.FLD_LISTWIDTH);z--}else{x.ListWidth--;x.RD3Change(RD3Glb.FLD_LISTWIDTH);z++}}if(z==0){break}}}}}}}}if(d!=0){if(this.VListResizeMode==Glb.RESMODE_MOVE){this.ListTop+=d;for(var u=0;u<this.Fields.length;u++){if((this.Fields[u].Flags&Glb.FLD_INLIST)!=0&&(this.Fields[u].Flags&Glb.FLD_LISTLIST)!=0){this.Fields[u].ListTop+=d}}this.RD3Change(RD3Glb.PAN_LISTTOP)}if(this.VListResizeMode==Glb.RESMODE_STRETCH){this.ListHeight+=d;this.RD3Change(RD3Glb.PAN_LISTHEIGHT)}}if(s!=0||d!=0){for(var u=0;u<this.Fields.length;u++){this.Fields[u].Resize(s,d,Glb.PANEL_LIST)}}this.CalcLayout();var c=p;var g=m;o=this.GetBoundRect(true);p=o.Width-y;m=o.Height-v;var l=0;if(e<0&&p>c){l=p-c}var k=0;if(d<0&&m>g){k=m-g}if(l>0||k>0){for(var u=0;u<this.Fields.length;u++){this.Fields[u].Resize(l,k,Glb.PANEL_LIST)}}this.PanelPage=w};IDPanelSrv.prototype.GetFieldSum=function(k){var g=new IDVariant();var m;var j=null;try{if(this.Fields[k].IdxPanel==0&&Glb.ClassDT(this.Fields[k].DataType)==Glb.DTC_NUMBER&&(this.Status()==Glb.PS_DATA||this.Status()==Glb.PS_UPDATE)){var b=0;var h;var c=this.Queries[0].IMDBDataSource;var l=0;var a=this.Queries[0].GetAttRecNumber()-1;if(this.Queries[0].IsDO){h=this.Fields[k].GetDOIdx(j);if(this.Queries[0].IDColl==null){j=this.GetDocument();if(j!=null&&this.Status()==Glb.PS_DATA){m=j.GetPropByIndex(h);if(m.Type!=IDVariant.NULL){g=IDL.Add(g,m)}}}else{this.Queries[0].IDColl.set_UIMode(true);this.Queries[0].IDColl.MoveFirst();while(!this.Queries[0].IDColl.IsEof()){if(this.Status()!=Glb.PS_UPDATE||b<a||b>=a+this.NumRows){j=this.Queries[0].IDColl.GetAt();m=j.GetPropByIndex(h);if(m.Type!=IDVariant.NULL){g=IDL.Add(g,m)}}this.Queries[0].IDColl.MoveNext();b++}this.Queries[0].IDColl.set_UIMode(false)}}else{if(c>-1){h=this.Fields[k].GetIMDBIdx();this.IMDB.TblMoveFirst(c,Glb.IMDB_CURSOR);while(!this.IMDB.Eof(c,Glb.IMDB_CURSOR)){if(this.Status()!=Glb.PS_UPDATE||b<a||b>=a+this.NumRows){m=this.IMDB.Value(c,h,Glb.IMDB_CURSOR);if(m.Type!=IDVariant.NULL){g=IDL.Add(g,m)}}this.IMDB.TblMoveNext(c,Glb.IMDB_CURSOR);b++}}else{h=this.Fields[k].GetRSIdx(this.Queries[0].RS);l=this.Queries[0].RS.getRow();if(l>0){this.Queries[0].RS.MoveFirst()}while(!this.Queries[0].RS.EOF()){if(this.Status()!=Glb.PS_UPDATE||b<a||b>=a+this.NumRows){m=this.Queries[0].RS.Get(h);if(m.Type!=IDVariant.NULL){g=IDL.Add(g,m)}}this.Queries[0].RS.MoveNext();b++}if(l>0){this.Queries[0].RS.absolute(l)}}}if(this.Status()==Glb.PS_UPDATE){for(b=0;b<this.NumRows;b++){m=this.Fields[k].bValues(b).Value;if(m.Type!=IDVariant.NULL){g=IDL.Add(g,m)}}}}}catch(f){WriteToConsoleError(f);g=new IDVariant()}return g};IDPanelSrv.prototype.GetFieldCode=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Code}else{return""}};IDPanelSrv.prototype.GetFieldEnabled=function(c,b){if(c>=0&&c<this.UFields()){var a=this.bFields(c);if(a.IdxPanel==-1){return(a.Flags&Glb.OBJ_ENABLED)!=0}else{return a.IsEnabled(b)}}else{return false}};IDPanelSrv.prototype.GetFieldPK=function(b){if(b>=0&&b<this.UFields()){var a=this.bFields(b);return((a.Flags&Glb.FLD_ISKEY)!=0)}else{return false}};IDPanelSrv.prototype.GotoAbsolute=function(a){this.Queries[0].GotoAbsolute(a)};IDPanelSrv.prototype.GotoNext=function(){this.Queries[0].GotoNext()};IDPanelSrv.prototype.GotoFirst=function(){this.Queries[0].GotoFirst()};IDPanelSrv.prototype.GotoLast=function(){this.Queries[0].GotoLast()};IDPanelSrv.prototype.RSEOF=function(){return this.Queries[0].RSEOF()};IDPanelSrv.prototype.RefreshFields=function(){for(var a=0;a<this.Fields.length;a++){this.Fields[a].RSIdx=-1}this.ScrollRecTo(0,this.MainFrm)};IDPanelSrv.prototype.IsContentModified=function(){var a=false;if(this.Queries[0].IDColl!=null){a=this.Queries[0].IDColl.IsModified()}else{if(this.Queries[0].Document!=null){a=this.Queries[0].Document.IsModified()}else{a=this.Status()==Glb.PS_UPDATE}}if(!a){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].SubFrame!=0){if(this.Parent.Frames[this.Fields[c].SubFrame].Content instanceof IDPanelSrv){var d=this.Parent.Frames[this.Fields[c].SubFrame].Content;a=d.IsContentModified();if(a){break}}}}}return a};IDPanelSrv.prototype.IsContentInError=function(){var a=this.IsPanelInError();if(!a){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].SubFrame!=0){if(this.Parent.Frames[this.Fields[c].SubFrame].Content instanceof IDPanelSrv){var d=this.Parent.Frames[this.Fields[c].SubFrame].Content;a=d.IsContentInError();if(a){break}}}}}return a};IDPanelSrv.prototype.ReleaseLock=function(){if(this.Queries[0].IDColl!=null){var e=this.Queries[0].IDColl.GetCollection();for(var a=0;a<e.Count();a++){var b=e[a];b.ReleaseLock()}}else{if(this.Queries[0].Document!=null){this.Queries[0].Document.ReleaseLock()}}};IDPanelSrv.prototype.ExportData=function(E,h){if(E==undefined){E=true}if(h==undefined){h=true}if(!h){var w=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": received command "+this.DecodeCommand(Glb.PCM_CSV)+"; fire OnPanelCommand event"+(h?" (USER operation)":""))}this.Parent.OnPanelCommand(this,new IDVariant(Glb.PCM_CSV),w,new IDVariant(h));if(w.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"IDPanel.OnPanelCommand","Panel "+this.GetDTTCaption()+": command canceled")}return""}}var z=new StringTokenizer();z.UseDecimalDot=this.MainFrm.ParamsObj().UseDecimalDot;var v=new IDVariant(z.UseDecimalDot?",":";");try{if(this.MainFrm==null){return""}var p=this.ActualPosition();var t=this.AttR;var s="";if(IDL.IsNull(this.ExportLabel)){s+=this.GetDTTCaption()+v.stringValue()+v.stringValue()+this.QBETipText+"\n"}else{if(!this.ExportLabel.stringValue().equals("")){s+=this.ExportLabel.stringValue()+"\n"}}z.setString(new IDVariant(),v);for(var A=0;A<this.Fields.length;A++){var b=A;if(this.IsAdvTabOrderEnabled()){b=this.GetTabOrderFieldIdx(A,this.PanelMode)}if(this.Fields[b].IdxPanel>=0&&this.Fields[b].DataType!=Glb.DT_DOC_OLE&&this.Fields[b].IsVisible(this.AttR,false)){if((this.VS.Flags(this.Fields[b].VisualStyle)&Glb.FL_VIS_PASSWORD)==0){z.addToken(new IDVariant(this.Fields[b].Header))}}}s+=z.getString()+"\n";this.DisableNotification=true;for(var B=1;B<=this.Queries[0].RecordCount();B++){if(this.EnableMultipleSel()&&this.ShowMultipleSel()&&!this.IsRowSelected(B)){continue}z.setString(new IDVariant(),v);this.set_ActualPosition(B);for(var A=0;A<this.Fields.length;A++){var b=A;if(this.IsAdvTabOrderEnabled()){b=this.GetTabOrderFieldIdx(A,this.PanelMode)}if(this.Fields[b].IdxPanel>=0&&this.Fields[b].DataType!=Glb.DT_DOC_OLE&&this.Fields[b].IsVisible(this.AttR,false)){if((this.VS.Flags(this.Fields[b].VisualStyle)&Glb.FL_VIS_PASSWORD)==0){if((this.Fields[b].Flags&Glb.FLD_AUTOLOOKUP)==0){var F=this.Fields[b].bValues(this.AttR);var m=F.Value;var x=true;var c=this.VS.Mask(this.Fields[b].VisualStyle);if(!this.Fields[b].Mask.equals("")){c=this.Fields[b].Mask;x=false}if(!c.equals("=")&&this.Fields[b].EditorType!=1){var o=new IDVariant();var C=new IDVariant();var l=new IDVariant();this.Fields[b].GetClientMask(o,C,F.Value,c,F.Text,l,F.DynText,x);m=o}if(this.Fields[b].VisualFlag(Glb.PFLVISPROP_EXPORTNAMES)&&F.ValueListIndexes.length>0){m=new IDVariant(F.ValueListIndexes[0].Name)}z.addToken(m)}else{z.addToken(new IDVariant(this.Fields[b].bValues(this.AttR).Text))}}}}s+=z.getString()+"\n"}this.DisableNotification=false;this.set_ActualPosition(p-t);this.Parent.FocusPriority=0;this.set_ActualPosition(p);var d;if(this.MainFrm.ShellObject.IsInsideShell()){var k="temp/"+GUID.DocID2GUID(MDOInit.GetNewDocID().stringValue())+".csv";var g=this.MainFrm.RealPath+"/"+k;var u=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(g),u);RD4_WebEntryPoint.VBFile.WriteLine(u,new IDVariant(s));RD4_WebEntryPoint.VBFile.Close(u);d=k}else{var q=new Uint8Array(s.length);for(var B=0;B<s.length;B++){q[B]=s.charCodeAt(B)}var y=new BlobBuilder();y.append(q.buffer);var f=this.MainFrm.GetMimeType("csv");var a=y.getBlob(f);d=URL.createObjectURL(a)}if(E){this.MainFrm.TempFiles.Add(g);this.MainFrm.set_RedirectTo(new IDVariant(d));this.MainFrm.set_RedirectNewWindow(true)}return d}catch(D){WriteToConsoleError(D)}this.DisableNotification=false;return""};IDPanelSrv.prototype.GetQBETips=function(E){if(E==undefined){E=true}var K="";if(E){K+="<table>"}if(this.Status()==Glb.PS_QBE){for(var J=0;J<this.UMaster();J++){var L=this.MasterFields[J];var H=L.LastQBE;var O=L.HasConcept("DO_ID");var g="";var e="";if(L.IsVisible(0)){if(L.Header.length>20){e=L.AbbrHeaderList}else{e=L.Header}}var G=0;while(H.length>0){var j=H;var w=false;var h=false;if(H.charAt(0)!="="||O){var N=H.indexOf(L.GetQBESep());if(N>=0){j=H.substr(0,N);H=H.substr(N+1)}else{j=H;H=""}}else{w=true;h=true;j=H.remove(0,1);H=""}if(g.length>0){g+=" "+this.MainFrm.RTCObj.GetConst("A3A75694-D0CE-479D-B528-F07FDEC0C0F5","oppure")+" "}if(j.length>0&&!w&&!O){w=true;if(j.charAt(0)==">"){w=false;if(this.MainFrm.ParamsObj().QBETrueLessThan){g+=this.MainFrm.RTCObj.GetConst("03626A3B-2AF0-4173-ACB8-C14B88D40941","è maggiore di")}else{g+=this.MainFrm.RTCObj.GetConst("755EF020-4A09-4C36-8143-DB00D11D12E9","è maggiore o uguale a")}g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1)))+"</span>":" "+this.DecodeValueList(L,j.substr(1)))}if(j.charAt(0)=="<"){w=false;if(this.MainFrm.ParamsObj().QBETrueLessThan){g+=this.MainFrm.RTCObj.GetConst("7E18E4CD-EEA8-45db-91B1-F15590AACCE8","è minore di")}else{g+=this.MainFrm.RTCObj.GetConst("255523FA-4C5A-4BA5-ABA1-6F2566681044","è minore o uguale a")}g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1)))+"</span>":" "+this.DecodeValueList(L,j.substr(1)))}if(j.charAt(0)=="."){w=false;g+=this.MainFrm.RTCObj.GetConst("E2A280F0-71A5-4FC8-8825-35C6CA4890F1","ha un valore")}if(j.charAt(0)=="!"){w=false;g+=this.MainFrm.RTCObj.GetConst("17A9DC7A-9763-49D8-98E5-0450C364ED11","non ha un valore")}if(j.charAt(0)=="#"){var C="";w=false;C=this.MainFrm.RTCObj.GetConst("524DF288-90C3-45AE-9934-831D88F92FB1","è diverso da")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1)))+"</span>":" "+this.DecodeValueList(L,j.substr(1)));if(Glb.ClassDT(L.DataType)==Glb.DTC_CHAR&&L.QBELike){j=j.substr(1);C=this.MainFrm.RTCObj.GetConst("28784B70-22BB-46CE-AA32-F9557EF5F31C","non comincia per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j))+"</span>":" "+this.DecodeValueList(L,j));if(j.length>0){var P=false;if(j.charAt(0)=="*"||j.charAt(0)=="%"){C=this.MainFrm.RTCObj.GetConst("20E397D4-07A3-4718-B95A-A518C6FF8C4E","non finisce per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1)))+"</span>":" "+this.DecodeValueList(L,j.substr(1)));P=true}if(j.length>1&&(j.charAt(j.length-1)=="*"||j.charAt(j.length-1)=="%")){if(P){C=this.MainFrm.RTCObj.GetConst("5C7BF51B-0B50-40E5-83BA-BCBE1D0B0F6A","non contiene")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1,j.length-2)))+"</span>":" "+this.DecodeValueList(L,j.substr(1,j.length-2)))}else{C=this.MainFrm.RTCObj.GetConst("28784B70-22BB-46CE-AA32-F9557EF5F31C","non comincia per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(0,j.length-1)))+"</span>":" "+this.DecodeValueList(L,j.substr(0,j.length-1)))}}}}g+=C}}if(w&&!h){var C="";C=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j))+"</span>":this.DecodeValueList(L,j));var N=j.indexOf(":");var M=j.indexOf(":",N+1);if(N>=0&&M<0){var c=j.substr(0,N);var a=j.substr(N+1);if(c.length>0&&a.length>0){g+=this.MainFrm.RTCObj.GetConst("601AE10A-5A84-47C7-866F-63D00A647A4C","è compreso fra");g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,c))+"</span>":" "+this.DecodeValueList(L,c));g+=this.MainFrm.RTCObj.GetConst("9FC92BC2-DF56-44DB-B89E-727D25C6812D"," e");g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,a))+"</span>":" "+this.DecodeValueList(L,a))}else{if(c.length>0){g+=this.MainFrm.RTCObj.GetConst("755EF020-4A09-4C36-8143-DB00D11D12E9","è maggiore o uguale a");g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,c))+"</span>":" "+this.DecodeValueList(L,c))}else{if(a.length>0){g+=this.MainFrm.RTCObj.GetConst("255523FA-4C5A-4BA5-ABA1-6F2566681044","è minore o uguale a");g+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,a))+"</span>":" "+this.DecodeValueList(L,a))}}}w=false}}if(w||O){if(L.ValueList.Count()>0){g+=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j))+"</span>":" "+this.DecodeValueList(L,j))}else{if((L.Flags&Glb.FLD_AUTOLOOKUP)!=0){var l=null;for(var x=0;x<this.Queries.length;x++){if(this.Queries[x].FieldIndex==L.Index){l=this.Queries[x];break}}if(l!=null){g+=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a")+(E?" <span>"+Glb.HTMLEncode(l.GetValueSourceValue(new IDVariant(j)).ToString())+"</span>":" "+l.GetValueSourceValue(new IDVariant(j)).ToString())}}else{var C="";C=this.MainFrm.RTCObj.GetConst("62D62032-E653-4712-A3E0-78DC03F01E95","è uguale a");if(L.IsVisible(0)&&!O){C+=(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j))+"</span>":" "+this.DecodeValueList(L,j))}var I=false;for(var s=1;s<this.Queries.length;s++){var Q=true;var o=false;for(var F=0;F<this.Queries[s].LookupParams.Count();F++){var u=this.Queries[s].LookupParams[F];var z=false;if(u.MstField!=null){for(var D=0;D<this.MasterFields.length;D++){var y=this.MasterFields[D];if(u.MstField==y){z=true;if(y==L){o=true}}if(y==L){break}}Q&=z}}if(Q&&o){var q=(L.IsVisible(0)&&!O);for(var p=0;p<this.Fields.length;p++){var d=this.Fields[p];if(d.IdxPanel==s&&d.IsVisible(this.AttR,false)){C+=(q?" - ":" ");if(e.length==0){if(d.Header.length>20){e=d.AbbrHeaderList}else{e=d.Header}}if(d.bValues(this.AttR).ValueListIndexes.length>0){var r="";for(var m=0;m<d.bValues(this.AttR).ValueListIndexes.Count();m++){var A=d.bValues(this.AttR).ValueListIndexes[m];if(A.Value.equals(d.bValues(this.AttR).Value)){r=A.Name}}C+=(E?"<span>"+Glb.HTMLEncode(r)+"</span>":r)}else{var B=d.bValues(this.AttR).Text;if(L.iMultiCriteria){var k=B.split(this.MainFrm.ComboNameSep);B=(G<k.length?k[G]:"")}C+=(E?"<span>"+Glb.HTMLEncode(B)+"</span>":B)}q=true;I=true}}break}}if(!I&&!h){if(Glb.ClassDT(L.DataType)==Glb.DTC_CHAR){if(j.length>0){C=this.MainFrm.RTCObj.GetConst("7AF4A3F7-0A4B-4FE1-A585-60370C8C2B6A","comincia per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j))+"</span>":" "+this.DecodeValueList(L,j));var P=false;if(j.charAt(0)=="*"||j.charAt(0)=="%"){C=this.MainFrm.RTCObj.GetConst("379B2DB2-4FCA-4AD6-978C-410DAF5CD89D","finisce per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1)))+"</span>":" "+this.DecodeValueList(L,j.substr(1)));P=true}if(j.length>1&&(j.charAt(j.length-1)=="*"||j.charAt(j.length-1)=="%")){if(P){C=this.MainFrm.RTCObj.GetConst("550320A9-DFB1-4B60-B3C5-329E49D1DF3F","contiene")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(1,j.length-2)))+"</span>":" "+this.DecodeValueList(L,j.substr(1,j.length-2)))}else{C=this.MainFrm.RTCObj.GetConst("7AF4A3F7-0A4B-4FE1-A585-60370C8C2B6A","comincia per")+(E?" <span>"+Glb.HTMLEncode(this.DecodeValueList(L,j.substr(0,j.length-1)))+"</span>":" "+this.DecodeValueList(L,j.substr(0,j.length-1)))}}}}}g+=C}}}G++}if(g.length>0&&e.length>0){if(E){K+="<tr><td class=QBEF1>";K+=e;K+="</td><td class=QBEF2>";K+=g;K+="</td></tr>"}else{K+=e+" : ";K+=g+". "}}}}if(E){if(K.length>7){K+="</table>"}else{K=K.remove(0,K.length)}}return K};IDPanelSrv.prototype.DecodeValueList=function(c,a){for(var d=0;d<c.ValueList.Count();d++){var b=c.ValueList[d];if(b.Value.ToString().equals(a)){return b.Name}}return a};IDPanelSrv.prototype.getDebugInfo=function(b,a){var c=null;var d=this.FindField(a);if(d>0){c=FieldValue(d)}if(c!=null){return c.getDebugInfo(0,"")}else{return""}};IDPanelSrv.prototype.GetFieldPage=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Page}else{return -1}};IDPanelSrv.prototype.GetFieldGroup=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).Group}else{return -1}};IDPanelSrv.prototype.GetFieldIdxPanel=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).IdxPanel}else{return -2}};IDPanelSrv.prototype.GetFieldDataType=function(a){if(a>=0&&a<this.UFields()){return this.bFields(a).DataType}else{return -1}};IDPanelSrv.prototype.FindDocument=function(c){if(this.Queries[0].IDColl!=null){var a=this.Queries[0].IDColl.ShowHid;this.Queries[0].IDColl.ShowHid=false;var b=this.Queries[0].IDColl.FindDoc(c);this.Queries[0].IDColl.ShowHid=a;if(b>0){this.Parent.FocusPriority=0;this.set_ActualPosition(b);this.SetInput()}}};IDPanelSrv.prototype.FindRecord=function(h,o,f,m,d,l,c,k,a,j){if(f==undefined){f=null}if(m==undefined){m=null}if(d==undefined){d=null}if(l==undefined){l=null}if(c==undefined){c=null}if(k==undefined){k=null}if(a==undefined){a=null}if(j==undefined){j=null}var e=this.ActualPosition();var b=this.AttR;var p=false;var g;if(this.IsShowingGrouping()){this.set_SelectedRow(0)}this.DisableNotification=true;this.DisableLookups=true;if(this.Fields[h.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(f!=null&&this.Fields[f.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(d!=null&&this.Fields[d.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(c!=null&&this.Fields[c.intValue()].IdxPanel>0){this.DisableLookups=false}else{if(a!=null&&this.Fields[a.intValue()].IdxPanel>0){this.DisableLookups=false}}}}}for(g=1;g<=this.Queries[0].RecordCount();g++){this.set_ActualPosition(g);if(!this.Fields[h.intValue()].bValues(this.AttR).Value.equals(o)){continue}else{if(f!=null){if(!this.Fields[f.intValue()].bValues(this.AttR).Value.equals(m)){continue}else{if(d!=null){if(!this.Fields[d.intValue()].bValues(this.AttR).Value.equals(l)){continue}else{if(c!=null){if(!this.Fields[c.intValue()].bValues(this.AttR).Value.equals(k)){continue}else{if(a!=null){if(!this.Fields[a.intValue()].bValues(this.AttR).Value.equals(j)){continue}}}}}}}}}p=true;break}this.set_ActualPosition(e-b);this.Parent.FocusPriority=0;this.set_ActualPosition(e);if(this.IsShowingGrouping()){this.set_SelectedRow(b)}this.DisableNotification=false;this.DisableLookups=false;if(p){this.Parent.FocusPriority=0;this.set_ActualPosition(g);if(this.IsShowingGrouping()){this.set_SelectedRow(0);this.ForceSendPosition=true}this.SetInput();return new IDVariant(g)}else{return new IDVariant(0)}};IDPanelSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true;if((a==RD3Glb.PAN_NUMROWS||a==RD3Glb.PAN_TOTALROWS)&&this.RD3ListCache!=null){if(this.Status()==Glb.PS_QBE){this.RD3ListCache.length=1;this.RD3FormCache.length=1}else{this.RD3ListCache.length=this.Queries[0].RecordCount()+this.NumRows;this.RD3FormCache.length=this.Queries[0].RecordCount()+this.NumRows}}if(a==RD3Glb.PAN_TOTALROWS&&this.Queries[0].IDColl!=null&&this.MainFrm.ParamsObj().UseRD3){if(this.RD3UpdateCount==null){this.RD3UpdateCount=new Array(this.Queries[0].RecordCount())}else{Array.resize(this.RD3UpdateCount,this.Queries[0].RecordCount())}}};IDPanelSrv.prototype.GetRD3Name=function(){return"pan"};IDPanelSrv.prototype.GetRD3Ident=function(c,a){if(arguments.length==0){return WebFrameSrv.prototype.GetRD3Ident.call(this)}else{if(c.equals("frame")){return this.GetRD3Ident()}else{var b="";if(!c.equals("toolbar")){b=c}else{switch(a){case Glb.PCM_FORMLIST:b="formlist";break;case Glb.PCM_SEARCH:b="search";break;case Glb.PCM_FIND:b="find";break;case Glb.PCM_INSERT:b="new";break;case Glb.PCM_DELETE:b="del";break;case Glb.PCM_CANCEL:b="cancel";break;case Glb.PCM_REQUERY:b="refresh";break;case Glb.PCM_UPDATE:b="save";break;case Glb.PCM_DUPLICATE:b="dupl";break;case Glb.PCM_PRINT:b="print";break;case Glb.PCM_CSV:b="csv";break;case Glb.PCM_ATTACH:b="attach";break;case Glb.PCM_NAVIGATION:b="top";break;case Glb.PCM_CUSTOM1:b="custom0";break;case Glb.PCM_CUSTOM2:b="custom1";break;case Glb.PCM_CUSTOM3:b="custom2";break;case Glb.PCM_CUSTOM4:b="custom3";break;case Glb.PCM_CUSTOM5:b="custom4";break;case Glb.PCM_CUSTOM6:b="custom5";break;case Glb.PCM_CUSTOM7:b="custom6";break;case Glb.PCM_CUSTOM8:b="custom7";break}}return this.GetRD3Ident()+(b.length>0?":"+b:"")}}};IDPanelSrv.prototype.RD3RenderDifferences=function(q,u,k){this.DTTTrace(this.MainFrm);var o=this.RD3Changed;if(k&&this.DynamicRows>0&&this.MainFrm.IsMobile()&&this.PanelMode==Glb.PANEL_FORM&&this.NumRows==1){this.OriginalListHeight=0}var A=!k;var p=WebFrameSrv.prototype.RD3RenderDifferences.call(this,q,u,k);if(q==null){q=p}o|=(p!=null);if(q==null&&this.RD3Changed){q=u.AddNewElement("chg");q.SetAttribute("id",this.GetRD3Ident());p=q}if(k||this.RD3Changed){for(var s=0;s<this.RD3PropChg.length;s++){if(this.RD3PropChg[s]||k){this.SetRD3Property(s,q,k)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(k){if(this.RowSelectEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("rck",this.RowSelectEventDef.toString())}if(this.ScrollEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("sck",this.ScrollEventDef.toString())}if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("tck",this.ToolbarEventDef.toString())}if(this.PageClickEventDef!=RD3Glb.EVENT_ACTIVE){q.SetAttribute("pck",this.PageClickEventDef.toString())}if(this.FocusEventDef!=RD3Glb.EVENT_CLIENTSIDE){q.SetAttribute("fed",this.FocusEventDef.toString())}if(this.TextSelectionEventDef!=(RD3Glb.EVENT_DEFERRED)){q.SetAttribute("tsk",this.TextSelectionEventDef.toString())}var y=this.MultiSelEventDef|(this.iActiveMultipleSel?RD3Glb.EVENT_IMMEDIATE:0);if(y!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_CLIENTSIDE)){q.SetAttribute("mse",y.toString())}if(this.ChangeLayoutAnimationDef!=null){q.SetAttribute("cla",this.ChangeLayoutAnimationDef)}if(this.QBETipAnimationDef!=null){q.SetAttribute("qta",this.QBETipAnimationDef)}if(this.ResOnlyVisFlds){q.SetAttribute("rvf",this.ResOnlyVisFlds?"1":"0")}if(this.MainFrm.RD3CanOWA&&!this.IsIMDB()&&this.Queries[0].MstTableName!=null){q.SetAttribute("dsn",(this.IsDO()?"DO":"DB")+":"+this.Queries[0].MstTableName)}if((this.Flags&Glb.PAN_QBEFORM)>0){q.SetAttribute("qbf","1")}if(this.Queries[0].IsDO){q.SetAttribute("ido","1")}}var g=this.Queries[0].GetAttRecNumber()-1;var b=this.NumRows;if(this.Status()==Glb.PS_QBE){g=0;b=1;if(this.RD3ListCache.length==0){b=0}}if(A){var c=false;for(var s=0;s<b&&g>=0&&!c;s++){if(this.PanelMode==Glb.PANEL_LIST){c|=!this.RD3ListCache[g+s]}else{c|=!this.RD3FormCache[g+s]}}if(c){if(q==null){q=u.AddNewElement("chg");q.SetAttribute("id",this.GetRD3Ident());p=q}for(var s=0;s<this.Fields.length;s++){var v=this.Fields[s];if(this.PanelMode==Glb.PANEL_LIST){var z=(s==0&&((v.Flags&Glb.FLD_INLIST)==0));if(z||((v.Flags&Glb.FLD_INLIST)!=0&&v.IdxPanel>=0)){var l=q.AddNewElement("fvl");l.SetAttribute("id",v.GetRD3Ident());for(var r=0;r<b;r++){if(!this.RD3ListCache[g+r]){var e=false;if(z){e=v.Values[r].GetRD3Changed(RD3Glb.VAL_ROWSEL)}var m=v.Values[r].GetRD3Changed(RD3Glb.VAL_VALUELIST);v.Values[r].RD3RenderDifferences(l,true);if(z){v.Values[r].RD3Change(RD3Glb.VAL_ROWSEL,e)}if(m){v.Values[r].RD3Change(RD3Glb.VAL_VALUELIST)}}}}}else{if((v.Flags&Glb.FLD_INFORM)!=0&&v.IdxPanel>=0&&!this.RD3FormCache[g]){var l=q.AddNewElement("fvl");l.SetAttribute("id",v.GetRD3Ident());var m=v.Values[0].GetRD3Changed(RD3Glb.VAL_VALUELIST);v.Values[0].RD3RenderDifferences(l,true);if(m){v.Values[0].RD3Change(RD3Glb.VAL_VALUELIST)}}}}if(this.Queries[0].IsDO&&this.EnableMultipleSel()){if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(true)}for(var r=0;r<b;r++){if(!this.RD3ListCache[g+r]){var x=this.GetDocument(r);if(x!=null&&((this.Flags&Glb.PAN_HASLIST)!=0)){var w=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());w.SetAttribute("row",(g+r+1).toString());w.SetAttribute("value",x.Selected()?"1":"0")}}}if(this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(false)}}}}var t=(k)?q:u;if(k&&this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(true)}if(this.MainFrm.RD3EnableOWA){if(this.Queries[0].RecordCount()>this.NumRows){this.SetDynRows(1000,false);this.UpdateDynRows(this.Queries[0].RecordCount());this.ScrollRecTo(0,this.MainFrm)}}var h=false;for(var s=0;s<this.RDRowSel.length&&!h;s++){h|=this.RDRowSel[s]}for(var s=0;s<this.Fields.length;s++){if((this.PanelMode==Glb.PANEL_LIST&&((this.Fields[s].Flags&Glb.FLD_INLIST)!=0)||s==0)||(this.PanelMode==Glb.PANEL_FORM&&(this.Fields[s].Flags&Glb.FLD_INFORM)!=0)||k){o|=this.Fields[s].RD3RenderDifference(t,k,(h&&s==0))}}if(k&&this.Queries[0].IDColl!=null){this.Queries[0].IDColl.set_UIMode(false)}for(var s=0;s<this.Pages.length;s++){o|=this.Pages[s].RD3RenderDifference(t,k)}for(var s=0;s<this.Groups.length;s++){o|=this.Groups[s].RD3RenderDifference(t,k)}if(o&&this.RD3ListCache!=null){for(var s=0;s<b&&g>=0;s++){if(this.PanelMode==Glb.PANEL_FORM){this.RD3FormCache[g+s]=true}else{this.RD3ListCache[g+s]=true}}}if((this.RD3Sendmulti||(k&&!this.Queries[0].IsDO&&this.iStatus!=Glb.PS_QBE))&&this.EnableMultipleSel()&&((this.Flags&Glb.PAN_HASLIST)!=0)){this.RD3SendMultiselection()}this.FinalUpdate=false;return o?p:null};IDPanelSrv.prototype.SetRD3Property=function(o,s,l){switch(o){case RD3Glb.PAN_PANELMODE:if(this.PanelMode==0&&l){break}s.SetAttribute("mod",this.PanelMode.toString());break;case RD3Glb.PAN_MASTER:var k=this.Queries[0]!=null&&this.Queries[0].IsDO&this.Queries[0].IsMasterDO;if(!k&&l){break}s.SetAttribute("mst",k?"1":"0");break;case RD3Glb.PAN_STATUS:s.SetAttribute("sta",this.iStatus.toString());if(this.Queries[0]!=null&&this.Queries[0].IsDO){var c=false;var j=true;if(this.Queries[0].IDColl!=null){c=this.Queries[0].IDColl.IsModified()}else{var q=this.GetDocument();if(q!=null){c=q.IsModified()}}if(c){j=this.CanSaveMasterDoc()}if(!l||c){s.SetAttribute("dom",c?"1":"0")}if(!l||!j){s.SetAttribute("csa",j?"1":"0")}}break;case RD3Glb.PAN_NUMROWS:var f=this.NumRows;if(this.MainFrm.IsMobile()&&this.IsShowingGrouping()&&this.Queries[0].RecordCount()==this.NumRows){var g=this.GroupRoot.getLabelNumber();f+=g}s.SetAttribute("num",f.toString());break;case RD3Glb.PAN_MAXHROW:s.SetAttribute("mhr",(this.MaxHRow!=0?this.MaxHRow:20).toString());break;case RD3Glb.PAN_PANELPAGE:if(this.PanelPage==0&&l){break}s.SetAttribute("pag",this.PanelPage.toString());break;case RD3Glb.PAN_HEADERSIZE:s.SetAttribute("hds",this.HeaderSize.toString());break;case RD3Glb.PAN_SHOWTOOLBAR:if(this.ShowToolbar&&l){break}s.SetAttribute("stb",this.ShowToolbar?"1":"0");break;case RD3Glb.PAN_SHOWSTATUSBAR:if(this.ShowStatusbar&&l){break}s.SetAttribute("ssb",this.ShowStatusbar?"1":"0");break;case RD3Glb.PAN_SHOWROWSELECTOR:if(this.ShowRowSelector&&l){break}s.SetAttribute("srs",this.ShowRowSelector?"1":"0");break;case RD3Glb.PAN_SHOWMULTIPLESEL:if(!this.ShowMultipleSel(false)&&l){break}s.SetAttribute("sms",this.ShowMultipleSel(false)?"1":"0");break;case RD3Glb.PAN_ENABLEMULTIPLESEL:if(this.EnableMultipleSel()&&l){break}s.SetAttribute("ems",this.EnableMultipleSel()?"1":"0");break;case RD3Glb.PAN_SELALLONLYVIS:if(!this.SelectAllOnlyVisible()&&l){break}s.SetAttribute("sov",this.SelectAllOnlyVisible()?"1":"0");break;case RD3Glb.PAN_DYNAMICROWS:if(this.DynamicRows==0&&l){break}s.SetAttribute("dyr",this.DynamicRows.toString());break;case RD3Glb.PAN_DYNAMICHEIGHT:if(!this.DynamicHeight&&l){break}s.SetAttribute("dyh",this.DynamicHeight?"1":"0");break;case RD3Glb.PAN_HASSCROLLBAR:if((this.Flags&Glb.PAN_SCROLLREC)!=0&&l){break}s.SetAttribute("hsc",((this.Flags&Glb.PAN_SCROLLREC)!=0)?"1":"0");break;case RD3Glb.PAN_HASLIST:if((this.Flags&Glb.PAN_HASLIST)!=0&&l){break}s.SetAttribute("hli",((this.Flags&Glb.PAN_HASLIST)!=0)?"1":"0");break;case RD3Glb.PAN_HASFORM:if((this.Flags&Glb.PAN_HASFORM)!=0&&l){break}s.SetAttribute("hfo",((this.Flags&Glb.PAN_HASFORM)!=0)?"1":"0");break;case RD3Glb.PAN_CANUPDATE:if((this.Flags&Glb.PAN_CANUPDATE)!=0&&l){break}s.SetAttribute("upd",((this.Flags&Glb.PAN_CANUPDATE)!=0)?"1":"0");break;case RD3Glb.PAN_CANDELETE:if((this.Flags&Glb.PAN_CANDELETE)!=0&&l){break}s.SetAttribute("del",((this.Flags&Glb.PAN_CANDELETE)!=0)?"1":"0");break;case RD3Glb.PAN_CANINSERT:if((this.Flags&Glb.PAN_CANINSERT)!=0&&l){break}s.SetAttribute("ins",((this.Flags&Glb.PAN_CANINSERT)!=0)?"1":"0");break;case RD3Glb.PAN_CANSEARCH:if((this.Flags&Glb.PAN_CANSELECT)!=0&&l){break}s.SetAttribute("sea",((this.Flags&Glb.PAN_CANSELECT)!=0)?"1":"0");break;case RD3Glb.PAN_CANSORT:if((this.Flags&Glb.PAN_CANSORT)!=0&&l){break}s.SetAttribute("sor",((this.Flags&Glb.PAN_CANSORT)!=0)?"1":"0");break;case RD3Glb.PAN_LISTLEFT:if(this.ListLeft==0&&l){break}s.SetAttribute("lle",this.ListLeft.toString());break;case RD3Glb.PAN_LISTTOP:if(this.ListTop==0&&l){break}s.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.PAN_LISTWIDTH:s.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.PAN_LISTHEIGHT:var r=this.ListHeight;if(this.MainFrm.IsMobile()&&this.IsShowingGrouping()&&this.Queries[0].RecordCount()==this.NumRows){var g=this.GroupRoot.getLabelNumber();r+=(g*this.MaxHRow)}s.SetAttribute("lhe",r.toString());break;case RD3Glb.PAN_ACTUALROW:if(this.IsShowingGrouping()&&!this.SendPositions&&!this.ForceSendPosition){break}if(this.AttR==0&&l){break}s.SetAttribute("atr",this.AttR.toString());if(this.ForceSendPosition){s.SetAttribute("ftr","1")}break;case RD3Glb.PAN_VRESMODE:if(this.VListResizeMode==Glb.RESMODE_STRETCH&&l){break}s.SetAttribute("vre",this.VListResizeMode.toString());break;case RD3Glb.PAN_HRESMODE:if(this.HListResizeMode==Glb.RESMODE_STRETCH&&l){break}s.SetAttribute("hre",this.HListResizeMode.toString());break;case RD3Glb.PAN_VISUALSTYLE:s.SetAttribute("sty",this.MainFrm.VisualStyleList.GetTrueIdx(this.iVisualStyle).toString());break;case RD3Glb.PAN_FIXEDCOLS:if(this.FixedCols()==0&&l){break}s.SetAttribute("fix",this.FixedCols().toString());break;case RD3Glb.PAN_QBETIP:if(this.QBETip.length==0&&l){break}s.SetAttribute("qtp",this.QBETip);break;case RD3Glb.PAN_ACTUALPOSITION:if(this.IsShowingGrouping()&&!this.SendPositions&&!this.ForceSendPosition){break}var a=this.Queries[0].GetAttRecNumber();if(a==0||this.Status()==Glb.PS_QBE){a=1}if(a==1&&l){break}s.SetAttribute("acp",a.toString());break;case RD3Glb.PAN_TOTALROWS:if(this.Queries[0].RecordCount()==-1&&l){break}s.SetAttribute("tot",this.Queries[0].RecordCount().toString());if(this.Queries[0].IDColl!=null){s.SetAttribute("mor",this.Queries[0].IDColl.HasMoreElements?"1":"0")}break;case RD3Glb.PAN_ENABLEDCOMMANDS:var h=this.EnabledCommands;if(this.IsDO()){var q=this.GetDocument();var e=(q!=null)?q.GetMD():null;if(!this.Queries[0].IsMasterDO){h&=(~Glb.PCM_REQUERY)}if(q==null||(e.Services&(MDOInit.SERV_ATTACH|MDOInit.SERV_COMMENT|MDOInit.SERV_DOMAIN|MDOInit.SERV_USERINFO|MDOInit.SERV_LDELETE|MDOInit.SERV_LOCKING))==0||q.Inserted()){h&=(~Glb.PCM_ATTACH)}}else{h&=(~Glb.PCM_ATTACH)}if(h==-1&&l){break}s.SetAttribute("enc",h.toString());break;case RD3Glb.PAN_HASBOOK:if(this.MyBook==null&&l){break}s.SetAttribute("bok",this.MyBook!=null?"1":"0");break;case RD3Glb.PAN_ADVTAB:var m=this.IsAdvTabOrderEnabled();if(!m&&l){break}s.SetAttribute("ata",m?"1":"0");break;case RD3Glb.PAN_ACTIVATERIGHTCLICK:var m=this.ActivateRightClick;if(!m&&l){break}s.SetAttribute("arc",m?"1":"0");break;case RD3Glb.PAN_INFOMSG:if(!this.ShowInfoMessages&&l){break}s.SetAttribute("inf",this.ShowInfoMessages?"1":"0");break;case RD3Glb.PAN_SINGLEDOC:var d=(this.IsDO()&&this.Queries[0].IsMasterDO&&this.Queries[0].IDColl==null);if(!d&&l){break}s.SetAttribute("sdo",d?"1":"0");break;case RD3Glb.PAN_CONFIRMDEL:if(this.ConfirmDelete&&l){break}s.SetAttribute("cde",this.ConfirmDelete?"1":"0");break;case RD3Glb.PAN_HLDELETE:if(this.HighlightDelete&&l){break}s.SetAttribute("hde",this.HighlightDelete?"1":"0");break;case RD3Glb.PAN_CMDBLOCK:s.SetAttribute("cbk",this.BlockingCommands.toString());break;case RD3Glb.PAN_REORDERCOLUMN:if(!this.ReorderColumn&&l){break}s.SetAttribute("rcl",this.ReorderColumn?"1":"0");break;case RD3Glb.PAN_RESIZECOLUMN:if(!this.ResizeColumn&&l){break}s.SetAttribute("rsc",this.ResizeColumn?"1":"0");break;case RD3Glb.PAN_SENDGROUPS:if(!(this.GroupingEnabled()&&this.ShowGroups())||this.GroupRoot==null){break}this.GroupRoot.RD3RenderDifference(s);break;case RD3Glb.PAN_GROUPING:if(!this.GroupingEnabled()&&l){break}s.SetAttribute("grn",this.GroupingEnabled()?"1":"0");break;case RD3Glb.PAN_SHOWGROUPUI:if(!this.ShowGroups()&&l){break}s.SetAttribute("sgr",this.ShowGroups()?"1":"0");break;case RD3Glb.PAN_TIPONEACHROW:if(!this.TooltipOnEachRow&&l){break}s.SetAttribute("tor",this.TooltipOnEachRow?"1":"0");break;case RD3Glb.PAN_ENABLEINSERTLOCKED:if(!this.EnableInsertWhenLocked()&&l){break}s.SetAttribute("eil",this.EnableInsertWhenLocked()?"1":"0");break;case RD3Glb.PAN_HASDOCTEMPLATE:if(this.Queries[0].DocTempl==null&&l){break}s.SetAttribute("hdt",this.Queries[0].DocTempl!=null?"1":"0");break;case RD3Glb.PAN_VISPROP:if(this.iVisualFlags==0&&l){break}s.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.PAN_LOADPOL:if(this.iLoadingPolicy==1&&l){break}s.SetAttribute("lpl",this.iLoadingPolicy.toString());break;case RD3Glb.PAN_PULLREF:if(this.iPullToRefresh&&l){break}s.SetAttribute("pre",this.iPullToRefresh?"1":"0");break}};IDPanelSrv.prototype.ResetRD3Cache=function(){this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());if(this.Status()==Glb.PS_QBE){this.RD3ListCache=new BitArray(1);this.RD3FormCache=new BitArray(1)}else{this.RD3ListCache=new BitArray(this.Queries[0].RecordCount()+this.NumRows);this.RD3FormCache=new BitArray(this.Queries[0].RecordCount()+this.NumRows)}if(this.Queries[0].IDColl!=null&&this.MainFrm.ParamsObj().UseRD3){this.RD3UpdateCount=new Array(this.Queries[0].RecordCount())}this.RD3Change(RD3Glb.PAN_TOTALROWS)};IDPanelSrv.prototype.ClearRD3Cache=function(d,c){if(d==undefined){this.ResetRD3Cache();return}if(c==undefined){c=this.RD3ListCache.length}for(var a=d-1;a<c;a++){this.RD3ListCache[a]=false;this.RD3FormCache[a]=false}var b=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());b.SetAttribute("from",d.toString());b.SetAttribute("to",c.toString());if(this.RD3UpdateCount!=null){if(c>this.RD3UpdateCount.length){c=this.RD3UpdateCount.length}for(var a=d-1;a<c;a++){this.RD3UpdateCount[a]=0}}};IDPanelSrv.prototype.RD3Scroll=function(b){var a=this.AttR;if(this.PanelCommand(Glb.PCM_NAVIGATION,4,true)){this.ScrollRecTo(b,this.MainFrm)}if(this.AttR==a){this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}if(this.Queries[0].ActualPosition!=b){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION)}else{this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false)}if(!this.HasFocus()){this.SetInput()}};IDPanelSrv.prototype.RD3RowSel=function(c,a){this.RD3EndRequest();this.set_SelectedRow(c);if(this.IsShowingGrouping()&&this.GroupRoot!=null){var d=a-c;if(d<=0){this.AttR=(c+d)-1;d=1}this.set_ActualPosition(d);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}var b=false;if(this.Parent!=null){if(this.Parent.OpenAs!=Glb.OPEN_MDI&&this.Parent.CloseOnSelection){this.MainFrm.DTTObj.SetRequestName("Lookup Selection","Lookup "+this.GetDTTCaption()+" closed",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOOKUP,"Lookup "+this.GetDTTCaption()+" selection","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(c+1)+" nel pannello "+this.GetDTTCaption());b=true}}if(!b){this.MainFrm.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption())}this.AcknowledgeWarnings();this.FireOnSelectingRow();if(this.Parent.OpenAs!=Glb.OPEN_MDI&&this.Parent.CloseOnSelection){this.MainFrm.UnloadForm(this.Parent.FormIdx,true)}};IDPanelSrv.prototype.RD3MultiSel=function(c,b){var a=false;if(this.IsShowingGrouping()){if(this.IsRowSelected(c)!=b){this.RD3ChangeSel=true;a=true;this.SetRowSelected(b,c);this.MainFrm.DTTObj.SetRequestName("Row Multi-Selection","Panel "+this.GetDTTCaption()+" row multi-selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" "+(c)+" record selected","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(b?"Seleziona":"Deseleziona")+" la riga "+(c)+" del pannello "+this.GetDTTCaption()+" usando il check accanto alla riga stessa")}return a}if(this.IsRowSelected(this.Queries[0].GetAttRecNumber()+c)!=b){this.RD3ChangeSel=true;a=true;this.SetRowSelected(b,this.Queries[0].GetAttRecNumber()+c);this.MainFrm.DTTObj.SetRequestName("Row Multi-Selection","Panel "+this.GetDTTCaption()+" row multi-selection",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" "+(c+1)+" row selected","",c);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,(b?"Seleziona":"Deseleziona")+" la riga "+(c+1)+" del pannello "+this.GetDTTCaption()+" usando il check accanto alla riga stessa")}return a};IDPanelSrv.prototype.RD3PanelCommand=function(g){this.RD3EndRequest();if(g.equals("lock")){if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)){this.MainFrm.DTTObj.SetRequestName("Lock Panel","Panel "+this.GetDTTCaption()+": locked",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOCK,"Panel "+this.GetDTTCaption()+" locked","","lock");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Blocca il pannello "+this.GetDTTCaption());this.set_Locked(true);this.RD3FrameChange(RD3Glb.WFR_LOCKED,false)}if((this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)>0){if(!this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}}else{if(g.equals("unlock")){if((this.iStatus==Glb.PS_DATA||this.iStatus==Glb.PS_QBE)){this.MainFrm.DTTObj.SetRequestName("Unlock Panel","Panel "+this.GetDTTCaption()+": unlocked",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANLOCK,"Panel "+this.GetDTTCaption()+" unlocked","","lock");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Sblocca il pannello "+this.GetDTTCaption());this.set_Locked(false);this.RD3FrameChange(RD3Glb.WFR_LOCKED,false)}if((this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)>0){if(this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(!this.Locked()){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}}else{if(g.equals("top")){this.MainFrm.DTTObj.SetRequestName("Go Top","Panel "+this.GetDTTCaption()+": go to top",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","top");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,0,true)}else{if(g.equals("prev")){var f=this.ActualPosition()-this.NumRows+1;this.MainFrm.DTTObj.SetRequestName("Previous Page","Panel "+this.GetDTTCaption()+": previous page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","prev");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,3,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.ActualPosition()==f){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}}}else{if(g.equals("next")){var f=this.ActualPosition()+this.NumRows-1;this.MainFrm.DTTObj.SetRequestName("Next Page","Panel "+this.GetDTTCaption()+": next page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","next");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,2,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.ActualPosition()==f){this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}}}else{if(g.equals("bottom")){this.MainFrm.DTTObj.SetRequestName("Go Bottom","Panel "+this.GetDTTCaption()+": go to bottom",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","bottom");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_NAVIGATION,1,true)}else{if(g.equals("search")){this.MainFrm.DTTObj.SetRequestName("Search Data","Panel "+this.GetDTTCaption()+": search data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","search");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SEARCH nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_SEARCH,0,true)}else{if(g.equals("find")){this.MainFrm.DTTObj.SetRequestName("Find Data","Panel "+this.GetDTTCaption()+": find data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","find");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone FIND nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_FIND,0,true)}else{if(g.equals("list")){var b=this.PanelMode;this.MainFrm.DTTObj.SetRequestName("Change panel mode","Panel "+this.GetDTTCaption()+": mode change from "+(this.PanelMode==Glb.PANEL_LIST?"LIST":"FORM")+" to "+(this.PanelMode==Glb.PANEL_LIST?"FORM":"LIST"),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","list");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone FORM-LIST nella toolbar del pannello "+this.GetDTTCaption()+" (il pannello cambia stato in "+(this.PanelMode==Glb.PANEL_LIST?"FORM":"LIST")+")");this.PanelCommand(Glb.PCM_FORMLIST,0,true);if(this.ToolbarEventDef==RD3Glb.EVENT_ACTIVE){if(this.PanelMode==b){this.RD3Change(RD3Glb.PAN_PANELMODE)}else{if(this.DynamicRows==0){this.RD3Change(RD3Glb.PAN_NUMROWS,false)}}}}else{if(g.equals("cancel")){this.MainFrm.DTTObj.SetRequestName("Cancel Update","Panel "+this.GetDTTCaption()+": undo changes",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cancel");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone UNDO nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_CANCEL,0,true)}else{if(g.equals("refresh")){this.MainFrm.DTTObj.SetRequestName("Refresh Query","Panel "+this.GetDTTCaption()+": refresh query",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","refresh");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone REFRESH nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_REQUERY,0,true)}else{if(g.equals("csv")){this.MainFrm.DTTObj.SetRequestName("Export Data","Panel "+this.GetDTTCaption()+": export",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","csv");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone EXCEL nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_CSV,0,true)}else{if(g.equals("save")){this.MainFrm.DTTObj.SetRequestName("Update Data","Panel "+this.GetDTTCaption()+": update data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","save");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone UPDATE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_UPDATE,0,true)}else{if(g.equals("delete")){this.MainFrm.DTTObj.SetRequestName("Delete Record","Panel "+this.GetDTTCaption()+": delete record",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","delete");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone DELETE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_DELETE,0,true)}else{if(g.equals("insert")){this.MainFrm.DTTObj.SetRequestName("Insert Row","Panel "+this.GetDTTCaption()+": go to new row",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","insert");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEW nella toolbar del pannello "+this.GetDTTCaption());var d=this.PanelCommand(Glb.PCM_INSERT,0,true);if(this.Locked()&&this.EnableInsertWhenLocked()&&!d){this.RD3FrameChange(RD3Glb.WFR_LOCKED)}}else{if(g.equals("dupl")){this.MainFrm.DTTObj.SetRequestName("Duplicate Row","Panel "+this.GetDTTCaption()+": duplicate record",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","dupl");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone DUPLICATE nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_DUPLICATE,0,true)}else{if(g.equals("print")){this.MainFrm.DTTObj.SetRequestName("Print Data","Panel "+this.GetDTTCaption()+": print",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","print");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_PRINT,0,true)}else{if(g.equals("group")){this.MainFrm.DTTObj.SetRequestName("Grouping","Panel "+this.GetDTTCaption()+": Handle Grouping",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone RAGGRUPPA nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_GROUP,0,true)}else{if(g.equals("attach")){this.MainFrm.DTTObj.SetRequestName("Open Attachment Form","Panel "+this.GetDTTCaption()+": Open Attachment",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","att");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone GRAFFETTA nella toolbar del pannello "+this.GetDTTCaption());this.PanelCommand(Glb.PCM_ATTACH,0,true)}else{if(g.startsWith("delblob")){var e=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var c=parseInt(g.substr(7),10);this.MainFrm.DTTObj.SetRequestName("Delete Blob","Panel "+this.GetDTTCaption()+": delete Blob",DTTRequest.PRI_CMD);this.Fields[c].DeleteBlob(this.MainFrm);this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("C2AC5078-2E12-4B35-AFCA-611D9EA24BB7","Il documento è stato cancellato."))}else{if(g.startsWith("upload")){var e=(this.MainFrm.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT?"class=abm":"align=absmiddle");var c=parseInt(g.substr(6),10);this.MainFrm.DTTObj.SetRequestName("Upload Blob","Panel "+this.GetDTTCaption()+": upload Blob",DTTRequest.PRI_CMD);this.Fields[c].EnterUploadMode(true);this.SetInfoMessage(this.MainFrm.RTCObj.GetConst("D47E7A4C-A11A-4170-B5FC-F9A8AACD4B9A","Indica nel campo il file da caricare sul server, poi premi ancora <img "+e+' src="images/upload.gif" alt=""> per confermare. Se lasci il campo vuoto, nessun file verrà caricato.'))}else{if(g=="seltog"){if(this.ShowMultipleSel()){this.set_ShowMultipleSel(false,true);this.SetRDRowSel(-1,true);this.MainFrm.DTTObj.SetRequestName("Show row selectors","Panel "+this.GetDTTCaption()+" show row selector",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" show row selectors","","chks");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Mostra i row selector del pannello "+this.GetDTTCaption()+" usando l'apposito comando")}else{this.set_ShowMultipleSel(true,true);this.MainFrm.DTTObj.SetRequestName("Hide row selectors","Panel "+this.GetDTTCaption()+" hide row selector",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" hide row selectors","","chks");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Mostra i checkbox delle righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando")}this.SendPositions=true}else{if(g=="selnone"){this.ChangeSelection(0);this.MainFrm.DTTObj.SetRequestName("No rows selected","Panel "+this.GetDTTCaption()+" MultiSelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" deselect all rows","","chkn");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"De-seleziona tutte le righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando");this.SendPositions=true}else{if(g=="selall"){this.ChangeSelection(2);this.MainFrm.DTTObj.SetRequestName("All rows selected","Panel "+this.GetDTTCaption()+" MultiSelRow",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANMSELTLB,"Panel "+this.GetDTTCaption()+" select all rows","","chka");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona tutte le righe del pannello "+this.GetDTTCaption()+" usando l'apposito comando");this.SendPositions=true}else{if(g.startsWith("cb")){var h=parseInt(g.substr(2),10);var a=Glb.PCM_CUSTOM1<<h;if(this.IsCommandEnabled(a)&&WebFrameSrv.CustomCommands[h]!=null){this.MainFrm.DTTObj.SetRequestName("Command "+WebFrameSrv.CustomCommands[h].Caption,"Panel "+this.GetDTTCaption()+": custom command "+WebFrameSrv.CustomCommands[h].Caption,DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANTOOLBAR,"Panel "+this.GetDTTCaption()+" toolbar action","","cc"+(h+1));this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone "+WebFrameSrv.CustomCommands[h].Caption+" nella toolbar del pannello "+this.GetDTTCaption()+" ("+WebFrameSrv.CustomCommands[h].ToolTip+")");this.PanelCommand(a,0,true);this.SendPositions=false}}}}}}}}}}}}}}}}}}}}}}}}}}};IDPanelSrv.prototype.RD3Sort=function(c,d){this.RD3EndRequest();if(this.Fields[c].IdxPanel<0){this.MainFrm.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[c].GetDTTCaption()+" activated",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[c].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[c].GetDTTCaption()+" activation","","0act");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[c].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga 1 nel panello "+this.GetDTTCaption()));this.Fields[c].Activate(0);return}var b=false;if(this.MainFrm.ParamsObj().PanelsSortAlways){if(this.MainFrm.ParamsObj().Theme.equals("classic")){b=d>7}else{b=d<15}}else{b=this.Fields[c].SortMode<=0}var a=new IDVariant(false);this.FireOnSorting(c,a);if(a.isFalse()){if(!(this.GroupingEnabled()&&this.ShowGroups())){if(!this.MainFrm.ShiftKey()||this.MainFrm.CtrlKey()){this.ResetSortList()}if(this.MainFrm.CtrlKey()){this.MainFrm.DTTObj.SetRequestName("Reset Sort","Panel "+this.GetDTTCaption()+": reset sort",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[c].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" reset sort detected","","sort");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[c].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+" tenendo premuto il tasto CTRL")}else{this.AddToSortList(c,b);this.MainFrm.DTTObj.SetRequestName("Sort Data","Panel "+this.GetDTTCaption()+": sort data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[c].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" sort detected","","sort");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[c].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+(this.MainFrm.ShiftKey()?" tenendo premuto il tasto SHIFT":""))}this.EnableSorting()}else{if(!this.MainFrm.ShiftKey()||this.MainFrm.CtrlKey()){this.ResetGroupList()}if(this.MainFrm.CtrlKey()){this.MainFrm.DTTObj.SetRequestName("Reset Grouping","Panel "+this.GetDTTCaption()+": reset grouping",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[c].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" reset grouping detected","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[c].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+" tenendo premuto il tasto CTRL");this.SendPositions=true}else{this.AddToGroupingList(c,b);this.MainFrm.DTTObj.SetRequestName("Group Data","Panel "+this.GetDTTCaption()+": group data",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[c].iGuid,DTTEngine.TST_PANSORT,"Panel "+this.GetDTTCaption()+" grouping detected","","grouping");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone SORT sul campo  "+this.Fields[c].GetDTTCaption()+" nel pannello "+this.GetDTTCaption()+(this.MainFrm.ShiftKey()?" tenendo premuto il tasto SHIFT":""))}this.RefreshGrouping(true)}}};IDPanelSrv.prototype.RD3SelectPage=function(a){this.RD3EndRequest();var b=this.Page();for(var c=0;c<this.Pages.length;c++){if(this.Pages[c].GetRD3Ident().equals(a)){this.MainFrm.DTTObj.SetRequestName("Change Page","Panel "+this.GetDTTCaption()+": go to page "+this.Pages[c].Header,DTTRequest.PRI_CMD);this.set_Page(c);this.MainFrm.DTTObj.AddTestItem(this.Pages[c].iGuid,DTTEngine.TST_PANCHGPG,"Panel "+this.GetDTTCaption()+" change page","");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone CHANGE-PAGE nella toolbar del pannello "+this.GetDTTCaption());if(this.PageClickEventDef==RD3Glb.EVENT_ACTIVE){if(this.Page()==b){this.RD3Change(RD3Glb.PAN_PANELPAGE)}}break}}};IDPanelSrv.prototype.RD3ValChange=function(a,f){var j=a.indexOf(":");var h=a.indexOf(":",j+1);var g=a.indexOf(":",h+1);var e=parseInt(a.substr(j+1,h-j-1),10);var b=parseInt(a.substr(h+1,g-h-1),10);if(this.Status()==Glb.PS_QBE){e=0}else{e-=this.Queries[0].GetAttRecNumber()}var c=this.Fields[b].ProcessRowChange(this.MainFrm,f,e);if(c){this.RD3Validate=true;this.SetModified(this.MainFrm);this.RD3SendChange=true}if(this.Fields[b].Values[e].Text.equals(f)&&((this.Fields[b].Flags&Glb.FLD_SUPERACTIVE)!=0)){this.Fields[b].Values[e].RD3Change(RD3Glb.VAL_TEXT,false);this.Fields[b].Values[e].RD3ResetChange()}if(this.Fields[b].IdxPanel>0){for(var d=1;d<this.Queries.length;d++){if(this.Queries[d].UpdateLKE(this.MainFrm)){this.RD3Validate=true;this.SetModified(this.MainFrm)}}}return c};IDPanelSrv.prototype.RD3ValClick=function(f){this.RD3EndRequest();var e=f.indexOf(":");var d=f.indexOf(":",e+1);var c=f.indexOf(":",d+1);var a=parseInt(f.substr(e+1,d-e-1),10);var b=parseInt(f.substr(d+1,c-d-1),10);if(this.Status()==Glb.PS_QBE){a=0}else{a-=this.Queries[0].GetAttRecNumber()}this.MainFrm.DTTObj.SetRequestName("Activate Field","Panel "+this.GetDTTCaption()+": field "+this.Fields[b].GetDTTCaption()+" activated for row"+(a+1),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.Fields[b].iGuid,DTTEngine.TST_FLDACT,"Panel field "+this.Fields[b].GetDTTCaption()+" activation","",a+"act");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Attiva il campo "+this.Fields[b].GetDTTCaption()+(this.Layout()==Glb.PANEL_FORM?"":" della riga "+(a+1))+" nel panello "+this.GetDTTCaption());this.Fields[b].Activate(a)};IDPanelSrv.prototype.RD3StartRequest=function(){this.RD3Validate=false;this.RD3ChangeSel=false;this.NeedAutoSave=false;this.InfoPriority=0;this.SendPositions=false;this.ForceSendPosition=false};IDPanelSrv.prototype.RD3EndRequest=function(){if(this.RD3Validate&&this.IMDB!=null){var d=this.ReValidate();if(d){this.ReValidate()}if(d){this.IMDB.TblSetModified(this.MstTblIndex,Glb.GlbRefModIdx)}else{this.IMDB.TblResetModified(this.MstTblIndex,Glb.GlbRefModIdx)}if(this.RD3PropChg[RD3Glb.PAN_ACTUALROW]||this.RD3SendChange){this.Queries[0].UpdateIMDB(this.AttR,true,true,true)}this.RD3SendChange=false}if(this.RD3ChangeSel){var b=new IDVariant(0);this.FireOnChangeSelection(-1,false,true,true,b)}if(this.WasHidden){var c=false;if((this.Flags&Glb.PAN_FREEWHENHID)!=0){if(!this.Visible||this.Collapsed||!this.Exposed()){c=true}}if(!c){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"IDPanel.UpdatePanel","Panel "+this.GetDTTCaption()+": update performed for the first time (the panel was either invisible, collapsed or not exposed)");this.UpdatePanel(this.MainFrm);this.WasHidden=false}}if(this.NeedAutoSave){this.AutoSaveSamFl=true;if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,165,"IDPanel.SetStatus","Panel "+this.GetDTTCaption()+": Auto Saving")}this.UpdateRecords(this.MainFrm,true);this.AutoSaveSamFl=false;this.NeedAutoSave=false}for(var a=0;a<this.Fields.length;a++){this.Fields[a].ClearLastValue()}this.RD3Validate=false;this.RD3ChangeSel=false};IDPanelSrv.prototype.RD3ChangeRow=function(b,a){this.RD3EndRequest();if(this.AttR!=b){this.Parent.ResetUpload()}this.AttR=b;if(this.IsShowingGrouping()&&this.GroupRoot!=null){var c=a-b;if(c<=0){this.AttR=(b+c)-1;c=1}this.set_ActualPosition(c);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.RD3Change(RD3Glb.PAN_ACTUALROW,false)}this.MainFrm.DTTObj.SetRequestName("Row Selection","Panel"+this.GetDTTCaption()+" SelRow due to Cursor change",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_PANROWSEL,"Panel "+this.GetDTTCaption()+" row selected","",this.AttR);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la riga "+(this.AttR+1)+" del pannello "+this.GetDTTCaption());this.Queries[0].UpdateIMDB(this.AttR,true,true,true)};IDPanelSrv.prototype.ShowTool=function(){return this.ShowToolbar};IDPanelSrv.prototype.set_ShowTool=function(a){this.ShowToolbar=a;this.RD3Change(RD3Glb.PAN_SHOWTOOLBAR)};IDPanelSrv.prototype.ShowStatus=function(){return this.ShowStatusbar};IDPanelSrv.prototype.set_ShowStatus=function(a){this.ShowStatusbar=a;this.RD3Change(RD3Glb.PAN_SHOWSTATUSBAR)};IDPanelSrv.prototype.QbeTip=function(){return this.QBETip};IDPanelSrv.prototype.set_QbeTip=function(a){this.QBETip=a;this.QBETipText=a;this.RD3Change(RD3Glb.PAN_QBETIP)};IDPanelSrv.prototype.ActivateRightClk=function(){return this.ActivateRightClick};IDPanelSrv.prototype.set_ActivateRightClk=function(a){this.ActivateRightClick=a;this.RD3Change(RD3Glb.PAN_ACTIVATERIGHTCLICK)};IDPanelSrv.prototype.SetCommandBlocking=function(b,a){if(a){this.BlockingCommands|=b}else{this.BlockingCommands&=~b}this.RD3Change(RD3Glb.PAN_CMDBLOCK)};IDPanelSrv.prototype.CanReorderColumn=function(){return this.ReorderColumn};IDPanelSrv.prototype.set_CanReorderColumn=function(a){this.ReorderColumn=a;this.RD3Change(RD3Glb.PAN_REORDERCOLUMN)};IDPanelSrv.prototype.CanResizeColumn=function(){return this.ResizeColumn};IDPanelSrv.prototype.set_CanResizeColumn=function(a){this.ResizeColumn=a;this.RD3Change(RD3Glb.PAN_RESIZECOLUMN)};IDPanelSrv.prototype.RD3Resize=function(a,e,d){if(d=="top"){this.ListTop=a;this.CalcLayout()}else{if(d=="height"){var b=this.AttR;this.ListHeight=a;var j=this.NumRows;this.CalcLayout();if(j!=this.NumRows){var g=null;if(this.AttR==b){for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].bValues(this.AttR).Uploading){g=this.Fields[c]}}}this.ScrollRecBy(0,this.MainFrm);if(g!=null){g.bValues(this.AttR).Uploading=true}}}else{if(d=="dynrows"){this.UpdateDynRows(a)}else{WebFrameSrv.prototype.RD3Resize.call(this,a,e,d)}}}};IDPanelSrv.prototype.RD3ClearLookups=function(){for(var b=0;b<this.NumRows;b++){for(var a=0;a<this.Fields.length;a++){if(this.Fields[a].IdxPanel>0&&this.Fields[a].Values[b].Text.length>0){this.Fields[a].Values[b].RD3Change(RD3Glb.VAL_TEXT)}}}};IDPanelSrv.prototype.OnValueChange=function(e,c,d){if(this.RD3ListCache!=null&&e>=0&&e<this.RD3ListCache.length){var a=this.Queries[0].GetAttRecNumber()-1;if(e>=a&&e<a+this.NumRows){for(var b=0;b<this.Fields.length;b++){if(this.Fields[b].RSIdx-1==c){if(!this.Fields[b].Values[e-a].Value.equals(d)){this.Fields[b].Values[e-a].SetValue(d)}this.Fields[b].Values[e-a].RD3Change(RD3Glb.VAL_TEXT);break}}}else{this.RD3ListCache[e]=false;this.RD3FormCache[e]=false}}};IDPanelSrv.prototype.GetAbsoluteRowPosition=function(){if(this.Queries[0].LookupRows!=null){return this.Queries[0].LookupRows[this.ActualPosition()-1]-1}else{return this.ActualPosition()-1}};IDPanelSrv.prototype.RD3SendMultiselection=function(){var e=0;var b=0;for(var a=0;a<this.SelectedRows.length;a++){if(this.SelectedRows[a]){e++}else{b++}}var g=(e>=b)?false:true;var c=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());c.CanSendInFulltree=true;c.SetAttribute("row","-1");c.SetAttribute("value",g?"0":"2");for(var a=0;a<this.SelectedRows.length;a++){if(this.SelectedRows[a]==g){var d=this.MainFrm.RD3AddEvent("mulsel",this.GetRD3Ident());d.CanSendInFulltree=true;var f=a+1;d.SetAttribute("row",f.toString());d.SetAttribute("value",this.SelectedRows[a]?"1":"0")}}this.RD3Sendmulti=false};IDPanelSrv.prototype.RD3RawClick=function(b,j,h,m,f,l,e){var g=parseInt(e.GetAttribute("par4"),10);var a=parseInt(e.GetAttribute("par5"),10);var k=new IDVariant();if(this.MainFrm!=null){var d=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(d,"Panel"+this.GetDTTCaption()+" "+d,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"IDPanel."+d,"Panel "+this.GetDTTCaption()+": firing event "+d)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(b),new IDVariant(j),new IDVariant(h),new IDVariant(m),new IDVariant(f),new IDVariant(g),new IDVariant(a),k)}else{this.Parent.OnMouseClick(this,new IDVariant(b),new IDVariant(j),new IDVariant(h),new IDVariant(m),new IDVariant(f),new IDVariant(g),new IDVariant(a),k)}return k.isTrue()};IDPanelSrv.prototype.RD3ReorderColumn=function(g,h){if(!this.IsAdvTabOrderEnabled()){var b=0;var d=true;for(var c=0;c<this.Fields.length;c++){if(d||(this.Fields[c].Flags&Glb.FLD_INLIST)!=0||(this.Fields[c].Flags&Glb.FLD_INFORM)!=0){this.SetTabOrder(this.Fields[c].Index,b,Glb.PANEL_FORM);this.SetTabOrder(this.Fields[c].Index,b,Glb.PANEL_LIST);b++}d=false}}var a=null;var f=null;for(var c=0;c<this.Fields.length;c++){if(this.Fields[c].GetRD3Ident().equals(g)){a=this.Fields[c]}if(this.Fields[c].GetRD3Ident().equals(h)){f=this.Fields[c]}}if(a!=null&&f!=null){var j=this.GetFieldIdxTabOrder(a.Index,Glb.PANEL_LIST)+1;this.MoveField(a.Index,f.Index,Glb.PANEL_LIST);var e=this.GetFieldIdxTabOrder(a.Index,Glb.PANEL_LIST)+1;if(this.FixedCols()!=0){if(j<=this.iFixedCols){if(e>this.iFixedCols){this.iFixedCols=this.iFixedCols>1?this.iFixedCols-1:this.iFixedCols}}else{if(e<=this.iFixedCols){this.iFixedCols=this.iFixedCols>=this.Fields.length-1?this.iFixedCols:this.iFixedCols+1}}}if(this.MainFrm!=null){this.MainFrm.DTTObj.SetRequestName("Column Reorder","Column Reorder",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,120,"IDPanel.OnReorderColum","Panel "+this.GetDTTCaption()+": Fire OnReorderColum Event")}this.Parent.OnReorderColum(this,new IDVariant(a.Index),new IDVariant(f.Index))}};IDPanelSrv.prototype.RD3ResizeColumn=function(b,a){var c=this.Fields[b].ListWidth;this.set_ObjRect(Glb.OBJ_FIELD,b,IDPanelSrv.RT_WIDTH,Glb.PANEL_LIST,a);this.Fields[b].UserChangedField=true;if(c!=this.Fields[b].ListWidth){if(this.MainFrm!=null){this.MainFrm.DTTObj.SetRequestName("Column Resize","Column Resize",DTTRequest.PRI_DATA);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,121,"IDPanel.OnResizeColumn","Panel "+this.GetDTTCaption()+": Fire OnResizeColumn Event")}this.Parent.OnResizeColum(this,new IDVariant(b),new IDVariant(c))}};IDPanelSrv.prototype.PanelConfiguration=function(){var f=new XMLDoc();var a=f.AddNewElement("panel");a.SetAttribute("code",this.Code);a.SetAttribute("fcols",this.iFixedCols.toString());var d=0;var g=true;for(var c=0;c<this.Fields.Length;c++){if(g||(this.Fields[c].Flags&Glb.FLD_INLIST)!=0||(this.Fields[c].Flags&Glb.FLD_INFORM)!=0){var e=this.Fields[c];var b=a.AddNewElement("field");b.SetAttribute("code",e.Code);b.SetAttribute("lw",e.ListWidth.toString());if(this.IsAdvTabOrderEnabled()){b.SetAttribute("ftab",this.GetFieldIdxTabOrder(e.Index,Glb.PANEL_FORM).toString());b.SetAttribute("ltab",this.GetFieldIdxTabOrder(e.Index,Glb.PANEL_LIST).toString())}else{b.SetAttribute("ftab",d.toString());b.SetAttribute("ltab",d.toString());d++}}g=false}return f.SaveToString()};function XMLFld(){this.Fld;this.FldIdx;this.ListWidth;this.FormTabOrd;this.ListTabOrd;this.Handled=false}IDPanelSrv.prototype.set_PanelConfiguration=function(g){try{if(g==null||g.length==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,170,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Parameter null or empty");return false}var C=new XMLDoc();C.LoadFromString(g);if(!C.HasNextNode()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,200,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Empty XML document");return false}var u=C.GetNextNode();if(u!=null&&String.compare(u.Name(),"xml",true)==0){u=(C.HasNextNode()?C.GetNextNode():null)}if(u==null||String.compare(u.Name(),"panel",true)!=0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,200,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Missing Root node");return false}var p=u.GetAttribute("code");if(p==null||String.compare(p,this.Code,true)!=0){if(p==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,180,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Missing CODE node")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,180,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: The given configuration is not for this panel (my code is "+this.Code+", the xml panel's code is "+p+")")}return false}var h=new ArrayList();while(u.HasNextNode()){var s=u.GetNextNode();if(String.compare(s.Name(),"field")!=0){continue}var l=s.GetAttribute("code");var r=this.FindField(l);if(r!=-1){try{var y=new XMLFld();h.Add(y);y.Fld=this.Fields[r];y.FldIdx=r;y.ListWidth=parseInt(s.GetAttribute("lw"),10);y.FormTabOrd=parseInt(s.GetAttribute("ftab"),10);y.ListTabOrd=parseInt(s.GetAttribute("ltab"),10)}catch(z){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,189,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: some of the Field "+l+" attributes are not integer");return false}}else{if(l!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,189,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: the Field "+l+" does not exist anymore. Skipping field configuration...")}}}if(h.Count()!=this.Fields.length){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,196,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: the panel has a different number of fields with respect to the given configuration (FieldCount = "+this.Fields.length+", XML FieldCount = "+h.Count()+")")}if(h.Count()>0){if(!this.IsAdvTabOrderEnabled()){this.FormTabOrder=new Array(this.UFields()+1);for(var x=0;x<this.UFields()+1;x++){this.FormTabOrder[x]=0}this.ListTabOrder=new Array(this.UFields()+1);for(var x=0;x<this.UFields()+1;x++){this.ListTabOrder[x]=0}var c=0;var d=true;for(var x=0;x<this.Fields.length;x++){if(d||(this.Fields[x].Flags&Glb.FLD_INLIST)!=0||(this.Fields[x].Flags&Glb.FLD_INFORM)!=0){this.FormTabOrder[c]=x;this.ListTabOrder[c]=x;c++}d=false}}var b=null;while(true){var m=null;for(var x=0;x<h.Count();x++){var t=h[x];if(!t.Handled&&(m==null||t.ListTabOrd<m.ListTabOrd)){m=t}}if(m==null){break}m.Handled=true;if(b!=null){var B=this.GetFieldIdxTabOrder(m.FldIdx,Glb.PANEL_LIST);var A=this.GetFieldIdxTabOrder(b.FldIdx,Glb.PANEL_LIST);var q=this.GetFieldIdxTabOrder(m.FldIdx,Glb.PANEL_FORM);var a=this.GetFieldIdxTabOrder(b.FldIdx,Glb.PANEL_FORM);for(var x=0;x<this.Fields.length-1;x++){if(x>=B){this.ListTabOrder[x]=this.ListTabOrder[x+1]}if(x>=q){this.FormTabOrder[x]=this.FormTabOrder[x+1]}}this.ListTabOrder[this.Fields.length-1]=0;this.FormTabOrder[this.Fields.length-1]=0;if(A>B){A--}if(a>q){a--}for(var x=this.Fields.length-1;x>=0;x--){if(x>=A){this.ListTabOrder[x+1]=this.ListTabOrder[x]}if(x>=a){this.FormTabOrder[x+1]=this.FormTabOrder[x]}}this.ListTabOrder[A+1]=m.FldIdx;this.FormTabOrder[a+1]=m.FldIdx}this.set_ObjRect(Glb.OBJ_FIELD,m.Fld.Index,IDPanelSrv.RT_WIDTH,Glb.PANEL_LIST,m.ListWidth);b=m}var w=true;for(var x=0;x<this.Fields.length;x++){if(!(w||(this.Fields[x].Flags&Glb.FLD_INLIST)!=0||(this.Fields[x].Flags&Glb.FLD_INFORM)!=0)){var o=false;for(var v=0;v<this.ListTabOrder.length;v++){if(this.ListTabOrder[v]==x){o=true}if(o&&v<this.ListTabOrder.length-1){this.ListTabOrder[v]=this.ListTabOrder[v+1]}}o=false;for(var v=0;v<this.FormTabOrder.length;v++){if(this.FormTabOrder[v]==x){o=true}if(o&&v<this.FormTabOrder.length-1){this.FormTabOrder[v]=this.FormTabOrder[v+1]}}}w=false}}try{var k=parseInt(u.GetAttribute("fcols"),10);this.iFixedCols=k}catch(z){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,198,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Invalid format while reading FixedColumns peroperty from configuration");return false}return true}catch(z){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,210,"name","Panel "+this.GetDTTCaption()+": SetPanelConfiguration: Generic error. Message = "+z.message);return false}};IDPanelSrv.prototype.SaveRTCPanelConfiguration=function(){if(this.MainFrm==null){return}if(!this.MainFrm.RTCObj.Enabled){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,211,"name","Panel "+this.GetDTTCaption()+": SaveRTCPanelConfiguration - RTC not enabled");return}var b;var k;var d=new IDPreparedStatement();var l=new IDPreparedStatement();b="insert into RTCU_PanelFields (";b=b+" RTC_Guid";b=b+",RTC_Parent";b=b+",RTC_Language";b=b+",RTC_Group";b=b+",RTC_User";b=b+",RTC_Dim1";b=b+",RTC_TabOrder1";b=b+",RTC_TabOrder2";b=b+") values (?, ?, ?, ?, ?, ?, ?, ?)";k="update RTCU_PanelFields set ";k=k+" RTC_Dim1 = ?";k=k+",RTC_TabOrder1 = ?";k=k+",RTC_TabOrder2 = ?";k=k+" where RTC_Guid = ? AND RTC_Language  = ? AND RTC_Group  = ? AND RTC_User  = ?";d.SetCommand(b);l.SetCommand(k);this.MainFrm.OpenConnection(this.MainFrm.RTCObj.DB);var a=false;try{this.MainFrm.RTCObj.DB.BeginTrans();for(var c=0;c<this.Fields.length;c++){var g=this.Fields[c];if(g.UserChangedField&&((g.Flags&Glb.FLD_INLIST)!=0)&&((g.Flags&Glb.FLD_LISTLIST)!=0)){l.ClearParameters();l.AddParameter(new IDVariant(g.ListWidth));l.AddParameter(new IDVariant(this.GetFieldIdxTabOrder(g.Index,Glb.PANEL_FORM)));l.AddParameter(new IDVariant(this.GetFieldIdxTabOrder(g.Index,Glb.PANEL_LIST)));l.AddParameter(new IDVariant(g.iGuid));l.AddParameter(new IDVariant(this.MainFrm.RolObj.glbLanguage));l.AddParameter(new IDVariant(this.MainFrm.RolObj.glbGroup));l.AddParameter(new IDVariant(this.MainFrm.RolObj.glbUserID));this.MainFrm.RTCObj.DB.ExecuteIDPS(l,false);if(this.MainFrm.RTCObj.DB.RecordsAffected()==0){var j="";if(g.Group!=-1){j=this.Groups[g.Group].iGuid}else{if(g.Page!=-1){j=this.Pages[g.Page].iGuid}else{j=this.iGuid}}d.ClearParameters();d.AddParameter(new IDVariant(g.iGuid));d.AddParameter(new IDVariant(j));d.AddParameter(new IDVariant(this.MainFrm.RolObj.glbLanguage));d.AddParameter(new IDVariant(this.MainFrm.RolObj.glbGroup));d.AddParameter(new IDVariant(this.MainFrm.RolObj.glbUserID));d.AddParameter(new IDVariant(g.ListWidth));d.AddParameter(new IDVariant(this.GetFieldIdxTabOrder(g.Index,Glb.PANEL_FORM)));d.AddParameter(new IDVariant(this.GetFieldIdxTabOrder(g.Index,Glb.PANEL_LIST)));this.MainFrm.RTCObj.DB.ExecuteIDPS(d,false)}g.UserChangedField=false}}this.MainFrm.RTCObj.DB.CommitTrans();a=true;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,212,"name","Panel "+this.GetDTTCaption()+": SaveRTCPanelConfiguration - RTC configuration saved")}catch(h){this.MainFrm.RTCObj.DB.RollbackTrans();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,213,"name","Panel "+this.GetDTTCaption()+": SaveRTCPanelConfiguration - error while saving RTC configuration (err="+h.message+")")}finally{d.Close();l.Close()}if(a){this.MainFrm.RTCObj.ReloadFields(this.Parent)}};IDPanelSrv.prototype.GenericDrag=function(a,l){var g=parseInt(a.GetAttribute("par1"),10);var p=a.GetAttribute("obn");var h=this.MainFrm.RD3FindField(p);if(this.EnableMultipleSel()&&this.ShowMultipleSel()){if(this.IsDO()){var k=this.Queries[0].IDColl;if(k!=null){for(var e=0;e<k.GetCollection().Count();e++){var j=k.GetCollection()[e];if(j.Selected()){this.GenericDropHelper(a,h,l,g,j)}}}}else{var m=this.AttR;var o=this.Queries[0].GetAttRecNumber();for(var b=0;b<this.SelectedRows.length;b++){if(this.SelectedRows[b]){this.ScrollRecTo(b+1,this.MainFrm);this.AttR=0;this.Queries[0].UpdateIMDB(this.AttR,true,false,true);this.GenericDropHelper(a,h,l,g,null)}}this.AttR=m;this.ScrollRecTo(o,this.MainFrm);this.Queries[0].UpdateIMDB(this.AttR,true,false,true)}}else{this.GenericDropHelper(a,h,l,g,null)}};IDPanelSrv.prototype.GenericDropHelper=function(c,h,k,g,j){if(j==null){j=this.GetDocument()}this.MainFrm.ActivedDocument=j;if(this.MainFrm.ActivedDocument!=null){var b=this.MainFrm.ActivedDocument.GetMD();this.MainFrm.ActivedProperty=b.GetProp(h.GetDOIdx(this.MainFrm.ActivedDocument))}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"IDPanel.OnGenericDrag","Panel "+this.GetDTTCaption()+": firing event OnGenericDrag");var l=new IDVariant();this.Parent.OnGenericDrag(this,l,new IDVariant(g),new IDVariant(h.Index));if(k instanceof WebFrameSrv){var a=k;var d=c.GetAttribute("oid");if(d.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var e=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;e.GenericDrop(c,l)}else{a.GenericDrop(c,l)}}if(k instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(k,l)}};IDPanelSrv.prototype.GenericDrop=function(c,m){var k=parseInt(c.GetAttribute("par4"),10);var j=parseInt(c.GetAttribute("par5"),10);var e=parseInt(c.GetAttribute("par1"),10);var r=parseInt(c.GetAttribute("par2"),10);var h=parseInt(c.GetAttribute("par3"),10);var d=c.GetAttribute("oid");var g=this.MainFrm.RD3FindField(d);var a=d.indexOf(":lv");var q=(a==-1)?-1:parseInt(d.substr(a+3),10);var b=(g==null)?-1:g.Index;this.MainFrm.DTTObj.SetRequestName("Generic Drop","Panel"+this.GetDTTCaption()+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"IDPanel.OnGenericDrop","Panel "+this.GetDTTCaption()+": firing event OnGenericDrop");var o=new IDVariant();var l=this.GetDocument(q);this.Parent.OnGenericDrop(this,m,o,new IDVariant(e),new IDVariant(k),new IDVariant(j),new IDVariant(r),new IDVariant(h),new IDVariant(b),new IDVariant(q),l)};IDPanelSrv.prototype.ResetGroupList=function(){for(var b=0;b<this.GroupingList.Count();b++){var c=this.GroupingList[b];var a=c;if(c.SortFld!=-1){a=this.Fields[c.SortFld]}a.SortMode=0;a.GroupDirection=0;a.RD3Change(RD3Glb.FLD_SORTMODE);c.RD3Change(RD3Glb.FLD_SORTMODE);c.SortMode=0;c.GroupDirection=0}this.GroupingList.Clear()};IDPanelSrv.prototype.AddToGroupingList=function(d,c,e){if(e==undefined){e=-1}var b=this.Fields[d];var a=b;if(b.SortFld!=-1){a=this.Fields[b.SortFld]}if(a.IdxPanel!=0){return}if(this.GroupingList.IndexOf(b)==-1){this.GroupingList.Add(b)}a.GroupDirection=(c)?1:-1;b.GroupVS=e;b.GroupDirection=(c)?1:-1};IDPanelSrv.prototype.GroupingEnabled=function(){return this.iEnabledGrouping};IDPanelSrv.prototype.set_GroupingEnabled=function(a){this.iEnabledGrouping=a;this.RD3Change(RD3Glb.PAN_GROUPING);if(a==false){this.GroupRoot=null;this.ResetGroupList();this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident());this.ResetRD3Cache();if(this.SortingList.Count()>0){this.EnableSorting()}}};IDPanelSrv.prototype.ShowGroups=function(){return this.iShowGroups};IDPanelSrv.prototype.set_ShowGroups=function(b){this.iShowGroups=b;this.RD3Change(RD3Glb.PAN_SHOWGROUPUI);if(!this.GroupingEnabled()){return}if(b){for(var a=0;a<this.SortingList.Count();a++){var d=this.SortingList[a];this.AddToGroupingList(d.Index,d.SortMode>0)}this.SortingList.Clear()}else{for(var a=0;a<this.GroupingList.Count();a++){var c=this.GroupingList[a];this.AddToSortList(c.Index,c.SortMode>0)}this.GroupingList.Clear()}};IDPanelSrv.prototype.RefreshGrouping=function(d){if(!this.GroupingEnabled()||!this.ShowGroups()){return}if(this.iStatus!=Glb.PS_DATA){return}for(var b=0;b<this.GroupingList.Count();b++){var c=this.GroupingList[b];var a=c;if(c.SortFld!=-1){a=this.Fields[c.SortFld]}a.SortMode=a.GroupDirection;a.RD3Change(RD3Glb.FLD_SORTMODE);c.RD3Change(RD3Glb.FLD_SORTMODE);c.SortMode=c.GroupDirection}if(d){this.EnableSorting()}this.CreateGroups();this.ResetRD3Cache();this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident())};IDPanelSrv.prototype.AddGroupInterval=function(b,e,a,d){var f=this.Fields[b];var c=f;if(f.SortFld!=-1){c=this.Fields[f.SortFld]}if(c.IdxPanel!=0){return}if(this.GroupingList.IndexOf(f)==-1){return}f.AddGroupInterval(e,a,d)};IDPanelSrv.prototype.ResetGroupIntervals=function(a){var b=this.Fields[a];if(this.GroupingList.IndexOf(b)==-1){return}b.ResetGroupIntervals()};IDPanelSrv.prototype.IsShowingGrouping=function(){return(this.GroupingEnabled()&&this.GroupRoot!=null&&this.ShowGroups()&&this.Status()!=Glb.PS_QBE&&this.PanelMode==Glb.PANEL_LIST&&this.GroupingList.Count()>0)};IDPanelSrv.prototype.SetGroupAggregation=function(a,c,b){if(b==undefined){b=new IDVariant()}var d=this.Fields[a];d.GroupAggregation=c;d.GroupAggrLabel=b};IDPanelSrv.prototype.FireOnExpandingGroup=function(a,b){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,57,"IDPanel.FireOnExpandingGroup","Panel "+this.GetDTTCaption()+": Fire FireOnExpandingGroup Event")}this.Parent.OnExpandingGroup(this,a,b)};IDPanelSrv.prototype.HandleGrouping=function(){this.set_ShowGroups(!this.ShowGroups());if(!this.ShowGroups()){this.MainFrm.RD3AddEvent("rstgrp",this.GetRD3Ident());this.ResetRD3Cache();var a=this.ActualPosition();this.set_ActualPosition(this.ActualPosition()-this.NumRows);this.set_SelectedRow(0);this.set_ActualPosition(a);this.RD3Change(RD3Glb.PAN_ACTUALROW);this.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.SendPositions=true}else{if(this.GroupRoot!=null||this.GroupingList.Count()>0){this.RefreshGrouping(true)}}};IDPanelSrv.prototype.RD3ExpandGroup=function(a,b){if(!this.GroupingEnabled()||!this.ShowGroups()||this.GroupRoot==null){return}this.GroupRoot.RD3ExpandGroups(a,b,this.ActualPosition()+this.AttR)};IDPanelSrv.prototype.CreateGroups=function(){var a=null;if(this.GroupingList.Count()>0){a=new PListGroupSrv(this);a.iStartingRecord=1;a.iEndingRecord=this.GetNumRows();a.iExpanded=true}if(a==null){return}var c=this.GroupRoot;this.GroupRoot=a;this.DisableNotification=true;this.DisableLookups=true;var e=this.ActualPosition();var b=this.AttR;this.set_SelectedRow(0);for(var d=1;d<=this.Queries[0].RecordCount();d++){this.set_ActualPosition(d);a.GenerateGroups()}this.set_ActualPosition(e-b);this.set_SelectedRow(b);this.DisableNotification=false;this.DisableLookups=false;this.RD3Change(RD3Glb.PAN_SENDGROUPS);this.GroupRoot.MantainStatus(c)};IDPanelSrv.prototype.GetDecodingField=function(c){for(var e=1;e<this.Queries.length;e++){var h=true;for(var d=0;d<this.Queries[e].LookupParams.Count();d++){var b=this.Queries[e].LookupParams[d];var g=false;if(b.MstField!=null){if(b.MstField==c){g=true}h&=g}}if(h){for(var f=0;f<this.Fields.length;f++){var a=this.Fields[f];if(a.IdxPanel==e&&a.IsVisible(this.AttR,false)){return a}}}}return c};IDPanelSrv.prototype.ExportHeader=function(){return this.ExportLabel};IDPanelSrv.prototype.set_ExportHeader=function(a){this.ExportLabel=a};IDPanelSrv.prototype.FieldTextSelectionChanged=function(b,g,a){var e=this.Fields[b];var d=new IDVariant(e.selStart);var c=new IDVariant(e.selEnd);e.selStart=g;e.selEnd=a;this.Parent.OnChangeTextSelection(this,new IDVariant(b),d,c)};IDPanelSrv.prototype.OnRD3ClientFocus=function(a,b){this.Parent.OnFocus(this,new IDVariant(a),new IDVariant(b))};IDPanelSrv.prototype.BackgroundColor=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].BackColor}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastBackColor;if(a==-1){a=this.Fields[b].BackColor}return a}};IDPanelSrv.prototype.set_BackgroundColor=function(b,a){this.Fields[b].SetBackgroundColor(a)};IDPanelSrv.prototype.ForegroundColor=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].ForeColor}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastForeColor;if(a==-1){a=this.Fields[b].ForeColor}return a}};IDPanelSrv.prototype.set_ForegroundColor=function(b,a){this.Fields[b].SetForegroundColor(a)};IDPanelSrv.prototype.FontModifiers=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].FontMod}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastFontMod;if(a==null||a.length==0){a=this.Fields[b].FontMod}return a}};IDPanelSrv.prototype.set_FontModifiers=function(b,a){this.Fields[b].SetFontModifiers(a)};IDPanelSrv.prototype.Mask=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].Mask}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastMask;if(a==null||a.length==0){a=this.Fields[b].Mask}return a}};IDPanelSrv.prototype.set_Mask=function(b,a){this.Fields[b].SetMask(a)};IDPanelSrv.prototype.Alignment=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].Alignment}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastAlignment;if(a==-1){a=this.Fields[b].Alignment}return a}};IDPanelSrv.prototype.set_Alignment=function(b,a){this.Fields[b].SetAlignment(a)};IDPanelSrv.prototype.Watermark=function(a){return this.Fields[a].WaterMark()};IDPanelSrv.prototype.set_Watermark=function(b,a){this.Fields[b].set_WaterMark(a)};IDPanelSrv.prototype.FireGetLKE=function(b,c,f,a,e,d){this.Parent.OnGetLKE(this,b,c,f,a,e,d)};IDPanelSrv.prototype.OpenFieldComboBox=function(a){this.Fields[a].RD3Change(RD3Glb.FLD_OPENCOMBO);this.SetInput(-1,a,2)};IDPanelSrv.prototype.AddField=function(k,l,e,c,a,o,p,b,m,j){var d=this.Fields.length;var g=new Array(d+1);this.Fields.copyTo(g,0);this.Fields=g;this.Fields[d]=new PFieldSrv();this.Fields[d].Index=d;this.Fields[d].Parent=this;this.Fields[d].set_MultiSelectionComboBox(this.MainFrm.ParamsObj().MultiSelectionComboBox);this.set_Header(Glb.OBJ_FIELD,d,k);this.SetFieldPage(d,-1,j);this.SetFlags(Glb.OBJ_FIELD,d,o,-1);this.SetNumRow(Glb.OBJ_FIELD,d,Glb.PANEL_LIST,1);this.SetNumRow(Glb.OBJ_FIELD,d,Glb.PANEL_FORM,1);this.SetFieldPanel(d,m,l,l,e,c,a,-45);this.set_VisualStyle(Glb.OBJ_FIELD,d,b);this.IMDB.TblDelete(this.MstTblIndex,0);if(d>=this.IMDB.TblNumField(this.MstTblIndex)){var h=this.IMDB.add_TblField(this.MstTblIndex);this.IMDB.set_FldCode(this.MstTblIndex,h,l);this.IMDB.SetFldParams(this.MstTblIndex,h,e,c,a)}else{this.IMDB.set_FldCode(this.MstTblIndex,d,l);this.IMDB.SetFldParams(this.MstTblIndex,d,e,c,a)}this.IMDB.TblAddNew(this.MstTblIndex,0);return d};IDPanelSrv.prototype.AddGroup=function(e,h,d,a){var b=-1;switch(e){case Glb.OBJ_PAGE:b=this.Pages.length;var f=new Array(b+1);this.Pages.copyTo(f,0);this.Pages=f;this.Pages[b]=new PPageSrv();this.Pages[b].Index=b;this.Pages[b].Parent=this;this.set_Header(Glb.OBJ_PAGE,b,h);this.SetFlags(Glb.OBJ_PAGE,b,d,-1);this.set_VisualStyle(Glb.OBJ_PAGE,b,a);break;case Glb.OBJ_GROUP:b=this.Groups.length;var c=new Array(b+1);this.Groups.copyTo(c,0);this.Groups=c;this.Groups[b]=new PGroupSrv();this.Groups[b].Index=b;this.Groups[b].Parent=this;this.Groups[b].set_Collapsible(this.MainFrm.ParamsObj().UseCollapsableGroups);this.set_Header(Glb.OBJ_GROUP,b,h);this.SetFlags(Glb.OBJ_GROUP,b,d,-1);this.set_VisualStyle(Glb.OBJ_GROUP,b,a);break}return b};IDPanelSrv.prototype.OnSearchBox=function(a){var b=IDVariant.FALSE;if(b==IDVariant.FALSE){this.DoSearch(a)}};IDPanelSrv.prototype.DoSearch=function(a){this.PanelCommand(Glb.PCM_SEARCH);for(var b=0;b<this.Fields.length;b++){var d=this.Fields[b];var c=(this.VS.Mask(d.VisualStyle)=="="||d.Mask=="=");if((d.Flags&Glb.FLD_INLIST)!=0&&(d.Flags&Glb.FLD_LISTLIST)!=0&&Glb.ClassDT(d.DataType)==Glb.DTC_CHAR&&!c){this.set_QBEFilter(b,a,false);break}}this.PanelCommand(Glb.PCM_FIND)};IDPanelSrv.prototype.RD3MoreRows=function(){if(this.Status()==Glb.PS_DATA&&this.Queries[0].RecordCount()>this.DynamicRows){var a=this.DynamicRows+this.OrgDynRows;this.SetDynRows(a,this.DynamicHeight)}};IDPanelSrv.prototype.VisualFlag=function(a){return((this.iVisualFlags&a)!=0)};IDPanelSrv.prototype.set_VisualFlag=function(a,b){if((this.iVisualFlags&a)!=(b?a:0)){this.iVisualFlags=(this.iVisualFlags&(~a))|(b?a:0);this.RD3Change(RD3Glb.PAN_VISPROP)}};IDPanelSrv.prototype.Badge=function(b){if(this.ValidatingRow==-1||this.Fields[b].IdxPanel==-1){return this.Fields[b].iBadge}else{var a=this.Fields[b].bValues(this.ValidatingRow).LastBadge;if(a==null||a.length==0){a=this.Fields[b].iBadge}return a}};IDPanelSrv.prototype.set_Badge=function(b,a){this.Fields[b].SetBadge(a)};function ImdbInitSrv(a){this.IMDB=new IMDBObjSrv();this.MainFrm=a}ImdbInitSrv.prototype.AppendTo=function(a){};function IndHandlerSrv(a){this.Indicators=new Array();this.MainFrm=a;this.SystemIndicator=0;if(a!=undefined){if(a.ParamsObj().MAX_INDICATORS>0){this.Indicators=new Array(a.ParamsObj().MAX_INDICATORS+1)}}}IndHandlerSrv.prototype.AppendTo=function(a){};IndHandlerSrv.prototype.set_Enabled=function(a,b){this.Indicators[a].set_bEnabled(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.set_Text=function(b,a){this.Indicators[b].set_bText(this.MainFrm.ActiveFormIdx(),a)};IndHandlerSrv.prototype.set_Visible=function(a,b){this.Indicators[a].set_bVisible(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.set_Image=function(a,b){this.Indicators[a].set_bImage(this.MainFrm.ActiveFormIdx(),b)};IndHandlerSrv.prototype.Enabled=function(a){return this.Indicators[a].bEnabled(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Text=function(a){return this.Indicators[a].bText(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Visible=function(a){return this.Indicators[a].bVisible(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.Image=function(a){return this.Indicators[a].bImage(this.MainFrm.ActiveFormIdx())};IndHandlerSrv.prototype.SetSysMsg=function(a,b){if(b==undefined){b=""}if(this.SystemIndicator>0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",21,"IndicatorHandler.SystemMessage","Set message to: "+a+(b.length>0?"(Img="+b+")":""))}this.set_Text(this.SystemIndicator,a);this.set_Image(this.SystemIndicator,b)}else{if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",22,"IndicatorHandler.SystemMessage","Message "+a+" not added: Indicator Panel not found")}}};IndHandlerSrv.prototype.GetRD3Name=function(){return"inh"};IndHandlerSrv.prototype.RD3RenderDifferences=function(c,f){if(this.Indicators.length==0){return false}var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}var d=false;var a=(f)?e:c;for(var b=1;b<this.Indicators.length;b++){if(this.Indicators[b]==null){continue}d|=this.Indicators[b].RD3RenderDifferences(a,f)}return d};function OBookSrv(a){WebFrameSrv.call(this,a);this.BookObj;this.ShowToolbar=true;this.ShowStatusBar=true;this.LastPage=0;this.WasHidden=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.BOK_MAXPROPS);this.RD3PageCache=new HashTableSrv();this.RD3DeletePage=-1;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.ChangePageAnimationDef=null}OBookSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OBookSrv[obj]=WebFrameSrv[obj]}OBookSrv.prototype.HasCaptionCommands=function(){return this.ShowToolbar};OBookSrv.prototype.ProcessRequest=function(a,c,e,b){var f=this.BookObj.FrIndex();if(c.PreviewBook!=null){var d=a.GetParameter("col"+f+".x");if(d!=null&&d.length>0){c.PreviewBook=null;a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",110,"ABook.ProcessRequest","Book "+this.BookObj.GetName()+": preview closed");a.DTTObj.SetRequestName("Book Close Preview","Book "+this.BookObj.GetName()+": preview closed",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book "+this.BookObj.GetName()+" preview closed","","col");a.DTTObj.AddHelpItem(0,0,0,0,"Chiudi la preview del book "+this.BookObj.GetName());return}}if(!b){var d=a.GetParameter("top"+f+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book First Page","Book "+this.BookObj.GetName()+": Go to first page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to first","","top");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,0,true)}d=a.GetParameter("bottom"+f+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Last Page","Book "+this.BookObj.GetName()+": Go to last page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to last","","bottom");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,1,true)}d=a.GetParameter("next"+f+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Next Page","Book "+this.BookObj.GetName()+": Go to next page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to next","","next");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,3,true)}d=a.GetParameter("prev"+f+".x");if(d!=null&&d.length>0&&this.BookObj.GetPageNumber()>1){a.DTTObj.SetRequestName("Book Previous Page","Book "+this.BookObj.GetName()+": Go to previous page",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to prev","","prev");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,2,true)}d=a.GetParameter("print"+f+".x");if(d!=null&&d.length>0){a.DTTObj.SetRequestName("Book Print","Book "+this.BookObj.GetName()+": printing to PDF file",DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book print","","print");a.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del book");this.BookCommand(IDREGlb.BCM_PRINT,0,true)}}this.BookObj.ProcessRequest(a,b)};OBookSrv.prototype.Resize=function(d,b){var c=this.BookObj.HideBorder()?8:0;var a=this.BookObj.HideBorder()?8:0;WebFrameSrv.prototype.Resize.call(this,d,b);this.BookObj.SetSize(d-c,b-a)};OBookSrv.prototype.InitDefMasks=function(){this.BookObj.SetDefaultMasks(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask,this.Parent.MainFrm.ParamsObj().DefaultFloatMask,this.Parent.MainFrm.ParamsObj().DefaultDateMask,this.Parent.MainFrm.ParamsObj().DefaultTimeMask)};OBookSrv.prototype.Fire_OnFormattingPage=function(a){this.Parent.OnFormattingPage(this,a)};OBookSrv.prototype.Fire_OnFormattingSection=function(a){this.Parent.OnFormattingSection(this,a)};OBookSrv.prototype.Fire_OnAfterFormattingSection=function(a){this.Parent.OnAfterFormattingSection(this,a)};OBookSrv.prototype.Fire_OnChangingSpan=function(d,a,b,c){this.Parent.OnChangingSpan(this,d,a,b,c)};OBookSrv.prototype.Fire_OnBoxDrop=function(b,a){this.Parent.OnBoxDrop(this,b,a)};OBookSrv.prototype.Fire_OnBoxTransform=function(d,e,c,f,a,b){this.Parent.OnBoxTransform(this,d,e,c,f,a,b)};OBookSrv.prototype.Fire_OnConnecting=function(a){this.Parent.OnConnecting(this,a)};OBookSrv.prototype.Fire_Activated=function(b,a){this.Parent.Activated(this,b,a)};OBookSrv.prototype.Fire_OnIMDBUpdate=function(a){this.Parent.OnIMDBUpdate(this,a)};OBookSrv.prototype.Fire_OnPreview=function(){if(this.Parent.PreviewBook==null){this.Parent.RD3Change(RD3Glb.FRM_PREVIEW)}this.Parent.OnPreview(this)};OBookSrv.prototype.BookCommand=function(g,b,f,d){if(b==undefined){b=0}if(f==undefined){f=false}if(d==undefined){d=0}var c=-2;var e=-2;var a=new IDVariant();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": received command "+this.DecodeCommand(g)+"; fire OnBookCommand event"+(f?" (USER operation)":""));this.Parent.OnBookCommand(this,new IDVariant(g),a,new IDVariant(f));if(a.isTrue()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": command canceled");return false}switch(g){case IDREGlb.BCM_PRINT:c=this.BookObj.GetPageNumber();e=c;this.BookObj.set_PrintDestination(IDREGlb.PRN_PDF);this.BookObj.PrintBook(1,-1);this.MainFrm.RedirectTo().set(new IDVariant(this.BookObj.GetWebFileName()));this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",111,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": printed to file "+this.BookObj.GetWebFileName());this.MainFrm.set_RedirectNewWindow(true);this.BookObj.set_PrintDestination(IDREGlb.PRN_SCREEN);break;case IDREGlb.BCM_NAVIGATION:switch(b){case 0:c=1;e=1;break;case 1:c=this.BookObj.GetLastCachedPage();if(c==0){c=1}e=-1;break;case 2:c=this.BookObj.GetPageNumber()-1;e=c;break;case 3:c=this.BookObj.GetPageNumber()+1;e=c;break;case 4:c=d;e=d;break}break;case IDREGlb.BCM_CSV:this.ExportData();break}if(c>-2&&e>-2){this.BookObj.PrintBook(c,e);if(this.RD3Changed||(this.ToolbarEventDef&RD3Glb.EVENT_CLIENTSIDE)==0){this.RD3Change(RD3Glb.BOK_PAGENUM);this.RD3Change(RD3Glb.BOK_PAGETOTAL);this.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}}return true};OBookSrv.prototype.DecodeCommand=function(a){switch(a){case IDREGlb.BCM_PRINT:return"Print";case IDREGlb.BCM_NAVIGATION:return"Navigate";case IDREGlb.BCM_CSV:return"Export"}return""+a};OBookSrv.prototype.ExportData=function(e,d){if(d==undefined){d=true}if(!d){var a=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,63,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": received command "+this.DecodeCommand(IDREGlb.BCM_CSV)+"; fire OnBookCommand event")}this.Parent.OnBookCommand(this,new IDVariant(IDREGlb.BCM_CSV),a,new IDVariant(false));if(a.isTrue()){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,77,"Book.OnBookCommand","Book "+this.BookObj.GetName()+": command canceled")}return""}}for(var c=0;c<this.BookObj.Book.ReportsList.Count();c++){var b=this.BookObj.Book.ReportsList[c];if(b.ParentBox!=null){continue}if(!b.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(b.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}return b.ExportData(this.MainFrm,e)}return""};OBookSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.BookObj.FrIndex()+":"+this.Parent.FormIdx};OBookSrv.prototype.GetRD3Name=function(){return"book"};OBookSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OBookSrv.prototype.RD3RenderDifferences=function(f,j,p){this.FrIndex=this.BookObj.FrIndex();var o=this.RD3Changed;var d=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,j,p);if(f==null){f=d}o|=(d!=null);if(f==null&&this.RD3Changed){f=j.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());d=f}if(p){if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){f.SetAttribute("tck",this.ToolbarEventDef.toString())}if(this.ChangePageAnimationDef!=null){f.SetAttribute("cpa",this.ChangePageAnimationDef)}}if(p||this.RD3Changed){var a=false;for(var h=0;h<RD3Glb.BOK_MAXPROPS;h++){if(this.RD3PropChg[h]||p){a=true;this.SetRD3Property(h,f,p)}}this.RD3PropChg.SetAll(false);if(this.RD3DeletePage!=-1){f.SetAttribute("dgp",this.RD3DeletePage.toString());this.RD3DeletePage=-1;a=true}if(!p&&!a){j.RemoveNode(f);f=null}}if(p||this.RD3Changed){var l=this.BookObj.GetPageNumber();if(!this.RD3PageCache.containsKey(l)||p||this.BookObj.Book.CacheSize()!=1){if(this.BookObj.Book.CacheSize()==1&&!p&&this.BookObj.RD3ResendPage(l)){p=true}if(this.BookObj.RD3RenderDifference(f,j,p)){this.RD3PageCache[l]=true}if(this.BookObj.Book.CacheSize()!=1&&j!=null&&"rd3".equals(j.Name())&&j.HasNextNode()){var b=new ArrayList();while(j.HasNextNode()){var g=j.GetNextNode();if(g.Name()==null||!g.Name().equals("del")){continue}var c=g.GetAttribute("id");if(c==null||c.length<3){continue}c=c.substring(0,3);if(!c.equals("sec")&&!c.equals("box")&&!c.equals("spn")){continue}b.Add(g)}for(var h=0;h<b.Count();h++){var g=b[h];g.GetNode().parentNode.insertBefore(g.GetNode(),g.GetNode().parentNode.getFirstChild())}}}else{if(this.BookObj.Book.PE.PrintingPage!=null&&this.BookObj.Book.PE.LastRD3Page!=null&&this.BookObj.Book.PE.LastRD3Page.PageNum!=l){this.BookObj.Book.PE.LastRD3Page=this.BookObj.Book.PE.PrintingPage}}}if(!p){var k=new ArrayList();this.BookObj.Book.GetSubForm(k);for(var m=0;m<k.Count();m++){var e=k[m];o|=e.RD3RenderDifferences(j,p)}}this.RD3Changed=false;return o?d:null};OBookSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.BOK_SHOWSTATUSBAR:if(b&&this.ShowStatusBar){break}c.SetAttribute("ssb",this.ShowStatusBar?"1":"0");break;case RD3Glb.BOK_SHOWTOOLBAR:if(b&&this.ShowToolbar){break}c.SetAttribute("stb",this.ShowToolbar?"1":"0");break;case RD3Glb.BOK_PAGENUM:c.SetAttribute("pag",this.BookObj.GetPageNumber().toString());break;case RD3Glb.BOK_PAGETOTAL:c.SetAttribute("ptt",this.BookObj.GetTotalPagesNumber().toString());break;case RD3Glb.BOK_PAGECONFIRMED:c.SetAttribute("pcf",(this.BookObj.GetTotalPagesNumberConf()?"1":"0"));break;case RD3Glb.BOK_HIDEBORDER:c.SetAttribute("hib",(this.BookObj.HideBorder()?"1":"0"));break;case RD3Glb.BOK_ENABLEDCOMMANDS:if(b&&this.BookObj.Book.EnabledCommands==-5){break}c.SetAttribute("enc",this.BookObj.Book.EnabledCommands.toString());break;case RD3Glb.BOK_CACHESIZE:if(b&&this.BookObj.Book.CacheSize()==1){break}c.SetAttribute("csz",this.BookObj.Book.CacheSize().toString());break;case RD3Glb.BOK_FIXEDWIDTH:if(b&&this.BookObj.Book.FixedWidth==0){break}c.SetAttribute("fiw",this.BookObj.Book.FixedWidth.toString());break;case RD3Glb.BOK_FIXEDHEIGHT:if(b&&this.BookObj.Book.FixedHeight==0){break}c.SetAttribute("fih",this.BookObj.Book.FixedHeight.toString());break;case RD3Glb.BOK_SCROLLDIR:if(b&&this.BookObj.ScrollDir==0){break}c.SetAttribute("scd",this.BookObj.ScrollDir.toString());break;case RD3Glb.BOK_FORCESNAP:if(b&&this.BookObj.ForceSnap){break}c.SetAttribute("fsn",this.BookObj.ForceSnap?"1":"0");break;case RD3Glb.BOK_OPTIMIZEDOM:if(b&&!this.BookObj.OptimizeDOM){break}c.SetAttribute("opt",this.BookObj.OptimizeDOM?"1":"0");break}};OBookSrv.prototype.RD3ResetPageCache=function(d){var j=true;if(this.RD3PageCache.count()==1&&this.RD3PageCache.containsKey(this.BookObj.GetLastRD3Page())){j=false}if(this.BookObj.Book.CacheSize()!=1&&!d){var a=this.BookObj.Book.PE.LastRD3MultiPages;var f=(a[0]==null?0:a[0].PageNum);var g=(a[a.length-1]==null?0:a[a.length-1].PageNum);if(f>0&&g>0){var h=this.RD3PageCache.keys();for(var b=0;b<h.length;b++){var c=h[b];if(c<f||c>g){this.RD3PageCache.remove(c)}}for(var b=0;b<a.length;b++){if(a[b]!=null){this.RD3PageCache.remove(a[b].PageNum)}}}else{this.RD3PageCache.clear()}if(j){var e=this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident());if(f>0){e.SetAttribute("from",f.toString())}if(g>0){e.SetAttribute("to",g.toString())}}}else{this.RD3PageCache.clear();if(j){this.MainFrm.RD3AddEvent("rcache",this.GetRD3Ident())}}this.RD3Changed=true};OBookSrv.prototype.RD3ToolbarHandler=function(b,a){if(b=="top"){this.MainFrm.DTTObj.SetRequestName("Book First Page","Book "+this.BookObj.GetName()+": Go to first page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to first","","top");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone TOP nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,0,true)}else{if(b=="bottom"){this.MainFrm.DTTObj.SetRequestName("Book Last Page","Book "+this.BookObj.GetName()+": Go to last page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to last","","bottom");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone BOTTOM nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,1,true)}else{if(b=="prev"){this.MainFrm.DTTObj.SetRequestName("Book Previous Page","Book "+this.BookObj.GetName()+": Go to previous page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to prev","","prev");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PREVIOUS nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,2,true)}else{if(b=="next"){this.MainFrm.DTTObj.SetRequestName("Book Next Page","Book "+this.BookObj.GetName()+": Go to next page",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book go to next","","next");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone NEXT nella toolbar del book");this.BookCommand(IDREGlb.BCM_NAVIGATION,3,true)}else{if(b=="print"){this.MainFrm.DTTObj.SetRequestName("Book Print","Book "+this.BookObj.GetName()+": printing to PDF file",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book print","","print");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone PRINT nella toolbar del book");this.BookCommand(IDREGlb.BCM_PRINT,0,true)}else{if(b=="csv"){this.MainFrm.DTTObj.SetRequestName("Book Export","Book "+this.BookObj.GetName()+": exporting to CSV file",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_BOOKTOOLBAR,"Book export","","csv");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Premi il bottone EXCEL nella toolbar del book");this.BookCommand(IDREGlb.BCM_CSV,0,true)}else{if(b=="goto"){this.MainFrm.DTTObj.SetRequestName("Goto Page","Book "+this.BookObj.GetName()+": going to page "+a,DTTRequest.PRI_CMD);this.BookCommand(IDREGlb.BCM_NAVIGATION,4,true,a)}}}}}}}};OBookSrv.prototype.ShowTool=function(){return this.ShowToolbar};OBookSrv.prototype.set_ShowTool=function(a){this.ShowToolbar=a;this.RD3Change(RD3Glb.BOK_SHOWTOOLBAR)};OBookSrv.prototype.ShowStatus=function(){return this.ShowStatusBar};OBookSrv.prototype.set_ShowStatus=function(a){this.ShowStatusBar=a;this.RD3Change(RD3Glb.BOK_SHOWSTATUSBAR)};OBookSrv.prototype.set_Width=function(a){if(this.Width!=a){this.Parent.Frames[this.BookObj.FrIndex()].Width=a;this.Parent.Frames[this.BookObj.FrIndex()].RD3Change(RD3Glb.AFR_WIDTH);this.Width=a}};OBookSrv.prototype.set_Height=function(a){if(this.Height!=a){this.Parent.Frames[this.BookObj.FrIndex()].Height=a;this.Parent.Frames[this.BookObj.FrIndex()].RD3Change(RD3Glb.AFR_HEIGHT);this.Height=a}};OBookSrv.prototype.RD3Resize=function(b,e,d){var c=this.BookObj.HideBorder()?-4:6;var a=this.BookObj.HideBorder()?-4:6;WebFrameSrv.prototype.RD3Resize.call(this,b,e,d);this.BookObj.SetSize(this.Width-c+6,this.Height-a+6)};OBookSrv.prototype.RD3EndRequest=function(){var c=new ArrayList();this.BookObj.Book.GetSubForm(c);for(var d=0;d<c.Count();d++){var a=c[d];for(var b=0;b<a.Frames.length;b++){if(a.Frames[b]!=null&&a.Frames[b].Content!=null){if(this.Parent==this.MainFrm.ActiveForm()&&a.Frames[b].Content instanceof IDPanelSrv){a.Frames[b].Content.RD3Validate=true}a.Frames[b].Content.RD3EndRequest()}}}if(this.WasHidden){if(this.Visible&&!this.Collapsed&&this.Exposed()){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,72,"OBook.UpdateBook","Book"+this.BookObj.GetName()+": update performed for the first time (the book was either invisible, collapsed or not exposed)");this.BookObj.UpdateBook(this.WasHidden);this.WasHidden=false}}};OBookSrv.prototype.RD3RawClick=function(a,j,g,m,f,l,c){var h=c.GetAttribute("par4");var d=-1;var e=null;if(h.startsWith("box:")){e=this.BookObj.RD3FindBox(h)}if(e!=null){d=this.BookObj.MoveDSEToBox(e)}var k=new IDVariant();if(this.MainFrm!=null){var b=(l)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(b,"Book"+this.BookObj.GetName()+" "+b,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"Book."+b,"Book "+this.BookObj.GetName()+": firing event "+b)}if(l){this.Parent.OnMouseDoubleClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d),k)}else{this.Parent.OnMouseClick(this,new IDVariant(a),new IDVariant(j),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d),k)}return k.isTrue()};OBookSrv.prototype.GenericDrag=function(b,g){var f=parseInt(b.GetAttribute("par1"),10);var j=b.GetAttribute("obn");var c=b.GetAttribute("oid");var e=this.MainFrm.RD3FindBox(j);this.BookObj.MoveDSEToBox(e);this.MainFrm.ActivedDocument=null;this.MainFrm.ActivedProperty=null;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrag","Book "+this.BookObj.GetName()+": firing event OnGenericDrag");var h=new IDVariant();this.Parent.OnGenericDrag(this,h,new IDVariant(f),new IDVariant(e.GetIndex()));if(g instanceof WebFrameSrv){var a=g;if(c.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var d=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;d.GenericDrop(b,h)}else{a.GenericDrop(b,h)}}if(g instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(g,h)}};OBookSrv.prototype.GenericDrop=function(a,h){var g=parseFloat(a.GetAttribute("par4"));var f=parseFloat(a.GetAttribute("par5"));var d=parseInt(a.GetAttribute("par1"),10);var k=parseInt(a.GetAttribute("par2"),10);var e=parseInt(a.GetAttribute("par3"),10);var b=a.GetAttribute("oid");var c=this.MainFrm.RD3FindBox(b);this.BookObj.MoveDSEToBox(c);this.MainFrm.DTTObj.SetRequestName("Generic Drop","Book "+this.BookObj.GetName()+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrop","Book "+this.BookObj.GetName()+": firing event OnGenericDrop");var j=new IDVariant();this.Parent.OnGenericDrop(this,h,j,new IDVariant(d),new IDVariant(g),new IDVariant(f),new IDVariant(k),new IDVariant(e),new IDVariant(c.GetIndex()))};function OButBarSrv(a){WebFrameSrv.call(this,a);this.CSetIndex;this.Vertical;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.BBR_MAXPROPS)}OButBarSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OButBarSrv[obj]=WebFrameSrv[obj]}OButBarSrv.prototype.ProcessRequest=function(a,c,d,b){this.MainFrm=a;if(!b){a.CmdObj.ProcessRequest(this.CSetIndex,c,a)}};OButBarSrv.prototype.GetRD3Name=function(){return"bbr"};OButBarSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OButBarSrv.prototype.RD3RenderDifferences=function(f,c,e){this.Parent.MainFrm.CmdObj.DTTTrace(this.Parent.MainFrm,this.CSetIndex,DTTEngine.TRC_ITBUTBAR);var d=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,f,c,e);if(f==null){f=a}d|=(a!=null);if(f==null&&this.RD3Changed){f=c.AddNewElement("chg");f.SetAttribute("id",this.GetRD3Ident());a=f}if(e||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||e){this.SetRD3Property(b,f,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d?a:null};OButBarSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.BBR_CMDSETIDX:if(this.CSetIndex==0&&b){break}c.SetAttribute("cms","cms:"+this.CSetIndex);break;case RD3Glb.BBR_VERTICAL:if(!this.Vertical&&b){break}c.SetAttribute("bvr",this.Vertical?"1":"0");break}};function ATabSrv(){this.Content;this.Flags=0;this.Image="";this.Header="";this.Tooltip="";this.Style=0;this.Badge="";this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TAB_MAXPROPS);this.RD3NewObj=false;this.RD3DelObj=false}ATabSrv.prototype.GetRD3Ident=function(){var b=this.Content.GetRD3Ident();var a=b.indexOf(":");return this.GetRD3Name()+b.substr(a)};ATabSrv.prototype.GetRD3Name=function(){return"tab"};ATabSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ATabSrv.prototype.RD3RenderDifference=function(c,f,a){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f,a)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d};ATabSrv.prototype.SetRD3Property=function(a,d,c,b){switch(a){case RD3Glb.TAB_IMAGE:if(this.Image.length==0&&c){break}d.SetAttribute("img",this.Image);break;case RD3Glb.TAB_HEADER:if(this.Header.length==0&&c){break}d.SetAttribute("cap",this.Header);break;case RD3Glb.TAB_TOOLTIP:if(this.Tooltip.length==0&&c){break}d.SetAttribute("tip",this.Tooltip);break;case RD3Glb.TAB_STYLE:if(this.Style==0&&c){break}d.SetAttribute("sty",b.VisualStyleList.GetTrueIdx(this.Style).toString());break;case RD3Glb.TAB_CONTENT:d.SetAttribute("con",this.Content.GetRD3Ident());break;case RD3Glb.TAB_BADGE:if(this.Badge.length==0&&c){break}d.SetAttribute("bdg",this.Badge);break}};function OTabViewSrv(a){WebFrameSrv.call(this,a);this.ItemList;this.SelectedTab;this.Placement;this.HiddenTabs;this.AutoSize=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.TAB_MAXPROPS);this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ChangePageAnimationDef=null}OTabViewSrv.prototype=new WebFrameSrv();for(var i=0;i<Object.keys(WebFrameSrv).length;i++){var obj=Object.keys(WebFrameSrv)[i];OTabViewSrv[obj]=WebFrameSrv[obj]}OTabViewSrv.prototype.SetItemCount=function(b){this.ItemList=new Array(b+1);for(var a=1;a<this.ItemList.length;a++){this.ItemList[a]=new ATabSrv()}};OTabViewSrv.prototype.SetItem=function(g,e,d,a,c,b){this.ItemList[g].Content=e;this.ItemList[g].Flags=d;this.ItemList[g].Image=a;this.ItemList[g].Tooltip=b;this.ItemList[g].Header=e.Caption;if(e.Description!=null){this.ItemList[g].Tooltip=e.Description}if(e.Content.iImage!=null){this.ItemList[g].Image=e.Content.iImage}e.Exposed=false;e.Content.set_Exposed(false);e.TabIdx=this.FrIndex};OTabViewSrv.prototype.GetItem=function(a){return this.ItemList[a].Content};OTabViewSrv.prototype.SelectedPageIndex=function(){if(this.SelectedTab>=0&&this.SelectedTab<this.ItemList.length&&this.ItemList[this.SelectedTab]!=null&&this.ItemList[this.SelectedTab].Content!=null){return this.ItemList[this.SelectedTab].Content.Index}return -1};OTabViewSrv.prototype.GetNumTab=function(){var b=0;for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Content.Visible){b++}}return b};OTabViewSrv.prototype.SelectTab=function(d,l){if(this.ItemList.length==1){return}var b=this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv&&this.ItemList[this.SelectedTab].Content.Content.HasFocus();if(d!=this.SelectedTab){var j=this.SelectedTab;this.SelectedTab=d;var m=new IDVariant();var c=0;if(j>0){c=this.ItemList[j].Content.Index}var g=this.Parent.Document();if(this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv){var k=this.ItemList[this.SelectedTab].Content.Content;var e=null;if(k.MasterPanelCode!=null){e=this.Parent.SearchPanel(k.MasterPanelCode)}else{if(k.MasterPanelIdx>0){e=this.Parent.Frames[k.MasterPanelIdx].Content}}if(e!=null){if(e.Queries[0].IsMasterDO){this.Parent.set_Document(e.GetDocument())}}else{if(k.Queries[0].IsMasterDO){this.Parent.set_Document(null)}}}var h=this.Parent.Document();if(!this.HiddenTabs){this.Parent.TabClick(this,new IDVariant(c),m)}if(m.isTrue()){this.SelectedTab=j;if(h==this.Parent.Document()){this.Parent.set_Document(g)}return}}if(this.SelectedTab>0&&this.AutoSize){var a=this.ItemList[this.SelectedTab].Content.Content.GetContentSize();if(a!=null){this.Parent.Frames[this.FrIndex].FixedHeight=a.Height+Glb.PAN_OFFS_PAGEY+Glb.PAN_OFFS_Y;this.ItemList[this.SelectedTab].Content.FixedHeight=a.Height+Glb.PAN_OFFS_Y}}for(var f=1;f<this.ItemList.length;f++){this.ItemList[f].Content.Exposed=false;this.ItemList[f].Content.Content.set_Exposed(false)}if(this.SelectedTab>0&&this.Parent.Frames[this.FrIndex].Exposed){this.ItemList[this.SelectedTab].Content.Exposed=true;this.ItemList[this.SelectedTab].Content.Content.set_Exposed(true);if(b){if(this.SelectedTab>0&&this.ItemList[this.SelectedTab].Content!=null&&this.ItemList[this.SelectedTab].Content.Content instanceof IDPanelSrv){this.ItemList[this.SelectedTab].Content.Content.SetInput()}else{if(this.Parent.FocusPriority<2){this.Parent.ActiveElement="CMD"}}}}this.RD3Change(RD3Glb.TBV_SELECTEDTAB)};OTabViewSrv.prototype.SelectFrameByIndex=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){this.SelectTab(a,true);return}}};OTabViewSrv.prototype.FindFrame=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content==b){return a}}return 0};OTabViewSrv.prototype.ProcessRequest=function(a,d,f,b){if(!b){for(var c=1;c<this.ItemList.length;c++){var e=a.GetParameter("page"+this.FrIndex+"_"+c+".x");if(e!=null&&e.length>0){this.SelectTab(c,true);a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,31,"ATabView.ProcessRequest","Tabbed "+this.Parent.Frames[this.FrIndex].Caption+": selected page "+this.ItemList[this.SelectedTab].Content.Caption);a.DTTObj.SetRequestName("Tab Page Select","Selected page "+this.ItemList[this.SelectedTab].Content.Caption,DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TABSELPG,"Tabbed change page","",c);a.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la pagina "+this.ItemList[this.SelectedTab].Content.Caption+" nella tab view");break}}this.CheckForHiddenPage(a)}if(this.SelectedTab>0){this.ItemList[this.SelectedTab].Content.ProcessRequest(a,f,b)}};OTabViewSrv.prototype.SearchObject=function(a){for(var b=1;b<this.ItemList.length;b++){var c=this.ItemList[b].Content.Content.SearchObject(a);if(c!=null){return c}}return null};OTabViewSrv.prototype.CheckForHiddenPage=function(a){if(this.SelectedTab>0&&!this.ItemList[this.SelectedTab].Content.Content.Visible){var c=false;for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content.Content.Visible){c=true;a.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,32,"ATabView.CheckHiddenPage","The page "+this.ItemList[this.SelectedTab].Content.Caption+" has an invisible content. Selecting page "+this.ItemList[b].Content.Caption+" instead");this.SelectTab(b,true);break}}if(!c){a.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,33,"ATabView.CheckHiddenPage","The page "+this.ItemList[this.SelectedTab].Content.Caption+" has an invisible content and no visible pages have been found");this.SelectTab(0,true)}}};OTabViewSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.iGuid,DTTEngine.TRC_ITTABBED,"Tabbed.Render","")){if(this.ItemList[this.SelectedTab]!=null&&this.ItemList[this.SelectedTab].Content!=null){var b="PG="+this.ItemList[this.SelectedTab].Content.Caption;a.DTTObj.AddTraceToken(this.iGuid,DTTEngine.TRC_TABCAPTION,"Tabbed.Caption",this.Parent.Frames[this.FrIndex].Caption,b)}}};OTabViewSrv.prototype.SetItemImage=function(b,c){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){if(!this.ItemList[a].Image.equals(c)){this.ItemList[a].Image=c;this.ItemList[a].RD3Change(RD3Glb.TAB_IMAGE)}return}}};OTabViewSrv.prototype.SetItemCaption=function(c,b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==c){if(!this.ItemList[a].Header.equals(b)){this.ItemList[a].Header=b;this.ItemList[a].RD3Change(RD3Glb.TAB_HEADER)}return}}};OTabViewSrv.prototype.GetItemCaption=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Header}}return""};OTabViewSrv.prototype.SetItemStyle=function(c,b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==c){if(this.ItemList[a].Style!=b){this.ItemList[a].Style=b;this.ItemList[a].RD3Change(RD3Glb.TAB_STYLE)}return}}};OTabViewSrv.prototype.GetItemStyle=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Style}}return 0};OTabViewSrv.prototype.ChangeItemVisibility=function(b,a){this.CheckForHiddenPage(a)};OTabViewSrv.prototype.Resize=function(e,b){var a=e;var d=b;for(var c=1;c<this.ItemList.length;c++){this.ItemList[c].Content.Resize(a,d);this.ItemList[c].Content.Width=a;this.ItemList[c].Content.Height=d;this.ItemList[c].Content.FixedWidth=a;this.ItemList[c].Content.FixedHeight=d}};OTabViewSrv.prototype.set_Exposed=function(a){WebFrameSrv.prototype.set_Exposed.call(this,a);if(this.SelectedTab>0){this.ItemList[this.SelectedTab].Content.Exposed=a;this.ItemList[this.SelectedTab].Content.Content.set_Exposed(a)}};OTabViewSrv.prototype.GetRD3Name=function(){return"tbv"};OTabViewSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};OTabViewSrv.prototype.RD3RenderDifferences=function(b,f,j){this.DTTTrace(this.Parent.MainFrm);if(!j&&!this.RD3Changed){for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].RD3NewObj||this.ItemList[e].RD3DelObj){this.RD3Changed=true;break}}}var h=this.RD3Changed;var a=WebFrameSrv.prototype.RD3RenderDifferences.call(this,b,f,j);if(b==null){b=a}h|=(a!=null);if(b==null&&this.RD3Changed){b=f.AddNewElement("chg");b.SetAttribute("id",this.GetRD3Ident());a=b}if(j||this.RD3Changed){for(var e=0;e<this.RD3PropChg.length;e++){if(this.RD3PropChg[e]||j){this.SetRD3Property(e,b,j)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(j){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(this.ChangePageAnimationDef!=null){b.SetAttribute("cpa",this.ChangePageAnimationDef)}}if(this.ItemList!=null){var d=(j)?b:f;for(var e=1;e<this.ItemList.length;e++){if(this.ItemList[e].RD3NewObj){this.ItemList[e].RD3RenderDifference(b,true,this.MainFrm);this.ItemList[e].RD3NewObj=false}else{if(this.ItemList[e].RD3DelObj){if(!j){var c=f.AddNewElement("chg");c.SetAttribute("id",this.ItemList[e].GetRD3Ident());c.SetAttribute("dcl","1")}var g=this.ItemList;this.ItemList=new Array(g.length-1);Array.copy(g,0,this.ItemList,0,e);if(g.length>e+1){Array.copy(g,e+1,this.ItemList,e,g.length-e-1)}if(this.SelectedTab>e){this.SelectedTab--;this.RD3Change(RD3Glb.TBV_SELECTEDTAB)}e--}else{h|=this.ItemList[e].RD3RenderDifference(d,j,this.Parent.MainFrm)}}}}return h?a:null};OTabViewSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.TBV_SELECTEDTAB:if(this.SelectedTab==0&&b){break}if(this.Parent!=null){this.CheckForHiddenPage(this.Parent.MainFrm)}c.SetAttribute("sel",this.SelectedTab.toString());break;case RD3Glb.TBV_PLACEMENT:if(this.Placement==0&&b){break}c.SetAttribute("pla",this.Placement.toString());break;case RD3Glb.TBV_HIDDENTABS:if(!this.HiddenTabs&&b){break}c.SetAttribute("hid",this.HiddenTabs?"1":"0");break;case RD3Glb.TBV_AUTOSIZE:if(!this.AutoSize&&b){break}c.SetAttribute("asz",this.AutoSize?"1":"0");break}};OTabViewSrv.prototype.RD3FindTab=function(c){for(var a=1;a<this.ItemList.length;a++){var b=this.ItemList[a];if(b.GetRD3Ident().equals(c)){return b}}return null};OTabViewSrv.prototype.RD3SelectTab=function(d){var b=this.SelectedTab;var c=this.RD3FindTab(d);var a=this.Parent.MainFrm;if(c!=null){this.SelectFrameByIndex(c.Content.Index);if(this.SelectedTab>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,31,"ATabView.ProcessRequest","Tabbed "+this.Parent.Frames[this.FrIndex].Caption+": selected page "+this.ItemList[this.SelectedTab].Content.Caption);a.DTTObj.SetRequestName("Tab Page Select","Selected page "+this.ItemList[this.SelectedTab].Content.Caption,DTTRequest.PRI_CMD);a.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_TABSELPG,"Tabbed change page","",this.SelectedTab);a.DTTObj.AddHelpItem(0,0,0,0,"Seleziona la pagina "+this.ItemList[this.SelectedTab].Content.Caption+" nella tab view")}this.CheckForHiddenPage(a)}if(this.SelectedTab==b&&this.ClickEventDef==RD3Glb.EVENT_ACTIVE){this.RD3Change(RD3Glb.TBV_SELECTEDTAB)}};OTabViewSrv.prototype.RD3RawClick=function(c,h,g,p,f,o,e){var b=e.GetAttribute("par4");var l=b.indexOf(":");var k=b.indexOf(":",l+1);var a=-1;if(l>-1&&k>-1&&b.startsWith("tab:")){var j=b.substr(l+1,k-l-1);a=parseInt(j,10)}var m=new IDVariant();if(this.MainFrm!=null){var d=(o)?"OnMouseDoubleClick":"OnMouseClick";this.MainFrm.DTTObj.SetRequestName(d,"TabbedView "+this.Code+" "+d,DTTRequest.PRI_ITEM);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,205,"TabbedView."+d,"TabbedView "+this.Code+": firing event "+d)}if(o){this.Parent.OnMouseDoubleClick(this,new IDVariant(c),new IDVariant(h),new IDVariant(g),new IDVariant(p),new IDVariant(f),new IDVariant(a),m)}else{this.Parent.OnMouseClick(this,new IDVariant(c),new IDVariant(h),new IDVariant(g),new IDVariant(p),new IDVariant(f),new IDVariant(a),m)}return m.isTrue()};OTabViewSrv.prototype.AddSubFormByIndex=function(a){var b=this.MainFrm.CreateFormByIndex(a.intValue());this.AddSubForm(b);return b};OTabViewSrv.prototype.AddSubForm=function(a){Array.resize(this.Parent.Frames,this.Parent.Frames.length+1);var b=new AFrameSrv(this.Parent.Frames.length-1);this.Parent.Frames[this.Parent.Frames.length-1]=b;b.Parent=this.Parent;b.InTabbed=true;b.FrHidden=true;b.RD3NewObj=true;var c=new ASubFormSrv(this.Parent);b.Content=c;c.FrIndex=b.Index;c.Height=this.Height;c.Width=this.Width;c.Init(a,a.MainFrm);b.Caption=a.Caption().stringValue();Array.resize(this.ItemList,this.ItemList.length+1);this.ItemList[this.ItemList.length-1]=new ATabSrv();this.ItemList[this.ItemList.length-1].RD3NewObj=true;this.SetItem(this.ItemList.length-1,b,0,a.Image(),"","")};OTabViewSrv.prototype.DelSubForm=function(d){var a=null;var e=null;for(var c=1;c<this.Parent.Frames.length;c++){if(this.Parent.Frames[c].Content instanceof ASubFormSrv&&this.Parent.Frames[c].Content.pSubForm==d){a=this.Parent.Frames[c];for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content!=null&&this.ItemList[b].Content.Content==this.Parent.Frames[c].Content){e=this.ItemList[b];break}}break}}if(a!=null&&e!=null){a.RD3DelObj=true;e.RD3DelObj=true;if(this.ItemList[this.SelectedTab]==e&&this.SelectedTab>1){for(var c=this.SelectedTab-1;c>=1;c--){if(!this.ItemList[c].RD3DelObj&&this.ItemList[c].Content!=null&&this.ItemList[c].Content.Content!=null&&this.ItemList[c].Content.Content.Visible){this.SelectTab(c,true);break}}}return true}return false};OTabViewSrv.prototype.GetSubFormIndex=function(c){for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content!=null&&this.ItemList[b].Content.Content!=null&&this.ItemList[b].Content.Content instanceof ASubFormSrv){var a=this.ItemList[b].Content.Content;if(a.pSubForm==c){return new IDVariant(this.ItemList[b].Content.Index)}}}return new IDVariant(-1)};OTabViewSrv.prototype.GenericDrag=function(b,h){var g=parseInt(b.GetAttribute("par1"),10);var l=b.GetAttribute("obn");var c=b.GetAttribute("oid");this.MainFrm.ActivedDocument=null;this.MainFrm.ActivedProperty=null;var d=-1;for(var e=1;e<this.ItemList.length;e++){var k=this.ItemList[e];if(l.startsWith(k.GetRD3Ident())){d=k.Content.Index;break}}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"OBook.OnGenericDrag","TabbedView "+this.Parent.Frames[this.FrIndex].Caption+": firing event OnGenericDrag");var j=new IDVariant();this.Parent.OnGenericDrag(this,j,new IDVariant(g),new IDVariant(d));if(h instanceof WebFrameSrv){var a=h;if(c.startsWith("tab")&&a.Parent!=null&&a.FrIndex>-1&&a.Parent.Frames[a.FrIndex].InTabbed&&a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx]!=null){var f=a.Parent.Frames[a.Parent.Frames[a.FrIndex].TabIdx].Content;f.GenericDrop(b,j)}else{a.GenericDrop(b,j)}}if(h instanceof ACommandSrv){this.MainFrm.CmdObj.GenericDrop(h,j)}};OTabViewSrv.prototype.GenericDrop=function(a,j){var h=parseFloat(a.GetAttribute("par4"));var g=parseFloat(a.GetAttribute("par5"));var e=parseInt(a.GetAttribute("par1"),10);var m=parseInt(a.GetAttribute("par2"));var f=parseInt(a.GetAttribute("par3"));var b=a.GetAttribute("oid");var d=-1;for(var c=1;c<this.ItemList.length;c++){var l=this.ItemList[c];if(b.startsWith(l.GetRD3Ident())){d=l.Content.Index;break}}this.MainFrm.DTTObj.SetRequestName("Generic Drop","Tabbed "+this.Code+" Generic Drop",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,210,"TabbedView.OnGenericDrop","TabbedView "+this.Parent.Frames[this.FrIndex].Caption+": firing event OnGenericDrop");var k=new IDVariant();this.Parent.OnGenericDrop(this,j,k,new IDVariant(e),new IDVariant(h),new IDVariant(g),new IDVariant(m),new IDVariant(f),new IDVariant(d))};OTabViewSrv.prototype.SetItemBadge=function(c,a){for(var b=1;b<this.ItemList.length;b++){if(this.ItemList[b].Content.Index==c){if(!this.ItemList[b].Badge.equals(a)){this.ItemList[b].Badge=a;this.ItemList[b].RD3Change(RD3Glb.TAB_BADGE)}return}}};OTabViewSrv.prototype.GetItemBadge=function(b){for(var a=1;a<this.ItemList.length;a++){if(this.ItemList[a].Content.Index==b){return this.ItemList[a].Badge}}return""};function ParamsSrv(){this.MAX_FORMS=0;this.MAX_INDICATORS=0;this.MAX_COMMANDS=0;this.MAX_COMMAND_SETS=0;this.MAX_TIMERS=0;this.ICDebug=0;this.DemoMode=0;this.UseFastRowSelector=true;this.PanelIsLockable=true;this.InfoMessages=true;this.UseSmallIcon=true;this.Theme="classic";this.AutoDynRows=0;this.ActImgWidth=0;this.NativeBlob=false;this.UseClientMask=false;this.DefaultDateMask="";this.DefaultTimeMask="";this.DefaultCurrencyMask="";this.DefaultFloatMask="";this.UseDecimalDot=false;this.PanelConfirmDelete=true;this.PanelHighlightDelete=true;this.ShowFieldImageInValue=true;this.ShowDisabledFieldActivator=true;this.PanelsSortAlways=true;this.IWCacheControl="NONE";this.AutoSaveType="NONE";this.UseRD=true;this.UseRD3=true;this.TruePopup=true;this.UseIDTag=true;this.ShowRD=true;this.UseFK=true;this.UseDoubleClick=true;this.EditUpdErrorMode=0;this.EditInsErrorMode=0;this.FinalUpdErrorMode=0;this.FinalInsErrorMode=0;this.PanelCommandMask=-1;this.EnablePanelMultiSelection=true;this.ShowPanelMultiSelection=false;this.ActivePanelMultiSelection=false;this.SelectAllOnlyVisible=false;this.PanelQBEEmpty=false;this.HelpFeatures="";this.HtmlConstraints=Glb.WEBVALID_NONE;this.UseCollapsableFrames=true;this.ChangeRowDelay=0;this.SmartLookupIcon="NO";this.ShowDisabledIcons=false;this.RightAlignedIcons=false;this.AllowMasterPanelNav=true;this.PanelsLikeSearch=true;this.ToolbarPosition=Glb.FORMTOOL_RIGHT;this.BorderType=Glb.BORDER_THICK;this.TooltipErrorMode=Glb.ERRTOOLTIP_OVER;this.MaxRequestSize=100*1024;this.EnableGFX=true;this.EnableSound=true;this.EnableRichTooltip=true;this.MultiSelectionComboBox=true;this.UseCollapsableGroups=false;this.TooltipOnEachRow=false;this.EnableFrameResize=false;this.QBETrueLessThan=false;this.PanelEnableInsertWhenLocked=false;this.LKEDOAllProperties=true;this.PanelFreezeWhenHidden=true;this.PanelsUseTab=true;this.PanelNewInsertMode=false;this.ResponseBufferSize=48;this.CompressResponse=true;this.LANGUAGE="ITA";this.UseRD4=false;this.LoadingPolicy=1;this.PullToRefresh=true;this.UseHTML5Upload=true;this.CompletePanelBorders=true;this.UseZones=true;this.EnableVoice=false;this.UseIDEditor=true}function PBlobCacheSrv(){this.BlobNum;this.FldIndex;this.RSIndex;this.BookMark;this.Size;this.ToDownload;this.IsValid=-1;this.MimeType="";this.FileName="";this.Extension=""}function PDFPrintSrv(){this.PDFFile="";this.MsgText="";this.FromPage=0;this.ToPage=0;this.FitToPaper=true;this.AutoDelete=false;this.PrintDlg=false;this.Printed=false;this.Rendered=false}function PFieldSrv(){this.Parent;this.Index;this.VisualStyle=0;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.ImageResMode=1;this.Header="";this.AbbrHeaderList="";this.AbbrHeaderForm="";this.Tooltip="";this.iGuid;this.Page;this.Group;this.IdxPanel=-1;this.Expr;this.Code="";this.DataType;this.MaxLength;this.vScale;this.iVisualFlags;this.ValueList=new ArrayList();this.ListLeft;this.ListTop;this.ListWidth;this.ListHeight;this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.FormNumRow;this.ListNumRow;this.SortMode=0;this.SortFld=-1;this.LastQBE="";this.LastQBEPos=new Array(0);this.QBEEnabled=true;this.MaxAutoShowSize=50*1024;this.MaxUploadSize=10*1024*1024;this.BlobNewWindow=true;this.MultiUpload=false;this.MaxUploadFiles=0;this.UploadExtensions="";this.UploadDescription="";this.MstCol;this.SubFrame=0;this.CmdIdx=0;this.HResMode=new Array(2);this.VResMode=new Array(2);this.HeaderSize=new Array(2);this.Values=new Array(0);this.RSIdx=-1;this.ImdbIdx=-2;this.PriIdx=-1;this.QueryValueSource;this.Unbound=false;this.CauseValidation=true;this.IsNamed=false;this.IsExtended=false;this.IDLista="";this.EditorType=0;this.ActImg=null;this.ActWidth=-9999;this.Transformation=0;this.TrFormat="";this.TrOffset=0;this.QBELike=true;this.flLookupExtended=false;this.FontList;this.ColorList;this.TokenList;this.iShowEditorToolbar=true;this.iToolCommandEnabled=-1;this.iDefaultFormatting="";this.GroupIntervals=new ArrayList();this.GroupAggregation=PListGroupAggrSrv.AGGR_NONE;this.GroupAggrLabel=null;this.GroupDirection=0;this.ForeColor=-2;this.BackColor=-2;this.FontMod="";this.Mask="";this.Alignment=-1;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.FLD_MAXPROPS);this.UseHilight=false;this.UserChangedField=false;this.CalculateMask=true;this.ClickEventDef=RD3Glb.EVENT_ACTIVE;this.ChangeEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE;this.iMultiSelectionComboBox=true;this.iQBESep=null;this.iMultiCriteria=false;this.GroupVS=-1;this.useTextSelection=false;this.sendSelection=false;this.selStart=-1;this.selEnd=-1;this.iWaterMark="";this.iBadge=""}PFieldSrv.prototype.IsActive=function(){return(this.Flags&Glb.FLD_ACTIVE)!=0};PFieldSrv.prototype.FldRect=function(b){var a=new RectSrv();if(b==Glb.PANEL_LIST){a.Left=this.ListLeft;a.Top=this.ListTop;a.Width=this.ListWidth;a.Height=this.ListHeight;if((this.Flags&Glb.FLD_LISTLIST)==0&&this.Parent.ShowRowSelector){a.Left+=Glb.SELECT_OFFSET}}else{a.Left=this.FormLeft;a.Top=this.FormTop;a.Width=this.FormWidth;a.Height=this.FormHeight}return a};PFieldSrv.prototype.set_FldRect=function(b,a){if(b==Glb.PANEL_LIST){this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.RD3Change(RD3Glb.FLD_LISTLEFT);this.RD3Change(RD3Glb.FLD_LISTTOP);this.RD3Change(RD3Glb.FLD_LISTWIDTH);this.RD3Change(RD3Glb.FLD_LISTHEIGHT)}else{this.FormLeft=a.Left;this.FormTop=a.Top;this.FormWidth=a.Width;this.FormHeight=a.Height;this.RD3Change(RD3Glb.FLD_FORMLEFT);this.RD3Change(RD3Glb.FLD_FORMTOP);this.RD3Change(RD3Glb.FLD_FORMWIDTH);this.RD3Change(RD3Glb.FLD_FORMHEIGHT)}};PFieldSrv.prototype.IsPresent=function(a){if(a==undefined){a=true}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(a&&(this.Flags&Glb.OBJ_VISIBLE)==0){return false}if(this.Page>-1&&this.Parent.PanelPage!=this.Page){return false}if(this.Parent.PanelMode==Glb.PANEL_LIST){if((this.Flags&Glb.FLD_INLIST)>0){return true}}else{if((this.Flags&Glb.FLD_INFORM)>0){return true}}return false};PFieldSrv.prototype.SetRect=function(d,c,b,a){this.set_FldRect(d,c);this.HResMode[d]=b;this.VResMode[d]=a;if(d==0){this.RD3Change(RD3Glb.FLD_LISTHRESMODE);this.RD3Change(RD3Glb.FLD_LISTVRESMODE)}if(d==1){this.RD3Change(RD3Glb.FLD_FORMHRESMODE);this.RD3Change(RD3Glb.FLD_FORMVRESMODE)}};PFieldSrv.prototype.SetHeaderSize=function(b,a){this.HeaderSize[b]=a;if(b==0){this.RD3Change(RD3Glb.FLD_LISTHDRSIZE)}if(b==1){this.RD3Change(RD3Glb.FLD_FORMHDRSIZE)}};PFieldSrv.prototype.set_HdrSize=function(b,a){this.SetHeaderSize(b,a)};PFieldSrv.prototype.HdrSize=function(a){return this.HeaderSize[a]};PFieldSrv.prototype.SetVisualStyle=function(c){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.VisualStyle!=c){var a=(this.VisualStyle==0?1:this.Parent.VS.ControlType(this.VisualStyle));var b=(c==0?1:this.Parent.VS.ControlType(c));if(b==Glb.VISCTRL_HTMLEDIT){this.Parent.SetFieldEditor(this.Index,1)}else{if(a==Glb.VISCTRL_HTMLEDIT){this.Parent.SetFieldEditor(this.Index,0)}}this.VisualStyle=c;this.RD3Change(RD3Glb.FLD_VISATTR)}}else{this.Values[this.Parent.ValidatingRow].VisualStyle=c}};PFieldSrv.prototype.SetDynFlags=function(a,b){if((b&Glb.OBJ_VISIBLE)>0){this.Values[this.Parent.ValidatingRow].Visible=((a&Glb.OBJ_VISIBLE)!=0)?1:0}if((b&Glb.OBJ_ENABLED)>0){this.Values[this.Parent.ValidatingRow].Enabled=((a&Glb.OBJ_ENABLED)!=0)?1:0}};PFieldSrv.prototype.GetDynFlags=function(){var a=this.Flags;if(this.Values[this.Parent.ValidatingRow].LastVisible==0){a=a&(~Glb.OBJ_VISIBLE)}if(this.Values[this.Parent.ValidatingRow].LastEnabled==0){a=a&(~Glb.OBJ_ENABLED)}return a};PFieldSrv.prototype.AddVLItem=function(c,a,e,d,f){var b=new PVLItemSrv();b.Name=a;b.Description=e;b.Image=d;b.Value=c;b.VisIdx=f;this.ValueList.Add(b)};PFieldSrv.prototype.IsVertHeader=function(a){if(a==Glb.PANEL_LIST){return(this.Flags&Glb.FLD_VERTHDRLIST)!=0}else{return(this.Flags&Glb.FLD_VERTHDRFORM)!=0}};PFieldSrv.prototype.IsHeaderHidden=function(a){if(a==Glb.PANEL_LIST){return(this.Flags&Glb.FLD_NOHDRLIST)!=0}else{return(this.Flags&Glb.FLD_NOHDRFORM)!=0}};PFieldSrv.prototype.GetHeaderRect=function(a){var b=new RectSrv();if(a==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)!=0){b.Left=this.ListLeft;b.Top=this.Parent.ListTop;b.Width=this.ListWidth;b.Height=this.Parent.HeaderSize;return b}if(!this.IsHeaderHidden(a)){b=this.FldRect(a);if(this.IsVertHeader(a)){b.Height=this.HeaderSize[a]}else{b.Width=this.HeaderSize[a]}}return b};PFieldSrv.prototype.GetValueRect=function(b,a){var c=this.FldRect(b);if(b==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)!=0){c.Top=c.Top+a*(this.Parent.MaxHRow+this.Parent.OffsetRow());return c}if(!this.IsHeaderHidden(b)){if(this.IsVertHeader(b)){c.Height=c.Height-this.HeaderSize[b]-Glb.HEADER_GAP;c.Top=c.Top+this.HeaderSize[b]+Glb.HEADER_GAP}else{c.Width=c.Width-this.HeaderSize[b]-Glb.HEADER_GAP;c.Left=c.Left+this.HeaderSize[b]+Glb.HEADER_GAP}}return c};PFieldSrv.prototype.IsComboOptional=function(b){if((this.Flags&Glb.FLD_ISOPT)!=0){return true}else{if(this.Parent.Status()==Glb.PS_QBE){return true}else{if(this.Values[b].Value.Type==IDVariant.NULL){return true}else{if(this.ValueList.Count()>0){var c=false;for(var a=0;a<this.ValueList.Count();a++){if(this.Values[b].Value.equals(this.ValueList[a].Value)){c=true;break}}return !c}else{if(this.QueryValueSource!=null&&this.QueryValueSource.RS!=null){var c=false;this.QueryValueSource.RS.MoveFirst();while(!this.QueryValueSource.RS.EOF()){if(this.Values[b].Value.equals(this.QueryValueSource.RS.Get(1))){c=true;break}this.QueryValueSource.RS.MoveNext()}this.QueryValueSource.RS.MoveFirst();return !c}}}}}return false};PFieldSrv.prototype.GetDisabledComboHtml=function(d){var c="";var b=this.GetVisualStyle(d);var e=this.GetValueRect(this.Parent.PanelMode,0);var a=(this.Values[d].ValueListIndexes.length>0?this.Values[d].ValueListIndexes[0]:null);if(a!=null){if(this.CanActivate(d)&&(this.VisFlags(d)&Glb.FL_VIS_HYPERLINK)!=0){c+='<span style="position:absolute;'+this.Parent.VS.GetWebRect(b,(this.Parent.PanelMode==Glb.PANEL_FORM?Glb.VISBDI_VALFORM:Glb.VISBDI_VALUE),0,0,-999,-999,Glb.WEBSTY_SPAN,this.Parent.MainFrm.BrowserClass)+'">';c+="<input "+this.Parent.MainFrm.DTTObj.GetDTTID(this.iGuid,d+"act")+"type=image name=A"+this.Parent.FrIndex+"C"+this.Index+"R"+d+' src="images/tsubmit.gif" style="'+this.Parent.VS.GetWebRect(b,(this.Parent.PanelMode==Glb.PANEL_FORM?Glb.VISBDI_VALFORM:Glb.VISBDI_VALUE),-999,-999,e.Width,e.Height,Glb.WEBSTY_INP,this.Parent.MainFrm.BrowserClass)+'">';c+="</span>"}if(a.Image.length>0&&(this.VisFlags(d)&Glb.FL_VIS_SHOWIMAGE)!=0){c+='<img src="images/'+a.Image+'" align=top';if(this.Values[d].Tooltip.length==0&&!a.Description.equals("")){c+=' alt="'+Glb.HTMLEncode(a.Description)+'"'}c+=">&nbsp; "}if(a.Name.length>0&&(this.VisFlags(d)&Glb.FL_VIS_SHOWDESCR)!=0){c+=Glb.HTMLEncode(a.Name)}}return c};PFieldSrv.prototype.set_BuffSize=function(c){var a=new Array(c);for(var b=0;b<c;b++){if(b<this.Values.length&&this.Values[b]!=null){a[b]=this.Values[b]}else{a[b]=new PValueSrv();a[b].Parent=this;a[b].Index=b;this.CalculateMask=true}}this.Values=a};PFieldSrv.prototype.ProcessRequest=function(h,g,a){if(!this.IsPresent()||this.IdxPanel<0||this.DataType==Glb.DT_DOC_OLE){return false}if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}var c=0;var b=this.Parent.NumRows-1;if(this.Parent.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_LISTLIST)==0){c=this.Parent.AttR;b=this.Parent.AttR}var d=false;for(var f=c;f<=b;f++){var k;if(h.RDStatus==Glb.RD_ACTIVE){var j=new IDVariant(h.GetParameter("F"+this.Parent.FrIndex+"C"+this.Index+"R"+f));if(j.Type==IDVariant.NULL){continue}k=j.stringValue()}else{k=h.GetParameter("F"+this.Parent.FrIndex+"C"+this.Index+"R"+f)}if(k==null){k=""}var e=this.ProcessRowChange(h,k,f);d=d||e}return d};PFieldSrv.prototype.ProcessRowChange=function(u,x,l){if(this.DataType==Glb.DT_CHAR&&x.trim().length==0){x=x.trim()}var h=false;var t=x;var a=(x.length==0);if(this.Parent.Status()==Glb.PS_QBE){if(a||(x.charAt(0)=="="&&!this.HasConcept("DO_ID"))){this.iMultiCriteria=false}else{this.iMultiCriteria=(x.indexOf(this.GetQBESep())>0)}}if(this.IsEnabled(l,false)&&((this.Flags&Glb.FLD_AUTOLOOKUP)==0||(this.Flags&Glb.FLD_CANACTIVATE)==0||this.Parent.MainFrm.ParamsObj().UseRD3)){var b=(this.Parent.VS.Flags(this.GetVisualStyle(l))&Glb.FL_VIS_PASSWORD)!=0;if(b){var o=true;for(var f=0;f<x.length&&o;f++){if(x.charAt(f)!="*"){o=false}}if(o){x=""}}if(this.IdxPanel>0){if(this.Parent.Queries[this.IdxPanel].LKEParams!=null&&x.length>3&&x.substr(0,3).equals("LKE")){x=x.substr(3);if(x.equals("NULL")){var c=this.Values[l].GetLkeRS();if(c!=null){h=this.Parent.bQueries(this.IdxPanel).GetLKERow(-1,l,true,c,-1);this.Values[l].SetLkeRS(null);if(!h){this.Values[l].SetValue(this.Values[l].OrgValue);this.Values[l].RD3Change(RD3Glb.VAL_TEXT)}}x=null}else{if(x.equals("MORE")){this.Activate(l);this.Values[l].SetLkeRS(null);this.Values[l].RD3Change(RD3Glb.VAL_TEXT);x=null}else{if(x.equals("PREC")){this.Values[l].SetValue(this.Values[l].OrgValue);this.Values[l].RD3Change(RD3Glb.VAL_TEXT);this.Values[l].SetLkeRS(null);x=null}else{var m=("LKE"+x).split(";");for(var g=0;g<m.length;g++){x=m[g];if(!x.startsWith("LKE")){this.Parent.Queries[this.IdxPanel].UpdateLookup(0,u);break}try{var q=parseInt(x.substr(3),10);if(q>0){var c=this.Values[l].GetLkeRS();if(c!=null){h=this.Parent.Queries[this.IdxPanel].GetLKERow(q,l,false,c,g);if(!h){this.Values[l].SetValue(this.Values[l].OrgValue);this.Values[l].RD3Change(RD3Glb.VAL_TEXT)}}x=null}}catch(p){}}this.Values[l].SetLkeRS(null)}}}}}if(x!=null&&(!b||x.length>0||a)){var v=this.Values[l].Modified;if(this.CtrlType(l)==Glb.VISCTRL_CHECK){if(this.Parent.Status()==Glb.PS_QBE&&x.length==0){h=this.Values[l].SetNewValue(new IDVariant())}else{if(!(this.Parent.Status()==Glb.PS_DATA&&x.length==0&&IDL.IsNull(this.Values[l].Value))){h=this.Values[l].SetCheck(x,this.Parent.Status()!=Glb.PS_QBE)}}}else{if((this.Flags&Glb.FLD_AUTOLOOKUP)>0&&!(this.Parent.Status()==Glb.PS_QBE&&this.iMultiCriteria)){h=this.Values[l].SetNewAutoLookupValue(x)}else{h=this.Values[l].SetNewText(x,this.Parent.Status()!=Glb.PS_QBE)}}if(!v&&this.IdxPanel==0&&!this.Values[l].Value.equals(this.Values[l].LastValue)){var r=true;if(this.Values[l].Value.Type==IDVariant.STRING&&this.Values[l].LastValue.Type==IDVariant.STRING){if(this.Values[l].Value.stringValue().trim()==this.Values[l].LastValue.stringValue().trim()){r=false}}if(this.ValueList.Count()>0&&this.CtrlType(l)==Glb.VISCTRL_CHECK&&this.Values[l].LastValue.Type==IDVariant.NULL&&this.Values[l].Value.intValue()==0){r=false}if(r){u.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",104,"PField.ProcessRequest","Row "+(this.Parent.AttR+1)+" Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": value changed from "+Glb.HTMLEncode(this.Values[l].LastValue.toString(),true,false)+" to "+Glb.HTMLEncode(this.Values[l].Value.toString(),true,false)+" for row "+(l+1)+(this.Unbound?" (UNBOUND)":""));u.DTTObj.SetRequestName("Panel Modified","Panel "+this.Parent.GetDTTCaption()+" modified",DTTRequest.PRI_DATA);u.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_FLDCHG,"Field "+this.GetDTTCaption()+" value changed",t,l);if((this.Flags&Glb.FLD_AUTOLOOKUP)>0){if(this.QueryValueSource==null){for(var d=0;d<this.Parent.UQueries();d++){if(this.Parent.bQueries(d).FieldIndex==this.Index){this.QueryValueSource=this.Parent.bQueries(d);break}}}u.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(l+1)+" in "+this.QueryValueSource.GetValueSourceValue(this.Values[l].Value));this.QueryValueSource=null}else{if(this.ValueList.Count()>0&&this.Values[l].ValueListIndexes.length>0){if(this.CtrlType(l)==Glb.VISCTRL_CHECK){u.DTTObj.AddHelpItem(0,0,0,0,(this.Values[l].ValueListIndexes[0]==this.ValueList[0]?"Attiva":"Disattiva")+" il checkbox nel campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(l+1))}else{u.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(l+1)+" in "+this.Values[l].GetComboName())}}else{u.DTTObj.AddHelpItem(0,0,0,0,"Cambia il valore del campo "+this.GetDTTCaption()+(this.Tooltip!=null&&this.Tooltip.length>0?" ("+this.Tooltip+")":"")+" sulla la riga "+(l+1)+" in "+this.Values[l].Text)}}}}if(this.Unbound&&this.Values[l].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.Queries[0].WriteUnboundValue(l,this)}if(!this.CauseValidation&&this.Values[l].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Values[l].LastRDText=this.GetRD2Text(l);this.Values[l].Modified=false;h=false}if(this.IdxPanel>0&&h){this.Parent.Queries[this.IdxPanel].AddLKERow(l);this.Values[l].LastRDText=this.GetRD2Text(l);this.Values[l].Modified=false;h=false}}}if(h){this.Parent.SetRDRowSel(l,true);this.Values[l].LastRDText=this.GetRD2Text(l)}return h};PFieldSrv.prototype.ClearBuffer=function(c){var a=this.Parent.ValidatingRow;for(var b=0;b<this.Values.length;b++){this.Parent.ValidatingRow=b;this.Values[b].Clear(c)}this.Parent.ValidatingRow=a};PFieldSrv.prototype.SetBuffer=function(b,a,c){this.GetRSIdx(a);if((this.DataType==Glb.DT_DOC_OLE)){this.Values[b].SetValue(new IDVariant(c.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[b].SetOriginal()}else{try{this.Values[b].SetValue(Glb.GetTD(a.Get(this.GetRSIdx(null)),this.Transformation,this.TrFormat,this.TrOffset,this.MaxLength))}catch(d){}if((this.Values[b].Text.length>this.MaxLength)){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var f=this.Values[b].Text.length;if(this.Values[b].Text.substr(0,1).equals("-")){f=f-1}if(this.Values[b].Text.indexOf(".")!=-1){f=f-1}if(f>this.MaxLength){this.MaxLength=f;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[b].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}this.Values[b].SetOriginal()}if(this.Values[b].Value.Type==IDVariant.DECIMAL&&this.vScale>0){this.Values[b].Value.Value=Math.round((this.Values[b].Value.Value*(Math.pow(10,this.vScale))))/Math.pow(10,this.vScale)}};PFieldSrv.prototype.SetIMDBBuffer=function(a,d,b){this.GetRSIMDBIdx(d);if((this.DataType==Glb.DT_DOC_OLE)){this.Values[a].SetValue(new IDVariant(b.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[a].SetOriginal()}else{this.Values[a].SetValue(this.Parent.IMDB.Value(d,this.GetRSIdx(null),Glb.IMDB_CURSOR));this.Values[a].SetOriginal();if((this.Values[a].Text.length>this.MaxLength)){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var c=this.Values[a].Text.length;if(this.Values[a].Text.substr(0,1).equals("-")){c=c-1}if(this.Values[a].Text.indexOf(".")!=-1){c=c-1}if(c>this.MaxLength){this.MaxLength=c;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[a].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}}};PFieldSrv.prototype.SetDOBuffer=function(d,b,e,c){if(c==undefined){c=-1}var a=this.GetDOIdx(b);if(this.DataType==Glb.DT_DOC_OLE){this.Values[d].SetValue(new IDVariant(e.GetBlobFromCache(this.Index,this.GetRSIdx(null),this.MaxAutoShowSize)));this.Values[d].SetOriginal()}else{var g=null;if(a<1){if(this.IsNamed){g=b.GetNamedPropertyValue(this.Code)}else{g=new IDVariant(this.Code)}}else{g=b.GetPropByIndex(a)}if(c>0){g=new IDVariant(this.Values[d].Text+this.Parent.MainFrm.ComboNameSep+g.stringValue())}this.Values[d].SetValue(g);this.Values[d].SetOriginal();if(this.Values[d].Text.length>this.MaxLength){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER){var f=this.Values[d].Text.length;if(this.Values[d].Text.substr(0,1).equals("-")){f=f-1}if(this.Values[d].Text.indexOf(".")!=-1){f=f-1}if(f>this.MaxLength){this.MaxLength=f;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}else{this.MaxLength=this.Values[d].Text.length;this.RD3Change(RD3Glb.FLD_MAXLENGTH)}}}};PFieldSrv.prototype.GetRSIdx=function(a){var b;if(this.Transformation==Glb.TRANSF_SUBSTR||this.Transformation==Glb.TRANSF_C2TOI){b=this.TrFormat}else{b=this.Code}if(a!=null&&this.RSIdx==-1){try{this.RSIdx=a.findColumn(b)}catch(c){}}if(a!=null&&this.RSIdx==-1){try{this.RSIdx=a.findColumn(b.toUpperCase())}catch(c){}}if(a!=null&&this.RSIdx!=-1){a.setColUnbound(this.RSIdx,this.Unbound)}return this.RSIdx};PFieldSrv.prototype.GetRSIMDBIdx=function(a){if(this.RSIdx==-1){this.RSIdx=this.Parent.IMDB.FldByCode(a,this.Code)}return this.RSIdx};PFieldSrv.prototype.bValues=function(a){return this.Values[a]};PFieldSrv.prototype.UValues=function(){return this.Values.length};PFieldSrv.prototype.GetIMDBIdx=function(){if(this.ImdbIdx==-2){if(this.Parent.MstTblIndex>-1){this.ImdbIdx=this.Parent.IMDB.FldByCode(this.Parent.MstTblIndex,this.Code)}else{this.ImdbIdx=-1}}return this.ImdbIdx};PFieldSrv.prototype.GetDOIdx=function(a){if(this.RSIdx==-1&&a!=null){this.RSIdx=a.GetPropIndex(this.Code);if(this.RSIdx<1){this.RSIdx=a.GetPropertyIndex(this.Code)}if(this.RSIdx<1){var b=a.GetNamedPropertyDefinition(this.Code);if(b.DataType!=0){this.IsNamed=true;this.DataType=b.DataType;this.RD3Change(RD3Glb.FLD_DATATYPE);if(b.MaxLength!=0){this.MaxLength=b.MaxLength;this.vScale=b.vScale;this.RD3Change(RD3Glb.FLD_MAXLENGTH);this.RD3Change(RD3Glb.FLD_SCALE)}if(b.UIName!=null&&b.UIName.length>0){this.Header=b.UIName;this.AbbrHeaderForm=b.UIName;this.AbbrHeaderList=b.UIName;this.RD3Change(RD3Glb.FLD_HEADER);this.RD3Change(RD3Glb.FLD_FORMHEADER);this.RD3Change(RD3Glb.FLD_LISTHEADER)}}}}return this.RSIdx};PFieldSrv.prototype.UpdateField=function(e,d){if(e==undefined||e instanceof IDVariant){e=null;d=this.Parent.AttR}else{if(typeof(e)=="number"){d=e;e=null}}var a;if(e==null){this.GetIMDBIdx();if(this.ImdbIdx<0){return false}a=this.Parent.IMDB.Value(this.Parent.MstTblIndex,this.ImdbIdx,0)}else{a=e}var f=this.Values[d].Value;if(!a.equals(f)){var c=this.Values[d].SetNewValue(a);if((this.Flags&Glb.FLD_AUTOLOOKUP)!=0){for(var b=0;b<this.Parent.UQueries();b++){if(this.Parent.bQueries(b).FieldIndex==this.Index){this.Parent.bQueries(b).UpdateLookup(d,this.Parent.MainFrm);break}}}if(this.Parent.MainFrm!=null){this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",103,"PField.UpdateField","Row "+(d+1)+" Field "+this.Parent.GetDTTCaption()+"."+this.GetDTTCaption()+": value changed from "+f.toString()+" to "+a.toString())}if(this.Unbound&&this.Values[d].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.Queries[0].WriteUnboundValue(d,this)}if(!this.CauseValidation&&this.Values[d].Modified&&this.Parent.Status()!=Glb.PS_QBE){this.Values[d].Modified=false;c=false}return c}else{return false}};PFieldSrv.prototype.DeleteBlob=function(c){var a=this.Parent.bQueries(0).GetBlobData(this.Index,this.Values[this.Parent.AttR].Value.intValue());if(a!=null){this.Parent.bQueries(0).DeleteBlob(c,a);this.Values[this.Parent.AttR].RD3Change(RD3Glb.VAL_TEXT)}};PFieldSrv.prototype.ValidateCell=function(e){if(this.IdxPanel!=0){return}var b=this.Values[e].NotValidated;var d=this.Values[e].IsError();this.Values[e].ClearError();var f=this.Parent.bQueries(0).RecordCount();var a=this.Parent.bQueries(0).GetAttRecNumber()+e;if(this.Values[e].Modified||b||d||a>f){var c=new IDVariant();this.Parent.FireValidateCell(new IDVariant(this.Index),new IDVariant(this.Values[e].Modified),c,new IDVariant(this.Values[e].LastModified),new IDVariant(true),new IDVariant(a>f))}if((this.Flags&Glb.FLD_ISOPT)==0&&(IDL.IsNull(this.Values[e].Value))&&this.IsEnabled(e,false)&&!b&&(!this.Parent.bQueries(0).IsDO||this.IsExtended)){if(this.Parent.CanAddErrMsg(e,IDPanelSrv.EM_FIELD)){this.Values[e].SetError(this.Parent.MainFrm.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore"),IDDocument.ERR_ERROR)}if(this.Parent.CanAddErrMsg(e)){this.Parent.Parent.SetMessage(this,AMessageSrv.MSG_STOP,this.Values[e].GetErrorText(),"","VAL",(this.Parent.NumRows>1)?e+1:0,false);if(this.IsPresent()&&this.IsVisible(e)&&this.Parent.Parent.FocusPriority==0){this.Parent.SetInput(e,this.Index,1,false)}}this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,181,"PField.ValidateCell","Panel "+this.Parent.GetDTTCaption()+": error for field "+this.GetDTTCaption()+" at row "+(e+1)+" - "+this.Values[e].GetErrorText())}};PFieldSrv.prototype.GetVisualStyle=function(a){if(this.Values[a].VisualStyle==-1){return this.VisualStyle}else{return this.Values[a].VisualStyle}};PFieldSrv.prototype.IsVisible=function(b,a){if(a==undefined){a=true}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_VISIBLE)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_VISIBLE)==0){return false}}if((this.Flags&Glb.OBJ_VISIBLE)==0){return false}if(this.Values[b].Visible==-1||!a){return(this.Flags&Glb.OBJ_VISIBLE)!=0}else{return this.Values[b].Visible==1}};PFieldSrv.prototype.IsEnabled=function(c,b,d){if(b==undefined){b=false}if(d==undefined){d=false}if(this.IdxPanel<0&&!d){return false}if(this.IdxPanel>0&&!d){if(this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}}if(!this.IsVisible(c)){return false}if(this.Parent.Status()==Glb.PS_QBE){return(this.Parent.Flags&Glb.PAN_CANSELECT)!=0&&c==0&&this.QBEEnabled}var e=this.Parent.bQueries(0).RecordCount();var a=this.Parent.bQueries(0).GetAttRecNumber()+c;if(a>e&&(this.Parent.Flags&Glb.PAN_CANINSERT)==0&&!b){return false}if(a<=e&&(this.Parent.Flags&Glb.PAN_CANUPDATE)==0&&!b&&(!this.Parent.IsDO()||(this.Parent.GetDocument(c)!=null&&(!this.Parent.GetDocument(c).Inserted()||(this.Parent.Flags&Glb.PAN_CANINSERT)==0)))){return false}if(this.DataType==Glb.DT_DOC_OLE&&(a>e||this.Parent.iStatus!=Glb.PS_DATA)&&!b){return false}if(this.Unbound&&a>e&&!b){return false}if(this.Parent.Locked()&&this.CauseValidation){return false}if(this.Page!=-1){if((this.Parent.bPages(this.Page).Flags&Glb.OBJ_ENABLED)==0){return false}}if(this.Group!=-1){if((this.Parent.bGroups(this.Group).Flags&Glb.OBJ_ENABLED)==0){return false}}if((this.Flags&Glb.OBJ_ENABLED)==0){return false}if(this.Values[c].Enabled==-1){return(this.Flags&Glb.OBJ_ENABLED)!=0}else{return this.Values[c].Enabled==1}};PFieldSrv.prototype.IsEnabledButton=function(){if(this.IdxPanel>=0){return false}if((this.Flags&Glb.OBJ_ENABLED)==0&&(this.Flags&Glb.FLD_NOACTD)!=0){return false}if(this.Parent.VS.ControlType(this.VisualStyle)==Glb.VISCTRL_BUTTON){return true}return false};PFieldSrv.prototype.ResetDynProp=function(){for(var a=0;a<this.Values.length;a++){this.Values[a].ClearDynProp()}};PFieldSrv.prototype.CanActivate=function(b,d){if(d==undefined){d=true}var c=this.IsEnabled(b,false,true);if((this.Flags&Glb.FLD_NOACTD)!=0&&!c){return false}if((this.VisFlags(b)&Glb.FL_VIS_HYPERLINK)!=0){return true}if((this.Flags&Glb.FLD_CANACTIVATE)!=0){return true}if(c&&d){for(var a=0;a<this.Parent.UQueries();a++){if(this.Parent.bQueries(a).FieldIndex==this.Index&&(this.Flags&Glb.FLD_AUTOLOOKUP)==0){return true}}}return false};PFieldSrv.prototype.CouldActivate=function(b){if((this.VisFlags(b)&Glb.FL_VIS_HYPERLINK)!=0){return true}if((this.Flags&Glb.FLD_CANACTIVATE)!=0){return true}for(var a=0;a<this.Parent.UQueries();a++){if(this.Parent.bQueries(a).FieldIndex==this.Index&&(this.Flags&Glb.FLD_AUTOLOOKUP)==0){return true}}return false};PFieldSrv.prototype.Activate=function(f){if(this.IsEnabled(f,false)&&(this.Flags&Glb.FLD_CANACTIVATE)==0){for(var g=0;g<this.Parent.UQueries();g++){if(this.Parent.bQueries(g).FieldIndex==this.Index){this.QueryValueSource=this.Parent.bQueries(g);this.Values[f].RD3Change(RD3Glb.VAL_VALUELIST);return}}}if(this.Parent.MainFrm!=null){this.Parent.MainFrm.ActivedDocument=null;this.Parent.MainFrm.ActivedProperty=null;this.Parent.MainFrm.ActivedExtProperty=null}var m=this.Parent.GetDocument(f);if(m!=null&&this.Parent.MainFrm!=null&&this.IdxPanel>=0){this.Parent.MainFrm.ActivedDocument=m;var c=m.GetMD();var k=null;if(this.IdxPanel==0){if(this.GetDOIdx(m)>0){k=c.GetProp(this.GetDOIdx(m));this.Parent.MainFrm.ActivedProperty=k}}else{var l=this.Parent.bQueries(this.IdxPanel).GetMstField();if(l!=null&&l.GetDOIdx(m)>0){k=c.GetProp(l.GetDOIdx(m));this.Parent.MainFrm.ActivedProperty=k}}if(k!=null){if(k.ExtPropIdx>0){var j=null;try{j=m.GetExtSchema()}catch(h){WriteToConsoleError(h)}var b=j.GetProp(k.ExtPropIdx);if(j!=null){this.Parent.MainFrm.ActivedExtProperty=b}if(b.Lookup!=null&&b.Lookup.length>0){this.Parent.MainFrm.Show(b.Lookup,1,this.Parent.Parent);return}}}}var o=new IDVariant();this.Parent.FireCellActivated(new IDVariant(this.Index),o);if(o.isFalse()&&(this.VisFlags(f)&Glb.FL_VIS_HYPERLINK)!=0){var a="";if(this.IdxPanel==-1){a=this.Header}else{a=this.Values[f].Text}if(a.indexOf("://")>0){this.Parent.MainFrm.set_RedirectTo(new IDVariant(a));this.Parent.MainFrm.set_RedirectNewWindow(this.Parent.Parent.MainFrm.ShiftKey())}}};PFieldSrv.prototype.Colors=function(a,b){return this.Parent.VS.Color(this.GetVisualStyle(b),a)};PFieldSrv.prototype.GradColor=function(a,b){if(this.Colors(a,b)!=-1){return this.Parent.VS.GradCol(this.GetVisualStyle(b),a)}else{return -1}};PFieldSrv.prototype.GradDir=function(a,b){return this.Parent.VS.GradDir(this.GetVisualStyle(b),a)};PFieldSrv.prototype.Opacity=function(a,b){return this.Parent.VS.Opacity(this.GetVisualStyle(b),a)};PFieldSrv.prototype.Fonts=function(a,b){return this.Parent.VS.Font(this.GetVisualStyle(b),a)};PFieldSrv.prototype.AutoAlign=function(a){return this.Parent.VS.Alignment(this.GetVisualStyle(a),Glb.VISALI_VALUE)==Glb.VISALN_AUTO};PFieldSrv.prototype.CtrlType=function(a){return this.Parent.VS.ControlType(this.GetVisualStyle(a))};PFieldSrv.prototype.VisFlags=function(a){return this.Parent.VS.Flags(this.GetVisualStyle(a))};PFieldSrv.prototype.HdrFormStyle=function(a){return Glb.WebBorderStyle(this.Parent.VS.BorderType(this.GetVisualStyle(a),Glb.VISBDI_HDRFORM),false)};PFieldSrv.prototype.IsRightAligned=function(c,a){var b;if(c==-1){b=this.Parent.VS.Alignment(this.VisualStyle,(a)?Glb.VISALI_HDRFORM:Glb.VISALI_HDRLIST)}else{b=this.Parent.VS.Alignment(this.GetVisualStyle(c),Glb.VISALI_VALUE)}if(b==Glb.VISALN_AUTO){if(Glb.ClassDT(this.DataType)==Glb.DTC_NUMBER&&((this.Flags&Glb.FLD_AUTOLOOKUP)==0)){b=Glb.VISALN_DX}else{b=Glb.VISALN_SX}}return(b==Glb.VISALN_DX)};PFieldSrv.prototype.ToString=function(){return this.Header};PFieldSrv.prototype.GetClientMask=function(g,v,w,A,u,f,a,k){var x;var q;if(this.Parent.MainFrm.ParamsObj().UseClientMask){if((this.Parent.Status()==Glb.PS_QBE||(this.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&("=<>".indexOf(A)==-1||A.length==0)){g.set(new IDVariant(u));v.set(new IDVariant(""))}else{switch(Glb.ClassDT(this.DataType)){case Glb.DTC_CHAR:f.set(new IDVariant("A"));x=A;if(A.equals(">")){g.set(new IDVariant(u.toUpperCase()));v.set(new IDVariant(A))}else{if(A.equals("<")){g.set(new IDVariant(u.toLowerCase()));v.set(new IDVariant(A))}else{if(A.length>0){var o=x.charAt(x.length-1);if(k&&(o=="A"||o=="a"||o=="&"||o=="#")){while(x.length<this.MaxLength){x+=o}}if(x.length>this.MaxLength){x=x.remove(this.MaxLength,x.length-this.MaxLength)}q=x;var r=0;var b=true;for(var t=0;t<q.length;t++){var m=q.charAt(t);if(m=="A"||m=="a"||m=="&"||m=="#"){if(r>=u.length){q=q.remove(t,q.length-t);break}q=q.substr(0,t)+u.charAt(r)+q.substr(t+1);r++;b=false}else{if(b&&r<u.length){if(q.charAt(t)==u.charAt(r)){r++}else{r=0;b=false}}else{if(!b&&r<u.length){if(q.charAt(t)==u.charAt(r)){r++}}else{q=q.remove(t,q.length-t);break}}}}g.set(new IDVariant(q));v.set(new IDVariant(x))}else{g.set(new IDVariant(u))}}}break;case Glb.DTC_DATE:f.set(new IDVariant("D"));if(A.length>0){v.set(new IDVariant(A))}else{switch(this.DataType){case Glb.DT_DATE:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultDateMask));break;case Glb.DT_TIME:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultTimeMask));break;case Glb.DT_DATETIME:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultDateMask+" "+this.Parent.MainFrm.ParamsObj().DefaultTimeMask));break}}if(v.stringValue().length==0){g.set(new IDVariant(u))}else{g.set(IDL.Format(w,v,this.Parent.MainFrm))}break;case Glb.DTC_NUMBER:f.set(new IDVariant("N"));if(A.length>0){v.set(new IDVariant(A))}else{switch(this.DataType){case Glb.DT_NUM_CURRENCY:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FIXED:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FLOAT:v.set(new IDVariant(this.Parent.MainFrm.ParamsObj().DefaultFloatMask));break;case Glb.DT_NUM_INTEGER:v.set(IDL.Add(IDL.Replicate(new IDVariant("#"),new IDVariant(this.MaxLength-1)),new IDVariant("0")));break}}if(v.stringValue().length==0){g.set(new IDVariant(u))}else{x=v.stringValue();var y=-1;var d=-1;var h=x.indexOf(".");switch(this.DataType){case Glb.DT_NUM_CURRENCY:y=this.MaxLength;if(h>-1){d=x.length-h-1}break;case Glb.DT_NUM_FIXED:y=this.MaxLength;d=this.vScale;break;case Glb.DT_NUM_INTEGER:y=this.MaxLength;d=0;break}var s=y-d;var c=0;if(s>0){if(h==-1){h=x.length}for(var e=h-1;e>=0;e--){if(x.charAt(e)=="0"||x.charAt(e)=="#"){c++;if(c==s){if(e>0){x=x.remove(0,e)}break}}}}h=x.indexOf(".");if(h>-1&&d>=0){s=d;if(s==0){x.length=h}else{c=0;for(var e=h+1;e<x.length;e++){if(x.charAt(e)=="0"||x.charAt(e)=="#"){c++;if(c==s){x.length=e+1;break}}}}}v.set(new IDVariant(x));g.set(IDL.Format(w,v,this.Parent.MainFrm));for(var e=0;e<x.length;e++){if(x.charAt(e)=="."){break}if(x.charAt(e)=="0"){x=x.substr(0,e)+"#"+x.substr(e+1)}}if(!this.Parent.MainFrm.ParamsObj().UseDecimalDot){h=x.indexOf(".");x.replace(",",".");if(h>=0){x=x.substr(0,h)+","+x.substr(h+1)}}v.set(new IDVariant(x))}break}if(a){g.set(new IDVariant(u))}}}else{if(this.Parent.Status()!=Glb.PS_QBE&&A.length>0){g.set(IDL.Format(w,new IDVariant(A),this.Parent.MainFrm))}else{g.set(new IDVariant(u))}v.set(new IDVariant(""))}};PFieldSrv.prototype.GetDTTCaption=function(){if(!this.Header.equals("")){return this.Header}else{if(this.AbbrHeaderList.length>this.AbbrHeaderForm.length){return this.AbbrHeaderList}else{return this.AbbrHeaderForm}}};PFieldSrv.prototype.UpdateSubFrame=function(){if(this.SubFrame<1||this.Parent.Parent==null){return}var a=this.Parent.Parent.Frames[this.SubFrame];a.Exposed=this.IsVisible(0)&&this.IsPresent();if(a.Width==0){a.Width=this.FormWidth-20;a.Height=this.FormHeight-20;a.RD3Change(RD3Glb.AFR_WIDTH);a.RD3Change(RD3Glb.AFR_HEIGHT)}if(a.Content!=null){a.Content.set_Exposed(this.IsVisible(0)&&this.IsPresent())}};PFieldSrv.prototype.IsReadOnly=function(a,b){if(this.Parent.MainFrm.ParamsObj().UseFK||this.Parent.MainFrm.ParamsObj().UseRD3){if((this.Flags&Glb.OBJ_ENABLED)==0||this.IdxPanel<0){return false}if(this.Parent.Status()==Glb.PS_QBE&&b>0){return false}if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){return false}if((this.Parent.VS.Flags(a)&Glb.FL_VIS_HYPERLINK)==0){return true}}return false};PFieldSrv.prototype.GetRD2Text=function(f){var e;var l=new IDVariant();var c=new IDVariant();var k=new IDVariant();var g;if(this.Parent.PanelMode==Glb.PANEL_LIST){g=this.ListNumRow>1}else{g=this.FormNumRow>1}var b=this.GetVisualStyle(f);var h=this.CtrlType(f);if(h==Glb.VISCTRL_CHECK&&this.ValueList.Count()>0){if(this.Values[f].ValueListIndexes.length>0&&this.Values[f].ValueListIndexes[0]==this.ValueList[0]){e="on"}else{e="no"}}else{if(this.ValueList.Count()>0&&(h==Glb.VISCTRL_COMBO||h==Glb.VISCTRL_AUTO)&&!this.IsEnabled(f)){e=this.GetDisabledComboHtml(f)}else{if(this.IsEnabled(f)&&(this.Flags&Glb.FLD_AUTOLOOKUP)!=0&&(this.Flags&Glb.FLD_CANACTIVATE)==0){e=this.Values[f].Value.toString()}else{var d=(this.Parent.VS.Flags(b)&Glb.FL_VIS_PASSWORD)!=0;if(d){e=IDL.Replicate(new IDVariant("*"),new IDVariant(this.Values[f].Text.length)).stringValue()}else{var a=this.Parent.VS.Mask(b);var j=true;if(!this.Values[f].DynMask.equals("")){a=this.Values[f].DynMask;j=false}else{if(!this.Mask.equals("")){a=this.Mask;j=false}}if(!a.equals("=")&&this.EditorType!=1){this.GetClientMask(l,c,this.Values[f].Value,a,this.Values[f].Text,k,this.Values[f].DynText,j);e=l.stringValue();this.Values[f].Text=e;this.Values[f].Mask=c.stringValue()}else{e=this.Values[f].Text}if(!this.IsEnabled(f)&&(!this.IsReadOnly(b,f)||g)){if(!a.equals("=")&&this.EditorType!=1){e=Glb.HTMLEncode(e);e=PFieldSrv.EncodeMultiLineSpaces(e);e=e.replace(/\r\n/g,"<br>");e=e.replace(/\r/g,"<br>");e=e.replace(/\n/g,"<br>")}}}}}}return e};PFieldSrv.prototype.Resize=function(c,b,f){var d;if(f==Glb.PANEL_LIST){d=(this.Flags&Glb.FLD_INLIST)!=0&&(this.Flags&Glb.FLD_LISTLIST)==0}else{d=(this.Flags&Glb.FLD_INFORM)!=0}if(d&&this.HResMode[f]==Glb.RESMODE_MOVE){if(f==Glb.PANEL_LIST){this.ListLeft=this.ListLeft+c;this.RD3Change(RD3Glb.FLD_LISTLEFT)}else{this.FormLeft=this.FormLeft+c;this.RD3Change(RD3Glb.FLD_FORMLEFT)}}if(d&&this.HResMode[f]==Glb.RESMODE_STRETCH){if(f==Glb.PANEL_LIST){this.ListWidth=this.ListWidth+c;this.RD3Change(RD3Glb.FLD_LISTWIDTH)}else{this.FormWidth=this.FormWidth+c;this.RD3Change(RD3Glb.FLD_FORMWIDTH)}}if(d&&this.VResMode[f]==Glb.RESMODE_MOVE){if(f==Glb.PANEL_LIST){this.ListTop=this.ListTop+b;this.RD3Change(RD3Glb.FLD_LISTTOP)}else{this.FormTop=this.FormTop+b;this.RD3Change(RD3Glb.FLD_FORMTOP)}}if(d&&this.VResMode[f]==Glb.RESMODE_STRETCH){if(f==Glb.PANEL_LIST){this.ListHeight=this.ListHeight+b;this.RD3Change(RD3Glb.FLD_LISTHEIGHT)}else{this.FormHeight=this.FormHeight+b;this.RD3Change(RD3Glb.FLD_FORMHEIGHT)}}if(this.SubFrame!=0&&(this.VResMode[f]==Glb.RESMODE_STRETCH||this.HResMode[f]==Glb.RESMODE_STRETCH)){var e=0;var a=0;if(f==Glb.PANEL_LIST){e=this.ListWidth-20;a=this.ListHeight-38}else{e=this.FormWidth-20;a=this.FormHeight-38}this.Parent.Parent.Frames[this.SubFrame].Content.Resize(e,a)}};PFieldSrv.prototype.CanResizeList=function(a,b){if(this.Page!=-1&&this.Page!=b){return false}if((this.Flags&Glb.OBJ_VISIBLE)==0){return false}if((this.Flags&Glb.FLD_INLIST)==0){return false}if((this.Flags&Glb.FLD_LISTLIST)==0){return false}if(this.HResMode[Glb.PANEL_LIST]!=Glb.RESMODE_STRETCH){return false}if(this.ListWidth<=48&&a<0){return false}return true};PFieldSrv.EncodeMultiLineSpaces=function(b){var f=b;var e=true;var a=true;for(var c=0;c<f.length;c++){var d=f.charAt(c);if(d==" "){if(!a){a=true}else{f=f.remove(c,1);f=f.insert(c,"&nbsp;");c+=5}}else{e=(d=="\r"||d=="\n");a=e}}return f};PFieldSrv.prototype.ExtendLookup=function(e,a){var d=this.Parent.Queries[this.IdxPanel].GetMstField();if(d!=null&&this.flLookupExtended!=a){this.flLookupExtended=a;var g=this.FormLeft;var b=this.HeaderSize[Glb.PANEL_FORM];var c=this.AbbrHeaderForm;this.FormWidth=this.FormWidth+this.FormLeft-d.FormLeft;this.FormLeft=d.FormLeft;this.HeaderSize[Glb.PANEL_FORM]=d.HeaderSize[Glb.PANEL_FORM];this.AbbrHeaderForm=d.AbbrHeaderForm;d.FormLeft=g;d.HeaderSize[Glb.PANEL_FORM]=b;d.AbbrHeaderForm=c;this.Parent.SetFlags(Glb.OBJ_FIELD,this.Index,a?0:Glb.FLD_NOHDRFORM,Glb.FLD_NOHDRFORM)}var f=this.Parent.Queries[this.IdxPanel];f.ExtendLookup(e)};PFieldSrv.prototype.EnterUploadMode=function(a){if(a==undefined){a=true}if(this.DataType==Glb.DT_DOC_OLE){if(this.bValues(this.Parent.AttR).Uploading!=a){this.Parent.Parent.ResetUpload();this.Parent.Parent.UploadingPanel=(a?this.Parent:null);this.bValues(this.Parent.AttR).Uploading=a;this.bValues(this.Parent.AttR).RD3Change(RD3Glb.VAL_TEXT)}}};PFieldSrv.prototype.GetRD3Name=function(){return"fld"};PFieldSrv.prototype.GetRD3Ident=function(b,a){if(b==undefined&&a==undefined){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx}if(a||this.IdxPanel==-1){return this.GetRD3Ident()+(this.Parent.Layout()==Glb.PANEL_FORM?":fc":":lc")}else{if(this.Parent.Layout()==Glb.PANEL_FORM){return this.GetRD3Ident()+":fv"}else{if(b<0||b>=this.Parent.NumRows){b=this.Parent.SelectedRow()}return this.GetRD3Ident()+":lv"+b}}};PFieldSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PFieldSrv.prototype.RD3RenderDifference=function(f,j,d){if(!d&&j&&this.Index==0){d=true}if(!d&&this.Parent.MainFrm.RD3CanOWA){d=true}if(!d&&(this.Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))==0){return false}if(this.CalculateMask&&this.Parent.Status()!=Glb.PS_QBE){this.CalculateMask=false;for(var g=0;g<this.Values.length;g++){this.GetRD2Text(g)}}var b=null;if(j){b=f.AddNewElement(this.GetRD3Name())}if(b==null&&this.RD3Changed){b=f.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var h=this.RD3Changed;if(j||this.RD3Changed){for(var e=0;e<this.RD3PropChg.length;e++){if(this.RD3PropChg[e]||j){this.SetRD3Property(e,b,j)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(j){if(this.MultiUpload){b.SetAttribute("mup",(this.MultiUpload?"1":"0"))}if(this.MaxUploadSize!=(10*1024*1024)){b.SetAttribute("mus",this.MaxUploadSize.toString())}if(this.MaxUploadFiles!=0){b.SetAttribute("muf",this.MaxUploadFiles.toString())}if(!this.UploadExtensions.equals("")){b.SetAttribute("uex",this.UploadExtensions)}if(!this.UploadDescription.equals("")){b.SetAttribute("uds",this.UploadDescription)}if(this.HasConcept("DO_ID")){b.SetAttribute("cvs"," ")}var k=this.ChangeEventDef;if((this.Flags&Glb.FLD_ACTIVE)!=0){k|=RD3Glb.EVENT_IMMEDIATE}if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ClickEventDef.toString())}if(k!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){b.SetAttribute("chg",k.toString())}if(this.Parent.MainFrm.RD3CanOWA&&!this.Parent.IsIMDB()){b.SetAttribute("dbc",this.Code);if((this.Flags&Glb.FLD_ISKEY)!=0){b.SetAttribute("ipk","1")}}}var c=(j)?b:f;var a=(d||(this.Parent.PanelMode==Glb.PANEL_LIST&&(this.Flags&Glb.FLD_INLIST)!=0)||(this.Parent.PanelMode==Glb.PANEL_FORM&&(this.Flags&Glb.FLD_INFORM)!=0));if(this.IdxPanel>-1&&a){if(j&&this.Parent.Status()==Glb.PS_QBE){h|=this.Values[0].RD3RenderDifferences(c,j)}else{for(var e=0;e<this.Values.length;e++){h|=this.Values[e].RD3RenderDifferences(c,j)}}}return h};PFieldSrv.prototype.SetRD3Property=function(o,u,k){switch(o){case RD3Glb.FLD_INDEX:u.SetAttribute("idx",this.Index.toString());break;case RD3Glb.FLD_VISIBLE:if((this.Flags&Glb.OBJ_VISIBLE)!=0&&k){break}u.SetAttribute("vis",((this.Flags&Glb.OBJ_VISIBLE)!=0)?"1":"0");break;case RD3Glb.FLD_ENABLED:var j=(this.Flags&Glb.OBJ_ENABLED)!=0;if(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams==null){j=false}if(j&&k){break}u.SetAttribute("ena",j?"1":"0");break;case RD3Glb.FLD_VISATTR:u.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.FLD_LISTLIST:if((this.Flags&Glb.FLD_LISTLIST)!=0&&k){break}u.SetAttribute("lli",((this.Flags&Glb.FLD_LISTLIST)!=0)?"1":"0");break;case RD3Glb.FLD_CANACTIVATE:if((this.Flags&Glb.FLD_CANACTIVATE)==0&&k){break}u.SetAttribute("act",((this.Flags&Glb.FLD_CANACTIVATE)!=0)?"1":"0");break;case RD3Glb.FLD_ACTIVABLEDISABLED:if((this.Flags&Glb.FLD_NOACTD)!=0&&k){break}u.SetAttribute("acd",((this.Flags&Glb.FLD_NOACTD)==0)?"1":"0");break;case RD3Glb.FLD_QVS:var h=false;if((this.Flags&Glb.FLD_AUTOLOOKUP)==0){for(var g=0;g<this.Parent.UQueries();g++){if(this.Parent.bQueries(g).FieldIndex==this.Index){h=true;break}}}else{u.SetAttribute("alo","1")}if(!h&&k){break}u.SetAttribute("qvs",h?"1":"0");break;case RD3Glb.FLD_ACTWIDTH:if(this.ActWidth==-9999&&k){break}u.SetAttribute("acw",this.ActWidth.toString());break;case RD3Glb.FLD_ACTIMAGE:if((this.ActImg==null||this.ActImg.equals(""))&&k){break}u.SetAttribute("aci",(this.ActImg==null)?"":this.ActImg.toString());break;case RD3Glb.FLD_OPTIONAL:if((this.Flags&Glb.FLD_ISOPT)!=0&&k){break}u.SetAttribute("opt",((this.Flags&Glb.FLD_ISOPT)!=0)?"1":"0");break;case RD3Glb.FLD_IMAGE:if(this.Image.length==0&&k){break}u.SetAttribute("img",this.Image);break;case RD3Glb.FLD_IMGRESMODE:if(this.ImageResMode==1&&k){break}u.SetAttribute("irm",this.ImageResMode.toString());break;case RD3Glb.FLD_HEADER:var q;if(this.Parent.VS.Mask(this.VisualStyle).length>0&&this.IdxPanel<0){q=IDL.Format(new IDVariant(this.Header),new IDVariant(this.Parent.VS.Mask(this.VisualStyle)),this.Parent.MainFrm).stringValue()}else{q=this.Header}if(q.length==0&&k){break}u.SetAttribute("hdr",q);break;case RD3Glb.FLD_TOOLTIP:if(this.Tooltip.length==0&&k){break}u.SetAttribute("tip",this.Tooltip);break;case RD3Glb.FLD_PAGE:if(this.Page==0&&k){break}u.SetAttribute("pag",this.Page.toString());break;case RD3Glb.FLD_GROUP:if(this.Group==-1&&k){break}if(this.Group!=-1){u.SetAttribute("gru",""+this.Parent.Groups[this.Group].GetRD3Ident())}break;case RD3Glb.FLD_DATATYPE:u.SetAttribute("dat",this.DataType.toString());break;case RD3Glb.FLD_MAXLENGTH:if(this.MaxLength==255&&k){break}u.SetAttribute("max",this.MaxLength.toString());break;case RD3Glb.FLD_SORTMODE:if(this.SortMode==0&&k){break}u.SetAttribute("smo",this.SortMode.toString());break;case RD3Glb.FLD_INLIST:if((this.Flags&Glb.FLD_INLIST)!=0&&k){break}u.SetAttribute("inl",((this.Flags&Glb.FLD_INLIST)!=0)?"1":"0");break;case RD3Glb.FLD_LISTHEADER:if(this.AbbrHeaderList.length==0&&k){break}u.SetAttribute("lih",this.AbbrHeaderList);break;case RD3Glb.FLD_HDRLIST:if((this.Flags&Glb.FLD_NOHDRLIST)==0&&k){break}u.SetAttribute("hdl",((this.Flags&Glb.FLD_NOHDRLIST)==0)?"1":"0");break;case RD3Glb.FLD_HDRLISTABOVE:if((this.Flags&Glb.FLD_VERTHDRLIST)==0&&k){break}u.SetAttribute("hla",((this.Flags&Glb.FLD_VERTHDRLIST)!=0)?"1":"0");break;case RD3Glb.FLD_LISTLEFT:if(this.ListLeft==0&&k){break}u.SetAttribute("lle",this.ListLeft.toString());break;case RD3Glb.FLD_LISTTOP:if(this.ListTop==0&&k){break}u.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.FLD_LISTWIDTH:if(this.ListWidth==0&&k){break}u.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.FLD_LISTHEIGHT:if(this.ListHeight==0&&k){break}u.SetAttribute("lhe",this.ListHeight.toString());break;case RD3Glb.FLD_LISTHDRSIZE:if((this.HeaderSize[Glb.PANEL_LIST]==0||((this.Flags&Glb.FLD_INLIST)!=0&&(this.Flags&Glb.FLD_LISTLIST)!=0))&&k){break}u.SetAttribute("lhs",this.HeaderSize[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_LISTNUMROWS:if(this.ListNumRow==0&&k){break}u.SetAttribute("lnr",this.ListNumRow.toString());break;case RD3Glb.FLD_LISTHRESMODE:if(this.HResMode[Glb.PANEL_LIST]==1&&k){break}u.SetAttribute("lhr",this.HResMode[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_LISTVRESMODE:if(this.VResMode[Glb.PANEL_LIST]==1&&k){break}u.SetAttribute("lvr",this.VResMode[Glb.PANEL_LIST].toString());break;case RD3Glb.FLD_INFORM:if((this.Flags&Glb.FLD_INFORM)!=0&&k){break}u.SetAttribute("inf",((this.Flags&Glb.FLD_INFORM)!=0)?"1":"0");break;case RD3Glb.FLD_FORMHEADER:if(this.AbbrHeaderForm.length==0&&k){break}u.SetAttribute("foh",this.AbbrHeaderForm);break;case RD3Glb.FLD_HDRFORM:if((this.Flags&Glb.FLD_NOHDRFORM)==0&&k){break}u.SetAttribute("hdf",((this.Flags&Glb.FLD_NOHDRFORM)==0)?"1":"0");break;case RD3Glb.FLD_HDRFORMABOVE:if((this.Flags&Glb.FLD_VERTHDRFORM)==0&&k){break}u.SetAttribute("hfa",((this.Flags&Glb.FLD_VERTHDRFORM)!=0)?"1":"0");break;case RD3Glb.FLD_FORMLEFT:if(this.FormLeft==0&&k){break}u.SetAttribute("fle",this.FormLeft.toString());break;case RD3Glb.FLD_FORMTOP:if(this.FormTop==0&&k){break}u.SetAttribute("fto",this.FormTop.toString());break;case RD3Glb.FLD_FORMWIDTH:if(this.FormWidth==0&&k){break}u.SetAttribute("fwi",this.FormWidth.toString());break;case RD3Glb.FLD_FORMHEIGHT:if(this.FormHeight==0&&k){break}u.SetAttribute("fhe",this.FormHeight.toString());break;case RD3Glb.FLD_FORMHDRSIZE:if(this.HeaderSize[Glb.PANEL_FORM]==0&&k){break}u.SetAttribute("fhs",this.HeaderSize[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_FORMNUMROWS:if(this.FormNumRow==0&&k){break}u.SetAttribute("fnr",this.FormNumRow.toString());break;case RD3Glb.FLD_FORMHRESMODE:if(this.HResMode[Glb.PANEL_FORM]==1&&k){break}u.SetAttribute("fhr",this.HResMode[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_FORMVRESMODE:if(this.VResMode[Glb.PANEL_FORM]==1&&k){break}u.SetAttribute("fvr",this.VResMode[Glb.PANEL_FORM].toString());break;case RD3Glb.FLD_IDXPANEL:if(this.IdxPanel==0&&k){break}u.SetAttribute("idp",this.IdxPanel.toString());break;case RD3Glb.FLD_SUBFRAME:if(this.SubFrame==0&&k){break}u.SetAttribute("sub",this.Parent.Parent.Frames[this.SubFrame].Content.GetRD3Ident());break;case RD3Glb.FLD_TABORDER:if(this.Parent.IsAdvTabOrderEnabled()){u.SetAttribute("lta",this.Parent.GetFieldIdxTabOrder(this.Index,Glb.PANEL_LIST).toString());u.SetAttribute("fta",this.Parent.GetFieldIdxTabOrder(this.Index,Glb.PANEL_FORM).toString())}break;case RD3Glb.FLD_VALUELIST:if(this.ValueList.Count()==0&&k){break}var a=u.AddNewElement("vls");if(this.ValueList.Count()>0){for(var g=0;g<this.ValueList.Count();g++){this.ValueList[g].RD3RenderDifference(a,k,this.Parent.MainFrm)}}else{a.SetAttribute("del","1")}break;case RD3Glb.FLD_EDITORTYPE:if(this.EditorType==0&&k){break}u.SetAttribute("edi",this.EditorType.toString());break;case RD3Glb.FLD_SCALE:if(this.vScale==0&&k){break}u.SetAttribute("fsc",this.vScale.toString());break;case RD3Glb.FLD_CMDIDX:if(this.CmdIdx==0&&k){break}u.SetAttribute("cmd","cmd:"+this.CmdIdx);break;case RD3Glb.FLD_CAUSEVALIDATION:if(this.CauseValidation&&k){break}u.SetAttribute("cva",this.CauseValidation?"1":"0");break;case RD3Glb.FLD_CANSORT:var l=(this.IdxPanel==0||this.SortFld!=-1)&&this.DataType!=Glb.DT_DOC_OLE;if(l&&k){break}u.SetAttribute("srt",l?"1":"0");break;case RD3Glb.FLD_LKE:var j=(this.IdxPanel>0&&this.Parent.Queries[this.IdxPanel].LKEParams!=null);if(!j&&k){break}u.SetAttribute("lke",j?"1":"0");break;case RD3Glb.FLD_QBEENAB:if(this.QBEEnabled&&k){break}u.SetAttribute("qen",this.QBEEnabled?"1":"0");break;case RD3Glb.FLD_SUPERACTIVE:if((this.Flags&Glb.FLD_SUPERACTIVE)==0&&k){break}u.SetAttribute("sac",((this.Flags&Glb.FLD_SUPERACTIVE)!=0)?"1":"0");break;case RD3Glb.FLD_USEHL:if(!this.UseHilight&&k){break}u.SetAttribute("uhl",this.UseHilight?"1":"0");break;case RD3Glb.FLD_VISPROP:if(this.iVisualFlags==-1&&k){break}u.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.FLD_UNBOUND:if(!this.Unbound&&k){break}u.SetAttribute("unb",this.Unbound?"1":"0");break;case RD3Glb.FLD_COMBOMULTISEL:if(this.MultiSelectionComboBox()&&k){break}u.SetAttribute("cms",this.MultiSelectionComboBox()?"1":"0");break;case RD3Glb.FLD_USETEXTSELECTION:if(!this.UseTextSelection()&&k){break}u.SetAttribute("uts",this.UseTextSelection()?"1":"0");break;case RD3Glb.FLD_BACKCOLOR:if(this.BackColor==-2&&k){break}u.SetAttribute("bkc",(this.BackColor==-2?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.FLD_FORECOLOR:if(this.ForeColor==-2&&k){break}u.SetAttribute("frc",(this.ForeColor==-2?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.FLD_MASK:if(this.Mask.length==0&&k){break}u.SetAttribute("msk",this.Mask);break;case RD3Glb.FLD_FONTMOD:if(this.FontMod.length==0&&k){break}u.SetAttribute("ftm",this.FontMod);break;case RD3Glb.FLD_ALIGN:if(this.Alignment==-1&&k){break}u.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.FLD_WATERMARK:if(this.iWaterMark.equals("")&&k){break}u.SetAttribute("wtm",this.iWaterMark);break;case RD3Glb.FLD_OPENCOMBO:if(k){break}u.SetAttribute("ocb","1");break;case RD3Glb.FLD_BADGE:if(this.iBadge.length==0&&k){break}u.SetAttribute("bdg",this.iBadge);break;case RD3Glb.FLD_EDCOLORS:if((this.ColorList==null)||(this.ColorList.Count()==0&&k)){break}var p=u.AddNewElement("cls");if(this.ColorList.Count()>0){for(var f=0;f<this.ColorList.Count();f++){p.SetAttribute("col"+f,this.ColorList.Get(f))}}else{p.SetAttribute("del","1")}break;case RD3Glb.FLD_EDFONTS:if((this.FontList==null)||(this.FontList.Count()==0&&k)){break}var m=u.AddNewElement("fls");if(this.FontList.Count()>0){for(var d=0;d<this.FontList.Count();d++){var s=this.FontList.Get(d);s.RD3RenderDifference(m,k,this.Parent.MainFrm)}}else{m.SetAttribute("del","1")}break;case RD3Glb.FLD_EDTOKENS:if((this.TokenList==null)||(this.TokenList.Count()==0&&k)){break}var r=u.AddNewElement("tks");if(this.TokenList.Count()>0){for(var d=0;d<this.TokenList.Count();d++){var c=this.TokenList.Get(d);c.RD3RenderDifference(r,k,this.Parent.MainFrm)}}else{r.SetAttribute("del","1")}break;case RD3Glb.FLD_EDTOOLBAR:if(this.ShowEditorToolbar()&&k){break}u.SetAttribute("uet",this.ShowEditorToolbar()?"1":"0");break;case RD3Glb.FLD_EDCOMMANDS:if(this.iToolCommandEnabled==-1&&k){break}u.SetAttribute("itc",this.iToolCommandEnabled.toString());break;case RD3Glb.FLD_DEFFORMAT:if(this.iDefaultFormatting==""&&k){break}u.SetAttribute("def",this.iDefaultFormatting);break}};PFieldSrv.prototype.RD3Resize=function(b){var a=b.GetAttribute("obn");if(a.equals("list")){this.ListWidth=parseInt(b.GetAttribute("par1"),10);this.ListHeight=parseInt(b.GetAttribute("par2"),10);this.ListLeft=parseInt(b.GetAttribute("par3"),10);this.ListTop=parseInt(b.GetAttribute("par4"),10);this.UserChangedField=false}if(a.equals("form")){this.FormWidth=parseInt(b.GetAttribute("par1"),10);this.FormHeight=parseInt(b.GetAttribute("par2"),10);this.FormLeft=parseInt(b.GetAttribute("par3"),10);this.FormTop=parseInt(b.GetAttribute("par4"),10)}};PFieldSrv.prototype.ClearLastValue=function(){if(this.IdxPanel!=-1){for(var a=0;a<this.Values.length;a++){this.Values[a].LastModified=false}}};PFieldSrv.prototype.VisualFlag=function(a){return((this.iVisualFlags&a)!=0)};PFieldSrv.prototype.set_VisualFlag=function(a,b){if((this.iVisualFlags&a)!=(b?a:0)){this.iVisualFlags=(this.iVisualFlags&(~a))|(b?a:0);this.RD3Change(RD3Glb.FLD_VISPROP);if(a==Glb.FLDVISPROP_ONEACHKEY){this.Parent.SetFieldSuperActive(this.Index,b)}if(a==Glb.FLDVISPROP_SHOWACT&&!b){this.Parent.SetFieldActivator(this.Index,-1)}}};PFieldSrv.prototype.MultiSelectionComboBox=function(){return this.iMultiSelectionComboBox};PFieldSrv.prototype.set_MultiSelectionComboBox=function(a){if(this.iMultiSelectionComboBox!=a){this.iMultiSelectionComboBox=a;this.RD3Change(RD3Glb.FLD_COMBOMULTISEL)}};PFieldSrv.prototype.HasConcept=function(c){if(!this.Parent.IsDO()){return(c.equals("DO_ID")&&this.DataType==Glb.DT_CHAR_FIXED&&this.MaxLength==20)}if(this.IdxPanel!=0){return false}var j=this.Parent.bQueries(0).DocTempl;if(j==null){try{var f=(this.Parent.MainFrm.CompNameSpace!=null?this.Parent.MainFrm.CompNameSpace+".":"")+this.Parent.bQueries(0).MstTableName;try{j=(new Function("return new "+f+"();"))();if(j&&!(j instanceof IDDocument)){j=null}}catch(b){}if(j!=null){j.SetMainFrm(this.Parent.MainFrm,this.Parent.IMDB)}else{for(var a=0;a<this.Parent.MainFrm.CompList.Count();a++){try{var g=this.Parent.MainFrm.CompList[a];f=g.CompNameSpace+"."+this.Parent.bQueries(0).MstTableName;j=(new Function("return new "+f+"();"))();if(j&&!(j instanceof IDDocument)){j=null}if(j!=null){j.SetMainFrm(g,g.IMDB);break}}catch(b){}}}}catch(h){}}if(j!=null){if(this.GetDOIdx(j)>0){return(c.equals(j.GetMD().GetProp(this.GetDOIdx(j)).Concept))}}return false};PFieldSrv.prototype.GetQBESep=function(){if(this.iQBESep==null){if(this.HasConcept("DO_ID")){this.iQBESep=" "}else{this.iQBESep=";"}}return this.iQBESep};function GroupIntervalSrv(c,a,b){this.Min=c;this.Max=a;this.Label=b}PFieldSrv.prototype.AddGroupInterval=function(d,a,c){var b=new GroupIntervalSrv(d,a,c);this.GroupIntervals.Add(b)};PFieldSrv.prototype.ResetGroupIntervals=function(){this.GroupIntervals.Clear()};PFieldSrv.prototype.GetGroupLabel=function(k,a,g,l){for(var d=0;d<this.GroupIntervals.Count();d++){var h=this.GroupIntervals[d];if((k.compareTo(h.Min)>=0)&&(k.compareTo(h.Max)<=0)){return h.Label}}if(!this.UseAutomaticLabels()||!l){return k}if((this.DataType==Glb.DT_DATE||this.DataType==Glb.DT_DATETIME)&&(k.Type==IDVariant.DATETIME)){if(IDL.GetDate(k).equals(IDL.Today())){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false))}if(IDL.GetDate(k).equals(IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today()))){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false))}if(IDL.GetDate(k).equals(IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today()))){return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false))}if(!IDL.Year(k).equals(IDL.Year(IDL.Today()))){var j=IDL.Year(IDL.Today()).intValue()-IDL.Year(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("3E2037C7-3712-42C7-975A-12EC4F99C15F"," anno fa",false):this.Parent.MainFrm.RTCObj.GetConst("1DFEBB1D-F287-4720-9919-EA6F53B67F4D"," anni fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("1EB8E8FD-6881-4748-86A7-B9445B654575"," anno",false):this.Parent.MainFrm.RTCObj.GetConst("585A5B58-FF3B-460D-ADDF-5509B131314E"," anni",false)))}}if(!IDL.Month(k).equals(IDL.Month(IDL.Today()))){var j=IDL.Month(IDL.Today()).intValue()-IDL.Month(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("7E17BDA7-3102-4781-9B37-60B94EFE8DE5"," mese fa",false):this.Parent.MainFrm.RTCObj.GetConst("D354B2CC-3B66-4AA6-AEBA-3BB5A90C16C6"," mesi fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("4EA2817C-F2F0-45AC-992F-466A670C5920"," mese",false):this.Parent.MainFrm.RTCObj.GetConst("A1B47221-170D-4F68-85BF-E62D129F9D41"," mesi",false)))}}if(!IDL.Week(k).equals(IDL.Week(IDL.Today()))){var j=IDL.Week(IDL.Today()).intValue()-IDL.Week(k).intValue();if(j>0){return new IDVariant(j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("D6B70782-C74E-4F3A-B0DB-FCFFF3B198F7"," settimana fa",false):this.Parent.MainFrm.RTCObj.GetConst("2D3E27ED-49E1-49FD-B088-2240F7D06260"," settimane fa",false)))}else{j=Math.abs(j);return new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("794F8147-A11A-45BA-BA8E-BD91023786B1","Fra ",false)+j.toString()+(j==1?this.Parent.MainFrm.RTCObj.GetConst("58F52C18-8170-4126-9607-F7CE9B8BF763"," settimana",false):this.Parent.MainFrm.RTCObj.GetConst("B6AC70E1-6090-44C6-9C14-CD4284590EB7"," settimane",false)))}}}if(((this.DataType==Glb.DT_CHAR)||(this.DataType==Glb.DT_CHAR_FIXED))&&!a){return new IDVariant(k.stringValue().length>0?k.stringValue().substr(0,1).toUpperCase():"("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(((this.DataType==Glb.DT_NUM_FIXED)||(this.DataType==Glb.DT_NUM_FLOAT)||(this.DataType==Glb.DT_NUM_INTEGER)||(this.DataType==Glb.DT_NUM_CURRENCY))&&!a){if(g==null){return new IDVariant("GRPLB:1")}var b=Math.floor((this.Parent.GetNumRows()+0)/10);if(k.equals(g.Last)){return g.iLabel}if(g.Count()>=b){try{var c=parseInt(g.iLabel.stringValue().substr(6),10);return new IDVariant("GRPLB:"+(c+1))}catch(f){return g.iLabel}}return g.iLabel}return k};PFieldSrv.prototype.UseAutomaticLabels=function(){return(this.iVisualFlags&Glb.FLDVISPROP_AUTOCLUSTER)>0};PFieldSrv.prototype.SetBackgroundColor=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.BackColor!=a){this.BackColor=a;this.RD3Change(RD3Glb.FLD_BACKCOLOR)}}else{this.Values[this.Parent.ValidatingRow].BackColor=a}};PFieldSrv.prototype.SetForegroundColor=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.ForeColor!=a){this.ForeColor=a;this.RD3Change(RD3Glb.FLD_FORECOLOR)}}else{this.Values[this.Parent.ValidatingRow].ForeColor=a}};PFieldSrv.prototype.SetFontModifiers=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(!this.FontMod.equals(a)){this.FontMod=a;this.RD3Change(RD3Glb.FLD_FONTMOD)}}else{this.Values[this.Parent.ValidatingRow].FontMod=a}};PFieldSrv.prototype.SetMask=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(!this.Mask.equals(a)){this.Mask=a;if(this.Parent.Status()>0){this.Parent.ResetRD3Cache()}this.RD3Change(RD3Glb.FLD_MASK);this.CalculateMask=true}}else{this.Values[this.Parent.ValidatingRow].DynMask=a;this.CalculateMask=true}};PFieldSrv.prototype.SetAlignment=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.Alignment!=a){this.Alignment=a;this.RD3Change(RD3Glb.FLD_ALIGN)}}else{this.Values[this.Parent.ValidatingRow].Alignment=a}};PFieldSrv.prototype.UseTextSelection=function(){return this.useTextSelection};PFieldSrv.prototype.set_UseTextSelection=function(a){this.useTextSelection=a};PFieldSrv.prototype.SelStart=function(){return this.selStart};PFieldSrv.prototype.SelEnd=function(){return this.selEnd};PFieldSrv.prototype.set_TextSelection=function(b,a){this.selStart=b;this.selEnd=a;if(!this.Parent.Parent.ActiveElement.equals("F"+this.Parent.FrIndex+"C"+this.Index+"R"+this.Parent.AttR)){this.Parent.SetInput(-1,this.Index,2,true,true)}this.sendSelection=true};PFieldSrv.prototype.WaterMark=function(){return this.iWaterMark};PFieldSrv.prototype.set_WaterMark=function(a){this.iWaterMark=a;this.RD3Change(RD3Glb.FLD_WATERMARK)};PFieldSrv.prototype.SetBadge=function(a){if(this.Parent.ValidatingRow==-1||this.IdxPanel==-1){if(this.iBadge!=a){this.iBadge=a;this.RD3Change(RD3Glb.FLD_BADGE)}}else{this.Values[this.Parent.ValidatingRow].Badge=a}};PFieldSrv.prototype.setFieldEditor=function(){this.ColorList=new ArrayList();this.ColorList.Add("#FFFF00");this.ColorList.Add("#00FF00");this.ColorList.Add("#FF7200");this.ColorList.Add("#00FFFF");this.ColorList.Add("#FF00FF");this.ColorList.Add("#0000FF");this.ColorList.Add("#FF0000");this.ColorList.Add("#000080");this.ColorList.Add("#008080");this.ColorList.Add("#008000");this.ColorList.Add("#800080");this.ColorList.Add("#800000");this.ColorList.Add("#808000");this.ColorList.Add("#808080");this.ColorList.Add("#C0C0C0");this.ColorList.Add("#000000");this.ColorList.Add("#FFFFFF");this.ColorList.Add("transparent");this.FontList=new ArrayList();var a=new PVLItemSrv();a.Name="Arial";a.Value=new IDVariant("Arial");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Times New Roman";a.Value=new IDVariant("Times New Roman");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Helvetica";a.Value=new IDVariant("Helvetica");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Tahoma";a.Value=new IDVariant("Tahoma");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Verdana";a.Value=new IDVariant("Verdana");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Courier New";a.Value=new IDVariant("Courier New");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Impact";a.Value=new IDVariant("Impact");this.FontList.Add(a);a=new PVLItemSrv();a.Name="Georgia";a.Value=new IDVariant("Georgia");this.FontList.Add(a);this.TokenList=new ArrayList();this.RD3Change(RD3Glb.FLD_EDCOLORS);this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.AddColor=function(a){if(typeof(a)=="number"){a=Glb.GetWebColor(a)}if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.ColorList.Add(a);this.RD3Change(RD3Glb.FLD_EDCOLORS)};PFieldSrv.prototype.ClearColors=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.ColorList.Clear();this.RD3Change(RD3Glb.FLD_EDCOLORS)};PFieldSrv.prototype.AddFont=function(b,c){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}if(c==undefined){c=b}var a=new PVLItemSrv();a.Name=c;a.Value=new IDVariant(b);this.FontList.Add(a);this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.ClearFonts=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.FontList.Clear();this.RD3Change(RD3Glb.FLD_EDFONTS)};PFieldSrv.prototype.AddToken=function(b,c){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}var a=new PVLItemSrv();a.Name=b;a.Value=new IDVariant(c);this.TokenList.Add(a);this.RD3Change(RD3Glb.FLD_EDTOKENS)};PFieldSrv.prototype.ClearTokens=function(){if(this.EditorType!=1||!this.Parent.MainFrm.ParamsObj().UseIDEditor){return}this.TokenList.Clear();this.RD3Change(RD3Glb.FLD_EDTOKENS)};PFieldSrv.prototype.ShowEditorToolbar=function(){return this.iShowEditorToolbar};PFieldSrv.prototype.set_ShowEditorToolbar=function(a){this.iShowEditorToolbar=a;this.RD3Change(RD3Glb.FLD_EDTOOLBAR)};PFieldSrv.prototype.SendEditorCommand=function(d,b,c){if(b==undefined){b=""}if(c==undefined){c=true}var a=this.Parent.MainFrm.RD3AddEvent("edcmd",this.GetRD3Ident());a.SetAttribute("CMD",d);a.SetAttribute("RES",(c?"-1":"0"));if(b.length>0){a.SetAttribute("VAL",b)}};PFieldSrv.prototype.SetToolbarCommandEnabled=function(c,a){var b=this.iToolCommandEnabled;this.iToolCommandEnabled=(this.iToolCommandEnabled&(~c))|((a)?c:0);if(b!=this.iToolCommandEnabled){this.RD3Change(RD3Glb.FLD_EDCOMMANDS)}};PFieldSrv.prototype.IsToolbarCommandEnabled=function(a){return(this.iToolCommandEnabled&a)!=0};PFieldSrv.prototype.DefaultFormatting=function(){return this.iDefaultFormatting};PFieldSrv.prototype.set_DefaultFormatting=function(a){this.iDefaultFormatting=a;this.RD3Change(RD3Glb.FLD_DEFFORMAT)};function PGroupSrv(){this.Parent;this.Index;this.VisualStyle;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.Header="";this.Tooltip="";this.ListLeft;this.ListTop;this.ListWidth;this.ListHeight;this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.Page=0;this.ListHdrPos=Glb.HDRGRP_INNER;this.FormHdrPos=Glb.HDRGRP_INNER;this.HeaderHeight;this.HeaderWidth;this.AlreadyRendered=false;this.iGuid;this.Collapsed=false;this.Collapsible=false;this.ListMovedFields=false;this.FormMovedFields=false;this.ExpandOnError=true;this.InList=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PGR_MAXPROPS);this.CollapseAnimationDef=null}PGroupSrv.prototype.GrpRect=function(b){var a=new RectSrv();if(b==Glb.PANEL_LIST){a.Left=this.ListLeft+((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);a.Top=this.ListTop;a.Width=this.ListWidth;a.Height=this.ListHeight}else{a.Left=this.FormLeft;a.Top=this.FormTop;a.Width=this.FormWidth;a.Height=this.FormHeight}return a};PGroupSrv.prototype.set_GrpRect=function(b,a){if(b==Glb.PANEL_LIST){this.ListLeft=a.Left;this.ListTop=a.Top;this.ListWidth=a.Width;this.ListHeight=a.Height;this.RD3Change(RD3Glb.PGR_LISTLEFT);this.RD3Change(RD3Glb.PGR_LISTTOP);this.RD3Change(RD3Glb.PGR_LISTWIDTH);this.RD3Change(RD3Glb.PGR_LISTHEIGTH)}else{this.FormLeft=a.Left;this.FormTop=a.Top;this.FormWidth=a.Width;this.FormHeight=a.Height;this.RD3Change(RD3Glb.PGR_FORMLEFT);this.RD3Change(RD3Glb.PGR_FORMTOP);this.RD3Change(RD3Glb.PGR_FORMWIDTH);this.RD3Change(RD3Glb.PGR_FORMHEIGHT)}};PGroupSrv.prototype.Resize=function(){var d=0;var g=0;var j=0;var c=0;var h=0;var a=0;for(var b=0;b<this.Parent.UFields();b++){var e=this.Parent.bFields(b);if(e.Group==this.Index){if((e.Flags&Glb.FLD_INLIST)!=0&&(e.Flags&Glb.FLD_LISTLIST)!=0&&(e.Flags&Glb.OBJ_VISIBLE)!=0){if(d==0){g=e.ListLeft}d=d+e.ListWidth}if((e.Flags&Glb.FLD_INFORM)!=0&&(e.Flags&Glb.OBJ_VISIBLE)!=0){if(c==0){j=e.FormLeft;h=e.FormTop;c=e.FormLeft+e.FormWidth;a=e.FormTop+e.FormHeight}else{j=(j<e.FormLeft?j:e.FormLeft);h=(h<e.FormTop?h:e.FormTop);c=(c>e.FormLeft+e.FormWidth?c:e.FormLeft+e.FormWidth);a=(a>e.FormTop+e.FormHeight?a:e.FormTop+e.FormHeight)}}}}this.ListLeft=g-((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);this.ListWidth=d;j=j-4;c=c+4;h=h-4;a=a+4;switch(this.FormHdrPos){case Glb.HDRGRP_INNER:h=h-this.HeaderHeight;break;case Glb.HDRGRP_ONBORDER:h=h-this.HeaderHeight/2;break}this.FormLeft=j;this.FormTop=h;this.FormWidth=c-j;this.FormHeight=a-h};PGroupSrv.prototype.set_Collapsed=function(b,a){if(a==undefined){a=false}if(this.Collapsed!=b){this.Collapsed=b;this.RD3Change(RD3Glb.PGR_COLLAPSED);this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"PGroup.SetCollapsed","Group "+this.Header+(this.Collapsed?" collapsed":" expanded"));this.Parent.MainFrm.DTTObj.SetRequestName((b?"Collapse":"Expand")+" Group","Group "+this.Header+(this.Collapsed?" collapsed":" expanded"),DTTRequest.PRI_CMD);this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"PGroup.SetCollapsed","Group "+this.Header+": Firing OnChangeGroupCollapse event");this.Parent.Parent.OnChangeGroupCollapse(this.Parent,new IDVariant(this.Index))}if(this.Parent.PanelMode==Glb.PANEL_LIST){this.ListMovedFields=a;this.FormMovedFields=false}else{this.FormMovedFields=a;this.ListMovedFields=false}};PGroupSrv.prototype.set_Collapsible=function(a){if(this.Collapsible!=a){this.Collapsible=a;this.RD3Change(RD3Glb.PGR_COLLAPSIBLE)}};PGroupSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx};PGroupSrv.prototype.GetRD3Name=function(){return"grp"};PGroupSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PGroupSrv.prototype.RD3RenderDifference=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.CollapseAnimationDef!=null){d.SetAttribute("cla",this.CollapseAnimationDef)}}return c};PGroupSrv.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.PGR_VISUALSTYLE:d.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.PGR_FLAGS:d.SetAttribute("flg",this.Flags.toString());break;case RD3Glb.PGR_IMAGE:if(this.Image.length==0&&c){break}d.SetAttribute("img",this.Image);break;case RD3Glb.PGR_HEADER:if(this.Header.length==0&&c){break}d.SetAttribute("cap",this.Header);break;case RD3Glb.PGR_TOOLTIP:if(this.Tooltip.length==0&&c){break}d.SetAttribute("tip",this.Tooltip);break;case RD3Glb.PGR_LISTLEFT:var b=this.ListLeft+((this.Parent.ShowRowSelector)?Glb.SELECT_OFFSET:0);if(b==0&&c){break}d.SetAttribute("lle",b.toString());break;case RD3Glb.PGR_LISTTOP:if(this.ListTop==0&&c){break}d.SetAttribute("lto",this.ListTop.toString());break;case RD3Glb.PGR_LISTWIDTH:if(this.ListWidth==0&&c){break}d.SetAttribute("lwi",this.ListWidth.toString());break;case RD3Glb.PGR_LISTHEIGTH:if(this.ListHeight==0&&c){break}d.SetAttribute("lhe",this.ListHeight.toString());break;case RD3Glb.PGR_FORMLEFT:if(this.FormLeft==0&&c){break}d.SetAttribute("fle",this.FormLeft.toString());break;case RD3Glb.PGR_FORMTOP:if(this.FormTop==0&&c){break}d.SetAttribute("fto",this.FormTop.toString());break;case RD3Glb.PGR_FORMWIDTH:if(this.FormWidth==0&&c){break}d.SetAttribute("fwi",this.FormWidth.toString());break;case RD3Glb.PGR_FORMHEIGHT:if(this.FormHeight==0&&c){break}d.SetAttribute("fhe",this.FormHeight.toString());break;case RD3Glb.PGR_PAGE:if(this.Page==0&&c){break}d.SetAttribute("pag",this.Page.toString());break;case RD3Glb.PGR_LISTHDERPOS:if(this.ListHdrPos==0&&c){break}d.SetAttribute("lhp",this.ListHdrPos.toString());break;case RD3Glb.PGR_FORMHDRPOS:if(this.FormHdrPos==0&&c){break}d.SetAttribute("fhp",this.FormHdrPos.toString());break;case RD3Glb.PGR_HEADERHEIGHT:if(this.HeaderHeight==0&&c){break}d.SetAttribute("hhe",this.HeaderHeight.toString());break;case RD3Glb.PGR_HEADERWIDTH:if(this.HeaderWidth==0&&c){break}d.SetAttribute("hwi",this.HeaderWidth.toString());break;case RD3Glb.PGR_INLIST:if((this.ListTop>0)&&c){break}d.SetAttribute("inl",(this.ListTop<0)?"1":"0");break;case RD3Glb.PGR_COLLAPSED:d.SetAttribute("mfl",this.ListMovedFields?"1":"0");d.SetAttribute("mff",this.FormMovedFields?"1":"0");if(!this.Collapsed&&c){break}d.SetAttribute("col",this.Collapsed?"1":"0");break;case RD3Glb.PGR_COLLAPSIBLE:if(!this.Collapsible&&c){break}d.SetAttribute("clp",this.Collapsible?"1":"0");break}};PListGroupSrv.EXPAND_ALL=0;PListGroupSrv.EXPAND_SELECTED=1;function PListGroupSrv(c){this.iLabel=new IDVariant();this.iStartingRecord=0;this.iEndingRecord=0;this.FieldIdx=-1;this.Level=-1;this.VisualStyle=-1;this.iExpanded=false;this.Min;this.Max;this.Last;this.GroupList=new ArrayList();this.Parent=c;this.AggrList=new ArrayList();for(var a=0;a<this.Parent.Fields.length;a++){var b=this.Parent.Fields[a];this.AggrList.Add(new PListGroupAggrSrv(b.Code,b.Index,b.GroupAggregation,b.GroupAggrLabel,this.Parent))}if(c.MainFrm.IsMobile()){this.iExpanded=true}}PListGroupSrv.prototype.GetRD3Name=function(){return"grl"};PListGroupSrv.prototype.Count=function(){return this.iEndingRecord-this.iStartingRecord+1};PListGroupSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx+":"+this.Level+":"+this.iStartingRecord+":"+this.iEndingRecord};PListGroupSrv.prototype.RD3RenderDifference=function(d){var f=d.AddNewElement("lsg");f.SetAttribute("id",this.GetRD3Ident());f.SetAttribute("str",this.iStartingRecord.toString());f.SetAttribute("end",this.iEndingRecord.toString());f.SetAttribute("lvl",this.Level.toString());if(this.VisualStyle!=-1){f.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString())}f.SetAttribute("exp",this.iExpanded?"1":"0");var c=this.iLabel.stringValue();if(IDL.IsNull(this.iLabel)){c="("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")"}if(c.indexOf("GRPLB:")!=-1){c=this.Min.stringValue()+" - "+this.Max.stringValue();var a=this.Parent.VS.Mask(this.Parent.bFields(this.FieldIdx).VisualStyle);var g=true;if(!this.Parent.bFields(this.FieldIdx).Mask.equals("")){a=this.Parent.bFields(this.FieldIdx).Mask;g=false}if(!a.equals("=")){var h=new IDVariant();if(!IDL.IsNull(this.Min)){var b=new IDVariant();var j=new IDVariant();this.Parent.bFields(this.FieldIdx).GetClientMask(h,b,this.Min,a,this.Min.stringValue(),j,false,g)}else{h=new IDVariant("("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(h.stringValue().equals("")){h=new IDVariant("0")}var k=new IDVariant();if(!IDL.IsNull(this.Max)){var b=new IDVariant();var j=new IDVariant();this.Parent.bFields(this.FieldIdx).GetClientMask(k,b,this.Max,a,this.Max.stringValue(),j,false,g)}else{k=new IDVariant("("+this.Parent.MainFrm.RTCObj.GetConst("5C9238CA-6E6E-4844-843D-7C49454664A1","vuoto",true)+")")}if(k.stringValue().equals("")){k=new IDVariant("0")}if(h.equals(k)){c=h.stringValue()}else{c=h.stringValue()+" - "+k.stringValue()}}}f.SetAttribute("lbl",c);for(var e=0;e<this.AggrList.Count();e++){this.AggrList[e].RD3RenderDifference(f)}for(var e=0;e<this.GroupList.Count();e++){this.GroupList[e].RD3RenderDifference(f)}};PListGroupSrv.prototype.RD3Expand=function(a,c,b,e,j){if(a.equals(this.GetRD3Ident())){if(this.iExpanded==c){return true}this.iExpanded=c;if(j>0){this.Parent.UpdateDynRows(j)}var g=this.iStartingRecord;if(b!=-1&&b!=this.Parent.NumRows-1){this.Parent.AttR=b;g=this.iStartingRecord-b;if(g<=0){this.Parent.AttR=(b+g)-1;g=1}}this.Parent.set_ActualPosition(g);this.Parent.FireOnExpandingGroup(new IDVariant(this.iExpanded),new IDVariant(e));if(!e){var h=this.Parent.MainFrm.RD3AddEvent("expgrp",this.GetRD3Ident());h.SetAttribute("exp",this.iExpanded?"1":"0")}this.Parent.RD3Change(RD3Glb.PAN_ACTUALPOSITION,false);this.Parent.RD3Change(RD3Glb.PAN_ACTUALROW,false);return true}else{var f=false;for(var d=0;d<this.GroupList.Count();d++){f|=this.GroupList[d].RD3Expand(a,c,b,e,j);if(f){break}}return f}};PListGroupSrv.prototype.RD3ExpandGroups=function(a,c,e){if(a==PListGroupSrv.EXPAND_SELECTED&&!(this.iStartingRecord<=e&&e<=this.iEndingRecord)){return}var d=a==PListGroupSrv.EXPAND_ALL?c:true;if(this.Level!=-1){this.RD3Expand(this.GetRD3Ident(),d,-1,false,-1)}for(var b=0;b<this.GroupList.Count();b++){this.GroupList[b].RD3ExpandGroups(a,c,e)}};PListGroupSrv.prototype.GenerateGroups=function(){var f=this.Level+1;this.UpdateGroupAggregations();if(f>=this.Parent.GroupingList.Count()){return}var k=this.Parent.GroupingList[f];var h=this.Parent.GetDecodingField(k);var c=(h.Index!=k.Index);if(h.IdxPanel>0){this.Parent.bQueries(h.IdxPanel).UpdateLookup(0,this.Parent.MainFrm);c=true}if(this.GroupList.Count()==0){var a=null;var b=false;if((h.Flags&Glb.FLD_AUTOLOOKUP)!=0){a=new IDVariant(h.bValues(this.Parent.AttR).Text);b=true}else{if(h.ValueList.Count()>0){if(h.bValues(this.Parent.AttR).ValueListIndexes.length>0){a=new IDVariant(h.bValues(this.Parent.AttR).ValueListIndexes[0].Name);b=true}else{a=new IDVariant(h.bValues(this.Parent.AttR).Text)}}else{a=h.bValues(this.Parent.AttR).Value}}var l=new PListGroupSrv(this.Parent);l.Level=f;l.iStartingRecord=this.Parent.ActualPosition();l.iEndingRecord=this.Parent.ActualPosition();l.FieldIdx=h.Index;l.VisualStyle=h.GroupVS==-1?h.VisualStyle:h.GroupVS;l.Min=a;l.Max=a;l.Last=a;var d=(f==this.Parent.GroupingList.Count()-1);l.iLabel=h.GetGroupLabel(a,(b||c),null,d);this.GroupList.Add(l)}var o=this.GroupList[this.GroupList.Count()-1];var e=null;var g=null;var j=false;if((h.Flags&Glb.FLD_AUTOLOOKUP)!=0){g=new IDVariant(h.bValues(this.Parent.AttR).Text);j=true}else{if(h.ValueList.Count()>0){if(h.bValues(this.Parent.AttR).ValueListIndexes.length>0){g=new IDVariant(h.bValues(this.Parent.AttR).ValueListIndexes[0].Name);j=true}else{g=new IDVariant(h.bValues(this.Parent.AttR).Text)}}else{g=h.bValues(this.Parent.AttR).Value}}var m=(f==this.Parent.GroupingList.Count()-1);e=h.GetGroupLabel(g,(j||c),o,m);if(e.equals(o.iLabel)){o.iEndingRecord=this.Parent.ActualPosition();o.Last=g;if(g.compareTo(o.Min)<0){o.Min=g}if(g.compareTo(o.Max)>0){o.Max=g}}else{var l=new PListGroupSrv(this.Parent);l.Level=f;l.iLabel=e;l.iStartingRecord=this.Parent.ActualPosition();l.iEndingRecord=this.Parent.ActualPosition();l.FieldIdx=h.Index;l.VisualStyle=h.GroupVS==-1?h.VisualStyle:h.GroupVS;l.Min=g;l.Max=g;l.Last=g;this.GroupList.Add(l);o=l}o.GenerateGroups()};PListGroupSrv.prototype.UpdateGroupAggregations=function(){for(var b=0;b<this.AggrList.Count();b++){try{var a=this.AggrList[b];var c=this.Parent.Fields[a.FieldIdx];if(c.GroupAggregation==PListGroupAggrSrv.AGGR_NONE){continue}if(c.IdxPanel>0){this.Parent.bQueries(c.IdxPanel).UpdateLookup(0,this.Parent.MainFrm)}var f=null;if((c.Flags&Glb.FLD_AUTOLOOKUP)!=0){f=new IDVariant(c.bValues(this.Parent.AttR).Text)}else{if(c.ValueList.Count()>0){if(c.bValues(this.Parent.AttR).ValueListIndexes.length>0){f=new IDVariant(c.bValues(this.Parent.AttR).ValueListIndexes[0].Name)}else{f=new IDVariant(c.bValues(this.Parent.AttR).Text)}}else{f=c.bValues(this.Parent.AttR).Value}}a.CountNN+=1;if(f.compareTo(a.Min)<0||a.Min.Type==IDVariant.NULL){a.Min=f}if(f.compareTo(a.Max)>0||a.Max.Type==IDVariant.NULL){a.Max=f}a.Sum=IDL.Add(a.Sum,f);if(f.Type==IDVariant.INTEGER||f.Type==IDVariant.DECIMAL||f.Type==IDVariant.FLOAT){a.Sum2=IDL.Add(a.Sum2,new IDVariant(f.dblValue()*f.dblValue()))}}catch(d){}}};PListGroupSrv.prototype.MantainStatus=function(d){if(d==null){return}var c=true;var e=d;if(this.Level!=-1){c=false;for(var a=0;a<d.GroupList.Count();a++){var b=d.GroupList[a];if(b.iLabel.equals(this.iLabel)&&b.FieldIdx==this.FieldIdx){if(b.iExpanded&&!(this.iEndingRecord<=this.Parent.ActualPosition()+this.Parent.NumRows)&&!this.Parent.MainFrm.IsMobile()){this.iExpanded=false;c=false;break}this.iExpanded=b.iExpanded;e=b;c=true;break}}}if(!c){return}for(var a=0;a<this.GroupList.Count();a++){this.GroupList[a].MantainStatus(e)}};PListGroupSrv.prototype.getLabelNumber=function(){var b=this.Level==-1?0:1;for(var a=0;a<this.GroupList.Count();a++){b+=this.GroupList[a].getLabelNumber()}return b};PListGroupAggrSrv.AGGR_NONE=0;PListGroupAggrSrv.AGGR_SUM=1;PListGroupAggrSrv.AGGR_MIN=2;PListGroupAggrSrv.AGGR_MAX=3;PListGroupAggrSrv.AGGR_COUNT=4;PListGroupAggrSrv.AGGR_MEDIA=5;PListGroupAggrSrv.AGGR_MINMAX=6;PListGroupAggrSrv.AGGR_SCARTO=7;function PListGroupAggrSrv(e,c,b,a,d){this.CountNN=0;this.Sum=new IDVariant(0);this.Min=new IDVariant();this.Max=new IDVariant();this.Sum2=new IDVariant(0);this.FieldCode=e;this.FieldIdx=c;this.Aggr=b;this.Label=a;this.ParentPanel=d}PListGroupAggrSrv.prototype.RD3RenderDifference=function(e){if(this.Aggr==PListGroupAggrSrv.AGGR_NONE){return}var d=e.AddNewElement("agr");var c=new IDVariant();switch(this.Aggr){case PListGroupAggrSrv.AGGR_SUM:c=this.FormatAggr(this.Sum);break;case PListGroupAggrSrv.AGGR_MIN:c=this.FormatAggr(this.Min);break;case PListGroupAggrSrv.AGGR_MAX:c=this.FormatAggr(this.Max);break;case PListGroupAggrSrv.AGGR_COUNT:c=new IDVariant(this.CountNN);break;case PListGroupAggrSrv.AGGR_MEDIA:if(this.Sum.Type==IDVariant.INTEGER||this.Sum.Type==IDVariant.DECIMAL||this.Sum.Type==IDVariant.FLOAT){c=this.FormatAggr(new IDVariant(IDL.Div(this.Sum,new IDVariant(this.CountNN))))}else{c=new IDVariant("-")}break;case PListGroupAggrSrv.AGGR_MINMAX:c=new IDVariant(this.FormatAggr(this.Min).stringValue()+"-"+this.FormatAggr(this.Max).stringValue());break;case PListGroupAggrSrv.AGGR_SCARTO:if(this.Sum.Type==IDVariant.INTEGER||this.Sum.Type==IDVariant.DECIMAL||this.Sum.Type==IDVariant.FLOAT){var b=Math.sqrt(this.CountNN*this.Sum2.dblValue()-(this.Sum.dblValue()*this.Sum.dblValue()))/this.CountNN;c=new IDVariant(this.FormatAggr(IDL.Div(this.Sum,new IDVariant(this.CountNN))).stringValue()+"+-"+(2*b))}else{c=new IDVariant("-")}break}if(IDL.IsNull(this.Label)){switch(this.Aggr){case PListGroupAggrSrv.AGGR_SUM:this.Label=new IDVariant("Sum: ");break;case PListGroupAggrSrv.AGGR_MIN:this.Label=new IDVariant("Min: ");break;case PListGroupAggrSrv.AGGR_MAX:this.Label=new IDVariant("Max: ");break;case PListGroupAggrSrv.AGGR_COUNT:Label=new IDVariant("Num: ");break;case PListGroupAggrSrv.AGGR_MEDIA:this.Label=new IDVariant("Med: ");break;case PListGroupAggrSrv.AGGR_MINMAX:this.Label=new IDVariant("Min-Max: ");break;case PListGroupAggrSrv.AGGR_SCARTO:this.Label=new IDVariant("Med+-2Stdev: ");break}}var a=this.Label.stringValue()+c.stringValue();d.SetAttribute("shw",a);d.SetAttribute("fid",this.FieldIdx.toString())};PListGroupAggrSrv.prototype.FormatAggr=function(e){if(e.Type==IDVariant.BLOB||e.Type==IDVariant.DATETIME||e.Type==IDVariant.MILLIS_DAY||e.Type==IDVariant.NULL||e.Type==IDVariant.STRING||e.Type==IDVariant.VB_DAY_OFFS){return e}var d=this.ParentPanel.Fields[this.FieldIdx];var c=d.VisualStyle;var g=this.ParentPanel.VS.Mask(c);var f=true;if(!d.Mask.equals("")){g=d.Mask;f=false}if(!g.equals("=")&&d.EditorType!=1){var h=new IDVariant();var b=new IDVariant();var a=new IDVariant();d.GetClientMask(h,b,e,g,e.stringValue(),a,false,f);return h}return e};function PLookupParamSrv(){this.TblIdx=-1;this.FldIdx=-1;this.MstField;this.DataType;this.MaxLength;this.vScale;this.PropName="";this.PropIdx=-1;this.AutoLookup=false;this.Value=null}function PLookupValueSrv(){this.ParamList=new ArrayList();this.ValueList=new ArrayList()}function PPageSrv(){this.Parent;this.Index;this.VisualStyle;this.Flags;this.DesignFlags=-1;this.RoleFlags=-1;this.Image="";this.Header="";this.Tooltip="";this.iBadge="";this.iGuid;this.Style=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.PPG_MAXPROPS)}PPageSrv.prototype.Badge=function(){return this.iBadge};PPageSrv.prototype.set_Badge=function(a){this.iBadge=a;this.RD3Change(RD3Glb.PPG_BADGE)};PPageSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index+":"+this.Parent.FrIndex+":"+this.Parent.Parent.FormIdx};PPageSrv.prototype.GetRD3Name=function(){return"ppg"};PPageSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PPageSrv.prototype.RD3RenderDifference=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){}return c};PPageSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.PPG_VISUALSTYLE:c.SetAttribute("sty",this.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle).toString());break;case RD3Glb.PPG_FLAGS:c.SetAttribute("flg",this.Flags.toString());break;case RD3Glb.PPG_IMAGE:if(this.Image.length==0&&b){break}c.SetAttribute("img",this.Image);break;case RD3Glb.PPG_HEADER:if(this.Header.length==0&&b){break}c.SetAttribute("cap",this.Header);break;case RD3Glb.PPG_TOOLTIP:if(this.Tooltip.length==0&&b){break}c.SetAttribute("tip",this.Tooltip);break;case RD3Glb.PPG_STYLE:if(this.Style==0&&b){break}c.SetAttribute("pst",this.Style.toString());break;case RD3Glb.PPG_BADGE:if(this.iBadge.length==0&&b){break}c.SetAttribute("bdg",this.iBadge);break;case RD3Glb.PPG_INDEX:c.SetAttribute("ind",this.Index.toString());break}};PQuerySrv.MAX_LKE_ROWS=30;PQuerySrv.LKE_OLDSEL_OFFSET=1000;PQuerySrv.MAX_COLL_ROWS=500;function PQuerySrv(){this.Parent;this.Index;this.FieldIndex=-1;this.DB;this.DBType;this.IMDBDataSource=-1;this.IMDBPrimaryTable=-1;this.IMDBOrigTable=null;this.iGuid;this.Text=new Array(Glb.SQL_MAXQUERIES);this.RS=new IDCachedRowSet();this.QueryOK;this.LastPreparedQueryIndex=0;this.LastWhereClause="";this.MstTableName;this.AIFieldIndex=-1;this.AIQuery;this.MaxRows=0;this.ActualPosition=0;this.LookupValues=new ArrayList();this.LookupParams=new ArrayList();this.LKEParams=null;this.LKERows=null;this.LastLKERow=0;this.LastLKETry=0;this.UnboundData=new ArrayList();this.DOSortCriteria=null;this.LkeMS=null;this.iIsMultiSelect=-2;this.VisibleColumns=null;this.HeaderColumns=null;this.DecodeColumn=0;this.QueryParameters=new ArrayList();this.NumQBEParameters=0;this.BlobCache=new ArrayList();this.RSParam=new ArrayList();this.LkeRSLimitedBySystem=false;this.Document;this.DocTempl;this.DocFilter;this.IDColl;this.CollUpdCount=0;this.IsDO=false;this.IsMasterDO=false;this.LastRC=0;this.SortColumns=null;this.SortAscending=null;this.NumSort=0;this.LookupRows=null;this.CursorPos=0;this.PreviousLookupParam=null;this.PreviousLkeParam=null;this.PreviuosDocument=null;this.RS.pQuery=this}PQuerySrv.prototype.SetText=function(b,a){this.Text[b]=a};PQuerySrv.prototype.FindData=function(q,I){var A=new IDVariant();var J="";var t=true;this.Parent.FireBeforeFind(A);if(A.isTrue()){q.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",89,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": find data canceled");return false}else{if(this.IsDO){if(this.DocTempl!=null){this.IDColl.Clear();if(!I){this.DocTempl.Clear();this.NumQBEParameters=0;for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;var F=G.GetDOIdx(this.DocTempl);if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(G.IsNamed){this.DocTempl.SetNamedPropertyValue(G.Code,new IDVariant(D))}else{if(F>-1){this.DocTempl.SetPropByIndex(F,new IDVariant(D))}}if(D!=null&&D.length>0){this.NumQBEParameters++}}if(this.MaxRows>0){this.IDColl.MaxRows=this.MaxRows}else{this.IDColl.MaxRows=PQuerySrv.MAX_COLL_ROWS}this.IDColl.ClearSort();if(this.DOSortCriteria!=null){for(var E=0;E<this.DOSortCriteria.Count();E++){this.IDColl.SortBy(this.DOSortCriteria[E])}}try{this.LastWhereClause="";var l=this.Text[Glb.SQL_WHERE];if(l!=null){var L=0;for(var E=0;E<this.RSParam.Count();E++){var x=this.RSParam[E];var u=false;var y=L;for(;y<l.length;y++){if(l.charAt(y)=="'"){u=!u}else{if(l.charAt(y)=="?"&&!u){L=y;break}}}if(y>=l.length){break}l=l.remove(y,1);var b=IDL.FMT_NUM;switch(x.Type){case IDVariant.STRING:b=IDL.FMT_CHAR;break;case IDVariant.DATETIME:var a=this.DocTempl.GetMD().GetDBType();if(Glb.ClassDB(a)==Glb.DBC_ACCESS){b=IDL.FMT_DAT1}else{if(Glb.ClassDB(a)==Glb.DBC_ORACLE||Glb.ClassDB(a)==Glb.DBC_POSTGRES){b=IDL.FMT_DAT3}else{if(Glb.ClassDB(a)==Glb.DBC_SQLITE){b=IDL.FMT_DAT4}else{b=IDL.FMT_DAT2}}}break}l=l.insert(y,IDL.CSql(x,b,this.DB))}}this.DocTempl.LoadCollectionBE(this.IDColl,true,0,l);var d=new IDVariant();var o=new IDVariant();var r=new IDVariant();this.DocTempl.GetQBEClauses(this.IDColl,true,d,o,r);this.LastWhereClause=(d.stringValue().length>0?"where "+d.stringValue():"")}catch(H){q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": Find data error ("+H.message+")");t=false;this.ActualPosition=0;A=new IDVariant(true);var K=new IDVariant(false);q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.Parent.GetDTTCaption()+": Fire OnDBError Event");this.Parent.Parent.OnDBError(this.Parent,A,K,new IDVariant(0),new IDVariant(H.message),new IDVariant(0),new IDVariant(Glb.PANOP_FIND),null);if(K.isFalse()){this.Parent.FireDBError(this.DB,this.DBType,Glb.PANOP_FIND,H)}}}}if(this.IDColl!=null&&this.DocFilter!=null){this.DocFilter.Clear();for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;var F=G.GetDOIdx(this.DocFilter);if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(G.IsNamed){this.DocFilter.SetNamedPropertyValue(G.Code,new IDVariant(D))}else{if(F>-1){this.DocFilter.SetPropByIndex(F,new IDVariant(D))}}}this.IDColl.FilterDocs(this.DocFilter,true)}this.ActualPosition=1;if(this.IDColl!=null){this.IDColl.MoveFirst()}if(this.IDColl!=null&&this.IDColl.Count()>1&&this.Parent.SortingList!=null&&this.Parent.SortingList.Count()>0){this.EnableSorting(this.Parent.SortingList);this.GotoFirst()}if(this.IDColl!=null){this.LastRC=this.IDColl.Count()}else{if(this.Document!=null){this.LastRC=1}else{this.LastRC=0}}this.BlobCache.Clear();return true}if(this.IMDBDataSource>-1){if((this.Parent.Flags&Glb.PAN_CANSELECT)!=0){var h=new ArrayList();var g=new ArrayList();for(var E=0;E<this.Parent.UMaster();E++){var G=this.Parent.bMaster(E);var D=G.LastQBE;if((!G.QBELike||G.HasConcept("DO_ID")||(G.Flags&Glb.FLD_AUTOLOOKUP)!=0)&&D.length>0){D="§"+D}if(D.length>0){h.Add(G.GetIMDBIdx());g.Add(new IDVariant(D))}}if(this.IMDBOrigTable==null||(this.Parent.IMDB.TblModified(this.IMDBDataSource,Glb.GlbRefModIdx)&&!this.Parent.IMDB.Table(this.IMDBDataSource).IsFiltered)){this.IMDBOrigTable=new IMDBTableSrv(this.Parent.IMDB);this.IMDBOrigTable.CopyFrom(this.Parent.IMDB.Table(this.IMDBDataSource),true)}else{this.Parent.IMDB.TblTruncate(this.IMDBDataSource);this.Parent.IMDB.Table(this.IMDBDataSource).CopyFrom(this.IMDBOrigTable,true)}if(h.Count()>0){this.Parent.IMDB.TblFilter(this.IMDBDataSource,h,g,Glb.IMDB_CURSOR,true,this.Parent.MainFrm)}}this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);this.ActualPosition=1;this.Parent.UpdateDynRows(this.RecordCount());this.BlobCache.Clear();return true}if(!this.QueryOK){this.UpdateParam(false)}while(this.NumQBEParameters>0){this.RSParam.RemoveAt(this.RSParam.Count()-1);this.NumQBEParameters--}var C=this.GetQBE(0);var k=this.GetQBE(1);for(var B=0;B<Glb.SQL_MAXQUERIES;B++){switch(B){case Glb.SQL_WHERE:if(!I){if(C.length==0){this.LastWhereClause=this.Text[B]+"\r\n"}else{if(this.Text[B].length==0){this.LastWhereClause="where ("+C+")\r\n"}else{this.LastWhereClause=this.Text[B]+"\r\nand ("+C+")\r\n"}}J=J+this.LastWhereClause}else{J=J+"where 0=1\r\n"}break;case Glb.SQL_HAVING:if(k.length==0){J=J+this.Text[B]+"\r\n"}else{if(this.Text[B].length==0){J=J+"having ("+k+")\r\n"}else{J=J+this.Text[B]+"\r\nand ("+k+")\r\n"}}break;default:J=J+this.Text[B]+"\r\n";break}}var j=new IDVariant(J);this.PrepareParam(true,j);J=j.stringValue();try{this.ActualPosition=0;q.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Find data","Panel find data",DTTEngine.STMT_QRY_SELECT,J);try{var m=1;for(var E=0;E<this.RSParam.Count();E++){var c=this.RSParam[E];q.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+m++,c)}}catch(H){}if((this.Parent.Flags&Glb.PAN_CANDELETE)==0&&(this.Parent.Flags&Glb.PAN_CANUPDATE)==0&&(this.Parent.Flags&Glb.PAN_CANINSERT)==0){this.RS.setReadOnly()}else{this.RS.setUpdatable()}this.DB.MaxRows=this.MaxRows;this.RS.setCommand(this.DB.ApplySubstitutions(J));this.RS.setMaxRows(this.MaxRows);this.InitConnection();if(I){this.RS.execute(new ArrayList(),this.DB)}else{this.RS.execute(this.RSParam,this.DB)}q.DTTObj.AddDBDataSource(this.RS,J);q.DTTObj.EndQuery(this.iGuid);this.DB.MaxRows=0;if(this.LookupRows!=null){this.LookupRows=null;this.CursorPos=1}if(!this.RSEOF()){this.StartSort();this.GotoFirst()}this.BlobCache.Clear();this.ClearUnboundData();this.ActualPosition=1}catch(v){q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.FindData","Panel "+this.Parent.GetDTTCaption()+": Find data error ("+v.message+")");t=false;this.ActualPosition=0;A=new IDVariant(true);var K=new IDVariant(false);q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.Parent.GetDTTCaption()+": Fire OnDBError Event");this.Parent.Parent.OnDBError(this.Parent,A,K,new IDVariant(0),new IDVariant(v.message),new IDVariant(ErrorHandlerSrv.GetErrorNumber(v)),new IDVariant(Glb.PANOP_FIND),null);if(K.isFalse()){this.Parent.FireDBError(this.DB,this.DBType,Glb.PANOP_FIND,v)}}}this.PrepareLastWhereClause();this.Parent.UpdateDynRows(this.RecordCount());return t};PQuerySrv.prototype.GetQBE=function(a){var A;var E="";for(var z=0;z<this.Parent.UMaster();z++){var C=this.Parent.bMaster(z);var k=true;if(!C.QBELike||C.HasConcept("DO_ID")||(C.Flags&Glb.FLD_AUTOLOOKUP)!=0){k=false}if(!C.iMultiCriteria&&((C.Flags&Glb.FLD_AUTOLOOKUP)!=0||(C.HasConcept("DO_ID")&&!C.IsVisible(0)))){A=C.bValues(0).Value.stringValue();if(A.length>0){var y=false;if(A=="."||A=="!"){y=true}else{if(A.length>0&&A.charAt(0)=="#"&&C.bValues(0).Text.length==21){y=true}}if(!y){A="="+A}}}else{A=C.bValues(0).Text}if((((a==0&&(C.Flags&Glb.FLD_ISAGGR)==0)||(a==1&&(C.Flags&Glb.FLD_ISAGGR)!=0))&&A.length>0)){var r="";var t="";var g=-1;var e=-1;var x=true;while(g>=0||x){x=false;if(A.charAt(0)!="="){g=A.indexOf(C.GetQBESep(),g+1)}if(g>=0){t=A.substr(e+1,g-(e+1))}else{t=A.substr(e+1)}var o="";var q=new Array(2);q[0]="";q[1]="";if(t.length>0){if(t.charAt(0)==">"){if(this.Parent.MainFrm.ParamsObj().QBETrueLessThan){o=C.Expr+" > ?"}else{o=C.Expr+" >= ?"}q[0]=t.substr(1);if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var D=IDL.ParsePartialDate(this.Parent.MainFrm,q[0],(this.Parent.MainFrm.ParamsObj().QBETrueLessThan?1:0));if(D.Type!=IDVariant.NULL){o=C.Expr+" >= ?";q[0]=D.stringValue()}}}if(t.charAt(0)=="<"){if(this.Parent.MainFrm.ParamsObj().QBETrueLessThan){o=C.Expr+" < ?"}else{o=C.Expr+" <= ?"}q[0]=t.substr(1);if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var D=IDL.ParsePartialDate(this.Parent.MainFrm,q[0],(this.Parent.MainFrm.ParamsObj().QBETrueLessThan?0:1));if(D.Type!=IDVariant.NULL){o=C.Expr+" < ?";q[0]=D.stringValue()}}}if(t.charAt(0)=="."){o=C.Expr+" is not null"}if(t.charAt(0)=="!"){o=C.Expr+" is null"}if(t.charAt(0)=="#"){t=t.substr(1);if(k&&Glb.ClassDT(C.DataType)==Glb.DTC_CHAR){if(t.indexOf("*")==-1&&t.indexOf("%")==-1){t=t+"*"}t=t.replace(/\*/g,"%");var G=0;var l=this.Parent.VS.Mask(C.VisualStyle);if(l.equals(">")){o="(";q[0]=t.toUpperCase()}else{if(l.equals("<")){o="(";q[0]=t.toLowerCase()}else{switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:o="lcase(";q[0]=t.toLowerCase();break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_DB2:case Glb.DBC_SQLSRV:o="lower(";q[0]=t.toLowerCase();G=(this.DB.Unicode?4000:8000);break;case Glb.DBC_ORACLE:o="lower(";q[0]=t.toLowerCase();G=2000;break;default:o="(";q[0]=t;break}if(G>0&&C.MaxLength>G){o="(";q[0]=t}}}o+=(C.Expr+") not like ?")}else{o=C.Expr+" <> ?";q[0]=t;if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var w=IDL.ParsePartialDate(this.Parent.MainFrm,q[0],0);var v=IDL.ParsePartialDate(this.Parent.MainFrm,q[0],1);if(w.Type!=IDVariant.NULL){o=C.Expr+" < ? or "+C.Expr+" >= ?";q[0]=w.stringValue();q[1]=v.stringValue()}}}}if(t.charAt(0)=="="){o=C.Expr+" = ?";q[0]=t.substr(1)}else{if(Glb.ClassDT(C.DataType)==Glb.DTC_CHAR&&t.charAt(t.length-1)=="&"){if(Glb.ClassDB(this.DBType)!=Glb.DBC_ACCESS&&Glb.ClassDB(this.DBType)!=Glb.DBC_ODBC&&Glb.ClassDB(this.DBType)!=Glb.DBC_POSTGRES){o="soundex("+C.Expr+") = soundex(?)";q[0]=t.substr(0,t.length-1)}else{t=t.substr(0,t.length-1)+"*"}}if(o.length==0){var s;s=t.indexOf(":");if(s>=0){var F=false;if(Glb.ClassDT(C.DataType)==Glb.DTC_DATE){F=true;var w=IDL.ParsePartialDate(this.Parent.MainFrm,t.substr(0,s),0);var v=IDL.ParsePartialDate(this.Parent.MainFrm,t.substr(s+1),1);var m=(w.Type!=IDVariant.NULL||v.Type!=IDVariant.NULL);if(t.indexOf("/")!=-1||t.indexOf("-")!=-1||m){var b;for(b=s+1;b<t.length;b++){if(t.charAt(b)==":"){s=b}else{if(t.charAt(b)=="/"||t.charAt(b)=="-"){break}}}if(b<=t.length){var j=t.substr(0,s);var h=t.substr(s+1);if(j.length>0&&h.length>0){if(w.Type==IDVariant.NULL&&v.Type==IDVariant.NULL){o=C.Expr+" between ? and ?";q[0]=j;q[1]=h}else{o=C.Expr+" >= ?";if(w.Type==IDVariant.NULL){q[0]=j}else{q[0]=w.stringValue()}if(v.Type==IDVariant.NULL){o+=" and "+C.Expr+" <= ?";q[1]=h}else{o+=" and "+C.Expr+" < ?";q[1]=v.stringValue()}}}else{if(j.length>0){o=C.Expr+" >= ?";if(w.Type==IDVariant.NULL){q[0]=j}else{q[0]=w.stringValue()}}else{if(h.length>0){if(v.Type==IDVariant.NULL){o=C.Expr+" <= ?";q[0]=h}else{o=C.Expr+" < ?";q[0]=v.stringValue()}}}}}}else{var u=new ArrayList();for(var b=0;b<t.length;b++){if(t.charAt(b)==":"){u.Add(b)}}if(u.Count()>2&&(u.Count()%2)==1){s=u[(u.Count()-1)/2];var j=t.substr(0,s);var h=t.substr(s+1);if(j.length>0&&h.length>0){o=C.Expr+" between ? and ?";q[0]=j;q[1]=h}else{if(j.length>0){o=C.Expr+" >= ?";q[0]=j}else{if(h.length>0){o=C.Expr+" <= ?";q[0]=h}}}}}}if(!F){var j=t.substr(0,s);var h=t.substr(s+1);if(j.length>0&&h.length>0){o=C.Expr+" between ? and ?";q[0]=j;q[1]=h}else{if(j.length>0){o=C.Expr+" >= ?";q[0]=j}else{if(h.length>0){o=C.Expr+" <= ?";q[0]=h}}}}}}if(o.length==0){var B=t.indexOf(" ")>=0&&(t.indexOf(":")>=0||t.indexOf(".")>=0);var w=IDL.ParsePartialDate(this.Parent.MainFrm,t,0);var v=IDL.ParsePartialDate(this.Parent.MainFrm,t,1);if((C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE)&&w.Type!=IDVariant.NULL){o=C.Expr+" >= ? and "+C.Expr+" < ?";q[0]=w.stringValue();q[1]=v.stringValue()}else{if((C.DataType==Glb.DT_DATETIME&&!B)||((Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE&&C.DataType==Glb.DT_DATE))){o=C.Expr+" between ? and ?";q[0]=t;q[1]=t+" 23:59:59"}else{if(k&&Glb.ClassDT(C.DataType)==Glb.DTC_CHAR){if((C.Flags&Glb.FLD_AUTOLOOKUP)==0&&t.indexOf("*")==-1&&t.indexOf("%")==-1){t=t+"*"}t=t.replace(/\*/g,"%");var G=0;var l=this.Parent.VS.Mask(C.VisualStyle);if(l.equals(">")){o="(";q[0]=t.toUpperCase()}else{if(l.equals("<")){o="(";q[0]=t.toLowerCase()}else{switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:o="lcase(";q[0]=t.toLowerCase();break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_DB2:case Glb.DBC_SQLSRV:o="lower(";q[0]=t.toLowerCase();G=(this.DB.Unicode?4000:8000);break;case Glb.DBC_ORACLE:o="lower(";q[0]=t.toLowerCase();G=2000;break;default:o="(";q[0]=t;break}if(G>0&&C.MaxLength>G){o="(";q[0]=t}}}o+=(C.Expr+") like ?")}else{o=C.Expr+" = ?";q[0]=t}}}}}for(var c=0;c<q.length;c++){if(q[c].length>0){C.bValues(0).Validate(q[c].trim());this.RSParam.Add(C.bValues(0).Value);this.NumQBEParameters++}}if(o.length>0){if(r.length>0){r=r+" or "}r=r+"("+o+")"}}e=g}if(r.length>0){if(E.length>0){E=E+" and "}E=E+"("+r+")"}}}return E};PQuerySrv.prototype.FillPanel=function(a,j){if(j==undefined){j=true}this.Parent.RD3Change(RD3Glb.PAN_ACTUALPOSITION);this.Parent.RD3Change(RD3Glb.PAN_ACTUALROW);for(var c=0;c<this.Parent.UFields();c++){this.Parent.bFields(c).ClearBuffer(j)}if(a==null){return}try{if(this.IsDO&&this.IDColl!=null){this.IDColl.set_UIMode(true);this.CollUpdCount=this.IDColl.UpdateCount();this.LastRC=this.IDColl.Count()}for(var f=0;f<this.Parent.NumRows;f++){this.Parent.SetRowError(f,"");if(this.IsDO){if(this.IDColl!=null){if(this.IDColl.IsEof()){break}}else{if(this.Document!=null){if(f>0){break}}else{break}}}else{if(this.IMDBDataSource==-1){if(this.RSEOF()){break}}else{if(this.Parent.IMDB.Eof(this.IMDBDataSource,Glb.IMDB_CURSOR)){break}}}if(this.IsDO){var d=this.GetAttRecNumber()+f-1;if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}var b=this.Document.UpdateCount();if(this.Parent.RD3UpdateCount!=null){if(d>=this.Parent.RD3UpdateCount.length||this.Parent.RD3UpdateCount[d]!=b){if(d<this.Parent.RD3ListCache.length){this.Parent.RD3ListCache[d]=false}if(d<this.Parent.RD3FormCache.length){this.Parent.RD3FormCache[d]=false}}if(d<this.Parent.RD3UpdateCount.length){this.Parent.RD3UpdateCount[d]=b}}this.Parent.set_RowUpdateCount(f,b)}for(var c=0;c<this.Parent.UMaster();c++){if(this.IsDO){this.Parent.bMaster(c).SetDOBuffer(f,this.Document,this)}else{if(this.IMDBDataSource>-1){this.Parent.bMaster(c).SetIMDBBuffer(f,this.IMDBDataSource,this)}else{this.Parent.bMaster(c).SetBuffer(f,this.RS,this)}}}if(this.IsDO){var h=0;if(this.IDColl!=null){h=this.IDColl.AbsolutePosition()}this.Parent.DumpDocErrors(this.Document,f,false,null);if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(h)}}if(this.IsDO){if(this.IDColl!=null){this.IDColl.MoveNext()}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.GotoNext()}}}}catch(g){}this.DoUpdateLookups(-1,a);this.UpdateIMDB(this.Parent.AttR,true,true,true);if(this.IsDO&&this.IDColl!=null){this.IDColl.set_UIMode(false)}if(this.Parent.ShowMultipleSel()||this.IsDO){this.Parent.SetRDRowSel(-1,true)}};PQuerySrv.prototype.RecordCount=function(){if(this.IsDO){if(this.IDColl!=null){return this.LastRC}else{if(this.Document!=null){return 1}}return 0}if(this.IMDBDataSource>-1){return this.Parent.IMDB.TblNumRows(this.IMDBDataSource)}try{if(!this.RS.IsOpen()){return -1}else{if(this.RS.RecordCount()==-1){return this.ActualPosition+100}else{return this.RS.RecordCount()}}}catch(a){return -1}};PQuerySrv.prototype.GetAttRecNumber=function(){return this.ActualPosition};PQuerySrv.prototype.ScrollBy=function(a){this.ScrollTo(this.ActualPosition+a)};PQuerySrv.prototype.ScrollTo=function(f){var d=false;var c=this.Parent.PanelMode==Glb.PANEL_FORM&&(this.Parent.Flags&Glb.PAN_CANINSERT)!=0;this.ActualPosition=f;if(c){if(this.ActualPosition>this.RecordCount()){this.ActualPosition=this.RecordCount()+1;d=true}}else{if(this.ActualPosition>this.RecordCount()){this.ActualPosition=this.RecordCount()}}if(this.ActualPosition<1){this.ActualPosition=1}if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_UIMode(true);if(d){this.IDColl.MoveLast();this.IDColl.MoveNext()}else{this.IDColl.set_AbsolutePosition(this.ActualPosition)}this.IDColl.set_UIMode(false)}}else{if(this.IMDBDataSource>-1){if(d){this.Parent.IMDB.TblMoveLast(this.IMDBDataSource,Glb.IMDB_CURSOR);this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);var a=1;while(a<this.ActualPosition){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR);a=a+1}}}else{try{if(d){this.GotoLast();this.GotoNext()}else{this.GotoAbsolute(this.ActualPosition)}}catch(b){}}}};PQuerySrv.prototype.CloseData=function(){try{if(this.IMDBDataSource==-1&&!this.IsDO){this.RS.Close()}if(this.IsDO&&this.DocTempl!=null){this.IDColl.Clear();this.CollUpdCount=this.IDColl.UpdateCount()}this.FillPanel(null)}catch(a){}};PQuerySrv.prototype.UpdateLookup=function(a,o){var d=a;var c=a;if(a==-1){d=0;c=this.Parent.NumRows-1}if(!this.QueryOK||this.LastPreparedQueryIndex!=0){this.PrepareLookup(0)}if(this.IsDO&&this.Document!=null){for(var h=0;h<this.LookupParams.Count();h++){var b=this.LookupParams[h];if(b.TblIdx==this.Parent.MstTblIndex){var r=this.Parent.IMDB.FldCode(b.TblIdx,b.FldIdx);b.TblIdx=-1;for(var k=0;k<this.Parent.UMaster();k++){if(this.Parent.bMaster(k).Code.equals(r)){b.MstField=this.Parent.bMaster(k);break}}}if(b.PropIdx==-1&&b.PropName.length>0){b.PropIdx=this.Document.GetPropIndex(b.PropName);if(b.PropIdx<1){b.PropIdx=this.Document.GetPropertyIndex(b.PropName)}if(b.PropIdx<1){WriteToConsoleError("UpdateLookup: Cannot Find Document Property <"+b.PropName+" in document: "+this.Document)}b.PropName=""}}}for(var g=d;g<=c;g++){var m=null;var q=null;if(this.Parent.Status()==Glb.PS_QBE){for(var h=0;h<this.LookupParams.Count();h++){var b=this.LookupParams[h];if(b.Value==null){if(b.MstField!=null){if(!b.MstField.iMultiCriteria&&(b.MstField.Flags&Glb.FLD_AUTOLOOKUP)!=0){q=b.MstField.bValues(g).Value.stringValue().split(b.MstField.GetQBESep().charAt(0))}else{q=b.MstField.bValues(g).Text.split(b.MstField.GetQBESep().charAt(0))}}else{q=this.Parent.IMDB.Value(b.TblIdx,b.FldIdx,0).stringValue().split(";")}if(q.length>1){m=b;break}}}}if(m==null){this.UpdateLookupRow(g,o,-1)}else{var l=null;var f=null;if(m.MstField!=null){f=m.MstField.bValues(g).Text;l=new IDVariant(m.MstField.bValues(g).Value)}else{l=this.Parent.IMDB.Value(m.TblIdx,m.FldIdx,0)}for(var e=0;e<q.length;e++){if(m.MstField!=null){m.MstField.bValues(g).Value=new IDVariant(q[e],IDL.DataType2IDVariantType(m.MstField.DataType))}else{this.Parent.IMDB.set_Value(m.TblIdx,m.FldIdx,0,new IDVariant(q[e]))}this.UpdateLookupRow(g,o,e)}if(m.MstField!=null){m.MstField.bValues(g).Text=f;m.MstField.bValues(g).Value=l}else{this.Parent.IMDB.set_Value(m.TblIdx,m.FldIdx,0,new IDVariant(l))}}}};PQuerySrv.prototype.UpdateLookupRow=function(b,r,P){if(this.IsDO){var I=false;if(this.Document!=null){var L=this.Document.GetMD();this.Document.Clear();for(var N=0;N<this.LookupParams.Count();N++){var E=this.LookupParams[N];if(E.Value==null){var t;if(E.MstField!=null){t=E.MstField.bValues(b).Value;if(E.MstField.IsExtended&&E.MstField.IDLista.length>0){var J=this.Document.GetPropertyIndex("DO_LISTID",true,true,true,true);if(J>0){this.Document.SetPropByIndex(J,new IDVariant(E.MstField.IDLista))}}}else{t=this.Parent.IMDB.Value(E.TblIdx,E.FldIdx,0)}if(E.PropIdx>0){if(t.Type!=IDVariant.NULL){this.Document.SetPropByIndex(E.PropIdx,t);if(E.MstField!=null){I=true}}}}else{this.Document.SetPropByIndex(E.PropIdx,E.Value)}}var C=true;for(var K=1;K<=L.GetNumProp();K++){var R=L.GetProp(K);if("DO_CODE".equals(R.Concept)&&this.Document.GetPropByIndex(K).Type!=IDVariant.NULL){C=true;break}if(C&&R.PK&&this.Document.GetPropByIndex(K).Type==IDVariant.NULL){var c=new Array(Glb.SQL_MAXQUERIES);this.Document.GetMasterQuery(c,new IDVariant(),new ArrayList());if(c[0]==null||c[0].length==0){C=false}}}if(!C){this.Document.Clear();var g=false;if(this.Parent.IsDO()&&this.Parent.Status()!=Glb.PS_UPDATE){g=(this.Parent.GetDocument(b)==null)}else{g=(this.Parent.IsNewRow(b)&&!this.Parent.IsRowModified(b))}if(this.Parent.Status()!=Glb.PS_QBE&&!g){r.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",88,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+": the lookup query was not performed for row "+(b+1)+" because the primary key is non complete.")}}else{if(this.Document.Updated()){for(var N=0;N<this.LookupParams.Count();N++){var E=this.LookupParams[N];if(E.Value!=null&&E.PropIdx>0){this.Document.SetPropByIndex(E.PropIdx,E.Value)}}}if(I){this.Document.LoadLookupValues()}}if(this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){if(this.LkeMS==null){this.LkeMS=new IDCachedRowSet();var s=new ArrayList();for(var K=1;K<=L.GetNumProp();K++){var R=L.GetProp(K);if(((R.DBCode!=null&&R.DBCode.length>0)||R.IOTCode.length>0)&&R.DataType!=Glb.DT_DOC_OLE){s.Add(K)}}var Q=new IDCachedRowSetMetaData();Q.setColumnCount(s.Count());for(var K=0;K<s.Count();K++){var R=L.GetProp(s[K]);Q.setColumnName(K,R.ObjTag);Q.setColumnType(K,IDCachedRowSetMetaData.GetCSharpType(R.DataType))}this.LkeMS.setMetaData(Q)}else{if(P<=0){this.LkeMS.RemoveAllRows()}}if(I){var D=new ArrayList();for(var K=1;K<=L.GetNumProp();K++){var R=L.GetProp(K);if(((R.DBCode!=null&&R.DBCode.length>0)||R.IOTCode.length>0)&&R.DataType!=Glb.DT_DOC_OLE){D.Add(this.Document.GetPropByIndex(K))}}this.LkeMS.AddRow(D)}}if(this.FieldIndex>-1){var M=this.Parent.bFields(this.FieldIndex);var h=M.bValues(b).LastValue;var B=this.Document.GetAutoLookupCode();var A=this.Document.GetAutoLookupDescription();if(P>0){B=new IDVariant(M.bValues(b).Value.stringValue()+M.GetQBESep()+B.stringValue());A=new IDVariant(M.bValues(b).Text+r.ComboNameSep+A.stringValue())}M.bValues(b).SetAutoLookupValues(new IDVariant(B),new IDVariant(A));if(P>0){M.bValues(b).LastValue=new IDVariant(h)}}else{for(var H=0;H<this.Parent.UFields();H++){var M=this.Parent.bFields(H);if(M.IdxPanel==this.Index){var a=M.bValues(b).Text;var h=M.bValues(b).LastValue;if(this.PreviuosDocument!=null){M.bValues(b).SetValue(new IDVariant((P>0?M.bValues(b).Text+r.ComboNameSep:"")+this.Document.GetName()))}else{M.SetDOBuffer(b,this.Document,this,P)}if(P>0){M.bValues(b).LastValue=new IDVariant(h)}if(a!=this.Parent.bFields(H).bValues(b).Text){this.Parent.bFields(H).bValues(b).RD3Change(RD3Glb.VAL_TEXT)}}}}}}else{var y=false;var x=true;var F;var G=null;for(var u=0;u<this.LookupValues.Count();u++){var G=this.LookupValues[u];y=true;var J=0;for(var N=0;N<this.LookupParams.Count();N++){var E=this.LookupParams[N];var t=G.ParamList[J];if(E.MstField!=null){F=E.MstField.bValues(b).Value;if(!t.equals(F)){y=false;break}}else{F=this.Parent.IMDB.Value(E.TblIdx,E.FldIdx,0);if(!t.equals(F)){y=false;break}}J=J+1}if(y){break}}if(!y){G=new PLookupValueSrv();this.LookupValues.Add(G);this.RSParam.Clear();for(var N=0;N<this.LookupParams.Count();N++){var E=this.LookupParams[N];if(E.MstField!=null){var o=new IDVariant(E.MstField.bValues(b).Value);this.RSParam.Add(o);G.ParamList.Add(o)}else{var o=new IDVariant(this.Parent.IMDB.Value(E.TblIdx,E.FldIdx,0));this.RSParam.Add(o);G.ParamList.Add(o)}}x=true;try{r.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Update lookup (row "+(b+1)+")","Update Lookup query",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());try{var q=1;for(var m=0;m<this.RSParam.Count();m++){var d=this.RSParam[m];r.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+q++,d)}}catch(O){}this.InitConnection();this.RS.execute(this.RSParam,this.DB);r.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());r.DTTObj.EndQuery(this.iGuid);if(this.RS.RecordCount()>1){r.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",91,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+": the lookup query returned more than one records (Num Records = "+this.RS.RecordCount()+")")}if(x){if(this.LkeMS==null&&this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){this.LkeMS=new IDCachedRowSet();this.LkeMS.setMetaData(this.RS.getMetaData())}if(!this.RS.EOF()){this.RS.MoveFirst()}if(this.RS.size()>0){if(this.FieldIndex>-1){G.ValueList.Add(this.RS.Get(1));G.ValueList.Add(this.RS.Get(this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields()))}else{if(this.IsMultiSelect()){for(var K=0;K<this.RS.GetNumFields();K++){G.ValueList.Add(this.RS.Get(K+1))}}for(var H=0;H<this.Parent.UFields();H++){var M=this.Parent.bFields(H);if(M.IdxPanel==this.Index){if(this.IsMultiSelect()){M.GetRSIdx(this.RS)}else{G.ValueList.Add(this.RS.Get(M.GetRSIdx(this.RS)))}}}}}this.RS.Close()}}catch(O){r.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",158,"PQuery.UpdateLookup","Panel "+this.Parent.GetDTTCaption()+" - Error: "+O.message);r.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()));WriteToConsoleError(O);x=false}}if(this.LkeMS!=null&&this.IsMultiSelect()&&this.Parent.Status()==Glb.PS_QBE){if(P<=0){this.LkeMS.RemoveAllRows()}if(G.ValueList.Count()>0){this.LkeMS.AddRow(G.ValueList)}}if(x){if(this.FieldIndex>-1){if(G.ValueList.Count()==2){var M=this.Parent.bFields(this.FieldIndex);var h=M.bValues(b).LastValue;var B=IDVariant.convertObject(G.ValueList[0]);var A=IDVariant.convertObject(G.ValueList[1]);if(P>0){B=new IDVariant(M.bValues(b).Value.stringValue()+M.GetQBESep()+B.stringValue());A=new IDVariant(M.bValues(b).Text+r.ComboNameSep+A.stringValue())}M.bValues(b).SetAutoLookupValues(new IDVariant(B),new IDVariant(A));if(P>0){M.bValues(b).LastValue=new IDVariant(h)}if(M.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){this.Parent.bFields(M.SortFld).bValues(b).SetNewValue(new IDVariant(A));if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(b,this.Parent.bFields(M.SortFld))}}if(!M.IsEnabled(b)){this.LastPreparedQueryIndex=-1}}}else{var J=0;for(var H=0;H<this.Parent.UFields();H++){var M=this.Parent.bFields(H);if(M.IdxPanel==this.Index){if(G.ValueList.Count()>0){var a=M.bValues(b).Text;var h=M.bValues(b).LastValue;var A=null;if(this.IsMultiSelect()){A=IDVariant.convertObject(G.ValueList[M.GetRSIdx(null)-1])}else{A=IDVariant.convertObject(G.ValueList[J])}if(P>0){A=new IDVariant(M.bValues(b).Text+r.ComboNameSep+A.stringValue())}M.bValues(b).SetValue(new IDVariant(A));M.bValues(b).OrgValue=new IDVariant(M.bValues(b).Value);if(P>0){M.bValues(b).LastValue=new IDVariant(h)}if(a!=M.bValues(b).Text){M.bValues(b).RD3Change(RD3Glb.VAL_TEXT)}if(M.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){a=this.Parent.bFields(M.SortFld).bValues(b).Text;this.Parent.bFields(M.SortFld).bValues(b).SetNewValue(new IDVariant(A));if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(b,this.Parent.bFields(M.SortFld))}if(a!=this.Parent.bFields(M.SortFld).bValues(b).Text){this.Parent.bFields(M.SortFld).bValues(b).RD3Change(RD3Glb.VAL_TEXT)}}J++}else{var a=M.bValues(b).Text;M.bValues(b).SetValue(new IDVariant());M.bValues(b).OrgValue=new IDVariant();if(a!=M.bValues(b).Text){M.bValues(b).RD3Change(RD3Glb.VAL_TEXT)}if(M.SortFld!=-1&&this.Parent.Status()!=Glb.PS_QBE){a=this.Parent.bFields(M.SortFld).bValues(b).Text;this.Parent.bFields(M.SortFld).bValues(b).SetNewValue(new IDVariant());if(!this.Parent.Queries[0].IsDO){this.Parent.Queries[0].WriteUnboundValue(b,this.Parent.bFields(M.SortFld))}if(a!=this.Parent.bFields(M.SortFld).bValues(b).Text){this.Parent.bFields(M.SortFld).bValues(b).RD3Change(RD3Glb.VAL_TEXT)}}}}}}}}};PQuerySrv.prototype.PrepareLookup=function(k){var j=-1;if(this.IsDO){this.QueryOK=true;return}this.LastPreparedQueryIndex=k;this.LookupParams.Clear();var c=this.Text[k];var g=true;while(j>=0||g){g=false;j=c.indexOf("~~",j+1);var h=c.indexOf("~~",j+1);if(j>=0&&h>=0){var l=c.substr(j+2,h-(j+2));c=c.substr(0,j)+"?"+c.substr(h+2);var a=l.lastIndexOf(".");var d=new PLookupParamSrv();this.LookupParams.Add(d);if(a>=0){d.TblIdx=this.Parent.IMDB.TblByCode(l.substr(0,a),this.Parent.MainFrm);if(d.TblIdx>-1){d.FldIdx=this.Parent.IMDB.FldByCode(d.TblIdx,l.substr(a+1))}if(d.FldIdx>-1){d.DataType=this.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.vScale=this.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}else{for(var b=0;b<this.Parent.UMaster();b++){if(this.Parent.bMaster(b).Code.equals(l)){d.MstField=this.Parent.bMaster(b);break}}}}}try{this.RS.setCommand(this.DB.ApplySubstitutions(c))}catch(f){}this.QueryOK=true};PQuerySrv.prototype.DeleteRecord=function(q){var m=true;var p=null;if(this.ActualPosition+this.Parent.AttR>this.RecordCount()){return false}if(this.IsDO){var k=this.Parent.GetDocument();p=k;var a=new IDVariant();var c=k.GetLock(9999,"",a);if(c){k.set_Deleted(true);if(this.IsMasterDO){try{m=k.Validate(0,9999,true);if(m){m=k.SaveToDB()}}catch(j){m=false}if(!m){this.Parent.DumpDocErrors(k,this.Parent.AttR,false,null);var t=new IDVariant(true);var f=new IDVariant(true);q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.Parent.GetDTTCaption()+": Fire OnDBError Event");this.Parent.Parent.OnDBError(this.Parent,t,f,new IDVariant(),new IDVariant(),new IDVariant(),new IDVariant(Glb.PANOP_DELETE),k.GetFailedDoc())}}else{if(this.IDColl==null){this.Parent.SetDocument(null)}}if(!m){k.set_Deleted(false)}else{if(this.Parent.MainFrm!=null){q.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",189,"PQuery.DeleteRecords","Panel "+this.Parent.GetDTTCaption()+": refreshing "+this.MstTableName+" lookups");this.RefreshAllLookups()}}if(this.IDColl!=null){if(m&&this.DocTempl!=null){this.IDColl.PurgeDeleted()}this.Parent.UpdateDynRows(this.RecordCount())}}else{k.ClearErrors();k.AddDocError(a.stringValue());this.Parent.DumpDocErrors(k,this.Parent.AttR,false,null);m=false}}else{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+this.Parent.AttR);p=this.Parent.IMDB.Table(this.IMDBDataSource).AttPos[Glb.IMDB_CURSOR].RowBookMark;this.Parent.IMDB.SynchronizeRows(this.IMDBDataSource,Glb.IMDB_CURSOR,Glb.IMDB_CURSOR);this.Parent.IMDB.TblDelete(this.IMDBPrimaryTable,Glb.IMDB_CURSOR)}else{try{this.GotoAbsolute(this.ActualPosition+this.Parent.AttR);p=this.RS.BookMark();this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));this.RS.deleteRow();this.InitConnection();this.RS.acceptChanges(this.DB);if(this.LookupRows!=null){var o=this.ActualPosition+this.Parent.AttR-1;var g=this.LookupRows;this.LookupRows=new Array(g.length-1);Array.copy(g,0,this.LookupRows,0,o);Array.copy(g,o+1,this.LookupRows,o,g.length-o-1);for(var h=0;h<this.LookupRows.length;h++){if(this.LookupRows[h]>g[o]){this.LookupRows[h]--}}}}catch(u){m=false;var t=new IDVariant(true);var f=new IDVariant(false);q.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.Parent.GetDTTCaption()+": Fire OnDBError Event");this.Parent.Parent.OnDBError(this.Parent,t,f,new IDVariant(0),new IDVariant(u.message),new IDVariant(ErrorHandlerSrv.GetErrorNumber(u)),new IDVariant(Glb.PANOP_DELETE),null);if(f.isFalse()){this.Parent.FireDBError(this.DB,this.DBType,Glb.PANOP_DELETE,u)}}if(!m){try{this.RS.refreshRow()}catch(j){}}else{if(this.Parent.MainFrm!=null&&this.IMDBDataSource==-1){q.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",189,"PQuery.DeleteRecords","Panel "+this.Parent.GetDTTCaption()+": refreshing "+this.MstTableName+" lookups");this.RefreshAllLookups()}this.Parent.UpdateDynRows(this.RecordCount())}}}if(m){for(var r=0;r<this.BlobCache.Count();r++){var l=this.BlobCache[r];if(l.BookMark==p){this.BlobCache.RemoveAt(r--)}else{if(!this.IsDO&&this.IMDBDataSource==-1){if(l.BookMark>p){l.BookMark=l.BookMark-1}}}}}return m};PQuerySrv.prototype.RefreshAllLookups=function(){var a="";if(this.IDColl!=null&&this.IDColl.Count()>0){var b=this.IDColl.AbsolutePosition();this.IDColl.MoveFirst();var c=this.IDColl.GetAt();this.IDColl.set_AbsolutePosition(b);if(c!=null&&c.GetMD()!=null){a=c.GetMD().DBCode}}else{if(this.Document!=null&&this.Document.GetMD()!=null){a=this.Document.GetMD().DBCode}}this.Parent.MainFrm.RefreshAllLookups(this.MstTableName,a)};PQuerySrv.prototype.RefreshQuery=function(a){var d=true;if(this.IMDBDataSource>-1){return true}if(this.IsDO){if(this.DocTempl!=null){var g=this.ActualPosition;this.FindData(a,false);this.ScrollTo(g)}if(this.IDColl!=null){this.Parent.UpdateDynRows(this.RecordCount())}return true}try{this.RS.Close();this.InitConnection();a.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Refresh query","Panel find data",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());try{var f=1;for(var j=0;j<this.RSParam.Count();j++){var b=this.RSParam[j];a.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+f++,b)}}catch(h){}this.RS.execute(this.RSParam,this.DB);if(this.LookupRows!=null){this.LookupRows=null;this.CursorPos=1}if(!this.RSEOF()){this.StartSort();this.GotoFirst()}a.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());a.DTTObj.EndQuery(this.iGuid);for(var c=1;c<this.Parent.UQueries();c++){if(this.Parent.bQueries(c).FieldIndex==-1){this.Parent.bQueries(c).ClearLookupBuffer()}else{if((this.Parent.bFields(this.Parent.bQueries(c).FieldIndex).Flags&Glb.FLD_AUTOLOOKUP)!=0){this.Parent.bQueries(c).ClearLookupBuffer()}}}this.BlobCache.Clear();this.ClearUnboundData()}catch(h){d=false;if(this.RS.getCommand()==null){a.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,80,"PQuery.RefreshQuery","Panel "+this.Parent.GetDTTCaption()+": Recordset not initialized. Use FindData first.")}}this.Parent.UpdateDynRows(this.RecordCount());return d};PQuerySrv.prototype.ClearLookupBuffer=function(){this.LookupValues.Clear();this.LastPreparedQueryIndex=-1};PQuerySrv.prototype.UpdateRecords=function(D){var x=new IDVariant();var M;var t=null;var N=false;var v=0;var u=0;var A=false;var F=new IDVariant();D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,58,"IDPanel.FireBeforeCommit","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeCommit Event");this.Parent.Parent.BeforeCommit(this.Parent,x);if(x.isTrue()){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",92,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update records canceled");return false}var h=this.ActualPosition;var L=this.RecordCount();if(this.IDColl!=null){this.IDColl.set_UIMode(true)}var y=true;for(var K=0;K<this.Parent.NumRows;K++){try{if(h+K<=L){if(K==0){if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(this.ActualPosition+K)}}else{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+K)}else{this.GotoAbsolute(this.ActualPosition+K)}}}else{if(this.IsDO){if(this.IDColl!=null){this.IDColl.MoveNext()}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{this.GotoNext()}}}}var G=false;var c=true;for(var J=0;J<this.Parent.UMaster();J++){G=G||this.Parent.bMaster(J).bValues(K).Modified;c=c&&this.Parent.bMaster(J).bValues(K).Text.length==0}if(this.IsDO&&(this.Parent.Flags&Glb.PAN_NEWINSMODE)!=0&&c&&h+K>L){c=false;this.Parent.bMaster(0).bValues(K).Modified=false}if(G&&(!c||h+K<=L)){this.Parent.ValidatingRow=K;this.Parent.bQueries(0).UpdateIMDB(K,true,false,false);x=new IDVariant();if(h+K>L){this.Parent.FireBeforeInsert(x);if(x.isFalse()){if(this.IsDO){if(this.IDColl!=null){try{this.Parent.FireCreateDocument(this.IDColl,this.MstTableName);this.LastRC++}catch(P){WriteToConsoleError(P)}}}else{if(this.IMDBDataSource==-1){this.RS.moveToInsertRow()}else{this.Parent.IMDB.TblAddNew(this.IMDBPrimaryTable,Glb.IMDB_CURSOR);this.Parent.IMDB.TblAddNew(this.IMDBDataSource,Glb.IMDB_CURSOR);this.Parent.IMDB.TblLinkRow(this.IMDBDataSource,Glb.IMDB_CURSOR,this.IMDBPrimaryTable,Glb.IMDB_CURSOR);for(var I=0;I<this.Parent.UMaster();I++){if(this.Parent.bMaster(I).PriIdx>-1){this.Parent.IMDB.TblLinkField(this.IMDBDataSource,this.Parent.bMaster(I).GetIMDBIdx(),Glb.IMDB_CURSOR,this.IMDBPrimaryTable,this.Parent.bMaster(I).PriIdx,Glb.IMDB_CURSOR)}}}}}else{D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",93,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": insert canceled")}M=true}else{this.Parent.FireBeforeUpdate(x);if(x.isTrue()){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",94,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update canceled")}M=false}if(x.isFalse()){if(this.Parent.MstTblIndex>-1&&this.Parent.IMDB.TblModified(this.Parent.MstTblIndex,Glb.GlbRefModIdx)){for(var J=0;J<this.Parent.UMaster();J++){if(this.Parent.bMaster(J).IdxPanel==0){var Q=this.Parent.bMaster(J).GetIMDBIdx();if(Q>-1){if(this.Parent.bMaster(J).bValues(K).Value.CompareTo(this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))!=0){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",95,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": field value changed from "+this.Parent.bMaster(J).bValues(K).Value+" to "+this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))}this.Parent.bMaster(J).bValues(K).SetNewValue(this.Parent.IMDB.Value(this.Parent.MstTblIndex,Q,0))}}}}if(this.AIFieldIndex>-1){t=this.Parent.bFields(this.AIFieldIndex)}if(t!=null&&this.AIQuery.length>0){if(IDL.IsNull(t.bValues(K).Value)){try{if(!this.DB.IsOpen()){D.OpenConnection(this.DB)}var C=this.DB.OpenRSR(this.AIQuery);if(!C.EOF()){t.bValues(K).SetNewValue(C.Get(1))}C.Close()}catch(E){WriteToConsoleError(E)}if(IDL.IsNull(t.bValues(K).Value)){t.bValues(K).SetNewValue(new IDVariant(1));D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",96,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": empty autoincrement field substituted with 1")}}}if(this.IsDO){if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}if(this.Document!=null){A=this.Document.GetLock(9999,"",F);if(A){this.Document.BeginTrans()}}}var q=false;for(var J=0;J<this.Parent.UMaster();J++){if(this.Parent.bMaster(J).bValues(K).Modified){if(this.Parent.bMaster(J).DataType==Glb.DT_DOC_OLE&&this.IMDBDataSource==-1){if(this.Parent.bMaster(J).bValues(K).Text.length>0){}else{this.RS.Set(this.Parent.bMaster(J).GetRSIdx(this.RS),new IDVariant())}}else{if(this.IsDO){if(this.Document!=null&&A){var g=this.Parent.bMaster(J).GetDOIdx(this.Document);if(g<1){if(this.Parent.bMaster(J).IsNamed){this.Document.SetNamedPropertyValue(this.Parent.bMaster(J).Code,this.Parent.bMaster(J).bValues(K).Value)}}else{this.Document.SetPropByIndex(g,this.Parent.bMaster(J).bValues(K).Value)}}}else{if(this.IMDBDataSource==-1){var O=this.Parent.bMaster(J);var l;if(M){l=new IDVariant()}else{l=this.RS.Get(O.GetRSIdx(this.RS))}var p=Glb.GetTI(l,O.bValues(K).Value,O.Transformation,O.TrFormat,O.TrOffset,O.MaxLength);if(!this.Parent.bMaster(J).Unbound){this.RS.Set(this.Parent.bMaster(J).GetRSIdx(this.RS),p)}}else{this.Parent.IMDB.set_Value(this.IMDBDataSource,this.Parent.bMaster(J).GetIMDBIdx(),Glb.IMDB_CURSOR,this.Parent.bMaster(J).bValues(K).Value)}}}if(M&&(h+K>this.RecordCount()+1)&&!this.IsDO){q=true}}}if(q){for(var b=0;b<this.Parent.Fields.length;b++){var O=this.Parent.Fields[b];if(K<O.Values.length){O.Values[K].RD3Change(RD3Glb.VAL_TEXT)}var a=this.RecordCount()+1-h;if(a<O.Values.length&&a>=0){O.Values[a].RD3Change(RD3Glb.VAL_TEXT)}}}if(this.IMDBDataSource==-1&&!this.IsDO){this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));if(M){this.RS.insertRow()}else{this.RS.updateRow()}this.RS.moveToCurrentRow();this.InitConnection();this.RS.acceptChanges(this.DB);if(M){N=true;this.RS.MoveLast()}if(t!=null&&M){var m=this.DBType;if(m==Glb.DBT_SQLSRV2K||m==Glb.DBT_SQLSRV05){m=Glb.DBT_SQLSRV7}var S=new IDVariant(this.RS.IntDS.insertId);if(S==undefined){S=Glb.GetLIV(this.DB,m,this.DB.ApplySubstitutions(this.MstTableName),t.Code)}if(S.intValue()>0){this.RS.Set(t.GetRSIdx(this.RS),S);this.RS.setOriginalValue(t.GetRSIdx(this.RS))}}}if(this.IMDBDataSource==-1&&!this.IsDO){try{for(var J=0;J<this.Parent.UFields();J++){var O=this.Parent.bFields(J);if(O.IdxPanel==0&&O.DataType!=Glb.DT_DOC_OLE){var Q=O.GetIMDBIdx();var r=O.GetRSIdx(this.RS);if(Q>-1&&r>-1){var d=Glb.GetTD(this.RS.Get(r),O.Transformation,O.TrFormat,O.TrOffset,O.MaxLength);this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,Q,0,d);O.bValues(K).SetValue(d);O.bValues(K).SetOriginal();if(O.Index==this.AIFieldIndex){O.bValues(K).RD3Change(RD3Glb.VAL_TEXT)}}}}}catch(P){WriteToConsoleError(P);if(this.Parent.MstTblIndex>-1){this.Parent.IMDB.TblResetModified(this.Parent.MstTblIndex,-1)}}}if(M){this.Parent.FireAfterInsert()}else{this.Parent.FireAfterUpdate()}v++;if(this.IsDO&&this.Document!=null){if(A){this.Document.EndTrans();this.Document.Validate(1,0,true);this.Parent.DumpDocErrors(this.Document,K,false,null)}else{this.Document.ClearErrors();this.Document.AddDocError(F.stringValue())}if(this.Document.Deleted()){this.Parent.ClearRD3Cache(this.ActualPosition+K)}}}for(var J=0;J<this.Parent.UMaster();J++){this.Parent.bMaster(J).bValues(K).Modified=false}}}catch(E){D.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",97,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": DB error while updating records (Error = "+E.message+")");u++;y=false;x=new IDVariant(true);var o=new IDVariant(false);var H=0;D.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,60,"IDPanel.FireOnDBError","Panel "+this.Parent.GetDTTCaption()+": Fire OnDBError Event");this.Parent.Parent.OnDBError(this.Parent,x,o,new IDVariant(H),new IDVariant(E.message),new IDVariant(ErrorHandlerSrv.GetErrorNumber(E)),new IDVariant(Glb.PANOP_UPDATE),null);if(x.isTrue()){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",98,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": update operation interrupted after a DB error");if(o.isFalse()){this.Parent.FireDBError(this.DB,this.DBType,Glb.PANOP_UPDATE,E)}break}}}if(this.IDColl!=null){this.IDColl.set_UIMode(false)}this.Parent.ValidatingRow=-1;if(!y){if(this.IMDBDataSource==-1&&!this.IsDO){try{this.RS.moveToCurrentRow();this.RS.restoreOriginal()}catch(P){}}}else{}try{if(N){if(this.LookupRows!=null&&this.LookupRows.length<this.RecordCount()){var B=this.LookupRows.length;Array.resize(this.LookupRows,this.RecordCount());for(var R=B;R<this.LookupRows.length;R++){this.LookupRows[R]=R+1}}}if(this.RS!=null&&this.IMDBDataSource==-1&&!this.IsDO){this.RS.MoveLast();if(this.ActualPosition<=this.RecordCount()){this.RS.MoveFirst();this.GotoAbsolute(this.ActualPosition)}else{this.GotoLast()}}}catch(P){}if(!this.IsDO||!this.IsMasterDO||!this.Parent.FinalUpdate){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,59,"IDPanel.FireAfterCommit","Panel "+this.Parent.GetDTTCaption()+": Fire AfterCommit Event");this.Parent.Parent.AfterCommit(this.Parent,new IDVariant(v),new IDVariant(u))}this.UpdateIMDB(this.Parent.AttR,true,false,false);if(this.Parent.MainFrm!=null&&this.IMDBDataSource==-1&&v>0){D.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",189,"PQuery.UpdateRecords","Panel "+this.Parent.GetDTTCaption()+": refreshing "+this.MstTableName+" lookups");this.RefreshAllLookups()}this.Parent.UpdateDynRows(this.RecordCount());return y};PQuerySrv.prototype.UpdateIMDB=function(c,b,a,d){var f=b;if(this.Parent.MstTblIndex==-1){if(this.IsDO&&a){this.Parent.FireOnChangeRow()}return false}if(this.Parent.IMDB==null){return false}for(var g=0;g<this.Parent.IMDB.TblNumField(this.Parent.MstTblIndex);g++){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,g,0,new IDVariant())}if(this.IsDO){if(this.Document==null){b=false}if(this.IDColl==null){b=false}if(this.IDColl!=null){if(this.IDColl.IsEof()){b=false}}}else{if(this.IMDBDataSource==-1&&this.RS.size()==0){b=false}else{if(this.ActualPosition+c>this.RecordCount()){b=false}}}if(b&&d){if(this.IsDO){if(this.IDColl!=null){this.IDColl.set_AbsolutePosition(this.ActualPosition+c)}}else{if(this.IMDBDataSource>-1){if(!this.IMDBAbsolutePosition(this.ActualPosition+c)){b=false}}else{b=false;try{this.GotoAbsolute(this.ActualPosition+c);b=true}catch(h){}}}}if(f){if(this.IDColl!=null){this.Document=this.IDColl.GetAt()}if(b){for(var g=0;g<this.Parent.UMaster();g++){var j=this.Parent.bMaster(g);var l=j.GetIMDBIdx();if(l>-1){if(this.IsDO){if(this.Document!=null&j.GetDOIdx(this.Document)>0){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Document.GetPropByIndex(j.GetDOIdx(this.Document)))}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Parent.IMDB.Value(this.IMDBDataSource,j.GetRSIMDBIdx(this.IMDBDataSource),Glb.IMDB_CURSOR))}else{try{var k=this.RS.Get(j.GetRSIdx(this.RS));k=Glb.GetTD(k,j.Transformation,j.TrFormat,j.TrOffset,j.MaxLength);this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,k)}catch(h){}}}}}}for(var g=0;g<this.Parent.UMaster();g++){var l=this.Parent.bMaster(g).GetIMDBIdx();if(l>-1&&c>=0&&c<this.Parent.NumRows){this.Parent.IMDB.set_Value(this.Parent.MstTblIndex,l,0,this.Parent.bMaster(g).bValues(c).Value)}}}if(a){this.Parent.FireOnChangeRow()}return b};PQuerySrv.prototype.UpdateParam=function(d){var g=false;var b=false;if(this.IMDBDataSource>-1){return this.Parent.IMDB.TblModified(this.IMDBDataSource,1)||d}if(!this.QueryOK){this.PrepareParam();g=this.QueryParameters.Count()>0}var c=0;for(var e=0;e<this.QueryParameters.Count();e++){var a=this.QueryParameters[e];if(a.TblIdx>-1&&a.FldIdx>-1){if(this.Parent.IMDB.TblModified(a.TblIdx,Glb.GlbRefModIdx)||d){b=true;if(!this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0).equals(a.AttValue)){a.AttValue=this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);g=true}}}c=c+1}if(g){this.RSParam.Clear();this.NumQBEParameters=0;for(var f=0;f<this.QueryParameters.Count();f++){var a=this.QueryParameters[f];this.RSParam.Add(a.AttValue)}}return g&&b};PQuerySrv.prototype.PrepareParam=function(f,e){if(e==undefined){e=null}var d;for(var c=Glb.SQL_SELECT;c<=Glb.SQL_WHERE;c++){if(this.Text[c]==null){continue}var j=-1;var h=-1;if(!f){d=this.Text[c]}else{d=e.stringValue()}var g=true;while(g||(j>-1&&h>-1)){g=false;j=d.indexOf("~~",j+1);h=d.indexOf("~~",j+1);if(j>=0&&h>=0){var k=d.substr(j+2,h-(j+2));if(!f){d=d.substr(0,j)+"?"+d.substr(h+2)}var a=new PQueryParamSrv();if(!f){this.QueryParameters.Add(a)}var b=k.lastIndexOf(".");if(b>=0){a.TblIdx=this.Parent.IMDB.TblByCode(k.substr(0,b),this.Parent.MainFrm);if(a.TblIdx>-1){a.FldIdx=this.Parent.IMDB.FldByCode(a.TblIdx,k.substr(b+1))}}if(a.FldIdx>-1){a.AttValue=this.Parent.IMDB.Value(a.TblIdx,a.FldIdx,0);a.DataType=this.Parent.IMDB.GetFldDataType(a.TblIdx,a.FldIdx);a.MaxLength=this.Parent.IMDB.GetFldMaxLength(a.TblIdx,a.FldIdx);a.vScale=this.Parent.IMDB.GetFldScale(a.TblIdx,a.FldIdx);if(f){d=d.substr(0,j)+Glb.ToSql(a.AttValue,this.DBType,this.DB)+d.substr(h+2)}}}}if(!f){this.Text[c]=d}else{e.set(new IDVariant(d));break}}this.QueryOK=true};PQuerySrv.prototype.GetBlobFromCache=function(d,h,j){var a=null;var e=null;if(this.IsDO){if(this.IDColl!=null){e=this.IDColl.GetAt()}else{if(this.Document!=null){e=this.Document}}}else{if(this.IMDBDataSource>-1){e=this.Parent.IMDB.GetRowBookMark(this.IMDBDataSource,Glb.IMDB_CURSOR)}else{e=this.RS.BookMark()}}for(var g=0;g<this.BlobCache.Count();g++){a=this.BlobCache[g];if(a.FldIndex==d&&a.BookMark==e){return a.BlobNum}}a=new PBlobCacheSrv();this.BlobCache.Add(a);a.BlobNum=Math.floor(Math.random()*1000000000)+1;a.BookMark=e;a.FldIndex=d;a.RSIndex=h;a.Size=-1;var c=null;if(this.IsDO){if(this.RSIndex<1){if(this.Parent.Fields[d].IsNamed){c=e.GetNamedPropertyValue(this.Parent.Fields[d].Code)}else{c=new IDVariant()}}else{c=e.GetPropByIndex(h)}}else{if(this.IMDBDataSource>-1){c=this.Parent.IMDB.Value(this.IMDBDataSource,h,Glb.IMDB_CURSOR)}else{c=this.RS.Get(h)}}var f=null;if(c.Type!=IDVariant.NULL){f=c.Value;a.Size=f.length}if(a.Size==-1){a.Size=0}a.ToDownload=(a.Size<j)&&!this.Parent.Parent.MainFrm.ParamsObj().NativeBlob;if(!this.Parent.Parent.MainFrm.ParamsObj().NativeBlob){this.GetMimeData(a,f)}return a.BlobNum};PQuerySrv.prototype.GetBlobData=function(d,c){for(var e=0;e<this.BlobCache.Count();e++){var a=this.BlobCache[e];if((a.FldIndex==d||d==-1)&&a.BlobNum==c){return a}}return null};PQuerySrv.prototype.DownloadBlob=function(g,m,c){var l=this.GetBlobData(-1,g);if(l!=null&&l.IsValid!=0){try{var d=null;if(this.IsDO){if(l.RSIndex<1){if(this.Parent.Fields[l.FldIndex].IsNamed){d=l.BookMark.GetNamedPropertyValue(this.Parent.Fields[l.FldIndex].Code)}else{d=new IDVariant()}}else{d=l.BookMark.GetPropByIndex(l.RSIndex)}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,l.BookMark);d=this.Parent.IMDB.Value(this.IMDBDataSource,l.RSIndex,Glb.IMDB_CURSOR)}else{this.RS.absolute(l.BookMark);d=this.RS.Get(l.RSIndex)}}var t=d.Value;if(l.IsValid==-1){this.GetMimeData(l,t)}if(l.IsValid==1){if(!this.Parent.MainFrm.ParamsObj().NativeBlob){t=t.substring(16)}var q=new IDVariant();var p=new IDVariant(1);var f=new IDVariant(l.FileName);var a=new IDVariant(l.Extension);var o=new IDVariant(l.MimeType);this.Parent.Parent.OnDownloadBlob(this.Parent,q,new IDVariant(l.FldIndex),new IDVariant(l.Size),a,p,f,o);if(!a.stringValue().equals(l.Extension)&&o.stringValue()==l.MimeType){o=new IDVariant(this.Parent.MainFrm.GetMimeType(a.stringValue()))}l.FileName=f.stringValue();l.Extension=a.stringValue();l.MimeType=o.stringValue();if(q.isFalse()){if(m!=null){if(l.Extension.length>0){if(l.FileName.length==0){l.FileName="documento."+l.Extension}else{if(!l.FileName.toUpperCase().endsWith("."+l.Extension.toUpperCase())){l.FileName+="."+l.Extension}}}m.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",157,"PQuery.DownloadBlob","Panel "+this.Parent.GetDTTCaption()+": about to download blob");m.DTTObj.AddParameter("","","File Name",new IDVariant(l.FileName));m.DTTObj.AddParameter("","","Mime Type",new IDVariant(o));m.DTTObj.AddParameter("","","Size",new IDVariant(l.Size));m.DTTObj.AddParameter("","","Inline",p)}if(c){l.FileName=t}else{if(m.ShellObject.IsInsideShell()){l.FileName=Glb.SaveBlob(m,d).stringValue();if(l.FileName.length>0){l.FileName=l.FileName.substring(m.RealPath.length+1)}}else{var r=new Uint8Array(t.length);for(var h=0;h<t.length;h++){r[h]=t.charCodeAt(h)}var j=new BlobBuilder();j.append(r.buffer);var d=j.getBlob(o);l.FileName=URL.createObjectURL(d)}}return true}else{if(m!=null){m.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",99,"PQuery.DownloadBlob","Panel "+this.Parent.GetDTTCaption()+": blob download canceled")}}}}catch(k){WriteToConsoleError(k)}}return false};PQuerySrv.prototype.GetMimeData=function(a,d){if(this.Parent.MainFrm.ParamsObj().NativeBlob){a.Extension="bin";a.IsValid=1;return}a.IsValid=0;if(d==null){return}if(d.length-d.Position<16){return}if(d.substr(0,4)=="BLOB"){var e=Math.min(d.indexOf(String.fromCharCode(0)),15);var c=d.substring(4,e);a.IsValid=1;a.Extension=c;a.MimeType=this.Parent.MainFrm.GetMimeType(a.Extension)}else{this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"PQuery.GetMimeData","Panel "+this.Parent.GetDTTCaption()+": unknown Blob type (header not found)")}};PQuerySrv.prototype.WriteTextBlob=function(a,b){this.DownloadBlob(a,b,true)};PQuerySrv.prototype.SaveBlobFile=function(c,d){var a=this.GetBlobData(-1,c);if(a!=null&&a.IsValid!=0){try{var f=null;if(this.IsDO){if(a.RSIndex<1){if(this.Parent.Fields[a.FldIndex].IsNamed){f=a.BookMark.GetNamedPropertyValue(this.Parent.Fields[a.FldIndex].Code)}else{f=new IDVariant()}}else{f=a.BookMark.GetPropByIndex(a.RSIndex)}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,a.BookMark);f=this.Parent.IMDB.Value(this.IMDBDataSource,a.RSIndex,Glb.IMDB_CURSOR)}else{this.RS.absolute(a.BookMark);f=this.RS.Get(a.RSIndex)}}a.FileName="";a.FileName=Glb.SaveBlob(d,f).stringValue();d.TempFiles.Add(a.FileName);if(d.ShellObject.IsInsideShell()&&a.FileName.length>0){a.FileName=a.FileName.substring(d.RealPath.length+1)}}catch(g){WriteToConsoleError(g)}}};PQuerySrv.prototype.DeleteBlob=function(e,a){var d=new IDVariant(a.Extension);var c=new IDVariant(-1);var f=new IDVariant();e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeBlobUpdate Event");this.Parent.Parent.BeforeBlobUpdate(this.Parent,f,new IDVariant(a.FldIndex),c,d,new IDVariant(""));if(f.isTrue()){e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",101,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": blob deletion canceled");return}try{if(this.IsDO){if(a.RSIndex<1){if(this.Parent.Fields[a.FldIndex].IsNamed){a.BookMark.SetNamedPropertyValue(this.Parent.Fields[a.FldIndex].Code,new IDVariant())}}else{a.BookMark.SetPropByIndex(a.RSIndex,new IDVariant())}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,a.BookMark);this.Parent.IMDB.set_Value(this.IMDBDataSource,a.RSIndex,Glb.IMDB_CURSOR,new IDVariant())}else{this.InitConnection();this.RS.absolute(a.BookMark);this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));this.RS.updateNull(a.RSIndex);this.RS.updateRow();this.RS.acceptChanges(this.DB)}}e.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,53,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Fire AfterBlobUpdate Event");this.Parent.Parent.AfterBlobUpdate(this.Parent,new IDVariant(a.FldIndex),c,d);a.IsValid=0;a.MimeType="";a.Size=0;a.ToDownload=false}catch(g){e.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",90,"PQuery.DeleteBlob","Panel "+this.Parent.GetDTTCaption()+": Delete Blob error (Err="+g.message+")");WriteToConsoleOutput(g)}};PQuerySrv.prototype.GetValueSource=function(l,M,L,x,m,J,r){var a=false;if(m){if(!this.QueryOK||this.LastPreparedQueryIndex!=1){this.PrepareLookup(1);a=true}}else{if(!this.QueryOK||this.LastPreparedQueryIndex!=0){this.PrepareLookup(0);a=true}}if(x&&L.stringValue().length==0){x=false}if(this.IsDO){if(this.Document!=null){if(J){a=true}else{this.Document.Clear();for(var G=0;G<this.LookupParams.Count();G++){var y=this.LookupParams[G];if(m&&y.AutoLookup){continue}if(y.TblIdx==this.Parent.MstTblIndex){var u=this.Parent.IMDB.FldCode(y.TblIdx,y.FldIdx);y.TblIdx=-1;for(var j=0;j<this.Parent.UMaster();j++){if(this.Parent.bMaster(j).Code.equals(u)){y.MstField=this.Parent.bMaster(j);break}}}if(y.PropIdx==-1&&y.PropName.length>0){y.PropIdx=this.Document.GetPropIndex(y.PropName);if(y.PropIdx<1){y.PropIdx=this.Document.GetPropertyIndex(y.PropName)}y.PropName=""}var o;if(y.MstField!=null){o=y.MstField.bValues(M).Value}else{if(y.Value!=null){o=y.Value}else{o=this.Parent.IMDB.Value(y.TblIdx,y.FldIdx,0)}}if(y.PropIdx>0){this.Document.SetPropByIndex(y.PropIdx,o)}}try{this.Document.LoadValueSource(this.RS,this.VisibleColumns)}catch(I){}}}}else{if(this.LookupParams.Count()!=this.RSParam.Count()){a=true}if(!a){for(var A=0;A<this.LookupParams.Count();A++){var y=this.LookupParams[A];var D=this.RSParam[A];if(y.MstField==null){a|=!D.equals(this.Parent.IMDB.Value(y.TblIdx,y.FldIdx,0))}else{if(this.Parent.Status()==Glb.PS_QBE&&(y.MstField.Flags&Glb.FLD_AUTOLOOKUP)==0){a|=!D.equals(new IDVariant(y.MstField.bValues(M).Text))}else{a|=!D.equals(y.MstField.bValues(M).Value)}}}}if(a){this.RSParam.Clear();try{for(var q=0;q<this.LookupParams.Count();q++){var y=this.LookupParams[q];if(y.MstField==null){this.RSParam.Add(this.Parent.IMDB.Value(y.TblIdx,y.FldIdx,0))}else{if(this.Parent.Status()==Glb.PS_QBE&&(y.MstField.Flags&Glb.FLD_AUTOLOOKUP)==0){this.RSParam.Add(new IDVariant(y.MstField.bValues(M).Text))}else{this.RSParam.Add(y.MstField.bValues(M).Value)}}}l.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Get value source","Value Source Query",DTTEngine.STMT_QRY_SELECT,this.RS.getCommand());var k=1;for(var d=0;d<this.RSParam.Count();d++){var c=this.RSParam[d];l.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+k++,c)}this.InitConnection();this.RS.execute(this.RSParam,this.DB);if(!this.RS.EOF()){this.RS.MoveNext()}l.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());l.DTTObj.EndQuery(this.iGuid)}catch(u){l.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Error: "+u.message);l.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()));WriteToConsoleError(u)}}}if(!J&&this.RS.IsOpen()){try{var f=this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields();var h=false;if(r!=null&&this.HeaderColumns!=null&&this.VisibleColumns!=null){var b="";for(var E=0;E<this.VisibleColumns.Count();E++){var B=this.VisibleColumns[E];if(this.RS.findColumn(B)!=-1){b+=(b.length>0?"|":"")+this.HeaderColumns[B]}else{l.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Column "+B+" is not in the query's select list");l.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}}r.SetAttribute("hdr",b);var K=this.RS.GetName(f);for(var E=0;E<this.VisibleColumns.Count();E++){if(this.VisibleColumns[E].equals(K)){r.SetAttribute("dcc",(E+1).toString());break}}}if(this.Parent.bFields(this.FieldIndex).IsComboOptional(M)){if(r==null){}else{var C=r.AddNewElement("vli");C.SetAttribute("txt","");C.SetAttribute("val","")}}while(!this.RS.EOF()){if(r==null){}else{var C=r.AddNewElement("vli");if(this.VisibleColumns!=null){var t="";for(var E=0;E<this.VisibleColumns.Count();E++){var B=this.VisibleColumns[E];if(this.RS.findColumn(B)!=-1){t+=(t.length>0?"|":"")+this.RS.Get(B).stringValue()}}C.SetAttribute("txt",t)}else{C.SetAttribute("txt",this.RS.Get(f).stringValue())}C.SetAttribute("val",this.RS.Get(1).stringValue());var F=new IDVariant(true);var H=new IDVariant("");var g=new IDVariant("");if(this.RS.findColumn("ENABLED")!=-1){F=this.RS.Get("ENABLED")}if(this.RS.findColumn("ICON")!=-1){H=this.RS.Get("ICON")}if(this.RS.findColumn("GROUPID")!=-1){g=this.RS.Get("GROUPID")}if(F.Type!=IDVariant.NULL&&F.booleanValue()!=true){C.SetAttribute("ena",F.booleanValue()?"-1":"0")}if(H.Type!=IDVariant.NULL&&!H.stringValue().equals("")){C.SetAttribute("img",H.stringValue())}if(g.Type!=IDVariant.NULL&&!g.stringValue().equals("")){C.SetAttribute("gru",g.stringValue())}}this.RS.MoveNext()}if(this.RS.RecordCount()>0){this.RS.MoveFirst()}}catch(u){l.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",159,"PQuery.GetValueSource","Panel "+this.Parent.GetDTTCaption()+" - Error while filling the ComboBox: "+u.message);l.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()));WriteToConsoleError(u)}}return a};PQuerySrv.prototype.GetValueSourceValue=function(a){var b=false;var c=new IDVariant();if(this.RS.IsOpen()){while(!this.RS.EOF()){if(this.RS.Get(1).equals(a)){b=true}else{if(this.RS.Get(1).Type==IDVariant.STRING&&a.Type!=IDVariant.NULL){if(this.RS.Get(1).stringValue().trim()==a.stringValue().trim()){b=true}}}if(b){c=this.RS.Get(this.DecodeColumn>0?this.DecodeColumn:this.RS.GetNumFields());break}this.RS.MoveNext()}if(this.RS.RecordCount()>0){this.RS.MoveFirst()}}return c};PQuerySrv.prototype.DoUpdateLookups=function(c,a){if(this.Parent.DisableLookups){return}for(var b=1;b<this.Parent.UQueries();b++){if(this.Parent.bQueries(b).FieldIndex==-1){this.Parent.bQueries(b).UpdateLookup(c,a)}else{if((this.Parent.bFields(this.Parent.bQueries(b).FieldIndex).Flags&Glb.FLD_AUTOLOOKUP)!=0){this.Parent.bQueries(b).UpdateLookup(c,a)}}}};PQuerySrv.prototype.EnableSorting=function(b){var d=true;if(this.IsDO){if(this.IDColl!=null){this.IDColl.ClearSort();for(var c=0;c<b.Count();c++){var e=b[c];var a=e.GetDOIdx(null);if(a<0){this.IDColl.ClearSort();return false}this.IDColl.SortBy(a*e.SortMode)}this.IDColl.EnableSort()}return d}if(this.IMDBDataSource>-1){this.Parent.IMDB.TblInitSort(this.IMDBDataSource)}else{this.InitSort()}for(var c=0;c<b.Count();c++){var e=b[c];if(this.IMDBDataSource>-1){this.Parent.IMDB.TblSortBy(this.IMDBDataSource,e.GetRSIMDBIdx(this.IMDBDataSource),(e.SortMode==1))}else{this.SortBy(e.GetRSIdx(this.RS),(e.SortMode==1))}}if(this.IMDBDataSource>-1){this.Parent.IMDB.TblStartSort(this.IMDBDataSource)}else{this.StartSort()}return d};PQuerySrv.prototype.UploadBlob=function(h,r,d){var o=false;var q=this.GetBlobData(-1,h);if(q!=null){try{var u=r.Request.Files[0];if(u.ContentLength>d){throw new Error("Uploaded file size ("+u.ContentLength+" bytes) exceeds upload limit of "+d+" bytes")}var c=u.FileName;var l=u.ContentType;var a=new IDVariant();var t="";var g=c.lastIndexOf(".");if(g>-1){a=new IDVariant(c.substr(g+1));t=c.substr(0,g)}else{t=c}var s=new IDVariant();r.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,48,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": Fire BeforeBlobUpdate Event");this.Parent.Parent.BeforeBlobUpdate(this.Parent,s,new IDVariant(q.FldIndex),new IDVariant(u.ContentLength),a,new IDVariant(c));if(s.isFalse()){if(this.IsDO){if(q.RSIndex<1){if(this.Parent.Fields[q.FldIndex].IsNamed){q.BookMark.SetNamedPropertyValue(this.Parent.Fields[q.FldIndex].Code,Glb.LoadBlob(this.Parent.MainFrm,u))}}else{q.BookMark.SetPropByIndex(q.RSIndex,Glb.LoadBlob(this.Parent.MainFrm,u))}}else{if(this.IMDBDataSource>-1){this.Parent.IMDB.TblGoToAbsoluteRow(this.IMDBDataSource,Glb.IMDB_CURSOR,q.BookMark);this.Parent.IMDB.set_Value(this.IMDBDataSource,q.RSIndex,Glb.IMDB_CURSOR,Glb.LoadBlob(this.Parent.MainFrm,u))}else{this.InitConnection();this.RS.absolute(q.BookMark);this.RS.setTableName(this.DB.ApplySubstitutions(this.MstTableName));Glb.LoadBlob(r,this.RS,q.RSIndex,u,this.DB)}}q.IsValid=1;q.MimeType=r.GetMimeType(a.stringValue());q.Size=u.ContentLength+(this.Parent.Parent.MainFrm.ParamsObj().NativeBlob?0:16);q.Extension=a.stringValue();q.ToDownload=q.Size<this.Parent.Fields[q.FldIndex].MaxAutoShowSize;r.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,53,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": Fire AfterBlobUpdate Event");this.Parent.Parent.AfterBlobUpdate(this.Parent,new IDVariant(q.FldIndex),new IDVariant(u.ContentLength),a);r.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.iGuid,84,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob successfully uploaded");o=true;this.Parent.SetInfoMessage(r.RTCObj.GetConst("C3B4AFB6-764C-4D37-8783-F058E9718E88","Il file è stato caricato."))}else{r.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",102,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob upload canceled");r.TempFiles.Add(q.FileName)}var v=new Uint8Array(u.Content.length);for(var j=0;j<u.Content.length;j++){v[j]=u.Content.charCodeAt(j)}var k=new BlobBuilder();k.append(v.buffer);var f=r.GetMimeType(a.stringValue());q.FileName=URL.createObjectURL(k.getBlob(f))}catch(m){r.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.Parent.iGuid,84,"PQuery.UploadBlob","Panel "+this.Parent.GetDTTCaption()+": blob not uploaded (Error = "+m.message+")");this.Parent.SetInfoMessage(AMessageSrv.MSG_WARN,r.RTCObj.GetConst("93D4A2C8-F406-4B9C-9D48-3B54247F2412","Il file NON è stato caricato."),2)}}return o};PQuerySrv.prototype.PrepareLastWhereClause=function(){var f,d=0;var a=false;var m=false;var k;try{var c=this.RS.getParams();f=0;var g=this.Text[Glb.SQL_SELECT]+this.Text[Glb.SQL_FROM];for(var l=0;l<g.length;l++){if(!m&&g.charAt(l)=="'"){a=!a}if(!a&&g.charAt(l)=='"'){m=!m}if(!a&&!m){if(g.charAt(l)=="?"){d++}}}a=false;m=false;while(f<this.LastWhereClause.length){if(!m&&this.LastWhereClause.charAt(f)=="'"){a=!a}if(!a&&this.LastWhereClause.charAt(f)=='"'){m=!m}if(!a&&!m){if(this.LastWhereClause.charAt(f)=="?"){k=IDVariant.convertObject(c[d]);d=d+1;if(k==null){this.LastWhereClause=this.LastWhereClause.substr(0,f)+"NULL"+this.LastWhereClause.substr(f+1)}else{var b=IDL.FMT_NUM;switch(k.Type){case IDVariant.STRING:b=IDL.FMT_CHAR;break;case IDVariant.DATETIME:if(Glb.ClassDB(this.DBType)==Glb.DBC_ACCESS){b=IDL.FMT_DAT1}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_ORACLE||Glb.ClassDB(this.DBType)==Glb.DBC_POSTGRES){b=IDL.FMT_DAT3}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE){b=IDL.FMT_DAT4}else{b=IDL.FMT_DAT2}}}break}this.LastWhereClause=this.LastWhereClause.substr(0,f)+IDL.CSql(k,b,this.DB)+this.LastWhereClause.substr(f+1)}}else{f=f+1}}else{f=f+1}}}catch(h){}};PQuerySrv.prototype.IMDBAbsolutePosition=function(c){c=c-1;if(this.IMDBDataSource==-1){return false}var a=this.Parent.IMDB.TblNumRows(this.IMDBDataSource);if(a<=c){this.Parent.IMDB.TblMoveLast(this.IMDBDataSource,Glb.IMDB_CURSOR);return false}this.Parent.IMDB.TblMoveFirst(this.IMDBDataSource,Glb.IMDB_CURSOR);for(var b=0;b<c;b++){this.Parent.IMDB.TblMoveNext(this.IMDBDataSource,Glb.IMDB_CURSOR)}return true};PQuerySrv.prototype.CheckIMDBLookupParam=function(){for(var a=0;a<this.LookupParams.Count();a++){var b=this.LookupParams[a];if(b.MstField==null&&b.TblIdx>-1){if(this.Parent.IMDB.TblModified(b.TblIdx,1)){return true}}}return false};PQuerySrv.prototype.InitConnection=function(){if(!this.DB.IsOpen()){this.Parent.MainFrm.OpenConnection(this.DB)}};PQuerySrv.prototype.GotoAbsolute=function(a){if(this.LookupRows==null||this.LookupRows.length<a){this.RS.absolute(a)}else{this.RS.absolute(this.LookupRows[a-1])}this.CursorPos=a};PQuerySrv.prototype.GotoNext=function(){if(this.LookupRows==null){this.RS.MoveNext()}else{this.CursorPos++;if(this.CursorPos<=this.LookupRows.length){this.RS.absolute(this.LookupRows[this.CursorPos-1])}}};PQuerySrv.prototype.GotoFirst=function(){if(this.LookupRows==null){this.RS.MoveFirst()}else{this.GotoAbsolute(1)}};PQuerySrv.prototype.GotoLast=function(){if(this.LookupRows==null){this.RS.MoveLast()}else{this.GotoAbsolute(this.LookupRows.length)}};PQuerySrv.prototype.RSEOF=function(){if(this.LookupRows==null){return this.RS.EOF()}else{return this.CursorPos>this.LookupRows.length}};PQuerySrv.prototype.InitSort=function(){this.LookupRows=null;this.NumSort=0;this.CursorPos=1};PQuerySrv.prototype.SortBy=function(b,a){if(this.SortColumns==null){this.SortColumns=new Array(32);this.SortAscending=new Array(32)}this.SortColumns[this.NumSort]=b;this.SortAscending[this.NumSort]=a;this.NumSort++};PQuerySrv.prototype.StartSort=function(){if(this.NumSort==0||this.RS.size()==0){return}var b=new Array(this.RS.size());for(var c=0;c<b.length;c++){b[c]=c+1}function e(g,a){var h=0;for(var l=0;l<d.NumSort&&h==0;l++){var k=null;var j=null;try{k=d.RS.GetObjectDirect(g,d.SortColumns[l]);j=d.RS.GetObjectDirect(a,d.SortColumns[l]);if(d.Parent!=null){try{var m=d.Parent.SortingList[l];if(m.Transformation!=Glb.TRANSF_NONE&&m.Transformation!=Glb.TRANSF_NULL){var q=Glb.GetTD(IDVariant.convertObject(k),m.Transformation,m.TrFormat,m.TrOffset,m.MaxLength);var p=Glb.GetTD(IDVariant.convertObject(j),m.Transformation,m.TrFormat,m.TrOffset,m.MaxLength);k=q.Value;j=p.Value}}catch(o){}}if(k==null){h=(j==null)?0:-1}else{if(j==null){h=(k==null)?0:1}else{if(typeof(k)=="string"&&typeof(k)=="string"){h=String.compare(k,j,true)}else{if(k<j){h=-1}else{if(k>j){h=1}else{h=0}}}}}if(!d.SortAscending[l]){h=-h}}catch(o){WriteToConsoleError("Errore in Order By");WriteToConsoleError(o)}}return h}var d=this;b=b.sort(e);delete d;this.LookupRows=new Array(this.RS.size());for(var c=0;c<b.length;c++){this.LookupRows[c]=b[c]}};PQuerySrv.prototype.WriteUnboundValue=function(c,a){var b=true;try{if(this.IMDBDataSource>-1){this.IMDBAbsolutePosition(this.ActualPosition+c)}else{this.GotoAbsolute(this.ActualPosition+c)}if(this.IMDBDataSource==-1){this.RS.Set(a.GetRSIdx(this.RS),a.bValues(c).Value)}else{this.Parent.IMDB.set_Value(this.IMDBDataSource,a.GetRSIdx(null),Glb.IMDB_CURSOR,a.bValues(c).Value)}if(this.IMDBDataSource==-1){this.RS.updateRow();this.RS.setOriginalRow()}}catch(d){b=false}return b};PQuerySrv.prototype.ClearUnboundData=function(){this.UnboundData.Clear()};PQuerySrv.prototype.AddLookupParam=function(a,e,d,c){var b=new PLookupParamSrv();b.TblIdx=a;b.FldIdx=e;b.PropName=d;b.AutoLookup=c;this.LookupParams.Add(b)};PQuerySrv.prototype.AddLookupValue=function(c,a){var b=new PLookupParamSrv();b.PropName=c;b.Value=a;this.LookupParams.Add(b)};PQuerySrv.prototype.AddLKEParam=function(c,a){if(this.LKEParams==null){this.LKEParams=new ArrayList();this.LKERows=new ArrayList()}var b=new PLookupParamSrv();b.FldIdx=c;b.PropName=a;this.LKEParams.Add(b)};PQuerySrv.prototype.AddVisibleColumn=function(a){if(this.VisibleColumns==null){this.VisibleColumns=new ArrayList()}this.VisibleColumns.Add(a)};PQuerySrv.prototype.AddHeaderColumn=function(a,b){if(this.HeaderColumns==null){this.HeaderColumns=new HashTableSrv()}this.HeaderColumns[a]=b};PQuerySrv.prototype.SetDecodeColumn=function(a){this.DecodeColumn=a};PQuerySrv.prototype.AddLKERow=function(b){var a=b;if(!this.LKERows.Contains(a)){this.LKERows.Add(a)}};PQuerySrv.prototype.UpdateLKE=function(a){if(this.LKEParams==null){return false}var d=false;for(var c=0;c<this.LKERows.Count();c++){var b=this.LKERows[c];if(this.IsDO){d=d|this.UpdateDoLKE(a,b)}else{d=d|this.UpdateLKERow(a,b)}}this.LKERows.Clear();return d};PQuerySrv.prototype.UpdateDoLKE=function(f,B){var d=false;var u=false;var h=false;if(this.Document!=null){try{this.Document.Clear();var b=new ArrayList();for(var c=0;c<this.LookupParams.Count();c++){var m=this.LookupParams[c];if(m.PropIdx==-1&&m.PropName.length>0){m.PropIdx=this.Document.GetPropIndex(m.PropName);if(m.PropIdx<1){m.PropIdx=this.Document.GetPropertyIndex(m.PropName)}m.PropName=""}if(m.Value!=null){if(m.PropIdx>0){this.Document.SetPropByIndex(m.PropIdx,m.Value);b.Add(m.PropIdx)}}else{if(m.TblIdx!=this.Parent.mMstTblIndex&&m.TblIdx>-1&&m.FldIdx>-1){var g=this.Parent.IMDB.Value(m.TblIdx,m.FldIdx,0);if(m.PropIdx>0){this.Document.SetPropByIndex(m.PropIdx,g);b.Add(m.PropIdx)}}if(m.MstField!=null){h=false;for(var z=0;z<this.LKEParams.Count();z++){var q=this.LKEParams[z];if(q.FldIdx==m.MstField.Index){h=true;break}}if(!h){var g;if(this.Parent.Status()==Glb.PS_QBE){g=new IDVariant(m.MstField.bValues(B).Text)}else{g=m.MstField.bValues(B).Value}if(m.PropIdx>0){this.Document.SetPropByIndex(m.PropIdx,g);b.Add(m.PropIdx)}}if(m.MstField.IsExtended&&m.MstField.IDLista.length>0){var s=this.Document.GetPropertyIndex("DO_LISTID",true,true,true,true);if(s>0){this.Document.SetPropByIndex(s,new IDVariant(m.MstField.IDLista));b.Add(s)}}}}}for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(!this.Parent.bFields(t).bValues(B).Value.equals(this.Parent.bFields(t).bValues(B).OrgValue)){if(this.PreviuosDocument!=null){var A=this.Document.GetMD();for(var s=1;s<=A.GetNumProp();s++){if(A.GetProp(s).DescribeRow){this.Document.SetPropByIndex(s,this.Parent.bFields(t).bValues(B).Value)}}}else{if(this.Parent.bFields(t).GetDOIdx(this.Document)>0){this.Document.SetPropByIndex(this.Parent.bFields(t).GetDOIdx(this.Document),this.Parent.bFields(t).bValues(B).Value)}}}}}d=false;u=true;var x=new IDVariant(d);var k=this.Parent.GetDocument(B);if(k==null){k=this.Parent.LastMasterDocument}this.LastLKETry=this.Document.GetLKE(this.RS,x,b,k);d=x.isTrue();if(this.RS.RecordCount()>0){u=false}}catch(y){u=true}try{var a=false;if(this.LkeMS!=null&&this.LkeMS.RecordCount()>0){a=true}if(d){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(B).SetValue(new IDVariant(""))}}return this.ActivateLKE(B,true)}if(!a&&u){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(B).SetValue(this.Parent.bFields(t).bValues(B).OrgValue)}}return false}var r=false;if(f.ParamsObj().UseRD3){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){r|=((this.Parent.bFields(t).Flags&Glb.FLD_ACTIVE)!=0)}}}if(!a&&this.RS.RecordCount()==1&&!r){this.RS.MoveFirst();var o=this.ActivateLKE(B,false);for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(this.Parent.bFields(t).bValues(B).Value.stringValue().equals("*")){this.Parent.bFields(t).bValues(B).SetLkeRS(this.RS);return false}else{if(!o){this.Parent.bFields(t).bValues(B).SetValue(this.Parent.bFields(t).bValues(B).OrgValue)}this.Parent.bFields(t).bValues(B).SetLkeRS(null)}}}return o}for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(!this.Parent.bFields(t).bValues(B).Value.equals(this.Parent.bFields(t).bValues(B).OrgValue)){this.Parent.bFields(t).bValues(B).SetLkeRS(this.RS);return false}}}}catch(y){}}return false};PQuerySrv.prototype.UpdateLKERow=function(j,B){if(!this.QueryOK||this.LastPreparedQueryIndex!=1){this.PrepareLookup(1)}this.RSParam.Clear();for(var k=0;k<this.LookupParams.Count();k++){var o=this.LookupParams[k];if(o.MstField==null){this.RSParam.Add(this.Parent.IMDB.Value(o.TblIdx,o.FldIdx,0))}else{if(this.Parent.Status()==Glb.PS_QBE){this.RSParam.Add(new IDVariant(o.MstField.bValues(B).Text))}else{this.RSParam.Add(o.MstField.bValues(B).Value)}}}var v=0;var g=this.RS.getCommand();var z="";var f=false;var u=false;var m=-1;for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){m=this.Parent.bFields(t).Index;break}}try{do{this.RS.setCommand(this.DB.ApplySubstitutions(g));if(!this.AddLKEQBE(v,B)){f=true;break}if(!z.equals(this.RS.getCommand())){z=this.RS.getCommand();if(this.RS.IsOpen()){this.RS.Close()}var b=new IDVariant();var y=new IDVariant();var A=new IDVariant();this.Parent.FireGetLKE(this.RS,new IDVariant(v),A,b,y,new IDVariant(m));this.LkeRSLimitedBySystem=false;if(y.isTrue()||this.RS.RecordCount()>0){break}if(A.isTrue()){f=true;break}if(b.isFalse()){j.DTTObj.AddQuery(this.iGuid,this.Parent.GetDTTCaption()+" - Update LKE","Editable Lookup Query",DTTEngine.STMT_QRY_SELECT,z);var h=1;for(var d=0;d<this.RSParam.Count();d++){var a=this.RSParam[d];j.DTTObj.AddParameter(this.iGuid,this.Parent.Code,"Param "+h++,a)}this.RS.setMaxRows(PQuerySrv.MAX_LKE_ROWS+1);this.LkeRSLimitedBySystem=true;this.InitConnection();this.RS.execute(this.RSParam,this.DB);j.DTTObj.AddDBDataSource(this.RS,z);j.DTTObj.EndQuery(this.iGuid);this.LastLKERow=B;this.LastLKETry=v}}v++}while(this.RS.RecordCount()==0&&v<5);if(this.RS.RecordCount()==0){u=true}}catch(l){j.DTTObj.AddMsg((v>3)?DTTEngine.DTTMSG_WARN:DTTEngine.DTTMSG_ERROR,"",173,"PQuery.UpdateLKE","Panel "+this.Parent.GetDTTCaption()+": Update LKE error ("+l.message+")");u=true}try{this.RS.setCommand(this.DB.ApplySubstitutions(g))}catch(x){}var c=false;if(this.LkeMS!=null&&this.LkeMS.RecordCount()>0){c=true}if(f){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(B).SetValue(new IDVariant(""))}}return this.ActivateLKE(B,true)}if(!c&&u){for(var t=0;t<this.Parent.Fields.length;t++){if(this.Parent.bFields(t).IdxPanel==this.Index){this.Parent.bFields(t).bValues(B).SetValue(this.Parent.bFields(t).bValues(B).OrgValue)}}return false}var r=false;if(j.ParamsObj().UseRD3){for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){r|=((this.Parent.bFields(t).Flags&Glb.FLD_ACTIVE)!=0)}}}if(!c&&this.RS.RecordCount()==1&&!r){this.RS.MoveFirst();var q=this.ActivateLKE(B,false);for(var t=0;t<this.Parent.UFields();t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(this.Parent.bFields(t).bValues(B).Value.stringValue().equals("*")){this.Parent.bFields(t).bValues(B).SetLkeRS(this.RS);return false}else{if(!q){this.Parent.bFields(t).bValues(B).SetValue(this.Parent.bFields(t).bValues(B).OrgValue)}this.Parent.bFields(t).bValues(B).SetLkeRS(null)}}}return q}for(var t=0;t<this.Parent.Fields.length;t++){if(this.Parent.bFields(t).IdxPanel==this.Index){if(!this.Parent.bFields(t).bValues(B).Value.equals(this.Parent.bFields(t).bValues(B).OrgValue)){this.Parent.bFields(t).bValues(B).SetLkeRS(this.RS);return false}}}return false};PQuerySrv.prototype.ActivateLKE=function(d,m,h){if(h==undefined){h=-1}this.LastPreparedQueryIndex=-1;var c=false;for(var g=0;g<this.LKEParams.Count();g++){var b=this.LKEParams[g];try{var j=this.Parent.bFields(b.FldIdx);j.iMultiCriteria=false;if(m){c=c|j.bValues(d).SetNewText("",this.Parent.Status()!=Glb.PS_QBE)}else{var p=j.bValues(d).LastValue;var o=(h<=0&&(j.Flags&Glb.FLD_AUTOLOOKUP)!=0?j.bValues(d).Value.stringValue():j.bValues(d).Text);var a=(h>0?o+j.GetQBESep():"")+this.RS.Get(b.PropName).stringValue();c=c|j.bValues(d).SetNewText(a,this.Parent.Status()!=Glb.PS_QBE);if(h>0){j.bValues(d).LastValue=new IDVariant(p);j.iMultiCriteria=true}}}catch(k){}}return c};PQuerySrv.prototype.AddLKEQBE=function(w,A){var s="";var g="";var k="";var h=false;try{for(var u=0;u<this.Parent.Fields.length;u++){if(this.Parent.bFields(u).IdxPanel==this.Index){var f=false;k=this.Parent.bFields(u).bValues(A).Text;if(k.length>0&&!this.Parent.bFields(u).bValues(A).Value.equals(this.Parent.bFields(u).bValues(A).OrgValue)){h=true;if(k.charAt(0)=="*"){k="%"+k.substr(1)}if(k.charAt(k.length-1)=="*"){k=k.substr(0,k.length-1)+"%"}if(k.charAt(0)!="%"&&k.charAt(k.length-1)!="%"){if(w==0){f=true}else{if(w==1){k+="%"}else{k="%"+k+"%"}}}if(f){switch(Glb.ClassDT(this.Parent.bFields(u).DataType)){case Glb.DTC_CHAR:g=IDL.CSql(new IDVariant(k),IDL.FMT_CHAR,this.DB);break;case Glb.DTC_DATE:var a=IDL.FMT_DAT2;if(Glb.ClassDB(this.DBType)==Glb.DBC_ACCESS){a=IDL.FMT_DAT1}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_ORACLE||Glb.ClassDB(this.DBType)==Glb.DBC_POSTGRES){a=IDL.FMT_DAT3}else{if(Glb.ClassDB(this.DBType)==Glb.DBC_SQLITE){a=IDL.FMT_DAT4}}}g=IDL.CSql(new IDVariant(k),a,this.DB);break;case Glb.DTC_NUMBER:g=IDL.CSql(new IDVariant(k),IDL.FMT_NUM,this.DB);break}g=this.Parent.bFields(u).Expr+" = "+g}else{var b=this.Parent.VS.Mask(this.Parent.bFields(u).VisualStyle);var o;if(b.equals(">")){g="((";o=new IDVariant(k.toUpperCase())}else{if(b.equals("<")){g="((";o=new IDVariant(k.toLowerCase())}else{o=new IDVariant(k.toLowerCase());switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:g="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:g="lower((";break;case Glb.DBC_DB2:g="lower(char(";break;case Glb.DBC_SQLSRV:g="lower(convert("+(this.DB.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:g="lower(to_char(";break;default:g="((";o=new IDVariant(k);break}}}g+=(this.Parent.bFields(u).Expr+")) like "+IDL.CSql(o,IDL.FMT_CHAR,this.DB))}if(s.length>0){if(w>2){s+=" or "}else{s+=" and "}}s+=g}}}if(w>3){for(var u=1;u<=this.RS.GetNumFields();u++){var m=true;for(var d=0;d<this.LKEParams.Count()&&m;d++){var r=this.LKEParams[d];if(r.PropName.equals(this.RS.GetName(u))){m=false}}for(var t=0;t<this.Parent.Fields.length&&m;t++){if(this.Parent.bFields(t).IdxPanel==this.Index&&this.Parent.bFields(t).IsEnabled(A)&&this.Parent.bFields(t).Code.equals(this.RS.GetName(u))){m=false}}if(m){for(var t=0;t<this.Parent.Fields.length;t++){if(this.Parent.bFields(t).IdxPanel==this.Index){k=this.Parent.bFields(t).bValues(A).Text;if(k.length>0&&!this.Parent.bFields(t).bValues(A).Value.equals(this.Parent.bFields(t).bValues(A).OrgValue)){h=true;if(k.charAt(0)=="*"){k="%"+k.substr(1)}if(k.charAt(k.length-1)=="*"){k=k.substr(0,k.length-1)+"%"}if(k.charAt(0)!="%"&&k.charAt(k.length-1)!="%"){k="%"+k+"%"}var b=this.Parent.VS.Mask(this.Parent.bFields(t).VisualStyle);var o;if(b.equals(">")){g="((";o=new IDVariant(k.toUpperCase())}else{if(b.equals("<")){g="((";o=new IDVariant(k.toLowerCase())}else{o=new IDVariant(k.toLowerCase());switch(Glb.ClassDB(this.DBType)){case Glb.DBC_ACCESS:g="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:g="lower((";break;case Glb.DBC_DB2:g="lower(char(";break;case Glb.DBC_SQLSRV:g="lower(convert("+(this.DB.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:g="lower(to_char(";break;default:g="((";o=new IDVariant(k);break}}}g+=(this.RS.GetName(u)+")) like "+IDL.CSql(o,IDL.FMT_CHAR,this.DB));if(s.length>0){s+=" or "}s+=g}}}}}}if(h){var y=this.RS.getCommand();var q=y.indexOf("order by");var z=y.indexOf("group by");var c=y.indexOf("where ");if(c>0){s=" and ("+s+")"}else{s=" where "+s}var p=32767;if(q>0&&q<p){p=q}if(z>0&&z<p){p=z}if(p>=y.length){p=y.length-1}y=y.substr(0,p)+" "+s+" "+y.substr(p);this.RS.setCommand(this.DB.ApplySubstitutions(y))}}catch(x){}return h};PQuerySrv.prototype.GetLKEValues=function(J,C,L,y){try{var m=L.OrgValue;var h=L.Text.toLowerCase();var o=L.GetLkeRS();var B=o;var t;if(!o.IsOpen()&&this.LkeMS!=null){B=this.LkeMS}if(this.LkeMS!=null&&this.Parent.Status()!=Glb.PS_QBE){this.LkeMS.RemoveAllRows()}var T=new ArrayList();for(var Q=1;Q<=B.GetNumFields();Q++){var E=false;var s=true;if(this.VisibleColumns!=null){for(var O=0;O<this.VisibleColumns.Count();O++){if(String.compare(this.VisibleColumns[O],B.GetName(Q),true)==0){E=true;s=false;break}}}if(!E){E=true;for(var u=0;u<this.LKEParams.Count();u++){var N=this.LKEParams[u];if(String.compare(N.PropName,B.GetName(Q),true)==0){E=false;break}}if(E){E=this.LastLKETry>=4;for(var O=0;O<this.Parent.Fields.length;O++){var R=this.Parent.bFields(O);if(R.IdxPanel>-1&&(R.Flags&(Glb.FLD_INLIST|Glb.FLD_INFORM))!=0){if(String.compare(R.Code,B.GetName(Q),true)==0){E=true;s=false;break}}}}}if(s&&h=="*"){E=false}if(E){if(!s){T.Add(Q)}else{if(o.IsOpen()){t=1;o.MoveFirst();while(!o.EOF()&&(!this.LkeRSLimitedBySystem||t<=PQuerySrv.MAX_LKE_ROWS)){var K=o.Get(Q).stringValue().toLowerCase();if(K.indexOf(h)>-1){T.Add(Q);break}o.MoveNext();t++}}}}}if(y!=null&&(this.VisibleColumns!=null||T.Count()>=2)){var M="";for(var Q=0;Q<T.Count();Q++){var V=B.GetName(T[Q]);var D="";if(this.HeaderColumns!=null){var x=this.HeaderColumns.keys();for(var H=0;H<x.length;H++){var r=x[H];if(String.compare(r,V,true)==0){D=this.HeaderColumns[r];break}}}if(D.length==0&&this.Document!=null){var p=this.Document.GetMD();for(var O=1;O<=p.GetNumProp();O++){var A=p.GetProp(O);if(String.compare(A.ObjTag,V,true)==0){D=A.UIName;break}}}M+=(M.length>0?"|":"")+D}y.SetAttribute("hdr",M);var k=L.Parent.GetRSIdx(o);for(var Q=0;Q<T.Count();Q++){if(T[Q]==k){y.SetAttribute("dcc",(Q+1).toString());break}}}if(y!=null&&this.LkeMS!=null&&this.LkeMS.RecordCount()>0){this.LkeMS.MoveFirst();while(!this.LkeMS.EOF()){var I=y.AddNewElement("vli");var f="";for(var Q=0;Q<T.Count();Q++){f+=(f.length>0?"|":"")+this.LkeMS.Get(this.RS.GetName(T[Q])).stringValue()}I.SetAttribute("txt",f);I.SetAttribute("val","LKE"+(PQuerySrv.LKE_OLDSEL_OFFSET+this.LkeMS.BookMark()));var g=new IDVariant("");if(this.LkeMS.findColumn("ICON")!=-1){g=this.LkeMS.Get("ICON")}if(g.Type!=IDVariant.NULL&&!g.stringValue().equals("")){I.SetAttribute("img",g.stringValue())}this.LkeMS.MoveNext()}}t=1;if(o.IsOpen()&&o.RecordCount()>0){o.MoveFirst()}while(o.IsOpen()&&!o.EOF()&&(!this.LkeRSLimitedBySystem||t<=PQuerySrv.MAX_LKE_ROWS)){var U="";if(y==null||(this.VisibleColumns==null&&T.Count()<2)){for(var u=0;u<T.Count();u++){var F=T[u];var K=o.Get(F);if(K.Type!=IDVariant.NULL){if(U.length>0){U+=" : "}U+=K.stringValue()}}if(U.length>80){U=U.remove(77,U.length-77);U+="..."}}else{for(var Q=0;Q<T.Count();Q++){var K=o.Get(T[Q]).stringValue();if(K.length>80){K=K.substr(0,77)+"..."}if(U.length>0){U+="|"}U+=K}}if(y==null){}else{var d=false;if(this.LkeMS!=null){this.LkeMS.MoveFirst();while(!this.LkeMS.EOF()){var G=true;for(var Q=0;Q<this.LkeMS.GetNumFields();Q++){if(!this.LkeMS.Get(Q+1).equals(o.Get(Q+1))){G=false;break}}if(G){d=true;break}this.LkeMS.MoveNext()}}if(!d){var I=y.AddNewElement("vli");I.SetAttribute("txt",U);I.SetAttribute("val","LKE"+o.BookMark());var a=new IDVariant(true);var g=new IDVariant("");var q=new IDVariant("");if(o.findColumn("ENABLED")!=-1){a=o.Get("ENABLED")}if(o.findColumn("ICON")!=-1){g=o.Get("ICON")}if(o.findColumn("GROUPID")!=-1){q=o.Get("GROUPID")}if(a.Type!=IDVariant.NULL&&a.booleanValue()!=true){I.SetAttribute("ena",a.booleanValue()?"-1":"0")}if(g.Type!=IDVariant.NULL&&!g.stringValue().equals("")){I.SetAttribute("img",g.stringValue())}if(q.Type!=IDVariant.NULL&&!q.stringValue().equals("")){I.SetAttribute("gru",q.stringValue())}}}o.MoveNext();t++}if(this.LkeRSLimitedBySystem&&t==PQuerySrv.MAX_LKE_ROWS+1&&!o.EOF()){var P=J.RTCObj.GetConst("9618341E-082A-41a8-B0E8-7A28BA7EF2BD","(altri valori...)");if(y==null){}else{var I=y.AddNewElement("vli");I.SetAttribute("txt",P);I.SetAttribute("val","LKEPLUS");I.SetAttribute("ena","0")}}if(y==null){}else{var I=y.AddNewElement("vli");I.SetAttribute("txt","-");I.SetAttribute("val","LKENULL")}if(m.Type!=IDVariant.NULL){if(y==null){}else{if(!this.IsMultiSelect()||this.Parent.Status()!=Glb.PS_QBE){var I=y.AddNewElement("vli");I.SetAttribute("txt","("+m+")");I.SetAttribute("val","LKEPREC")}}}if(C){if(y==null){}else{var I=y.AddNewElement("vli");I.SetAttribute("txt","...");I.SetAttribute("val","LKEMORE")}}}catch(S){}};PQuerySrv.prototype.GetLKERow=function(d,c,f,b,a){if(d<=PQuerySrv.LKE_OLDSEL_OFFSET){this.RS.CopyFrom(b)}else{this.RS.CopyFrom(this.LkeMS);d-=PQuerySrv.LKE_OLDSEL_OFFSET}try{this.RS.absolute(d)}catch(g){}return this.ActivateLKE(c,f,a)};PQuerySrv.prototype.ValidateLookup=function(a){if(this.FieldIndex>-1){return}var j=this.GetMstField();if(j!=null&&j.IsExtended&&j.IDLista.length==0){return}var k=false;var b=false;var m=false;var e=0;var h=null;var o=null;for(var g=0;g<this.LookupParams.Count();g++){var c=this.LookupParams[g];if(c.MstField!=null){if(c.MstField.bValues(a).Value.Type==IDVariant.NULL){k=true;if(c.MstField.IsVisible(a)){b=true}else{if((c.MstField.Flags&Glb.FLD_ISOPT)==0){m=true}}}if(c.MstField.IsVisible(a)){h=c.MstField;e++;o=((o==null)?"":o+", ")+c.MstField.Header}}}if(!k||(!b&&m)){var d=false;for(var f=0;f<this.Parent.Fields.length;f++){if(this.Parent.bFields(f).IdxPanel==this.Index){if(this.Parent.bFields(f).bValues(a).Value.Type!=IDVariant.NULL){d=true;break}}}if(!d&&e==0&&this.Parent.bQueries(0).IsDO){d=true}if(!d){for(var f=0;f<this.Parent.Fields.length;f++){if(this.Parent.bFields(f).IdxPanel==this.Index){if((this.Parent.bFields(f).Flags&Glb.FLD_ISOPT)==0&&(this.Parent.bFields(f).bValues(a).Value.Type==IDVariant.NULL)){if(h==null){h=this.Parent.bFields(f)}if(this.Parent.CanAddErrMsg(a,IDPanelSrv.EM_FIELD)){switch(e){case 0:h.Values[a].SetError(this.Parent.MainFrm.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore"),IDDocument.ERR_ERROR);break;case 1:h.Values[a].SetError(IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("4431C58E-5256-4339-9F77-905513EC5117","Il codice inserito nel campo |1 non esiste")),new IDVariant(o)).stringValue(),IDDocument.ERR_ERROR);break;default:h.Values[a].SetError(IDL.FormatMessage(new IDVariant(this.Parent.MainFrm.RTCObj.GetConst("8093940E-606E-4A4F-BB7F-65137D090C1B","I codici inseriti nei campi |1 non corrispondono")),new IDVariant(o)).stringValue(),IDDocument.ERR_ERROR);break}}if(this.Parent.CanAddErrMsg(a,IDPanelSrv.EM_MESSAGE)){this.Parent.Parent.SetMessage(h,AMessageSrv.MSG_STOP,h.Values[a].GetErrorText(),"","VAL",(this.Parent.NumRows>1)?a+1:0,false);if(this.Parent.Parent.FocusPriority==0){this.Parent.SetInput(a,h.Index,1,false)}}this.Parent.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.bFields(f).iGuid,180,"PQuery.ValidateLookup","Panel "+this.Parent.GetDTTCaption()+": error for field "+this.Parent.bFields(f).GetDTTCaption()+" at row "+(a+1)+" - "+h.Values[a].GetErrorText())}}}}}};PQuerySrv.prototype.CollIsModified=function(){if(this.IDColl!=null){if(this.CollUpdCount!=this.IDColl.UpdateCount()){return true}}return false};PQuerySrv.prototype.GetMstField=function(){return this.LookupParams.Count()>0?this.LookupParams[0].MstField:null};PQuerySrv.prototype.GetRelevantDocProp=function(f,e){f.Clear();if(this.LKEParams!=null){for(var a=0;a<this.LKEParams.Count();a++){var b=this.LKEParams[a];if(b.FldIdx>=0){f.Add(this.Parent.bFields(b.FldIdx).GetDOIdx(e))}}}};PQuerySrv.prototype.AddDOSortCriteria=function(a){if(this.DOSortCriteria==null){this.DOSortCriteria=new ArrayList()}this.DOSortCriteria.Add(a)};PQuerySrv.prototype.ExtendLookup=function(c){if(c!=null){if(this.PreviuosDocument==null){if(this.LKEParams.Count()>0){this.PreviousLkeParam=this.LKEParams[0]}this.PreviousLookupParam=this.LookupParams[0];this.PreviuosDocument=this.Document;this.LookupParams.Clear();this.LKEParams.Clear();var b=new PLookupParamSrv();b.TblIdx=this.PreviousLookupParam.TblIdx;b.FldIdx=this.PreviousLookupParam.FldIdx;b.MstField=this.PreviousLookupParam.MstField;b.PropName="";b.PropIdx=c.GetDstProp(0);b.AutoLookup=false;this.LookupParams.Add(b);this.Document=this.Document.CreateDocument(c.GetDocumentClass());var d=this.Document.GetMD();var a=d.GetProp(c.GetDstProp(0));this.AddLKEParam(this.GetMstField().Index,a.ObjTag);this.LookupValues.Clear();this.UpdateLookup(-1,this.Parent.MainFrm)}}else{if(this.PreviousLookupParam!=null){this.LookupParams.Clear();this.LookupParams.Add(this.PreviousLookupParam);this.PreviousLookupParam=null;this.Document=this.PreviuosDocument;this.PreviuosDocument=null;this.LKEParams.Clear();if(this.PreviousLkeParam!=null){this.LKEParams.Add(this.PreviousLkeParam)}this.PreviousLkeParam=null;this.LookupValues.Clear()}}};PQuerySrv.prototype.OnValueChange=function(d,a,c){if(this.Parent!=null){if(this.LookupRows!=null&&d<this.LookupRows.length){for(var b=0;b<this.LookupRows.length;b++){if(this.LookupRows[b]-1==d){d=b;break}}}this.Parent.OnValueChange(d,a,c)}};PQuerySrv.prototype.IsMultiSelect=function(){if(this.iIsMultiSelect!=-2){return(this.iIsMultiSelect==-1)}this.iIsMultiSelect=0;if(this.LKEParams==null){return false}if(!this.Parent.MainFrm.ParamsObj().UseRD3){return false}for(var a=0;a<this.Parent.UFields();a++){if(this.Parent.bFields(a).IdxPanel==this.Index&&this.Parent.bFields(a).MultiSelectionComboBox()){this.iIsMultiSelect=-1;return true}}return false};function PQueryParamSrv(){this.TblIdx=-1;this.FldIdx=-1;this.RepIdx=-1;this.AttValue;this.DataType;this.MaxLength;this.vScale}function PValueSrv(){this.Value=new IDVariant();this.OrgValue=new IDVariant();this.LastValue=new IDVariant();this.Text="";this.LastText="";this.Mask="";this.NotValidated;this.Modified;this.LastModified;this.CheckEmpty;this.Parent;this.Index;this.ValueListIndexes=new Array(0);this.Uploading;this.ErrorText="";this.ErrorType=IDDocument.ERR_NONE;this.ErrorAck=false;this.Enabled=-1;this.Visible=-1;this.VisualStyle=-1;this.DynText=false;this.Tooltip="";this.ForeColor=-2;this.BackColor=-2;this.FontMod="";this.DynMask="";this.Alignment=-1;this.Badge="";this.LastEnabled=0;this.LastVisible=0;this.LastVisualStyle=0;this.LastTooltip="";this.LastForeColor=-2;this.LastBackColor=-2;this.LastFontMod="";this.LastMask="";this.LastAlignment=-1;this.LastBadge="";this.LastRDText="";this.LkeRS=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VAL_MAXPROPS)}PValueSrv.prototype.SetLkeRS=function(a){if(a==null){this.LkeRS=null}else{this.LkeRS=new IDCachedRowSet();this.LkeRS.CopyFrom(a)}this.RD3Change(RD3Glb.VAL_VALUELIST)};PValueSrv.prototype.GetLkeRS=function(){return this.LkeRS};PValueSrv.prototype.SetNewText=function(d,c){var g="";var h=d;if(this.Mask.length>0&&c){switch(Glb.ClassDT(this.Parent.DataType)){case Glb.DTC_NUMBER:var k=d;do{var a;if(!this.Parent.Parent.MainFrm.ParamsObj().UseDecimalDot){a=k.indexOf(".")}else{a=k.indexOf(",")}if(a==-1){break}else{k=k.remove(a,1)}}while(true);var e=k.indexOf(",");if(e>-1){k=k.substr(0,e)+"."+k.substr(e+1)}d=k;break;case Glb.DTC_DATE:if(this.Parent.DataType==Glb.DT_DATE||this.Parent.DataType==Glb.DT_DATETIME){var q=this.GetToken(d,this.Mask,"yyyy");if(q.length>0){g+=q+"-"}else{q=this.GetToken(d,this.Mask,"yy");g+=q+"-"}g+=this.GetToken(d,this.Mask,"mm")+"-";g+=this.GetToken(d,this.Mask,"dd")+" "}if(this.Parent.DataType==Glb.DT_TIME||this.Parent.DataType==Glb.DT_DATETIME){var q=this.GetToken(d,this.Mask,"hh");if(q.length>0){g+=q+":"}q=this.GetToken(d,this.Mask,"nn");if(q.length>0){g+=q}q=this.GetToken(d,this.Mask,"ss");if(q.length>0){g+=":"+q}}if(g.length==0||g.equals("-- ")){d=""}else{var o=new IDVariant(g);o=IDL.ToDateTime(o,new IDVariant(this.Mask));d=IDL.Format(o,new IDVariant(this.Mask),this.Parent.Parent.MainFrm).stringValue()}break;case Glb.DTC_CHAR:if(this.Mask.equals(">")){d=d.toUpperCase()}else{if(this.Mask.equals("<")){d=d.toLowerCase()}else{var f=Math.min(d.length,this.Mask.length);for(var j=0;j<f;j++){if("Aa#&".indexOf(this.Mask.charAt(j))>=0&&d.charAt(j)!="_"){g+=d.charAt(j)}}d=g}}break}}this.LastText=d;this.NotValidated=false;if(!h.equals(this.Text)){var l=this.Validate(d);if(!c||l){this.Text=d;this.Modified=true;this.LastModified=true;this.RD3Change(RD3Glb.VAL_TEXT)}else{this.NotValidated=c}}return this.Modified};PValueSrv.prototype.SetCheck=function(b,c){var a;if(b.length>0){a=this.Parent.ValueList[0]}else{this.CheckEmpty=true;a=this.Parent.ValueList[1]}return this.SetNewValue(a.Value)};PValueSrv.prototype.Validate=function(a){this.LastValue=new IDVariant(this.Value);if(a.length==0){this.Value=new IDVariant();this.ValueListIndexes=new Array(0);return true}else{var c=IDVariant.STRING;switch(this.Parent.DataType){case Glb.DT_NUM_INTEGER:c=IDVariant.INTEGER;break;case Glb.DT_NUM_FLOAT:c=IDVariant.FLOAT;break;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:c=IDVariant.DECIMAL;break;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:c=IDVariant.DATETIME;break;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:if(a.length>0&&this.Parent.ValueList.Count()==0&&this.Parent.DataType==Glb.DT_CHAR){if(IDL.IsWhiteSpace(a.charAt(a.length-1))||IDL.IsWhiteSpace(a.charAt(0))){var e=a;while(e.length>0&&IDL.IsWhiteSpace(e.charAt(e.length-1))){e=e.remove(e.length-1,e.length-(e.length-1))}while(e.length>0&&IDL.IsWhiteSpace(e.charAt(0))){e=e.remove(0,1-0)}a=e}}if(a.length>this.Parent.MaxLength){a=a.substr(0,this.Parent.MaxLength)}break}var f=a;if(this.Mask.length>0&&Glb.ClassDT(this.Parent.DataType)==Glb.DTC_DATE){var b="";if(this.Parent.DataType==Glb.DT_DATE||this.Parent.DataType==Glb.DT_DATETIME){var d=this.GetToken(a,this.Mask,"yyyy");if(d.length>0){b+=d+"-"}else{d=this.GetToken(a,this.Mask,"yy");b+=d+"-"}b+=this.GetToken(a,this.Mask,"mm")+"-";b+=this.GetToken(a,this.Mask,"dd")+" "}if(this.Parent.DataType==Glb.DT_TIME||this.Parent.DataType==Glb.DT_DATETIME){var d=this.GetToken(a,this.Mask,"hh");if(d.length>0){b+=d+":"}d=this.GetToken(a,this.Mask,"nn");if(d.length>0){b+=d}d=this.GetToken(a,this.Mask,"ss");if(d.length>0){b+=":"+d}}if(b.length!=0&&!b.equals("-- ")){f=b}}this.Value=new IDVariant(f);if(c==IDVariant.DATETIME&&(this.Mask.length>0||this.Parent.Mask.length>0)){this.Value=IDL.ToDateTime(this.Value,new IDVariant(this.Mask.length>0?this.Mask:this.Parent.Mask))}else{this.Value.changeType(c)}this.SearchValueList();return this.Value.Type!=IDVariant.NULL}};PValueSrv.prototype.Clear=function(a){if(a==undefined){a=true}this.Value=new IDVariant();this.OrgValue=new IDVariant();this.LastValue=new IDVariant();if(this.Modified){this.RD3Change(RD3Glb.VAL_TEXT)}this.Text="";this.NotValidated=false;this.Modified=false;this.LastModified=false;this.ValueListIndexes=new Array(0);this.Uploading=false;this.CheckEmpty=false;if(a&&this.LkeRS!=null){this.RD3Change(RD3Glb.VAL_TEXT);this.LkeRS=null}this.ErrorAck=false;this.ClearError();this.ClearDynProp()};PValueSrv.prototype.SetOriginal=function(){this.OrgValue=new IDVariant(this.Value);this.LastValue=new IDVariant(this.Value)};PValueSrv.prototype.ClearError=function(){if(this.ErrorType!=IDDocument.ERR_NONE){this.Parent.Parent.Parent.ClearMessages(this.Parent,null,(this.Parent.Parent.NumRows>1)?this.Parent.Parent.ValidatingRow+1:0);this.RD3Change(RD3Glb.VAL_ERRORTEXT);this.RD3Change(RD3Glb.VAL_ERRORTYPE);var a=this.Parent.Parent.Queries[0].GetAttRecNumber()-1;this.Parent.Parent.SetRDRowSel(a+this.Index,true)}this.ErrorType=IDDocument.ERR_NONE;this.ErrorText=""};PValueSrv.prototype.SetError=function(c,b){if(this.ErrorType!=b||!c.equals(this.ErrorText)){this.RD3Change(RD3Glb.VAL_ERRORTYPE);this.RD3Change(RD3Glb.VAL_ERRORTEXT);if(this.Parent.Group!=-1){var a=this.Parent.Parent.Groups[this.Parent.Group];if(a.ExpandOnError){a.set_Collapsed(false)}}}this.ErrorType=b;this.ErrorText=c;if(b!=IDDocument.ERR_ERROR){return this.ErrorAck}else{return false}};PValueSrv.prototype.SetAck=function(a){if(this.ErrorType==IDDocument.ERR_WARNING||this.ErrorType==IDDocument.ERR_WARNACK){this.ErrorAck=a;if(a){this.ClearError()}}};PValueSrv.prototype.GetErrorText=function(){return this.ErrorText};PValueSrv.prototype.IsError=function(){return(this.ErrorType==IDDocument.ERR_ERROR||(this.ErrorType==IDDocument.ERR_WARNACK&&!this.ErrorAck))};PValueSrv.prototype.GetErrorType=function(){if(this.ErrorAck&&(this.ErrorType==IDDocument.ERR_WARNING||this.ErrorType==IDDocument.ERR_WARNACK)){return IDDocument.ERR_NONE}return this.ErrorType};PValueSrv.prototype.ClearDynProp=function(){this.DynText=false;this.Enabled=-1;this.Visible=-1;this.VisualStyle=-1;this.Tooltip="";this.BackColor=-2;this.ForeColor=-2;this.FontMod="";this.Alignment=-1;this.DynMask="";this.Badge="";if(this.ValueListIndexes.length>0){this.VisualStyle=this.ValueListIndexes[0].VisIdx}};PValueSrv.prototype.SetValue=function(b){var a=this.Text;this.LastValue=this.Value;this.Value=b;this.NotValidated=false;this.SearchValueList();this.Text=b.stringValue();if(this.Modified&&this.Text!=a){this.RD3Change(RD3Glb.VAL_TEXT)}};PValueSrv.prototype.SetNewValue=function(b){this.LastValue=this.Value;this.NotValidated=false;if(this.Value.equals(b)){return this.Modified}var a=this.Text;this.Value=b;this.SearchValueList();this.Text=b.stringValue();if(this.Text!=a){this.RD3Change(RD3Glb.VAL_TEXT)}this.Modified=true;this.LastModified=true;return this.Modified};PValueSrv.prototype.SearchValueList=function(){this.ValueListIndexes=new Array(0);var b=new ArrayList();var d=this.Value.stringValue().split(this.Parent.GetQBESep().charAt(0));for(var f=0;f<this.Parent.ValueList.Count();f++){var c=this.Parent.ValueList[f];for(var e=0;e<d.length;e++){if(c.Value.equals(new IDVariant(d[e]))){b.Add(c);if(c.VisIdx!=-1){this.VisualStyle=c.VisIdx}}}}if(b.Count()>0){this.ValueListIndexes=new Array(b.Count());for(var e=0;e<b.Count();e++){this.ValueListIndexes[e]=b[e]}return true}return false};PValueSrv.prototype.GetComboName=function(){var a="";for(var c=0;c<this.ValueListIndexes.length;c++){var b=this.ValueListIndexes[c];a+=(a.length>0?this.Parent.Parent.MainFrm.ComboNameSep:"")+b.Name}return a};PValueSrv.prototype.SetAutoLookupValues=function(b,a){if(b==null||!b.equals(this.Value)){this.LastValue=this.Value;this.Value=new IDVariant(b)}this.Text=a.stringValue()};PValueSrv.prototype.SetNewAutoLookupValue=function(b){var a=this.Value;this.NotValidated=false;this.Validate(b);if(this.Value.equals(a)){return this.Modified}this.LastValue=a;this.Text=this.Value.stringValue();this.Modified=true;this.LastModified=true;return this.Modified};PValueSrv.prototype.GetToken=function(a,b,d){var c=b.indexOf(d);if(c==-1||a.length<c+d.length||a.substr(c,d.length).equals(d)){return""}else{return a.substr(c,d.length)}};PValueSrv.prototype.IsEmptyValue=function(){if(this.CheckEmpty||this.Text.length==0){return true}else{return false}};PValueSrv.prototype.SaveDynProp=function(){if(this.Visible!=this.LastVisible){this.RD3Change(RD3Glb.VAL_VISIBLE)}if(this.Enabled!=this.LastEnabled){this.RD3Change(RD3Glb.VAL_ENABLED)}if(this.VisualStyle!=this.LastVisualStyle){this.RD3Change(RD3Glb.VAL_VISUALSTYLE)}if(!this.Tooltip.equals(this.LastTooltip)){this.RD3Change(RD3Glb.VAL_TOOLTIP)}if(this.BackColor!=this.LastBackColor){this.RD3Change(RD3Glb.VAL_BACKCOLOR)}if(this.ForeColor!=this.LastForeColor){this.RD3Change(RD3Glb.VAL_FORECOLOR)}if(!this.DynMask.equals(this.LastMask)){this.RD3Change(RD3Glb.VAL_MASK);this.RD3Change(RD3Glb.VAL_TEXT)}if(!this.FontMod.equals(this.LastFontMod)){this.RD3Change(RD3Glb.VAL_FONTMOD)}if(this.Alignment!=this.LastAlignment){this.RD3Change(RD3Glb.VAL_ALIGN)}if(!this.Badge.equals(this.LastBadge)){this.RD3Change(RD3Glb.VAL_BADGE)}this.LastEnabled=this.Enabled;this.LastVisible=this.Visible;this.LastVisualStyle=this.VisualStyle;this.LastTooltip=this.Tooltip;this.LastBackColor=this.BackColor;this.LastForeColor=this.ForeColor;this.LastMask=this.DynMask;this.LastAlignment=this.Alignment;this.LastFontMod=this.FontMod;this.LastBadge=this.Badge};PValueSrv.prototype.WasDynChanged=function(){if(this.LastVisualStyle!=this.VisualStyle||this.LastEnabled!=this.Enabled||this.LastVisible!=this.Visible||!this.LastTooltip.equals(this.Tooltip)||this.LastBackColor!=this.BackColor||this.LastForeColor!=this.ForeColor||!this.LastMask.equals(this.DynMask)||this.LastAlignment!=this.Alignment||!this.LastFontMod.equals(this.FontMod)||!this.LastBadge.equals(this.Badge)){return true}else{return false}};PValueSrv.prototype.GetRD3Ident=function(){var a=this.Parent.Parent.bQueries(0).GetAttRecNumber();if(a==0||this.Parent.Parent.Status()==Glb.PS_QBE){a=1}return this.GetRD3Name()+":"+(this.Index+a)+":"+this.Parent.Index+":"+this.Parent.Parent.FrIndex+":"+this.Parent.Parent.Parent.FormIdx};PValueSrv.prototype.GetRD3Name=function(){return"val"};PValueSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};PValueSrv.prototype.RD3ResetChange=function(){this.RD3Changed=false};PValueSrv.prototype.GetRD3Changed=function(a){return this.RD3PropChg[a]};PValueSrv.prototype.RD3RenderDifferences=function(c,f){if((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(this.Parent.QueryValueSource==null){for(var a=0;a<this.Parent.Parent.UQueries();a++){if(this.Parent.Parent.bQueries(a).FieldIndex==this.Parent.Index){this.Parent.QueryValueSource=this.Parent.Parent.bQueries(a);break}}}if(!f&&this.Parent.IsEnabled(this.Index)&&this.Parent.QueryValueSource!=null&&(this.Index==this.Parent.Parent.AttR||this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,new IDVariant(""),false,true,true,null))){this.RD3Change(RD3Glb.VAL_VALUELIST)}if(f&&!this.Parent.IsEnabled(this.Index)&&this.Parent.QueryValueSource!=null&&this.Parent.QueryValueSource.LastPreparedQueryIndex==0){this.Parent.QueryValueSource.LastPreparedQueryIndex=-1}}var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(f){}return d};PValueSrv.prototype.SetRD3Property=function(u,o,H){switch(u){case RD3Glb.VAL_TEXT:var q=this.Text;var F=null;if(this.Parent.DataType==Glb.DT_DOC_OLE){if(this.Uploading){o.SetAttribute("mim","upload");if((this.Parent.MaxUploadSize<1024)){q=this.Parent.MaxUploadSize+" byte"}else{if((this.Parent.MaxUploadSize<1048576)){q=(Math.floor(this.Parent.MaxUploadSize/1024))+" KB"}else{q=(Math.floor(this.Parent.MaxUploadSize/1048576))+" MB"}}q=IDL.FormatMessage(this.Parent.Parent.MainFrm.RTCObj.GetConst("BAA77E7E-38E7-44C5-A3DD-243896EA653E",new IDVariant("Scegli un documento da caricare (max dim. |1):"),true),new IDVariant(q),null,null,null,null,null).stringValue()}else{if(!(IDL.IsNull(this.Value))){F=this.Parent.Parent.bQueries(0).GetBlobData(this.Parent.Index,this.Value.intValue())}if(F!=null&&F.Size>16){var l=this.Parent.Parent.FrIndex.toString();if(l.length<2){l="0"+l}if(F.FileName.startsWith("blob:")){o.SetAttribute("url",F.FileName)}else{o.SetAttribute("url",this.Parent.Parent.MainFrm.UrlForEnc(Glb.ITEM_BLOB,l+F.BlobNum))}o.SetAttribute("mty",F.MimeType);if(F.ToDownload){if(F.MimeType.length>3&&F.MimeType.substr(0,4).equals("text")){o.SetAttribute("mim","text");this.Parent.Parent.bQueries(0).WriteTextBlob(F.BlobNum,null);q=F.FileName}else{if(F.FileName.length==0){this.Parent.Parent.bQueries(0).SaveBlobFile(F.BlobNum,this.Parent.Parent.MainFrm)}if(F.MimeType.length>4&&F.MimeType.substr(0,5).equals("image")){o.SetAttribute("mim","image");q=F.FileName}else{o.SetAttribute("mim",F.MimeType);q=F.FileName}}}else{o.SetAttribute("mim","size");q="";if(F.Size<1024){q=F.Size+" byte"}else{if(F.Size<1048576){q=(Math.floor(F.Size/1024))+" KB"}else{q=(Math.floor(F.Size/1048576))+" MB"}}q=IDL.FormatMessage(this.Parent.Parent.MainFrm.RTCObj.GetConst("B1AC743E-369F-4F50-A80C-F0ABE2850DDF",new IDVariant("Click per aprire il documento (|1)"),true),new IDVariant(q),null,null,null,null,null).stringValue();q='<img style="border:none" src="images/blob.gif" alt=""> '+q}}else{o.SetAttribute("mim","empty");q=""}}}else{if(q.length==0&&H){break}if(((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0||(this.Parent.ValueList!=null&&this.Parent.ValueList.Count()>0))&&!(this.Parent.Parent.Status()==Glb.PS_QBE&&this.Parent.iMultiCriteria)){q=this.Value.toString();if(!this.Parent.Parent.MainFrm.UseDecimalDot()&&(this.Value.Type==IDVariant.DECIMAL||this.Value.Type==IDVariant.FLOAT)){q=q.replace(".",",")}}else{var f=(this.VisualStyle==-1)?this.Parent.VisualStyle:this.VisualStyle;var g=(this.Parent.Parent.VS.Flags(f)&Glb.FL_VIS_PASSWORD)!=0;if(g){if(q.length>0){q="********"}}else{var e=this.Parent.Parent.VS.Mask(f);var v=true;if(!this.DynMask.equals("")){e=this.DynMask;v=false}else{if(!this.Parent.Mask.equals("")){e=this.Parent.Mask;v=false}}if(!e.equals("=")&&this.Parent.EditorType!=1){var r=new IDVariant();var z=new IDVariant();var p=new IDVariant();this.Parent.GetClientMask(r,z,this.Value,e,this.Text,p,this.DynText,v);q=r.stringValue()}if(this.Parent.Parent.MainFrm!=null){var G=this.Parent.Parent.MainFrm.BrowserClass;if(G==Glb.BRWCLS_FIREFOX||G==Glb.BRWSCL_SAFARI){q=q.replace(/\r\n/g,"\n")}}}}}o.SetAttribute("txt",q);break;case RD3Glb.VAL_ERRORTEXT:if(this.ErrorText.length==0&&H){break}o.SetAttribute("err",this.ErrorText);break;case RD3Glb.VAL_ERRORTYPE:if(this.GetErrorType()==0&&H){break}o.SetAttribute("ety",this.GetErrorType().toString());break;case RD3Glb.VAL_ENABLED:if(this.Enabled==-1&&H){break}o.SetAttribute("ena",this.Enabled.toString());break;case RD3Glb.VAL_VISIBLE:if(this.Visible==-1&&H){break}o.SetAttribute("vis",this.Visible.toString());break;case RD3Glb.VAL_VISUALSTYLE:if(this.VisualStyle==-1&&H){break}o.SetAttribute("sty",(this.VisualStyle==-1?this.VisualStyle:this.Parent.Parent.MainFrm.VisualStyleList.GetTrueIdx(this.VisualStyle)).toString());break;case RD3Glb.VAL_TOOLTIP:if(this.Tooltip.length==0&&H){break}o.SetAttribute("tip",this.Tooltip);break;case RD3Glb.VAL_INDEX:var m=this.Parent.Parent.bQueries(0).GetAttRecNumber();if(m==0||this.Parent.Parent.Status()==Glb.PS_QBE){m=1}o.SetAttribute("idx",(m+this.Index).toString());break;case RD3Glb.VAL_ROWSEL:if(this.Parent.Index!=0){break}var a=this.Parent.Parent.IsRowInError(this.Index)?this.Parent.Parent.CanAddErrMsg(this.Index,IDPanelSrv.EM_FIELD):false;var D=false;var I=false;if(!a){if(this.Parent.Parent.Status()==Glb.PS_UPDATE){D=this.Parent.Parent.IsRowModified(this.Index)}else{var C=this.Parent.Parent.GetDocument(this.Index);if(C!=null){D=C.IsModified()}}}if(this.Parent.Parent.Status()!=Glb.PS_UPDATE){var C=this.Parent.Parent.GetDocument(this.Index);if(C!=null){I=C.Inserted()}}var y=0;if(a){y=I?3:1}else{if(D){y=I?4:2}}o.SetAttribute("rse",y.toString());var E=this.Parent.Parent.Queries[0].IDColl;if(H&&E!=null&&E.UIMode()&&this.Parent.Parent.EnableMultipleSel()&&((this.Parent.Parent.Flags&Glb.PAN_HASLIST)!=0)){var C=this.Parent.Parent.GetDocument(this.Index);if(C!=null){var B=this.Parent.Parent.MainFrm.RD3AddEvent("mulsel",this.Parent.Parent.GetRD3Ident());B.SetAttribute("row",(this.Parent.Parent.Queries[0].GetAttRecNumber()+this.Index).toString());B.SetAttribute("value",C.Selected()?"1":"0");B.CanSendInFulltree=true}}break;case RD3Glb.VAL_VALUELIST:var k=null;var h=0;if(this.LkeRS!=null){k=this.LkeRS;h=1}if((this.Parent.Flags&Glb.FLD_AUTOLOOKUP)!=0){h=2}if(h==0&&!H){for(var w=0;w<this.Parent.Parent.UQueries();w++){if(this.Parent.Parent.bQueries(w).FieldIndex==this.Parent.Index){this.Parent.QueryValueSource=this.Parent.Parent.bQueries(w);h=3;break}}}if(h==0&&H){break}var A=o.AddNewElement("vls");A.SetAttribute("typ",h.toString());switch(h){case 1:this.Parent.Parent.bQueries(this.Parent.IdxPanel).GetLKEValues(this.Parent.Parent.MainFrm,this.Parent.CanActivate(this.Index),this,A);break;case 2:this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,this.Value,Glb.ClassDT(this.Parent.DataType)==Glb.DTC_CHAR,this.Parent.IsEnabled(this.Index),false,A);break;case 3:this.Parent.QueryValueSource.GetValueSource(this.Parent.Parent.MainFrm,this.Index,this.Value,Glb.ClassDT(this.Parent.DataType)==Glb.DTC_CHAR,false,false,A);this.Parent.QueryValueSource=null;break}break;case RD3Glb.VAL_BACKCOLOR:if(this.BackColor==-2&&H){break}o.SetAttribute("bkc",(this.BackColor==-2?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.VAL_FORECOLOR:if(this.ForeColor==-2&&H){break}o.SetAttribute("frc",(this.ForeColor==-2?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.VAL_MASK:if(this.DynMask.length==0&&H){break}o.SetAttribute("msk",this.DynMask);break;case RD3Glb.VAL_FONTMOD:if(this.FontMod.length==0&&H){break}o.SetAttribute("ftm",this.FontMod);break;case RD3Glb.VAL_ALIGN:if(this.Alignment==-1&&H){break}o.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.VAL_BADGE:if(this.Badge.length==0&&H){break}o.SetAttribute("bdg",this.Badge);break}};function PVLItemSrv(){this.Value;this.Name;this.Description;this.Image;this.iGuid;this.Parent;this.VisIdx=-1;this.OrigName=""}PVLItemSrv.prototype.RD3RenderDifference=function(c,e,a){var d=c.AddNewElement("vli");if(this.Name!=null&&this.Name.length>0){d.SetAttribute("txt",this.Name)}if(this.Value!=null&&this.Value.stringValue().length>0){var b=this.Value.stringValue();if(!a.UseDecimalDot()&&(this.Value.Type==IDVariant.DECIMAL||this.Value.Type==IDVariant.FLOAT)){b=b.replace(".",",")}d.SetAttribute("val",b)}if(this.Description!=null&&this.Description.length>0){d.SetAttribute("tip",this.Description)}if(this.Image!=null&&this.Image.length>0){d.SetAttribute("img",this.Image)}if(this.VisIdx!=-1){d.SetAttribute("sty",a.VisualStyleList.GetTrueIdx(this.VisIdx).toString())}return true};function RD3EventSrv(){this.Name;this.Ident;this.DontSend=false;this.CanSendInFulltree=false;this.Attributes=null}RD3EventSrv.prototype.SetAttribute=function(a,b){if(this.Attributes==null){this.Attributes=new HashTableSrv()}this.Attributes[a]=b};RD3EventSrv.prototype.Send=function(e,f){if(f==undefined){f=false}if((f&&!this.CanSendInFulltree)||this.DontSend){return null}var g=e.AddNewElement(this.Name);g.SetAttribute("id",this.Ident);if(this.Attributes!=null){var d=this.Attributes.keys();for(var c=0;c<d.length;c++){var b=d[c];var a=this.Attributes[b];g.SetAttribute(b,a)}}return g};function RD3Glb(){}RD3Glb.EVENT_CLIENTSIDE=1;RD3Glb.EVENT_SERVERSIDE=2;RD3Glb.EVENT_IMMEDIATE=4;RD3Glb.EVENT_BLOCKING=8;RD3Glb.EVENT_URGENT=15;RD3Glb.EVENT_ACTIVE=7;RD3Glb.EVENT_DEFERRED=3;RD3Glb.BORDER_NONE=1;RD3Glb.BORDER_THIN=2;RD3Glb.BORDER_THICK=3;RD3Glb.KEYS_ENTERESC=1;RD3Glb.KEYS_MOVEMENT=2;RD3Glb.KEYS_ALPHANUMERICAL=4;RD3Glb.WEP_CAPTION=0;RD3Glb.WEP_REFRESHINT=1;RD3Glb.WEP_WIDGETMODE=2;RD3Glb.WEP_ACTIVEFORM=3;RD3Glb.WEP_USEDECIMALDOT=4;RD3Glb.WEP_WELCOME=5;RD3Glb.WEP_DEBUGTYPE=6;RD3Glb.WEP_HELPFILE=7;RD3Glb.WEP_IMAGE=8;RD3Glb.WEP_CMDPROMPT=9;RD3Glb.WEP_PROGRESSFILE=10;RD3Glb.WEP_ENTRYPOINT=11;RD3Glb.WEP_ENABLEGFX=12;RD3Glb.WEP_MENUTYPE=13;RD3Glb.WEP_ENABLESND=14;RD3Glb.WEP_SHOWLOGOFF=15;RD3Glb.WEP_REFRESHLOC=16;RD3Glb.WEP_MENUWIDTH=17;RD3Glb.WEP_ACCENTCOLOR=18;RD3Glb.WEP_DEVICEMOTION=19;RD3Glb.WEP_VISPROP=20;RD3Glb.WEP_MAXPROP=21;RD3Glb.VIS_CONTROLTYPE=0;RD3Glb.VIS_MASK=1;RD3Glb.VIS_ROWOFFSET=2;RD3Glb.VIS_FLAGS=3;RD3Glb.VIS_LETTERSPACING=4;RD3Glb.VIS_WORDSPACING=5;RD3Glb.VIS_HORIZONTALSCALE=6;RD3Glb.VIS_DERIVED=7;RD3Glb.VIS_CURSOR=8;RD3Glb.VIS_HEADOFFSET=9;RD3Glb.VIS_MAXPROP=10;RD3Glb.CMH_SUPPRMENU=0;RD3Glb.CMH_MAXPROP=1;RD3Glb.CMD_IDXFORM=0;RD3Glb.CMD_CAPTION=1;RD3Glb.CMD_TOOLTIP=2;RD3Glb.CMD_IDX=3;RD3Glb.CMD_EXPANDED=4;RD3Glb.CMD_LEVEL=5;RD3Glb.CMD_ISMENU=6;RD3Glb.CMD_ISTOOLBAR=7;RD3Glb.CMD_SHOWNAMES=8;RD3Glb.CMD_REQUIRECONFIRMATION=9;RD3Glb.CMD_TOOLNAME=10;RD3Glb.CMD_IMAGE=11;RD3Glb.CMD_CONFIRMTEXT=12;RD3Glb.CMD_ENABLED=13;RD3Glb.CMD_VISIBLE=14;RD3Glb.CMD_TOOLCONT=15;RD3Glb.CMD_FKNUM=16;RD3Glb.CMD_CMDCODE=17;RD3Glb.CMD_WIDTH=18;RD3Glb.CMD_TOOLHL=19;RD3Glb.CMD_ACCELL=20;RD3Glb.CMD_FORMLIST=21;RD3Glb.CMD_CANDRAG=22;RD3Glb.CMD_CANDROP=23;RD3Glb.CMD_BADGE=24;RD3Glb.CMD_MAXPROP=25;RD3Glb.IND_IDXFORM=0;RD3Glb.IND_WIDTH=1;RD3Glb.IND_TOOLTIP=2;RD3Glb.IND_STYLE=3;RD3Glb.IND_ENABLED=4;RD3Glb.IND_VISIBLE=5;RD3Glb.IND_TEXT=6;RD3Glb.IND_IMAGE=7;RD3Glb.IND_ALIGN=8;RD3Glb.IND_MAXPROP=9;RD3Glb.TIM_IDXFORM=0;RD3Glb.TIM_NUMTICKS=1;RD3Glb.TIM_INTERVAL=2;RD3Glb.TIM_ENABLED=3;RD3Glb.TIM_MAXPROP=4;RD3Glb.FRM_IDXFORM=0;RD3Glb.FRM_CAPTION=1;RD3Glb.FRM_MODAL=2;RD3Glb.FRM_DOCKED=3;RD3Glb.FRM_DOCKTYPE=4;RD3Glb.FRM_VISIBLE=5;RD3Glb.FRM_TOOLBARPOS=6;RD3Glb.FRM_WINSTATE=7;RD3Glb.FRM_FORMLEFT=8;RD3Glb.FRM_FORMTOP=9;RD3Glb.FRM_FORMWIDTH=10;RD3Glb.FRM_FORMHEIGHT=11;RD3Glb.FRM_RESMODEW=12;RD3Glb.FRM_RESMODEH=13;RD3Glb.FRM_PREVIEW=14;RD3Glb.FRM_BORDERTYPE=15;RD3Glb.FRM_VISPROP=16;RD3Glb.FRM_IMAGE=17;RD3Glb.FRM_WEBCAPTION=18;RD3Glb.FRM_BACKBUTTXT=19;RD3Glb.FRM_CLOSEONSEL=20;RD3Glb.FRM_MAXPROP=21;RD3Glb.AFR_CAPTION=0;RD3Glb.AFR_VERTICAL=1;RD3Glb.AFR_WIDTH=2;RD3Glb.AFR_HEIGHT=3;RD3Glb.AFR_MINWIDTH=4;RD3Glb.AFR_MINHEIGHT=5;RD3Glb.AFR_MAXWIDTH=6;RD3Glb.AFR_MAXHEIGHT=7;RD3Glb.AFR_FRHIDDEN=8;RD3Glb.AFR_USESMALLICON=9;RD3Glb.AFR_CHILD1=10;RD3Glb.AFR_CHILD2=11;RD3Glb.AFR_FRBORDER=12;RD3Glb.AFR_MAXPROP=13;RD3Glb.WFR_VISIBLE=1;RD3Glb.WFR_COLLAPSED=2;RD3Glb.WFR_COLLAPSABLE=3;RD3Glb.WFR_LOCKED=4;RD3Glb.WFR_LOCKABLE=5;RD3Glb.WFR_IMAGE=6;RD3Glb.WFR_SHOWSCROLLBAR=7;RD3Glb.WFR_DRAG=8;RD3Glb.WFR_DROP=9;RD3Glb.WFR_MAXPROPS=10;RD3Glb.PAN_PANELMODE=0;RD3Glb.PAN_STATUS=1;RD3Glb.PAN_NUMROWS=2;RD3Glb.PAN_MAXHROW=3;RD3Glb.PAN_PANELPAGE=4;RD3Glb.PAN_HEADERSIZE=5;RD3Glb.PAN_SHOWROWSELECTOR=6;RD3Glb.PAN_SHOWMULTIPLESEL=7;RD3Glb.PAN_ENABLEMULTIPLESEL=8;RD3Glb.PAN_DYNAMICROWS=9;RD3Glb.PAN_DYNAMICHEIGHT=10;RD3Glb.PAN_HASSCROLLBAR=11;RD3Glb.PAN_HASLIST=12;RD3Glb.PAN_HASFORM=13;RD3Glb.PAN_CANUPDATE=14;RD3Glb.PAN_CANDELETE=15;RD3Glb.PAN_CANINSERT=16;RD3Glb.PAN_CANSEARCH=17;RD3Glb.PAN_CANSORT=18;RD3Glb.PAN_LISTLEFT=19;RD3Glb.PAN_LISTTOP=20;RD3Glb.PAN_LISTWIDTH=21;RD3Glb.PAN_LISTHEIGHT=22;RD3Glb.PAN_ACTUALROW=23;RD3Glb.PAN_VRESMODE=24;RD3Glb.PAN_HRESMODE=25;RD3Glb.PAN_VISUALSTYLE=26;RD3Glb.PAN_FIXEDCOLS=27;RD3Glb.PAN_QBETIP=28;RD3Glb.PAN_SHOWTOOLBAR=29;RD3Glb.PAN_SHOWSTATUSBAR=30;RD3Glb.PAN_ACTUALPOSITION=31;RD3Glb.PAN_TOTALROWS=32;RD3Glb.PAN_ENABLEDCOMMANDS=33;RD3Glb.PAN_HASBOOK=34;RD3Glb.PAN_MASTER=35;RD3Glb.PAN_ADVTAB=36;RD3Glb.PAN_ACTIVATERIGHTCLICK=37;RD3Glb.PAN_INFOMSG=38;RD3Glb.PAN_SINGLEDOC=39;RD3Glb.PAN_CONFIRMDEL=40;RD3Glb.PAN_CMDBLOCK=41;RD3Glb.PAN_REORDERCOLUMN=42;RD3Glb.PAN_RESIZECOLUMN=43;RD3Glb.PAN_SENDGROUPS=44;RD3Glb.PAN_GROUPING=45;RD3Glb.PAN_SHOWGROUPUI=46;RD3Glb.PAN_HLDELETE=47;RD3Glb.PAN_SELALLONLYVIS=48;RD3Glb.PAN_TIPONEACHROW=49;RD3Glb.PAN_ENABLEINSERTLOCKED=50;RD3Glb.PAN_HASDOCTEMPLATE=51;RD3Glb.PAN_VISPROP=52;RD3Glb.PAN_LOADPOL=53;RD3Glb.PAN_PULLREF=54;RD3Glb.PAN_MAXPROPS=55;RD3Glb.FLD_INDEX=0;RD3Glb.FLD_VISIBLE=1;RD3Glb.FLD_ENABLED=2;RD3Glb.FLD_VISATTR=3;RD3Glb.FLD_LISTLIST=4;RD3Glb.FLD_CANACTIVATE=5;RD3Glb.FLD_OPTIONAL=6;RD3Glb.FLD_IMAGE=7;RD3Glb.FLD_HEADER=8;RD3Glb.FLD_TOOLTIP=9;RD3Glb.FLD_PAGE=10;RD3Glb.FLD_GROUP=11;RD3Glb.FLD_DATATYPE=12;RD3Glb.FLD_MAXLENGTH=13;RD3Glb.FLD_SORTMODE=14;RD3Glb.FLD_INLIST=15;RD3Glb.FLD_LISTHEADER=16;RD3Glb.FLD_HDRLIST=17;RD3Glb.FLD_HDRLISTABOVE=18;RD3Glb.FLD_LISTLEFT=19;RD3Glb.FLD_LISTTOP=20;RD3Glb.FLD_LISTWIDTH=21;RD3Glb.FLD_LISTHEIGHT=22;RD3Glb.FLD_LISTNUMROWS=23;RD3Glb.FLD_LISTHRESMODE=24;RD3Glb.FLD_LISTVRESMODE=25;RD3Glb.FLD_LISTHDRSIZE=26;RD3Glb.FLD_INFORM=27;RD3Glb.FLD_FORMHEADER=28;RD3Glb.FLD_HDRFORM=29;RD3Glb.FLD_HDRFORMABOVE=30;RD3Glb.FLD_FORMLEFT=31;RD3Glb.FLD_FORMTOP=32;RD3Glb.FLD_FORMWIDTH=33;RD3Glb.FLD_FORMHEIGHT=34;RD3Glb.FLD_FORMNUMROWS=35;RD3Glb.FLD_FORMHRESMODE=36;RD3Glb.FLD_FORMVRESMODE=37;RD3Glb.FLD_FORMHDRSIZE=38;RD3Glb.FLD_IDXPANEL=39;RD3Glb.FLD_SUBFRAME=40;RD3Glb.FLD_VALUELIST=41;RD3Glb.FLD_ACTWIDTH=42;RD3Glb.FLD_ACTIMAGE=43;RD3Glb.FLD_TABORDER=44;RD3Glb.FLD_QVS=45;RD3Glb.FLD_EDITORTYPE=46;RD3Glb.FLD_SCALE=47;RD3Glb.FLD_CMDIDX=48;RD3Glb.FLD_CAUSEVALIDATION=49;RD3Glb.FLD_ACTIVABLEDISABLED=50;RD3Glb.FLD_CANSORT=51;RD3Glb.FLD_LKE=52;RD3Glb.FLD_QBEENAB=53;RD3Glb.FLD_SUPERACTIVE=54;RD3Glb.FLD_USEHL=55;RD3Glb.FLD_VISPROP=56;RD3Glb.FLD_UNBOUND=57;RD3Glb.FLD_COMBOMULTISEL=58;RD3Glb.FLD_BACKCOLOR=59;RD3Glb.FLD_FORECOLOR=60;RD3Glb.FLD_FONTMOD=61;RD3Glb.FLD_MASK=62;RD3Glb.FLD_ALIGN=63;RD3Glb.FLD_USETEXTSELECTION=64;RD3Glb.FLD_WATERMARK=65;RD3Glb.FLD_IMGRESMODE=66;RD3Glb.FLD_OPENCOMBO=67;RD3Glb.FLD_BADGE=68;RD3Glb.FLD_EDCOLORS=69;RD3Glb.FLD_EDFONTS=70;RD3Glb.FLD_EDTOKENS=71;RD3Glb.FLD_EDTOOLBAR=72;RD3Glb.FLD_EDCOMMANDS=73;RD3Glb.FLD_DEFFORMAT=74;RD3Glb.FLD_MAXPROPS=75;RD3Glb.VAL_TEXT=0;RD3Glb.VAL_ERRORTEXT=1;RD3Glb.VAL_ERRORTYPE=2;RD3Glb.VAL_ENABLED=3;RD3Glb.VAL_VISIBLE=4;RD3Glb.VAL_VISUALSTYLE=5;RD3Glb.VAL_TOOLTIP=6;RD3Glb.VAL_INDEX=7;RD3Glb.VAL_ROWSEL=8;RD3Glb.VAL_VALUELIST=9;RD3Glb.VAL_BACKCOLOR=10;RD3Glb.VAL_FORECOLOR=11;RD3Glb.VAL_FONTMOD=12;RD3Glb.VAL_MASK=13;RD3Glb.VAL_ALIGN=14;RD3Glb.VAL_BADGE=15;RD3Glb.VAL_MAXPROPS=16;RD3Glb.PPG_STYLE=0;RD3Glb.PPG_VISUALSTYLE=1;RD3Glb.PPG_FLAGS=2;RD3Glb.PPG_IMAGE=3;RD3Glb.PPG_HEADER=4;RD3Glb.PPG_TOOLTIP=5;RD3Glb.PPG_INDEX=6;RD3Glb.PPG_BADGE=7;RD3Glb.PPG_MAXPROPS=8;RD3Glb.PGR_PAGE=0;RD3Glb.PGR_VISUALSTYLE=1;RD3Glb.PGR_FLAGS=2;RD3Glb.PGR_IMAGE=3;RD3Glb.PGR_HEADER=4;RD3Glb.PGR_TOOLTIP=5;RD3Glb.PGR_LISTLEFT=6;RD3Glb.PGR_LISTTOP=7;RD3Glb.PGR_LISTWIDTH=8;RD3Glb.PGR_LISTHEIGTH=9;RD3Glb.PGR_FORMLEFT=10;RD3Glb.PGR_FORMTOP=11;RD3Glb.PGR_FORMWIDTH=12;RD3Glb.PGR_FORMHEIGHT=13;RD3Glb.PGR_FORMHDRPOS=14;RD3Glb.PGR_LISTHDERPOS=15;RD3Glb.PGR_HEADERHEIGHT=16;RD3Glb.PGR_HEADERWIDTH=17;RD3Glb.PGR_INLIST=18;RD3Glb.PGR_COLLAPSIBLE=19;RD3Glb.PGR_COLLAPSED=20;RD3Glb.PGR_MAXPROPS=21;RD3Glb.MSG_CODE=0;RD3Glb.MSG_TEXT=1;RD3Glb.MSG_ICON=2;RD3Glb.MSG_TYPE=3;RD3Glb.MSG_TEMPORARY=4;RD3Glb.MSG_MAXPROPS=5;RD3Glb.TBV_SELECTEDTAB=0;RD3Glb.TBV_PLACEMENT=1;RD3Glb.TBV_HIDDENTABS=2;RD3Glb.TBV_AUTOSIZE=3;RD3Glb.TBV_MAXPROPS=4;RD3Glb.TAB_CONTENT=0;RD3Glb.TAB_IMAGE=1;RD3Glb.TAB_HEADER=2;RD3Glb.TAB_TOOLTIP=3;RD3Glb.TAB_STYLE=4;RD3Glb.TAB_BADGE=5;RD3Glb.TAB_MAXPROPS=6;RD3Glb.BBR_CMDSETIDX=0;RD3Glb.BBR_VERTICAL=1;RD3Glb.BBR_MAXPROPS=2;RD3Glb.TRE_SELECTEDNODE=0;RD3Glb.TRE_SELECTMULTI=1;RD3Glb.TRE_DRAGANDDROP=2;RD3Glb.TRE_ACTIVATEONEXPAND=3;RD3Glb.TRE_CTXMENUIDX=4;RD3Glb.TRE_ENABLED=5;RD3Glb.TRE_CHECKACTIVE=6;RD3Glb.TRE_MAXPROPS=7;RD3Glb.TRN_ALREADYEXPANDED=0;RD3Glb.TRN_EXPANDED=1;RD3Glb.TRN_CAPTION=2;RD3Glb.TRN_TOOLTIP=3;RD3Glb.TRN_IMAGE=4;RD3Glb.TRN_CANCHECK=5;RD3Glb.TRN_SELECTED=6;RD3Glb.TRN_BADGE=7;RD3Glb.TRN_MAXPROPS=8;RD3Glb.BOK_SHOWTOOLBAR=0;RD3Glb.BOK_SHOWSTATUSBAR=1;RD3Glb.BOK_PAGENUM=2;RD3Glb.BOK_PAGETOTAL=3;RD3Glb.BOK_PAGECONFIRMED=4;RD3Glb.BOK_HIDEBORDER=5;RD3Glb.BOK_ENABLEDCOMMANDS=6;RD3Glb.BOK_CACHESIZE=7;RD3Glb.BOK_FIXEDWIDTH=8;RD3Glb.BOK_FIXEDHEIGHT=9;RD3Glb.BOK_SCROLLDIR=10;RD3Glb.BOK_FORCESNAP=11;RD3Glb.BOK_OPTIMIZEDOM=12;RD3Glb.BOK_MAXPROPS=13;RD3Glb.PAG_PAGENUM=0;RD3Glb.PAG_UM=1;RD3Glb.PAG_WIDTH=2;RD3Glb.PAG_HEIGHT=3;RD3Glb.PAG_FITMODE=4;RD3Glb.PAG_MAXPROPS=5;RD3Glb.BOX_XPOS=0;RD3Glb.BOX_YPOS=1;RD3Glb.BOX_WIDTH=2;RD3Glb.BOX_HEIGHT=3;RD3Glb.BOX_VISATTR=4;RD3Glb.BOX_IMAGE=5;RD3Glb.BOX_INTERLINE=6;RD3Glb.BOX_STRETCH=7;RD3Glb.BOX_VISIBLE=8;RD3Glb.BOX_CANDRAG=9;RD3Glb.BOX_CANDROP=10;RD3Glb.BOX_CANTRANSFORM=11;RD3Glb.BOX_CANSCROLL=12;RD3Glb.BOX_TOOLTIP=13;RD3Glb.BOX_GRAPHFILE=14;RD3Glb.BOX_GRAPHMAP=15;RD3Glb.BOX_CANCLICK=16;RD3Glb.BOX_VISPROP=17;RD3Glb.BOX_SUBFORM=18;RD3Glb.BOX_BACKCOLOR=19;RD3Glb.BOX_FORECOLOR=20;RD3Glb.BOX_ALIGN=21;RD3Glb.BOX_FONTMOD=22;RD3Glb.BOX_BADGE=23;RD3Glb.BOX_MAXPROPS=24;RD3Glb.SPN_TEXT=1;RD3Glb.SPN_VALUE=2;RD3Glb.SPN_VISATTR=3;RD3Glb.SPN_MAXLEN=4;RD3Glb.SPN_VISIBLE=5;RD3Glb.SPN_ENABLED=6;RD3Glb.SPN_STRETCH=7;RD3Glb.SPN_TOOLTIP=8;RD3Glb.SPN_MIME=9;RD3Glb.SPN_HASIMAGE=10;RD3Glb.SPN_VALUELIST=11;RD3Glb.SPN_DATATYPE=12;RD3Glb.SPN_SCALE=13;RD3Glb.SPN_BACKCOLOR=14;RD3Glb.SPN_FORECOLOR=15;RD3Glb.SPN_FONTMOD=16;RD3Glb.SPN_MASK=17;RD3Glb.SPN_WATERMARK=18;RD3Glb.SPN_MAXPROPS=19;RD3Glb.SEC_XPOS=0;RD3Glb.SEC_YPOS=1;RD3Glb.SEC_WIDTH=2;RD3Glb.SEC_HEIGHT=3;RD3Glb.SEC_VISATTR=4;RD3Glb.SEC_VISIBLE=5;RD3Glb.SEC_NUMCOL=6;RD3Glb.SEC_COLSPACE=7;RD3Glb.SEC_MASTRO=8;RD3Glb.SEC_RECNUM=9;RD3Glb.SEC_OVERLAY=10;RD3Glb.SEC_MAXPROPS=11;RD3Glb.GRA_LIBRARY=0;RD3Glb.GRA_FILE=1;RD3Glb.GRA_CODICE=2;RD3Glb.GRA_MAP=3;RD3Glb.GRA_SWF=4;RD3Glb.GRA_HEIGHT=5;RD3Glb.GRA_WIDTH=6;RD3Glb.GRA_ACTIVE=7;RD3Glb.GRA_ERRTXT=8;RD3Glb.GRA_MAXPROPS=9;RD3Glb.SUF_HEIGHT=0;RD3Glb.SUF_WIDTH=1;RD3Glb.SUF_MAXPROPS=2;RD3Glb.VOICE_LISTENING=0;RD3Glb.VOICE_RESPONSE=1;RD3Glb.VOICE_SAY=2;RD3Glb.VOICE_MAXPROPS=3;RD3Glb.WEP_OBJ_SUPPRESSMENU=1;RD3Glb.WEP_OBJ_MAINCAPTION=2;RD3Glb.WEP_OBJ_HELPBUTTON=3;RD3Glb.WEP_OBJ_DEBUGBUTTON=4;RD3Glb.WEP_OBJ_CLOSEAPP=5;RD3Glb.WEP_OBJ_STARTBUTTON=6;RD3Glb.WEP_OBJ_CMDINPUT=7;RD3Glb.WEP_OBJ_FORMLIST=8;RD3Glb.WEP_OBJ_CLOSEALL=9;RD3Glb.SCZ_POSITION=0;RD3Glb.SCZ_TABVISIBILITY=1;RD3Glb.SCZ_SHOWPIN=2;RD3Glb.SCZ_ZONESTATE=3;RD3Glb.SCZ_SELECTEDFORM=4;RD3Glb.SCZ_ZONESIZE=5;RD3Glb.SCZ_VERTICALBEHAVIOUR=6;RD3Glb.SCZ_TABPOSITION=7;RD3Glb.SCZ_HASMENU=8;RD3Glb.SCZ_SWIPEMODE=9;RD3Glb.SCZ_MAXPROPS=10;function RolesSrv(a){this.iRoles;this.glbRole=new IDVariant();this.glbUser=new IDVariant();this.glbCompanyID="";this.glbDomainID="";this.glbAutLevel=0;this.glbLanguage=".";this.glbGroup=0;this.glbUserID=0;this.AlreadyInit;this.ActiveRoleCollection=new ArrayList();this.MainFrm=a}RolesSrv.prototype.InitRoles=function(){};RolesSrv.prototype.EnableRole=function(g,e,b){var j;var a;var h=false;for(var d=0;d<this.ActiveRoleCollection.Count();d++){a=this.ActiveRoleCollection[d];if(a.equals(g)){h=true;if(!e){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",115,"Roles.EnableRole","Removed role "+g.ToString())}this.ActiveRoleCollection.Remove(a)}break}}if(e&&!h){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",115,"Roles.EnableRole","Added role "+g.ToString())}this.ActiveRoleCollection.Add(g);if(this.glbRole.Type==IDVariant.NULL){this.glbRole.set(g)}}if(b){var k=new ArrayList(this.MainFrm.StackForm);for(var d=0;d<k.Count();d++){j=k[d];this.MainFrm.UnloadForm(j.FormIdx,false)}this.MainFrm.CmdObj.ResetRoles(this.MainFrm);this.ApplyRoles(0,null)}};RolesSrv.prototype.ApplyRoles=function(c,e){var f=new ArrayList();var j=new ArrayList();for(var b=0;b<this.ActiveRoleCollection.Count();b++){var k=this.ActiveRoleCollection[b];for(var d=0;d<this.iRoles.length;d++){if(this.iRoles[d]==null){continue}if(k.stringValue().equals(this.iRoles[d].Code.stringValue())){f.Add(this.iRoles[d]);break}}}if(f.Count()==0){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",116,"Roles.ApplyRoles","None of the roles set by the user have been found in the defined roles list")}this.glbRole=new IDVariant();return}for(var d=0;d<f.Count();d++){var k=f[d];var a=k.Parent;while(a!=null){if(f.IndexOf(a)==-1&&j.IndexOf(a)==-1){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",109,"Roles.ApplyRoles","Adding parent role "+a.Code+" while applying role "+k.Code)}j.Add(a)}a=a.Parent}}f.AddRange(j);for(var h=f.Count()-1;h>=0;h--){var k=f[h];k.Apply(c,e,this.MainFrm)}if(c==0){for(var d=0;d<this.MainFrm.CompList.Count();d++){var g=this.MainFrm.CompList[d];if(g.RolObj!=g.CompOwner.RolObj){g.RolObj.ApplyRoles(0,e)}}}};RolesSrv.prototype.CheckRole=function(){return this.glbRole.Type!=IDVariant.NULL};RolesSrv.prototype.ConfigureRoles=function(c,f){this.iRoles=new Array[c.RecordCount()];var d=0;try{while(!c.EOF()){this.iRoles[d]=new ARoleSrv();this.iRoles[d].Code=c.Get("RTC_Value");this.iRoles[d].iGuid=c.Get("RTC_Guid").stringValue();d++;c.MoveNext()}d=0;c.MoveFirst();while(!c.EOF()){var a=c.Get("RTC_Parent").stringValue();for(b=0;b<this.iRoles.length;b++){if(this.iRoles[b].iGuid.equals(a)){this.iRoles[d].Parent=iRoles[b];break}}d++;c.MoveNext()}var b=0;while(!f.EOF()){var a=f.Get("RTC_Parent").stringValue();if(b>=this.iRoles.length||!iRoles[b].iGuid.equals(a)){for(b=0;b<this.iRoles.length;b++){if(this.iRoles[b].iGuid.equals(a)){break}}}if(b<this.iRoles.length){var g=0;g|=(f.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0);g|=(f.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0);g|=(f.Get("RTC_CanUpdate").stringValue().equals("Y")?Glb.PAN_CANUPDATE:0);g|=(f.Get("RTC_CanInsert").stringValue().equals("Y")?Glb.PAN_CANINSERT:0);g|=(f.Get("RTC_CanDelete").stringValue().equals("Y")?Glb.PAN_CANDELETE:0);g|=(f.Get("RTC_CanSelect").stringValue().equals("Y")?Glb.PAN_CANSELECT:0);this.iRoles[b].AddRTCItem(f.Get("RTC_Object").stringValue(),f.Get("RTC_ObjForm").stringValue(),f.Get("RTC_ParentFrame").stringValue(),f.Get("RTC_ItemType").intValue(),g)}f.MoveNext()}}catch(h){WriteToConsoleError(h.message)}};RolesSrv.prototype.Clear=function(){var c=new ArrayList(this.ActiveRoleCollection);for(var a=0;a<c.Count();a++){var b=c[a];this.EnableRole(b,false,false)}};function RTCData(b,a){this.RSPanels;this.RSPanelFields;this.RSPanelGroups;this.RSForm;this.RSTabbeds;this.RSGraphs;this.RSTrees;this.RSTreeItems;this.RSButtonBars;this.RSBooks;this.RSMastros;this.RSBoxes;this.RSSpans;this.RSReports;this.RSSections;this.RSSubForms;this.Parent=b;this.iGuid=a}RTCData.prototype.ConfigureFrame=function(d,a,k){try{if(a.Get("RTC_Name").Type!=IDVariant.NULL){d.set_Caption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){d.Description=a.Get("RTC_Description").stringValue()}var b=k?"RTC_FrameHiddenBorder":"RTC_HiddenBorder";if(a.findColumn(b)!=-1&&a.Get(b).Type!=IDVariant.NULL){d.FrHidden=a.Get(b).stringValue().equals("Y")}if(a.Get("RTC_FrameBorder").Type!=IDVariant.NULL){d.FrBorder=a.Get("RTC_FrameBorder").stringValue().equals("Y")}if(a.findColumn("RTC_UseSmallIcon")!=-1&&a.Get("RTC_UseSmallIcon").Type!=IDVariant.NULL){d.set_PUseSmallIcon(a.Get("RTC_UseSmallIcon").stringValue().equals("Y"))}if(a.Get("RTC_Height").intValue()>0){d.FixedHeight=a.Get("RTC_Height").intValue()}if(a.Get("RTC_FixedWidth").stringValue().equals("Y")){if(a.Get("RTC_Width").intValue()>0){d.FixedWidth=a.Get("RTC_Width").intValue()}}if(d.TabIdx!=0&&d.Parent!=null&&d.Parent.Frames!=null&&d.TabIdx<d.Parent.Frames.length){var h=d.Parent.Frames[d.TabIdx].Content;var j=h.FindFrame(d);if(j>0){var c=h.ItemList[j];c.Header=d.Caption;c.RD3Change(RD3Glb.TAB_HEADER);c.Tooltip=d.Description;c.RD3Change(RD3Glb.TAB_TOOLTIP)}}}catch(g){}};RTCData.prototype.Load=function(a){this.RSPanels=this.Parent.LoadRS("Panels",a);this.RSPanelFields=this.Parent.LoadRS("PanelFields",a);this.RSPanelGroups=this.Parent.LoadRS("PanelGroups",a);this.RSForm=this.Parent.LoadRS("Forms",a);this.RSTabbeds=this.Parent.LoadRS("Tabbeds",a);this.RSGraphs=this.Parent.LoadRS("Graphs",a);this.RSTrees=this.Parent.LoadRS("Trees",a);this.RSTreeItems=this.Parent.LoadRS("TreeItems",a);this.RSBooks=this.Parent.LoadRS("Books",a);this.RSMastros=this.Parent.LoadRS("TemplatePages",a);this.RSBoxes=this.Parent.LoadRS("RptBoxes",a);this.RSSpans=this.Parent.LoadRS("RptSpans",a);this.RSReports=this.Parent.LoadRS("Reports",a);this.RSSections=this.Parent.LoadRS("Sections",a);this.RSButtonBars=this.Parent.LoadRS("ButtonBars",a);this.RSSubForms=this.Parent.LoadRS("SubForm",a)};RTCData.prototype.Reset=function(){try{this.RSPanels.MoveFirst();this.RSPanelFields.MoveFirst();this.RSPanelGroups.MoveFirst();this.RSForm.MoveFirst();this.RSTabbeds.MoveFirst();this.RSGraphs.MoveFirst();this.RSTrees.MoveFirst();this.RSTreeItems.MoveFirst();this.RSBooks.MoveFirst();this.RSMastros.MoveFirst();this.RSBoxes.MoveFirst();this.RSSpans.MoveFirst();this.RSReports.MoveFirst();this.RSSections.MoveFirst();this.RSButtonBars.MoveFirst();this.RSSubForms.MoveFirst()}catch(a){}};RTCData.prototype.ConfigureBook=function(l,r,o){try{var a=this.RSBooks;if(this.Parent.SearchObject(a,r.BookObj.GetRTCGuid(0))){if(r.BookObj.FrIndex()!=-1){this.ConfigureFrame(l.Frames[r.BookObj.FrIndex()],this.RSBooks,true)}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){r.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){r.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_ShowStatusBar").stringValue().length>0){r.ShowStatusBar=a.Get("RTC_ShowStatusBar").stringValue().equals("Y")}if(a.Get("RTC_ShowToolBar").stringValue().length>0){r.ShowToolbar=a.Get("RTC_ShowToolBar").stringValue().equals("Y")}if(a.Get("RTC_Width").intValue()>0){r.Width=a.Get("RTC_Width").intValue()}if(a.Get("RTC_Height").intValue()>0){r.Height=a.Get("RTC_Height").intValue()}if(a.Get("RTC_PrecountPages").Type!=IDVariant.NULL){r.BookObj.SetFlags(0,(a.Get("RTC_PrecountPages").stringValue().equals("Y")?1048576:0),1048576)}if(a.Get("RTC_HiddenBorder").Type!=IDVariant.NULL){r.BookObj.set_HideBorder(a.Get("RTC_HiddenBorder").stringValue().equals("Y"))}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){r.set_CanDrag(a.Get("RTC_CanDrag").stringValue().equals("Y"))}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){r.set_CanDrop(a.Get("RTC_CanDrop").stringValue().equals("Y"))}var p;var v;for(var k=1;k<r.BookObj.GetNumObjects();k++){var g=r.BookObj.GetObjType(k);switch(g){case IDREGlb.OBJ_MASTRO:var u=this.RSMastros;if(this.Parent.SearchObject(u,r.BookObj.GetRTCGuid(k))){r.BookObj.UpdateMastro(k,u.Get("RTC_Dim1"),u.Get("RTC_Dim2"),u.Get("RTC_UM"),u.Get("RTC_Orientation"),u.Get("RTC_FitMode"))}break;case IDREGlb.OBJ_RPTBOX:var c=this.RSBoxes;if(this.Parent.SearchObject(c,r.BookObj.GetRTCGuid(k))){p=0;p|=(c.Get("RTC_Visible").stringValue().equals("Y")?65536:0);p|=(c.Get("RTC_ShowPreview").stringValue().equals("Y")?131072:0);p|=(c.Get("RTC_ShowPrint").stringValue().equals("Y")?262144:0);p|=(c.Get("RTC_KeepTogether").stringValue().equals("Y")?524288:0);p|=(c.Get("RTC_CloseBorder").stringValue().equals("Y")?1048576:0);p|=(c.Get("RTC_OmitZero").stringValue().equals("Y")?2097152:0);p|=(c.Get("RTC_OmitDupl").stringValue().equals("Y")?4194304:0);p|=(c.Get("RTC_CanDrag").stringValue().equals("Y")?8388608:0);p|=(c.Get("RTC_CanDrop").stringValue().equals("Y")?16777216:0);p|=(c.Get("RTC_CanTrans").stringValue().equals("Y")?33554432:0);p|=(c.Get("RTC_CanScroll").stringValue().equals("Y")?67108864:0);v=0;v|=(c.Get("RTC_Visible").Type!=IDVariant.NULL?65536:0);v|=(c.Get("RTC_ShowPreview").Type!=IDVariant.NULL?131072:0);v|=(c.Get("RTC_ShowPrint").Type!=IDVariant.NULL?262144:0);v|=(c.Get("RTC_KeepTogether").Type!=IDVariant.NULL?524288:0);v|=(c.Get("RTC_CloseBorder").Type!=IDVariant.NULL?1048576:0);v|=(c.Get("RTC_OmitZero").Type!=IDVariant.NULL?2097152:0);v|=(c.Get("RTC_OmitDupl").Type!=IDVariant.NULL?4194304:0);v|=(c.Get("RTC_CanDrag").Type!=IDVariant.NULL?8388608:0);v|=(c.Get("RTC_CanDrop").Type!=IDVariant.NULL?16777216:0);v|=(c.Get("RTC_CanTrans").Type!=IDVariant.NULL?33554432:0);v|=(c.Get("RTC_CanScroll").Type!=IDVariant.NULL?67108864:0);var t=r.BookObj.BoxVisProp(k);if(c.Get("RTC_ResW").Type!=IDVariant.NULL){if(c.Get("RTC_ResW").stringValue().equals("N")){t&=~1}else{t|=1}}if(c.Get("RTC_ResH").Type!=IDVariant.NULL){if(c.Get("RTC_ResH").stringValue().equals("N")){t&=~2}else{t|=2}}if(c.Get("RTC_MoveX").Type!=IDVariant.NULL){if(c.Get("RTC_MoveX").stringValue().equals("N")){t&=~4}else{t|=4}}if(c.Get("RTC_MoveY").Type!=IDVariant.NULL){if(c.Get("RTC_MoveY").stringValue().equals("N")){t&=~8}else{t|=8}}if(c.Get("RTC_CancelMove").Type!=IDVariant.NULL){if(c.Get("RTC_CancelMove").stringValue().equals("N")){t&=~16}else{t|=16}}var s=(c.Get("RTC_VisualStyle").Type!=IDVariant.NULL?o.VisualStyleList.GetVS(c.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateRptBox(k,c.Get("RTC_Box1"),c.Get("RTC_Box2"),c.Get("RTC_Box3"),c.Get("RTC_Box4"),c.Get("RTC_Interline"),c.Get("RTC_HResMode"),c.Get("RTC_VResMode"),s,p,v,c.Get("RTC_Description"),c.Get("RTC_StretchMode"),t);if(c.Get("RTC_Icon").stringValue().length>0){r.BookObj.SetBoxImage(k,null,c.Get("RTC_Icon").stringValue())}if(c.Get("RTC_BackColor").Type!=IDVariant.NULL){r.BookObj.set_BoxBackgroundColor(k,c.Get("RTC_BackColor").intValue())}if(c.Get("RTC_ForeColor").Type!=IDVariant.NULL){r.BookObj.set_BoxForegroundColor(k,c.Get("RTC_ForeColor").intValue())}if(c.Get("RTC_Align").Type!=IDVariant.NULL){r.BookObj.set_BoxAlignment(k,c.Get("RTC_Align").intValue())}if(c.Get("RTC_FontMod").Type!=IDVariant.NULL){r.BookObj.set_BoxFontModifiers(k,c.Get("RTC_FontMod").stringValue())}}break;case IDREGlb.OBJ_RPTSPAN:var h=this.RSSpans;if(this.Parent.SearchObject(h,r.BookObj.GetRTCGuid(k))){p=0;p|=(h.Get("RTC_Visible").stringValue().equals("Y")?268435456:0);p|=(h.Get("RTC_Enabled").stringValue().equals("Y")?536870912:0);p|=(h.Get("RTC_Active").stringValue().equals("Y")?1073741824:0);v=0;v|=(h.Get("RTC_Visible").Type!=IDVariant.NULL?268435456:0);v|=(h.Get("RTC_Enabled").Type!=IDVariant.NULL?536870912:0);v|=(h.Get("RTC_Active").Type!=IDVariant.NULL?1073741824:0);var s=(h.Get("RTC_VisualStyle").Type!=IDVariant.NULL?o.VisualStyleList.GetVS(h.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateRptSpan(k,s,h.Get("RTC_DataType"),h.Get("RTC_Length"),h.Get("RTC_Scale"),p,v,h.Get("RTC_SpanTooltip"),h.Get("RTC_SpanValue"),h.Get("RTC_StretchMode"));if(h.Get("RTC_BackColor").Type!=IDVariant.NULL){r.BookObj.set_SpanBackgroundColor(k,h.Get("RTC_BackColor").intValue())}if(h.Get("RTC_ForeColor").Type!=IDVariant.NULL){r.BookObj.set_SpanForegroundColor(k,h.Get("RTC_ForeColor").intValue())}if(h.Get("RTC_Mask").Type!=IDVariant.NULL){r.BookObj.set_SpanMask(k,h.Get("RTC_Mask").stringValue())}if(h.Get("RTC_Watermark").Type!=IDVariant.NULL){r.BookObj.set_SpanWatermark(k,h.Get("RTC_Watermark").stringValue())}if(h.Get("RTC_FontMod").Type!=IDVariant.NULL){r.BookObj.set_SpanFontModifiers(k,h.Get("RTC_FontMod").stringValue())}}break;case IDREGlb.OBJ_REPORT:var q=this.RSReports;if(this.Parent.SearchObject(q,r.BookObj.GetRTCGuid(k))){p=0;p|=(q.Get("RTC_HideIfEmpty").stringValue().equals("Y")?65536:0);p|=(q.Get("RTC_Visible").stringValue().equals("Y")?131072:0);p|=(q.Get("RTC_AnyPage").stringValue().equals("Y")?262144:0);v=0;v|=(q.Get("RTC_HideIfEmpty").Type!=IDVariant.NULL?65536:0);v|=(q.Get("RTC_Visible").Type!=IDVariant.NULL?131072:0);v|=(q.Get("RTC_AnyPage").Type!=IDVariant.NULL?262144:0);r.BookObj.UpdateReport(k,p,v)}break;case IDREGlb.OBJ_SECTION:var d=this.RSSections;if(this.Parent.SearchObject(d,r.BookObj.GetRTCGuid(k))){p=0;p|=(d.Get("RTC_Visible").stringValue().equals("Y")?65536:0);p|=(d.Get("RTC_NewPageAfter").stringValue().equals("Y")?131072:0);p|=(d.Get("RTC_NewPageBefore").stringValue().equals("Y")?262144:0);p|=(d.Get("RTC_KeepTogether").stringValue().equals("Y")?524288:0);p|=(d.Get("RTC_KeepWithNext").stringValue().equals("Y")?1048576:0);p|=(d.Get("RTC_HideIfEmpty").stringValue().equals("Y")?2097152:0);p|=(d.Get("RTC_VerticalColumns").stringValue().equals("Y")?4194304:0);p|=(d.Get("RTC_ShowChildren").stringValue().equals("Y")?8388608:0);p|=(d.Get("RTC_Overlay").stringValue().equals("Y")?16777216:0);p|=(d.Get("RTC_Showonnewpage").stringValue().equals("Y")?33554432:0);p|=(d.Get("RTC_Showatboxbottom").stringValue().equals("Y")?67108864:0);v=0;v|=(d.Get("RTC_Visible").Type!=IDVariant.NULL?65536:0);v|=(d.Get("RTC_NewPageAfter").Type!=IDVariant.NULL?131072:0);v|=(d.Get("RTC_NewPageBefore").Type!=IDVariant.NULL?262144:0);v|=(d.Get("RTC_KeepTogether").Type!=IDVariant.NULL?524288:0);v|=(d.Get("RTC_KeepWithNext").Type!=IDVariant.NULL?1048576:0);v|=(d.Get("RTC_HideIfEmpty").Type!=IDVariant.NULL?2097152:0);v|=(d.Get("RTC_VerticalColumns").Type!=IDVariant.NULL?4194304:0);v|=(d.Get("RTC_ShowChildren").Type!=IDVariant.NULL?8388608:0);v|=(d.Get("RTC_Overlay").Type!=IDVariant.NULL?16777216:0);v|=(d.Get("RTC_Showonnewpage").Type!=IDVariant.NULL?33554432:0);v|=(d.Get("RTC_Showatboxbottom").Type!=IDVariant.NULL?67108864:0);var s=(d.Get("RTC_VisualStyle").Type!=IDVariant.NULL?o.VisualStyleList.GetVS(d.Get("RTC_VisualStyle").stringValue()):null);if(r.Parent.MainFrm.CompOwner!=null){s=r.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(r.Parent.MainFrm,s)}r.BookObj.UpdateSection(k,d.Get("RTC_Height"),d.Get("RTC_NumCol"),d.Get("RTC_ColSpace"),s,p,v)}break}}}}catch(m){}};RTCData.prototype.ConfigureButtonBar=function(b,g,d){try{var a=this.RSButtonBars;if(this.Parent.SearchObject(a,g.iGuid)){this.ConfigureFrame(b.Frames[g.FrIndex],a);if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_Width").Type!=IDVariant.NULL){g.Vertical=a.Get("RTC_Width").intValue()<a.Get("RTC_Height").intValue()}}}catch(c){}};RTCData.prototype.ConfigureGraph=function(b,g,d){try{var a=this.RSGraphs;if(this.Parent.SearchObject(a,g.iGuid)){if(g.FrIndex!=-1){this.ConfigureFrame(b.Frames[g.FrIndex],a)}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_NumColumns").Type!=IDVariant.NULL){g.set_NumSeries(a.Get("RTC_NumColumns").intValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){g.set_Title(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_GraphType").Type!=IDVariant.NULL){g.set_ChartType(a.Get("RTC_GraphType").intValue())}if(a.Get("RTC_NameX").Type!=IDVariant.NULL){g.set_LabelAxisX(a.Get("RTC_NameX").stringValue())}if(a.Get("RTC_NameY").Type!=IDVariant.NULL){g.set_LabelAxisY(a.Get("RTC_NameY").stringValue())}if(a.Get("RTC_LegType").Type!=IDVariant.NULL){g.set_Legenda(a.Get("RTC_LegType").intValue())}if(a.Get("RTC_VStyle").stringValue().length>0){var h=d.VisualStyleList.GetVS(a.Get("RTC_VStyle").stringValue());if(g.Parent.MainFrm.CompOwner!=null){h=g.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(g.Parent.MainFrm,h)}if(h>0){g.set_VisualStyleChart(h)}}if(a.Get("RTC_XAxis").Type!=IDVariant.NULL){g.set_AxisXVisible(a.Get("RTC_XAxis").stringValue().equals("Y"))}if(a.Get("RTC_YAxis").Type!=IDVariant.NULL){g.set_AxisYVisible(a.Get("RTC_YAxis").stringValue().equals("Y"))}if(a.Get("RTC_XGrid").Type!=IDVariant.NULL){g.set_GridXVisible(a.Get("RTC_XGrid").stringValue().equals("Y"))}if(a.Get("RTC_YGrid").Type!=IDVariant.NULL){g.set_GridYVisible(a.Get("RTC_YGrid").stringValue().equals("Y"))}if(a.Get("RTC_Active").Type!=IDVariant.NULL){g.set_Hyperlink(a.Get("RTC_Active").stringValue().equals("Y"),true)}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}}}catch(c){}};RTCData.prototype.ConfigureTree=function(d,j,h){try{var c=this.RSTrees;var b=this.RSTreeItems;if(this.Parent.SearchObject(c,j.iGuid)){this.ConfigureFrame(d.Frames[j.FrIndex],c);if(c.Get("RTC_Visible").Type!=IDVariant.NULL){j.Visible=c.Get("RTC_Visible").stringValue().equals("Y")}if(c.Get("RTC_Collapsed").Type!=IDVariant.NULL){j.Collapsed=c.Get("RTC_Collapsed").stringValue().equals("Y")}if(c.Get("RTC_Width").intValue()>0){j.Width=c.Get("RTC_Width").intValue()-Glb.PAN_OFFS_X}if(c.Get("RTC_Height").intValue()>0){j.Height=c.Get("RTC_Height").intValue()-Glb.PAN_OFFS_Y}if(c.Get("RTC_Active").Type!=IDVariant.NULL){j.set_IsActive(c.Get("RTC_Active").stringValue().equals("Y"))}if(c.Get("RTC_CanDrag").Type!=IDVariant.NULL){j.set_CanDrag(c.Get("RTC_CanDrag").stringValue().equals("Y"))}if(c.Get("RTC_CanDrop").Type!=IDVariant.NULL){j.set_CanDrop(c.Get("RTC_CanDrop").stringValue().equals("Y"))}}for(var a=1;a<j.ItemList.length;a++){if(this.Parent.SearchObject(b,j.GetItem(a).iGuid)){if(b.Get("RTC_Icon").Type!=IDVariant.NULL){j.GetItem(a).Image=b.Get("RTC_Icon").stringValue()}if(b.Get("RTC_Name").Type!=IDVariant.NULL){j.GetItem(a).Name=b.Get("RTC_Name").stringValue()}if(b.Get("RTC_Description").Type!=IDVariant.NULL){j.GetItem(a).Tooltip=b.Get("RTC_Description").stringValue()}if(b.Get("RTC_Tooltip").Type!=IDVariant.NULL){j.GetItem(a).HasTooltip=b.Get("RTC_Tooltip").stringValue().equals("Y")}}}}catch(g){}};RTCData.prototype.ConfigureTabbed=function(b,g,d){try{var a=this.RSTabbeds;if(this.Parent.SearchObject(a,g.iGuid)){this.ConfigureFrame(b.Frames[g.FrIndex],a);if(a.Get("RTC_Orientation").Type!=IDVariant.NULL){g.Placement=a.Get("RTC_Orientation").intValue()}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){g.Visible=a.Get("RTC_Visible").stringValue().equals("Y")}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){g.Collapsed=a.Get("RTC_Collapsed").stringValue().equals("Y")}if(a.Get("RTC_AutoSize").Type!=IDVariant.NULL){g.AutoSize=a.Get("RTC_AutoSize").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){g.HiddenTabs=a.Get("RTC_HiddenTabs").stringValue().equals("Y")}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){g.set_CanDrag(a.Get("RTC_CanDrag").stringValue().equals("Y"))}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){g.set_CanDrop(a.Get("RTC_CanDrop").stringValue().equals("Y"))}}}catch(c){}};RTCData.prototype.ConfigurePanel=function(X,O,g){try{var q=this.RSPanels;var M=this.RSPanelFields;var aa=this.RSPanelGroups;if(this.Parent.SearchObject(q,O.GetRTCGuid(Glb.OBJ_PANEL,0))){if(O.FrIndex!=-1){this.ConfigureFrame(X.Frames[O.FrIndex],q)}if(q.Get("RTC_Width").intValue()>0){O.SetRect(Glb.OBJ_RECT,0,0,0,0,q.Get("RTC_Width").intValue()-Glb.PAN_OFFS_X,q.Get("RTC_Height").intValue()-Glb.PAN_OFFS_Y,0,0)}O.SetRect(Glb.OBJ_PANEL,0,0,q.Get("RTC_ListDim1"),q.Get("RTC_ListDim2"),q.Get("RTC_ListDim3"),q.Get("RTC_ListDim4"),q.Get("RTC_ListHResMode"),q.Get("RTC_ListVResMode"));if(q.Get("RTC_ListDim5").Type!=IDVariant.NULL){O.SetHeaderSize(Glb.OBJ_PANEL,0,0,q.Get("RTC_ListDim5").intValue())}if(q.Get("RTC_InitStatus").Type!=IDVariant.NULL){O.InitStatus=q.Get("RTC_InitStatus").intValue()}if(q.Get("RTC_Icon").stringValue().length>0){O.SetImage(Glb.OBJ_PANEL,0,0,q.Get("RTC_Icon").stringValue().trim());if(O.Parent!=null&&O.Parent.Frames[O.FrIndex].InTabbed&&O.Parent.Frames[O.Parent.Frames[O.FrIndex].TabIdx]!=null){var F=O.Parent.Frames[O.Parent.Frames[O.FrIndex].TabIdx].Content;var T=F.ItemList[O.Parent.Frames[O.FrIndex].TabIdx];T.Image=O.iImage;T.RD3Change(RD3Glb.TAB_IMAGE)}}if(q.Get("RTC_QBEForm").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_QBEForm").stringValue().equals("Y")?Glb.PAN_QBEFORM:0),Glb.PAN_QBEFORM)}if(q.Get("RTC_ScrollRecords").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_ScrollRecords").stringValue().equals("Y")?Glb.PAN_SCROLLREC:0),Glb.PAN_SCROLLREC)}if(q.Get("RTC_HasForm").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_HasForm").stringValue().equals("Y")?Glb.PAN_HASFORM:0),Glb.PAN_HASFORM)}if(q.Get("RTC_HasList").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_HasList").stringValue().equals("Y")?Glb.PAN_HASLIST:0),Glb.PAN_HASLIST)}if(q.Get("RTC_StartForm").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_StartForm").stringValue().equals("Y")?Glb.PAN_STARTFORM:0),Glb.PAN_STARTFORM)}if(q.Get("RTC_CanUpdate").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_CanUpdate").stringValue().equals("Y")?Glb.PAN_CANUPDATE:0),Glb.PAN_CANUPDATE)}if(q.Get("RTC_CanDelete").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_CanDelete").stringValue().equals("Y")?Glb.PAN_CANDELETE:0),Glb.PAN_CANDELETE)}if(q.Get("RTC_CanInsert").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_CanInsert").stringValue().equals("Y")?Glb.PAN_CANINSERT:0),Glb.PAN_CANINSERT)}if(q.Get("RTC_CanSelect").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_CanSelect").stringValue().equals("Y")?Glb.PAN_CANSELECT:0),Glb.PAN_CANSELECT)}if(q.Get("RTC_CanSort").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_CanSort").stringValue().equals("Y")?Glb.PAN_CANSORT:0),Glb.PAN_CANSORT)}if(q.Get("RTC_AutoSave").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PANEL,0,(q.Get("RTC_AutoSave").stringValue().equals("Y")?Glb.PAN_AUTOSAVE:0),Glb.PAN_AUTOSAVE)}if(q.Get("RTC_Lockable").stringValue().length>0){O.Lockable=q.Get("RTC_Lockable").stringValue().equals("Y")}if(q.Get("RTC_Locked").stringValue().length>0){O.iLocked=q.Get("RTC_Locked").stringValue().equals("Y")}if(q.Get("RTC_ShowInfoMessages").stringValue().length>0){O.ShowInfoMessages=q.Get("RTC_ShowInfoMessages").stringValue().equals("Y")}if(q.Get("RTC_ShowToolBar").Type!=IDVariant.NULL){O.ShowToolbar=q.Get("RTC_ShowToolBar").stringValue().equals("Y")}if(q.Get("RTC_ShowStatusBar").Type!=IDVariant.NULL){O.ShowStatusbar=q.Get("RTC_ShowStatusBar").stringValue().equals("Y")}if(q.Get("RTC_ShowRowSelector").Type!=IDVariant.NULL){O.ShowRowSelector=q.Get("RTC_ShowRowSelector").stringValue().equals("Y")}if(q.Get("RTC_DynamicRows").stringValue().length>0){O.SetDynRows(q.Get("RTC_DynamicRows").intValue(),q.Get("RTC_VariableHeight").stringValue().equals("Y"))}if(q.Get("RTC_Enabled").Type!=IDVariant.NULL){O.Enabled=q.Get("RTC_Enabled").stringValue().equals("Y")?1:0}if(q.Get("RTC_Visible").Type!=IDVariant.NULL){O.Visible=q.Get("RTC_Visible").stringValue().equals("Y")}if(q.Get("RTC_Collapsed").Type!=IDVariant.NULL){O.Collapsed=q.Get("RTC_Collapsed").stringValue().equals("Y")}O.SetFlags(Glb.OBJ_PANEL,0,(O.Visible)?Glb.OBJ_VISIBLE:0,Glb.OBJ_VISIBLE);if(q.Get("RTC_EnableMultiSel").stringValue().length>0){O.iEnableMultipleSel=q.Get("RTC_EnableMultiSel").stringValue().Equals("Y")}if(q.Get("RTC_ShowMultiSel").stringValue().length>0){O.iShowMultipleSel=q.Get("RTC_ShowMultiSel").stringValue().Equals("Y")}if(q.Get("RTC_ConfDelete").stringValue().length>0){O.ConfirmDelete=q.Get("RTC_ConfDelete").stringValue().Equals("Y")}if(q.Get("RTC_VStyle").stringValue().length>0){var m=g.VisualStyleList.GetVS(q.Get("RTC_VStyle").stringValue());if(O.Parent.MainFrm.CompOwner!=null){m=O.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(O.Parent.MainFrm,m)}if(m>0){O.set_VisualStyle(Glb.OBJ_PANEL,0,m)}}if(q.Get("RTC_ReorderCols").Type!=IDVariant.NULL){O.set_CanReorderColumn(q.Get("RTC_ReorderCols").stringValue().equals("Y"))}if(q.Get("RTC_ResizeCols").Type!=IDVariant.NULL){O.set_CanResizeColumn(q.Get("RTC_ResizeCols").stringValue().equals("Y"))}if(q.Get("RTC_CanDrag").Type!=IDVariant.NULL){O.set_CanDrag(q.Get("RTC_CanDrag").stringValue().equals("Y"))}if(q.Get("RTC_CanDrop").Type!=IDVariant.NULL){O.set_CanDrop(q.Get("RTC_CanDrop").stringValue().equals("Y"))}if(q.Get("RTC_CanGroup").Type!=IDVariant.NULL&&O.iEnabledGrouping!=q.Get("RTC_CanGroup").stringValue().equals("Y")){O.set_GroupingEnabled(q.Get("RTC_CanGroup").stringValue().equals("Y"))}if(q.Get("RTC_ShowGroups").Type!=IDVariant.NULL&&O.iShowGroups!=q.Get("RTC_ShowGroups").stringValue().equals("Y")){O.set_ShowGroups(q.Get("RTC_ShowGroups").stringValue().equals("Y"))}if(q.Get("RTC_ResOnlyVis").Type!=IDVariant.NULL){O.ResOnlyVisFlds=q.Get("RTC_ResOnlyVis").stringValue().equals("Y")}}for(var U=0;U<O.UFields();U++){if(this.Parent.SearchObject(M,O.GetRTCGuid(Glb.OBJ_FIELD,U))){if(O.bFields(U).IdxPanel==-1&&M.Get("RTC_StaticWithTitle").intValue()!=-1){if(M.Get("RTC_Description").Type!=IDVariant.NULL){O.set_Header(Glb.OBJ_FIELD,U,M.Get("RTC_Description").stringValue())}}else{if(M.Get("RTC_Name").Type!=IDVariant.NULL){O.set_Header(Glb.OBJ_FIELD,U,M.Get("RTC_Name").stringValue())}if(M.Get("RTC_Description").Type!=IDVariant.NULL){O.set_ToolTip(Glb.OBJ_FIELD,U,M.Get("RTC_Description").stringValue())}}if(M.Get("RTC_ListHeader").Type!=IDVariant.NULL){O.SetAbbrHeader(Glb.OBJ_FIELD,U,Glb.PANEL_LIST,M.Get("RTC_ListHeader").stringValue())}if(M.Get("RTC_FormHeader").Type!=IDVariant.NULL){O.SetAbbrHeader(Glb.OBJ_FIELD,U,Glb.PANEL_FORM,M.Get("RTC_FormHeader").stringValue())}if(M.Get("RTC_DataType").Type!=IDVariant.NULL){O.bFields(U).DataType=M.Get("RTC_DataType").intValue()}if(M.Get("RTC_Length").Type!=IDVariant.NULL){O.bFields(U).MaxLength=(M.Get("RTC_Length").intValue()>32000)?32000:M.Get("RTC_Length").intValue()}if(M.Get("RTC_Scale").Type!=IDVariant.NULL){O.bFields(U).vScale=M.Get("RTC_Scale").intValue()}if(M.Get("RTC_Icon").Type!=IDVariant.NULL){O.SetImage(Glb.OBJ_FIELD,U,0,M.Get("RTC_Icon").stringValue(),O.bFields(U).UseHilight)}var J=(M.Get("RTC_Pos1").Type!=IDVariant.NULL?M.Get("RTC_Pos1").intValue():O.bFields(U).ListLeft);var I=(M.Get("RTC_Pos2").Type!=IDVariant.NULL?M.Get("RTC_Pos2").intValue():O.bFields(U).ListTop);var K=(M.Get("RTC_Dim1").Type!=IDVariant.NULL?M.Get("RTC_Dim1").intValue():O.bFields(U).ListWidth);var W=(M.Get("RTC_Dim2").Type!=IDVariant.NULL?M.Get("RTC_Dim2").intValue():O.bFields(U).ListHeight);var Q;if((O.bFields(U).Flags&Glb.FLD_INLIST)!=0&&(O.bFields(U).Flags&Glb.FLD_LISTLIST)!=0){Q=0}else{Q=(M.Get("RTC_Dim3").Type!=IDVariant.NULL?M.Get("RTC_Dim3").intValue():O.bFields(U).HeaderSize[Glb.PANEL_LIST]);if(M.Get("RTC_HdrHL").stringValue().equals("Y")){if(M.Get("RTC_HdrVL").stringValue().equals("Y")){I=I+Q+4;W=W-Q-4}else{J=J+Q+4;K=K-Q-4}}}O.SetRect(Glb.OBJ_FIELD,U,Glb.PANEL_LIST,new IDVariant(J),new IDVariant(I),new IDVariant(K),new IDVariant(W),M.Get("RTC_HResMode1"),M.Get("RTC_VResMode1"));O.SetHeaderSize(Glb.OBJ_FIELD,U,Glb.PANEL_LIST,Q);J=(M.Get("RTC_Pos3").Type!=IDVariant.NULL?M.Get("RTC_Pos3").intValue():O.bFields(U).FormLeft);I=(M.Get("RTC_Pos4").Type!=IDVariant.NULL?M.Get("RTC_Pos4").intValue():O.bFields(U).FormTop);K=(M.Get("RTC_Dim4").Type!=IDVariant.NULL?M.Get("RTC_Dim4").intValue():O.bFields(U).FormWidth);W=(M.Get("RTC_Dim5").Type!=IDVariant.NULL?M.Get("RTC_Dim5").intValue():O.bFields(U).FormHeight);Q=(M.Get("RTC_Dim6").Type!=IDVariant.NULL?M.Get("RTC_Dim6").intValue():O.bFields(U).HeaderSize[Glb.PANEL_FORM]);if(M.Get("RTC_HdrHF").stringValue().equals("Y")){if(M.Get("RTC_HdrVF").stringValue().equals("Y")){I=I+Q+4;W=W-Q-4}else{J=J+Q+4;K=K-Q-4}}O.SetRect(Glb.OBJ_FIELD,U,Glb.PANEL_FORM,new IDVariant(J),new IDVariant(I),new IDVariant(K),new IDVariant(W),M.Get("RTC_HResMode2"),M.Get("RTC_VResMode2"));O.SetHeaderSize(Glb.OBJ_FIELD,U,Glb.PANEL_FORM,Q);var R=(M.Get("RTC_Visible").Type!=IDVariant.NULL?M.Get("RTC_Visible").stringValue().equals("Y"):(O.bFields(U).Flags&Glb.OBJ_VISIBLE));if(R){var b=(M.Get("RTC_InForm").Type!=IDVariant.NULL?M.Get("RTC_InForm").stringValue().equals("Y"):(O.bFields(U).Flags&Glb.FLD_INFORM));var r=(b&&(O.Flags&Glb.PAN_HASFORM)!=0);var D=(M.Get("RTC_InList").Type!=IDVariant.NULL?(M.Get("RTC_InList").stringValue().equals("Y")||M.Get("RTC_InList").stringValue().equals("L")):(O.bFields(U).Flags&Glb.FLD_INLIST));var c=(D&&(O.Flags&Glb.PAN_HASLIST)!=0);if(!r&&!c){R=false}}O.SetFlags(Glb.OBJ_FIELD,U,(R?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE);if(M.Get("RTC_Enabled").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(M.Get("RTC_Vertical").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(M.Get("RTC_InForm").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_InForm").stringValue().equals("Y")?Glb.FLD_INFORM:0),Glb.FLD_INFORM)}if(M.Get("RTC_InList").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_InList").stringValue().equals("Y")||M.Get("RTC_InList").stringValue().equals("L")?Glb.FLD_INLIST:0),Glb.FLD_INLIST)}if(M.Get("RTC_InList").stringValue().equals("L")){O.SetFlags(Glb.OBJ_FIELD,U,Glb.FLD_LISTLIST,Glb.FLD_LISTLIST)}if(M.Get("RTC_HdrVF").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_HdrVF").stringValue().equals("Y")?Glb.FLD_VERTHDRFORM:0),Glb.FLD_VERTHDRFORM)}if(M.Get("RTC_HdrVL").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_HdrVL").stringValue().equals("Y")?Glb.FLD_VERTHDRLIST:0),Glb.FLD_VERTHDRLIST)}if(M.Get("RTC_HdrHF").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_HdrHF").stringValue().equals("Y")?Glb.FLD_NOHDRFORM:0),Glb.FLD_NOHDRFORM)}if(M.Get("RTC_HdrHL").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_HdrHL").stringValue().equals("Y")?Glb.FLD_NOHDRLIST:0),Glb.FLD_NOHDRLIST)}if(M.Get("RTC_IsOptional").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_IsOptional").stringValue().equals("Y")?Glb.FLD_ISOPT:0),Glb.FLD_ISOPT)}if(M.Get("RTC_NoActDis").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_FIELD,U,(M.Get("RTC_NoActDis").stringValue().equals("Y")?Glb.FLD_NOACTD:0),Glb.FLD_NOACTD)}if((O.Fields[U].Flags&Glb.FLD_INLIST)==0&&(O.Fields[U].Flags&Glb.FLD_LISTLIST)!=0){O.SetFlags(Glb.OBJ_FIELD,U,0,Glb.FLD_LISTLIST)}if(M.Get("RTC_VStyle").stringValue().length>0){var m=g.VisualStyleList.GetVS(M.Get("RTC_VStyle").stringValue());if(O.Parent.MainFrm.CompOwner!=null){m=O.Parent.MainFrm.VisualStyleList.GetTrueIdxInverse(O.Parent.MainFrm,m)}if(m>0){O.set_VisualStyle(Glb.OBJ_FIELD,U,m)}}if(M.Get("RTC_IsActive").Type!=IDVariant.NULL){O.SetFieldActive(U,M.Get("RTC_IsActive").stringValue().equals("Y"))}if(O.Fields[U].DataType==Glb.DT_DOC_OLE){O.SetFieldBlobSize(U,M.Get("RTC_MaxAutoShow"),M.Get("RTC_MaxUpload"),true)}if(M.Get("RTC_TabOrder1").Type!=IDVariant.NULL&&M.Get("RTC_TabOrder2").Type!=IDVariant.NULL){if(M.Get("RTC_TabOrder1").intValue()!=-1||M.Get("RTC_TabOrder2").intValue()!=-1){if(!O.IsAdvTabOrderEnabled()){var u=0;var l=true;for(var S=0;S<O.Fields.length;S++){if(l||(O.Fields[S].Flags&Glb.FLD_INLIST)!=0||(O.Fields[S].Flags&Glb.FLD_INFORM)!=0){O.SetTabOrder(O.Fields[S].Index,u,Glb.PANEL_FORM);O.SetTabOrder(O.Fields[S].Index,u,Glb.PANEL_LIST);u++}l=false}}if(U==0||(O.Fields[U].Flags&Glb.FLD_INFORM)!=0||(O.Fields[U].Flags&Glb.FLD_INLIST)!=0){var z=M.Get("RTC_TabOrder1").intValue();if(z>O.UFields()){z=O.UFields()}var A=M.Get("RTC_TabOrder2").intValue();if(A>O.UFields()){A=O.UFields()}O.SetTabOrder(U,z,Glb.PANEL_FORM);O.SetTabOrder(U,A,Glb.PANEL_LIST)}}}if(M.Get("RTC_CanSort").Type!=IDVariant.NULL){O.Fields[U].set_VisualFlag(Glb.FLDVISPROP_CANSORT,M.Get("RTC_CanSort").stringValue().equals("Y"))}if(M.Get("RTC_AutoGroup").Type!=IDVariant.NULL){O.Fields[U].set_VisualFlag(Glb.FLDVISPROP_AUTOCLUSTER,M.Get("RTC_AutoGroup").stringValue().equals("Y"))}if(M.Get("RTC_OnEachKey").Type!=IDVariant.NULL){O.Fields[U].set_VisualFlag(Glb.FLDVISPROP_ONEACHKEY,M.Get("RTC_OnEachKey").stringValue().equals("Y"))}if(M.Get("RTC_OnlyIcon").Type!=IDVariant.NULL){O.Fields[U].set_VisualFlag(Glb.FLDVISPROP_ONLYICON,M.Get("RTC_OnlyIcon").stringValue().equals("Y"))}if(M.Get("RTC_ShowAct").Type!=IDVariant.NULL){O.Fields[U].set_VisualFlag(Glb.FLDVISPROP_SHOWACT,M.Get("RTC_ShowAct").stringValue().equals("Y"))}if(M.Get("RTC_BackColor").Type!=IDVariant.NULL){O.Fields[U].BackColor=(M.Get("RTC_BackColor").intValue()==-1?-2:M.Get("RTC_BackColor").intValue())}if(M.Get("RTC_ForeColor").Type!=IDVariant.NULL){O.Fields[U].ForeColor=(M.Get("RTC_ForeColor").intValue()==-1?-2:M.Get("RTC_ForeColor").intValue())}if(M.Get("RTC_Align").Type!=IDVariant.NULL){O.Fields[U].Alignment=(M.Get("RTC_Align").intValue()==1?-1:M.Get("RTC_Align").intValue())}if(M.Get("RTC_Mask").Type!=IDVariant.NULL){O.Fields[U].Mask=M.Get("RTC_Mask").stringValue()}if(M.Get("RTC_FontMod").Type!=IDVariant.NULL){O.Fields[U].FontMod=M.Get("RTC_FontMod").stringValue()}if(M.Get("RTC_Watermark").Type!=IDVariant.NULL){O.Fields[U].iWaterMark=M.Get("RTC_Watermark").stringValue()}if(M.Get("RTC_ResImg").Type!=IDVariant.NULL){O.Fields[U].ImageResMode=M.Get("RTC_ResImg").intValue()}}}for(var U=0;U<O.UPages();U++){if(this.Parent.SearchObject(aa,O.GetRTCGuid(Glb.OBJ_PAGE,U))){if(aa.Get("RTC_Name").Type!=IDVariant.NULL){O.set_Header(Glb.OBJ_PAGE,U,aa.Get("RTC_Name").stringValue())}if(aa.Get("RTC_Description").Type!=IDVariant.NULL){O.set_ToolTip(Glb.OBJ_PAGE,U,aa.Get("RTC_Description").stringValue())}if(aa.Get("RTC_Icon").Type!=IDVariant.NULL){O.SetImage(Glb.OBJ_PAGE,U,0,aa.Get("RTC_Icon").stringValue())}if(aa.Get("RTC_Visible").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PAGE,U,(aa.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE)}if(aa.Get("RTC_Enabled").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PAGE,U,(aa.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(aa.Get("RTC_Vertical").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_PAGE,U,(aa.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(aa.Get("RTC_VStyle").stringValue().length>0){var m=g.VisualStyleList.GetVS(aa.Get("RTC_VStyle").stringValue());if(O.Parent.MainFrm.CompOwner!=null){m=g.VisualStyleList.GetTrueIdxInverse(O.Parent.MainFrm,m)}if(m>0){O.set_VisualStyle(Glb.OBJ_PAGE,U,m)}}}}for(var U=0;U<O.UGroups();U++){if(this.Parent.SearchObject(aa,O.GetRTCGuid(Glb.OBJ_GROUP,U))){if(aa.Get("RTC_Name").Type!=IDVariant.NULL){O.set_Header(Glb.OBJ_GROUP,U,aa.Get("RTC_Name").stringValue())}if(aa.Get("RTC_Description").Type!=IDVariant.NULL){O.set_ToolTip(Glb.OBJ_GROUP,U,aa.Get("RTC_Description").stringValue())}if(aa.Get("RTC_Icon").Type!=IDVariant.NULL){O.SetImage(Glb.OBJ_GROUP,U,0,aa.Get("RTC_Icon").stringValue())}if(aa.Get("RTC_HdrPos1").Type!=IDVariant.NULL){O.SetHeaderPos(Glb.OBJ_GROUP,U,Glb.PANEL_LIST,aa.Get("RTC_HdrPos1").intValue())}if(aa.Get("RTC_HdrPos2").Type!=IDVariant.NULL){O.SetHeaderPos(Glb.OBJ_GROUP,U,Glb.PANEL_FORM,aa.Get("RTC_HdrPos2").intValue())}if(aa.Get("RTC_Visible").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_GROUP,U,(aa.Get("RTC_Visible").stringValue().equals("Y")?Glb.OBJ_VISIBLE:0),Glb.OBJ_VISIBLE)}if(aa.Get("RTC_Enabled").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_GROUP,U,(aa.Get("RTC_Enabled").stringValue().equals("Y")?Glb.OBJ_ENABLED:0),Glb.OBJ_ENABLED)}if(aa.Get("RTC_Vertical").Type!=IDVariant.NULL){O.SetFlags(Glb.OBJ_GROUP,U,(aa.Get("RTC_Vertical").stringValue().equals("Y")?Glb.OBJ_VERTICAL:0),Glb.OBJ_VERTICAL)}if(aa.Get("RTC_VStyle").stringValue().length>0){var m=g.VisualStyleList.GetVS(aa.Get("RTC_VStyle").stringValue());if(O.Parent.MainFrm.CompOwner!=null){m=g.VisualStyleList.GetTrueIdxInverse(O.Parent.MainFrm,m)}if(m>0){O.set_VisualStyle(Glb.OBJ_GROUP,U,m)}}if(aa.Get("RTC_CanCollapse").Type!=IDVariant.NULL){O.Groups[U].Collapsible=aa.Get("RTC_CanCollapse").stringValue().equals("Y")}if(aa.Get("RTC_Collapsed").Type!=IDVariant.NULL){O.Groups[U].Collapsed=aa.Get("RTC_Collapsed").stringValue().equals("Y")}}}var v=0;for(var U=0;U<O.UFields();U++){var V=O.Fields[U];if(((V.Flags&Glb.FLD_INLIST)!=0)&&((V.Flags&Glb.FLD_LISTLIST)!=0)&&V.Page==-1){var R=true;if(V.Group!=-1){if((O.bGroups(V.Group).Flags&Glb.OBJ_VISIBLE)==0){R=false}}if(R&&(V.Flags&Glb.OBJ_VISIBLE)==0){R=false}if(R){v=v+V.ListWidth}}}if(O.IsAdvTabOrderEnabled()){var d=new Array(O.UFields()+1);var L=new Array(O.UFields()+1);for(var Z=0;Z<d.length;Z++){d[Z]=-1}for(var Z=0;Z<L.length;Z++){L[Z]=-1}for(var E=0;E<=1;E++){var C=(E==0?d.length:L.length);for(var Z=0;Z<C;Z++){var G=-1;var t=(E==0?O.ListTabOrder:O.FormTabOrder);for(var o=0;o<t.length;o++){if(t[o]!=-1&&t[o]<O.UFields()&&(t[o]==0||(O.bFields(t[o]).Flags&Glb.FLD_INLIST)!=0||(O.bFields(t[o]).Flags&Glb.FLD_INFORM)!=0)){G=t[o];if(E==0){d[Z]=G}else{L[Z]=G}t[o]=-1;break}}if(G!=-1){for(var o=0;o<t.length;o++){if(t[o]==G){t[o]=-1}}}}}var N=true;for(var H=0;H<O.UFields();H++){if(N||(O.Fields[H].Flags&Glb.FLD_INLIST)!=0||(O.Fields[H].Flags&Glb.FLD_INFORM)!=0){for(var E=0;E<=1;E++){var B=-1;var k=false;var t=(E==0?d:L);for(var Z=0;Z<t.length;Z++){if(t[Z]==H){k=true;break}if(t[Z]==-1&&B==-1){B=Z}}if(k==false&&B>=0&&B<t.length){t[B]=H}}}N=false}for(var Z=0;Z<d.length;Z++){d[Z]=(d[Z]==-1?0:d[Z])}for(var Z=0;Z<L.length;Z++){L[Z]=(L[Z]==-1?0:L[Z])}O.ListTabOrder=d;O.FormTabOrder=L}var P=0;for(var a=0;a<O.UPages();a++){var s=0;if((O.bPages(a).Flags&Glb.OBJ_VISIBLE)==0){continue}for(U=0;U<O.UFields();U++){var V=O.Fields[U];if(((V.Flags&Glb.FLD_INLIST)!=0)&&((V.Flags&Glb.FLD_LISTLIST)!=0)&&V.Page==a){var R=true;if(V.Group!=-1){if((O.bGroups(V.Group).Flags&Glb.OBJ_VISIBLE)==0){R=false}}if(R&&(V.Flags&Glb.OBJ_VISIBLE)==0){R=false}if(R){s=s+V.ListWidth}}}if(s>P){P=s}}v=v+P;O.ListWidth=v;O.RD3Change(RD3Glb.PAN_LISTWIDTH)}catch(Y){}};RTCData.prototype.ConfigureSubForm=function(c,b,g){try{if(!iGuid.equals(b.Parent.RTCGuid)){this.Parent.SelectForm(b.Parent.RTCGuid);this.Parent.ConfigureSubForm(c,b);return}var a=this.RSSubForms;if(this.Parent.SearchObject(a,b.iGuid)){if(a.Get("RTC_Visible").Type!=IDVariant.NULL){b.set_Visible(a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Collapsed").Type!=IDVariant.NULL){b.set_Collapsed(a.Get("RTC_Collapsed").stringValue().equals("Y"))}}}catch(d){}};RTCData.prototype.ConfigureForm=function(b,d){try{var a=this.RSForm;if(this.Parent.SearchObject(a,b.RTCGuid)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){b.set_Caption(a.Get("RTC_Name"))}if(a.Get("RTC_Icon").stringValue().length>0){b.set_Image(a.Get("RTC_Icon").stringValue().trim())}if(a.Get("RTC_HelpFile").Type!=IDVariant.NULL){b.HelpFile=a.Get("RTC_HelpFile").stringValue()}if(a.Get("RTC_Docking").Type!=IDVariant.NULL){b.DockType=(a.Get("RTC_Docking").intValue()!=1?a.Get("RTC_Docking").intValue():0)}if(a.Get("RTC_Dim1").Type!=IDVariant.NULL){b.DesignWidth=a.Get("RTC_Dim1").intValue()}if(a.Get("RTC_Dim2").Type!=IDVariant.NULL){b.DesignHeight=a.Get("RTC_Dim2").intValue()}if(a.Get("RTC_ResMode1").Type!=IDVariant.NULL){b.ResModeW=a.Get("RTC_ResMode1").intValue()}if(a.Get("RTC_ResMode2").Type!=IDVariant.NULL){b.ResModeH=a.Get("RTC_ResMode2").intValue()}if(a.Get("RTC_Border").Type!=IDVariant.NULL&&a.Get("RTC_Border").intValue()!=1){b.iBorderType=a.Get("RTC_Border").intValue()-1}if(a.Get("RTC_ToolPos").Type!=IDVariant.NULL&&a.Get("RTC_ToolPos").intValue()!=1){b.ToolbarPosition=a.Get("RTC_ToolPos").intValue()-2}if(a.Get("RTC_HasCaption").Type!=IDVariant.NULL){if(a.Get("RTC_HasCaption").stringValue().equals("N")){b.iVisualFlags&=~1}else{b.iVisualFlags|=1}}if(a.Get("RTC_Resizable").Type!=IDVariant.NULL){if(a.Get("RTC_Resizable").stringValue().equals("N")){b.iVisualFlags&=~2}else{b.iVisualFlags|=2}}if(a.Get("RTC_Moveable").Type!=IDVariant.NULL){if(a.Get("RTC_Moveable").stringValue().equals("N")){b.iVisualFlags&=~4}else{b.iVisualFlags|=4}}if(a.Get("RTC_MinBtn").Type!=IDVariant.NULL){if(a.Get("RTC_MinBtn").stringValue().equals("N")){b.iVisualFlags&=~8}else{b.iVisualFlags|=8}}if(a.Get("RTC_MaxBtn").Type!=IDVariant.NULL){if(a.Get("RTC_MaxBtn").stringValue().equals("N")){b.iVisualFlags&=~16}else{b.iVisualFlags|=16}}if(a.Get("RTC_CloseBtn").Type!=IDVariant.NULL){if(a.Get("RTC_CloseBtn").stringValue().equals("N")){b.iVisualFlags&=~32}else{b.iVisualFlags|=32}}if(a.Get("RTC_ConfBtn").Type!=IDVariant.NULL){if(a.Get("RTC_ConfBtn").stringValue().equals("N")){b.iVisualFlags&=~64}else{b.iVisualFlags|=64}}if(a.Get("RTC_HelpBtn").Type!=IDVariant.NULL){if(a.Get("RTC_HelpBtn").stringValue().equals("N")){b.iVisualFlags&=~128}else{b.iVisualFlags|=128}}if(a.Get("RTC_DebugBtn").Type!=IDVariant.NULL){if(a.Get("RTC_DebugBtn").stringValue().equals("N")){b.iVisualFlags&=~256}else{b.iVisualFlags|=256}}if(a.Get("RTC_HasIcon").Type!=IDVariant.NULL){if(a.Get("RTC_HasIcon").stringValue().equals("N")){b.iVisualFlags&=~512}else{b.iVisualFlags|=512}}if(a.Get("RTC_ShowMessages").Type!=IDVariant.NULL){if(a.Get("RTC_ShowMessages").stringValue().equals("N")){b.iVisualFlags&=~1024}else{b.iVisualFlags|=1024}}}}catch(c){}};RTCData.prototype.ReloadFields=function(a){this.RSPanelFields=this.Parent.LoadRS("PanelFields",a)};function RTCEngine(a){this.DB;this.DBClass;this.AppGuid;this.PrjGuid;this.Enabled=false;this.MainFrm=a;this.DataCache=new ArrayList();this.AttData;this.ConstCache=new ArrayList();this.ValueListCache=new HashTableSrv();this.AlreadyInit=false;this.ConstLoaded=false;this.RTCHash=new IDVariant();this.RTCTimestamp=new IDVariant()}RTCEngine.MAX_QUEUE=100;RTCEngine.prototype.SelectForm=function(c){if(!this.Enabled){return}this.AttData=null;var a=-1;for(var b=0;b<this.DataCache.Count();b++){var e=this.DataCache[b];a++;if(c.equals(e.iGuid)){this.AttData=e;break}}if(this.AttData==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,125,"RTCEngine.SelectForm","RTC: Loading form RTC data");this.AttData=new RTCData(this,c);this.MainFrm.OpenConnection(this.DB);this.AttData.Load(this.GetWhereClause(c));this.DataCache.Add(this.AttData);if(this.DataCache.Count()>RTCEngine.MAX_QUEUE){this.DataCache.RemoveAt(0)}}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,125,"RTCEngine.SelectForm","RTC: Loading form RTC data from cache");this.DataCache.RemoveAt(a);this.DataCache.Add(this.AttData);this.AttData.Reset()}};RTCEngine.prototype.PanelValueList=function(f,j,b){if(!this.Enabled){return false}try{var h=this.GetValueList(b);if(h==null){return false}for(var a=0;a<h.Count();a++){var g=h[a];f.SetValueListItem(j,g.Value,g.Name,g.Description,g.Image,g.VisIdx)}return true}catch(d){return false}};RTCEngine.prototype.BookValueList=function(a,j,f){if(!this.Enabled){return false}try{var k=this.GetValueList(f);if(k==null){return false}for(var d=0;d<k.Count();d++){var h=k[d];a.SetSpanValueListItem(j,h.Name,h.Description,h.Value,null,h.Image,h.VisIdx)}return true}catch(g){return false}};RTCEngine.prototype.ConfigureBook=function(c,a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.BookObj.GetRTCGuid(0),126,"RTCEngine.ConfigureBook","RTC: Configuring book "+c.Caption()+"."+a.BookObj.GetName());this.AttData.ConfigureBook(c,a,this.MainFrm)};RTCEngine.prototype.ConfigureButtonBar=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,127,"RTCEngine.ConfigureButtonBar","RTC: Configuring button bar "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureButtonBar(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureTree=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,128,"RTCEngine.ConfigureTree","RTC: Configuring tree "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureTree(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureGraph=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,129,"RTCEngine.ConfigureGraph","RTC: Configuring graph "+a.Caption()+"."+(b.FrIndex!=-1?a.Frames[b.FrIndex].Caption:b.GraphCode));this.AttData.ConfigureGraph(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureTabbed=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.iGuid,130,"RTCEngine.ConfigureTabbed","RTC: Configuring tabbed "+a.Caption()+"."+a.Frames[b.FrIndex].Caption);this.AttData.ConfigureTabbed(a,b,this.MainFrm)};RTCEngine.prototype.ConfigurePanel=function(a,b){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.GetRTCGuid(Glb.OBJ_PANEL,0),131,"RTCEngine.ConfigurePanel","RTC: Configuring panel "+a.Caption()+"."+b.GetDTTCaption());this.AttData.ConfigurePanel(a,b,this.MainFrm)};RTCEngine.prototype.ConfigureSubForm=function(b,a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.iGuid,131,"RTCEngine.ConfigureSubForm","RTC: Configuring SubForm "+a.Code);this.AttData.ConfigureSubForm(b,a,this.MainFrm)};RTCEngine.prototype.ConfigureForm=function(a){if(!this.Enabled){return}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.RTCGuid,132,"RTCEngine.ConfigureForm","RTC: Configuring form "+a.Caption());this.AttData.ConfigureForm(a,this.MainFrm)};RTCEngine.prototype.GetConst=function(e,j,f){if(f==undefined){f=false}var a="IDVariant";if(!(j instanceof IDVariant)){a=typeof(j);j=new IDVariant(j)}var c=j;if(!this.Enabled&&!this.ConstLoaded){c=j}for(var b=0;b<this.ConstCache.Count();b++){var h=this.ConstCache[b];if(e.equals(h.iGuid)){c=h.Value;break}}if(f){c=new IDVariant(Glb.HTMLEncode(j.stringValue(),true))}switch(a){case"string":c=c.stringValue();break;case"number":c=c.intValue();break;case"boolean":c=c.booleanValue();break}return c};RTCEngine.prototype.GetConstName=function(b,e){if(!this.Enabled&&!this.ConstLoaded){return e}for(var a=0;a<this.ConstCache.Count();a++){var c=this.ConstCache[a];if(b.equals(c.iGuid)){return new IDVariant(c.Name)}}return e};RTCEngine.prototype.ConfigureMain=function(a){if(a==undefined){a=""}if(this.AlreadyInit||this.DBClass==0){return}if(a.length>0){this.AppGuid=a}if(this.Enabled){this.MainFrm.OpenConnection(this.DB);this.ConfigureApplication();this.ConfigureVStyles();this.ConfigureCmdSets("");this.ConfigureCommands("");this.ConfigureIndicators("");this.ConfigureTimers("");this.ConfigureConstants(this.AppGuid);this.ConfigureErrorMessages(this.AppGuid);this.ConfigureParameters(this.AppGuid)}this.AlreadyInit=true};RTCEngine.prototype.ConfigureApplication=function(){var c=this.MainFrm;c.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,133,"RTCEngine.ConfigureApplication","RTC: Configuring application");try{var a=this.LoadRS("Applications",this.GetWhereClause(this.AppGuid));if(this.SearchObject(a,this.AppGuid)){if(a.Get("RTC_HelpFile").Type!=IDVariant.NULL){c.HelpFile=a.Get("RTC_HelpFile").stringValue()}if(a.Get("RTC_MenuType").Type!=IDVariant.NULL){c.MenuType=a.Get("RTC_MenuType").intValue()}}}catch(b){c.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.AppGuid,134,"RTCEngine.ConfigureApplication","RTC: Error while configuring application (Error = "+b.message+")")}};RTCEngine.prototype.ConfigureVStyles=function(){var h=this.MainFrm;h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,135,"RTCEngine.ConfigureVStyles","RTC: Configuring application visual styles");try{var b=this.LoadRS("VStyles",this.GetWhereClause(""));for(var c=1;c<h.VisualStyleList.iVisAttrObj.length;c++){var l=h.VisualStyleList.iVisAttrObj[c];if(this.SearchObject(b,l.iGuid,l.Index+"")){if(b.Get("RTC_Control").stringValue().length>0){l.set_ControlType(b.Get("RTC_Control").intValue())}if(b.Get("RTC_Offset1").stringValue().length>0){l.set_RowOffset(b.Get("RTC_Offset1").intValue())}if(b.Get("RTC_Offset2").stringValue().length>0){l.set_HeaderOffset(b.Get("RTC_Offset2").intValue())}if(b.Get("RTC_Cursor").stringValue().length>0){var k=null;switch(b.Get("RTC_Cursor").intValue()){case 1:break;case 2:k="default";break;case 3:k="pointer";break;case 4:k="progress";break;case 5:k="wait";break;case 6:k="help";break;case 7:k="crosshair";break;case 8:k="move";break;case 9:k="e-resize";break;case 10:k="n-resize";break;case 11:k="ne-resize";break;case 12:k="sw-resize";break;case 13:k="text";break}l.set_Cursor(k)}if(b.Get("RTC_Mask").stringValue().length>0){l.set_Mask(b.Get("RTC_Mask").stringValue())}if(b.Get("RTC_FontCar1").stringValue().length>0){l.set_LetterSpacing(b.Get("RTC_FontCar1").intValue())}if(b.Get("RTC_FontCar2").stringValue().length>0){l.set_WordSpacing(b.Get("RTC_FontCar2").intValue())}if(b.Get("RTC_FontCar3").stringValue().length>0){l.set_HorizontalScale(b.Get("RTC_FontCar3").intValue())}var f=l.iFlags;if(b.Get("RTC_Password").stringValue().length>0){f=f&(~Glb.FL_VIS_PASSWORD)|(b.Get("RTC_Password").stringValue().equals("Y")?Glb.FL_VIS_PASSWORD:0)}if(b.Get("RTC_ShowDescr").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWDESCR)|(b.Get("RTC_ShowDescr").stringValue().equals("Y")?Glb.FL_VIS_SHOWDESCR:0)}if(b.Get("RTC_ShowImage").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWIMAGE)|(b.Get("RTC_ShowImage").stringValue().equals("Y")?Glb.FL_VIS_SHOWIMAGE:0)}if(b.Get("RTC_ShowValue").stringValue().length>0){f=f&(~Glb.FL_VIS_SHOWVALUE)|(b.Get("RTC_ShowValue").stringValue().equals("Y")?Glb.FL_VIS_SHOWVALUE:0)}if(b.Get("RTC_HyperLink").stringValue().length>0){f=f&(~Glb.FL_VIS_HYPERLINK)|(b.Get("RTC_HyperLink").stringValue().equals("Y")?Glb.FL_VIS_HYPERLINK:0)}l.iFlags=f;for(var a=1;a<=VisAttrObjSrv.MAX_ALIGNMENTS;a++){if(b.Get("RTC_Align"+a).stringValue().length>0){l.set_Alignment(a,b.Get("RTC_Align"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_BORDERS;a++){if(b.Get("RTC_Border"+a).stringValue().length>0){l.set_BorderType(a,b.Get("RTC_Border"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_FONTS;a++){if(b.Get("RTC_Font"+a).stringValue().length>0){l.set_Font(a,b.Get("RTC_Font"+a).stringValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){if(b.Get("RTC_Color"+a).stringValue().length>0){l.set_Color(a,b.Get("RTC_Color"+a).intValue())}if(b.Get("RTC_GradCol"+a).stringValue().length>0){l.set_GradCol(a,b.Get("RTC_GradCol"+a).intValue())}if(b.Get("RTC_GradDir"+a).stringValue().length>0){l.set_GradDir(a,b.Get("RTC_GradDir"+a).intValue())}if(b.Get("RTC_Opacity"+a).stringValue().length>0){l.set_Opacity(a,b.Get("RTC_Opacity"+a).intValue())}}for(var a=1;a<=VisAttrObjSrv.MAX_CUSTBORDERS;a++){if(b.Get("RTC_CBorCol"+a).stringValue().length>0){l.set_CBorColor(a,b.Get("RTC_CBorCol"+a).intValue())}if(b.Get("RTC_CBorWidth"+a).stringValue().length>0){l.set_CBorWidth(a,b.Get("RTC_CBorWidth"+a).intValue())}if(b.Get("RTC_CBorTyp"+a).stringValue().length>0){l.set_CBorType(a,b.Get("RTC_CBorTyp"+a).intValue())}if(b.Get("RTC_CBorPad"+a).stringValue().length>0){l.set_CBorPadding(a,b.Get("RTC_CBorPad"+a).intValue())}}}}}catch(g){h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.AppGuid,136,"RTCEngine.ConfigureVStyles","RTC: Error while configuring visual styles (Error = "+g.message+")")}};RTCEngine.prototype.ConfigureCmdSets=function(c){var h=this.MainFrm;h.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,133,"RTCEngine.ConfigureCmdSets","RTC: Configuring application command sets");try{var a=this.LoadRS("CmdSets",this.GetWhereClause(c));var j=this.LoadRS("ButtonBars",this.GetWhereClause(""));for(var b=1;b<h.CmdObj.CmdSets.length;b++){if(h.CmdObj.CmdSets[b]==null){continue}if(this.SearchObject(a,h.CmdObj.CmdSets[b].iGuid,null,false)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Toolnames").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].ShowNames=a.Get("RTC_Toolnames").stringValue().equals("Y")}if(a.Get("RTC_Expanded").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].Expanded=a.Get("RTC_Expanded").stringValue().equals("Y")}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].set_bImage(a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].Accell=(h.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].CanDrag=a.Get("RTC_CanDrag").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){h.CmdObj.CmdSets[b].CanDrop=a.Get("RTC_CanDrop").stringValue().equals("Y")}}else{var f=false;j.MoveFirst();while(!j.EOF()){if(j.Get("RTC_Guid").stringValue().equals(h.CmdObj.CmdSets[b].iGuid)){f=true;break}j.MoveNext()}}}for(var b=1;b<h.CmdObj.CmdLin.length;b++){if(h.CmdObj.CmdLin[b]==null){continue}if(h.CmdObj.CmdLin[b].IsCmdSet()){if(this.SearchObject(a,h.CmdObj.CmdLin[b].iGuid,h.CmdObj.CmdLin[b].Caption)){if(a.Get("RTC_Name").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Toolnames").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].ShowNames=a.Get("RTC_Toolnames").stringValue().equals("Y")}if(a.Get("RTC_Expanded").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].Expanded=a.Get("RTC_Expanded").stringValue().equals("Y")}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].set_bImage(a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].Accell=(h.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_CanDrag").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].CanDrag=a.Get("RTC_CanDrag").stringValue().equals("Y")}if(a.Get("RTC_CanDrop").Type!=IDVariant.NULL){h.CmdObj.CmdLin[b].CanDrop=a.Get("RTC_CanDrop").stringValue().equals("Y")}}}}}catch(d){h.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,c,134,"RTCEngine.ConfigureCmdSets","RTC: Error while configuring command sets (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureCommands=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,135,"RTCEngine.ConfigureCommands","RTC: Configuring application commands");try{var a=this.LoadRS("Commands",this.GetWhereClause(c));for(var b=1;b<f.CmdObj.CmdLin.length;b++){if(f.CmdObj.CmdLin[b]==null){continue}if(!f.CmdObj.CmdLin[b].IsCmdSet()){if(this.SearchObject(a,f.CmdObj.CmdLin[b].iGuid,f.CmdObj.CmdLin[b].Caption)){if(f.CmdObj.CmdLin[b].Caption.length==0){if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}}else{if(a.Get("RTC_Name").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bCaption(a.Get("RTC_Name").stringValue())}if(a.Get("RTC_Description").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bToolTip(a.Get("RTC_Description").stringValue())}if(a.Get("RTC_Icon").stringValue().length>0){f.CmdObj.CmdLin[b].set_bImage(a.Get("RTC_Icon").stringValue().trim())}if(a.Get("RTC_ToolName").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bToolName(a.Get("RTC_ToolName").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_ReqConf").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].RequireConfirmation=a.Get("RTC_ReqConf").stringValue().equals("Y")}if(a.Get("RTC_Toolbar").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].IsToolbar=a.Get("RTC_Toolbar").stringValue().equals("Y")}if(a.Get("RTC_Menubar").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].IsMenu=a.Get("RTC_Menubar").stringValue().equals("Y")}if(a.Get("RTC_Checked").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].set_bChecked(0,a.Get("RTC_Checked").stringValue().equals("Y"))}if(a.Get("RTC_Hilight").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].UseHilight=a.Get("RTC_Hilight").stringValue().equals("Y")}if(a.Get("RTC_Accel").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].Accell=(f.MenuType==Glb.MENUTYPE_MENUBAR?a.Get("RTC_Accel").stringValue():null)}if(a.Get("RTC_FKey").Type!=IDVariant.NULL&&a.Get("RTC_FKShift").Type!=IDVariant.NULL&&a.Get("RTC_FKCtrl").Type!=IDVariant.NULL){var h=(a.Get("RTC_FKShift").stringValue().equals("Y")?1:0)+(a.Get("RTC_FKCtrl").stringValue().equals("Y")?2:0);f.CmdObj.CmdLin[b].FKNum=a.Get("RTC_FKey").intValue()+h*Glb.FKMaxNum}if(a.Get("RTC_CmdCode").Type!=IDVariant.NULL){f.CmdObj.CmdLin[b].CmdCode=a.Get("RTC_CmdCode").stringValue()}}}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,136,"RTCEngine.ConfigureCommands","RTC: Error while configuring commands (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureIndicators=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,137,"RTCEngine.ConfigureIndicators","RTC: Configuring application indicators");try{var a=this.LoadRS("Indicators",this.GetWhereClause(c));for(var b=1;b<f.IndObj.Indicators.length;b++){if(f.IndObj.Indicators[b]==null){continue}if(this.SearchObject(a,f.IndObj.Indicators[b].iGuid,f.IndObj.Indicators[b].Code)){if(a.Get("RTC_Description").Type!=IDVariant.NULL){f.IndObj.Indicators[b].ToolTip=a.Get("RTC_Description").stringValue()}if(a.Get("RTC_Icon").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bImage(0,a.Get("RTC_Icon").stringValue())}if(a.Get("RTC_Visible").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bVisible(0,a.Get("RTC_Visible").stringValue().equals("Y"))}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.IndObj.Indicators[b].set_bEnabled(0,a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Style").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Style=a.Get("RTC_Style").intValue()}if(a.Get("RTC_Width").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Width=a.Get("RTC_Width").intValue()}if(a.Get("RTC_Alignment").Type!=IDVariant.NULL){f.IndObj.Indicators[b].Alignment=a.Get("RTC_Alignment").intValue()}if(a.Get("RTC_WType").intValue()==1){f.IndObj.Indicators[b].Width=1}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,138,"RTCEngine.ConfigureIndicators","RTC: Error while configuring indicators (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureTimers=function(c){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,139,"RTCEngine.ConfigureTimers","RTC: Configuring application timers");try{var a=this.LoadRS("Timers",this.GetWhereClause(c));for(var b=1;b<f.TimerObj.Timers.length;b++){if(f.TimerObj.Timers[b]==null){continue}if(this.SearchObject(a,f.TimerObj.Timers[b].iGuid,f.TimerObj.Timers[b].Code)){if(a.Get("RTC_UM").Type!=IDVariant.NULL){switch(a.Get("RTC_UM").intValue()){case 1:f.TimerObj.Timers[b].MilliSec=a.Get("RTC_Interval").intValue();f.TimerObj.Timers[b].Interval=0;break;case 2:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue();f.TimerObj.Timers[b].MilliSec=0;break;case 3:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*60;f.TimerObj.Timers[b].MilliSec=0;break;case 4:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*3600;f.TimerObj.Timers[b].MilliSec=0;break;case 5:f.TimerObj.Timers[b].Interval=a.Get("RTC_Interval").intValue()*86400;f.TimerObj.Timers[b].MilliSec=0;break}}if(a.Get("RTC_Ticks").Type!=IDVariant.NULL){f.TimerObj.Timers[b].NumTicks=a.Get("RTC_Ticks").intValue()}if(a.Get("RTC_Enabled").Type!=IDVariant.NULL){f.TimerObj.Timers[b].set_bEnabled(a.Get("RTC_Enabled").stringValue().equals("Y"))}if(a.Get("RTC_Permanent").Type!=IDVariant.NULL){f.TimerObj.Timers[b].set_bPermanent(a.Get("RTC_Permanent").stringValue().equals("Y"))}}}}catch(d){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,c,140,"RTCEngine.ConfigureTimers","RTC: Error while configuring timers (Error = "+d.message+")")}};RTCEngine.prototype.ConfigureConstants=function(b){var f=this.MainFrm;f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,141,"RTCEngine.ConfigureConstants","RTC: Configuring application constants");this.ConstCache.Clear();var j=this.LoadRS("Constants",this.GetWhereClause(b));try{while(!j.EOF()){var k;var d=new PVLItemSrv();if(j.Get("RTC_IsNull").Type!=IDVariant.NULL&&j.Get("RTC_IsNull").stringValue().equals("Y")){k=new IDVariant()}else{if(j.Get("RTC_Value").Type!=IDVariant.NULL){k=j.Get("RTC_Value");switch(j.Get("RTC_DataType").intValue()){case Glb.DT_NUM_CURRENCY:k.changeType(IDVariant.DECIMAL);break;case Glb.DT_NUM_FIXED:k.changeType(IDVariant.DECIMAL);break;case Glb.DT_NUM_FLOAT:k.changeType(IDVariant.FLOAT);break;case Glb.DT_NUM_INTEGER:k.changeType(IDVariant.INTEGER);break;case Glb.DT_DATE:case Glb.DT_DATETIME:case Glb.DT_TIME:k.changeType(IDVariant.DATETIME);break;case Glb.DT_BOOLEAN:k.changeType(IDVariant.INTEGER);break}}}if(k){d.Value=k}if(j.Get("RTC_Description").Type!=IDVariant.NULL){d.Description=j.Get("RTC_Description").stringValue()}if(j.Get("RTC_Icon").Type!=IDVariant.NULL){d.Image=j.Get("RTC_Icon").stringValue()}if(j.Get("RTC_Name").Type!=IDVariant.NULL){d.Name=j.Get("RTC_Name").stringValue()}d.OrigName=j.Get("RTC_Name2").stringValue();d.iGuid=j.Get("RTC_Guid").stringValue();d.Parent=j.Get("RTC_Parent").stringValue();if(j.Get("RTC_VStyle").stringValue().length>0){var l=f.VisualStyleList.GetVS(j.Get("RTC_VStyle").stringValue());if(l>0){d.VisIdx=l}}this.ConstCache.Add(d);if(j.Get("RTC_Parent").stringValue().length>0){if(!j.Get("RTC_Parent").stringValue().equals(a)){var a=j.Get("RTC_Parent").stringValue();var h=new ArrayList();this.ValueListCache[a]=h}h.Add(d)}j.MoveNext()}}catch(c){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,142,"RTCEngine.ConfigureConstants","RTC: Error while configuring constants (Error = "+c.message+")")}};RTCEngine.prototype.LoadRTCConst=function(){if(this.ConstCache.Count()>0||this.ConstLoaded){return}try{var d=new XMLHttpRequest();d.open("GET","?WCI=RD3&WCE=GZ&FN=rtcconst.ini",false);d.setRequestHeader("Content-Type","text/plain");d.send();var a=d.responseText.split("\n");for(var b=0;b<a.length;b++){var c=a[b];if(c.length>=36&&c[0]!="/"){var g=new PVLItemSrv();g.iGuid=c.substr(0,36);if(c.length>37){g.Value=new IDVariant(c.substr(37))}else{g.Value=new IDVariant()}this.ConstCache.Add(g);this.ConstLoaded=true}}}catch(f){}};RTCEngine.prototype.ConfigureParameters=function(b){if(!this.Enabled&&!this.ConstLoaded){return}for(var a=0;a<this.ConstCache.Count();a++){var d=this.ConstCache[a];if(d.Parent==b){if(d.OrigName.equals("InfoMessages")){this.MainFrm.ParamsObj().InfoMessages=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_ActImgWidth")){this.MainFrm.ParamsObj().ActImgWidth=d.Value.intValue()}else{if(d.OrigName.equals("_ICD_AutoDynRows")){this.MainFrm.ParamsObj().AutoDynRows=d.Value.intValue()}else{if(d.OrigName.equals("UseIDTag")){this.MainFrm.ParamsObj().UseIDTag=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_DefaultCurrencyMask")){this.MainFrm.ParamsObj().DefaultCurrencyMask=d.Value.stringValue()}else{if(d.OrigName.equals("_ICD_DefaultFloatMask")){this.MainFrm.ParamsObj().DefaultFloatMask=d.Value.stringValue()}else{if(d.OrigName.equals("_ICD_DefaultDateMask")){this.MainFrm.ParamsObj().DefaultDateMask=d.Value.stringValue()}else{if(d.OrigName.equals("_ICD_DefaultTimeMask")){this.MainFrm.ParamsObj().DefaultTimeMask=d.Value.stringValue()}else{if(d.OrigName.equals("UseRD")){this.MainFrm.ParamsObj().UseRD=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelNewInsertMode")){if(d.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_NEWINSMODE}}else{if(d.OrigName.equals("_ICD_HELPFEATURES")){this.MainFrm.ParamsObj().HelpFeatures=d.Value.stringValue()}else{if(d.OrigName.equals("UseDoubleClick")){this.MainFrm.ParamsObj().UseDoubleClick=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("UseFK")){this.MainFrm.ParamsObj().UseFK=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelsUseTab")){if(d.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_USETAB}}else{if(d.OrigName.equals("PanelsSortAlways")){if(d.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_SORTALWAYS}}else{if(d.OrigName.equals("PanelsLikeSearch")){this.MainFrm.ParamsObj().PanelsLikeSearch=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("EnablePanelMultiSelection")){this.MainFrm.ParamsObj().EnablePanelMultiSelection=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("ActivePanelMultiSelection")){this.MainFrm.ParamsObj().ActivePanelMultiSelection=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("ShowPanelMultiSelection")){this.MainFrm.ParamsObj().ShowPanelMultiSelection=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_MAINCAPTION")){}else{if(d.OrigName.equals("ShowDisabledFieldActivator")){this.MainFrm.ParamsObj().ShowDisabledFieldActivator=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("ConvertNullToValue")){IDVariant.ConvertNullToValue=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("HtmlConstraints")){this.MainFrm.ParamsObj().HtmlConstraints=d.Value.stringValue().equals("NONE")?Glb.WEBVALID_NONE:Glb.WEBVALID_STRICT}else{if(d.OrigName.equals("UseCollapsableFrames")){this.MainFrm.ParamsObj().UseCollapsableFrames=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_PanelCommandMask")){this.MainFrm.ParamsObj().PanelCommandMask=d.Value.intValue()}else{if(d.OrigName.equals("ShowRD")){this.MainFrm.ParamsObj().ShowRD=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("AutoSaveType")){this.MainFrm.ParamsObj().AutoSaveType=d.Value.stringValue()}else{if(d.OrigName.equals("_ICD_LOGOFF_URL")){this.MainFrm.set_LogoffURL(d.Value.stringValue())}else{if(d.OrigName.equals("_ICD_WELCOME_URL")){this.MainFrm.set_WelcomeUrl(d.Value.stringValue())}else{if(d.OrigName.equals("ShowFieldImageInValue")){this.MainFrm.ParamsObj().ShowFieldImageInValue=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_PanelEditInsertErrorMode")){this.MainFrm.ParamsObj().EditInsErrorMode=d.Value.intValue()}else{if(d.OrigName.equals("_ICD_PanelEditUpdateErrorMode")){this.MainFrm.ParamsObj().EditUpdErrorMode=d.Value.intValue()}else{if(d.OrigName.equals("_ICD_PanelFinalInsertErrorMode")){this.MainFrm.ParamsObj().FinalInsErrorMode=d.Value.intValue()}else{if(d.OrigName.equals("_ICD_PanelFinalUpdateErrorMode")){this.MainFrm.ParamsObj().FinalUpdErrorMode=d.Value.intValue()}else{if(d.OrigName.equals("UseDecimalDot")){this.MainFrm.ParamsObj().UseDecimalDot=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("UseFastRowSelector")){this.MainFrm.ParamsObj().UseFastRowSelector=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("TruePopup")){this.MainFrm.ParamsObj().TruePopup=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_UseSmallIcon")){this.MainFrm.ParamsObj().UseSmallIcon=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("UseClientMask")){this.MainFrm.ParamsObj().UseClientMask=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelQBEEmpty")){this.MainFrm.ParamsObj().PanelQBEEmpty=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelConfirmDelete")){this.MainFrm.ParamsObj().PanelConfirmDelete=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelFreezeWhenHidden")){if(d.Value.stringValue().equals("YES")){this.MainFrm.GlbPanelFlags=this.MainFrm.GlbPanelFlags|Glb.PAN_FREEWHENHID}}else{if(d.OrigName.equals("PanelIsLockable")){this.MainFrm.ParamsObj().PanelIsLockable=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("ChangeRowDelay")){this.MainFrm.ParamsObj().ChangeRowDelay=d.Value.intValue()}else{if(d.OrigName.equals("SmartLookupIcon")){this.MainFrm.ParamsObj().SmartLookupIcon=d.Value.stringValue()}else{if(d.OrigName.equals("ShowDisabledIcons")){this.MainFrm.ParamsObj().ShowDisabledIcons=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("RightAlignedIcons")){this.MainFrm.ParamsObj().RightAlignedIcons=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("AllowMasterPanelNav")){this.MainFrm.ParamsObj().AllowMasterPanelNav=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("NativeBlob")){this.MainFrm.ParamsObj().NativeBlob=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("ToolbarPosition")){if(d.Value.stringValue().equals("NONE")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_NONE}if(d.Value.stringValue().equals("LEFT")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_LEFT}if(d.Value.stringValue().equals("RIGHT")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_RIGHT}if(d.Value.stringValue().equals("DISTRIBUTED")){this.MainFrm.ParamsObj().ToolbarPosition=Glb.FORMTOOL_DISTRUB}}else{if(d.OrigName.equals("UseRD3")){if(this.MainFrm.SessionName.length==0){this.MainFrm.ParamsObj().UseRD3=d.Value.stringValue().equals("YES")}}else{if(d.OrigName.equals("BorderType")){this.MainFrm.ParamsObj().BorderType=this.MainFrm.ParamsObj().Theme.equals("seattle")?Glb.BORDER_THICK:Glb.BORDER_THIN;if(d.Value.stringValue().equals("NONE")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_NONE}if(d.Value.stringValue().equals("THICK")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_THICK}if(d.Value.stringValue().equals("THIN")){this.MainFrm.ParamsObj().BorderType=Glb.BORDER_THIN}}else{if(d.OrigName.equals("TooltipErrorMode")){this.MainFrm.ParamsObj().TooltipErrorMode=d.Value.intValue()}else{if(d.OrigName.equals("EnableGFX")){this.MainFrm.ParamsObj().EnableGFX=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("EnableSound")){this.MainFrm.ParamsObj().EnableSound=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("EnableRichTooltip")){this.MainFrm.ParamsObj().EnableRichTooltip=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("MultiSelectionComboBox")){this.MainFrm.ParamsObj().MultiSelectionComboBox=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("UseCollapsableGroups")){this.MainFrm.ParamsObj().UseCollapsableGroups=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelHighlightDelete")){this.MainFrm.ParamsObj().PanelHighlightDelete=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("SelectAllOnlyVisible")){this.MainFrm.ParamsObj().SelectAllOnlyVisible=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("TooltipOnEachRow")){this.MainFrm.ParamsObj().TooltipOnEachRow=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("EnableFrameResize")){this.MainFrm.ParamsObj().EnableFrameResize=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("QBETrueLessThan")){this.MainFrm.ParamsObj().QBETrueLessThan=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("PanelEnableInsertWhenLocked")){this.MainFrm.ParamsObj().PanelEnableInsertWhenLocked=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("LKEDOAllProperties")){this.MainFrm.ParamsObj().LKEDOAllProperties=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("LoadingPolicy")){if(d.Value.stringValue().equals("MANUAL")){this.MainFrm.ParamsObj().LoadingPolicy=0}if(d.Value.stringValue().equals("AUTO")){this.MainFrm.ParamsObj().LoadingPolicy=1}if(d.Value.stringValue().equals("CONTINUOUS")){this.MainFrm.ParamsObj().LoadingPolicy=2}}else{if(d.OrigName.equals("PullToRefresh")){this.MainFrm.ParamsObj().PullToRefresh=d.Value.stringValue().equals("YES")}else{if(d.OrigName.equals("_ICD_ACCENT_COLOR")){try{var f=parseInt(d.Value.stringValue(),16);if(!isNaN(f)){this.MainFrm.iAccentColor=((f&16711680)>>16)+(f&65280)+((f&255)<<16)}}catch(c){}}else{if(d.OrigName.equals("UseHTML5Upload")){this.MainFrm.ParamsObj().UseHTML5Upload=d.Value.stringValue().equals("YES")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}IDVariant.InitDefaultMasks(this.MainFrm.ParamsObj().DefaultDateMask,this.MainFrm.ParamsObj().DefaultTimeMask)};RTCEngine.prototype.ResetData=function(b){this.AttData=null;if(b.length>0){for(var a=0;a<this.DataCache.Count();a++){var c=this.DataCache[a];if(b.equals(c.iGuid)){this.DataCache.RemoveAt(a);break}}}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,143,"RTCEngine.ResetData","RTC: re-reading all RTC data");this.DataCache.Clear();this.AlreadyInit=false;this.ValueListCache.clear();this.MainFrm.QwlRoles.clear();this.ConfigureMain();this.ConfigureRoles();this.MainFrm.RTCReset()}};RTCEngine.prototype.LoadRS=function(p,o){var l=this.MainFrm;try{var q=new StringTokenizer();q.setString(new IDVariant(o),new IDVariant(","));var u=q.next();var d=q.next();var m=q.next();var s=q.next();var c=(u.stringValue().length!=0?u.stringValue():"NULL");var g=(d.stringValue().length!=0?d.stringValue():"NULL");var h=(m.stringValue().length!=0?m.stringValue():"NULL");var b=(s.stringValue().length!=0?s.stringValue():"NULL");var f="";f+="where (RTC_User = "+g+") ";f+="and   (RTC_Group = "+h+") ";f+="and   (RTC_Language = "+c+") ";if(p.equals("Constants")){f+="and (RTC_Form = "+b+" or "+b+" is NULL or RTC_Form is NULL) "}else{f+="and (RTC_Form = "+b+" or "+b+" is NULL) "}var j="select * from RTCU_"+p+" "+f;if(!p.equals("ErrorMessages")){j+=" order by RTC_Parent, RTC_Sequence"}var a=this.DB.OpenRS(j);if(!a.EOF()){a.MoveFirst()}return a}catch(k){l.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",122,"RTCEngine.LoadRS","RTC: Can't load data for "+p+" (Error = "+k.message+")");l.DTTObj.AddMsgToken("","SQL",new IDVariant(j));return new IDCachedRowSet()}};RTCEngine.prototype.SearchObject=function(b,d,a,h){try{var c=b.getRow();while(!b.EOF()){if(b.Get("RTC_Guid").stringValue().equals(d)){return true}b.MoveNext()}b.MoveFirst();while(b.getRow()<c){if(b.Get("RTC_Guid").stringValue().equals(d)){return true}b.MoveNext()}if(h){if(d!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,d,123,"RTCEngine.SearchObject","RTC: Object "+d+" not found")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,d,123,"RTCEngine.SearchObject","RTC: Object "+a+" not found")}}}catch(f){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,d,124,"RTCEngine.SearchObject","RTC: Error while searching object "+(d!=null?d:a)+" (Error = "+f.message+")");WriteToConsoleError(f)}if(h){WriteToConsoleOutput("NOT FOUND "+d)}return false};RTCEngine.prototype.GetWhereClause=function(b){var a=" ";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbLanguage),IDL.FMT_CHAR,this.DB)+",";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbUserID),IDL.FMT_NUM,this.DB)+",";a+=IDL.CSql(new IDVariant(this.MainFrm.RolObj.glbGroup),IDL.FMT_NUM,this.DB)+",";if(b.length==0){a+="NULL"}else{a+=IDL.CSql(new IDVariant(b),IDL.FMT_CHAR,this.DB)}return a};RTCEngine.prototype.GetValueList=function(a){return this.ValueListCache[a]};RTCEngine.prototype.ConfigureErrorMessages=function(b){var d=this.MainFrm;d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,144,"RTCEngine.ConfigureErrorMessages","RTC: Configuring application error messages");try{var a=this.LoadRS("ErrorMessages",this.GetWhereClause(b));if(!a.EOF()){d.ErrObj.ConfigureErrorMessages(a)}}catch(c){d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b,145,"RTCEngine.ConfigureErrorMessages","RTC: Error while configuring error messages (Error = "+c.message+")")}};RTCEngine.prototype.ConfigureRoles=function(){if(!this.AlreadyInit){return}if(this.Enabled){var d=this.MainFrm;d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",146,"RTCEngine.ConfigureRoles","RTC: Configuring application roles");try{var a=this.LoadRS("Roles",this.GetWhereClause(this.AppGuid));if(!a.EOF()){var b=this.LoadRS("RoleItems",this.GetWhereClause(this.AppGuid));d.RolObj.ConfigureRoles(a,b)}}catch(c){d.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",147,"RTCEngine.ConfigureRoles","RTC: Error while configuring roles (Error = "+c.message+")")}}};RTCEngine.prototype.GetHash=function(b){if(this.RTCHash.Type==IDVariant.NULL||b){this.MainFrm.OpenConnection(this.DB);try{var c="select RTC_Hash from RTC_Parameters";c+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";c+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";c+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";var a=this.DB.OpenRSR(c);if(!a.EOF()){this.RTCHash=a.Get(1,IDVariant.STRING)}a.Close()}catch(d){}}return this.RTCHash};RTCEngine.prototype.GetTimestamp=function(b){if(this.RTCTimestamp.Type==IDVariant.NULL||b){this.MainFrm.OpenConnection(this.DB);try{var c="select RTC_Timestamp from RTC_Parameters";c+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";c+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";c+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";var a=this.DB.OpenRSR(c);if(!a.EOF()){this.RTCTimestamp=a.Get(1,IDVariant.DATETIME)}a.Close()}catch(d){}}return this.RTCTimestamp};RTCEngine.prototype.Sync=function(){var c=this.MainFrm.SyncObject;if(c.CheckSyncServer()){var g="";g+='<rtc username="'+Glb.HTMLEncode(c.ClientUsername)+'"';g+=' password="'+Glb.HTMLEncode(c.ClientPassword)+'"';g+=' lang="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbLanguage)+'"';g+=' uid="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbUserID)+'"';g+=' gid="'+Glb.HTMLEncode(this.MainFrm.RolObj.glbGroup)+'"';g+=' app="'+Glb.HTMLEncode(this.AppGuid)+'"';if(this.GetHash().stringValue()){g+=' hash="'+Glb.HTMLEncode(this.GetHash().stringValue())+'"'}g+="></rtc>";var b=XMLDoc.FT_JSON;var d=new IDMap();d.set_Value(new IDVariant("SYNCDATA"),new IDVariant(g));d.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));d.set_Value(new IDVariant("FTR"),new IDVariant(b));d.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));var a=IDL.HttpRequest(this.MainFrm,new IDVariant(c.ServerURL),d);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"RTCEngine.Sync","Received "+a.stringValue().length+" bytes from server");if(a.stringValue().length<50000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",a.stringValue())}if(b!=XMLDoc.FT_XML&&a.stringValue().startsWith("<")){b=XMLDoc.FT_XML}var e=new XMLDoc();if(!e.LoadFromString(a.stringValue(),b)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"RTCEngine.Sync","Parse XML failed")}var f=e.GetNextNode();if(f!=null&&f.Name()=="xml"){f=e.GetNextNode()}if(f!=null&&f.Name()=="rtc"&&f.HasNextNode()){if(!c.CheckResponse(f,"RTCEngine.Sync")){return}this.MainFrm.OpenConnection(this.DB);this.DB.BeginTrans();RTCEngine.prototype.SyncTR=function(){while(f.HasNextNode()){var j=f.GetNextNode();var t=j.Name();var q=new IDCachedRowSet();if(b==XMLDoc.FT_XML){q.LoadFromXML(Glb.HTMLDecode(j.GetAttribute("rs"),true),true)}else{q.LoadFromXMLNode(j)}this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","RTC Table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,"select * from "+t);this.MainFrm.DTTObj.AddDBDataSource(q,"select * from "+t);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync");var v=null;try{v=this.DB.OpenRS("select * from "+t)}catch(m){}if(v&&v.RecordCount()==0){var s="drop table "+t;this.DB.Execute(s);v=null}var l;if(v){for(var p=1;p<=q.getMetaData().getColumnCount();p++){var r=q.getMetaData().getColumnName(p);if(v.findColumn(r)==-1){var u=q.getMetaData().getColumnType(p);var h;if(u==IDVariant.INTEGER){h="integer"}else{if(r.toUpperCase().indexOf("GUID")!=-1){h="varchar(36)"}else{h="varchar(2000)"}}l="alter table "+t+" add column "+r+" "+h;this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","Updating table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,l);this.DB.Execute(l);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync")}}}else{l="create table "+t+"(";l+=" RTC_Guid variant(36) not null,";l+=" RTC_Parent variant(36),";l+=" RTC_Language variant(4) not null,";l+=" RTC_Group integer not null,";l+=" RTC_User integer not null,";l+=" RTC_Sequence integer,";l+=" RTC_Form variant(36)";var x=l.toLowerCase();for(var p=1;p<=q.getMetaData().getColumnCount();p++){var r=q.getMetaData().getColumnName(p);var u=q.getMetaData().getColumnType(p);if(x.indexOf(r.toLowerCase()+" ")!=-1){continue}var h;if(u==IDVariant.INTEGER){h="integer"}else{if(r.toUpperCase().indexOf("GUID")!=-1){h="varchar(36)"}else{h="varchar(2000)"}}l+=", "+r+" "+h}l+=")";this.MainFrm.DTTObj.AddQuery("RTCEngine.Sync","Creating table "+t,"SyncService.Query",DTTEngine.STMT_QRY_SELECT,l);this.DB.Execute(l);this.MainFrm.DTTObj.EndQuery("RTCEngine.Sync")}l="delete from "+t;l+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";l+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";l+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l);q.MoveFirst();var k="insert into "+t+"(";for(var p=1;p<=q.getMetaData().getColumnCount();p++){var r=q.getMetaData().getColumnName(p);k+=r;if(p!=q.getMetaData().getColumnCount()){k+=","}else{k+=")"}}k+=" values(";while(!q.EOF()){l=k;for(var p=1;p<=q.getMetaData().getColumnCount();p++){var r=q.getMetaData().getColumnName(p);var o=q.Get(r);if(o.Type==IDVariant.STRING){o=IDL.Quote(o)}else{if(o.Type==IDVariant.NULL){o="null"}}l+=(p==1?"":",")+o}l+=")";this.DB.Execute(l);q.MoveNext()}}var w=f.GetAttribute("hash");try{this.DB.OpenRS("select * from RTC_Parameters")}catch(m){l="create table RTC_Parameters(";l+=" RTC_Hash variant(36) not null,";l+=" RTC_Language variant(4) not null,";l+=" RTC_Group integer not null,";l+=" RTC_User integer not null,";l+=" RTC_Timestamp datetime not null)";this.DB.Execute(l)}l="update RTC_Parameters set ";l+=" RTC_Hash = '"+w+"',";l+=" RTC_Timestamp = datetime('now','localtime')";l+=" where (RTC_Language = '"+this.MainFrm.RolObj.glbLanguage+"')";l+=" and   (RTC_User = "+this.MainFrm.RolObj.glbUserID+")";l+=" and   (RTC_Group = "+this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l);if(this.DB.RecordsAffected()==0){l="insert into RTC_Parameters(RTC_Hash, RTC_Timestamp, RTC_Language, RTC_User, RTC_Group) values (";l+=" '"+w+"',";l+=" datetime('now','localtime'),";l+=" '"+this.MainFrm.RolObj.glbLanguage+"',";l+=this.MainFrm.RolObj.glbUserID+",";l+=this.MainFrm.RolObj.glbGroup+")";this.DB.Execute(l)}this.DB.CommitTrans();this.RTCHash=new IDVariant(w);this.GetTimestamp=IDL.Now()};this.DB.ExecuteTrans(RTCEngine.prototype.SyncTR,this)}}};function ServerSessionManager(c){this.DBName="SSManager";if(c){var a=TryOpenDatabase(this.DBName,"",this.DBName,5*1024*1024);try{a.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS Sessions")});var b="CREATE TABLE Sessions\n";b+="(\n";b+="  SessionName     varchar(52) not null primary key,\n";b+="  QueryString     varchar(250),\n";b+="  FromSessionName varchar(52),\n";b+="  Result          varchar(9999999),\n";b+="  Phase           varchar(250),\n";b+="  Progress        double default -1,\n";b+="  Aborted         integer default 0\n";b+=")";a.transaction(function(e){e.executeSql(b)});b="INSERT INTO Sessions (SessionName) VALUES ('')";a.transaction(function(e){e.executeSql(b)})}catch(d){WriteToConsoleError("Error while creating the database of sessions")}finally{if(a&&a.close){a.close()}}}}ServerSessionManager.prototype.StartSession=function(a,d,b){if(b==undefined){b=""}if(this.ExistsSession(d)){return false}var c="INSERT INTO Sessions (SessionName, QueryString) VALUES ("+IDL.Quote(d)+", "+IDL.Quote(b)+")";this.ExecuteQuery(c);myPostMessage({type:"SSM",message:"Start",name:d,qs:b});return true};ServerSessionManager.prototype.EndSession=function(b,a){if(a==undefined){a=false}if(this.ExistsSession(b)){myPostMessage({type:"SSM",message:"End",name:b,kill:a});return true}return false};ServerSessionManager.prototype.Terminate=function(){var c=this.ServerSessions.keys();for(var a=0;a<c.length;a++){var b=c[a];this.EndSession(b,true)}};ServerSessionManager.prototype.RemoveSession=function(b){try{var a="DELETE FROM Sessions WHERE SessionName = "+IDL.Quote(b);this.ExecuteQuery(a);myPostMessage({type:"SSM",message:"Remove",name:b})}catch(c){WriteToConsoleError("Error while removing session "+b)}};ServerSessionManager.prototype.ExistsSession=function(c){try{var b="SELECT QueryString FROM Sessions WHERE SessionName = "+IDL.Quote(c)+"";var a=this.ExecuteQuery(b);return(a.rows.length==1)}catch(d){WriteToConsoleError("Error while reading session '"+c+"'")}return false};ServerSessionManager.prototype.SendMessage=function(g,d,c,a){try{var f="UPDATE Sessions SET";f+=" FromSessionName = "+IDL.Quote(g)+",";f+=" Result = '1;0'";f+=" WHERE SessionName = "+IDL.Quote(d);f+=" AND FromSessionName IS NULL";var b=this.ExecuteQuery(f,true);if(b.rowsAffected!=1){return false}}catch(h){WriteToConsoleError("Error while sending message '"+c+"' to '"+d+"'")}myPostMessage({type:"SSM",message:"Message",name:d,from:g,msg:c,args:a.GetNative()});return true};ServerSessionManager.prototype.GetProgress=function(f,c){if(c==undefined){c=false}var b=-1;try{var d="SELECT Phase, Progress";d+=" FROM Sessions";d+=" WHERE SessionName = "+IDL.Quote(f);var a=this.ExecuteQuery(d);if(a.rows.length==1){b=(a.rows.item(0)["Progress"]+0)}}catch(g){WriteToConsoleError("Error while reading progress of '"+f+"'")}if(c){try{var d="UPDATE Sessions SET";d+=" Progress = -1,";d+=" Aborted = -1";d+=" WHERE SessionName = "+IDL.Quote(f);this.ExecuteQuery(d)}catch(g){WriteToConsoleError("Error while aborting progress of '"+f+"'")}}return b};ServerSessionManager.prototype.SetLowPriority=function(b,a){};ServerSessionManager.prototype.ExecuteQuery=function(d,c){var b=TryOpenDatabase(this.DBName,"",this.DBName,5*1024*1024);var a=null;try{b.transaction(function(e){a=e.executeSql(d)});if(c&&b.rowsAffected){a.rowsAffected=b.rowsAffected()}}catch(f){throw f}finally{if(b&&b.close){b.close()}}return a};function ServerSession(b,a,c){this.SessionName="";this.MainFrm;this.Unloading=false;this.iMessage="";this.iArgs;this.iFromSessionName="";this.iResult=new IDVariant();this.SessionName=a;if(c!=null&&c.equals("§")){this.MainFrm=b}else{this.MainFrm=b.CreateWEP();this.MainFrm.SessionQueryString=c}this.MainFrm.SessionName=this.SessionName}ServerSession.prototype.Stop=function(a){this.Unloading=true;if(a){self.close()}};ServerSession.prototype.Init=function(){self.RD4_WebEntryPoint=this.MainFrm;if(self.RD4_PreInit){for(var i=0;i<self.RD4_PreInit.length;i++){eval(self.RD4_PreInit[i])}}try{this.MainFrm.HandleRequest(null,null);this.Tick()}catch(e){WriteToConsoleError(e)}};ServerSession.prototype.Tick=function(){if(!this.Unloading){try{this.MainFrm.DTTObj.AddRequest(this.MainFrm);this.MainFrm.DTTObj.SetRequestName("Session Tick","Server Session Tick",DTTRequest.PRI_ITEM);this.MainFrm.TimerObj.Tick(this.MainFrm);this.HandleMessage();this.MainFrm.UpdateIMDBState();if(this.MainFrm.DTTObj.IsEmptyRequest()){this.MainFrm.DTTObj.CancelRequest()}else{this.MainFrm.DTTObj.EndRequest()}self.setTimeout("self.RD4_ServerSession.Tick()",50)}catch(a){try{WriteToConsoleError(a)}catch(a){}}}else{this.MainFrm._WebEntryPoint();WebEntryPointSrv.SSManager.RemoveSession(this.SessionName)}};ServerSession.prototype.SendMessage=function(c,b,a){this.iMessage=b;this.iArgs=a;this.iFromSessionName=c;this.iResult.set(new IDVariant(0));return this.iResult};ServerSession.prototype.HandleMessage=function(){if(this.iMessage.equals("")){return}try{var g="UPDATE Sessions SET";g+=" Result = '1;-1'";g+=" WHERE SessionName = "+IDL.Quote(this.SessionName);g+=" AND Result = '1;0'";var c=WebEntryPointSrv.SSManager.ExecuteQuery(g,true);if(c.rowsAffected==1){this.iResult.set(new IDVariant(-1))}else{return}}catch(h){WriteToConsoleError("Error while beginning to handle message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}var f=new IDVariant();this.MainFrm.DTTObj.SetRequestName("Session Message "+this.iMessage,"Handle Session Message "+this.iMessage,DTTRequest.PRI_CMD);try{if(this.iMessage.equals(Glb.ITEM_DTT)){var d=this.iArgs.GetNative();var a=new XMLDoc();var b=a.AddNewElement("debug");b.SetAttribute("par1",d[1].stringValue());b.SetAttribute("par2",d[2].stringValue());this.MainFrm.DTTObj.Render(this.MainFrm,d[0].stringValue(),b);a=new XMLDoc();b=a.AddNewElement("debug");b.SetAttribute("WIN",this.MainFrm.DebugWindow);b.SetAttribute("IL",this.MainFrm.DebugItemList);b.SetAttribute("CMD",this.MainFrm.DebugCmdForm);b.SetAttribute("DET",this.MainFrm.DebugDetail);b.SetAttribute("TOP",this.MainFrm.DebugReqTop);b.SetAttribute("REF",this.MainFrm.DebugReqRef);b.SetAttribute("PRC",this.MainFrm.DebugReqPrc);this.MainFrm.DebugWindow="";this.MainFrm.DebugItemList="";this.MainFrm.DebugCmdForm="";this.MainFrm.DebugDetail="";this.MainFrm.DebugReqTop="";this.MainFrm.DebugReqRef="";this.MainFrm.DebugReqPrc="";this.MainFrm.SendDebug=false;f=new IDVariant(a.SaveToString())}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",400,"MainFrm.OnSessionMessage","Firing OnSessionMessage event");this.MainFrm.DTTObj.AddParameter("","","SessionName",this.iFromSessionName);this.MainFrm.DTTObj.AddParameter("","","Message",this.iMessage);this.MainFrm.DTTObj.AddParameter("","","Parameters.Count",this.iArgs.Size());this.MainFrm.DTTObj.AddParameter("","","Result",f);this.MainFrm.OnSessionMessage(new IDVariant(this.iFromSessionName),new IDVariant(this.iMessage),this.iArgs,f);if(f.Type==IDVariant.NULL){f=new IDVariant(1)}}}catch(h){f=new IDVariant(2);WriteToConsoleError(h)}if(this.iResult.Equals(new IDVariant(-1))){this.iResult.set(f)}try{var g="UPDATE Sessions SET";g+=" Result = "+IDL.Quote(f.Type+";"+f.stringValue());g+=" WHERE SessionName = "+IDL.Quote(this.SessionName);g+=" AND Result = '1;-1'";WebEntryPointSrv.SSManager.ExecuteQuery(g);this.iMessage=""}catch(h){WriteToConsoleError("Error while ending to handle message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}};function TimerHandlerSrv(a){this.Timers=new Array();this.MainFrm=a;if(a!=undefined){if(a.ParamsObj().MAX_TIMERS>0){this.Timers=new Array(a.ParamsObj().MAX_TIMERS+1)}}}TimerHandlerSrv.prototype.AppendTo=function(a){};TimerHandlerSrv.prototype.set_Enabled=function(a,b){this.Timers[a].set_bEnabled(b)};TimerHandlerSrv.prototype.Enabled=function(a){return this.Timers[a].bEnabled()};TimerHandlerSrv.prototype.set_NumTicks=function(a,b){this.Timers[a].NumTicks=b;this.Timers[a].RD3Change(RD3Glb.TIM_NUMTICKS)};TimerHandlerSrv.prototype.NumTicks=function(a){return this.Timers[a].NumTicks};TimerHandlerSrv.prototype.set_Interval=function(a,b){this.Timers[a].Interval=b;this.Timers[a].RD3Change(RD3Glb.TIM_INTERVAL)};TimerHandlerSrv.prototype.Interval=function(a){return this.Timers[a].Interval};TimerHandlerSrv.prototype.ActivateTimers=function(c,a){for(var d=1;d<this.Timers.length;d++){if(this.Timers[d]==null){continue}if(this.Timers[d].IdxForm==c){if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Timers[d].iGuid,35,"TimerHandler.ActivateTimer","Timer "+this.Timers[d].Code+(a?" activated":" deactivated"))}this.Timers[d].set_Active(a)}}if(c>65536&&!a){this.CloseMultipleForm(c)}};TimerHandlerSrv.prototype.Tick=function(a){if(a.ParamsObj().UseRD3){return}for(var b=1;b<this.Timers.length;b++){if(this.Timers[b]==null){continue}if(this.Timers[b].ServerSession!=this.MainFrm.IsServerSession()){continue}this.Timers[b].Tick(a)}};TimerHandlerSrv.prototype.OpenMultipleForm=function(e){var d=e&65535;var f=0;var a=0;for(var b=1;b<this.Timers.length;b++){if(this.Timers[b]!=null&&this.Timers[b].IdxForm==d){if(f==0){f=b}a++}}if(a==0){return 0}var c=Glb.GetObjects(this.Timers,a);if(c==0){c=this.Timers.length;Array.resize(this.Timers,c+a)}for(var b=0;b<a;b++){this.Timers[c+b]=new ATimerSrv();this.Timers[c+b].CopyFrom(this.Timers[f+b]);this.Timers[c+b].IdxForm=e;this.Timers[c+b].Index=c+b}return c-f};TimerHandlerSrv.prototype.CloseMultipleForm=function(b){for(var a=1;a<this.Timers.length;a++){if(this.Timers[a]!=null&&this.Timers[a].IdxForm==b){this.Timers[a]=null}}};TimerHandlerSrv.prototype.GetRD3Name=function(){return"tmh"};TimerHandlerSrv.prototype.RD3RenderDifferences=function(d,g,a){if(this.Timers.length==0){return false}var f=null;if(g){f=d.AddNewElement(this.GetRD3Name())}var e=false;var b=(g)?f:d;for(var c=1;c<this.Timers.length;c++){if(this.Timers[c]==null){continue}if(a>0&&this.Timers[c].IdxForm!=a){continue}if(this.Timers[c].ServerSession){continue}e|=this.Timers[c].RD3RenderDifferences(b,g)}return e};function ScreenZoneSrv(c,a,d,b){this.Index;this.iPosition;this.iTabVisibility=Glb.SCRZONE_AUTTAB;this.iShowPin=true;this.iZoneState=Glb.SCRZONE_PINNEDZONE;this.iSelectedForm=Glb.SCRZONE_SELECTEDNONE;this.iZoneSize=240;this.iVerticalBehaviour=Glb.SCRZONE_VERTICALCOLLAPSE;this.iTabPosition;this.iSwipeMode=Glb.SCRZONE_SWIPECOLLAPSABLE;this.iHasMobileMenu=false;this.WebEntryPoint;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.SCZ_MAXPROPS);if(c!=undefined){this.MainFrm=c;this.Index=a;this.set_Position(d);this.set_TabPosition(b);if(this.MainFrm.IsMobile()){this.iZoneSize=-10;if((this.MainFrm.MenuType==Glb.MENUTYPE_LEFTSB||this.MainFrm.MenuType==Glb.MENUTYPE_GROUPED)&&this.iPosition==Glb.FORMDOCK_LEFT){this.iHasMobileMenu=true}if((this.MainFrm.MenuType==Glb.MENUTYPE_RIGHTSB||this.MainFrm.MenuType==Glb.MENUTYPE_GROUPEDR)&&this.iPosition==Glb.FORMDOCK_RIGHT){this.iHasMobileMenu=true}if(this.iHasMobileMenu){this.iSelectedForm=Glb.SCRZONE_SELECTEDMENU;this.iVerticalBehaviour=Glb.SCRZONE_VERTICALHIDE}if(this.iPosition==Glb.FORMDOCK_TOP||this.iPosition==Glb.FORMDOCK_BOTTOM){this.iVerticalBehaviour=Glb.SCRZONE_VERTICALNOCHANGE}}}}ScreenZoneSrv.prototype.Position=function(){return this.iPosition};ScreenZoneSrv.prototype.set_Position=function(a){this.iPosition=a;this.RD3Change(RD3Glb.SCZ_POSITION)};ScreenZoneSrv.prototype.TabVisibility=function(){return this.iTabVisibility};ScreenZoneSrv.prototype.set_TabVisibility=function(a){this.iTabVisibility=a;this.RD3Change(RD3Glb.SCZ_TABVISIBILITY)};ScreenZoneSrv.prototype.ShowPin=function(){return this.iShowPin};ScreenZoneSrv.prototype.set_ShowPin=function(a){this.iShowPin=a;this.RD3Change(RD3Glb.SCZ_SHOWPIN)};ScreenZoneSrv.prototype.ZoneState=function(){return this.iZoneState};ScreenZoneSrv.prototype.set_ZoneState=function(a){this.iZoneState=a;this.RD3Change(RD3Glb.SCZ_ZONESTATE)};ScreenZoneSrv.prototype.SelectedForm=function(){return this.iSelectedForm};ScreenZoneSrv.prototype.set_SelectedForm=function(c){this.iSelectedForm=c;this.RD3Change(RD3Glb.SCZ_SELECTEDFORM);for(var a=0;a<this.MainFrm.StackForm.Count();a++){var b=this.MainFrm.StackForm.Get(a);if(b.FormIdx==c){b.Form_Activate();b.SubForm_Activate();break}}};ScreenZoneSrv.prototype.ZoneSize=function(){return this.iZoneSize};ScreenZoneSrv.prototype.set_ZoneSize=function(a){this.iZoneSize=a;this.RD3Change(RD3Glb.SCZ_ZONESIZE)};ScreenZoneSrv.prototype.VerticalBehaviour=function(){return this.iVerticalBehaviour};ScreenZoneSrv.prototype.set_VerticalBehaviour=function(a){this.iVerticalBehaviour=a;this.RD3Change(RD3Glb.SCZ_VERTICALBEHAVIOUR)};ScreenZoneSrv.prototype.TabPosition=function(){return this.iTabPosition};ScreenZoneSrv.prototype.set_TabPosition=function(a){this.iTabPosition=a;this.RD3Change(RD3Glb.SCZ_TABPOSITION)};ScreenZoneSrv.prototype.SwipeMode=function(){return this.iSwipeMode};ScreenZoneSrv.prototype.set_SwipeMode=function(a){this.iSwipeMode=a;this.RD3Change(RD3Glb.SCZ_SWIPEMODE)};ScreenZoneSrv.prototype.GetForms=function(){var c=new IDArray();var d=this.MainFrm.StackForm.Count();for(var a=0;a<d;a++){var b=this.MainFrm.StackForm.Get(a);if(b.Docked&&b.DockType==this.Position()){c.add_Object(b)}}return c};ScreenZoneSrv.prototype.ActivateNextForm=function(){var a=this.GetForms();if(a.Size()==0){if(this.iHasMobileMenu){this.set_SelectedForm(Glb.SCRZONE_SELECTEDMENU)}else{this.set_SelectedForm(Glb.SCRZONE_SELECTEDNONE)}}else{this.set_SelectedForm((a.get_Object(new IDVariant(0))).FormIdx)}};ScreenZoneSrv.prototype.AddForm=function(d){var f=this.MainFrm.StackForm.Count();for(var a=0;a<f;a++){var c=this.MainFrm.StackForm.Get(a);if(c.Docked&&c.DockType==this.Position()&&c.FormIdx==d.FormIdx){return}}if(d.Docked&&d.DockType!=this.Position()){var e=this.MainFrm.ScreenZone(d.DockType);var b=false;if(e.SelectedForm()==d.FormIdx){b=true}d.DockType=this.Position();d.RD3Change(RD3Glb.FRM_DOCKTYPE);if(b){e.ActivateNextForm()}}else{d.Docked=true;d.DockType=this.Position();d.RD3Change(RD3Glb.FRM_DOCKED);d.RD3Change(RD3Glb.FRM_DOCKTYPE);this.MainFrm.ActivateNextForm()}if(this.SelectedForm()==Glb.SCRZONE_SELECTEDNONE){this.set_SelectedForm(d.FormIdx)}};ScreenZoneSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};ScreenZoneSrv.prototype.GetRD3Name=function(){return"scz"};ScreenZoneSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};ScreenZoneSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){for(var b=0;b<this.RD3PropChg.length;b++){if(this.RD3PropChg[b]||f){this.SetRD3Property(b,e,f)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(f){}var a=(f)?e:c;return d};ScreenZoneSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.SCZ_POSITION:c.SetAttribute("pos",this.iPosition.toString());break;case RD3Glb.SCZ_TABVISIBILITY:if(this.iTabVisibility==Glb.SCRZONE_AUTTAB&&b){break}c.SetAttribute("tvs",this.iTabVisibility.toString());break;case RD3Glb.SCZ_SHOWPIN:if(this.iShowPin==true&&b){break}c.SetAttribute("spn",this.iShowPin?"1":"0");break;case RD3Glb.SCZ_ZONESTATE:if(this.iZoneState==Glb.SCRZONE_PINNEDZONE&&b){break}c.SetAttribute("zst",this.iZoneState.toString());break;case RD3Glb.SCZ_SELECTEDFORM:c.SetAttribute("sel",this.iSelectedForm.toString());break;case RD3Glb.SCZ_ZONESIZE:if(this.iZoneSize==240&&b){break}c.SetAttribute("siz",this.iZoneSize.toString());break;case RD3Glb.SCZ_VERTICALBEHAVIOUR:if(this.iVerticalBehaviour==Glb.SCRZONE_VERTICALCOLLAPSE&&b){break}c.SetAttribute("vbh",this.iVerticalBehaviour.toString());break;case RD3Glb.SCZ_TABPOSITION:c.SetAttribute("tps",this.iTabPosition.toString());break;case RD3Glb.SCZ_HASMENU:if(this.iHasMobileMenu==false&&b){break}c.SetAttribute("hmm",this.iHasMobileMenu?"1":"0");break;case RD3Glb.SCZ_SWIPEMODE:if(this.iSwipeMode==Glb.SCRZONE_SWIPECOLLAPSABLE&&b){break}c.SetAttribute("swm",this.iSwipeMode.toString());break}};function VisAttrListSrv(){this.iVisAttrObj;this.iVisIdxMap=null;this.iVisIdxMapInv=null}VisAttrListSrv.prototype.Size=function(){return this.iVisAttrObj.length};VisAttrListSrv.prototype.set_Size=function(a){this.iVisAttrObj=new Array(a+1)};VisAttrListSrv.prototype.VisualAttribute=function(a){return this.iVisAttrObj[a]};VisAttrListSrv.prototype.set_VisualAttribute=function(a,b){this.iVisAttrObj[a]=b;b.Index=a};VisAttrListSrv.prototype.Derived=function(a){return this.iVisAttrObj[a].Derived()};VisAttrListSrv.prototype.set_Derived=function(a,b){this.iVisAttrObj[a].set_Derived(b)};VisAttrListSrv.prototype.Alignment=function(a,b){return this.iVisAttrObj[a].Alignment(b)};VisAttrListSrv.prototype.set_Alignment=function(a,c,b){this.iVisAttrObj[a].set_Alignment(c,b)};VisAttrListSrv.prototype.ControlType=function(a){return this.iVisAttrObj[a].ControlType()};VisAttrListSrv.prototype.set_ControlType=function(a,b){this.iVisAttrObj[a].set_ControlType(b)};VisAttrListSrv.prototype.Mask=function(a){return this.iVisAttrObj[a].Mask()};VisAttrListSrv.prototype.set_Mask=function(a,b){this.iVisAttrObj[a].set_Mask(b)};VisAttrListSrv.prototype.Cursor=function(a){return this.iVisAttrObj[a].Cursor()};VisAttrListSrv.prototype.set_Cursor=function(a,b){this.iVisAttrObj[a].set_Cursor(b)};VisAttrListSrv.prototype.RowOffset=function(a){return this.iVisAttrObj[a].RowOffset()};VisAttrListSrv.prototype.set_RowOffset=function(a,b){this.iVisAttrObj[a].set_RowOffset(b)};VisAttrListSrv.prototype.HeaderOffset=function(a){return this.iVisAttrObj[a].HeaderOffset()};VisAttrListSrv.prototype.set_HeaderOffset=function(a,b){this.iVisAttrObj[a].set_HeaderOffset(b)};VisAttrListSrv.prototype.BorderType=function(a,b){return this.iVisAttrObj[a].BorderType(b)};VisAttrListSrv.prototype.set_BorderType=function(a,c,b){this.iVisAttrObj[a].set_BorderType(c,b)};VisAttrListSrv.prototype.Color=function(a,b){return this.iVisAttrObj[a].Color(b)};VisAttrListSrv.prototype.set_Color=function(a,c,b){this.iVisAttrObj[a].set_Color(c,b)};VisAttrListSrv.prototype.Font=function(a,b){return this.iVisAttrObj[a].Font(b)};VisAttrListSrv.prototype.set_Font=function(a,c,b){this.iVisAttrObj[a].set_Font(c,b)};VisAttrListSrv.prototype.Flags=function(a){return this.iVisAttrObj[a].Flags()};VisAttrListSrv.prototype.set_Flags=function(a,b){this.iVisAttrObj[a].set_Flags(b)};VisAttrListSrv.prototype.CBorColor=function(a,b){return this.iVisAttrObj[a].CBorColor(b)};VisAttrListSrv.prototype.set_CBorColor=function(a,c,b){this.iVisAttrObj[a].set_CBorColor(c,b)};VisAttrListSrv.prototype.CBorWidth=function(a,b){return this.iVisAttrObj[a].CBorWidth(b)};VisAttrListSrv.prototype.set_CBorWidth=function(a,c,b){this.iVisAttrObj[a].set_CBorWidth(c,b)};VisAttrListSrv.prototype.CBorPadding=function(a,b){return this.iVisAttrObj[a].CBorPadding(b)};VisAttrListSrv.prototype.set_CBorPadding=function(a,c,b){this.iVisAttrObj[a].set_CBorPadding(c,b)};VisAttrListSrv.prototype.CBorType=function(a,b){return this.iVisAttrObj[a].CBorType(b)};VisAttrListSrv.prototype.set_CBorType=function(a,c,b){this.iVisAttrObj[a].set_CBorType(c,b)};VisAttrListSrv.prototype.GetVS=function(b){if(b.length==0){return 0}for(var a=1;a<this.iVisAttrObj.length;a++){if(b.equals(this.iVisAttrObj[a].iGuid)){return a}}return 0};VisAttrListSrv.prototype.AdaptWebRect=function(c,f,d,b,a,e){};VisAttrListSrv.prototype.GetWebRect=function(j,e,c,g,a,h,d,b,f){};VisAttrListSrv.prototype.GradCol=function(a,b){return this.iVisAttrObj[a].GradCol(b)};VisAttrListSrv.prototype.set_GradCol=function(a,c,b){this.iVisAttrObj[a].set_GradCol(c,b)};VisAttrListSrv.prototype.GradDir=function(a,b){return this.iVisAttrObj[a].GradDir(b)};VisAttrListSrv.prototype.set_GradDir=function(a,c,b){this.iVisAttrObj[a].set_GradDir(c,b)};VisAttrListSrv.prototype.Opacity=function(a,b){return this.iVisAttrObj[a].Opacity(b)};VisAttrListSrv.prototype.set_Opacity=function(a,c,b){this.iVisAttrObj[a].set_Opacity(c,b)};VisAttrListSrv.prototype.LetterSpacing=function(a){return this.iVisAttrObj[a].LetterSpacing()};VisAttrListSrv.prototype.set_LetterSpacing=function(a,b){this.iVisAttrObj[a].set_LetterSpacing(b)};VisAttrListSrv.prototype.WordSpacing=function(a){return this.iVisAttrObj[a].WordSpacing()};VisAttrListSrv.prototype.set_WordSpacing=function(a,b){this.iVisAttrObj[a].set_WordSpacing(b)};VisAttrListSrv.prototype.HorizontalScale=function(a){return this.iVisAttrObj[a].HorizontalScale()};VisAttrListSrv.prototype.set_HorizontalScale=function(a,b){this.iVisAttrObj[a].set_HorizontalScale(b)};VisAttrListSrv.prototype.GetRD3Name=function(){return"vsl"};VisAttrListSrv.prototype.RD3RenderDifferences=function(d,g){if(this.iVisAttrObj.length==0){return false}var f=null;if(g){f=d.AddNewElement(this.GetRD3Name())}else{for(var c=1;c<this.iVisAttrObj.length;c++){if(this.iVisAttrObj[c].RD3NewObj){f=d.AddNewElement("chg");d.GetNode().insertBefore(f.GetNode(),d.GetNode().childNodes[0]);break}}}if(f!=null){f.SetAttribute("id",this.GetRD3Name())}var e=false;for(var c=1;c<this.iVisAttrObj.length;c++){var b=this.iVisAttrObj[c];var a=(g||b.RD3NewObj)?f:d;e|=b.RD3RenderDifferences(a,g||b.RD3NewObj);b.RD3NewObj=false}return e};VisAttrListSrv.prototype.GetTrueIdx=function(a){return(this.iVisIdxMap==null?a:this.iVisIdxMap[a])};VisAttrListSrv.prototype.GetTrueIdxInverse=function(b,a){if(a==0){return a}if(this.iVisIdxMapInv==null&&b.VisualStyleList.iVisIdxMap==null){return a}if(this.iVisIdxMapInv==null){this.iVisIdxMapInv=new Array(b.GetVisualStyleList().iVisAttrObj.length);for(var c=0;c<b.VisualStyleList.iVisIdxMap.length;c++){this.iVisIdxMapInv[b.VisualStyleList.iVisIdxMap[c]]=c}}if(a>this.iVisIdxMapInv.length){return a}return this.iVisIdxMapInv[a]};VisAttrListSrv.prototype.SynchTo=function(a){this.iVisIdxMap=new Array(this.iVisAttrObj.length);var e=this.iVisAttrObj;this.iVisAttrObj=new Array(e.length);for(var b=1;b<e.length;b++){var d=a.GetVS(e[b].iGuid);if(d==0){d=a.iVisAttrObj.length;Array.resize(a.iVisAttrObj,d+1);a.iVisAttrObj[d]=e[b];a.iVisAttrObj[d].Index=d;a.iVisAttrObj[d].RD3NewObj=true;if(a.iVisAttrObj[d].Derived()!=null){var c=a.GetVS(a.iVisAttrObj[d].Derived().iGuid);a.iVisAttrObj[d].iDerived=a.iVisAttrObj[c]}}this.iVisIdxMap[b]=d;this.iVisAttrObj[b]=a.iVisAttrObj[d]}};VisAttrObjSrv.MAX_FONTS=6;VisAttrObjSrv.MAX_COLORS=23;VisAttrObjSrv.MAX_BORDERS=6;VisAttrObjSrv.MAX_ALIGNMENTS=3;VisAttrObjSrv.MAX_CUSTBORDERS=4;function VisAttrObjSrv(){this.iAlignment=new Array(VisAttrObjSrv.MAX_ALIGNMENTS+1);for(var a=1;a<=VisAttrObjSrv.MAX_ALIGNMENTS;a++){this.iAlignment[a]=-1}this.iControlType=-1;this.iCursor;this.iMask;this.iMaskAssigned=false;this.iCursorAssigned=false;this.iRowOffset=-1;this.iHeaderOffset=-1;this.iBorderType=new Array(VisAttrObjSrv.MAX_BORDERS+1);for(var a=1;a<=VisAttrObjSrv.MAX_BORDERS;a++){this.iBorderType[a]=-1}this.iColor=new Array(VisAttrObjSrv.MAX_COLORS+1);for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){this.iColor[a]=-2}this.iFont=new Array(VisAttrObjSrv.MAX_FONTS+1);this.iFlags=-1;this.iGuid;this.Index;this.CustColor=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustWidth=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustType=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustPadding=new Array(VisAttrObjSrv.MAX_CUSTBORDERS+1);for(var a=1;a<=VisAttrObjSrv.MAX_CUSTBORDERS;a++){this.CustColor[a]=-2;this.CustWidth[a]=-1;this.CustType[a]=-1;this.CustPadding[a]=-1}this.iGradCol=new Array(VisAttrObjSrv.MAX_COLORS+1);this.iGradDir=new Array(VisAttrObjSrv.MAX_COLORS+1);this.iOpacity=new Array(VisAttrObjSrv.MAX_COLORS+1);for(var a=1;a<=VisAttrObjSrv.MAX_COLORS;a++){this.iGradCol[a]=-1;this.iGradDir[a]=-1;this.iOpacity[a]=-1}this.iLetterSpacing=-1;this.iWordSpacing=-1;this.iHorizontalScale=-1;this.iDerived;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VIS_MAXPROP);this.RD3NewObj=false;this.AlignmentDiff=new BitArray(VisAttrObjSrv.MAX_ALIGNMENTS+1);this.BorderTypeDiff=new BitArray(VisAttrObjSrv.MAX_BORDERS+1);this.ColorDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.FontDiff=new BitArray(VisAttrObjSrv.MAX_FONTS+1);this.CustColorDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustWidthDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustTypeDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.CustPaddingDiff=new BitArray(VisAttrObjSrv.MAX_CUSTBORDERS+1);this.GradColDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.GradDirDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1);this.OpacityDiff=new BitArray(VisAttrObjSrv.MAX_COLORS+1)}VisAttrObjSrv.prototype.Derived=function(){return this.iDerived};VisAttrObjSrv.prototype.set_Derived=function(a){this.iDerived=a;this.RD3Change(RD3Glb.VIS_DERIVED)};VisAttrObjSrv.prototype.Alignment=function(a){if(this.iAlignment[a]==-1&&this.iDerived!=null){return this.iDerived.Alignment(a)}else{return this.iAlignment[a]}};VisAttrObjSrv.prototype.set_Alignment=function(b,a){this.iAlignment[b]=a;this.AlignmentDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.ControlType=function(){if(this.iControlType==-1&&this.iDerived!=null){return this.iDerived.ControlType()}else{return this.iControlType}};VisAttrObjSrv.prototype.set_ControlType=function(a){this.iControlType=a;this.RD3Change(RD3Glb.VIS_CONTROLTYPE)};VisAttrObjSrv.prototype.LetterSpacing=function(){if(this.iLetterSpacing==-1&&this.iDerived!=null){return this.iDerived.LetterSpacing()}else{return this.iLetterSpacing}};VisAttrObjSrv.prototype.set_LetterSpacing=function(a){this.iLetterSpacing=a;this.RD3Change(RD3Glb.VIS_LETTERSPACING)};VisAttrObjSrv.prototype.WordSpacing=function(){if(this.iWordSpacing==-1&&this.iDerived!=null){return this.iDerived.WordSpacing()}else{return this.iWordSpacing}};VisAttrObjSrv.prototype.set_WordSpacing=function(a){this.iWordSpacing=a;this.RD3Change(RD3Glb.VIS_WORDSPACING)};VisAttrObjSrv.prototype.HorizontalScale=function(){if(this.iHorizontalScale==-1&&this.iDerived!=null){return this.iDerived.HorizontalScale()}else{return this.iHorizontalScale}};VisAttrObjSrv.prototype.set_HorizontalScale=function(a){this.iHorizontalScale=a;this.RD3Change(RD3Glb.VIS_HORIZONTALSCALE)};VisAttrObjSrv.prototype.Mask=function(){if(!this.iMaskAssigned&&this.iDerived!=null){return this.iDerived.Mask()}else{return this.iMask}};VisAttrObjSrv.prototype.set_Mask=function(a){this.iMask=a;this.iMaskAssigned=true;this.RD3Change(RD3Glb.VIS_MASK)};VisAttrObjSrv.prototype.Cursor=function(){if(!this.iCursorAssigned&&this.iDerived!=null){return this.iDerived.Cursor()}else{return this.iCursor}};VisAttrObjSrv.prototype.set_Cursor=function(a){this.iCursor=a;this.iCursorAssigned=true;this.RD3Change(RD3Glb.VIS_CURSOR)};VisAttrObjSrv.prototype.RowOffset=function(){if(this.iRowOffset==-1&&this.iDerived!=null){return this.iDerived.RowOffset()}else{return this.iRowOffset}};VisAttrObjSrv.prototype.set_RowOffset=function(a){this.iRowOffset=a;this.RD3Change(RD3Glb.VIS_ROWOFFSET)};VisAttrObjSrv.prototype.HeaderOffset=function(){if(this.iHeaderOffset==-1&&this.iDerived!=null){return this.iDerived.HeaderOffset()}else{return this.iHeaderOffset}};VisAttrObjSrv.prototype.set_HeaderOffset=function(a){this.iHeaderOffset=a;this.RD3Change(RD3Glb.VIS_HEADOFFSET)};VisAttrObjSrv.prototype.BorderType=function(a){if(this.iBorderType[a]==-1&&this.iDerived!=null){return this.iDerived.BorderType(a)}else{return this.iBorderType[a]}};VisAttrObjSrv.prototype.set_BorderType=function(b,a){this.iBorderType[b]=a;this.BorderTypeDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Color=function(a){if(this.iColor[a]==-2&&this.iDerived!=null){return this.iDerived.Color(a)}else{return this.iColor[a]}};VisAttrObjSrv.prototype.set_Color=function(b,a){this.iColor[b]=a;this.ColorDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Font=function(a){if((this.iFont[a]==null||this.iFont[a].length==0)&&this.iDerived!=null){return this.iDerived.Font(a)}else{return this.iFont[a]}};VisAttrObjSrv.prototype.set_Font=function(b,a){this.iFont[b]=a;this.FontDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Flags=function(){if(this.iFlags==-1&&this.iDerived!=null){return this.iDerived.Flags()}else{return this.iFlags}};VisAttrObjSrv.prototype.set_Flags=function(a){this.iFlags=a;this.RD3Change(RD3Glb.VIS_FLAGS)};VisAttrObjSrv.prototype.CBorColor=function(a){if(this.CustColor[a]==-2&&this.iDerived!=null){return this.iDerived.CBorColor(a)}else{return this.CustColor[a]}};VisAttrObjSrv.prototype.set_CBorColor=function(b,a){this.CustColor[b]=a;this.CustColorDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorWidth=function(a){if(this.CustWidth[a]==-1&&this.iDerived!=null){return this.iDerived.CBorWidth(a)}else{return this.CustWidth[a]}};VisAttrObjSrv.prototype.set_CBorWidth=function(b,a){this.CustWidth[b]=a;this.CustWidthDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorPadding=function(a){if(this.CustPadding[a]==-1&&this.iDerived!=null){return this.iDerived.CBorPadding(a)}else{return this.CustPadding[a]}};VisAttrObjSrv.prototype.set_CBorPadding=function(b,a){this.CustPadding[b]=a;this.CustPaddingDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.CBorType=function(a){if(this.CustType[a]==-1&&this.iDerived!=null){return this.iDerived.CBorType(a)}else{return this.CustType[a]}};VisAttrObjSrv.prototype.set_CBorType=function(b,a){this.CustType[b]=a;this.CustTypeDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.AdaptWebRect=function(g,e,c,b,f,a,d){};VisAttrObjSrv.prototype.GradCol=function(a){if(this.iGradCol[a]==-1&&this.iDerived!=null){return this.iDerived.GradCol(a)}else{return this.iGradCol[a]}};VisAttrObjSrv.prototype.set_GradCol=function(b,a){this.iGradCol[b]=a;this.GradColDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.GradDir=function(a){if(this.iGradDir[a]==-1&&this.iDerived!=null){return this.iDerived.GradDir(a)}else{return this.iGradDir[a]}};VisAttrObjSrv.prototype.set_GradDir=function(b,a){this.iGradDir[b]=a;this.GradDirDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.Opacity=function(a){if(this.iOpacity[a]==-1&&this.iDerived!=null){return this.iDerived.Opacity(a)}else{return this.iOpacity[a]}};VisAttrObjSrv.prototype.set_Opacity=function(b,a){this.iOpacity[b]=a;this.OpacityDiff[b]=true;this.RD3Changed=true};VisAttrObjSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.Index};VisAttrObjSrv.prototype.GetRD3Name=function(){return"vis"};VisAttrObjSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};VisAttrObjSrv.prototype.RD3RenderDifferences=function(c,f){var e=null;if(f){e=c.AddNewElement(this.GetRD3Name())}if(e==null&&this.RD3Changed){e=c.AddNewElement("chg")}if(e!=null){e.SetAttribute("id",this.GetRD3Ident())}var d=this.RD3Changed;if(f||this.RD3Changed){var b=this.RD3PropChg.length;for(var a=0;a<b;a++){if(this.RD3PropChg[a]||f){this.SetRD3Property(a,e,f)}}this.SetRD3GroupProperties(e,f);this.RD3Changed=false;this.RD3PropChg.SetAll(false)}return d};VisAttrObjSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.VIS_CONTROLTYPE:if(this.iControlType==-1&&b){break}c.SetAttribute("con",this.iControlType.toString());break;case RD3Glb.VIS_MASK:if(!this.iMaskAssigned&&b){break}c.SetAttribute("msk",this.iMask);break;case RD3Glb.VIS_CURSOR:if(!this.iCursorAssigned&&b){break}c.SetAttribute("cur",this.iCursor);break;case RD3Glb.VIS_ROWOFFSET:if(this.iRowOffset==-1&&b){break}c.SetAttribute("off",this.iRowOffset.toString());break;case RD3Glb.VIS_HEADOFFSET:if(this.iHeaderOffset==-1&&b){break}c.SetAttribute("hof",this.iHeaderOffset.toString());break;case RD3Glb.VIS_FLAGS:if(this.iFlags==-1&&b){break}c.SetAttribute("fla",this.iFlags.toString());break;case RD3Glb.VIS_LETTERSPACING:if(this.iLetterSpacing==-1&&b){break}c.SetAttribute("les",this.iLetterSpacing.toString());break;case RD3Glb.VIS_WORDSPACING:if(this.iWordSpacing==-1&&b){break}c.SetAttribute("wos",this.iWordSpacing.toString());break;case RD3Glb.VIS_HORIZONTALSCALE:if(this.iHorizontalScale==-1&&b){break}c.SetAttribute("hor",this.iHorizontalScale.toString());break;case RD3Glb.VIS_DERIVED:if(this.iDerived!=null){c.SetAttribute("der",this.iDerived.Index.toString())}break}};VisAttrObjSrv.prototype.SetRD3GroupProperties=function(c,b){var d=this.AlignmentDiff.length;for(var a=1;a<d;a++){if(b||this.AlignmentDiff[a]){if(this.iAlignment[a]==-1&&b){continue}c.SetAttribute("ali"+a,this.iAlignment[a].toString())}}this.AlignmentDiff.SetAll(false);d=this.BorderTypeDiff.length;for(var a=1;a<d;a++){if(b||this.BorderTypeDiff[a]){if(this.iBorderType[a]==-1&&b){continue}c.SetAttribute("bor"+a,this.iBorderType[a].toString())}}this.BorderTypeDiff.SetAll(false);d=this.ColorDiff.length;for(var a=1;a<d;a++){if(b||this.ColorDiff[a]){if(this.iColor[a]==-2&&b){continue}c.SetAttribute("col"+a,this.iColor[a]==-2?"-2":Glb.GetWebColor(this.iColor[a]))}}this.ColorDiff.SetAll(false);d=this.FontDiff.length;for(var a=1;a<d;a++){if(b||this.FontDiff[a]){if(b&&this.iFont[a]==null){continue}c.SetAttribute("fon"+a,(this.iFont[a]!=null)?this.iFont[a]:"")}}this.FontDiff.SetAll(false);d=this.CustColorDiff.length;for(var a=1;a<d;a++){if(b||this.CustColorDiff[a]){if((this.CustColor[a]==-2||(this.CustColor[a]==13684944&&this.iDerived==null))&&b){continue}c.SetAttribute("ccl"+a,this.CustColor[a]==-2?"-2":Glb.GetWebColor(this.CustColor[a]))}}this.CustColorDiff.SetAll(false);d=this.CustWidthDiff.length;for(var a=1;a<d;a++){if(b||this.CustWidthDiff[a]){if((this.CustWidth[a]==-1||(this.CustWidth[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cwd"+a,this.CustWidth[a].toString())}}this.CustWidthDiff.SetAll(false);d=this.CustTypeDiff.length;for(var a=1;a<d;a++){if(b||this.CustTypeDiff[a]){if((this.CustType[a]==-1||(this.CustType[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cty"+a,this.CustType[a].toString())}}this.CustTypeDiff.SetAll(false);d=this.CustPaddingDiff.length;for(var a=1;a<d;a++){if(b||this.CustPaddingDiff[a]){if((this.CustPadding[a]==-1||(this.CustPadding[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("cpd"+a,this.CustPadding[a].toString())}}this.CustPaddingDiff.SetAll(false);d=this.GradColDiff.length;for(var a=1;a<d;a++){if(b||this.GradColDiff[a]){if((this.iGradCol[a]==-1||this.iGradDir[a]==Glb.VISGRADDIR_NONE)&&b){continue}c.SetAttribute("gco"+a,this.iGradCol[a]==-1?"-1":Glb.GetWebColor(this.iGradCol[a]))}}this.GradColDiff.SetAll(false);d=this.GradDirDiff.length;for(var a=1;a<d;a++){if(b||this.GradDirDiff[a]){if((this.iGradDir[a]==-1||(this.iGradDir[a]==1&&this.iDerived==null))&&b){continue}c.SetAttribute("gdi"+a,this.iGradDir[a].toString())}}this.GradDirDiff.SetAll(false);d=this.OpacityDiff.length;for(var a=1;a<d;a++){if(b||this.OpacityDiff[a]){if((this.iOpacity[a]==-1||(this.iOpacity[a]==100&&this.iDerived==null))&&b){continue}c.SetAttribute("opa"+a,this.iOpacity[a].toString())}}this.OpacityDiff.SetAll(false)};function VoiceHandler(a){this.MainFrm=a;this.iListening=false;this.Skip=false;this.iResponse="";this.iSay="";this.iCanSpeak=true;this.LanguageTokens=new ArrayList();this.Punct=new ArrayList();this.objMap=new HashTableSrv();this.ComRecList=new ArrayList();this.VoiceCommandExecuted=false;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.VOICE_MAXPROPS)}VoiceHandler.OT_FORM=2162688;VoiceHandler.OT_PANEL=2621440;VoiceHandler.OT_CMD=2293760;VoiceHandler.OT_CMDSET=2228224;VoiceHandler.OT_PROC=1245184;VoiceHandler.OT_FUNCTION=134217728;VoiceHandler.OT_PFIELD=2686976;VoiceHandler.OT_PAGES=2752512;VoiceHandler.OT_PARAM=1376256;VoiceHandler.OT_BOOK=1118208;function VoicePunctuation(){this.Description="";this.Symbol="";this.Type=-1}VoicePunctuation.SINGLE=0;VoicePunctuation.DOUBLE=1;VoicePunctuation.RIGHT=2;VoicePunctuation.LEFT=3;VoiceHandler.prototype.Init=function(){if(this.MainFrm.ParamsObj().EnableVoice){var c=new VoiceRecognizerNavigator();this.ComRecList.Add(c);var f=new VoiceRecognizerAction();this.ComRecList.Add(f);try{var d=this.MainFrm.GetAppLanguage().toLowerCase();this.ReadCommandXML(self._ShellURL+"?WCI=RD3&WCE=GZ&FN=voice_"+d+".xml");var a=new XMLHttpRequest();a.open("GET",self._ShellURL+"?WCI=RD3&WCE=GZ&FN=prjVoice.xml",false);a.setRequestHeader("Content-Type","text/plain");a.send();this.LoadXml(a.responseText)}catch(b){WriteToConsoleError(b)}}};VoiceHandler.prototype.Listening=function(){return this.iListening};VoiceHandler.prototype.set_Listening=function(a){if(a!=this.iListening){this.iListening=a;this.RD3Change(RD3Glb.VOICE_LISTENING)}};VoiceHandler.prototype.CanSpeak=function(){return this.iCanSpeak};VoiceHandler.prototype.set_CanSpeak=function(a){this.iCanSpeak=a};VoiceHandler.prototype.SetResponse=function(a){this.iResponse=a;this.RD3Change(RD3Glb.VOICE_RESPONSE)};VoiceHandler.prototype.Say=function(a){if(this.iCanSpeak){this.iSay=a;this.RD3Change(RD3Glb.VOICE_SAY)}};VoiceHandler.prototype.HandleVoice=function(c){this.VoiceCommandExecuted=true;var b=c.GetAttribute("par1");var d=c.GetAttribute("par2");if(b=="lst"){this.iListening=d=="1"}else{if(b=="txt"){this.Skip=false;this.MainFrm.UrlParams.text=d;this.MainFrm.OnCommand(new IDVariant("VOICE"));if(!this.Skip){var a=this.Matching(d);if(a.length>0){this.SetResponse(a)}this.Say(a)}}}return true};VoiceHandler.prototype.ReadCommandXML=function(g){var m=new XMLHttpRequest();m.open("GET",g,false);m.setRequestHeader("Content-Type","text/plain");m.send();var k=m.responseText;var j=new XMLDoc();if(j.LoadFromString(k,-1)){var d=j.GetRootNode();if(d!=null){while(d.HasNextNode()){var f=d.GetNextNode();if(f!=null&&f.Name()=="LanguageTokens"){var l=f.Value();var p=new StringTokenizer();p.setString(new IDVariant(l),new IDVariant(","));while(p.hasNext()){var a=p.next().stringValue();a=a.trim().toLowerCase();var o=new VoiceWord(a);o.LanguageToken=true;this.LanguageTokens.Add(o)}}else{if(f!=null&&f.Name()=="Punctuation"){while(f.HasNextNode()){var b=new VoicePunctuation();var h=f.GetNextNode();if(h.GetAttribute("type")=="single"){b.Type=VoicePunctuation.SINGLE}else{b.Type=VoicePunctuation.DOUBLE}while(h.HasNextNode()){var c=h.GetNextNode();if(c.Name()=="Desc"){b.Description=c.Value()}else{if(c.Name()=="Symbol"){b.Symbol=c.Value()}}}this.Punct.Add(b)}}else{if(f!=null&&f.Name()=="CommandRecognizer"){var q=0;while(f!=null){var e=this.ComRecList.Get(q);e.Init(f);q++;f=d.GetNextNode()}}}}}}}};VoiceHandler.prototype.LoadXml=function(h){var t=new XMLDoc();var e=null;t.LoadFromString(h);if(t.HasNextNode()){e=t.GetNextNode();if(e.Name()=="xml"){e=t.GetNextNode()}while(e.HasNextNode()){var c=new VoiceIndeObj();var o=e.GetNextNode();var b="";var p="";while(o.HasNextNode()){var d=o.GetNextNode();if(d.Name().toLowerCase()=="guid"){c.GUID=d.Value()}else{if(d.Name().toLowerCase()=="name"){c.Name=d.Value()}else{if(d.Name().toLowerCase()=="description"){b=d.Value()}else{if(d.Name().toLowerCase()=="title"){p=d.Value()}else{if(d.Name().toLowerCase()=="type"){c.Type=d.Value()}else{if(d.Name().toLowerCase()=="parentguid"){c.ParentGuid=d.Value()}else{if(d.Name().toLowerCase()=="customdata"){c.CustomData=d.Value()}}}}}}}}this.objMap[c.GUID]=c;var q=[c.Name,b,p];for(var m=0;m<q.length;m++){if(q[m]==null){continue}var s=new StringTokenizer();s.setString(new IDVariant(q[m]),new IDVariant(" "));while(s.hasNext()){var g=s.next().stringValue();g=g.replace("\\p{Punct}","");var f=null;for(var l=0;l<c.Words.Count();l++){var r=c.Words.Get(l);if(r.Word.toLowerCase()==g.toLowerCase()){f=r;break}}if(f==null){var a=new VoiceWord();a.Word=g;a.LanguageToken=this.IsLanguageToken(a);a.Occurrences=1;if(!a.LanguageToken){switch(m){case 0:if(p!=null){a.Weight=(p.length==0?1:0)}break;case 1:a.Weight=0;break;case 2:a.Weight=1;break}}c.Words.Add(a)}else{f.Occurrences+=1;if(!f.LanguageToken){switch(m){case 0:if(p.length==0){f.Weight=1}break;case 1:break;case 2:f.Weight=1;break}}}}}var k=this.objMap[c.ParentGuid];if(k!=null){k.Children.Add(c)}}}};VoiceHandler.prototype.Matching=function(g){VoiceCommandExecuted=true;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1000,"VoiceHandler.Matching",'User command is "'+g+'"');this.MainFrm.DTTObj.SetRequestName("Voice Command",g,DTTRequest.PRI_CMD);if(g.length<=0){return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)}var m=new ArrayList();g=g.replace("'"," ");var c=new HashTableSrv();for(var h=0;h<this.Punct.Count();h++){var e=this.Punct.Get(h);var o=g.indexOf(" "+e.Description+" ");while(o>-1){var l=e.Symbol;if((e.Type==VoicePunctuation.SINGLE&&e.Symbol!="@")){g=g.replace(" "+e.Description+" ",e.Symbol+" ");break}else{if(c.Get(e.Symbol)==null||c.Get(e.Symbol)==VoicePunctuation.LEFT){var k="";k+=g.substring(0,o+1);var b=g.indexOf(" ",o+1);k+=e.Symbol;k+=g.substring(b+1);g=k;c[e.Symbol]=VoicePunctuation.RIGHT}else{if(c.Get(e.Symbol)!=null&&c.Get(e.Symbol)==VoicePunctuation.RIGHT){var k="";k+=g.substring(0,o);var b=g.indexOf(" ",o+1);k+=e.Symbol;k+=g.substring(b);g=k;c[e.Symbol]=VoicePunctuation.LEFT}}}o=g.indexOf(" "+e.Description+" ",o)}}for(var h=0;h<g.length-3;h++){if(g.substring(h,h+1).match("\\d")){if(g.substring(h+1,h+2)==" "&&g.substring(h+2,h+3).match("\\d+")){g=g.substring(0,h+1)+g.substring(h+2)}}}var q=new StringTokenizer();q.setString(new IDVariant(g),new IDVariant(" "));while(q.hasNext()){var a=new VoiceWord();var u=q.next().stringValue();if(u.length>0){a.Word=u.replace("\\p{Punct}","");for(var h=0;h<this.LanguageTokens.Count();h++){var j=this.LanguageTokens.Get(h);if(j.Word.toLowerCase()==a.Word.toLowerCase()){this.MainFrm.DTTObj.AddParameter("","","language token",j.Word);a.LanguageToken=true;break}}m.Add(a)}}var t=0;var d=null;for(var h=0;h<this.ComRecList.Count();h++){var r=this.ComRecList.Get(h);var f=r.EvaluateCommand(this.MainFrm,m);if(f>t){t=f;d=r}}if(d!=null){if(t<0.4){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1001,"VoiceHandler.Matching","Score too low");this.MainFrm.DTTObj.AddParameter("","","Score: ",t);return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)}return d.ExecuteCommand(this.MainFrm)}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1002,"VoiceHandler.Matching","Command not recognized");return this.MainFrm.RTCObj.GetConst("B8F316D0-A8C1-408e-978A-B097F9D9DECA","Mi dispiace, non ho capito.",false)};VoiceHandler.prototype.FindIndeObjByGuid=function(b){var e=this.objMap.keys();for(var c=0;c<e.length;c++){var a=e[c];var d=this.objMap[a];if(d.GUID==b){return d}}return null};VoiceHandler.prototype.FindIndeObjByType=function(d){var f=new ArrayList();var e=this.objMap.keys();for(var b=0;b<e.length;b++){var a=e[b];var c=this.objMap[a];if(c.Type==d){f.Add(c)}}return f};VoiceHandler.prototype.FindOnScreen=function(e){var b=new ArrayList();var h=this.GetActiveForms(this.MainFrm);for(var a=0;a<h.Count();a++){var g=h.Get(a);for(var d=1;d<g.Frames.length;d++){var c=g.Frames[d].Content;if(c==null||!c.Visible||c.Collapsed||!c.Exposed()){continue}switch(e){case VoiceHandler.OT_PANEL:if(c instanceof IDPanelSrv){b.Add(c)}break;case VoiceHandler.OT_BOOK:if(c instanceof OBookSrv){b.Add(c)}break}}}return b};VoiceHandler.prototype.FindInCustomData=function(d){var f=new ArrayList();var e=this.objMap.keys();for(var b=0;b<e.length;b++){var a=e[b];var c=this.objMap[a];if(c.CustomData!=null&&c.CustomData==d){f.Add(c)}}return f};VoiceHandler.FindField=function(d,v,a){var w=-1;var y=0;var b=d.Fields;var m=d.ActualPosition();var h=d.AttR;if(d.IsShowingGrouping()){d.set_SelectedRow(0)}d.DisableNotification=true;for(var x=0;x<2;x++){var t=1;var o=d.Queries[0].RecordCount();for(var g=m+1;t<=o;t++,g=(g%o)+1){d.set_ActualPosition(g);var q=new ArrayList();for(var s=0;s<b.length;s++){var e=b[s];if(e.IdxPanel<0||e.DataType==Glb.DT_DOC_OLE||!e.IsVisible(d.AttR,false)){continue}if((d.VS.Flags(e.VisualStyle)&Glb.FL_VIS_PASSWORD)!=0){continue}if(x==0&&(e.Flags&Glb.FLD_ISDESCR)==0){continue}var l=this.TokenizeString(e.bValues(d.AttR).Value.stringValue().toLowerCase());q.AddRange(l)}usedValueWords=new HashTableSrv();this.MatchWordList(q,v,usedValueWords);var u=usedValueWords.count()/this.NotLanguageTokens(v);if(u>y){a.clear();var f=usedValueWords.keys();for(var p=0;p<f.length;p++){a[f[p]]=usedValueWords[f[p]]}y=u;w=g}}if(y==1){break}}d.set_ActualPosition(m-h);d.Parent.FocusPriority=0;d.set_ActualPosition(m);if(d.IsShowingGrouping()){d.set_SelectedRow(h)}var c=new ArrayList();c.Add(w);c.Add(y);return c};VoiceHandler.FindFieldsForSelection=function(c,p,s){var v=new ArrayList();var o=c.Fields;var l=c.ActualPosition();var f=c.AttR;if(c.IsShowingGrouping()){c.set_SelectedRow(0)}c.DisableNotification=true;var m=1;var b=c.Queries[0].RecordCount();for(var a=l+1;m<=b;m++,a=(a%b)+1){c.set_ActualPosition(a);var t=new ArrayList();for(var h=0;h<o.length;h++){var e=o[h];if(e.IdxPanel<0||e.DataType==Glb.DT_DOC_OLE||!e.IsVisible(c.AttR,false)){continue}if((c.VS.Flags(e.VisualStyle)&Glb.FL_VIS_PASSWORD)!=0){continue}if((e.Flags&Glb.FLD_ISDESCR)==0){continue}var q=this.TokenizeString(e.bValues(c.AttR).Value.stringValue().toLowerCase());t.AddRange(q)}var d=new HashTableSrv();this.MatchWordList(t,p,d);if(d.count()>0){v.Add(a);var u=d.keys();for(var g=0;g<u.length;g++){s[u[g]]=d[u[g]]}}}c.set_ActualPosition(l-f);c.Parent.FocusPriority=0;c.set_ActualPosition(l);if(c.IsShowingGrouping()){c.set_SelectedRow(f)}return v};VoiceHandler.prototype.FindIndeObjChildren=function(j,h,f){var d=new ArrayList();var l=this.objMap.keys();for(var e=0;e<l.length;e++){var c=l[e];var a=this.objMap[c];if(a.Type==f){var b=a.ParentGuid;var g=this.FindIndeObjByGuid(b);while(g!=null){if(g.Type==h&&b.equals(j)){d.Add(a);break}else{g=this.FindIndeObjByGuid(g.ParentGuid)}}}}return d};VoiceHandler.TokenizeString=function(c){var d=new ArrayList();var e=new StringTokenizer();e.setString(new IDVariant(c),new IDVariant(" "));while(e.hasNext()){var b=e.next().stringValue();b=b.replace("\\p{Punct}","");var a=new VoiceWord();a.Word=b;d.Add(a)}return d};VoiceHandler.NotLanguageTokens=function(b){var d=0;for(var a=0;a<b.length;a++){var c=b.Get(a);if(!c.LanguageToken){d++}}return d};VoiceHandler.prototype.IsLanguageToken=function(c){for(var b=0;b<this.LanguageTokens.Count();b++){var a=this.LanguageTokens.Get(b);if(a.isEqual(c)>0){return true}}return false};VoiceHandler.MatchWordList=function(g,b,a){var h=0;for(var e=0;e<g.length;e++){var f=g.Get(e);if(f.LanguageToken){continue}for(var d=0;d<b.length;d++){var c=b.Get(d);if(c.LanguageToken){continue}var k=f.isEqual(c);if(k>0){h=f.Weight;if(a!=null){a[c.Word]=h}}}}};VoiceHandler.MatchDeleteWordList=function(h,g){var k=0;for(var d=0;d<h.length;d++){var b=h.Get(d);if(b.LanguageToken){continue}var e=0;while(e<g.Count()){var a=g.Get(e);if(a.LanguageToken){e++;continue}var f=b.isEqual(a);if(f>0){g.remove(e);k++}else{e++}}}return k};VoiceHandler.TestInsert=function(l,F,q,e,o){var E=0;var B=new ArrayList();var u=new ArrayList();for(var y=0;y<q.Count();y++){var A=q.Get(y);var a=this.TokenizeString(A.Name);var G=this.TokenizeString(A.Description);for(var x=0;x<F.Count();x++){var D=F[x];if(e[D.Word]==null){if(D.isEqual(a.Get(0))>0.5){var z=1;var k=F.Count();while(z<a.Count()){if((x+z>=k)||a.Get(z).isEqual(F[x+z])==0||e[F.Get(x+z).Word]!=null){break}z++}if(z==a.Count()){B.Add(x);x+=z;u.Add(A);for(z=0;z<a.Count();z++){e[a.Get(z).Word.toLowerCase()]=1}E++;break}}else{var m=false;for(var z=0;z<G.Count();z++){if(D.isEqual(G.Get(z))==1){B.Add(x);x++;u.Add(A);e[G.Get(z).Word.toLowerCase()]=1;E++;m=true;break}}if(m){break}}}}}if(B.Count()>0){var p=0;var d=0;for(d=B.Count()-1;d>=0;d--){if(B.Get(d)>=p){p=B.Get(d);break}}if(d<0){d=0}var t=this.TokenizeString(u[d].Name.trim()).Count();if(F.Count()==p+t){var c=0;for(var y=0;y<B.Count();y++){var A=u.Get(y);var b=B.Get(y);var v=new ArrayList();for(var x=c;x<b;x++){v.Add(F[x])}if(A.Obj!=null&&v.Get(v.Count()-1).LanguageToken){v.RemoveAt(v.Count()-1)}var g=new ArrayList();g.Add(A);VoiceParameter.checkParametersText(l,v,g,e,o);var a=this.TokenizeString(A.Name);c=B.Get(y)+a.Count()}}else{for(var y=0;y<B.Count();y++){var A=u.Get(y);var a=this.TokenizeString(A.Name);var c=B.Get(y)+a.Count();var b=0;if(y+1>=B.Count()){b=F.Count()}else{b=B.Get(y+1)}var v=new ArrayList();for(var x=c;x<b;x++){v.Add(F[x])}if(A.Obj!=null&&v.Get(v.Count()-1).LanguageToken){v.RemoveAt(v.Count()-1)}var g=new ArrayList();g.Add(A);VoiceParameter.checkParametersText(l,v,g,e,o)}var s=0;var C=B.Get(0);if(C>0){var v=new ArrayList();for(var x=s;x<C;x++){v.Add(F.Get(x))}if(NotLanguageTokens(v)>0){for(var y=0;y<q.Count();y++){var A=q.Get(y);if(A.Descriptive&&A.text.Count()==0){g=new ArrayList();g.Add(A);var r=VoiceParameter.checkParametersText(l,v,g,e,o);s=r}}}}}}return E};VoiceHandler.CheckFieldsName=function(d,x,l,b,g){var v=0;var t=new ArrayList();var m=new ArrayList();for(var q=0;q<l.Count();q++){var s=l.Get(q);var a=this.TokenizeString(s.Name);var y=this.TokenizeString(s.Description);for(var p=0;p<x.Count();p++){var u=x.Get(p);if(b[u.Word]==null){if(u.isEqual(a.Get(0))>0.5){var r=1;var c=x.Count();while(r<a.Count()){if((p+r>=c)||a.Get(r).isEqual(x.Get(p+r))==0||b[x.Get(p+r).Word]!=null){break}r++}if(r==a.Count()){t.Add(q);m.Add(s);for(r=0;r<a.Count();r++){b[a.Get(r).Word.toLowerCase()]=1}v++;for(var o=0;o<r;o++){x.remove(p)}break}}else{var e=false;for(var r=0;r<y.Count();r++){if(u.isEqual(y.Get(r))==1){t.Add(p);m.Add(s);b[y.Get(r).Word.toLowerCase()]=1;v++;e=true;x.remove(p);break}}if(e){break}}}}}return m};VoiceHandler.prototype.GetActiveForms=function(l){var h=new ArrayList();var c=this.MainFrm.ActiveForm();if(c!=null){h.Add(c)}if(this.MainFrm.UseZones()){var b=this.MainFrm.screenZones;for(var d=0;d<b.Count();d++){var k=b.Get(d);var m=k.SelectedForm();var a=k.GetForms();for(var e=0;e<a.length;e++){var g=a.get_Object(new IDVariant(e));if(g.FormIdx==m&&g.Visible){h.Add(g);break}}}}else{for(var e=0;e<this.MainFrm.StackForm.length;e++){var g=this.MainFrm.StackForm[e];if(g.Docked){h.Add(g)}}}return h};VoiceHandler.prototype.GetRD3Ident=function(){return this.GetRD3Name()};VoiceHandler.prototype.GetRD3Name=function(){return"voice"};VoiceHandler.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};VoiceHandler.prototype.RD3RenderDifferences=function(b,e){var d=null;if(e){d=b.AddNewElement(this.GetRD3Name())}if(d==null&&this.RD3Changed){d=b.AddNewElement("chg")}if(d!=null){d.SetAttribute("id",this.GetRD3Ident())}var c=this.RD3Changed;if(e||this.RD3Changed){for(var a=0;a<this.RD3PropChg.length;a++){if(this.RD3PropChg[a]||e){this.SetRD3Property(a,d,e)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(e){if(this.MainFrm.ParamsObj().EnableVoice){d.SetAttribute("ena","1")}}return c};VoiceHandler.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.VOICE_LISTENING:if(this.iListening==false&&b){break}c.SetAttribute("lst",this.iListening?"1":"0");break;case RD3Glb.VOICE_RESPONSE:if(this.iResponse.length==0&&b){break}c.SetAttribute("rsp",this.iResponse);break;case RD3Glb.VOICE_SAY:if(this.iSay.length==0&&b){break}c.SetAttribute("say",this.iSay);break}};function VoiceCommand(){this.Index;this.Name="";this.Description="";this.Synonyms=new ArrayList();this.Param=null}VoiceCommand.prototype.Init=function(c){var a=c.GetNextNode();while(a!=null){var b=new VoiceCommandSyn();b.Init(a);this.Synonyms.Add(b);a=c.GetNextNode()}};VoiceCommand.prototype.Reset=function(){this.Param=null};VoiceCommand.prototype.Match=function(h,d,g){var k=0;var f=null;var a=null;for(var e=0;e<this.Synonyms.Count();e++){var b=this.Synonyms.Get(e);var j=new ArrayList();var c=b.Match(h,d,j);if(c>k){k=c;f=j}a=j}if(f!=null){g.Clear();g.AddRange(f)}else{if(a!=null){g.Clear();g.AddRange(a)}}return k};function VoiceCommandRecognizer(){this.CommandList=new ArrayList()}VoiceCommandRecognizer.prototype.EvaluateCommand=function(a,b){for(var d=0;d<this.CommandList.Count();d++){var c=this.CommandList.Get(d);c.Reset()}return 0};VoiceCommandRecognizer.prototype.ExecuteCommand=function(a){return""};VoiceCommandRecognizer.prototype.Init=function(c){var d=c.GetNextNode();var a=0;while(d!=null){var b=this.CommandList.Get(a);b.Name=d.GetAttribute("tag");b.Description=d.GetAttribute("text");b.Init(d);a++;d=c.GetNextNode()}};function VoiceCommandSyn(){this.WordsGroup=new ArrayList()}VoiceCommandSyn.prototype.Init=function(g){var h=g.GetNextNode();while(h!=null){var d=new StringTokenizer();d.setString(new IDVariant(h.Value()),new IDVariant(";"));while(d.hasNext()){var b=d.next().stringValue();b=b.replace("{","").replace("}","");var a=new VoiceWordList();var f=new StringTokenizer();f.setString(new IDVariant(b),new IDVariant(","));while(f.hasNext()){var c=f.next().stringValue().trim();if(c=="*"){a.optional=true}else{var e=new VoiceWord(c);a.WList.Add(e)}}this.WordsGroup.Add(a);h=g.GetNextNode()}}};VoiceCommandSyn.prototype.Match=function(m,c,a){var g=false;var b=0;var q=new Array(this.WordsGroup.Count());for(var e=0;e<c.Count();e++){var p=c.Get(e);if(p.LanguageToken){a.Add(p);continue}var r=false;for(var f=0;f<this.WordsGroup.Count();f++){if(!q[f]){var l=this.WordsGroup.Get(f);for(var d=0;d<l.WList.Count();d++){var o=l.WList.Get(d);if(p.isEqual(o)>0){if(!g&&f==0){g=true;a.Clear()}m.DTTObj.AddParameter("","",'"'+p.Word+'"',1);b+=1;q[f]=true;r=true;break}}if(q[f]){break}}}if(!r){m.DTTObj.AddParameter("","",'"'+p.Word+'"',0);a.Add(p)}}var h=this.WordsGroup.Count();for(var f=0;f<q.length;f++){if(!q[f]){if(!this.WordsGroup.Get(f).optional){b=0;break}else{h--}}}if(h>0){b=b/h}m.DTTObj.AddParameter("","","synonym score",b);return b};function VoiceIndeObj(){this.GUID="";this.Name="";this.Type=0;this.ParentGuid="";this.CustomData="";this.Children=new ArrayList();this.Words=new ArrayList()}function VoiceParameter(){this.Obj=null;this.Name="";this.Description="";this.Type=-1;this.Length=-1;this.Descriptive=false;this.text=new ArrayList()}VoiceParameter.checkFieldsText=function(h,g,t,F,o){var b=0;var p=new Array(t.Count());for(var z=0;z<t.Count();z++){var A=t.Get(z);var c=A.Length;while(b<g.Count()){var s=g.Get(b);if((A.Type==Glb.DT_DATE||A.Type==Glb.DT_DATETIME)){var E=new IDVariant();var u=new ArrayList(g.subList(b,g.size()));var d=u.size();if(A.Type==Glb.DT_DATETIME){E=this.CheckDateTime(h,u,true,o)}else{if(A.Type==Glb.DT_DATE){E=this.CheckDateTime(h,u,false,o)}}if(E.Type!=IDVariant.NULL){var r=d-u.Count();var l=new VoiceWord();l.Word=E.stringValue();A.text.Add(l);for(var x=0;x<r;x++){F[g.Get(b+x).Word]=1}p[z]=true;b+=r}break}if(A.Obj!=null){var C=A.Obj;if(C.ValueList.length>0){for(var y=0;y<C.ValueList.length;y++){var l=C.ValueList.get(y);if(l.Name.toLowerCase()==s.Word){var B=new VoiceWord();B.Word=l.Value.stringValue();A.text.Add(B);b++;F[s.Word]=1;p[z]=true;break}}}else{if((C.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(C.QueryValueSource!=null&&C.QueryValueSource.RS!=null){try{var m=false;C.QueryValueSource.RS.MoveFirst();while(!C.QueryValueSource.RS.EOF()){var a=C.QueryValueSource.RS.Get(1);var q=C.QueryValueSource.RS.Get(C.QueryValueSource.DecodeColumn>0?C.QueryValueSource.DecodeColumn:C.QueryValueSource.RS.GetNumFields());if(q.stringValue().toLowerCase()==s.Word){var B=new VoiceWord();B.Word=a.stringValue();A.text.Add(B);b++;F[s.Word]=1;p[z]=true;m=true;break}C.QueryValueSource.RS.MoveNext()}if(m){break}}catch(D){}}}}}if((A.Type==Glb.DT_NUM_CURRENCY||A.Type==Glb.DT_NUM_FIXED||A.Type==Glb.DT_NUM_FLOAT||A.Type==Glb.DT_NUM_INTEGER)){if(s.Word.match("\\d+")){A.text.Add(s);b++;F[s.Word]=1;p[z]=true;break}break}c-=s.Word.length;if(A.Obj!=null&&c<0){break}A.text.Add(s);b++;F[s.Word]=1;p[z]=true}if(F.count()==g.Count()){break}}var G=0;for(var y=0;y<p.length;y++){if(p[y]){G++}}return G};VoiceParameter.checkParametersText=function(h,g,s,D,m){var o=0;var b=0;for(var x=0;x<s.Count();x++){var y=s.Get(x);var c=y.Length;while(b<g.Count()){var r=g.Get(b);if((y.Type==Glb.DT_DATE||y.Type==Glb.DT_DATETIME)){var C=new IDVariant();var t=new ArrayList(g.subList(b,g.Count()));var d=t.Count();if(y.Type==Glb.DT_DATETIME){C=CheckDateTime(h,t,true,m)}else{if(y.Type==Glb.DT_DATE){C=CheckDateTime(h,t,false,m)}}if(C.Type!=IDVariant.NULL){var q=d-t.Count();var j=new VoiceWord();j.Word=C.stringValue();y.text.Add(j);for(var u=0;u<q;u++){D[g.Get(b+u).Word]=1}o++;for(var u=0;u<q;u++){g.Remove(b)}}break}if(y.Obj!=null){var A=y.Obj;if(A.ValueList.length>0){var l=false;for(var u=0;u<A.ValueList.length;u++){var j=A.ValueList.get(u);if(j.Name.toLowerCase()==r.Word){var z=new VoiceWord();z.Word=j.Value.stringValue();y.text.Add(z);D[r.Word]=1;o++;g.Remove(b);l=true;break}}if(l){break}}else{if((A.Flags&Glb.FLD_AUTOLOOKUP)!=0){if(A.QueryValueSource!=null&&A.QueryValueSource.RS!=null){try{var l=false;A.QueryValueSource.RS.MoveFirst();while(!A.QueryValueSource.RS.EOF()){var a=A.QueryValueSource.RS.Get(1);var p=A.QueryValueSource.RS.Get(A.QueryValueSource.DecodeColumn>0?A.QueryValueSource.DecodeColumn:A.QueryValueSource.RS.GetNumFields());if(p.stringValue().toLowerCase()==r.Word){var z=new VoiceWord();z.Word=a.stringValue();y.text.Add(z);D[r.Word]=1;o++;g.Remove(b);l=true;break}A.QueryValueSource.RS.MoveNext()}if(l){break}}catch(B){}}}else{if(A.IdxPanel>0){y.text.Add(r);D[r.Word]=1;o++;g.Remove(b);break}}}}if((y.Type==Glb.DT_NUM_CURRENCY||y.Type==Glb.DT_NUM_FIXED||y.Type==Glb.DT_NUM_FLOAT||y.Type==Glb.DT_NUM_INTEGER)){if(r.Word.match("\\d+")){y.text.Add(r);D[r.Word]=1;o++;g.Remove(b);break}break}if(y.Obj!=null){c-=r.Word.length;if(c<0){break}}y.text.Add(r);D[r.Word]=1;o++;g.RemoveAt(b)}if(D.count()==g.Count()){break}}return o};VoiceParameter.CheckDateTime=function(r,l,B,y){var O=0;var M=new IDVariant();var J=0;var L="";var H=-1;var C=0;if(l.Count()>2){L=l.Get(0).Word+" "+l.Get(1).Word+" "+l.Get(2).Word}else{if(l.Count()>1){L=l.Get(0).Word+" "+l.Get(1).Word}else{L=l.Get(0).Word}}try{if(r!=null){var P=new RegExp("^(\\d{1,2}) (\\d{1,2}) (\\d{4})$").exec(L);if(P!=null){var N=P[1];var I=P[2];var z=P[3];M=IDL.ToDate(new IDVariant(z),new IDVariant(I),new IDVariant(N));if(M.Type!=IDVariant.NULL){J=3}}if(M.Type==IDVariant.NULL){var p=r.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");P=new RegExp("^(\\d{1,2}) ([a-zA-Z]{3,}) (\\d{4})$").exec(L);if(P!=null){var N=P[1];var o=P[2];var z=P[3];for(var G=0;G<p.length;G++){if(o.toLowerCase()==p[G].toLowerCase()){M=IDL.ToDate(new IDVariant(z),new IDVariant(G+1),new IDVariant(N));J=3;break}}}if(M.Type==IDVariant.NULL){if(L.toLowerCase()==r.RTCObj.GetConst("C0D8B22A-5086-46d7-883A-A42D82EB990C","Oggi a pranzo",false).toLowerCase()){M=IDL.Today();H=13}else{if(L.toLowerCase()==r.RTCObj.GetConst("077367FC-69A2-4472-859C-FD3F07466C6D","Domani a pranzo",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=13}else{if(L.toLowerCase()==r.RTCObj.GetConst("290B93C4-7283-408f-9660-072111AC9165","Ieri a pranzo",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=13}else{if(L.toLowerCase()==r.RTCObj.GetConst("9E621F0E-B5B7-4192-AB30-E8A28915DA43","Oggi a cena",false).toLowerCase()){M=IDL.Today();H=19}else{if(L.toLowerCase()==r.RTCObj.GetConst("66FCDFFC-C464-4f2f-978D-6D4C9B307A49","Domani a cena",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=19}else{if(L.toLowerCase()==r.RTCObj.GetConst("82DD9B5A-B5B7-4f6a-8B8A-5FABE0FE6E2B","Ieri a cena",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=19}}}}}}if(M.Type!=IDVariant.NULL){J=3}}}if(M.Type==IDVariant.NULL&&l.size()>1){L=l.Get(0).Word+" "+l.Get(1).Word;var p=r.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");P=new RegExp("^(\\d{1,2}) ([a-zA-Z]{3,})$").exec(L);if(P!=null){var N=P[1];var o=P[2];for(var G=0;G<p.length;G++){if(o.toLowerCase()==p[G].toLowerCase()){M=IDL.ToDate(IDL.Year(IDL.Today()),new IDVariant(G+1),new IDVariant(N));J=2}}}if(M.Type==IDVariant.NULL&&l.size()>1){if(L.toLowerCase()==r.RTCObj.GetConst("BAE43B12-D843-46f4-9F60-31FC7974347F","Domani mattina",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());H=9}else{if(L.toLowerCase()==r.RTCObj.GetConst("BE25E89E-3F76-4cd4-9BC9-8D059C9945B3","Domani pomeriggio",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());H=16}else{if(L.toLowerCase()==r.RTCObj.GetConst("0E538D26-6318-4dc5-869E-A5166C8B13B5","Domani sera",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());H=20}else{if(L.toLowerCase()==r.RTCObj.GetConst("441631F4-4B94-48ca-8FE1-767CF43007EA","Ieri mattina",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=9}else{if(L.toLowerCase()==r.RTCObj.GetConst("E4914180-83F9-4895-BA68-B37CFA60976BYester","Ieri pomeriggio",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=16}else{if(L.toLowerCase()==r.RTCObj.GetConst("E394214C-EC9E-47cf-B143-9E67162A0A67","Ieri sera",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=20}else{if(L.toLowerCase()==r.RTCObj.GetConst("AAA0F015-FE06-44b1-9039-6C5658824BF0","Oggi pomeriggio",false).toLowerCase()){M=IDL.Today();H=16}}}}}}}if(M.Type!=IDVariant.NULL){J=2}}}if(M.Type==IDVariant.NULL&&y){P=new RegExp("^([a-zA-Z]{3,}) (\\d{4})$").exec(L);if(P!=null){var a=P[1];var z=P[2];var p=r.RTCObj.GetConst("6C93863C-7064-4b28-B645-C9090C3F499F","gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre",false).split(";");var f=r.RTCObj.GetConst("FC8AF728-7517-4b68-B213-80CAE61F3D90","gen;feb;mar;apr;mag;giu;lug;ago;set;ott;nov;dic",false).split(";");for(var G=0;G<p.length;G++){if(a.toLowerCase()==p[G].toLowerCase()){M=new IDVariant(f[G]+" "+z);for(var E=0;E<O;E++){if(l.Count()<=0){break}l.Remove(0)}return M}}}}if(M.Type==IDVariant.NULL){L=l.Get(0).Word;if(L.toLowerCase()==r.RTCObj.GetConst("982BE4E3-A288-4AD4-A4D6-426F4E62BEDB","Oggi",false).toLowerCase()){M=IDL.Today()}else{if(L.toLowerCase()==r.RTCObj.GetConst("A4E7F53D-043D-435F-8089-E1C6495A13B0","Domani",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today())}else{if(L.toLowerCase()==r.RTCObj.GetConst("8052BA86-1C6A-4268-BABA-28CA9E6F94E7","Ieri",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today())}else{if(L.toLowerCase()==r.RTCObj.GetConst("8F8B2466-F044-421a-936D-839548839BE8","Domattina",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=9}else{if(L.toLowerCase()==r.RTCObj.GetConst("C34E97EA-C397-4673-8C15-0156997D887C","Stasera",false).toLowerCase()){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(-1),IDL.Today());H=20}}}}}if(M.Type!=IDVariant.NULL){J=1}}if(M.Type==IDVariant.NULL){var g=r.RTCObj.GetConst("88A4709F-64ED-440f-A757-B24F3FD844B5","lunedì;martedì;mercoledì;giovedì;venerdì;sabato;domenica",false).split(";");for(var G=0;G<g.length;G++){if(L.toLowerCase()==g[G].toLowerCase()){var q=(G+1)%7+1;M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),IDL.Today());while(IDL.WeekDay(M).intValue()!=q){M=IDL.DateAdd(new IDVariant("d"),new IDVariant(1),M)}J=1}}}if(M.Type==IDVariant.NULL&&y){P=new RegExp("^\\d{4}$").exec(L);if(P!=null){M=new IDVariant(L)}for(var E=0;E<O;E++){if(l.Count()<=0){break}l.Remove(0)}return M}}}catch(K){}C=0;var F=J;if(M.Type!=IDVariant.NULL){O=J;if(B){var c=7;while(F<c&&l.Count()>F){var x=l.Get(F).Word;if(x.match("\\d+")){var A=Integer.parseInt(x);if(H==-1&&(A>0&&A<25)){H=A;if(c+3<7){c+=3}}else{if(H>-1){if(A>0&&A<60){C=Integer.parseInt(x)}break}}}else{if(H>-1){var D=r.RTCObj.GetConst("02E6E6DB-A8AC-4B61-BE3D-9BE0BF43F136","mezza;mezzo",false).split(";");if(x.toLowerCase()==D[0].toLowerCase()||x.toLowerCase()==D[1].toLowerCase()){C=30}else{if(x.toLowerCase()==r.RTCObj.GetConst("1915FE8C-5502-4E12-A4DA-3DD44671FE12","quarto",false).toLowerCase()){C=15}}}else{var b=r.RTCObj.GetConst("71F53B7F-A10B-4d0c-AE44-147652F0B521","mattina;mattino",false).split(";");if(b[0]=="."||x.toLowerCase()==b[0].toLowerCase()||x.toLowerCase()==b[1].toLowerCase()||x.toLowerCase()==r.RTCObj.GetConst("6B6CAD7E-F5C8-4dc5-8748-6D81663E3623","notte",false).toLowerCase()){H=9}else{if(x.toLowerCase()==r.RTCObj.GetConst("24C7769D-63BF-4745-99DA-3EDF71DD3492","Mezzogiorno",false).toLowerCase()){H=12}else{if(x.toLowerCase()==r.RTCObj.GetConst("E5CCDBF5-52F0-4FDD-AC2B-4CC7BDC94045","Mezzanotte",false).toLowerCase()){H=0}else{if(x.toLowerCase()==r.RTCObj.GetConst("0E263FC9-6C43-4908-A989-A00DCE0DD8CF","Pranzo",false).toLowerCase()){H=13}else{if(x.toLowerCase()==r.RTCObj.GetConst("5CC2D3D5-146D-47cd-9D3E-2DE5734F9926","Cena",false).toLowerCase()==0){H=19}}}}}}}F++}}}if(H>-1){if(H>=1&&H<=5){var u=false;for(var E=0;E<l.Count();E++){var D=r.RTCObj.GetConst("71F53B7F-A10B-4d0c-AE44-147652F0B521","mattina;mattino",false).split(";");var v=l.Get(E).Word;if(D[0]=="."||v.toLowerCase()==D[0].toLowerCase()||v.toLowerCase()==D[1].toLowerCase()||v.toLowerCase()==r.RTCObj.GetConst("6B6CAD7E-F5C8-4dc5-8748-6D81663E3623","notte",false).toLowerCase()){if(E>F){F=E}u=true;break}}if(!u){H+=12}}else{var u=false;for(var E=F+1;E<l.Count();E++){var v=l.Get(E).Word;if(v.toLowerCase()==r.RTCObj.GetConst("F638DEAE-25A4-4137-8085-77CD8D65D2DE","pomeriggio",false).toLowerCase()||v.toLowerCase()==r.RTCObj.GetConst("91C4A319-E729-42a3-AD77-D16C45515E3F","sera",false).toLowerCase()){if(E>F){F=E}u=true;break}}if(u){H+=12}}M=IDL.DateTimeEx(IDL.Year(M),IDL.Month(M),IDL.Day(M),new IDVariant(H),new IDVariant(C),new IDVariant(0));O+=F}for(var E=0;E<O;E++){if(l.Count()<=0){break}l.Remove(0)}return M};VoiceParameter.checkValueListFields=function(q,d,h,p){var a=0;var s=new ArrayList();s.AddRange(d);for(var g=0;g<h.Count();g++){var o=h.Get(g);var k=o.Obj;if(k.ValueList.length>0){for(var e=0;e<k.ValueList.length;e++){var t=false;var r=k.ValueList.get(e);var c=r.Name.toLowerCase();var g=0;while(g<s.Count()){var m=s.Get(g);var b=m.Word.toLowerCase();var l=2;while(b.length>3){if(c.contains(b)){o.text.Add(new VoiceWord(b));p[m.Word]=1;s.Remove(g);a++;t=true;break}b=b.substring(0,b.length-l);l++}if(t){break}g++}if(t){e=0}}}}return a};function VoiceRecognizerAction(){VoiceCommandRecognizer.call(this);this.bestCmd=null;for(var a=0;a<28;a++){var b=new VoiceCommand();b.Index=a;this.CommandList.Add(b)}}VoiceRecognizerAction.prototype=new VoiceCommandRecognizer();VoiceRecognizerAction.VRA_LOCK=0;VoiceRecognizerAction.VRA_UNLOCK=1;VoiceRecognizerAction.VRA_DUPLICATE=2;VoiceRecognizerAction.VRA_DELETE=3;VoiceRecognizerAction.VRA_SAVE=4;VoiceRecognizerAction.VRA_CANCEL=5;VoiceRecognizerAction.VRA_REFRESH=6;VoiceRecognizerAction.VRA_EXPORT=7;VoiceRecognizerAction.VRA_PRINT=8;VoiceRecognizerAction.VRA_CANCELSELECTION=9;VoiceRecognizerAction.VRA_SELECTALL=10;VoiceRecognizerAction.VRA_REVERTSELECTION=11;VoiceRecognizerAction.VRA_INSERT=12;VoiceRecognizerAction.VRA_WRITE=13;VoiceRecognizerAction.VRA_DUPLICATEROW=14;VoiceRecognizerAction.VRA_DELETEROW=15;VoiceRecognizerAction.VRA_SELECT=16;VoiceRecognizerAction.VRA_RUN=17;VoiceRecognizerAction.VRA_FIND=18;VoiceRecognizerAction.VRA_CLOSE=19;VoiceRecognizerAction.VRA_CLOSEALL=20;VoiceRecognizerAction.VRA_OPEN=21;VoiceRecognizerAction.VRA_STOP=22;VoiceRecognizerAction.VRA_FINDBOOK=23;VoiceRecognizerAction.VRA_READ=24;VoiceRecognizerAction.VRA_COUNT=25;VoiceRecognizerAction.VRA_READBOOK=26;VoiceRecognizerAction.VRA_DELETEFIELD=27;VoiceRecognizerAction.prototype.EvaluateCommand=function(a,d){VoiceCommandRecognizer.prototype.EvaluateCommand.call(this,a,d);var e=0;var f=0;var c=0;for(;c<12;c++){e=this.EvaluatePanelCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}var b=c+2;for(;c<b;c++){e=this.EvaluateInsertCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}b=c+2;for(;c<b;c++){e=this.EvaluateRowCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateSelectCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateRunCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateFindCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;b=c+2;for(;c<b;c++){e=this.EvaluateCloseCommands(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateOpenCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateStopCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateGoToSectionBookCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateReadCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateCountCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateReadBookCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}c++;e=this.EvaluateDeleteFieldCommand(a,d,this.CommandList.Get(c));if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}if(this.bestCmd!=null){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1080,"VoiceRecognizerAction.EvaluateCommand",'VoiceRecognizerAction: the best command is "'+this.bestCmd.Name+'"');a.DTTObj.AddParameter("","","score",f)}return f};VoiceRecognizerAction.prototype.EvaluatePanelCommands=function(h,x,e){h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1081,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": evaluate command.");var z=new ArrayList();var u=e.Match(h,x,z);h.DTTObj.AddParameter("","","command score",u);if(u>0){var d=h.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1082,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+d.Count()+" panels found on screen.");for(var r=0;r<d.Count();r++){h.DTTObj.AddParameter("","","panel",(d.Get(r)).GetDTTCaption())}var t=0;while(t<d.Count()){var m=d.Get(t);var a=false;if(m.Queries[0]!=null&&m.Queries[0].IsDO){if(m.Queries[0].IDColl!=null){a=m.Queries[0].IDColl.IsModified()}else{var g=m.GetDocument();if(g!=null){a=g.IsModified()}}}var o=(m.Status()==Glb.PS_DATA)&&(h.ParamsObj().AllowMasterPanelNav||!m.Queries[0].IsMasterDO||!a);var q=false;if(e.Index!=VoiceRecognizerAction.VRA_CANCELSELECTION&&e.Index!=VoiceRecognizerAction.VRA_SELECTALL&&e.Index!=VoiceRecognizerAction.VRA_REVERTSELECTION&&!m.ShowToolbar){q=true}if(e.Index==VoiceRecognizerAction.VRA_LOCK&&(m.Locked()||!m.Lockable)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_UNLOCK&&(!m.Locked()||!m.Lockable||!m.CanBeUnlocked())){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_DUPLICATE&&(!m.IsCommandEnabled(Glb.PCM_DUPLICATE)||m.Locked()||m.Status()!=Glb.PS_DATA||(m.Flags&Glb.PAN_CANINSERT)==0)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_DELETE&&(!m.IsCommandEnabled(Glb.PCM_DELETE)||m.Locked()||m.Status()!=Glb.PS_DATA||(m.Flags&Glb.PAN_CANDELETE)==0)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_SAVE&&(!m.IsCommandEnabled(Glb.PAN_CANUPDATE)||m.Status()!=Glb.PS_UPDATE)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_CANCEL&&(!m.IsCommandEnabled(Glb.PCM_CANCEL)||m.Status()==Glb.PS_DATA)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_REFRESH&&(!m.IsCommandEnabled(Glb.PCM_REQUERY)||(m.Status()!=Glb.PS_UPDATE&&m.Status()!=Glb.PS_DATA)||(m.Queries[0].IsDO&&m.Queries[0].DocTempl==null))){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_EXPORT&&(!m.IsCommandEnabled(Glb.PCM_CSV)||!o||m.PanelMode!=Glb.PANEL_LIST)){q=true}else{if(e.Index==VoiceRecognizerAction.VRA_PRINT&&(!m.IsCommandEnabled(Glb.PCM_PRINT)||m.MyBook==null||!o)){q=true}else{if((e.Index==VoiceRecognizerAction.VRA_CANCELSELECTION||e.Index==VoiceRecognizerAction.VRA_REVERTSELECTION||e.Index==VoiceRecognizerAction.VRA_SELECTALL)&&(m.Status()!=Glb.PS_DATA||m.GetNumRows()<=0||!m.EnableMultipleSel())){q=true}}}}}}}}}}if(q){h.DTTObj.AddParameter("","","panel",(d.Get(t)).GetDTTCaption()+" (removed)");d.Remove(m)}else{h.DTTObj.AddParameter("","","panel",(d.Get(t)).GetDTTCaption());t++}}var c=null;var y=0;var l=false;for(t=0;t<d.Count();t++){var m=d.Get(t);if(VoiceHandler.NotLanguageTokens(z)==0){h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1083,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": no unknown words found.");if(m.HasFocus()){u=(u+1)/2;h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1084,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+m.GetDTTCaption()+" is the target panel");h.DTTObj.AddParameter("","","score",u);e.Param=m;return u}else{if(!l){c=m;l=true}else{c=null}}}else{h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1085,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": "+z.Count()+" unknown words found");for(var r=0;r<z.Count();r++){h.DTTObj.AddParameter("","","unknown word",z.Get(r).Word)}var v=h.VoiceObj.FindIndeObjByGuid(m.iGuid);var f=new HashTableSrv();VoiceHandler.MatchWordList(v.Words,z,f);var s=0;if(f.count()==0){if(d.Count()==1){s=1}else{if(m.HasFocus()){s=0.3}}}else{s=1}if(s==0){continue}var b=0;var k=f.keys();for(var r=0;r<k.length;r++){var A=k[r];b+=f[A]}b/=VoiceHandler.NotLanguageTokens(z);if(b>y){y=b;c=m}}}if(c!=null){u=(y+u)/2;h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1086,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+': the panel "'+c.GetDTTCaption()+'" is the target panel');h.DTTObj.AddParameter("","","score",u);e.Param=c;return u}h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1087,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+": no target panel found")}h.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1088,"VoiceRecognizerAction.EvaluatePanelCommands","Command "+e.Name+" is not the right command.");h.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateInsertCommand=function(q,L,d){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1089,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": evaluate command.");var O=new ArrayList();var H=d.Match(q,L,O);q.DTTObj.AddParameter("","","command score",H);if(H>0||(H==0&&d.Index==VoiceRecognizerAction.VRA_WRITE)){var b=q.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1090,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+b.Count()+" panels found on screen.");for(var E=0;E<b.Count();E++){q.DTTObj.AddParameter("","","panel",(b.Get(E)).GetDTTCaption())}var G=0;while(G<b.Count()){var y=b.Get(G);var z=false;if(d.Index==VoiceRecognizerAction.VRA_INSERT&&(!y.IsCommandEnabled(Glb.PCM_INSERT)||(y.Locked()&&!y.EnableInsertWhenLocked()&&(!y.Queries[0].IsDO||y.Queries[0].Document!=null||y.Queries[0].IDColl!=null))||(y.Status()!=Glb.PS_QBE&&y.Status()!=Glb.PS_DATA)||(y.Flags&Glb.PAN_CANINSERT)==0)){z=true}if(d.Index==VoiceRecognizerAction.VRA_WRITE&&(!y.IsCommandEnabled(Glb.PCM_UPDATE)||(y.Locked()&&!y.EnableInsertWhenLocked()&&(!y.Queries[0].IsDO||y.Queries[0].Document!=null||y.Queries[0].IDColl!=null))||(y.Status()!=Glb.PS_UPDATE&&y.Status()!=Glb.PS_DATA)||(y.Flags&Glb.PAN_CANUPDATE)==0)&&(!y.Lockable||!y.CanBeUnlocked())){z=true}if(z){q.DTTObj.AddParameter("","","panel",(b.Get(G)).GetDTTCaption()+" (removed)");b.Remove(y)}else{q.DTTObj.AddParameter("","","panel",(b.Get(G)).GetDTTCaption());G++}}var a=null;var B=new ArrayList();var N=0;var u=false;for(G=0;G<b.Count();G++){var y=b.Get(G);if(d.Index==VoiceRecognizerAction.VRA_WRITE&&VoiceHandler.NotLanguageTokens(O)==0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1131,"VoiceRecognizerAction.EvaluateInsertCommand","No text found");q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");return 0}if(VoiceHandler.NotLanguageTokens(O)==0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1091,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no unknown words found.");if(y.HasFocus()){H=(H+1)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1092,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+y.GetDTTCaption()+" is the target panel");q.DTTObj.AddParameter("","","score",H);var o=new ArrayList();o.add(0,y);d.Param=o;return H}else{if(!u){a=y;u=true}else{a=null}}}else{q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1093,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+O.Count()+" unknown words found");for(var E=0;E<O.Count();E++){q.DTTObj.AddParameter("","","unknown word",O.Get(E).Word)}var J=q.VoiceObj.FindIndeObjByGuid(y.iGuid);var m=new HashTableSrv();VoiceHandler.MatchWordList(J.Words,O,m);var F=0;if(m.count()==0){if(b.Count()==1||y.HasFocus()){F=1}}else{if(H==0){F=0}else{F=1}}if(F==0){continue}var x;if(d.Index==VoiceRecognizerAction.VRA_INSERT){x=this.GetFieldsArrayFromPanel(y,VoiceRecognizerAction.VRA_INSERT)}else{x=this.GetFieldsArrayFromPanel(y,VoiceRecognizerAction.VRA_WRITE)}var P=new HashTableSrv();var l=new ArrayList();l.AddRange(O);var M=0;while(M<l.Count()){var r=l.Get(M);if(m.containsKey(r.Word)){l.RemoveAt(M)}else{M++}}if(l.Count()>0&&l.Get(M-1).LanguageToken){l.removeAt(M-1)}var t=VoiceHandler.TestInsert(q,l,x,P,false);var D=new ArrayList();D.AddRange(O);if(t==0){F-=0.05;if(d.Index==VoiceRecognizerAction.VRA_INSERT){t=VoiceParameter.checkFieldsText(q,l,x,P,false)}else{if(d.Index==VoiceRecognizerAction.VRA_WRITE&&H>0){var e=new ArrayList();var h=new ArrayList();var g=y.FocusedColumn();for(var C=0;C<x.Count();C++){var I=x.Get(C);var K=I.Obj;if(g!=-1&&K==y.bFields(g)){e.Add(I)}if(I.Descriptive){h.Add(I)}}t=VoiceParameter.checkFieldsText(q,l,h,P,false);if(t==0){F-=0.05;t=VoiceParameter.checkFieldsText(q,l,e,P,false)}}}}var s=P.keys();for(var C=0;C<s.length;C++){m[s[C]]=P[s[C]]}var A=F*m.count()/VoiceHandler.NotLanguageTokens(O);if(A>N){N=A;a=y;B.Clear();B.AddRange(x)}}}if(a!=null){H=(N+H)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1094,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+': the panel "'+a.GetDTTCaption()+'" is the target panel');q.DTTObj.AddParameter("","","score",H);var Q=new ArrayList();Q.Add(a);Q.Add(B);d.Param=Q;return H}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1095,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no target panel found")}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateRowCommands=function(f,t,d){var u=-1;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1097,"VoiceRecognizerAction.EvaluateRowCommands","Command "+d.Name+": evaluate command.");var x=new ArrayList();var s=d.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1098,"VoiceRecognizerAction.EvaluateRowCommands","Command "+d.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1099,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+x.Count()+" unknown words found.");for(var q=0;q<x.Count();q++){f.DTTObj.AddParameter("","","Unknown word",x.Get(q).Word)}for(var q=0;q<x.Count();q++){var k=x.Get(q);if(!k.LanguageToken&&k.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1100,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": row number found: "+x.Get(q).Word);u=parseInt(k.Word);break}}if(u>0){var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1101,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var q=0;while(q<c.Count()){var h=c.Get(q);var l=false;if(h.Layout()==Glb.PANEL_FORM){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()<u){l=true}else{if(d.Index==VoiceRecognizerAction.VRA_DUPLICATEROW&&(!h.IsCommandEnabled(Glb.PCM_DUPLICATE)||h.Locked()||h.Status()!=Glb.PS_DATA||(h.Flags&Glb.PAN_CANINSERT)==0)){l=true}else{if(d.Index==VoiceRecognizerAction.VRA_DELETEROW&&(!h.IsCommandEnabled(Glb.PCM_DELETE)||h.Locked()||h.Status()!=Glb.PS_DATA||(h.Flags&Glb.PAN_CANDELETE)==0)){l=true}}}}}if(l){f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption()+" (removed)");c.Remove(h)}else{f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption());q++}}var v=0;var b=null;for(q=0;q<c.Count();q++){var h=c.Get(q);var a=f.VoiceObj.FindIndeObjByGuid(h.iGuid);var e=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,x,e);e.NumRow=1;var r=0;if(e.count()==0){if(c.Count()==1){r=1}else{if(h.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}var m=0;var g=e.keys();for(var p=0;p<g.length;p++){var y=g[p];m+=e[y]}m/=VoiceHandler.NotLanguageTokens(x);m*=r*e.count()/VoiceHandler.NotLanguageTokens(x);if(m>v){v=m;b=h}}if(b!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1102,"VoiceRecognizerNavigator.EvaluateGotoRow","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel.');f.DTTObj.AddParameter("","","score",s);var o=new ArrayList();o.Add(b);o.Add(u);d.Param=o;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1103,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no target panel found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1104,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerAction.prototype.EvaluateSelectCommand=function(k,A,d){k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1105,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": evaluate command.");var C=new ArrayList();var z=d.Match(k,A,C);if(VoiceHandler.NotLanguageTokens(C)==0){k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1106,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": no unknown words found. This is not the right command.");k.DTTObj.AddParameter("","","command score",0);return 0}var c=k.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1107,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var x=0;while(x<c.Count()){var p=c.Get(x);var q=false;if(p.Status()!=Glb.PS_DATA){q=true}else{if(p.GetNumRows()<=0){q=true}}if(q){k.DTTObj.AddParameter("","","panel",p.GetDTTCaption()+" (removed)");c.Remove(p)}else{k.DTTObj.AddParameter("","","panel",p.GetDTTCaption());x++}}var g=null;var b=null;var B=0;for(x=0;x<c.Count();x++){var p=c.Get(x);var a=k.VoiceObj.FindIndeObjByGuid(p.iGuid);var o=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,C,o);var y=0;if(o.count()==0){if(c.Count()==1){y=1}else{if(p.HasFocus()){if(p.HasFocus()){y=0.3}}}}else{y=1}if(y==0){continue}var h=new ArrayList();var f=new ArrayList();f.AddRange(C);var u=0;while(u<f.Count()){var l=f.Get(u);if(o.containsKey(l.Word)){f.RemoveAt(u)}else{u++}}var m=VoiceHandler.NotLanguageTokens(f);var e=new HashTableSrv();h=VoiceHandler.FindFieldsForSelection(p,f,e);var r=0;if(h.Count()>0){if(h.Count()>1&&!p.EnableMultipleSel()){return 0}var t=e.count();r=t/m;r*=y*t/m}if(r>B){g=h;b=p;B=r}}if(g!=null){z=(z+B)/2;k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1108,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target page.');k.DTTObj.AddParameter("","","score",z);var s=new ArrayList();s.Add(b);s.Add(g);d.Param=s;return z}k.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1109,"VoiceRecognizerAction.EvaluateSelectCommand","Command "+d.Name+" is not the right command.");k.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateRunCommand=function(r,H,d){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1110,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+": evaluate command.");var J=new ArrayList();var E=d.Match(r,H,J);r.DTTObj.AddParameter("","","command score",E);if(VoiceHandler.NotLanguageTokens(J)==0){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1111,"VoiceRecognizerNavigator.EvaluateRunCommand","Command "+d.Name+": no unknown words found. This is not the right command.");r.DTTObj.AddParameter("","","command score",0);return 0}var g=null;var h=null;var c=new ArrayList();var I=0;var o=new ArrayList();var k=r.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);var m="";if(k.Count()>0){m=k.Get(0).Parent.RTCGuid}var y=r.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PFIELD);y.AddRange(r.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD));for(var C=0;C<y.Count();C++){var G=y.Get(C);if(G.Type==VoiceHandler.OT_PFIELD){if(G.CustomData.length<=G.CustomData.lastIndexOf("|")+3){continue}o.Add(G.CustomData);var u=false;for(var D=0;D<k.Count();D++){if(G.ParentGuid==k.Get(D).iGuid){u=true;break}}if(!u){continue}}if(G.Type==VoiceHandler.OT_CMD){if(G.CustomData==null||G.CustomData.length==0){continue}var x=G.CustomData;var t=r.VoiceObj.FindIndeObjByGuid(x);if(t!=null&&t.Type!=VoiceHandler.OT_PROC){continue}o.Add(x);var K=G.ParentGuid;var e=r.VoiceObj.FindIndeObjByGuid(K);var F=e.ParentGuid;if(m.length>0&&!m==F){var u=false;var q=r.CmdObj.CmdSets;for(var D=0;D<q.length;D++){var b=q[D];if(b!=null&&b.IdxForm==0&&b.iGuid==K&&(b.IsMenu||b.IsToolbar)&&b.IsEnabled(0)){u=true;break}}if(!u){continue}}}var L=this.EvaluateProc(r,G,J);if(L!=null){var B=L.Get(0);var l=L.Get(1);var z=L.Get(2);if(B>I){I=B;g=l;c.AddRange(z);h=G}}}var s=r.RTCObj.AppGuid;var A=r.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PROC);for(var D=0;D<A.Count();D++){var v=A.Get(D);if(o.Contains(v.GUID)){continue}var a=v.ParentGuid;if(!a==s){if(m.length<=0||!m==a){continue}}var L=this.EvaluateProc(r,v,J);if(L!=null){var B=L.Get(0);var l=L.Get(1);var z=L.Get(2);if(B>I){I=B;g=l;c.AddRange(z);h=null}}}if(g!=null){E=(I+E)/2;r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1112,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+': the procedure "'+g.Name+'" is the target procedure');r.DTTObj.AddParameter("","","score",E);var L=new ArrayList();L.Add(g);L.Add(c);L.Add(h);d.Param=L;return E}r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1113,"VoiceRecognizerAction.EvaluateRunCommand","Command "+d.Name+" is not the right command.");r.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateFindCommand=function(M,z,o){M.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1114,"VoiceRecognizerAction.EvaluateFindCommand","Command "+o.Name+": evaluate command.");var G=new ArrayList();var f=o.Match(M,z,G);M.DTTObj.AddParameter("","","command score",f);var C=0;var h=null;var e=null;var S=null;var u=new ArrayList();if(f>0){var J=M.VoiceObj.GetActiveForms(M);for(var R=0;R<J.Count();R++){var g=J.Get(R);var y=g.RTCGuid;var A=M.VoiceObj.FindIndeObjByGuid(y);var X=new HashTableSrv();VoiceHandler.MatchWordList(A.Words,G,X);if(X.count()>0||J.Count()==1){var x=new ArrayList();var D=X.keys();for(var Q=0;Q<D.length;Q++){var L=D[Q];x.Add(new VoiceWord(L))}var m=M.VoiceObj.FindIndeObjChildren(A.GUID,A.Type,VoiceHandler.OT_PANEL);for(var W=0;W<m.Count();W++){var r=m.Get(W);var B=new HashTableSrv();VoiceHandler.MatchWordList(r.Words,x,B);if(B.count()==x.Count()){var d=this.GetFieldsArrayFromVoiceObj(M,r);var E=new ArrayList();E.AddRange(G);var V=0;while(V<E.Count()){var N=E.Get(V);if(X[N.Word]!=null){E.RemoveAt(V)}else{if(E.Get(V).LanguageToken){E.RemoveAt(V)}else{V++}}}var H=new HashTableSrv();var t=VoiceHandler.TestInsert(M,E,d,H,true);if(t==0){var K=new ArrayList();for(var P=0;P<d.Count();P++){var p=d.Get(P);if(p.Descriptive){K.Add(p)}}t=VoiceParameter.checkFieldsText(M,E,K,H,true)}var U=1;var D=H.keys();for(var Q=0;Q<D.length;Q++){var O=D[Q];x.Add(new VoiceWord(O))}var F=U*x.Count()/VoiceHandler.NotLanguageTokens(G);if(F>C){C=F;h=null;e=A;S=r;u.Clear();u.AddRange(E)}}}}}var l=M.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var R=0;R<l.Count();R++){var T=l.Get(R);var a=new HashTableSrv();VoiceHandler.MatchWordList(T.Words,G,a);if(a.count()==0){continue}var x=new ArrayList();var D=a.keys();for(var Q=0;Q<D.length;Q++){L=D[Q];x.Add(new VoiceWord(L))}if(T.CustomData==null){continue}var I=M.VoiceObj.FindIndeObjByGuid(T.CustomData);var X=new HashTableSrv();VoiceHandler.MatchWordList(I.Words,x,X);if(X.count()!=x.Count()){continue}var m=M.VoiceObj.FindIndeObjChildren(I.GUID,I.Type,VoiceHandler.OT_PANEL);for(var W=0;W<m.Count();W++){var r=m.Get(W);var B=new HashTableSrv();VoiceHandler.MatchWordList(r.Words,x,B);if(B.count()==x.Count()){var d=this.GetFieldsArrayFromVoiceObj(M,r);var E=new ArrayList();E.AddRange(G);var V=0;while(V<E.Count()){var N=E.Get(V);if(X[N.Word]!=null){E.RemoveAt(V)}else{if(E.Get(V).LanguageToken){E.RemoveAt(V)}else{V++}}}var H=new HashTableSrv();var t=VoiceHandler.TestInsert(M,E,d,H,true);if(t==0){var K=new ArrayList();for(var P=0;P<d.Count();P++){var p=d.Get(P);if(p.Descriptive){K.Add(p)}}t=VoiceParameter.checkFieldsText(M,E,K,H,true)}var U=0.5;var D=H.keys();for(var Q=0;Q<D.length;Q++){var O=D[Q];x.Add(new VoiceWord(O))}var F=U*x.Count()/VoiceHandler.NotLanguageTokens(G);if(F>C){C=F;h=T;e=I;S=r;u.Clear();u.AddRange(E)}}}}if(S!=null){f=(f+C)/2;M.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1115,"VoiceRecognizerAction.EvaluateFindCommand","Command "+o.Name+': the panel "'+S.Name+'" in the form "'+e.Name+'" is the target page.');M.DTTObj.AddParameter("","","score",f);var q=new ArrayList();q.Add(h);q.Add(e);q.Add(S);q.Add(u);o.Param=q;return f}}return 0};VoiceRecognizerAction.prototype.EvaluateCloseCommands=function(q,l,d){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1116,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": evaluate command.");var b=new ArrayList();var c=d.Match(q,l,b);q.DTTObj.AddParameter("","","command score",c);if(c>0){if(d.Index==VoiceRecognizerAction.VRA_CLOSEALL){if(VoiceHandler.NotLanguageTokens(b)>0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1117,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": no unknown words found.");q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1118,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0}else{q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1119,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": close all the forms");q.DTTObj.AddParameter("","","score",c);d.Param=null;return c}}var a=new ArrayList();a.AddRange(q.StackForm);if(VoiceHandler.NotLanguageTokens(b)==0&&q.VoiceObj.GetActiveForms(q).Count()==1){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1120,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+': close the form "'+a.Get(0).GetRD3Name()+'"');q.DTTObj.AddParameter("","","score",c);d.Param=a;return c}var p=new ArrayList();var u=0;for(var h=0;h<a.Count();h++){var k=a.Get(h);var m=k.RTCGuid;var s=q.VoiceObj.FindIndeObjByGuid(m);var o=new HashTableSrv();VoiceHandler.MatchWordList(s.Words,b,o);var g=0;var t=o.keys();for(var e=0;e<t.length;e++){var r=t[e];g+=o[r]}g/=VoiceHandler.NotLanguageTokens(b);if(g>u){p.Clear();p.Add(k);u=g}}if(p.Count()>0){c=(u+c)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1121,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+': the form "'+p.Get(0).GetRD3Name()+'" is the target form');q.DTTObj.AddParameter("","","score",c);d.Param=p;return c}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1122,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+": no target form found")}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1123,"VoiceRecognizerAction.EvaluateCloseCommands","Command "+d.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateOpenCommand=function(l,u,b){l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1127,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+b.Name+": evaluate command.");var x=new ArrayList();var s=b.Match(l,u,x);l.DTTObj.AddParameter("","","command score",s);if(VoiceHandler.NotLanguageTokens(x)==0){l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1128,"VoiceRecognizerNavigator.EvaluateOpenCommand","Command "+b.Name+": no unknown words found. This is not the right command.");l.DTTObj.AddParameter("","","command score",0);return 0}var f=null;var v=0;var g=l.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);var h="";if(g.Count()>0){h=(g.Get(0)).Parent.RTCGuid}var e=l.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var p=0;p<e.Count();p++){var q=e.Get(p);if(q.CustomData==null||q.CustomData.length==0){continue}var y=q.ParentGuid;var c=l.VoiceObj.FindIndeObjByGuid(y);var t=c.ParentGuid;if(h.length>0&&!h==t){var m=false;var k=l.CmdObj.CmdSets;for(var r=0;r<k.length;r++){var a=k[r];if(a!=null&&a.IdxForm==0&&a.iGuid==y){m=true;break}}if(!m){continue}}var d=new HashTableSrv();VoiceHandler.MatchWordList(q.Words,x,d);if(d.count()==0){continue}var o=d.count()/VoiceHandler.NotLanguageTokens(x);if(o>v){v=o;f=q}}if(f!=null){s=(v+s)/2;l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1129,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+f.Name+" is the target command.");l.DTTObj.AddParameter("","","score",s);var z=new ArrayList();z.Add(f);b.Param=z;return s}l.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1130,"VoiceRecognizerAction.EvaluateOpenCommand","Command "+b.Name+" is not the right command.");l.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateStopCommand=function(a,c,e){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1130,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+": evaluate command.");var b=new ArrayList();var d=e.Match(a,c,b);a.DTTObj.AddParameter("","","command score",d);if(d>0){if(b.Count()>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1132,"VoiceRecognizerAction.EvaluateStopCommand","Unknown words found.");a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1133,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is not the right command.");a.DTTObj.AddParameter("","","score",0);return 0}a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1134,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is the target command.");a.DTTObj.AddParameter("","","score",d);return d}a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1135,"VoiceRecognizerAction.EvaluateStopCommand","Command "+e.Name+" is not the right command.");a.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateGoToSectionBookCommand=function(r,G,e){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1050,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": evaluate command.");var J=new ArrayList();var F=e.Match(r,G,J);if(VoiceHandler.NotLanguageTokens(J)==0){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1051,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": no unknown words found. This is not the right command.");r.DTTObj.AddParameter("","","command score",0);return 0}if(F>0){var p=r.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1052,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+": "+p.Count()+" book found on screen.");var o=null;var d=-1;var I=0;for(var E=0;E<p.Count();E++){var u=p.Get(E);var b=new HashTableSrv();var A=VoiceHandler.TokenizeString(u.BookObj.GetName());VoiceHandler.MatchWordList(A,J,b);var a=0;if(b.count()==0){if(p.Count()==1){a=1}}else{a=1}if(a==0){continue}var h=new ArrayList();h.AddRange(J);var H=0;while(H<h.Count()){var s=h.Get(H);if(b[s.Word]!=null){h.RemoveAt(H)}else{H++}}var D=0;var B=false;while(!B){var g=u.BookObj.Book.getPage(D);if(g!=null){var l=new ArrayList();g.GetBoxesList(l);var y="";for(var C=0;C<l.Count();C++){var q=l.Get(C);y+=q.GetInnerText();y+=" "}var m=new HashTableSrv();var x=VoiceHandler.TokenizeString(y.toString());VoiceHandler.MatchWordList(x,J,m);var f=a*m.count()/VoiceHandler.NotLanguageTokens(J);if(f>I){I=f;d=D+1;o=u}if(f==1){break}else{D++}}else{break}}D++}if(d>-1){F=(F+I)/2;r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1053,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+': the book "'+o.BookObj.GetName()+'" is the target book.');r.DTTObj.AddParameter("","","score",F);var z=new ArrayList();z.Add(o);z.Add(d);e.Param=z;return F}}r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1054,"VoiceRecognizerNavigator.GoToSectionBookCommand","Command "+e.Name+" is not the right command.");r.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateReadCommand=function(Q,D,t){Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1114,"VoiceRecognizerAction.EvaluateReadCommand","Command "+t.Name+": evaluate command.");var K=new ArrayList();var h=t.Match(Q,D,K);Q.DTTObj.AddParameter("","","command score",h);var G=0;var m=null;var g=null;var X=null;var e=null;var A=new ArrayList();if(h>0){var N=Q.VoiceObj.GetActiveForms(Q);for(var V=0;V<N.Count();V++){var l=N.Get(V);var C=l.RTCGuid;var E=Q.VoiceObj.FindIndeObjByGuid(C);var ad=new HashTableSrv();VoiceHandler.MatchWordList(E.Words,K,ad);if(ad.count()>0||N.Count()==1){var B=new ArrayList();var H=ad.keys();for(var U=0;U<H.length;U++){var P=H[U];B.Add(new VoiceWord(P))}var r=Q.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);for(var ac=0;ac<r.Count();ac++){var T=r.Get(ac);var y=Q.VoiceObj.FindIndeObjByGuid(T.iGuid);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()>0||T.HasFocus()){var d=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var ab=0;while(ab<I.Count()){var R=I.Get(ab);if(ad[R.Word]!=null){I.RemoveAt(ab)}else{if(I.Get(ab).LanguageToken){I.RemoveAt(ab)}else{ab++}}}var L=new HashTableSrv();var o=VoiceHandler.CheckFieldsName(Q,I,d,L,true);if(o.Count()>0){ab=0;while(ab<I.Count()){var R=I.Get(ab);if(L[R.Word]!=null){I.RemoveAt(ab)}else{if(I.Get(ab).LanguageToken){I.RemoveAt(ab)}else{ab++}}}var W=0;while(W<d.Count()){for(var U=0;U<o.Count();U++){var Z=o.Get(U);if(Z.Name==d.Get(W).Name){d.Remove(d.Get(W))}else{W++}}}}var z=VoiceHandler.TestInsert(Q,I,d,L,true);if(z==0){var O=new ArrayList();for(var U=0;U<d.Count();U++){var u=d.Get(U);if(u.Descriptive){O.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}var aa=1;if(F.count()==0&&T.HasFocus()){aa=0.5}var H=L.keys();for(var U=0;U<H.length;U++){var S=H[U];B.Add(new VoiceWord(S))}var J=aa*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;m=null;g=E;X=y;e=o;A.Clear();A.AddRange(I)}}}}}var q=Q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var W=0;W<q.Count();W++){var Y=q.Get(W);var a=new HashTableSrv();VoiceHandler.MatchWordList(Y.Words,K,a);if(a.count()==0){continue}var B=new ArrayList();var H=a.keys();for(var U=0;U<H.length;U++){var P=H[U];B.Add(new VoiceWord(P))}if(Y.CustomData==null){continue}var M=Q.VoiceObj.FindIndeObjByGuid(Y.CustomData);var ad=new HashTableSrv();VoiceHandler.MatchWordList(M.Words,B,ad);if(ad.count()!=B.Count()){continue}var r=Q.VoiceObj.FindIndeObjChildren(M.GUID,M.Type,VoiceHandler.OT_PANEL);for(var ac=0;ac<r.Count();ac++){var y=r.Get(ac);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()==B.Count()){var d=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var ab=0;while(ab<I.Count()){var R=I.Get(ab);if(ad[R.Word]!=null){I.RemoveAt(ab)}else{if(I.Get(ab).LanguageToken){I.RemoveAt(ab)}else{ab++}}}var L=new HashTableSrv();var o=VoiceHandler.CheckFieldsName(Q,I,d,L,true);if(o.Count()>0){ab=0;while(ab<I.Count()){var R=I.Get(ab);if(L[R.Word]!=null){I.RemoveAt(ab)}else{if(I.Get(ab).LanguageToken){I.RemoveAt(ab)}else{ab++}}}var V=0;while(V<d.Count()){for(var U=0;U<o.Count();U++){var Z=o.Get(U);if(Z.Name.toLowerCase()==d.Get(V).Name.toLowerCase()){d.Remove(d.Get(V))}else{V++}}}var z=VoiceHandler.TestInsert(Q,I,d,L,true);if(z==0){var O=new ArrayList();for(var U=0;U<d.Count();U++){var u=d.Get(U);if(u.Descriptive){O.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}var aa=1;var H=L.keys();for(var U=0;U<H.length;U++){var S=H[U];B.Add(new VoiceWord(S))}var J=aa*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;m=Y;g=M;X=y;e=o;A.Clear();A.AddRange(I)}}}}}if(X!=null){h=(h+G)/2;Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1115,"VoiceRecognizerAction.EvaluateFindCommand","Command "+t.Name+': the panel "'+X.Name+'" in the form "'+g.Name+'" is the target page.');Q.DTTObj.AddParameter("","","score",h);var x=new ArrayList();x.Add(m);x.Add(g);x.Add(X);x.Add(e);x.Add(A);t.Param=x;return h}}return 0};VoiceRecognizerAction.prototype.EvaluateReadBookCommand=function(q,D,e){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1055,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": evaluate command.");var H=new ArrayList();var C=e.Match(q,D,H);if(VoiceHandler.NotLanguageTokens(H)==0){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1056,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": no unknown words found. This is not the right command.");q.DTTObj.AddParameter("","","command score",0);return 0}if(C>0){var o=q.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1057,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+": "+o.Count()+" book found on screen.");var m=null;var a=null;var G=0;for(var B=0;B<o.Count();B++){var s=o.Get(B);var d=new HashTableSrv();var x=VoiceHandler.TokenizeString(s.BookObj.GetName());VoiceHandler.MatchWordList(x,H,d);var b=0;if(d.count()==0){if(o.Count()==1){b=1}}else{b=1}if(b==0){continue}var h=new ArrayList();h.AddRange(H);var E=0;while(E<h.Count()){var r=h.Get(E);if(d[r.Word]!=null){h.RemoveAt(E)}else{E++}}var A=0;var y=false;while(!y){var g=s.BookObj.Book.getPage(A);if(g!=null){var l=new ArrayList();g.GetBoxesList(l);for(var z=0;z<l.Count();z++){var p=l.Get(z);var F=new HashTableSrv();var f=VoiceHandler.TokenizeString(p.GetToolTip());VoiceHandler.MatchWordList(f,H,F);var t=b*F.count()/VoiceHandler.NotLanguageTokens(H);if(t>G){G=t;a=p;m=s}}}else{break}A++}}if(a!=null){C=(C+G)/2;q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1058,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+': the book "'+m.BookObj.GetName()+'" is the target book.');q.DTTObj.AddParameter("","","score",C);var u=new ArrayList();u.Add(a);e.Param=u;return C}}q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1059,"VoiceRecognizerNavigator.EvaluateReadBookCommand","Command "+e.Name+" is not the right command.");q.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.EvaluateCountCommand=function(Q,D,t){Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1060,"VoiceRecognizerAction.EvaluateCountCommand","Command "+t.Name+": evaluate command.");var K=new ArrayList();var l=t.Match(Q,D,K);Q.DTTObj.AddParameter("","","command score",l);var G=0;var o=null;var h=null;var W=null;var g=null;var A=new ArrayList();if(l>0){var N=Q.VoiceObj.GetActiveForms(Q);for(var U=0;U<N.Count();U++){var m=N.Get(U);var C=m.RTCGuid;var E=Q.VoiceObj.FindIndeObjByGuid(C);var ac=new HashTableSrv();VoiceHandler.MatchWordList(E.Words,K,ac);if(ac.count()>0||N.Count()==1){var B=new ArrayList();var H=ac.keys();for(var ab=0;ab<H.length;ab++){var P=H[ab];B.Add(new VoiceWord(P))}var r=Q.VoiceObj.FindIndeObjChildren(E.GUID,E.Type,VoiceHandler.OT_PANEL);for(var ab=0;ab<r.Count();ab++){var y=r.Get(ab);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()==B.Count()){var e=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var aa=0;while(aa<I.Count()){var R=I.Get(aa);if(ac[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var L=new HashTableSrv();var p=VoiceHandler.CheckFieldsName(Q,I,e,L,true);if(p.Count()>0){aa=0;while(aa<I.Count()){var R=I.Get(aa);if(L[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var V=0;while(V<e.Count()){for(var T=0;T<p.Count();T++){var Y=p.Get(T);if(Y.Name.toLowerCase()==e.Get(V).Name.toLowerCase()){e.Remove(e.Get(V))}else{V++}}}}var z=VoiceHandler.TestInsert(Q,I,e,L,true);if(z==0){var O=new ArrayList();var a=new ArrayList();for(var T=0;T<e.Count();T++){var u=e.Get(T);if(u.Descriptive){O.Add(u)}if(u.Type==Glb.DT_DATE||u.Type==Glb.DT_DATETIME){a.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,a,L,true);if(I.Count()>0){z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}}var Z=1;var H=L.keys();for(var T=0;T<H.length;T++){var S=H[T];B.Add(new VoiceWord(S))}var J=Z*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;o=null;h=E;W=y;g=p;A.Clear();A.AddRange(I)}}}}}var q=Q.VoiceObj.FindIndeObjByType(VoiceHandler.OT_CMD);for(var V=0;V<q.Count();V++){var X=q.Get(V);var d=new HashTableSrv();VoiceHandler.MatchWordList(X.Words,K,d);if(d.count()==0){continue}var B=new ArrayList();var H=d.keys();for(var T=0;T<H.length;T++){var P=H[T];B.Add(new VoiceWord(P))}if(X.CustomData==null){continue}var M=Q.VoiceObj.FindIndeObjByGuid(X.CustomData);var ac=new HashTableSrv();VoiceHandler.MatchWordList(M.Words,B,ac);if(ac.count()!=B.Count()){continue}var r=Q.VoiceObj.FindIndeObjChildren(M.GUID,M.Type,VoiceHandler.OT_PANEL);for(var ab=0;ab<r.Count();ab++){var y=r.Get(ab);var F=new HashTableSrv();VoiceHandler.MatchWordList(y.Words,B,F);if(F.count()==B.Count()){var e=this.GetFieldsArrayFromVoiceObj(Q,y);var I=new ArrayList();I.AddRange(K);var aa=0;while(aa<I.Count()){var R=I.Get(aa);if(ac[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var L=new HashTableSrv();var p=VoiceHandler.CheckFieldsName(Q,I,e,L,true);if(p.Count()>0){aa=0;while(aa<I.Count()){var R=I.Get(aa);if(L[R.Word]!=null){I.RemoveAt(aa)}else{if(I.Get(aa).LanguageToken){I.RemoveAt(aa)}else{aa++}}}var U=0;while(U<e.Count()){for(var T=0;T<p.Count();T++){var Y=p.Get(T);if(Y.Name.toLowerCase()==e.Get(U).Name.toLowerCase()){e.Remove(e.Get(U))}else{U++}}}var z=VoiceHandler.TestInsert(Q,I,e,L,true);if(z==0){var O=new ArrayList();for(var T=0;T<e.Count();T++){var u=e.Get(T);if(u.Descriptive){O.Add(u)}}z=VoiceParameter.checkFieldsText(Q,I,O,L,true)}var Z=1;var H=L.keys();for(var T=0;T<H.length;T++){var S=H[T];B.Add(new VoiceWord(S))}var J=Z*B.Count()/VoiceHandler.NotLanguageTokens(K);if(J>G){G=J;o=X;h=M;W=y;g=p;A.Clear();A.AddRange(I)}}}}}if(W!=null){l=(l+G)/2;Q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1161,"VoiceRecognizerAction.EvaluateCountCommand","Command "+t.Name+': the panel "'+W.Name+'" in the form "'+h.Name+'" is the target page.');Q.DTTObj.AddParameter("","","score",l);var x=new ArrayList();x.Add(o);x.Add(h);x.Add(W);x.Add(g);x.Add(A);t.Param=x;return l}}return 0};VoiceRecognizerAction.prototype.EvaluateDeleteFieldCommand=function(m,H,d){m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1089,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": evaluate command.");var K=new ArrayList();var D=d.Match(m,H,K);m.DTTObj.AddParameter("","","command score",D);if(D>0){var b=m.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1090,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": "+b.Count()+" panels found on screen.");for(var A=0;A<b.Count();A++){m.DTTObj.AddParameter("","","panel",b.Get(A).GetDTTCaption())}var C=0;while(C<b.Count()){var s=b.Get(C);if(s.Status()!=Glb.PS_UPDATE){m.DTTObj.AddParameter("","","panel",b.Get(C).GetDTTCaption()+" (removed)");b.Remove(s)}else{m.DTTObj.AddParameter("","","panel",b.Get(C).GetDTTCaption());C++}}var a=null;var z=null;var J=0;var r=false;for(C=0;C<b.Count();C++){var s=b.Get(C);if(VoiceHandler.NotLanguageTokens(K)==0){m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1091,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": no unknown words found.");if(s.HasFocus()){var t;t=this.GetFieldsArrayFromPanel(s,VRA_INSERT);var L=new HashTableSrv();var e=s.FocusedColumn();for(var y=0;y<t.Count();y++){var F=t.Get(y);var G=F.Obj;if(e!=-1&&G==s.bFields(e)){D=(D+1)/2;m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1092,"VoiceRecognizerAction.EvaluateDeleteFieldCommand","Command "+d.Name+": "+s.GetDTTCaption()+" is the target panel");m.DTTObj.AddParameter("","","score",D);var l=new ArrayList();l.Add(s);l.Add(F);d.Param=l;return D}}}}else{m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1093,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": "+K.Count()+" unknown words found");for(var A=0;A<K.Count();A++){m.DTTObj.AddParameter("","","unknown word",K.Get(A).Word)}var E=m.VoiceObj.FindIndeObjByGuid(s.iGuid);var h=new HashTableSrv();VoiceHandler.MatchWordList(E.Words,K,h);var B=0;if(h.count()==0){if(b.Count()==1||s.HasFocus()){B=1}}else{if(D==0){B=0}else{B=1}}if(B==0){continue}var t;t=this.GetFieldsArrayFromPanel(s,VRA_INSERT);var L=new HashTableSrv();var g=new ArrayList();g.AddRange(K);var I=0;while(I<g.Count()){var o=g.Get(I);if(h.containsKey(o.Word)){g.RemoveAt(I)}else{I++}}if(g.Count()>0&&g.Get(I-1).LanguageToken){g.RemoveAt(I-1)}var x=new ArrayList();x.AddRange(K);var e=s.FocusedColumn();for(var y=0;y<t.Count();y++){var F=t.Get(y);var G=F.Obj;if(e!=-1&&G==s.bFields(e)){var q=L.keys();for(var A=0;A<q.length;A++){h[q[A]]=L[q[A]]}var u=B*h.count()/VoiceHandler.NotLanguageTokens(K);if(u>J){J=u;a=s;z=F}}}}}if(a!=null){D=(J+D)/2;m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1094,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+': the panel "'+a.GetDTTCaption()+'" is the target panel');m.DTTObj.AddParameter("","","score",D);var M=new ArrayList();M.Add(a);M.Add(z);d.Param=M;return D}m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1095,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+": no target panel found")}m.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1096,"VoiceRecognizerAction.EvaluateInsertCommand","Command "+d.Name+" is not the right command.");m.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerAction.prototype.ExecuteCommand=function(e){if(this.bestCmd.Index==VoiceRecognizerAction.VRA_LOCK){this.ExecuteLockCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_UNLOCK){this.ExecuteUnlockCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DUPLICATE){var a=this.ExecuteDuplicateCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(a)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETE){this.ExecuteDeleteCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SAVE){this.ExecuteSaveCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CANCEL){this.ExecuteCancelCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_REFRESH){this.ExecuteRefreshCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_EXPORT){this.ExecuteExportCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_PRINT){this.ExecutePrintCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CANCELSELECTION){this.ExecuteCancelSelectionCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SELECTALL){this.ExecuteSelectAllCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_REVERTSELECTION){this.ExecuteRevertSelectionCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_INSERT){this.ExecuteInsertCommand(e);var c=this.bestCmd.Param;var p=c.Get(0);var x=new ArrayList();if(c.Count()>1){x=c.Get(1)}var l="";for(var v=0;v<x.Count();v++){var y=x.Get(v);var B=y.text;if(B.Count()>0){l+=y.Name;l+=" ";for(var t=0;t<B.Count();t++){if(t>3){l+="...";break}l+=B.Get(t).Word;l+=" "}}}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(p.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_WRITE){this.ExecuteWriteCommand();var p=this.bestCmd.Param.Get(0);var x=this.bestCmd.Param.Get(1);var l="";for(var v=0;v<x.Count();v++){var y=x.Get(v);var B=y.text;if(B.Count()>0){l+=y.Name;l+=" ";for(var t=0;t<B.Count();t++){if(t>3){l+="...";break}l+=B.Get(t).Word;l+=" "}}}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(p.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DUPLICATEROW){this.ExecuteDuplicateRowCommand();var p=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(String.valueOf(C)),new IDVariant(p.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETEROW){this.ExecuteDeleteRowCommand();var p=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(String.valueOf(C)),new IDVariant(p.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_SELECT){this.ExecuteSelectCommand();var p=this.bestCmd.Param.Get(0);var C=this.bestCmd.Param.Get(1);var l="";for(var v=0;v<C.Count();v++){l+=C.Get(v);l+=" "}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(l),new IDVariant(p.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_RUN){this.ExecuteRunCommand(e);var c=this.bestCmd.Param;var u=c.Get(2);if(u==null){u=c.Get(0)}return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(u.Name)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_FIND){var q=this.ExecuteFindCommand(e);if(q>=0){return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(q)).stringValue()}else{return"???"}}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CLOSE){this.ExecuteCloseCommand(e);var A=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(A.Get(0).Caption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_CLOSEALL){this.ExecuteCloseAllCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_OPEN){this.ExecuteOpenCommand(e);var c=this.bestCmd.Param;var u=c.Get(0);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(u.Name)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_STOP){this.ExecuteStopCommand(e);return""}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_FINDBOOK){this.ExecuteGoToSectionBookCommand(e);return""}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_READ){var m=this.ExecuteReadCommand(e);if(m!=null){var g=m.Get(0);var b=m.Get(1);var o=m.Get(2);var d=g.Fields;if(b!=null&&b.Count()>0){var k="";for(var v=0;v<b.Count();v++){var A=b.Get(v);for(var t=0;t<d.length;t++){var h=d[t];if(A.Name==h.Header){k+=h.bValues(g.AttR).Value.stringValue()+" "}}}if(o){e.UnloadForm(g.Parent.FormIdx)}var z=this.bestCmd.Description.split(";");if(k.trim().length>0){return IDL.FormatMessage(new IDVariant(z[0]),new IDVariant(k)).stringValue()}if(z.length>0){return z[1]}return""}else{var r=g.FocusedColumn();var k=d[r].bValues(g.AttR).Value.stringValue()+" ";if(o){e.UnloadForm(g.Parent.FormIdx)}var z=this.bestCmd.Description.split(";");if(k.trim().length>0){return IDL.FormatMessage(new IDVariant(z[0]),new IDVariant(k)).stringValue()}if(z.length>0){return z[1]}return""}}}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_COUNT){var D=this.ExecuteCountCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(D)).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_READBOOK){var k=this.ExecuteReadBookCommand(e);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(k.trim())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerAction.VRA_DELETEFIELD){this.ExecuteDeleteFieldCommand();return this.bestCmd.Description}return""};VoiceRecognizerAction.prototype.ExecuteLockCommand=function(){this.bestCmd.Param.set_Locked(true)};VoiceRecognizerAction.prototype.ExecuteUnlockCommand=function(){this.bestCmd.Param.set_Locked(false)};VoiceRecognizerAction.prototype.ExecuteDuplicateCommand=function(){var b=this.bestCmd.Param;var a=b.ActualPosition();this.bestCmd.Param.PanelCommand(Glb.PCM_DUPLICATE,0,true);return a};VoiceRecognizerAction.prototype.ExecuteDeleteCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_DELETE,0,true)};VoiceRecognizerAction.prototype.ExecuteSaveCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_UPDATE,0,true)};VoiceRecognizerAction.prototype.ExecuteCancelCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_CANCEL,0,true)};VoiceRecognizerAction.prototype.ExecuteRefreshCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_REQUERY,0,true)};VoiceRecognizerAction.prototype.ExecuteExportCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_CSV,0,true)};VoiceRecognizerAction.prototype.ExecutePrintCommand=function(){this.bestCmd.Param.PanelCommand(Glb.PCM_PRINT,0,true)};VoiceRecognizerAction.prototype.ExecuteCancelSelectionCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(0)};VoiceRecognizerAction.prototype.ExecuteSelectAllCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(2)};VoiceRecognizerAction.prototype.ExecuteRevertSelectionCommand=function(){var a=this.bestCmd.Param;if(!a.ShowMultipleSel()){a.set_ShowMultipleSel(true,true)}a.ChangeSelection(1)};VoiceRecognizerAction.prototype.ExecuteCloseCommand=function(a){var b=this.bestCmd.Param;a.UnloadForm(b.Get(0).FormIdx)};VoiceRecognizerAction.prototype.ExecuteCloseAllCommand=function(a){a.HandleCloseAllEvent(null)};VoiceRecognizerAction.prototype.ExecuteInsertCommand=function(u){var p=this.bestCmd.Param;var B=p.Get(0);var I=new ArrayList();if(p.Count()>1){I=p.Get(1)}B.PanelCommand(Glb.PCM_INSERT,0,true);for(var H=0;H<I.Count();H++){var J=I.Get(H);var N=J.text;if(N.Count()>0){var L=I.Get(H).Obj;var A="";for(var F=0;F<N.Count();F++){A+=N.Get(F).Word;A+=" "}var z=A.trim();z=z.substring(0,1).toUpperCase()+z.substring(1);var y="";if((B.Layout()==Glb.PANEL_LIST&&L.ListNumRow>0)||(B.Layout()==Glb.PANEL_FORM&&L.FormNumRow>0)){y=L.bValues(B.SelectedRow()).LastRDText+" "}var O=L.Values[B.SelectedRow()].GetRD3Ident();B.RD3ValChange(O,y+z);if(L.IdxPanel>0){while(z.length>3){var g=-1;var t=0;B.UpdatePanel(u);var d=B.Queries[L.IdxPanel].RS.RecordCount();if(d==0){z=z.substring(0,z.length-1);B.RD3ValChange(O,z);continue}else{if(d>1){var r=B.Queries[L.IdxPanel].RS;var q=false;var a=0;try{r.MoveFirst();while(!r.EOF()){var o=false;for(var F=1;F<=r.GetNumFields();F++){var m=false;if(B.Queries[L.IdxPanel].VisibleColumns!=null){for(var b=0;b<B.Queries[L.IdxPanel].VisibleColumns.Count();b++){if(B.Queries[L.IdxPanel].VisibleColumns.get(b).toLowerCase()==r.GetName(F).toLowerCase()){m=true;break}}}if(!m){m=true;var h=B.Queries[L.IdxPanel].LKEParams.listIterator();while(h.hasNext()){var D=h.next();if(D.PropName.toLowerCase()==r.GetName(F).toLowerCase()){m=false;break}}}if(!m){continue}var C=r.Get(F).stringValue();var x=VoiceHandler.TokenizeString(C);var c=0;for(var E=0;E<x.Count();E++){var K=x[E];if(K.Word.contains(z)){c++}}if(c==x.Count()){o=true;break}else{if(c>0){var G=x.Count()/c;if(G>t){t=G;g=a}}}}if(o){q=true;B.RD3ValChange(O,"LKE"+(a+1));break}else{if(g>-1){q=true}}r.MoveNext();a++}}catch(M){}if(!q){B.RD3ValChange(O,"LKENULL")}else{if(g>-1){B.RD3ValChange(O,"LKE"+(g+1))}}}break}}}}}B.ReValidate()};VoiceRecognizerAction.prototype.ExecuteWriteCommand=function(){var l=this.bestCmd.Param.Get(0);var h=this.bestCmd.Param.Get(1);l.set_Locked(false);for(var d=0;d<h.Count();d++){var a=h.Get(d);var g=a.text;if(g.Count()>0){var e=h.Get(d).Obj;var o="";if((l.Layout()==Glb.PANEL_LIST&&e.ListNumRow>1)||(l.Layout()==Glb.PANEL_FORM&&e.FormNumRow>1)){o=e.bValues(0).Text}var p=o+" ";var b=0;if(g.Get(0).Word.toLowerCase()=="in"){b=1}for(var c=b;c<g.Count();c++){p+=g.Get(c).Word;p+=" "}var m=p.trim();m=m.substring(0,1).toUpperCase()+m.substring(1);var k=e.Values[l.SelectedRow()].GetRD3Ident();l.RD3ValChange(k,m);l.Parent.FocusPriority=0;l.set_ActualPosition(l.SelectedRow());if(l.IsShowingGrouping()){l.set_SelectedRow(0);l.ForceSendPosition=true}l.SetInput(-1,e.Index,2)}}l.ReValidate()};VoiceRecognizerAction.prototype.ExecuteDuplicateRowCommand=function(){var c=this.bestCmd.Param;var b=c.Get(0);var a=c.Get(1);b.Parent.FocusPriority=0;b.set_ActualPosition(a);if(b.IsShowingGrouping()){b.set_SelectedRow(0);b.ForceSendPosition=true}b.SetInput();b.PanelCommand(Glb.PCM_DUPLICATE,0,true)};VoiceRecognizerAction.prototype.ExecuteDeleteRowCommand=function(){var c=this.bestCmd.Param;var b=c.Get(0);var a=c.Get(1);b.Parent.FocusPriority=0;b.set_ActualPosition(a);if(b.IsShowingGrouping()){b.set_SelectedRow(0);b.ForceSendPosition=true}b.SetInput();b.PanelCommand(Glb.PCM_DELETE,0,true)};VoiceRecognizerAction.prototype.ExecuteSelectCommand=function(){var d=this.bestCmd.Param;var c=d.Get(0);var b=d.Get(1);if(!c.ShowMultipleSel()){c.set_ShowMultipleSel(true,true)}for(var a=0;a<b.Count();a++){c.SetRowSelected(true,b.Get(a))}c.Parent.FocusPriority=0;c.set_ActualPosition(b.Get(0));if(c.IsShowingGrouping()){c.set_SelectedRow(0);c.ForceSendPosition=true}c.SetInput()};VoiceRecognizerAction.prototype.ExecuteRunCommand=function(o){var c=null;var a=this.bestCmd.Param;var m=a.Get(0);var g=null;var f=o.VoiceObj.GetActiveForms(o);var k=m.Name.split(" ").join("");for(var b=0;b<f.Count()&&g==null;b++){c=f.Get(b);g=c[k]}if(g==null){c=o;g=c[k]}if(g!=null){try{var q=[];var l=a.Get(1);for(var d=0;d<l.Count();d++){var r=l.Get(d).text;var u="";for(varj=0;b<r.Count();b++){u+=r.Get(b).Word+" "}u=u.trim();var p=new IDVariant(u);p.changeType(IDL.DataType2IDVariantType(l.Get(d).Type));q.push(p)}g.apply(c,q)}catch(h){}}};VoiceRecognizerAction.prototype.ExecuteFindCommand=function(q){var H=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var r=this.bestCmd.Param.Get(2);var O=this.bestCmd.Param.Get(3);var a=new ArrayList();var A=null;if(H!=null){for(var I=0;I<q.CmdObj.CmdLin.length;I++){var g=q.CmdObj.CmdLin[I];if(g==null||g.IdxForm!=0){continue}if(g.iGuid.toLowerCase()==H.GUID.toLowerCase()&&g.bVisible(0)&&g.IsEnabled(0)){q.CmdClickCB(g.Index);break}}}var E=null;var h=q.VoiceObj.GetActiveForms(q);for(var I=0;I<h.Count();I++){var K=h.Get(I);if(K.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){E=K;break}}if(E==null){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return -1}for(var I=0;I<E.Frames.length;I++){var K=E.Frames[I];if(K!=null&&K.Content!=null&&K.Content.iGuid.toLowerCase()==r.GUID.toLowerCase()){A=K.Content;break}}if(A==null){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+r.Name+'" not found');return -1}var N=0;while(N<O.Count()){if(O.Get(N).LanguageToken){O.RemoveAt(N)}else{N++}}var B=this.GetFieldsArrayFromPanel(A,VoiceRecognizerAction.VRA_FIND);var P=new HashTableSrv();var x=VoiceHandler.TestInsert(q,O,B,P,true);a.AddRange(B);if(x==0){x=VoiceParameter.checkValueListFields(q,O,B,P);if(x==0){var l=new ArrayList();for(var F=0;F<B.Count();F++){var J=B.Get(F);if(J.Descriptive){l.Add(J)}}x=VoiceParameter.checkFieldsText(q,O,l,P,false)}}var e=0;if(x>0){if(A.Status()!=Glb.PS_QBE){A.PanelCommand(Glb.PCM_SEARCH)}if(A.Status()!=Glb.PS_QBE){q.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return -1}A.PanelCommand(Glb.PCM_CANCEL);var o=new HashTableSrv();for(var G=0;G<a.Count();G++){var y=a.Get(G);var K=y.Obj;var L=y.text;if(L.Count()>0){var v="";for(var F=0;F<L.Count();F++){v+=L.Get(F).Word;v+=" "}o[K.Index]=v.trim()}}var z=A.QBEEmpty;A.QBEEmpty=false;var d=1;while(e<=0){A.EnterQBE();var D=true;var C=false;var u=o.keys();for(var G=0;G<u.length;G++){var m=u[G];var t=o[m];if(t.length-d>3||d==0){t=t.substring(0,t.length-d);var K=A.Fields[m];if(t.length>0&&Glb.ClassDT(K.DataType)==Glb.DTC_CHAR&&K.QBELike&&K.IdxPanel==0&&K.ValueList.Count()==0){t="*"+t+"*"}var M=K.Values[A.SelectedRow()].GetRD3Ident();A.RD3ValChange(M,t);if(K.Values[A.SelectedRow()].Text.length==0){C=true;break}D=false}}d++;if(!C){if(D){A.QBEEmpty=z;return 0}A.PanelCommand(Glb.PCM_FIND);e=A.bQueries(0).RecordCount()}}A.QBEEmpty=z}return e};VoiceRecognizerAction.prototype.ExecuteOpenCommand=function(a){var e=this.bestCmd.Param;var c=e.Get(0);if(c!=null){for(var b=0;b<a.CmdObj.CmdLin.length;b++){var d=a.CmdObj.CmdLin[b];if(d==null||d.IdxForm!=0){continue}if(d.iGuid.toLowerCase()==c.GUID.toLowerCase()&&d.bVisible(0)&&d.IsEnabled(0)){a.CmdClickCB(d.Index);break}}}};VoiceRecognizerAction.prototype.ExecuteStopCommand=function(a){a.VoiceObj.set_Listening(false)};VoiceRecognizerAction.prototype.ExecuteGoToSectionBookCommand=function(a){var d=this.bestCmd.Param;var b=d.Get(0);var c=d.Get(1);b.BookCommand(IDREGlb.BCM_NAVIGATION,4,false,c)};VoiceRecognizerAction.prototype.ExecuteReadCommand=function(t){var J=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var u=this.bestCmd.Param.Get(2);var g=this.bestCmd.Param.Get(3);var Q=this.bestCmd.Param.Get(4);var a=new ArrayList();var C=null;if(J!=null){for(var K=0;K<t.CmdObj.CmdLin.length;K++){var h=t.CmdObj.CmdLin[K];if(h==null||h.IdxForm!=0){continue}if(h.iGuid.toLowerCase()==J.GUID.toLowerCase()&&h.bVisible(0)&&h.IsEnabled(0)){t.CmdClickCB(h.Index);break}}}var G=null;var l=t.VoiceObj.GetActiveForms(t);for(var K=0;K<l.Count();K++){var M=l.Get(K);if(M.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){G=M;break}}if(G==null){t.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return null}for(var K=0;K<G.Frames.length;K++){var M=G.Frames[K];if(M!=null&&M.Content!=null&&M.Content.iGuid.toLowerCase()==u.GUID.toLowerCase()){C=M.Content;break}}if(C==null){t.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+u.Name+'" not found');return null}var P=0;while(P<Q.Count()){if(Q.Get(P).LanguageToken){Q.RemoveAt(P)}else{P++}}if(Q.Count()>0){var D=this.GetFieldsArrayFromPanel(C,VoiceRecognizerAction.VRA_FIND);var R=new HashTableSrv();if(g.Count()>0){var K=0;while(K<D.Count()){for(var I=0;I<g.Count();I++){var M=g.Get(I);if(M.Name.toLowerCase()==D.Get(K).Name.toLowerCase()){R[D.Get(K).Name]=1;D.Remove(D.Get(K))}else{K++}}}}var z=VoiceHandler.TestInsert(t,Q,D,R,true);a.AddRange(D);if(z==0){z=VoiceParameter.checkValueListFields(t,Q,D,R);if(z==0){var m=new ArrayList();for(var H=0;H<D.Count();H++){var L=D.Get(H);if(L.Descriptive){m.Add(L)}}z=VoiceParameter.checkFieldsText(t,Q,m,R,false)}}var e=0;if(z>0){if(C.Status()!=Glb.PS_QBE){C.PanelCommand(Glb.PCM_SEARCH)}if(C.Status()!=Glb.PS_QBE){t.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return null}C.PanelCommand(Glb.PCM_CANCEL);var r=new HashTableSrv();for(var I=0;I<a.Count();I++){var A=a.Get(I);var M=A.Obj;var N=A.text;if(N.Count()>0){var y="";for(var H=0;H<N.Count();H++){y+=N.Get(H).Word;y+=" "}r[M.Index]=y.trim()}}var B=C.QBEEmpty;C.QBEEmpty=false;var d=0;while(e<=0){C.EnterQBE();var F=true;var E=false;var x=r.keys();for(var H=0;H<x.length;H++){var q=x[H];var v=r[q];if(v.length-d>3||d==0){v=v.substring(0,v.length-d);var M=C.Fields[q];if(v.length>0&&Glb.ClassDT(M.DataType)==Glb.DTC_CHAR&&M.QBELike&&M.IdxPanel==0&&M.ValueList.Count()==0){v="*"+v+"*"}var O=M.Values[C.SelectedRow()].GetRD3Ident();C.RD3ValChange(O,v);if(M.Values[C.SelectedRow()].Text.length==0){E=true;break}F=false}}d++;if(!E){if(F){C.QBEEmpty=B;return null}C.PanelCommand(Glb.PCM_FIND);e=C.bQueries(0).RecordCount()}}C.QBEEmpty=B;var o=new ArrayList();o.Add(C);o.Add(g);if(J!=null){o.Add(true)}else{o.Add(false)}return o}}else{var o=new ArrayList();o.Add(C);o.Add(g);if(J!=null){o.Add(true)}else{o.Add(false)}return o}return null};VoiceRecognizerAction.prototype.ExecuteCountCommand=function(r){var J=this.bestCmd.Param.Get(0);var b=this.bestCmd.Param.Get(1);var t=this.bestCmd.Param.Get(2);var g=this.bestCmd.Param.Get(3);var Q=this.bestCmd.Param.Get(4);var a=new ArrayList();var B=null;if(J!=null){for(var K=0;K<r.CmdObj.CmdLin.length;K++){var h=r.CmdObj.CmdLin[K];if(h==null||h.IdxForm!=0){continue}if(h.iGuid.toLowerCase()==J.GUID.toLowerCase()&&h.bVisible(0)&&h.IsEnabled(0)){r.CmdClickCB(h.Index);break}}}var F=null;var l=r.VoiceObj.GetActiveForms(r);for(var K=0;K<l.Count();K++){var M=l.Get(K);if(M.RTCGuid.toLowerCase()==b.GUID.toLowerCase()){F=M;break}}if(F==null){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1124,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: form "'+b.Name+'" not found');return -1}for(var K=0;K<F.Frames.length;K++){var M=F.Frames[K];if(M!=null&&M.Content!=null&&M.Content.iGuid.toLowerCase()==t.GUID.toLowerCase()){B=M.Content;break}}if(B==null){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1125,"VoiceRecognizerAction.ExecuteFind",'VoiceRecognizerAction: panel "'+t.Name+'" not found');return -1}var P=0;while(P<Q.Count()){if(Q.Get(P).LanguageToken){Q.RemoveAt(P)}else{P++}}if(Q.Count()>0){var C=this.GetFieldsArrayFromPanel(B,VoiceRecognizerAction.VRA_FIND);var R=new HashTableSrv();if(g.Count()>0){var K=0;while(K<C.Count()){for(var I=0;I<g.Count();I++){var M=g.Get(I);if(M.Name.toLowerCase()==C.Get(K).Name.toLowerCase()){R[C.Get(K).Name]=1;C.Remove(C.Get(K))}else{K++}}}}var y=VoiceHandler.TestInsert(r,Q,C,R,true);a.AddRange(C);if(y==0){y=VoiceParameter.checkValueListFields(r,Q,C,R);if(Q.Count()>R.count()){if(y==0){var m=new ArrayList();var H=new ArrayList();for(var G=0;G<C.Count();G++){var L=C.Get(G);if(L.Descriptive){m.Add(L)}if(L.Type==Glb.DT_DATE||L.Type==Glb.DT_DATETIME){H.Add(L)}}y=VoiceParameter.checkFieldsText(r,Q,H,R,false);y=VoiceParameter.checkFieldsText(r,Q,m,R,false)}}}var e=0;if(y>0){if(B.Status()!=Glb.PS_QBE){B.PanelCommand(Glb.PCM_SEARCH)}if(B.Status()!=Glb.PS_QBE){r.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1126,"VoiceRecognizerAction.ExecuteFind","VoiceRecognizerAction: can't place the panel in QBE status");return -1}B.PanelCommand(Glb.PCM_CANCEL);var q=new HashTableSrv();for(var I=0;I<a.Count();I++){var z=a.Get(I);var M=z.Obj;var N=z.text;if(N.Count()>0){var x="";for(var G=0;G<N.Count();G++){x+=N.Get(G).Word;x+=" "}q[M.Index]=x.trim()}}var A=B.QBEEmpty;B.QBEEmpty=false;var d=0;while(e<=0){B.EnterQBE();var E=true;var D=false;var v=q.keys();for(var I=0;I<v.length;I++){var o=v[I];var u=q[o];if(u.length-d>3||d==0){u=u.substring(0,u.length-d);var M=B.Fields[o];if(u.length>0&&Glb.ClassDT(M.DataType)==Glb.DTC_CHAR&&M.QBELike&&M.IdxPanel==0&&M.ValueList.Count()==0){u="*"+u+"*"}var O=M.Values[B.SelectedRow()].GetRD3Ident();B.RD3ValChange(O,u);if(M.Values[B.SelectedRow()].Text.length==0){D=true;break}E=false}}d++;if(!D){if(E){B.QBEEmpty=A;return 0}B.PanelCommand(Glb.PCM_FIND);e=B.bQueries(0).RecordCount()}}B.QBEEmpty=A}return e}else{return B.bQueries(0).RecordCount()}};VoiceRecognizerAction.prototype.ExecuteReadBookCommand=function(a){var b=this.bestCmd.Param.Get(0);return b.GetInnerText()};VoiceRecognizerAction.prototype.ExecuteDeleteFieldCommand=function(){var d=this.bestCmd.Param.Get(0);var c=this.bestCmd.Param.Get(1);var b=c.Obj;var a=b.Values[d.SelectedRow()].GetRD3Ident();d.RD3ValChange(a,"");return""};VoiceRecognizerAction.prototype.EvaluateProc=function(j,t,u){var c=new HashTableSrv();VoiceHandler.MatchWordList(t.Words,u,c);if(c.count()==0){return null}var q=1;var h=null;if(t.Type==VoiceHandler.OT_PFIELD||t.Type==VoiceHandler.OT_CMD){var o="";if(t.Type==VoiceHandler.OT_PFIELD){var g=t.CustomData.lastIndexOf("|");o=t.CustomData.substring(g+1)}else{if(t.Type==VoiceHandler.OT_CMD){o=t.CustomData}}h=j.VoiceObj.FindIndeObjByGuid(o)}else{h=t}var p=this.GetParametersArray(j,h);var e=new ArrayList();e.AddRange(u);var r=0;while(r<e.Count()){var l=e.Get(r);if(c.containsKey(l.Word)){e.RemoveAt(r)}else{r++}}var d=1;if(e.Count()>0&&p.Count()>0){var b=new HashTableSrv();d=VoiceHandler.TestInsert(j,e,p,b,false);if(d==0){d=VoiceParameter.checkFieldsText(j,e,p,b,false);if(d==0){d=0.1}}var m=b.keys();for(r=0;r<m.length;r++){c[m[r]]=b[m[r]]}}var s=0;var a=p.Count();if(a!=0){s=d/a}else{s=d}s*=q*c.count()/VoiceHandler.NotLanguageTokens(u);var x=new ArrayList();x.Add(s);x.Add(h);x.Add(p);return x};VoiceRecognizerAction.prototype.GetFieldsArrayFromPanel=function(h,g){var c=new ArrayList();var d=h.Fields;for(var b=0;b<d.length;b++){var e=d[b];if(e.DataType==Glb.DT_DOC_OLE){continue}if(e.IdxPanel<0){continue}if(e.Page!=-1){if((e.Parent.bPages(e.Page).Flags&Glb.OBJ_VISIBLE)==0||(e.Parent.bPages(e.Page).Flags&Glb.OBJ_ENABLED)==0){continue}}if(e.Group!=-1){if((e.Parent.bGroups(e.Group).Flags&Glb.OBJ_VISIBLE)==0||(e.Parent.bGroups(e.Group).Flags&Glb.OBJ_ENABLED)==0){continue}}if((e.Flags&Glb.OBJ_VISIBLE)==0){continue}if(g==VoiceRecognizerAction.VRA_INSERT&&e.Unbound){continue}if((e.Flags&Glb.OBJ_ENABLED)==0){continue}if((e.Flags&Glb.FLD_INFORM)==0&&h.Layout()==Glb.PANEL_FORM){continue}if((e.Flags&Glb.FLD_INLIST)==0&&h.Layout()==Glb.PANEL_LIST){continue}var a=new VoiceParameter();a.Obj=e;a.Name=e.Header;a.Description=e.Tooltip;a.Type=e.DataType;a.Length=e.MaxLength;if((e.Flags&Glb.FLD_ISDESCR)>0){a.Descriptive=true}c.Add(a)}return c};VoiceRecognizerAction.prototype.GetFieldsArrayFromVoiceObj=function(o,l){var j=new ArrayList();var d=o.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PFIELD);var q=l.GUID;for(var e=0;e<d.Count();e++){var b=d.Get(e);var m=o.VoiceObj.FindIndeObjByGuid(b.ParentGuid);while(m!=null&&m.Type!=VoiceHandler.OT_PANEL){m=o.VoiceObj.FindIndeObjByGuid(m.ParentGuid)}if(m!=null&&m.GUID.toLowerCase()==q.toLowerCase()){var g=b.CustomData.indexOf("|");var h=b.CustomData.indexOf("|",g+1);var k=b.CustomData.substring(0,g);var c=b.CustomData.substring(g+1,h);g=h;h=b.CustomData.indexOf("|",g+1);var f="";if(h!=-1){f=b.CustomData.substring(g+1,h)}else{f=b.CustomData.substring(g+1)}var a=new VoiceParameter();a.Name=b.Name;a.Type=parseInt(k);a.Length=parseInt(c);a.Descriptive=(f=="-1"?true:false);j.Add(a)}}return j};VoiceRecognizerAction.prototype.GetParametersArray=function(b,a){var f=new ArrayList();var e=b.VoiceObj.FindIndeObjByType(VoiceHandler.OT_PARAM);var g=a.GUID;for(var d=0;d<e.Count();d++){var h=e.Get(d);if(h.ParentGuid==g){var c=new VoiceParameter();c.Name=h.Name;c.Type=Integer.parseInt(h.CustomData);f.Add(c)}}return f};function VoiceRecognizerNavigator(){VoiceCommandRecognizer.call(this);this.bestCmd=null;for(var a=0;a<14;a++){var b=new VoiceCommand();b.Index=a;this.CommandList.Add(b)}}VoiceRecognizerNavigator.prototype=new VoiceCommandRecognizer();VoiceRecognizerNavigator.VRN_GOTOP=0;VoiceRecognizerNavigator.VRN_GOBOTTOM=1;VoiceRecognizerNavigator.VRN_GOUP=2;VoiceRecognizerNavigator.VRN_GODOWN=3;VoiceRecognizerNavigator.VRN_GOLIST=4;VoiceRecognizerNavigator.VRN_GODETAIL=5;VoiceRecognizerNavigator.VRN_GOTOPAGE=6;VoiceRecognizerNavigator.VRN_GOTOROW=7;VoiceRecognizerNavigator.VRN_GOTOFIELD=8;VoiceRecognizerNavigator.VRN_GONEXT=9;VoiceRecognizerNavigator.VRN_GOPREV=10;VoiceRecognizerNavigator.VRN_GOFIRST=11;VoiceRecognizerNavigator.VRN_GOLAST=12;VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK=13;VoiceRecognizerNavigator.prototype.EvaluateCommand=function(a,d){VoiceCommandRecognizer.prototype.EvaluateCommand.call(this,a,d);var e=0;var f=0;for(var c=0;c<6;c++){var b=this.CommandList.Get(c);e=this.EvaluateGo(a,d,b);if(e>f){f=e;this.bestCmd=b}}e=this.EvaluateGotopageCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGE)}e=this.EvaluateGotoRowCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOROW)}for(var c=9;c<13;c++){var b=this.CommandList.Get(c);e=this.EvaluateGoBookCommand(a,d,b);if(e>f){f=e;this.bestCmd=this.CommandList.Get(c)}}e=this.EvaluateGoToPageBookCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK)}if(f<1){e=this.EvaluateGotoFieldCommand(a,d);if(e>f){f=e;this.bestCmd=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOFIELD)}}if(this.bestCmd!=null){a.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1003,"VoiceRecognizerNavigator.EvaluateCommand",'VoiceRecognizerNavigator: the best command is "'+this.bestCmd.Name+'"');a.DTTObj.AddParameter("","","score",f)}return f};VoiceRecognizerNavigator.prototype.EvaluateGo=function(e,u,d){e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1004,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": evaluate command.");var y=new ArrayList();var s=d.Match(e,u,y);e.DTTObj.AddParameter("","","command score",s);if(s>0){var v=-1;if(d.Index==VoiceRecognizerNavigator.VRN_GOLIST){v=Glb.PANEL_LIST}else{v=Glb.PANEL_FORM}var c=e.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1005,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+c.Count()+" panels found on screen.");var q=0;while(q<c.Count()){var h=c.Get(q);var l=false;if(h.Layout()==v){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()==0){l=true}else{if(d.Index==VoiceRecognizerNavigator.VRN_GODETAIL&&v==Glb.PANEL_FORM&&(h.Flags&Glb.PAN_HASFORM)==0){l=true}else{if(d.Index==VoiceRecognizerNavigator.VRN_GOLIST&&v==Glb.PANEL_LIST&&(h.Flags&Glb.PAN_HASLIST)==0){l=true}}}}}if(l){e.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption()+" (removed)");c.remove(h)}else{e.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption());q++}}var b=null;var x=0;var g=false;for(q=0;q<c.Count();q++){var h=c.Get(q);if(VoiceHandler.NotLanguageTokens(y)==0){e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1006,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": no unknown words found.");if(h.HasFocus()){s=(s+1)/2;e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1007,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+h.GetDTTCaption()+" is the target panel");e.DTTObj.AddParameter("","","score",s);d.Param=h;return s}else{if(!g){b=h;g=true}else{b=null}}}else{e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1008,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": "+y.Count()+" unknown words found");for(var o=0;o<y.Count();o++){e.DTTObj.AddParameter("","","unknown word",y.Get(o).Word)}var t=e.VoiceObj.FindIndeObjByGuid(h.iGuid);usedWords=new HashTableSrv();VoiceHandler.MatchWordList(t.Words,y,usedWords);var r=0;if(usedWords.count()==0){if(c.Count()==1){r=1}else{if(h.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}var a=0;var f=usedWords.keys();for(var m=0;m<f.length;m++){var z=f[m];a+=usedWords[z]}a/=VoiceHandler.NotLanguageTokens(y);a*=r*usedWords.count()/VoiceHandler.NotLanguageTokens(y);if(a>x){x=a;b=h}}}if(b!=null){s=(x+s)/2;e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1009,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel');e.DTTObj.AddParameter("","","score",s);d.Param=b;return s}e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1010,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+": no target panel found")}e.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1011,"VoiceRecognizerNavigator.EvaluateGo","Command "+d.Name+" is not the right command.");e.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotopageCommand=function(f,t){var e=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGE);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1012,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": evaluate command.");var x=new ArrayList();var s=e.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1013,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": no unknown words found. This is not the right command.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1014,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": "+x.Count()+" unknown words found");for(var p=0;p<x.Count();p++){f.DTTObj.AddParameter("","","unknown word",x.Get(p).Word)}var d=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1015,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": "+d.Count()+" panels found on screen.");var q=0;while(q<d.Count()){var m=d.Get(q);if(m.Pages.length<=0){f.DTTObj.AddParameter("","","panel",(d.Get(q)).GetDTTCaption()+" (removed)");d.Remove(m)}else{f.DTTObj.AddParameter("","","panel",(d.Get(q)).GetDTTCaption());q++}}var v=0;var c=null;for(q=0;q<d.Count();q++){var m=d.Get(q);var b=f.VoiceObj.FindIndeObjByGuid(m.iGuid);var l=new HashTableSrv();VoiceHandler.MatchWordList(b.Words,x,l);var r=0;if(l.count()==0){if(d.Count()==1){r=1}else{if(m.HasFocus()){r=0.3}else{r=0.1}}}else{r=1}if(r==0){continue}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1016,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": found "+m.Pages.length+" pages of the panel "+m.GetDTTCaption()+".");f.DTTObj.AddParameter("","","panel factor",r);for(var p=0;p<m.Pages.length;p++){var u=new HashTableSrv();var g=f.VoiceObj.FindIndeObjByGuid(m.Pages[p].iGuid);VoiceHandler.MatchWordList(g.Words,x,u);var h=l.keys();for(var o=0;o<h.length;o++){u[h[o]]=l[h[o]]}var a=0;var h=u.keys();for(var o=0;o<h.length;o++){var y=h[o];a+=u[y]}a/=VoiceHandler.NotLanguageTokens(x);a*=r*u.count()/VoiceHandler.NotLanguageTokens(x);f.DTTObj.AddParameter("","",m.Pages[p].Header,a);if(a>v){v=a;c=m.Pages[p]}}}if(c!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1017,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+': the page "'+c.Header+'" is the target page.');f.DTTObj.AddParameter("","","score",s);e.Param=c;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1018,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+": no target panel found.");f.DTTObj.AddParameter("","","score",s)}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1019,"VoiceRecognizerNavigator.EvaluateGotoPageCommand","Command "+e.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotoRowCommand=function(f,t){var u=-1;var d=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOROW);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1020,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": evaluate command.");var x=new ArrayList();var s=d.Match(f,t,x);f.DTTObj.AddParameter("","","command score",s);if(s>0){if(VoiceHandler.NotLanguageTokens(x)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1021,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1022,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+x.Count()+" unknown words found.");for(var q=0;q<x.Count();q++){f.DTTObj.AddParameter("","","Unknown word",x.Get(q).Word)}for(var q=0;q<x.Count();q++){var k=x.Get(q);if(!k.LanguageToken&&k.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1023,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": row number found: "+x.Get(q).Word);u=parseInt(k.Word);break}}if(u>0){var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1024,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var q=0;while(q<c.Count()){var h=c.Get(q);var l=false;if(h.Layout()==Glb.PANEL_FORM){l=true}else{if(h.Status()!=Glb.PS_DATA){l=true}else{if(h.GetNumRows()<u){l=true}}}if(l){f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption()+" (removed)");c.remove(h)}else{f.DTTObj.AddParameter("","","panel",(c.Get(q)).GetDTTCaption());q++}}var v=0;var b=null;for(q=0;q<c.Count();q++){var h=c.Get(q);var a=f.VoiceObj.FindIndeObjByGuid(h.iGuid);var e=new HashTableSrv();VoiceHandler.MatchWordList(a.Words,x,e);var r=0;if(e.count()==0){if(c.Count()==1){r=1}else{if(h.HasFocus()){r=0.3}}}else{r=1}if(r==0){continue}e.NumRow=1;var m=0;var g=e.keys();for(var p=0;p<g.length;p++){var y=g[p];m+=e[y]}m/=VoiceHandler.NotLanguageTokens(x);m*=r*e.count()/VoiceHandler.NotLanguageTokens(x);if(m>v){v=m;b=h}}if(b!=null){s=(s+v)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1025,"VoiceRecognizerNavigator.EvaluateGotoRow","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target panel.');f.DTTObj.AddParameter("","","score",s);var o=new ArrayList();o.Add(b);o.Add(u);d.Param=o;return s}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1026,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+": no target panel found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1027,"VoiceRecognizerNavigator.EvaluateGotoRowCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",s);return 0};VoiceRecognizerNavigator.prototype.EvaluateGotoFieldCommand=function(f,q){var d=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOFIELD);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1028,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": evaluate command.");var g=null;var v=new ArrayList();var o=d.Match(f,q,v);if(VoiceHandler.NotLanguageTokens(v)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1029,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": no unknown words found. This is not the right command.");f.DTTObj.AddParameter("","","command score",0);return 0}var c=f.VoiceObj.FindOnScreen(VoiceHandler.OT_PANEL);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1030,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": "+c.Count()+" panels found on screen.");var l=0;while(l<c.Count()){var j=c.Get(l);if(j.HasFocus()){g=j}var k=false;if(j.Status()!=Glb.PS_DATA){k=true}else{if(j.GetNumRows()<=0){k=true}}if(k){f.DTTObj.AddParameter("","","panel",j.GetDTTCaption()+" (removed)");c.remove(j)}else{f.DTTObj.AddParameter("","","panel",j.GetDTTCaption());l++}}var t=-1;var b=null;var u=0;for(l=0;l<c.Count();l++){var j=c.Get(l);var a=f.VoiceObj.FindIndeObjByGuid(j.iGuid);var h=new HashTableSrv();var m=0;if(a!=null){VoiceHandler.MatchWordList(a.Words,v,h);if(h.count()==0){if(c.Count()==1){m=1}else{if(j.HasFocus()){if(j.HasFocus()){m=0.3}}}}else{m=1}}if(m==0){continue}var p=new HashTableSrv();var x=VoiceHandler.FindField(j,v,p);var e=x.Get(0);if(e==-1){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1031,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+": no row found.");f.DTTObj.AddParameter("","","panel",j.GetDTTCaption());f.DTTObj.AddParameter("","","score",0);continue}var s=x.Get(1);s*=m*p.count()/VoiceHandler.NotLanguageTokens(v);if(s>u){t=e;b=j;u=s}}if(t!=-1){o=(o+u)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1032,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+': the panel "'+b.GetDTTCaption()+'" is the target page.');f.DTTObj.AddParameter("","","score",o);var r=new ArrayList();r.Add(b);r.Add(t);d.Param=r;if(g!=null){g.SetInput()}return o}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1033,"VoiceRecognizerNavigator.EvaluateGotoFieldCommand","Command "+d.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",0);if(g!=null){g.SetInput()}return 0};VoiceRecognizerNavigator.prototype.EvaluateGoBookCommand=function(o,k,e){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1034,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": evaluate command.");var b=new ArrayList();var c=e.Match(o,k,b);o.DTTObj.AddParameter("","","command score",c);if(c>0){var h=o.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1035,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+h.Count()+" books found on screen.");var s=null;var t=0;for(var g=0;g<h.Count();g++){var d=h.Get(g);if(VoiceHandler.NotLanguageTokens(b)==0){o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1036,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": no unknown words found.");if(h.Count()==1){c=(c+1)/2;o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1037,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+d.BookObj.GetName()+" is the target panel");o.DTTObj.AddParameter("","","score",c);e.Param=d;return c}else{return 0}}else{o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1038,"VoiceRecognizerNavigator.EvaluateGoBook","Command "+e.Name+": "+b.Count()+" unknown words found");for(var f=0;f<b.Count();f++){o.DTTObj.AddParameter("","","unknown word",(b.Get(f)).Word)}var m=new HashTableSrv();var l=VoiceHandler.TokenizeString(d.BookObj.GetName());VoiceHandler.MatchWordList(l,b,m);var a=0;if(m.count()==0){if(h.Count()==1){a=1}}else{a=1}if(a==0){continue}var q=0;var r=m.keys();for(var f=0;f<r.length;f++){var p=r[f];q+=m[p]}q/=VoiceHandler.NotLanguageTokens(b);q*=a*m.count()/VoiceHandler.NotLanguageTokens(b);if(q>t){t=q;s=d}}}if(s!=null){c=(t+c)/2;o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1039,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+': the book "'+s.BookObj.GetName()+'" is the target book');o.DTTObj.AddParameter("","","score",c);e.Param=s;return c}o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1040,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+": no target book found")}o.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1041,"VoiceRecognizerNavigator.EvaluateGo","Command "+e.Name+" is not the right command.");o.DTTObj.AddParameter("","","score",0);return 0};VoiceRecognizerNavigator.prototype.EvaluateGoToPageBookCommand=function(f,s){var t=-1;var b=this.CommandList.Get(VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1042,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": evaluate command.");var v=new ArrayList();var r=b.Match(f,s,v);f.DTTObj.AddParameter("","","command score",r);if(r>0){if(VoiceHandler.NotLanguageTokens(v)==0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1043,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": no unknown words found.");f.DTTObj.AddParameter("","","score",0);return 0}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1044,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": "+v.Count()+" unknown words found.");for(var q=0;q<v.Count();q++){f.DTTObj.AddParameter("","","Unknown word",(v.Get(q)).Word)}for(var q=0;q<v.Count();q++){var m=v.Get(q);if(!m.LanguageToken&&m.Word.match("\\d+")){f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1045,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": page number found: "+(v.Get(q)).Word);t=parseInt(m.Word);break}}if(t>0){var e=f.VoiceObj.FindOnScreen(VoiceHandler.OT_BOOK);f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1046,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": "+e.Count()+" books found on screen.");var u=0;var d=null;for(var q=0;q<e.Count();q++){var g=e.Get(q);var c=new HashTableSrv();var l=VoiceHandler.TokenizeString(g.BookObj.GetName());VoiceHandler.MatchWordList(l,v,c);var a=0;if(c.count()==0){if(e.Count()==1){a=1}}else{a=1}if(a==0){continue}c.PageNum=1;var k=0;var h=c.keys();for(var p=0;p<h.length;p++){var x=h[p];k+=c[x]}k/=VoiceHandler.NotLanguageTokens(v);k*=a*c.count()/VoiceHandler.NotLanguageTokens(v);if(k>u){u=k;d=g}}if(d!=null){r=(r+u)/2;f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1047,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+': the book "'+d.BookObj.GetName()+'" is the target book.');f.DTTObj.AddParameter("","","score",r);var o=new ArrayList();o.Add(d);o.Add(t);b.Param=o;return r}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1048,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+": no target book found");f.DTTObj.AddParameter("","","score",0);return 0}}f.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",1049,"VoiceRecognizerNavigator.GoToPageBookCommand","Command "+b.Name+" is not the right command.");f.DTTObj.AddParameter("","","score",r);return 0};VoiceRecognizerNavigator.prototype.ExecuteCommand=function(a){if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOP){this.ExecuteGotopCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOBOTTOM){this.ExecuteGobottomCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOUP){this.ExecuteGoupCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GODOWN){this.ExecuteGodownCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOLIST){this.ExecuteGolistCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GODETAIL){this.ExecuteGodetailCommand();return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(this.bestCmd.Param.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOPAGE){this.ExecuteGotopageCommand();var d=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(d.Header),new IDVariant(d.Parent.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOROW){this.ExecuteGotoRowCommand();var g=this.bestCmd.Param.Get(0);var f=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(f+""),new IDVariant(g.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOFIELD){this.ExecuteGotoFieldCommand();var g=this.bestCmd.Param.Get(0);var f=this.bestCmd.Param.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(f+""),new IDVariant(g.GetDTTCaption())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GONEXT){this.ExecuteGoNextCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOPREV){this.ExecuteGoPrevCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOFIRST){this.ExecuteGoFirstCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOLAST){this.ExecuteGoLastCommand();var e=this.bestCmd.Param;return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(e.BookObj.GetName())).stringValue()}if(this.bestCmd.Index==VoiceRecognizerNavigator.VRN_GOTOPAGEBOOK){this.ExecuteGoToPageBookCommand();var e=this.bestCmd.Param;var b=e.Get(0);var c=e.Get(1);return IDL.FormatMessage(new IDVariant(this.bestCmd.Description),new IDVariant(c),new IDVariant(b.BookObj.GetName())).stringValue()}return""};VoiceRecognizerNavigator.prototype.ExecuteGotopCommand=function(){var b=this.bestCmd.Param;var a=b.Parent.FocusPriority;b.Parent.FocusPriority=0;b.PanelCommand(Glb.PCM_NAVIGATION,0,true);b.Parent.FocusPriority=a};VoiceRecognizerNavigator.prototype.ExecuteGobottomCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,1,true)};VoiceRecognizerNavigator.prototype.ExecuteGoupCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,3,true)};VoiceRecognizerNavigator.prototype.ExecuteGodownCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_NAVIGATION,2,true)};VoiceRecognizerNavigator.prototype.ExecuteGolistCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_FORMLIST,0,true)};VoiceRecognizerNavigator.prototype.ExecuteGodetailCommand=function(){(this.bestCmd.Param).PanelCommand(Glb.PCM_FORMLIST,0,true)};VoiceRecognizerNavigator.prototype.ExecuteGotopageCommand=function(){var b=this.bestCmd.Param;var a=b.Parent;a.set_Page(b.Index)};VoiceRecognizerNavigator.prototype.ExecuteGotoRowCommand=function(){this.ExecuteGotoFieldCommand()};VoiceRecognizerNavigator.prototype.ExecuteGotoFieldCommand=function(){var c=this.bestCmd.Param;var a=c.Get(0);var b=c.Get(1);a.Parent.FocusPriority=0;a.set_ActualPosition(b);if(a.IsShowingGrouping()){a.set_SelectedRow(0);a.ForceSendPosition=true}a.SetInput()};VoiceRecognizerNavigator.prototype.ExecuteGoNextCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,3)};VoiceRecognizerNavigator.prototype.ExecuteGoPrevCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,2)};VoiceRecognizerNavigator.prototype.ExecuteGoFirstCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,0)};VoiceRecognizerNavigator.prototype.ExecuteGoLastCommand=function(){var a=this.bestCmd.Param;a.BookCommand(IDREGlb.BCM_NAVIGATION,1)};VoiceRecognizerNavigator.prototype.ExecuteGoToPageBookCommand=function(){var c=this.bestCmd.Param;var a=c.Get(0);var b=c.Get(1);a.BookCommand(IDREGlb.BCM_NAVIGATION,4,false,b)};function VoiceWord(a){this.Word=(a==undefined?"":a);this.LanguageToken=false;this.Weight=1;this.Occurrences=0}VoiceWord.prototype.isEqual=function(c){if(c.Word.toLowerCase()==this.Word.toLowerCase()){return 1}var f=c.Word.toLowerCase();var d=this.Word.toLowerCase();var b;var e;if(f.length>d.length){b=d.length;e=f.length}else{b=f.length;e=d.length}var a=0;for(a=0;a<b;a++){if(f.charAt(a)!=(d.charAt(a))){break}}var g=a/e;if(a==0||g<=0.5){return 0}else{return g}};function VoiceWordList(){this.WList=new ArrayList();this.optional=false}WebApiHandler.INSTANCETAG="_ID_INSTANCE";function WebApiHandler(){this.MainFrm=null;this.IsWebApiRequest=false;this.ChildLevel=-1;this.Format=XMLDoc.FT_JSON;this.MethodName="";this.Headers=new IDMap();this.Parameters=new IDMap();this.OutputCollection=new IDCollection();this.Content=""}WebApiHandler.prototype.CheckUri=function(){return""};WebApiHandler.prototype.WriteResponse=function(a,b,c){};function WebEntryPointSrv(){this.MainFrm=this;this.AlreadyDestroyed=false;this.Request;this.Response;this.iParent;this.WelcomeURL="";this.LogoffURL="";this.AppPath="";this.AppName="";this.RealPath="";this.CmdObj;this.IndObj;this.RolObj;this.RTCObj;this.DTTObj=new DTTEngine();this.TimerObj;this.ErrObj;this.VoiceObj;this.IwImdb;this.IMDB;this.VisualStyleList=new VisAttrListSrv();this.VBFile=new VBFiles();this.RevNum=0;this.IDVer="";this.StartRequestTS;this.iActiveForm=null;this.StackForm=new ArrayList();this.iDockedForm=null;this.QwlRoles=new HashTableSrv();this.iCaption=new IDVariant();this.iImage="";this.GlbPanelFlags=0;this.IntSesNumber=0;this.iRefreshInterval=new IDVariant(-1);this.iClickCounter=0;this.iVisualFlags=3839;this.TempFiles=new ArrayList();this.PDFPrints=new ArrayList();this.iRedirectTo=new IDVariant();this.iRedirectFeatures=new IDVariant();this.VoiceCommandExecuted=false;this.iAlertMessage=new IDVariant();this.iRefreshLocation=new IDVariant(0);this.iAccelMotionThreshold=new IDVariant(999);this.iRotMotionThreshold=new IDVariant(999);this.TrayletRefreshCommand="";this.WidgetMode=false;this.iRedirectNewWindow=false;this.LoginMessage="";this.ConfStack=new HashTableSrv();this.iAlertType=0;this.URLData="";this.UrlParams=new HashTableSrv();this.GlbRoleCmdSetEnabled=true;this.GlbRoleCmdLinEnabled=true;this.GlbRoleCommandEnabled=true;this.HelpFile="";this.iActiveHelpFile="";this.MenuType=1;this.IEVer=0;this.BrowserClass=Glb.BRWCLS_IENORMAL;this.BrowserSubClass=Glb.BRWSCL_NONE;this.HostName="";this.BInfo_Type=-1;this.BInfo_Ver=-1;this.iShiftKey=false;this.iCtrlKey=false;this.iAltKey=false;this.MenuAutoCollapse=0;this.MimeMap=null;this.UseRD=false;this.RDStatus=0;this.RDExitURL="";this.RDToken=new HashTableSrv();this.GZipEnabled=0;this.DisableRender=false;this.PrelImgs=new ArrayList();this.LookupCache=new ArrayList();this.iRefreshUI=false;this.SchemaCache=new HashTableSrv();this.ActivedDocument=null;this.ActivedProperty=null;this.ActivedExtProperty=null;this.DocHelper=null;this.DOModifiedList=new ArrayList();this.SyncObject=new SyncService(this);this.ShellObject=new Shell(this);this.WebApiObject=new WebApiHandler(this);this.iScreenW;this.iScreenH;this.MenuW;this.WebServicesUrl=new HashTableSrv();this.ServiceConnectors=new HashTableSrv();this.iParamsObj;this.ProgrBar=new ProgressBar(this);this.INDE_X=null;this.BaseTimerIdx=0;this.BaseCmdSetIdx=0;this.BaseCmdLinIdx=0;this.CompOwner=null;this.CompList=new ArrayList();this.CompAlreadyNotified=null;this.SharedInstance=true;this.CompNameSpace=null;this.iFrmOffs=null;this.InitComps=null;this.SessionName="";this.SessionQueryString="";this.DesktopRendered=false;this.RD3CreateFullTree=false;this.RD3CompressFiles=false;this.RD3PanRevalidate=false;this.RD3UseManifest=false;this.RD3Events=new ArrayList();this.LastRD3Reply=null;this.RD3LastRequest=0;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.WEP_MAXPROP);this.iSideMenuWidth=160;this.iIsMobile=-1;this.iAccentColor=12747008;this.CloseAllEvent=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE;this.CloseAppEvent=RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE;this.iHasConfirm=false;this.confirmNodes=new ArrayList();this.RD3EntryPoint="";this.RD3CliExecute=new ArrayList();this.DeleteAfterDownload=false;this.FileToSend="";this.SaveAttachment=false;this.iMDITop=0;this.iMDILeft=0;this.iScreenHeight=0;this.iScreenWidth=0;this.screenZones=new ArrayList();this.StartAnimationDef=null;this.ExpandCmdSetAnimationDef=null;this.PopupMenuAnimationDef=null;this.ShowFormAnimationDef=null;this.OpenModalAnimationDef=null;this.MessageAnimationDef=null;this.LastMessageAnimationDef=null;this.CollapseFrameAnimationDef=null;this.ExpandTreeAnimationDef=null;this.ChangeLayoutAnimationDef=null;this.QBETipAnimationDef=null;this.ChangeTabPageAnimationDef=null;this.ShowGraphAnimationDef=null;this.ChangeBookPageAnimationDef=null;this.RedirectAnimationDef=null;this.PreviewAnimationDef=null;this.DockedAnimationDef=null;this.PopupResizeAnimationDef=null;this.TooltipAnimationDef=null;this.TaskbarAnimationDef=null;this.ComboAnimationDef=null;this.ShouldEatNextMessage=false;this.EatNextMessage=false;this.ComboNameSep="; ";this.ListenKeys=0;this.SessionSettings=new HashTableSrv();this.DebugWindow="";this.DebugItemList="";this.DebugCmdForm="";this.DebugDetail="";this.DebugReqTop="";this.DebugReqRef="";this.DebugReqPrc="";this.SendDebug=false;WebFrameSrv.InitTBZones()}WebEntryPointSrv.SSManager;WebEntryPointSrv.cmpInited=0;WebEntryPointSrv.prototype.Parent=function(){return(this.CompOwner!=null?this.CompOwner.Parent():this.iParent)};WebEntryPointSrv.prototype.set_Parent=function(a){if(this.CompOwner!=null){this.CompOwner.set_Parent(a)}else{this.iParent=a}};WebEntryPointSrv.prototype.GetVisualStyleList=function(){return(this.CompOwner!=null?this.CompOwner.GetVisualStyleList():this.VisualStyleList)};WebEntryPointSrv.prototype.ActiveForm=function(){return(this.CompOwner!=null?this.CompOwner.ActiveForm():this.iActiveForm)};WebEntryPointSrv.prototype.set_ActiveForm=function(a){if(this.CompOwner!=null){this.CompOwner.set_ActiveForm(a)}else{this.iActiveForm=a}};WebEntryPointSrv.prototype.ActiveFormIdx=function(){return(this.ActiveForm()!=null?this.ActiveForm().FormIdx:0)};WebEntryPointSrv.prototype.DockedForm=function(){return(this.CompOwner!=null?this.CompOwner.DockedForm():this.ParamsObj().UseRD3?null:this.iDockedForm)};WebEntryPointSrv.prototype.set_DockedForm=function(a){if(this.CompOwner!=null){this.CompOwner.set_DockedForm(a)}else{this.iDockedForm=a}};WebEntryPointSrv.prototype.RedirectTo=function(){return(this.CompOwner!=null?this.CompOwner.RedirectTo():this.iRedirectTo)};WebEntryPointSrv.prototype.set_RedirectTo=function(b){if(this.CompOwner!=null){this.CompOwner.set_RedirectTo(b)}else{this.iRedirectTo=b;if(this.RealPath.length>0){var a=this.iRedirectTo.stringValue();if(a.startsWith(this.RealPath)){a=a.substring(this.RealPath.length+1);a=a.Replace("\\\\","/");this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",225,"MainFrm.set_RedirectTo","The redirect url must be a relative path: changed to '"+a+"'");this.iRedirectTo=new IDVariant(a)}}}};WebEntryPointSrv.prototype.RedirectFeatures=function(){return(this.CompOwner!=null?this.CompOwner.RedirectFeatures():this.iRedirectFeatures)};WebEntryPointSrv.prototype.set_RedirectFeatures=function(a){if(this.CompOwner!=null){this.CompOwner.set_RedirectFeatures(a)}else{this.iRedirectFeatures=a}if(this.CompOwner!=null){this.CompOwner.set_RedirectFeatures(a)}else{if(a.CompareToIgnoreCase(new IDVariant("save"))==0){a=new IDVariant("");this.SaveAttachment=true}this.iRedirectFeatures=a}};WebEntryPointSrv.prototype.AlertMessage=function(){return(this.CompOwner!=null?this.CompOwner.AlertMessage():this.iAlertMessage)};WebEntryPointSrv.prototype.set_AlertMessage=function(a){if(this.CompOwner!=null){this.CompOwner.set_AlertMessage(a)}else{this.iAlertMessage=a}this.VoiceCommandExecuted=this.VoiceObj.VoiceCommandExecuted};WebEntryPointSrv.prototype.RefreshLocation=function(){return(this.CompOwner!=null?this.CompOwner.RefreshLocation():this.iRefreshLocation)};WebEntryPointSrv.prototype.set_RefreshLocation=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshLocation(a)}else{this.iRefreshLocation=a;this.RD3Change(RD3Glb.WEP_REFRESHLOC)}};WebEntryPointSrv.prototype.VisualFlag=function(a){return(this.CompOwner!=null?this.CompOwner.VisualFlag(a):this.iVisualFlags&a)};WebEntryPointSrv.prototype.set_VisualFlag=function(b,a){if(this.CompOwner!=null){this.CompOwner.set_VisualFlag(b,a)}else{this.iVisualFlags=(this.iVisualFlags&(~a))|b;this.RD3Change(RD3Glb.WEP_VISPROP)}};WebEntryPointSrv.prototype.SetMotionThreshold=function(b,a){if(this.CompOwner!=null){this.CompOwner.SetMotionThreshold(b,a)}else{if(!this.iAccelMotionThreshold.equals(b)||!this.iRotMotionThreshold.equals(a)){this.iAccelMotionThreshold=b;this.iRotMotionThreshold=a;this.RD3Change(RD3Glb.WEP_DEVICEMOTION)}}};WebEntryPointSrv.prototype.RedirectNewWindow=function(){return(this.CompOwner!=null?this.CompOwner.RedirectNewWindow():this.iRedirectNewWindow)};WebEntryPointSrv.prototype.set_RedirectNewWindow=function(a){if(this.CompOwner!=null){this.CompOwner.set_RedirectNewWindow(a)}else{this.iRedirectNewWindow=a}};WebEntryPointSrv.prototype.LoginMsg=function(){return(this.CompOwner!=null?this.CompOwner.LoginMsg():this.LoginMessage)};WebEntryPointSrv.prototype.set_LoginMsg=function(a){if(this.CompOwner!=null){this.CompOwner.set_LoginMsg(a)}else{this.LoginMessage=a}};WebEntryPointSrv.prototype.AlertType=function(){return(this.CompOwner!=null?this.CompOwner.AlertType():this.iAlertType)};WebEntryPointSrv.prototype.set_AlertType=function(a){if(this.CompOwner!=null){this.CompOwner.set_AlertType(a)}else{this.iAlertType=a}};WebEntryPointSrv.prototype.ActiveHelpFile=function(){return(this.CompOwner!=null?this.CompOwner.ActiveHelpFile():this.iActiveHelpFile)};WebEntryPointSrv.prototype.ShiftKey=function(){return(this.CompOwner!=null?this.CompOwner.ShiftKey():this.iShiftKey)};WebEntryPointSrv.prototype.set_ShiftKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_ShiftKey(a)}else{this.iShiftKey=a}};WebEntryPointSrv.prototype.CtrlKey=function(){return(this.CompOwner!=null?this.CompOwner.CtrlKey():this.iCtrlKey)};WebEntryPointSrv.prototype.set_CtrlKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_CtrlKey(a)}else{this.iCtrlKey=a}};WebEntryPointSrv.prototype.AltKey=function(){return(this.CompOwner!=null?this.CompOwner.AltKey():this.iAltKey)};WebEntryPointSrv.prototype.set_AltKey=function(a){if(this.CompOwner!=null){this.CompOwner.set_AltKey(a)}else{this.iAltKey=a}};WebEntryPointSrv.prototype.ScreenW=function(){return(this.CompOwner!=null?this.CompOwner.ScreenW():this.iScreenW)};WebEntryPointSrv.prototype.set_ScreenW=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenW(a)}else{this.iScreenW=a}};WebEntryPointSrv.prototype.ScreenH=function(){return(this.CompOwner!=null?this.CompOwner.ScreenH():this.iScreenH)};WebEntryPointSrv.prototype.set_ScreenH=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenH(a)}else{this.iScreenH=a}};WebEntryPointSrv.prototype.hasConfirm=function(){return(this.CompOwner!=null?this.CompOwner.hasConfirm():this.iHasConfirm)};WebEntryPointSrv.prototype.set_hasConfirm=function(a){if(this.CompOwner!=null){this.CompOwner.set_hasConfirm(a)}else{this.iHasConfirm=a}};WebEntryPointSrv.prototype.MDITop=function(){return(this.CompOwner!=null?this.CompOwner.MDITop():this.iMDITop)};WebEntryPointSrv.prototype.set_MDITop=function(a){if(this.CompOwner!=null){this.CompOwner.set_MDITop(a)}else{this.iMDITop=a}};WebEntryPointSrv.prototype.MDILeft=function(){return(this.CompOwner!=null?this.CompOwner.MDILeft():this.iMDILeft)};WebEntryPointSrv.prototype.set_MDILeft=function(a){if(this.CompOwner!=null){this.CompOwner.set_MDILeft(a)}else{this.iMDILeft=a}};WebEntryPointSrv.prototype.ScreenHeight=function(){return(this.CompOwner!=null?this.CompOwner.ScreenHeight():this.iScreenHeight)};WebEntryPointSrv.prototype.set_ScreenHeight=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenHeight(a)}else{this.iScreenHeight=a}};WebEntryPointSrv.prototype.ScreenWidth=function(){return(this.CompOwner!=null?this.CompOwner.ScreenWidth():this.iScreenWidth)};WebEntryPointSrv.prototype.set_ScreenWidth=function(a){if(this.CompOwner!=null){this.CompOwner.set_ScreenWidth(a)}else{this.iScreenWidth=a}};WebEntryPointSrv.prototype.ClickCounter=function(){return(this.CompOwner!=null?this.CompOwner.ClickCounter():this.iClickCounter)};WebEntryPointSrv.prototype.set_ClickCounter=function(a){if(this.CompOwner!=null){this.CompOwner.set_ClickCounter(a)}else{this.iClickCounter=a}};WebEntryPointSrv.prototype.ShiftFrmConst=function(a){};WebEntryPointSrv.prototype.IMDBOffset=function(){return 0};WebEntryPointSrv.prototype.CreateDocument=function(b,a){return false};WebEntryPointSrv.prototype.GetFromDNA=function(c,b,a,d){return null};WebEntryPointSrv.prototype.AttachCompTo=function(a){var b=a.CompList;b.Add(this);if(this.SharedInstance){a=a.GetApplication()}this.CompOwner=a;this.CreateComponents()};WebEntryPointSrv.prototype.GetCompFromNameSpace=function(b){if(this.CompNameSpace&&this.CompNameSpace.equals(b)){return this}for(var a=0;a<this.CompList.Count();a++){var c=this.CompList[a].GetCompFromNameSpace(b);if(c!=null){return c}}return null};WebEntryPointSrv.prototype.CreateComponents=function(){};WebEntryPointSrv.prototype.InitComponents=function(){if(this.CompOwner==null&&this.CompList.Count()==0){this.CreateComponents()}if(this.CompOwner==null&&this.iFrmOffs==null){this.iFrmOffs=new IDVariant(this.ParamsObj().MAX_FORMS)}if(this.CompOwner==null&&this.InitComps==null){this.InitComps=new ArrayList()}for(var a=0;a<this.CompList.Count();a++){this.CompList[a].SetOwner(this)}if(this.CompOwner==null&&WebEntryPointSrv.cmpInited==1){WebEntryPointSrv.cmpInited=2}};WebEntryPointSrv.prototype.SetOwner=function(a){if(this.CompOwner==null){this.CompOwner=a}this.DTTObj=this.CompOwner.DTTObj;this.ErrObj=this.CompOwner.ErrObj;this.RTCObj=this.CompOwner.RTCObj;this.StackForm=this.CompOwner.StackForm;this.ConfStack=this.CompOwner.ConfStack;this.confirmNodes=this.CompOwner.confirmNodes;this.UrlParams=this.CompOwner.UrlParams;this.RDToken=this.CompOwner.RDToken;this.PrelImgs=this.CompOwner.PrelImgs;this.TempFiles=this.CompOwner.TempFiles;this.PDFPrints=this.CompOwner.PDFPrints;this.RD3Events=this.CompOwner.RD3Events;this.ParamsObj().UseRD3=this.CompOwner.ParamsObj().UseRD3;this.ParamsObj().DefaultDateMask=this.CompOwner.ParamsObj().DefaultDateMask;this.ParamsObj().DefaultTimeMask=this.CompOwner.ParamsObj().DefaultTimeMask;this.ParamsObj().UseDecimalDot=this.CompOwner.ParamsObj().UseDecimalDot;this.UseRD=this.CompOwner.UseRD;this.RD3CliExecute=this.CompOwner.RD3CliExecute;this.ProgrBar=this.CompOwner.ProgrBar;this.SessionName=this.CompOwner.SessionName;this.SessionQueryString=this.CompOwner.SessionQueryString;this.LookupCache=this.CompOwner.LookupCache;this.DOModifiedList=this.CompOwner.DOModifiedList;this.WebServicesUrl=this.CompOwner.WebServicesUrl;this.SchemaCache=this.CompOwner.SchemaCache;this.SessionSettings=this.CompOwner.SessionSettings;this.ShellObject=this.CompOwner.ShellObject;this.VoiceObj=this.CompOwner.VoiceObj;this.WebApiObject=this.CompOwner.WebApiObject;if(this.CompOwner.ParamsObj().DemoMode!=0){this.ParamsObj().DemoMode=this.CompOwner.ParamsObj().DemoMode}this.iFrmOffs=this.CompOwner.iFrmOffs;this.InitComps=this.CompOwner.InitComps;var b=(this.InitComps.IndexOf(this.CompNameSpace+".MyWebEntryPoint")!=-1);if(!b){this.ShiftFrmConst(this.iFrmOffs.intValue())}if(!b){this.CmdObj.AppendTo(this.CompOwner.CmdObj)}this.CmdObj=this.CompOwner.CmdObj;if(!b){this.TimerObj.AppendTo(this.CompOwner.TimerObj)}this.TimerObj=this.CompOwner.TimerObj;if(!b){this.IndObj.AppendTo(this.CompOwner.IndObj)}this.IndObj=this.CompOwner.IndObj;if(!b){this.IwImdb.AppendTo(this.CompOwner.IwImdb)}else{this.IwImdb.IMDB=this.CompOwner.IwImdb.IMDB}this.IMDB=this.IwImdb.IMDB;this.VisualStyleList.SynchTo(this.CompOwner.GetVisualStyleList());if(!b){this.SyncObject.AppendTo(this.CompOwner.SyncObject)}this.SyncObject=this.CompOwner.SyncObject;this.iFrmOffs.set(new IDVariant(this.iFrmOffs.intValue()+this.ParamsObj().MAX_FORMS));if(!b){this.InitComps.Add(this.CompNameSpace+".MyWebEntryPoint")}this.InitComponents()};WebEntryPointSrv.prototype.BeginCompRequest=function(){for(var a=0;a<this.CompList.Count();a++){var b=this.CompList[a];if(this.RealPath.length>0&&b.RealPath.length==0){b.AppPath=this.AppPath;b.AppName=this.AppName;b.RealPath=this.RealPath}b.Request=this.Request;b.Response=this.Response;b.Out=this.Out;b.OutStr=this.OutStr;b.RevNum=this.RevNum;b.IDVer=this.IDVer;if(this.RolObj!=null&&b.RolObj==null){b.CreateCompRoles()}b.BeginCompRequest()}};WebEntryPointSrv.prototype.EndCompRequest=function(){for(var a=0;a<this.CompList.Count();a++){var b=this.CompList[a];b.Request=null;b.Response=null;b.EndCompRequest()}};WebEntryPointSrv.prototype.CreateCompRoles=function(){var c=true;if(this.RolObj.iRoles!=null){for(var a=0;a<this.RolObj.iRoles.length&&c;a++){var b=this.RolObj.iRoles[a];if(b!=null&&b.Items.length>0){c=false}}}if((c||this.RTCObj.Enabled)&&this.CompOwner!=null){this.RolObj=this.CompOwner.RolObj;this.QwlRoles=this.CompOwner.QwlRoles}};WebEntryPointSrv.prototype.GetLoader=function(e){if(e==""){return(this.CompNameSpace==null?"self":this.CompNameSpace)}else{var d=new XMLHttpRequest();d.open("GET",e,false);d.setRequestHeader("Content-Type","text/plain");d.send();var f=d.responseText;f=f.substring(5);var a=f.substring(0,f.indexOf(" "));for(var b=0;b<this.CompList.length;b++){var c=this.CompList[b];if(c.CompNameSpace==a){return a}}importScripts(e);return a}};WebEntryPointSrv.prototype.CreateObjFromLibrary=function(LibName,ClsName){var cloader=this.GetLoader(LibName);var pMain=null;if(LibName!=""){for(var i=0;i<this.CompList.length;i++){var cmp=this.CompList[i];if(cmp.CompNameSpace==cloader){pMain=cmp;break}}var ns=cloader;if(pMain==null){pMain=this.GetApplication().GetCompFromNameSpace(ns);if(pMain!=null&&!pMain.SharedInstance){pMain=null}}if(pMain==null){pMain=eval("new "+cloader+".MyWebEntryPoint()");if(pMain.ParamsObj().DemoMode==1){DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",200,"MainFrm.CreateObjFromLibrary","You can't create objects from a DEMO library");return null}pMain.CompNameSpace=ns;pMain.AttachCompTo(this);pMain.SetOwner(this);pMain.TimerObj.ActivateTimers(0,true);this.BeginCompRequest();pMain.InitApp()}}else{pMain=this}var fullName=(pMain.CompNameSpace!=null?pMain.CompNameSpace+".":"")+ClsName;var obj=eval("new "+fullName+"()");var basecls=eval(fullName+".getConstructorName()");if(basecls=="WebFormSrv"){obj.MainFrm=pMain}else{if(basecls=="IDDocument"){obj.SetMainFrm(pMain,pMain.IMDB);obj.AssemblyName=LibName}}return obj};WebEntryPointSrv.prototype.GetLibraryObjList=function(LibName,flDocs){var cloader=this.GetLoader(LibName);var arr=new IDArray();var searchType=(flDocs?"IDDocument":"WebFormSrv");var Types=Object.keys(eval(cloader));for(var i=0;i<Types.length;i++){var t=Types[i];var obj=eval(cloader+"."+t);if(!obj||!obj.prototype){continue}if(t=="MyWebForm"||t=="WebFormSrv"||t=="IDDocument"){continue}if(obj.getConstructorName()==searchType){arr.add_Value(new IDVariant(t))}}return arr};WebEntryPointSrv.prototype.CreateLogFile=function(a){};function WebEntryPointSrvDestructor(){}WebEntryPointSrv.prototype._WebEntryPoint=function(){this.TimerObj.ActivateTimers(0,false);this.DTTObj.SetRequestName("End Request","End Request",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("",DTTEngine.TST_TERM,"Main terminate","");var d=new ArrayList(this.StackForm);for(var a=0;a<d.Count();a++){var b=d[a];this.UnloadForm(b.FormIdx,false);b.ReleaseLock()}if(this.DockedForm()!=null){this.DockedForm().ReleaseLock();this.UnloadForm(this.DockedForm().FormIdx,false)}this.DTTObj.EndRequest();this.DTTObj.EndSession(this);this.INDE_X=null;if(this.IsServerSession()){this.SSManager.RemoveSession(this.SessionName)}};WebEntryPointSrv.prototype.HandleRequest=function(c,f){this.StartRequestTS=new Date();if(this.IEVer==0){try{var b=new IDVariant(this.RealPath+"/temp");VBFiles.RmDir(b);VBFiles.MkDir(b)}catch(d){}if(this.ShellObject.IsInsideShell()){this.SaveAppSetting(new IDVariant("APPNAME"),new IDVariant(this.AppName))}this.RD3CompressFiles=(this.DTTObj.Level==0||this.DTTObj.TraceEnabled);if(this.IsMobile()){this.iSideMenuWidth=0}if(c!=null){this.Request=c;this.BrowserInfo();var a=this.Request.Headers["User-Agent"];if(a!=null&&a.indexOf("CaravelShell")==-1){this.RD3UseManifest=(a.indexOf("iPhone")!=-1||a.indexOf("iPad")!=-1||a.indexOf("Android")!=-1)}}else{if(this.IsServerSession()){this.UseRD=false;this.ParamsObj().UseRD3=false}}this.InitComponents()}};WebEntryPointSrv.prototype.ExtractUrlParams=function(c){try{this.UrlParams.clear();if(c.QueryString.CMD!=null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",1,"MainFrm.ExtractUrlParams","Query string command detected");var f=new ArrayList();f.AddRange(c.QueryString.keys());for(var b=0;b<f.Count();b++){var a=f[b];if(!a.startsWith("WC")){var g=c.QueryString[a];this.UrlParams[a]=g;this.DTTObj.AddParameter("","",a,new IDVariant(g))}}}}catch(d){if(c==null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams","Request = NULL!")}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams","Exception while parsing the URL string",d)}}};WebEntryPointSrv.prototype.ExtractUrlParams2=function(b){if(b==null||b.length==0){return}try{this.UrlParams.clear();if(b.indexOf("CMD=")!=-1){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",1,"MainFrm.ExtractUrlParams2","Query string command detected");while(!b.equals("")){var h;var f=b.indexOf("&");if(f!=-1){h=b.substr(0,f).trim();b=b.substr(f+1)}else{h=b.trim();b=""}f=h.indexOf("=");if(f!=-1){if(!h.startsWith("WC")){var a=h.substr(0,f);var g=Glb.URLDecode(h.substr(f+1));this.UrlParams[a]=g;this.DTTObj.AddParameter("","",a,new IDVariant(g))}}}}}catch(d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",2,"MainFrm.ExtractUrlParams2","Exception while parsing the URL string",d)}};WebEntryPointSrv.prototype.GetUrlParam=function(b){if(b==undefined){b=new IDVariant("CMD")}var a=this.UrlParams[b.stringValue()];if(a==null){a=""}return new IDVariant(a)};WebEntryPointSrv.prototype.GetRequestParams=function(){var a=new IDMap();var c=Object.keys(this.Request.QueryString);for(var b=0;b<c.length;b++){a.set_Value(new IDVariant(c[b]),new IDVariant(this.Request.QueryString[c[b]]))}return a};WebEntryPointSrv.prototype.InitPanelGlbFlags=function(){};WebEntryPointSrv.prototype.IWDTT_UserEvent=function(f,e){var d=this.RDStatus;this.RDStatus=Glb.RD_DISABLED;this.DTTObj.CancelRequest();if(this.Request.SESSNAME!=null){var c=e.GetAttribute("par1");var b=e.GetAttribute("par2");var j=new IDArray();j.add_Value(new IDVariant(f?f:""));j.add_Value(new IDVariant(c?c:""));j.add_Value(new IDVariant(b?b:""));var h=this.SendSessionMessage(this.Request.SESSNAME,Glb.ITEM_DTT,0,j);var g=new XMLDoc();g.LoadFromString(h.stringValue());if(g.HasNextNode()){g.GetNextNode();var a=g.GetNextNode();this.WriteStrDbgMain(a.GetAttribute("WIN"));this.WriteStrDbgItemList(a.GetAttribute("IL"));this.WriteStrDbgCmdForm(a.GetAttribute("CMD"));this.WriteStrDbgDetail(a.GetAttribute("DET"));this.WriteStrDbgReqTop(a.GetAttribute("TOP"));this.WriteStrDbgReqRef(a.GetAttribute("REF"));this.WriteStrDbgReqPrc(a.GetAttribute("PRC"))}}else{this.DTTObj.Render(this,f,e)}this.RDStatus=d};WebEntryPointSrv.prototype.IWHelp_UserEvent=function(a){var c=this.RDStatus;this.RDStatus=Glb.RD_DISABLED;this.DTTObj.CancelRequest();try{this.DTTObj.RenderHelp(this,a)}catch(b){WriteToConsoleError(b)}this.RDStatus=c};WebEntryPointSrv.prototype.IWLogin_UserEvent=function(a){};WebEntryPointSrv.prototype.IWBlob_UserEvent=function(a){if(this.RolObj.CheckRole()){var c=this.ActiveForm();var b=this.Request.WCU;if(b!=null&&b.indexOf("dock")>-1){c=this.DockedForm()}if(c!=null){this.DTTObj.SetRequestName("Download","Download BLOB",DTTRequest.PRI_ITEM);if(c.DownloadBlob(a)){}else{}}}};WebEntryPointSrv.prototype.SessionAbandon=function(){};WebEntryPointSrv.prototype.IWLogoff_UserEvent=function(a){};WebEntryPointSrv.prototype.IWTest_UserEvent=function(a){};WebEntryPointSrv.prototype.TreeDropHelper=function(c,m,g,a,j){var l=null;var b=null;var h="";var e="";if(c!=null){h=c.HashKey;b=c.TreeObj}if(m!=null){e=m.HashKey;l=m.TreeObj}if(l!=null){this.DTTObj.SetRequestName("Tree Drop","Node Tree dropped",DTTRequest.PRI_ITEM);var d=false;if(l.IsDO&&b.IsDO){d=true;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,182,"MainFrm.TreeDrop","Tree "+l.Code+": dropped node "+c.Doc.GetName()+(l==b?"":" (from tree "+b.Code)+" onto node "+m.Doc.GetName());var o=new IDVariant(0);l.FireOnDropDoc(c.Doc,m.Doc,g,a,j,o);if(b.SelectMulti()){for(var f=0;f<b.Nodes.Count();f++){var k=b.Nodes[f];if(k!=c&&k.Doc!=null){if(k.Doc.Selected()){l.FireOnDropDoc(k.Doc,m.Doc,g,a,j,o)}}}}}if(!l.IsDO&&!b.IsDO){d=true;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,182,"MainFrm.TreeDrop","Tree "+l.Code+": dropped node "+c.Key+" (Hash Code = "+c.HashKey+(l==b?"":" from tree "+b.Code)+") onto node "+m.Key+" (Hash Code = "+m.HashKey+")");l.FireOnDrop(h,b.FrIndex,e,g,a,j);if(b.SelectMulti()){for(var f=0;f<b.Nodes.Count();f++){var k=b.Nodes[f];if(k!=c&&k.Selected()){l.FireOnDrop(k.HashKey,b.FrIndex,e,g,a,j)}}}}if(!d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,l.iGuid,183,"MainFrm.TreeDrop","Tree "+b.Code+" and Tree "+l.Code+" are of different type")}}};WebEntryPointSrv.prototype.IW3C_UserEvent=function(a){};WebEntryPointSrv.prototype.FatalErrorResponse=function(a){this.TraceError(a)};WebEntryPointSrv.prototype.BeginRequest=function(){if(this.Request!=null){if(this.IEVer==0){var b=this.Request.Headers["User-Agent"];if(b!=null){var j=b.indexOf("MSIE");var g=b.indexOf(";",j+1);if(j>-1&&g>-1){this.IEVer=9*100;if(b.indexOf("Shell")!=-1){this.IEVer=1000}if(this.IEVer>=600&&this.ParamsObj().HtmlConstraints==Glb.WEBVALID_STRICT){this.BrowserClass=Glb.BRWCLS_IESTRICT}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected IE Version "+this.IEVer+" (User Agent = "+b+", Host = "+this.HostName+")")}else{if(b.indexOf("Trident/7.0")!=-1){this.IEVer=1100;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected IE Version "+this.IEVer+" (User Agent = "+b+", Host = "+this.HostName+")")}else{if(b.indexOf("Instant Developer")!=-1){this.IEVer=700;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Instant Developer Wizard")}else{this.IEVer=-1;if(b.indexOf("Firefox")!=-1||b.indexOf("SymbianOS")!=-1||b.indexOf("Safari")!=-1||b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Opera")!=-1||b.indexOf("Android")!=-1){this.BrowserClass=Glb.BRWCLS_FIREFOX;if(b.indexOf("Firefox")!=-1){j=b.indexOf("Firefox/");g=b.indexOf(".",j);var a=0;try{a=parseInt(b.substr(j+8,g-j-8),10)}catch(f){}if(a>=2){this.IEVer=600}if(a>=3){this.IEVer=700}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected FFX Version "+a+" (User Agent = "+b+", Host = "+this.HostName+")")}else{if(b.indexOf("SymbianOS")!=-1){this.BrowserSubClass=Glb.BRWSCL_SYMBIAN;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected SymbianOS (User Agent = "+b+", Host = "+this.HostName+")")}else{if(b.indexOf("Safari")!=-1||b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Android")!=-1){this.BrowserSubClass=Glb.BRWSCL_SAFARI;j=b.indexOf("Version/");if(b.indexOf("iPhone")!=-1||b.indexOf("iPad")!=-1||b.indexOf("Android")!=-1){this.IEVer=700;this.ParamsObj().TruePopup=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected iPhone/iPad/Android safari browser (User Agent = "+b+", Host = "+this.HostName+")")}else{if(j==-1&&b.indexOf("Chrome")!=-1){this.IEVer=700;this.ParamsObj().TruePopup=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Google Chrome (User Agent = "+b+", Host = "+this.HostName+")")}else{g=b.indexOf(".",j);var a=0;try{a=parseInt(b.substr(j+8,g-j-8),10)}catch(f){}if(a>=3){if(a==4&&this.ParamsObj().UseRD&&!this.ParamsObj().UseRD3){this.ParamsObj().UseIDTag=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","IDTag disabled due to a Safari4 limitation")}this.IEVer=700;this.ParamsObj().TruePopup=false}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",160,"MainFrm.BeginRequest","Detected Safari Version "+a+" (User Agent = "+b+", Host = "+this.HostName+")")}}}else{if(b.indexOf("Opera")!=-1){j=b.indexOf("Version");var h=0;try{h=parseFloat(b.substr(j+8))}catch(f){}if(h>=10){this.IEVer=700}this.ParamsObj().UseIDTag=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","IDTag disabled due to a Opera10 limitation");this.ParamsObj().TruePopup=false;this.BrowserSubClass=Glb.BRWSCL_OPERA}}}}this.ParamsObj().HtmlConstraints=Glb.WEBVALID_STRICT}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",160,"MainFrm.BeginRequest","Browser not recognized (User Agent = "+b+", Host = "+this.HostName+")")}}}}}this.DumpVersions(false);this.HostName=(this.Request.UserHostName!=null?this.Request.UserHostName:this.Request.UserHostAddress);if(this.ParamsObj().UseRD3&&this.IEVer<700){var c=true;if(this.BrowserClass!=Glb.BRWCLS_FIREFOX&&this.IEVer>=600){c=false}if(c){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",161,"MainFrm.BeginRequest","RD3 disabled: this browser doesn't support it");this.ParamsObj().UseRD3=false}}if(this.UseRD&&this.IEVer<600){this.UseRD=false;this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",161,"MainFrm.BeginRequest","RD has been disabled because your browser cannot support it")}}}else{this.IEVer=-1;this.DumpVersions(false);if(!Glb.IsJSharpAvailable()){this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",166,"MainFrm.BeginRequest","Framework J# not available. You should consider installing the J# framework for better performances in creating PDF documents.")}}this.ErrObj.ClearError()};WebEntryPointSrv.prototype.EndRequest=function(){if(this.CompOwner==null){myPostMessage({type:"progress",message:null});this.DTTObj.EndRequest()}this.DispatchToComp("EndRequest",new Array())};WebEntryPointSrv.prototype.IWApp_Respond=function(){this.IWApp_UserEvent("")};WebEntryPointSrv.prototype.IWApp_UserEvent=function(a){if(this.DTTObj!=null&&a.length>3&&a.substr(0,3).equals("SID")){this.DTTObj.RecordRunning=true;a=a.substr(3);if(a.indexOf("-H")!=-1){if(this.DTTObj.HelpGeneration){this.DTTObj.HelpGenerationActive=true;this.DTTObj.CreateNewHelpItem()}a=IDL.Replace(new IDVariant(a),new IDVariant("-H"),new IDVariant("")).stringValue()}if(this.DTTObj.SessionID!=0&&(new IDVariant(a)).intValue()!=this.DTTObj.SessionID){return}this.DTTObj.SessionID=(new IDVariant(a)).intValue()}if(this.ParamsObj().UseRD3&&a==""&&this.Request.WCI==null){this.RD3Reset()}this.RenderPage()};WebEntryPointSrv.prototype.GetPageTitle=function(){var a=this.Caption().stringValue();if(this.ActiveForm()!=null){a=a+" - "+this.ActiveForm().Caption()}return Glb.HTMLEncode(a,false,true)};WebEntryPointSrv.prototype.RenderPage=function(){};WebEntryPointSrv.prototype.IWMenu_UserEvent=function(a){if(a.equals(".")){}else{if(a.equals("EXP")){this.CmdObj.set_SuppressMenu(false);this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",3,"MainFrm.MenuHandler","Expand command detected");this.DTTObj.SetRequestName("Expand Menu","Expand menu",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("EXP",DTTEngine.TST_MENU,"Main expand menu","","");this.DTTObj.AddHelpItem(0,0,0,0,"Mostra il menu principale");this.OnExpandMenu()}else{if(a.equals("CON")){this.CmdObj.set_SuppressMenu(true);this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",4,"MainFrm.MenuHandler","Collapse command detected");this.DTTObj.SetRequestName("Collapse Menu","Collapse menu",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("CON",DTTEngine.TST_MENU,"Main collapse menu","","");this.DTTObj.AddHelpItem(0,0,0,0,"Nascondi il menu principale");this.OnExpandMenu()}else{if(this.RolObj.CheckRole()){this.CmdObj.UserEvent(a)}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",5,"MainFrm.MenuHandler","Unhandled menu command: undefined session role")}}}}if(!this.ParamsObj().UseRD3){this.RenderPage()}};WebEntryPointSrv.prototype.IWSbInd_UserEvent=function(a){};WebEntryPointSrv.prototype.UrlFor=function(b,c,a){if(c==undefined){c=""}if(a==undefined){a=false}var d=this.AppName+"?WCI="+this.WebItem+"&amp;WCE="+c;if(this.URLData.length>0&&!a){d+=("&amp;WCU="+this.URLData)}if(this.WebItem.equals(Glb.ITEM_DTT)&&this.Request!=null&&this.Request.SESSNAME!=null){d+="&amp;SESSNAME="+this.Request.SESSNAME}return d};WebEntryPointSrv.prototype.UrlForDTT=function(a,c,g,f,d,b){if(c==undefined){c=""}if(g==undefined){g=""}if(f==undefined){f=""}if(d==undefined){d=""}if(b==undefined){b=true}var e='sendToApplication("'+a+'","'+c+'","'+g+'",'+(b?'"':"")+f+(b?'"':"")+',"'+d+'");';return e};WebEntryPointSrv.prototype.UrlForEnc=function(a,b){var c=this.AppName+"?WCI="+a;if(b.length>0){c+=("&amp;WCE="+b)}if(this.URLData.length>0){c+=("&amp;WCU="+this.URLData)}return c};WebEntryPointSrv.prototype.UserRole=function(){return this.RolObj.glbRole};WebEntryPointSrv.prototype.set_UserRole=function(a){this.RolObj.glbRole=a;this.RolObj.Clear();this.RolObj.EnableRole(a,true,false)};WebEntryPointSrv.prototype.UserName=function(){return this.RolObj.glbUser};WebEntryPointSrv.prototype.set_UserName=function(a){this.RolObj.glbUser=a;this.DTTObj.UserID=(parseInt(a.stringValue(),10));if(!isNaN(this.DTTObj.UserID)){this.DTTObj.Name=a.stringValue()}this.DTTObj.HelpName=a.stringValue()};WebEntryPointSrv.prototype.Caption=function(){return(this.CompOwner!=null?this.CompOwner.Caption():new IDVariant(this.iCaption))};WebEntryPointSrv.prototype.set_Caption=function(a){if(this.CompOwner!=null){this.CompOwner.set_Caption(a)}else{if(!a.equals(this.iCaption)){this.iCaption.set(a);this.RD3Change(RD3Glb.WEP_CAPTION)}}};WebEntryPointSrv.prototype.Image=function(){return(this.CompOwner!=null?this.CompOwner.Image():this.iImage)};WebEntryPointSrv.prototype.set_Image=function(a){if(this.CompOwner!=null){this.CompOwner.set_Image(a)}else{if(a!=this.iImage){this.iImage=a;this.RD3Change(RD3Glb.WEP_IMAGE)}}};WebEntryPointSrv.prototype.GetFormByIndex=function(a,e){if(e==undefined){e=null}if(this.DockedForm()!=null&&this.DockedForm().FormIdx==a){return this.DockedForm()}if(this.ActiveForm()!=null&&this.ActiveForm().FormIdx==a){return this.ActiveForm()}var d=(e!=null?e:this.StackForm);for(var b=0;b<d.Count();b++){var c=d[b];if(c.FormIdx==a){return c}}return null};WebEntryPointSrv.prototype.CreateFormByIndex=function(a){return null};WebEntryPointSrv.prototype.BringToFront=function(a){if(a==-1){var c=new IDVariant();if(this.ActiveForm()!=null){var b=this.ActiveForm();b.Form_Deactivate(c);b.SubForm_Deactivate(c)}this.set_ActiveForm(null);this.SetHelpFile(this.HelpFile);this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}var d=this.GetFormByIndex(a);if(d!=null){if(d.Visible){var c=new IDVariant();if(this.ActiveForm()!=null){var b=this.ActiveForm();b.Form_Deactivate(c);b.SubForm_Deactivate(c);if(this.ActiveForm()!=null&&!this.ActiveForm().Visible){c=IDVariant.FALSE}}if(c.isFalse()){if(this.ActiveForm()!=d||this.IsMobile()){this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}this.set_ActiveForm(d);this.SetHelpFile(this.ActiveForm().HelpFile);var b=this.ActiveForm();b.Form_Activate();b.SubForm_Activate();if(this.ParamsObj().Theme.equals("classic")){this.StackForm.Remove(d);this.StackForm.Insert(0,d)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",13,"MainFrm.BringToFront","Form "+this.ActiveForm().Caption()+" refuses to deactivate (cancel := true)");this.RD3Change(RD3Glb.WEP_ACTIVEFORM)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",172,"MainFrm.BringToFront","Form "+d.Caption()+" is not visible and I cannot bring it to front")}}};WebEntryPointSrv.prototype.GetFormToFocus=function(){var c=null;for(var a=0;a<this.StackForm.Count();a++){var b=this.StackForm[a];if(b.Visible&&!b.Docked&&b.WindowState()!=Glb.WS_MINIMIZE&&(c==null||b.ActivedTick>c.ActivedTick)){c=b}}return c};WebEntryPointSrv.prototype.UnloadForm=function(j,a){if(a==undefined){a=false}var g=this.GetFormByIndex(j);if(this.DockedForm()!=null&&this.DockedForm().FormIdx==j){g=this.DockedForm()}if(g!=null){var m=new IDVariant();g.UnloadForm(m,a);if(m.intValue()!=0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",153,"MainFrm.UnloadForm","Form "+g.Caption()+" refuses to close (cancel := true)");return}if(this.ActiveForm()==g){this.set_ActiveForm(null)}this.TimerObj.ActivateTimers(j,false);if(g.IsMultiple()){this.CmdObj.CloseMultipleForm(j)}var b=new ArrayList();g.GetSubForm(b);for(var d=0;d<b.Count();d++){var h=b[d];this.CmdObj.CloseMultipleForm(h.FormIdx)}if(this.DockedForm()==g){this.set_DockedForm(null);if(g.DockType==Glb.FORMDOCK_LEFT||g.DockType==Glb.FORMDOCK_RIGHT){this.ResizeClient(this.ScreenW()+g.OrgWidth-g.GetPadding(false)-1,this.ScreenH(),false)}else{this.ResizeClient(this.ScreenW(),this.ScreenH()+g.OrgHeight-g.GetPadding(true)-1,false)}}else{this.StackForm.Remove(g)}var c=this.RD3AddEvent("close",g.GetRD3Ident());for(var d=this.RD3Events.Count()-2;d>=0;d--){var k=this.RD3Events[d];if(k.Name.equals("open")){this.RD3Events.Remove(c);this.RD3Events.Insert(d,c);break}}if(this.UseZones()&&g.Docked&&this.ScreenZone(g.DockType)!=null){if(this.ScreenZone(g.DockType).SelectedForm()==g.FormIdx){this.ScreenZone(g.DockType).ActivateNextForm()}}var l=this.GetFormByIndex(g.Owner,this.GetLiveForms());if(l!=null){if(this.ActiveForm()==null||g.OpenAs==Glb.OPEN_MDI){this.BringToFront(l.FormIdx)}l.EndModal(j,a)}if(this.ActiveForm()==null){this.ActivateNextForm()}if(this.WidgetMode&&this.StackForm.Count()==0){this.ExitApp("")}}else{g=this.GetFormByIndex(j,this.GetLiveForms());if(g!=null){g.UnloadForm(new IDVariant(),false)}}};WebEntryPointSrv.prototype.ActivateNextForm=function(){if(this.ActiveForm()!=null){var a=new IDVariant();this.ActiveForm().Form_Deactivate(a);this.ActiveForm().SubForm_Deactivate(a);if(a.isTrue()){return}}this.set_ActiveForm(this.GetFormToFocus());if(this.ActiveForm()!=null){this.ActiveForm().Form_Activate();this.ActiveForm().SubForm_Activate()}this.RD3Change(RD3Glb.WEP_ACTIVEFORM);if(this.ActiveForm()!=null){this.SetHelpFile(this.ActiveForm().HelpFile)}else{this.SetHelpFile(this.HelpFile)}};WebEntryPointSrv.prototype.GetForm=function(a,c,e,d){if(c==undefined){c=false}if(e==undefined){e=true}var b=this.GetFormByIndex(a);if(b==null&&e){this.Show(a,c,d)}return this.GetFormByIndex(a)};WebEntryPointSrv.prototype.FormIsActive=function(a){return(this.ActiveForm()!=null)&&(this.ActiveForm().FormIdx==a)};WebEntryPointSrv.prototype.Show=function(a,c,b){if(typeOf(a)=="string"){return false}};WebEntryPointSrv.prototype.IWForm_UserEvent=function(a){if(this.RolObj.CheckRole()){var d=this.ActiveForm();if(this.URLData.indexOf("dock")>-1){d=this.DockedForm()}if(d!=null){var c=parseInt(this.Request.IntSesNumber,10);if(c==this.IntSesNumber||this.IntSesNumber==0||this.RDStatus==Glb.RD_ACTIVE||this.ParamsObj().UseRD3){var b=this.GetParameter("ACE");if(b!=null&&b.length>0){d.ActiveElement=b}d.FocusPriority=0;d.ProcessRequest(this.Request,true);this.UpdateIMDBState();if(d!=null&&!a.equals(".")){d.ProcessRequest(this.Request,false)}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",154,"MainFrm.FormEvent","Form event handling failed (session numbers do not match)")}}}else{this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",24,"MainFrm.FormEvent","Form event handling failed (undefined session role)")}if(!a.equals(".")){this.RenderPage()}};WebEntryPointSrv.prototype.IWUpload_UserEvent=function(a){if(this.RolObj.CheckRole()){var e=this.ActiveForm();var d=this.Request.WCU;if(d!=null&&d.indexOf("dock")>-1){e=this.DockedForm()}if(this.ParamsObj().UseRD3){var h=0;if(a.indexOf("fld:")>-1){h=a.lastIndexOf(":")}var b=parseInt(a.substr(h+1),10);if(e==null||(!isNaN(b)&&e.FormIdx!=b)){e=this.GetFormByIndex(b,this.GetLiveForms())}}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",155,"MainFrm.IWUpload","Upload BLOB request detected");this.DTTObj.SetRequestName("Upload","Upload BLOB",DTTRequest.PRI_ITEM);if(e!=null){var g=this.Request.QueryString.WCE;var c=null;if(g!=null){c=this.RD3FindField(g)}if(c==null){e.ProcessRequest(this.Request,true)}else{c.Parent.UploadBlob(this,e,this.Request)}}}};WebEntryPointSrv.prototype.IWFiles_UserEvent=function(h){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",155,"MainFrm.IWFiles","Upload Files request detected");this.DTTObj.SetRequestName("Upload Files","Upload Files",DTTRequest.PRI_ITEM);var j=null;var b=h;if(h!=null&&h.length>0){j=this.FindWebForm(h);if(j!=null){b=""}}var m="";if(this.Request.Files.length>0){for(var k=0;k<this.Request.Files.length;k++){var o=this.Request.Files[k];try{var a="";var c=o.FileName.lastIndexOf(".");var k=new IDVariant(o.Content);if(c>-1){a=o.FileName.substr(c+1)}var d=new IDVariant(o.Content);this.OnFileUploaded(new IDVariant(b),new IDVariant(o.FileName),new IDVariant(o.ContentLength,1),new IDVariant(o.ContentType),d,j);if(o.ContentLength>0){var q=d.stringValue();if(q.length>0){if(q.indexOf("/")==-1&&q.indexOf("\\")==-1||q.charAt(0)!="/"){q=this.RealPath+"/"+q}VBFiles.Rename(k,new IDVariant(q));if(j!=null){if(q.equals(o.Content)){this.TempFiles.Add(q)}}else{}}else{VBFiles.Delete(k)}}}catch(l){WriteToConsoleError("Error while saving uploaded file: "+o.FileName+":");WriteToConsoleError(l)}}}else{this.OnFileUploaded(new IDVariant(b),new IDVariant(),new IDVariant(-1),new IDVariant(),new IDVariant(),j)}if(j==null){var g=true;if(b.indexOf("EditIMG")>-1){g=false;if(!this.DisableRender){this.SendHtml(m)}}if(g){this.SendHtml("ok")}}this.RenderPage()};WebEntryPointSrv.prototype.OnFileUploaded=function(b,a,e,d,f,c){this.DispatchToComp("OnFileUploaded",new Array(b,a,e,d,f,c))};WebEntryPointSrv.prototype.OpenConnection=function(a){};WebEntryPointSrv.prototype.CmdClickCB=function(a){this.DispatchToComp("CmdClickCB",new Array([a]))};WebEntryPointSrv.prototype.TimerTickCB=function(a){this.DispatchToComp("TimerTickCB",new Array([a]))};WebEntryPointSrv.prototype.UpdateIMDBState=function(){for(var a=0;a<this.DOModifiedList.Count();a++){var d=this.DOModifiedList[a];d.ProcessChange(false)}this.DOModifiedList.Clear();if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",7,"MainFrm.UpdateIMDBState","IMDB is changed: Updating Controls");this.UpdateControls()}var b=this.GetLiveForms();for(var a=0;a<b.Count();a++){var c=b[a];if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()||(c.IsMultiple()&&c.IMDB.IsModified(Glb.GlbRefModIdx))){c.UpdateControls()}}if(this.IwImdb.IMDB.IsModified(Glb.GlbRefModIdx)||this.RefreshUI()){if(this.DockedForm()!=null){this.DockedForm().UpdateControls()}this.IwImdb.IMDB.ResetModified(Glb.GlbRefModIdx);this.set_RefreshUI(false)}};WebEntryPointSrv.prototype.ExitApp=function(a){if(a.length==0){a="about:blank"}if(a.equals("???")){if(this.UseRD){a=this.UrlFor(Glb.ITEM_FRAMES)}else{a=this.UrlFor(Glb.ITEM_APP)}}this.SessionAbandon();if(!this.DisableRender){if(this.RDStatus==Glb.RD_ACTIVE||(this.ParamsObj().UseRD3&&this.DesktopRendered)){this.RDExitURL=a}}};WebEntryPointSrv.prototype.Redirect=function(a){if(this.RDStatus==Glb.RD_ACTIVE||(this.ParamsObj().UseRD3&&this.DesktopRendered)){this.RDExitURL=a}};WebEntryPointSrv.prototype.LogoffButton=function(){return null};WebEntryPointSrv.prototype.log=function(a){WriteToConsoleOutput(a)};WebEntryPointSrv.prototype.GetMimeType=function(a){WriteToConsoleError("MIME = "+this.getClassName());return null};WebEntryPointSrv.prototype.GetSetting=function(b,a){if(b.stringValue().equals("FORM")){return IDVariant.convertObject(this.GetParameter(a.stringValue()))}if(b.stringValue().equals("SES")){if(this.IsServerSession()){return new IDVariant()}else{return this.SessionSettings[a.stringValue()]}}if(b.stringValue().equals("APP")){return this.GetAppSetting(a)}if(!this.IsServerSession()){}return new IDVariant()};WebEntryPointSrv.prototype.GetAppSetting=function(a){return new IDVariant()};WebEntryPointSrv.prototype.SaveSetting=function(c,a,b){if(c.stringValue().equals("SES")){if(!this.IsServerSession()){if(b.stringValue().Length==0){this.SessionSettings.remove(a.stringValue())}else{this.SessionSettings.add(a.stringValue(),b)}}return}if(c.stringValue().equals("APP")){this.SaveAppSetting(a,b);return}if(!this.IsServerSession()){}};WebEntryPointSrv.prototype.SaveAppSetting=function(a,b){};WebEntryPointSrv.prototype.OpenResponse=function(a){};WebEntryPointSrv.prototype.ShowLogin=function(){};WebEntryPointSrv.prototype.UpdateControls=function(){this.DispatchToComp("UpdateControls",new Array())};WebEntryPointSrv.prototype.RefreshAllLookups=function(g,b){if(g==undefined){g=null}if(b==undefined){b=null}var l=new ArrayList();for(var e=0;e<this.LookupCache.Count();e++){var k=this.LookupCache[e];var a=true;if(g==null&&b==null){a=false}else{if(g!=null&&String.compare(k.GetClass().GetClassName(),g,true)==0){a=false}else{if(b!=null&&k.GetMD()!=null&&String.compare(k.GetMD().DBCode,b,true)==0){a=false}}}if(a){l.Add(k)}}this.LookupCache.Clear();this.LookupCache.AddRange(l);for(var e=0;e<this.StackForm.Count();e++){var h=this.StackForm[e];for(var c=0;c<h.Frames.length;c++){if(h.Frames[c]!=null&&h.Frames[c].Content instanceof IDPanelSrv){h.Frames[c].Content.RefreshLookup(g,b)}}}};WebEntryPointSrv.prototype.GetNewGuid=function(){var a=new GUID();return new IDVariant(a.ToString())};WebEntryPointSrv.prototype.OnCommand=function(a){this.DispatchToComp("OnCommand",new Array(a))};WebEntryPointSrv.prototype.OnResize=function(){this.DispatchToComp("OnResize",new Array())};WebEntryPointSrv.prototype.OnChangeLocation=function(a){this.DispatchToComp("OnChangeLocation",new Array(a))};WebEntryPointSrv.prototype.OnDeviceMotion=function(a){this.DispatchToComp("OnDeviceMotion",new Array(a))};WebEntryPointSrv.prototype.SetHelpFile=function(a){if(this.CompOwner!=null){this.CompOwner.SetHelpFile(a)}else{if(a!=null&&!a.equals(this.iActiveHelpFile)){this.iActiveHelpFile=a;this.RD3Change(RD3Glb.WEP_HELPFILE)}}};WebEntryPointSrv.prototype.DTTTrace=function(){if(this.DTTObj.AddTraceItem("",DTTEngine.TRC_ITMAIN,"MainFrm.Render","")){this.DTTObj.AddTraceToken(this.RTCObj.AppGuid,DTTEngine.TRC_MAINCAPTION,"Caption",this.Caption(),"");for(var a=1;a<this.IndObj.Indicators.length;a++){if(this.IndObj.Indicators[a]==null){continue}if(this.IndObj.Indicators[a].IdxForm==0&&this.IndObj.Indicators[a].bVisible(0)){this.DTTObj.AddTraceToken(this.IndObj.Indicators[a].iGuid,DTTEngine.TRC_MAININDIC,"Indicator "+this.IndObj.Indicators[a].Code,this.IndObj.Indicators[a].bText(0),"")}if(this.ActiveForm()!=null&&IndObj.Indicators[a].IdxForm==this.ActiveForm().FormIdx&&this.IndObj.Indicators[a].bVisible(this.IndObj.Indicators[a].IdxForm)){this.DTTObj.AddTraceToken(this.IndObj.Indicators[a].iGuid,DTTEngine.TRC_FORMINDIC,"Indicator "+this.IndObj.Indicators[a].Code,this.IndObj.Indicators[a].bText(this.ActiveForm().FormIdx),"")}}if(this.ActiveForm()!=null){for(var c=0;c<this.ActiveForm().Messages.Count();c++){var b=this.ActiveForm().Messages[c];this.DTTObj.AddTraceToken(this.ActiveForm().RTCGuid,DTTEngine.TRC_FORMMESSAGE,"Message",b.Text,"")}}}};WebEntryPointSrv.prototype.OpenDebugWindow=function(g,a,d){if(g==undefined){g=0}if(a==undefined){a=""}if(d==undefined){d=""}if(typeof(g)=="string"){a=g;g=0}try{var c=false;if(g!=0&&this.DTTObj.DB!=null){var b=new IDCachedRowSet();this.OpenConnection(this.DTTObj.DB);b.setCommand("select SessSnapshot from DTTSessions where SessID = "+g);b.execute(new ArrayList(),this.DTTObj.DB);if(!b.EOF()){b.MoveFirst()}if(b.Get(1).Type==IDVariant.NULL){a="";this.DTTObj.LoadFromDB(g)}else{a=Glb.SaveBlob(this,b.Get(1)).stringValue();c=true}this.DTTObj.RefDTTObj=null}if(!a.equals("")){this.DTTObj.LoadSnapshot(a);if(c){File.Delete(a)}}if(!d.equals("")){this.Request.SESSNAME=d}this.IWDTT_UserEvent("",null)}catch(f){WriteToConsoleError(f)}};WebEntryPointSrv.prototype.CheckDTTDiff=function(a,b){this.set_RedirectTo(new IDVariant(this.UrlFor(Glb.ITEM_TEST,"TS"+IDL.FormatMessage(new IDVariant("|1-|2"),new IDVariant(a),new IDVariant(b)).stringValue())));this.set_RedirectNewWindow(true)};WebEntryPointSrv.prototype.SetUrlData=function(a){this.URLData="";if(this.ParamsObj().IWCacheControl.equals("URL")){this.URLData=Math.floor(Math.random()*2147483647).toString()}this.URLData=this.URLData+a};WebEntryPointSrv.prototype.WriteStr=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStr(a);return}this.Response.responseText+=a};WebEntryPointSrv.prototype.WriteStrDbgMain=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgMain(a);return}this.DebugWindow=this.DebugWindow+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgItemList=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgItemList(a);return}this.DebugItemList=this.DebugItemList+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgCmdForm=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgCmdForm(a);return}this.DebugCmdForm=this.DebugCmdForm+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgDetail=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgDetail(a);return}this.DebugDetail=this.DebugDetail+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqTop=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqTop(a);return}this.DebugReqTop=this.DebugReqTop+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqRef=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqRef(a);return}this.DebugReqRef=this.DebugReqRef+a;this.SendDebug=true};WebEntryPointSrv.prototype.WriteStrDbgReqPrc=function(a){if(this.CompOwner!=null){this.CompOwner.WriteStrDbgReqPrc(a);return}this.DebugReqPrc=this.DebugReqPrc+a;this.SendDebug=true};WebEntryPointSrv.prototype.RenderDifferences=function(a){};WebEntryPointSrv.prototype.IWRD_Respond=function(){this.IWRD_UserEvent("")};WebEntryPointSrv.prototype.IWRD_UserEvent=function(a){};WebEntryPointSrv.prototype.GetToken=function(b,a){var d=b.indexOf(a+"=");if(d!=-1){var c=b.substr(d).indexOf("&");if(c==-1){c=b.length}else{c+=d}return Value=b.substr(d+a.length+1,c-(d+a.length+1))}return""};WebEntryPointSrv.prototype.GetAllTokens=function(c){this.RDToken.clear();var e=0;c=Glb.HTMLDecode(c);if(this.BrowserClass==Glb.BRWCLS_FIREFOX){c=c.replace(/\r\n/g,"\n")}if(c.length<1){return}while(e!=-1){e=c.indexOf(":");if(e!=-1){var d=c.substr(e+1).indexOf(":")+e+1;if(d>0){var f=(new IDVariant(c.substr(e+1,d-(e+1)))).intValue();var b=c.substr(0,e);var a=c.substr(d+1,f);if(this.BrowserClass==Glb.BRWCLS_FIREFOX){a=a.replace(/\n/g,"\r\n")}this.RDToken[b]=a;e=d+f+1;c=c.substr(e)}else{c=""}}}};WebEntryPointSrv.prototype.GetParameter=function(a){if(this.RDToken.count()>0){return this.RDToken[a]}else{return this.Request[a]}};WebEntryPointSrv.prototype.CanUseIDTag=function(){if(this.ParamsObj().UseIDTag){if(this.RDStatus==Glb.RD_ACTIVE&&this.IEVer>550){return true}}return false};WebEntryPointSrv.prototype.AddMultipleForm=function(e,g){var d=65536;var j;var a=null;var k;var c=this.GetLiveForms();k=e.FormIdx;while(true){j=k+d;a=this.GetFormByIndex(j,c);d=d+65536;if(a==null){break}}e.FormIdx=j;e.ActivedTick=this.ClickCounter()+1;if(!g){this.StackForm.Insert(0,e)}e.BaseTimerIdx=this.TimerObj.OpenMultipleForm(j);var b=new ArrayList();e.BaseCmdSetIdx=this.CmdObj.OpenMultipleFormCS(j,b);e.BaseCmdLinIdx=this.CmdObj.OpenMultipleFormCL(j,b);if(!g){var h=this.RD3AddEvent("open","frm:"+e.FormIdx)}};WebEntryPointSrv.prototype.ShowMultipleForm=function(g,h,e){if(e==undefined){e=null}if(g.IMDB==null){g.SetMainFrm(g.MainFrm,this.IMDB)}var d=0;if(h==Glb.OPEN_POPUP&&this.RDLevel()<3){h=Glb.OPEN_MDI}var a=null;if(h!=Glb.OPEN_MDI||this.IsMobile()){a=(h!=Glb.OPEN_MDI?this.ActiveForm():null);if(e!=null&&e instanceof WebFormSrv){a=e}if(a!=null&&a.Docked&&h==Glb.OPEN_MDI&&!this.IsSmartPhone()){a=null}if(a!=null){d=a.FormIdx}else{if(h!=Glb.OPEN_MDI){d=32767}}}if(h!=Glb.OPEN_MDI){for(var b=0;b<this.RD3Events.Count();b++){var c=this.RD3Events[b];if(c.Name.equals("open")&&c.Ident.equals(g.GetRD3Ident())){c.SetAttribute("openas",h.toString())}}}g.OpenAs=h;g.Owner=d;g.Visible=true;if(a!=null&&a.OpenAs==Glb.OPEN_MDI&&h==Glb.OPEN_MDI&&!g.Docked&&!a.Docked){g.set_BackButTxt(a.Caption().stringValue())}if(h==Glb.OPEN_MDI&&g.Docked&&this.UseZones()&&this.ScreenZone(g.DockType)!=null){this.ScreenZone(g.DockType).set_SelectedForm(g.FormIdx)}this.BringToFront(g.FormIdx)};WebEntryPointSrv.prototype.OnSendHelpMail=function(a,c,b){this.DispatchToComp("OnSendHelpMail",new Array(a,c,b))};WebEntryPointSrv.prototype.AfterHelpSession=function(d,b,e,a,c){this.DispatchToComp("AfterHelpSession",new Array(d,b,e,a,c))};WebEntryPointSrv.prototype.OnExpandMenu=function(){this.DispatchToComp("OnExpandMenu",new Array())};WebEntryPointSrv.prototype.OnOpenPopup=function(a,c,b){this.DispatchToComp("OnOpenPopup",new Array(a,c,b))};WebEntryPointSrv.prototype.OnCmdSetCommand=function(a,d,c,b){this.DispatchToComp("OnCmdSetCommand",new Array(a,d,c,b))};WebEntryPointSrv.prototype.OnGetDBByName=function(a){};WebEntryPointSrv.prototype.GetDBByName=function(a){return null};WebEntryPointSrv.prototype.OnCmdSetChangeExpand=function(b,a,c){this.DispatchToComp("OnCmdSetChangeExpand",new Array(b,a,c))};WebEntryPointSrv.prototype.OnKeyPress=function(a,b){this.DispatchToComp("OnKeyPress",new Array(a,b))};WebEntryPointSrv.prototype.OnCmdSetGeneralDrag=function(a,d,c,b){this.DispatchToComp("OnCmdSetGeneralDrag",new Array(a,d,c,b))};WebEntryPointSrv.prototype.OnCmdSetGeneralDrop=function(a,d,c,b){this.DispatchToComp("OnCmdSetGeneralDrop",new Array(a,d,c,b))};WebEntryPointSrv.prototype.OnSynchronize=function(a,c,e,d,b){this.DispatchToComp("OnSynchronize",new Array(a,c,e,d,b))};WebEntryPointSrv.prototype.OnSyncQuery=function(a,b,c,d){this.DispatchToComp("OnSyncQuery",new Array(a,b,c,d))};WebEntryPointSrv.prototype.OnSyncFilter=function(b,a){this.DispatchToComp("OnSyncFilter",new Array(b,a))};WebEntryPointSrv.prototype.OnEndSynchronization=function(b,a,c){this.DispatchToComp("OnEndSynchronization",new Array(b,a,c))};WebEntryPointSrv.prototype.TableSubst=function(c,h,e,d){var a=new IDVariant(c);var g=new IDVariant(h);var b=new IDVariant(e);var f=new IDVariant(d);this.OnTableSubstitution(a,g,b,f);if(d==0){return b.stringValue()}else{return g.stringValue()}};WebEntryPointSrv.prototype.OnTableSubstitution=function(a,d,c,b){this.DispatchToComp("OnTableSubstitution",new Array(a,d,c,b))};WebEntryPointSrv.prototype.NewAssistance=function(g,d,b,j,a,h,f){if(a==undefined){a=""}if(h==undefined){h=""}if(f==undefined){f=""}var c="";var e="";if(this.ActiveForm()!=null){e=this.ActiveForm().Caption().stringValue();if(!this.ActiveForm().RTCGuid.equals("")){e+=(" - "+this.ActiveForm().RTCGuid)}}c="http://"+g;c=c+"?CMD=TeamWorks";c=c+"&Panel=Segnalazione";c=c+"&PrjGUID="+this.RTCObj.PrjGuid;c=c+"&Modulo="+e;c=c+"&Versione="+this.RevNum;c=c+"&NomeCognome="+h;c=c+"&Telefono="+f;c=c+"&TestoSegnalazione="+d;c=c+"&MotivazioneUrgenza="+a;c=c+"&PrSegnalazione="+b;c=c+"&TipoSegnalazione="+j;this.set_RedirectTo(new IDVariant(c));this.set_RedirectNewWindow(true)};WebEntryPointSrv.prototype.ParamsObj=function(){return this.iParamsObj};WebEntryPointSrv.prototype.SendHtml=function(c,a,b){if(a==undefined){a=-1}if(b==undefined){b=""}this.DisableRender=true};WebEntryPointSrv.prototype.FireAfterLogin=function(){};WebEntryPointSrv.prototype.MessageConfirm=function(a){return this.MessageConfirmEx(a).booleanValue()};WebEntryPointSrv.prototype.MessageConfirmEx=function(e,b){if(b==undefined){b=new IDVariant()}var g=e.ToString();g=g.replace(/\r\n/g,"\n");g=g.replace(/\r/g,"\n");var a=this.ConfStack[g];if(a!=null){if(a=="Y"){return new IDVariant(true)}else{if(a=="N"){return new IDVariant(false)}else{return new IDVariant(a)}}}else{this.set_AlertMessage(new IDVariant(g));this.set_AlertType(1);if(this.ParamsObj().UseRD3){this.set_hasConfirm(true);var f=false;for(var c=0;c<this.RD3Events.Count()&&!f;c++){var d=this.RD3Events[c];if(d.Name.equals("msgbox")&&d.Ident.equals(this.AlertMessage().stringValue())){f=true}}if(!f){var d=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());d.CanSendInFulltree=true;d.SetAttribute("type","1");if(this.VoiceCommandExecuted){d.SetAttribute("voice","1")}if(b!=null&&b.Type!=IDVariant.NULL){d.SetAttribute("opts",b.stringValue())}}this.set_AlertMessage(new IDVariant())}return new IDVariant()}};WebEntryPointSrv.prototype.InputBox=function(c){var d=c.ToString();d=d.replace(/\r\n/g,"\n");var a=this.ConfStack[d];if(a!=null){return new IDVariant(a)}else{this.set_AlertMessage(new IDVariant(d));this.set_AlertType(2);if(this.ParamsObj().UseRD3){this.set_hasConfirm(true);var b=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());b.CanSendInFulltree=true;b.SetAttribute("type","2");if(this.VoiceCommandExecuted){b.SetAttribute("voice","1")}this.set_AlertMessage(new IDVariant())}return new IDVariant()}};WebEntryPointSrv.prototype.DumpVersions=function(c){var d="13.5.5800";var b=this.IDVer.equals(d);var e=(b?"OK - ":"WARNING - ")+"ID Version: "+this.IDVer+", IJLIB Version: "+d;this.DTTObj.AddMsg((b?DTTEngine.DTTMSG_INFO:DTTEngine.DTTMSG_WARN),"",220,"MainFrm.DumpVersions",e);WriteToConsoleOutput(e);var a=new IDVariant(e);if(c){this.set_AlertMessage(a)}return a};WebEntryPointSrv.prototype.ResizeClient=function(c,b,a){};WebEntryPointSrv.prototype.PrintReport=function(d,h,b,f,e,k){if(h==undefined){h=""}if(b==undefined){b=""}if(f==undefined){f=""}if(e==undefined){e=""}if(k==undefined){k=true}if(d.toUpperCase().endsWith(".XML")){var j=new WebFormSrv();j.MainFrm=this;var a=new OBookSrv(j);var c=new CIDREObj(a);a.BookObj=c;c.InitHTML();var g=XMLuiSrv.LoadFromXML(c,this,d,true);if(g==0){if(!h.equals("")){c.SetReportWhereClause(-1,h)}c.set_PrintDestination(IDREGlb.PRN_PDF);c.PrintBook(1,-1);this.set_RedirectTo(new IDVariant(c.GetWebFileName()));this.set_RedirectNewWindow(k);return new IDVariant(c.OutputFileName())}else{return new IDVariant(g,IDVariant.STRING)}}return new IDVariant()};WebEntryPointSrv.prototype.AddPDFPrint=function(h,b,g,c,f,e,a){var d=new PDFPrintSrv();this.PDFPrints.Add(d);d.PDFFile=h;d.MsgText=b;d.FromPage=g;d.ToPage=c;d.FitToPaper=f;d.AutoDelete=e;d.PrintDlg=a};WebEntryPointSrv.prototype.RTCReset=function(){this.CmdObj.RDAll=true;this.RolObj.ApplyRoles(0,null);for(var a=0;a<this.StackForm.Count();a++){var b=this.StackForm[a];b.RTCReset()}if(this.DockedForm()!=null){this.DockedForm().RTCReset()}};WebEntryPointSrv.prototype.UseDecimalDot=function(){return this.ParamsObj().UseDecimalDot};WebEntryPointSrv.prototype.set_UseDecimalDot=function(a){if(this.ParamsObj().UseDecimalDot!=a){this.ParamsObj().UseDecimalDot=a;this.CmdObj.RDAll=true;this.RD3Change(RD3Glb.WEP_USEDECIMALDOT)}};WebEntryPointSrv.prototype.RefreshTraylet=function(a){this.TrayletRefreshCommand=a};WebEntryPointSrv.prototype.RenderTrayletCommand=function(){};WebEntryPointSrv.prototype.SetGlobalMenuStatus=function(c,b,a){this.GlbRoleCmdSetEnabled=c;this.GlbRoleCmdLinEnabled=b;this.GlbRoleCommandEnabled=a};WebEntryPointSrv.prototype.ConnectToInde=function(){};WebEntryPointSrv.prototype.x_OnDisconnect=function(){};WebEntryPointSrv.prototype.x_OnCBTEvent=function(d,c,g,f,b,a,h,e){};WebEntryPointSrv.prototype.OnCBTEvent=function(d,c,g,f,b,a,h,e){};WebEntryPointSrv.prototype.StartPhase=function(a,c,b){this.ProgrBar.StartPhase(a,c,b)};WebEntryPointSrv.prototype.TrackPhase=function(b,a){return this.ProgrBar.TrackPhase(b,a)};WebEntryPointSrv.prototype.getIMDB=function(){return this.IMDB};WebEntryPointSrv.prototype.getDTTObj=function(){return this.DTTObj};WebEntryPointSrv.prototype.getRTCObj=function(){return this.RTCObj};WebEntryPointSrv.prototype.getRolObj=function(){return this.RolObj};WebEntryPointSrv.prototype.getRealPath=function(){return this.RealPath};WebEntryPointSrv.prototype.GetRD3Ident=function(a){if(a==undefined){a=-1}switch(a){case -1:return"wep";case RD3Glb.WEP_OBJ_SUPPRESSMENU:return"header-suppress-menu";case RD3Glb.WEP_OBJ_MAINCAPTION:return"header-main-caption";case RD3Glb.WEP_OBJ_HELPBUTTON:return"header-help-button";case RD3Glb.WEP_OBJ_DEBUGBUTTON:return"header-debug-image";case RD3Glb.WEP_OBJ_CLOSEAPP:return"header-close-app";case RD3Glb.WEP_OBJ_STARTBUTTON:return"taskbar-start-cell";case RD3Glb.WEP_OBJ_CMDINPUT:return"header-command-input";case RD3Glb.WEP_OBJ_FORMLIST:return"form-list-header";case RD3Glb.WEP_OBJ_CLOSEALL:return"form-list-close-all-box"}return""};WebEntryPointSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}if(this.CompOwner!=null){this.CompOwner.RD3Change(a,b);return}this.RD3PropChg[a]=b;this.RD3Changed=true};WebEntryPointSrv.prototype.RD3RenderDifferences=function(Q,H){var y=null;for(var J=0;J<this.RD3CliExecute.Count();J++){var L=this.RD3CliExecute[J];if(L.length==0||L.charAt(0)!="!"){continue}var a=Q.AddNewElement("exe");a.SetAttribute("cmd",L.substr(1))}if(this.TrayletRefreshCommand.length>0){this.RD3AddEvent("traylet",this.TrayletRefreshCommand);this.TrayletRefreshCommand=""}if(this.RedirectTo().stringValue().length>0){if(this.DeleteAfterDownload||this.SaveAttachment){}var C=this.RD3AddEvent((this.RedirectNewWindow()?"opendoc":"redirect"),this.RedirectTo().stringValue());C.CanSendInFulltree=true;C.SetAttribute("fea",this.RedirectFeatures().toString());this.set_RedirectTo(new IDVariant())}if(this.RDExitURL.length>0){var C=this.RD3AddEvent("redirect",this.RDExitURL);this.RDExitURL=""}for(var J=0;J<this.PDFPrints.Count();J++){var D=this.PDFPrints[J];if(!D.Rendered){var C=this.RD3AddEvent("printpdf",D.PDFFile);C.SetAttribute("msg",D.MsgText);C.SetAttribute("from",D.FromPage.toString());C.SetAttribute("to",D.ToPage.toString());C.SetAttribute("fit",D.FitToPaper?"1":"0");C.SetAttribute("dlg",D.PrintDlg?"1":"0");D.Rendered=true}}this.RD3Tooltips=new ArrayList();while(this.RD3Events.Count()>0){var o=new ArrayList();o.AddRange(this.RD3Events);this.RD3Events.Clear();for(var J=0;J<o.Count();J++){var C=o[J];if(C.Name.equals("error")){y=C}else{if(C.Name.equals("tooltip")){this.RD3Tooltips.Add(C)}else{if(C.Name.equals("searchval")){this.RD3Tooltips.Add(C)}else{if(C.Name.equals("msgbox")&&H&&C.CanSendInFulltree){this.RD3Tooltips.Add(C)}else{var G=C.Send(Q,H);if(G!=null){if(C.Name.equals("open")){var F=null;for(var I=0;I<this.StackForm.Count();I++){var M=this.StackForm[I];if(M.GetRD3Ident()==C.Ident){M.RD3RenderDifferences(G,true);F=M}}if(F!=null){for(var I=0;I<o.Count();I++){var R=o[I];if(R.Name.equals("rcache")||R.Name.equals("rstgrp")){var D=R.Ident.lastIndexOf(":");var x=parseInt(R.Ident.substr(D+1),10);if(!isNaN(x)){if(x==F.FormIdx){R.DontSend=true}else{for(var m=0;m<F.Frames.length;m++){if(F.Frames[m]!=null&&F.Frames[m].Content!=null&&F.Frames[m].Content instanceof ASubFormSrv){var u=F.Frames[m].Content;if(u.pSubForm!=null&&x==u.pSubForm.FormIdx){R.DontSend=true;break}}}}}}}}}}}}}}}}this.RD3Events.Clear();var A=null;if(H){var v=Q.AddNewElement("start");A=v.AddNewElement(this.GetRD3Ident())}if(A==null&&this.RD3Changed){A=Q.AddNewElement("chg")}if(A!=null){A.SetAttribute("id",this.GetRD3Ident())}if(H||this.RD3Changed){for(var J=0;J<this.RD3PropChg.length;J++){if(this.RD3PropChg[J]||H){this.SetRD3Property(J,A,H)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(H){A.SetAttribute("lan",this.GetAppLanguage());if(this.CloseAllEvent!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE)){A.SetAttribute("clo",this.CloseAllEvent.toString())}if(this.CloseAppEvent!=(RD3Glb.EVENT_SERVERSIDE|RD3Glb.EVENT_IMMEDIATE)){A.SetAttribute("cla",this.CloseAppEvent.toString())}if(this.StartAnimationDef!=null){A.SetAttribute("sta",this.StartAnimationDef)}if(this.ExpandCmdSetAnimationDef!=null){A.SetAttribute("eca",this.ExpandCmdSetAnimationDef)}if(this.PopupMenuAnimationDef!=null){A.SetAttribute("pma",this.PopupMenuAnimationDef)}if(this.ShowFormAnimationDef!=null){A.SetAttribute("sfa",this.ShowFormAnimationDef)}if(this.OpenModalAnimationDef!=null){A.SetAttribute("oma",this.OpenModalAnimationDef)}if(this.MessageAnimationDef!=null){A.SetAttribute("msa",this.MessageAnimationDef)}if(this.LastMessageAnimationDef!=null){A.SetAttribute("lma",this.LastMessageAnimationDef)}if(this.CollapseFrameAnimationDef!=null){A.SetAttribute("cfa",this.CollapseFrameAnimationDef)}if(this.ExpandTreeAnimationDef!=null){A.SetAttribute("eta",this.ExpandTreeAnimationDef)}if(this.ChangeLayoutAnimationDef!=null){A.SetAttribute("cya",this.ChangeLayoutAnimationDef)}if(this.QBETipAnimationDef!=null){A.SetAttribute("qta",this.QBETipAnimationDef)}if(this.ChangeTabPageAnimationDef!=null){A.SetAttribute("cta",this.ChangeTabPageAnimationDef)}if(this.ShowGraphAnimationDef!=null){A.SetAttribute("sga",this.ShowGraphAnimationDef)}if(this.ChangeBookPageAnimationDef!=null){A.SetAttribute("cba",this.ChangeBookPageAnimationDef)}if(this.RedirectAnimationDef!=null){A.SetAttribute("rda",this.RedirectAnimationDef)}if(this.PreviewAnimationDef!=null){A.SetAttribute("pra",this.PreviewAnimationDef)}if(this.DockedAnimationDef!=null){A.SetAttribute("dka",this.DockedAnimationDef)}if(this.PopupResizeAnimationDef!=null){A.SetAttribute("ppr",this.PopupResizeAnimationDef)}if(this.TooltipAnimationDef!=null){A.SetAttribute("ttp",this.TooltipAnimationDef)}if(this.TaskbarAnimationDef!=null){A.SetAttribute("tsk",this.TaskbarAnimationDef)}if(this.ComboAnimationDef!=null){A.SetAttribute("cmb",this.ComboAnimationDef)}if(!this.ParamsObj().EnableRichTooltip){A.SetAttribute("tme",this.ParamsObj().EnableRichTooltip?"1":"0")}if(this.ComboNameSep!="; "){A.SetAttribute("cns",this.ComboNameSep)}if(this.ListenKeys!=0){A.SetAttribute("hks",this.ListenKeys.toString())}}var s=(H)?A:Q;this.CmdObj.RD3RenderDifferences(s,H,0);this.VisualStyleList.RD3RenderDifferences(s,H);this.IndObj.RD3RenderDifferences(s,H);this.TimerObj.RD3RenderDifferences(s,H,0);this.VoiceObj.RD3RenderDifferences(s,H);if(H){WebFrameSrv.RenderCustomCommands(s)}if(this.UseZones()){for(var t=0;t<this.screenZones.Count();t++){var h=this.screenZones.Get(t);h.RD3RenderDifferences(s,H)}}for(var J=this.StackForm.Count()-1;J>=0;J--){var M=this.StackForm[J];M.RD3RenderDifferences(s,H)}if(H){this.RD3ServerParams(s)}var q=new ArrayList();if(this.ActiveForm()!=null){q.Add(this.ActiveForm())}for(var J=0;J<this.StackForm.Count();J++){var M=this.StackForm[J];if(M.Docked){q.Add(M)}}var k=false;for(var J=0;J<q.Count();J++){var M=q[J];if(M.FocusPriority==0){k=true}}var B=null;if(k){var l=new ArrayList();for(var J=0;J<q.Count();J++){var M=q[J];M.GetSubForm(l)}for(var J=0;J<l.Count();J++){var c=l[J];if(c.FocusPriority>0){B=c;break}}}var r=false;for(var J=0;J<q.Count();J++){var M=q[J];if(M.FocusPriority>0){r=true}}if(r||H||B!=null){var M=null;if(this.ActiveForm()!=null&&this.ActiveForm().FocusPriority>0){M=this.ActiveForm()}else{for(var J=0;J<q.Count();J++){var z=q[J];if(z.Docked&&z.FocusPriority>0){M=z;break}}}if(H&&M==null){if(this.ActiveForm()!=null){M=this.ActiveForm()}else{for(var J=0;J<q.Count();J++){var z=q[J];if(z.Docked){M=z;break}}}}if((M!=null&&M.FocusPriority==0)||B!=null){M=B}if(M!=null&&M.ActiveElement.length>5&&M.ActiveElement.startsWith("F")){var P=M.ActiveElement.indexOf("C");var N=M.ActiveElement.indexOf("R");try{var E=parseInt(M.ActiveElement.substr(1,P-1),10);var b=parseInt(M.ActiveElement.substr(P+1,N-P-1),10);var w=parseInt(M.ActiveElement.substr(N+1),10);var D=M.Frames[E].Content;var K=D.bFields(b);var C=this.RD3AddEvent("focus",K.GetRD3Ident());C.SetAttribute("row",w.toString());C.CanSendInFulltree=true;if(K.sendSelection){C.SetAttribute("sels",K.SelStart().toString());C.SetAttribute("sele",K.SelEnd().toString());K.sendSelection=false}}catch(O){}}}if(this.AlertMessage().stringValue().length>0){var C=this.RD3AddEvent("msgbox",this.AlertMessage().stringValue());C.SetAttribute("type","0");if(this.VoiceCommandExecuted){C.SetAttribute("voice","1")}C.CanSendInFulltree=true;this.set_AlertMessage(new IDVariant())}if(y!=null){this.RD3Events.Add(y)}for(var J=0;J<this.RD3Events.Count();J++){var C=this.RD3Events[J];var G=C.Send(Q,H);if(C.Name.equals("error")&&G!=null){this.ErrObj.Render3(G)}}for(var J=0;J<this.RD3Tooltips.Count();J++){var g=this.RD3Tooltips[J];g.Send(Q,H)}for(var J=0;J<this.RD3CliExecute.Count();J++){var L=this.RD3CliExecute[J];if(L.length==0||L.charAt(0)=="!"){continue}var a=Q.AddNewElement("exe");a.SetAttribute("cmd",L)}if(this.SendDebug){var d=Q.AddNewElement("dbg");if(this.DebugWindow!=""){d.SetAttribute("main",this.DebugWindow)}if(this.DebugItemList!=""){d.SetAttribute("ItemList",this.DebugItemList)}if(this.DebugCmdForm!=""){d.SetAttribute("CmdForm",this.DebugCmdForm)}if(this.DebugDetail!=""){d.SetAttribute("Detail",this.DebugDetail)}if(this.DebugReqTop!=""){d.SetAttribute("ReqTop",this.DebugReqTop)}if(this.DebugReqRef!=""){d.SetAttribute("ReqRef",this.DebugReqRef)}if(this.DebugReqPrc!=""){d.SetAttribute("ReqPrc",this.DebugReqPrc)}if(this.Request.SESSNAME!=null){d.SetAttribute("SESS",this.Request.SESSNAME)}this.DebugWindow="";this.DebugItemList="";this.DebugCmdForm="";this.DebugDetail="";this.DebugReqTop="";this.DebugReqRef="";this.DebugReqPrc="";this.SendDebug=false}this.RD3CliExecute.Clear();this.VoiceCommandExecuted=false;this.VoiceObj.VoiceCommandExecuted=false};WebEntryPointSrv.prototype.SetRD3Property=function(a,c,b){switch(a){case RD3Glb.WEP_CAPTION:c.SetAttribute("cap",this.iCaption.stringValue());break;case RD3Glb.WEP_WELCOME:c.SetAttribute("wel",this.WelcomeURL);break;case RD3Glb.WEP_MENUTYPE:c.SetAttribute("met",this.MenuType.toString());break;case RD3Glb.WEP_REFRESHINT:var d=this.RefreshInterval().intValue();switch(d){case -1:d=0;break;case 0:d=20;break;default:d=d*1000;break}c.SetAttribute("rfi",d+"");break;case RD3Glb.WEP_REFRESHLOC:c.SetAttribute("rlo",this.RefreshLocation().stringValue());break;case RD3Glb.WEP_DEVICEMOTION:c.SetAttribute("mth",this.iAccelMotionThreshold.stringValue()+"|"+this.iRotMotionThreshold.stringValue());break;case RD3Glb.WEP_WIDGETMODE:if(!this.WidgetMode&&b){break}c.SetAttribute("wid",this.WidgetMode?"1":"0");break;case RD3Glb.WEP_ACTIVEFORM:if(this.ActiveForm()==null&&b){break}c.SetAttribute("act",(this.ActiveForm()!=null)?this.ActiveForm().GetRD3Ident():"");break;case RD3Glb.WEP_USEDECIMALDOT:if(!this.ParamsObj().UseDecimalDot&&b){break}c.SetAttribute("dec",this.ParamsObj().UseDecimalDot?"1":"0");break;case RD3Glb.WEP_DEBUGTYPE:var e=0;if(this.DTTObj.Level>0&&!this.DTTObj.TraceEnabled){e=1}if(this.DTTObj.HelpEnabled&&!this.DTTObj.TraceEnabled&&this.DTTObj.CanSendHelpMail(false)){e=2}if(e==0&&b){break}c.SetAttribute("dbi",e.toString());break;case RD3Glb.WEP_HELPFILE:if(this.ActiveHelpFile().length==0&&b){break}c.SetAttribute("hlp",this.ActiveHelpFile());break;case RD3Glb.WEP_IMAGE:if(this.iImage.length==0&&b){break}c.SetAttribute("img",this.iImage);break;case RD3Glb.WEP_CMDPROMPT:break;case RD3Glb.WEP_ENTRYPOINT:c.SetAttribute("ent",this.RD3EntryPoint);break;case RD3Glb.WEP_ENABLEGFX:if(this.ParamsObj().EnableGFX&&b){break}c.SetAttribute("ena",this.ParamsObj().EnableGFX?"1":"0");break;case RD3Glb.WEP_ENABLESND:if(this.ParamsObj().EnableSound&&b){break}c.SetAttribute("snd",this.ParamsObj().EnableSound?"1":"0");break;case RD3Glb.WEP_SHOWLOGOFF:if(!this.LogoffURL.equals("")&&b){break}c.SetAttribute("shl",this.LogoffURL.equals("")?"0":"1");break;case RD3Glb.WEP_MENUWIDTH:if(this.iSideMenuWidth==160&&b){break}c.SetAttribute("smw",this.iSideMenuWidth.toString());break;case RD3Glb.WEP_ACCENTCOLOR:if(this.iAccentColor==12747008&&b){break}c.SetAttribute("acc","rgb("+(this.iAccentColor&255)+", "+((this.iAccentColor&65280)>>8)+", "+((this.iAccentColor&16711680)>>16)+")");break;case RD3Glb.WEP_VISPROP:if(this.iVisualFlags==3839&&b){break}c.SetAttribute("vfl",this.iVisualFlags.toString());break}};WebEntryPointSrv.prototype.ShowDesktop=function(){};WebEntryPointSrv.prototype.OnBrowserMessage=function(c,b,a){this.DispatchToComp("OnBrowserMessage",new Array(c,b,a))};WebEntryPointSrv.prototype.OnException=function(g,c,f,a,e,d,b){this.DispatchToComp("OnException",new Array(g,c,f,a,e,d,b))};WebEntryPointSrv.prototype.IWRD3_UserEvent=function(G){if(G.length>0&&G.toUpperCase().equals("MF")){return}if(G.length>0&&G.toUpperCase().equals("GZ")){return}if(G.length>0&&G.toUpperCase().equals("IMG")){this.RenderAllImages(false);return}if(!this.RolObj.CheckRole()){this.RD3Reset();this.RenderPage();return}var b=this.Request.InputStream;if(this.BrowserSubClass==Glb.BRWSCL_OPERA){}var a=new XMLDoc();a.LoadFromString(b);var w=a.GetNextNode();if(w!=null&&w.Name().equals("xml")){if(a.HasNextNode()){w=a.GetNextNode()}else{return}}if(w==null){this.RD3Reset();this.RenderPage();return}var y=parseInt(w.GetAttribute("num"),10);if(!isNaN(y)){if(y<this.RD3LastRequest){var o=w.GetNode();var u=o.getOwnerDocument();var v=null;var e=u.getElementsByTagName("start");if(e.length>0){v=e[0]}if(v==null){WriteToConsoleError("Request number "+y+"is arrived after request number "+this.RD3LastRequest+" : Skipping request");this.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",200,"MainFrm.IWRD3_UserEvent","Request number "+y+" is arrived after request number "+this.RD3LastRequest+" : Skipping request");this.RenderPage();return}}this.RD3LastRequest=y}else{if(w.GetAttribute("num")!="owa"){WriteToConsoleError("Request number not found");this.RD3Reset();this.RenderPage();return}}var D=w.GetNode();var g=D.getOwnerDocument().getElementsByTagName("keypress");if(g.length>0){var B=D.getOwnerDocument().getElementsByTagName("chg");if(B.length>0){var m=B[B.length-1];var j=m;for(var x=0;x<g.length;x++){D.insertAfter(g[x],j);j=g[x]}w.Reset()}}var l=new ArrayList();if(this.ActiveForm()!=null){l.Add(this.ActiveForm());this.ActiveForm().GetSubForm(l)}for(var x=0;x<this.StackForm.Count();x++){var A=this.StackForm[x];if(A.Docked){l.Add(A);A.GetSubForm(l)}}for(var x=0;x<l.Count();x++){var A=l[x];A.FocusPriority=0}this.RD3StartRequest();if(this.hasConfirm()){var o=w.GetNode();var u=o.getOwnerDocument();var v=null;var e=u.getElementsByTagName("msgcfr");if(e.length>0){v=e[0]}if(v==null){e=u.getElementsByTagName("start");if(e.length>0){v=e[0]}}if(v!=null){if(o.getFirstChild()!=v){o.insertBefore(v,o.getFirstChild())}var I=v;for(var x=0;x<this.confirmNodes.Count();x++){var c=this.confirmNodes[x].GetNode();o.insertAfter(c,I);I=c}w.Reset();this.set_hasConfirm(false);this.confirmNodes.Clear()}else{var o=w.GetNode();var u=o.getOwnerDocument();var v=null;var e=u.getElementsByTagName("refresh");if(e.length>0){v=e[0]}if(v!=null){this.set_hasConfirm(false);this.confirmNodes.Clear()}}}this.RD3PanRevalidate=false;var r=true;while(w.HasNextNode()){var z=w.GetNextNode();var q=true;if(this.hasConfirm()){this.confirmNodes.Add(z);continue}this.set_ShiftKey(z.GetAttribute("shp")=="-1");this.set_CtrlKey(z.GetAttribute("ctp")=="-1");this.set_AltKey(z.GetAttribute("atp")=="-1");var h=z.GetAttribute("ace");if(h!=null&&h.length>0){var H=this.RD3FindField(h);if(H!=null){var A=H.Parent.Parent;if(A.FocusPriority==0){A.ActiveElement="F"+H.Parent.FrIndex+"C"+H.Index+"R0"}}else{var k=this.FindWebFrame(h);if(k!=null&&(k instanceof IDPanelSrv)){var A=k.Parent;A.ActiveElement="F"+k.FrIndex+"C0R0"}}}if(this.RD3PanRevalidate&&!z.Name().equals("chg")){var C=new ArrayList();var t=true;while(t){t=false;var s=this.GetLiveForms();for(var p=0;p<s.Count();p++){var A=s[p];if(C.Contains(A)){continue}C.Add(A);t=true;for(var x=0;x<A.Frames.length;x++){var F=(A.Frames[x]!=null?A.Frames[x].Content:null);if(F!=null&&F instanceof IDPanelSrv){F.RD3EndRequest()}}}}this.RD3PanRevalidate=false}var d=z.Name();var E=new IDVariant();this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",400,"MainFrm.OnBrowserMessage","Firing OnBrowserMessage event");this.DTTObj.AddParameter("","","Message",new IDVariant(d));this.DTTObj.AddParameter("","","Node",z);this.OnBrowserMessage(new IDVariant(d),z,E);if(E.isTrue()){continue}switch(d){case"start":q=this.HandleStartEvent();break;case"refresh":q=this.HandleRefreshEvent();break;case"chg":q=this.HandleChgEvent(z);break;case"clk":q=this.HandleClkEvent(z);break;case"close":q=this.HandleFormCloseEvent(z);break;case"confirm":q=this.HandleFormConfirmEvent(z);break;case"timer":q=this.HandleTimerEvent(z);break;case"trnexp":q=this.HandleExpansionEvent(z);break;case"flclk":q=this.HandleFlClkEvent(z);break;case"claclk":q=this.HandleCloseAllEvent(z);break;case"col":q=this.HandleCollapseEvent(z);break;case"btb":q=this.HandleButtonBarEvent(z);break;case"panscr":q=this.HandlePanelScrollEvent(z);break;case"graclk":q=this.HandleGraphClick(z);break;case"pdfprint":q=this.HandlePdfPrint(z);break;case"tab":q=this.HandleTabClick(z);break;case"drp":q=this.HandleDrop(z);break;case"trasf":q=this.HandleTransform(z);break;case"rclk":q=this.HandleTreeRightClkEvent(z);break;case"booktb":q=this.HandleBookToolbarEvent(z);break;case"pantb":q=this.HandlePanelToolbarEvent(z);break;case"srcbox":q=this.HandleSearchBox(z);break;case"more":q=this.HandlePanelMoreRows(z);break;case"panpg":q=this.HandlePageClick(z);break;case"panrs":q=this.HandlePanelRowSelector(z);break;case"panms":q=this.HandlePanelMultiSel(z);break;case"chgrow":q=this.HandlePanelChangeRow(z);break;case"msgcfr":q=this.HandleMessageConfirm(z);break;case"resize":q=this.HandleResize(z);break;case"cmd":q=this.HandleCommand(z);break;case"repos":q=this.HandleRepositioning(z);break;case"chgwst":q=this.HandleChangeWindowState(z);break;case"rawclk":q=this.HandleRawClick(z);break;case"sound":q=this.HandleSound(z);break;case"rdcol":q=this.HandleReorderColumn(z);break;case"rescol":q=this.HandleResizeColumn(z);break;case"gdd":q=this.HandleGenericDragDrop(z);break;case"grlexp":q=this.HandleExpandListGroup(z);break;case"grpcol":q=this.HandleGroupCollapseEvent(z);break;case"txtsel":q=this.HandleTextSelection(z);break;case"fev":q=this.HandleClientFocus(z);break;case"keypress":q=this.HandleKeyPress(z);break;case"chgloc":q=this.HandleChangeLocation(z);break;case"chgmot":q=this.HandleDeviceMotion(z);break;case"menures":q=this.HandleSideMenuResize(z);break;case"IWDTT":q=this.HandleDTT(z);break;case"IWUpload":q=this.HandleIWUpload(z);break;case"IWBlob":q=this.HandleIWBlob(z);break;case"IWFiles":q=this.HandleIWFiles(z);break;case"SYNC":q=this.HandleSYNC(z);break;case"voice":q=this.HandleVoice(z);break;case"sczsel":q=this.HandleScreenZoneSel(z);break;case"rfi":continue}r&=q;this.EatNextMessage=false;if(this.ShouldEatNextMessage){this.EatNextMessage=true;this.ShouldEatNextMessage=false}this.UpdateIMDBState();if(this.hasConfirm()){this.confirmNodes.Add(z)}}this.RD3EndRequest();if(r){this.RenderPage()}else{this.IWRD_UserEvent("")}};WebEntryPointSrv.prototype.RenderDifferences3=function(){var b=new XMLDoc();var a=b.AddNewElement("rd3");this.RD3RenderDifferences(a,this.RD3CreateFullTree);this.Response.responseXML=b.SaveToString();if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){WriteToConsoleOutput("RD3response = "+this.Response.responseXML)}this.RD3CreateFullTree=false;this.RD3Events.Clear();if(this.BrowserInfo()==2){this.LastRD3Reply=b.SaveToString()}};WebEntryPointSrv.prototype.HandleStartEvent=function(){this.RD3CreateFullTree=true;return true};WebEntryPointSrv.prototype.HandleRefreshEvent=function(){return true};WebEntryPointSrv.prototype.HandleChgEvent=function(g){var b=g.GetAttribute("oid");var e=g.GetAttribute("par1");if(b.startsWith("spn")){var c=this.RD3FindSpan(b);if(c!=null){c.ProcessRequest(new IDVariant(e))}}if(b.startsWith("trn")){var j=b.indexOf(":");var f=b.indexOf(":",j+1);if(j>-1&&f>-1){var h=b.substr(j+1,f-j-1);var k=this.FindWebFrame(b.substr(f));if(k!=null){k.RD3SelectNode(h,e=="on")}}}if(b.startsWith("val")){var j=b.indexOf(":");var f=b.indexOf(":",j+1);var d=b.indexOf(":",f+1);if(j>-1&&f>-1&&d>-1){var a=this.FindWebFrame(b.substr(d));if(a!=null){a.RD3ValChange(b,e);this.RD3PanRevalidate=true}}}return true};WebEntryPointSrv.prototype.HandleGenericDragDrop=function(e){var b=e.GetAttribute("oid");var d=e.GetAttribute("obn");var f=this.FindWebFrame(d);if(f==null){f=this.RD3FindCommand(d)}var g=this.FindWebFrame(b);if(g==null){g=this.RD3FindCommand(b)}if(f!=null&&g!=null){if(f instanceof ACommandSrv){this.CmdObj.GenericDrag(e,f,g)}if(f instanceof WebFrameSrv){var c=f;if(d.startsWith("tab")&&c.Parent!=null&&c.FrIndex>-1&&c.Parent.Frames[c.FrIndex].InTabbed&&c.Parent.Frames[c.Parent.Frames[c.FrIndex].TabIdx]!=null){var a=c.Parent.Frames[c.Parent.Frames[c.FrIndex].TabIdx].Content;a.GenericDrag(e,g)}else{c.GenericDrag(e,g)}}}return true};WebEntryPointSrv.prototype.HandleClkEvent=function(j){if(this.EatNextMessage){return true}var s=j.GetAttribute("oid");var g=j.GetAttribute("obn");var m=j.GetAttribute("par1");var r=j.GetAttribute("xck");var u=j.GetAttribute("yck");if(s.startsWith("fld")&&m.equals("cap")){var e=s.indexOf(":");var b=s.indexOf(":",e+1);var q=s.substr(e+1,b-e-1);var o=parseInt(q,10);var t=this.FindWebFrame(s.substr(b));if(t!=null){var w=parseInt(u,10);t.RD3Sort(o,w)}return true}else{if(s.startsWith("box:")){var k=this.RD3FindBox(s);if(k!=null){k.RD3Activate()}return true}else{if(s.equals("cloapp")){this.IWLogoff_UserEvent("");return true}else{if(s.equals("cmh.con")){this.IWMenu_UserEvent("CON");return true}else{if(s.equals("cmh.exp")){this.IWMenu_UserEvent("EXP");return true}else{if(s.startsWith("cmd:")){for(var v=0;v<this.CmdObj.CmdLin.length;v++){var y=this.CmdObj.CmdLin[v];if(y==null){continue}if(s.equals(y.GetRD3Ident())){this.IWMenu_UserEvent("M"+y.Index);return true}}}else{if(s.startsWith("cms:")){for(var v=0;v<this.CmdObj.CmdSets.length;v++){var y=this.CmdObj.CmdSets[v];if(y==null){continue}if(s.equals(y.GetRD3Ident())){if(this.MenuType==Glb.MENUTYPE_MENUBAR){this.CmdObj.FireOnOpenPopup(y.Index,0,new IDVariant(1),new IDVariant())}else{this.IWMenu_UserEvent("S"+y.Index)}return true}}}else{if(s.startsWith("ind:")){for(var v=1;v<this.IndObj.Indicators.length;v++){if(this.IndObj.Indicators[v]==null){continue}if(s.equals(this.IndObj.Indicators[v].GetRD3Ident())){this.IWSbInd_UserEvent(this.IndObj.Indicators[v].Code);return true}}}else{if(s.startsWith("trn:")){var h=this.RD3FindNode(s);if(h!=null){var d=h.TreeObj;var x=d.Parent;var e=s.indexOf(":");var b=s.indexOf(":",e+1);var l=s.substr(e+1,b-e-1);x.TreeClick(this,IDL.Format(new IDVariant(d.FrIndex),new IDVariant("00"),this).stringValue()+l)}return true}else{if(s.startsWith("val:")){var e=s.indexOf(":");var b=s.indexOf(":",e+1);var a=s.indexOf(":",b+1);if(e>-1&&b>-1&&a>-1){var t=this.FindWebFrame(s.substr(a));if(t!=null){t.RD3ValClick(s)}}return true}}}}}}}}}}this.set_AlertMessage(new IDVariant("Click &lt;"+s+"&gt; non riconosciuto"));return true};WebEntryPointSrv.prototype.HandleRawClick=function(d){var a=d.GetAttribute("oid");var k=d.GetAttribute("obn")!="0"&&d.GetAttribute("obn").toLowerCase()!="false";var c=parseInt(d.GetAttribute("par1"),10);var b=d.GetAttribute("par2").indexOf("-");var l=parseInt(d.GetAttribute("par2").substr(0,b),10);var g=parseInt(d.GetAttribute("par2").substr(b+1),10);b=d.GetAttribute("par3").indexOf("-");var j=parseInt(d.GetAttribute("par3").substr(0,b),10);var h=parseInt(d.GetAttribute("par3").substr(b+1),10);var e=this.FindWebFrame(a);if(e!=null){this.ShouldEatNextMessage=e.RD3RawClick(c,j,h,l,g,k,d)}return true};WebEntryPointSrv.prototype.HandleSound=function(c){var a=c.GetAttribute("oid");var d=c.GetAttribute("obn");if(d.equals("finish")){this.DTTObj.SetRequestName("Media Finish","Media Finish",DTTRequest.PRI_ITEM);this.OnMediaFinish(new IDVariant(a))}if(d.equals("progress")){this.DTTObj.SetRequestName("Media Progress","Media Progress",DTTRequest.PRI_ITEM);var e=parseInt(c.GetAttribute("par1"),10);var b=parseInt(c.GetAttribute("par2"),10);this.OnMediaProgress(new IDVariant(a),new IDVariant(e),new IDVariant(b))}return true};WebEntryPointSrv.prototype.OnMediaFinish=function(a){this.DispatchToComp("OnMediaFinish",new Array(a))};WebEntryPointSrv.prototype.OnMediaProgress=function(a,c,b){this.DispatchToComp("OnMediaProgress",new Array(a,c,b))};WebEntryPointSrv.prototype.HandleReorderColumn=function(c){var e=c.GetAttribute("oid");var b=c.GetAttribute("par1");var a=c.GetAttribute("par2");var d=this.FindWebFrame(e);if(d!=null){d.RD3ReorderColumn(b,a)}return true};WebEntryPointSrv.prototype.HandleResizeColumn=function(a){var d=a.GetAttribute("oid");var c=parseInt(a.GetAttribute("par1"),10);var b=this.RD3FindField(d);if(b!=null){b.Parent.RD3ResizeColumn(b.Index,c)}return true};WebEntryPointSrv.prototype.HandleChangeLocation=function(c){var a=c.GetAttribute("obn");var b=c.GetAttribute("par1");var d=new IDLocation();d.init(a,b);this.OnChangeLocation(d);return true};WebEntryPointSrv.prototype.HandleDeviceMotion=function(b){var a=b.GetAttribute("par1");var c=new IDDeviceMotion();c.init(a);this.OnDeviceMotion(c);return true};WebEntryPointSrv.prototype.HandleSideMenuResize=function(a){var b=parseInt(a.GetAttribute("obn"),10);if(!isNaN(b)){iSideMenuWidth=b}return true};WebEntryPointSrv.prototype.HandleDTT=function(c){var a=c.GetAttribute("oid");var b=c.GetAttribute("obn");if(b!=""&&b!=undefined){this.Request.SESSNAME=b}this.IWDTT_UserEvent(a,c);return true};WebEntryPointSrv.prototype.HandleExpansionEvent=function(g){var b=g.GetAttribute("oid");var k=b.indexOf(":");var j=b.indexOf(":",k+1);var c=b.substr(k+1,j-k-1);k=j;j=b.indexOf(":",k+1);var a=b.substr(k+1,j-k-1);if(a.length==1){a="0"+a}var d=b.substr(j+1);var h=a+c;var e=this.FindWebForm("frm:"+d);if(e!=null){e.TreeExpand(this,h)}return true};WebEntryPointSrv.prototype.HandleFlClkEvent=function(b){var c=b.GetAttribute("oid");var a=this.FindWebForm(c);if(a!=null){this.DTTObj.AddTestItem(a.RTCGuid,DTTEngine.TST_FRMSELECT,"Select form","","sel");this.DTTObj.AddHelpItem(0,0,0,0,"Attiva la videata "+a.Caption());this.BringToFront(a.FormIdx)}return true};WebEntryPointSrv.prototype.HandleFormCloseEvent=function(a){var c=a.GetAttribute("oid");var b=this.FindWebForm(c);if(b!=null){b.RD3Close(false)}return true};WebEntryPointSrv.prototype.HandleFormConfirmEvent=function(a){var c=a.GetAttribute("oid");var b=this.FindWebForm(c);if(b!=null){b.RD3Close(true)}return true};WebEntryPointSrv.prototype.HandleCloseAllEvent=function(b){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",151,"MainFrm.IWFormList","Close All command detected");this.DTTObj.SetRequestName("Close All","Close All",DTTRequest.PRI_CMD);this.DTTObj.AddTestItem("XX",DTTEngine.TST_CLOSEALL,"Main close all","");this.DTTObj.AddHelpItem(0,0,0,0,"Chiudi tutte le videate");var e=new ArrayList(this.StackForm);for(var a=0;a<e.Count();a++){var d=e[a];if(!d.Docked){this.UnloadForm(d.FormIdx,false)}}return true};WebEntryPointSrv.prototype.HandlePanelScrollEvent=function(b){var a=parseInt(b.GetAttribute("par1"),10);if(!isNaN(a)){var c=this.FindWebFrame(b.GetAttribute("oid"));if(c!=null){c.RD3Scroll(a)}}return true};WebEntryPointSrv.prototype.HandleTimerEvent=function(c){var e=c.GetAttribute("oid");var d=e.lastIndexOf(":");var a=parseInt(e.substr(d+1),10);if(a<this.TimerObj.Timers.length){var b=this.TimerObj.Timers[a];if(b!=null){b.RD3Tick(this)}}return true};WebEntryPointSrv.prototype.HandleCollapseEvent=function(d){var e=d.GetAttribute("oid");var a=d.GetAttribute("obn");var c=this.FindWebFrame(e);if(c!=null){var b=c.Collapsed;c.set_Collapsed(a.equals("col"));if(c.Collapsed==b&&c.CollapseClickEventDef==RD3Glb.EVENT_ACTIVE){c.RD3FrameChange(RD3Glb.WFR_COLLAPSED)}}return true};WebEntryPointSrv.prototype.HandleButtonBarEvent=function(b){var c=b.GetAttribute("obn");var d=c.indexOf(":");var a=parseInt(c.substr(4),10);if(a>0){this.CmdObj.CmdClick(a)}return true};WebEntryPointSrv.prototype.HandlePdfPrint=function(c){var d=c.GetAttribute("oid");for(var a=0;a<this.PDFPrints.Count();a++){var b=this.PDFPrints[a];if(b.PDFFile==d){b.Printed=true;if(b.AutoDelete){}this.PDFPrints.Remove(b);break}}return true};WebEntryPointSrv.prototype.HandleGraphClick=function(e){if(this.EatNextMessage){return true}var j=e.GetAttribute("oid");var a=e.GetAttribute("obn");if(j.startsWith("box")){var d=this.RD3FindBox(j);if(d!=null){d.RD3GraphClick(a)}}else{var c=this.FindWebFrame(j);if(c!=null){var b=c.FrIndex.toString();if(b.length==1){b="0"+b}b+=a;var h=c.Parent;h.GraphClick(this,b)}}return true};WebEntryPointSrv.prototype.HandleTabClick=function(c){if(this.EatNextMessage){return true}var a=c.GetAttribute("obn");var d=c.GetAttribute("oid");var b=this.FindWebFrame(a);if(b!=null){b.RD3SelectTab(d)}return true};WebEntryPointSrv.prototype.HandleDrop=function(b){var g=b.GetAttribute("oid");var e=b.GetAttribute("obn");if(g.startsWith("trn:")){var a=this.RD3FindNode(e);var c=this.RD3FindNode(g);this.TreeDropHelper(a,c,this.ShiftKey(),this.AltKey(),this.CtrlKey())}else{if(g.startsWith("box:")){var d=this.RD3FindBox(e);var f=this.RD3FindBox(g);if(d!=null&&f!=null){this.DTTObj.SetRequestName("Box Drop","Box Drop",DTTRequest.PRI_CMD);f.RD3Drop(d)}}}return true};WebEntryPointSrv.prototype.HandleTransform=function(a){var k=a.GetAttribute("oid");var b=a.GetAttribute("par1");var p=a.GetAttribute("par2");var g=a.GetAttribute("par3");var o=a.GetAttribute("par4");try{var l=parseFloat(b);var j=parseFloat(p);var m=parseFloat(g);var d=parseFloat(o);var c=this.RD3FindBox(k);if(c!=null){this.DTTObj.SetRequestName("Box Transform","Box Transform",DTTRequest.PRI_CMD);c.RD3Transform(l,j,m,d)}}catch(f){}return true};WebEntryPointSrv.prototype.HandleTreeRightClkEvent=function(c){if(this.EatNextMessage){return true}var b=c.GetAttribute("oid");var d=c.GetAttribute("par1");var k=0;var o=b.indexOf(":");var l=b.indexOf(":",o+1);var a=b.substr(o+1,l-o-1);var m=this.RD3FindNode(b);var j=m.TreeObj;var g=j.Parent;for(var e=0;e<this.CmdObj.CmdSets.length;e++){var h=this.CmdObj.CmdSets[e];if(h!=null&&h.GetRD3Ident()==d){k=h.Index;break}}g.TreeClick(this,IDL.Format(new IDVariant(j.FrIndex),new IDVariant("00"),this).stringValue()+a);if(k>0){this.CmdObj.ShowPopup(k,b,g.FormIdx,1)}return true};WebEntryPointSrv.prototype.HandleBookToolbarEvent=function(d){var f=d.GetAttribute("oid");var e=d.GetAttribute("obn");var c=parseInt(d.GetAttribute("par1"));var a=this.FindWebFrame(f);if(a!=null){a.RD3ToolbarHandler(e,c)}return true};WebEntryPointSrv.prototype.HandlePanelToolbarEvent=function(a){var d=a.GetAttribute("oid");var b=a.GetAttribute("obn");var c=this.FindWebFrame(d);if(c!=null){c.RD3PanelCommand(b)}return true};WebEntryPointSrv.prototype.HandleSearchBox=function(b){var d=b.GetAttribute("oid");var a=b.GetAttribute("obn");var c=this.FindWebFrame(d);if(c!=null){c.OnSearchBox(a)}return true};WebEntryPointSrv.prototype.HandlePanelMoreRows=function(a){var c=a.GetAttribute("oid");var b=this.FindWebFrame(c);if(b!=null){b.RD3MoreRows()}return true};WebEntryPointSrv.prototype.HandlePanelRowSelector=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("obn"),10);var a=parseInt(b.GetAttribute("par1"),10);var c=this.FindWebFrame(e);if(c!=null){c.RD3RowSel(d,a)}return true};WebEntryPointSrv.prototype.HandlePanelMultiSel=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("obn"),10);var a=b.GetAttribute("par1")=="-1";var c=this.FindWebFrame(e);if(c!=null){c.RD3MultiSel(d,a)}return true};WebEntryPointSrv.prototype.HandlePanelChangeRow=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("par1"),10);var a=parseInt(b.GetAttribute("par2"),10);var c=this.FindWebFrame(e);if(c!=null){c.RD3ChangeRow(d,a)}return true};WebEntryPointSrv.prototype.HandlePageClick=function(b){var a=b.GetAttribute("obn");var d=b.GetAttribute("oid");var c=this.FindWebFrame(a);if(c!=null){c.RD3SelectPage(d)}return true};WebEntryPointSrv.prototype.HandleMessageConfirm=function(b){var c=b.GetAttribute("obn");c=c.replace(/\r\n/g,"\n");var a=b.GetAttribute("par1");this.DTTObj.SetRequestName("User Response ("+(a.length>6?a.substr(6)+"...":a)+")","User has answered "+a,DTTRequest.PRI_CMD);this.ConfStack[c]=a;this.set_AlertType(0);return true};WebEntryPointSrv.prototype.HandleResize=function(c){var a=c.GetAttribute("oid");var q=c.GetAttribute("obn");var o=parseInt(c.GetAttribute("par1"),10);var g=parseInt(c.GetAttribute("par2"),10);if(a.equals("wep")){try{var b=parseInt(c.GetAttribute("par3"),10);var m=parseInt(c.GetAttribute("par4"),10);var p=parseInt(c.GetAttribute("par5"),10);var d=parseInt(c.GetAttribute("par6"),10);this.set_ScreenHeight(d);this.set_ScreenWidth(p);this.set_MDILeft(b);this.set_MDITop(m)}catch(l){}this.set_ScreenW(o);this.set_ScreenH(g);this.OnResize();return true}if(a.startsWith("frm")){var k=this.FindWebForm(a);if(k!=null){k.RD3Resize(new IDVariant(o),new IDVariant(g),false)}return true}if(a.startsWith("fld")){var k=this.RD3FindField(a);if(k!=null){k.RD3Resize(c)}return true}var j=this.FindWebFrame(a);if(j!=null){j.RD3Resize(o,g,q);return true}return true};WebEntryPointSrv.prototype.HandleRepositioning=function(c){var e=c.GetAttribute("oid");var a=parseInt(c.GetAttribute("par1"),10);var b=parseInt(c.GetAttribute("par2"),10);if(e.startsWith("frm")){var d=this.FindWebForm(e);if(d!=null){d.RD3Reposition(new IDVariant(a),new IDVariant(b),false)}return true}return true};WebEntryPointSrv.prototype.HandleChangeWindowState=function(b){var d=b.GetAttribute("oid");var a=parseInt(b.GetAttribute("par1"),10);if(d.startsWith("frm")){var c=this.FindWebForm(d);if(c!=null){c.RD3ChangeWindowState(new IDVariant(a))}return true}return true};WebEntryPointSrv.prototype.HandleCommand=function(a){return true};WebEntryPointSrv.prototype.HandleExpandListGroup=function(c){var a=c.GetAttribute("oid");var o=c.GetAttribute("obn");var f=c.GetAttribute("par1");var e=parseInt(c.GetAttribute("par2"),10);if(!a.startsWith("grl:")){return true}var m=-1;var l=a.indexOf(":",m+1);var k=a.indexOf(":",l+1);var j=a.indexOf(":",k+1);if(l==-1||k==-1||j==-1){return true}var d=a.substr(0,j);var g=this.FindWebFrame(d);if(g!=null&&g instanceof IDPanelSrv){var h=g;var b=parseInt(f,10);if(h.GroupRoot!=null){h.GroupRoot.RD3Expand(a,o.equals("1"),b,true,e)}}return true};WebEntryPointSrv.prototype.HandleGroupCollapseEvent=function(c){var b=c.GetAttribute("oid");var j=c.GetAttribute("obn");if(!b.startsWith("grp")){return true}var h=b.indexOf(":");var g=b.indexOf(":",h+1);var f=b.indexOf(":",g+1);if(h==-1||g==-1||f==-1){return true}var d=this.FindWebFrame(b.substr(g));if(d!=null&&d instanceof IDPanelSrv){var e=d;var a=parseInt(b.substr(h+1,g-h-1),10);e.bGroups(a).set_Collapsed(j.equals("col"),true)}return true};WebEntryPointSrv.prototype.HandleTextSelection=function(b){var e=b.GetAttribute("oid");var d=parseInt(b.GetAttribute("par1"),10);var a=parseInt(b.GetAttribute("par2"),10);var c=this.RD3FindField(e);if(c!=null&&c.Parent!=null){c.Parent.FieldTextSelectionChanged(c.Index,d,a)}return true};WebEntryPointSrv.prototype.HandleClientFocus=function(b){var f=b.GetAttribute("oid");var c=parseInt(b.GetAttribute("obn"),10);var e=b.GetAttribute("par1").equals("1");var a=this.FindWebFrame(f);if(a!=null&&a instanceof IDPanelSrv){var d=a;d.OnRD3ClientFocus(c,e)}return true};WebEntryPointSrv.prototype.HandleKeyPress=function(d){try{var k=parseInt(d.GetAttribute("obn"),10);var j=parseInt(d.GetAttribute("par1"),10);var a=d.GetAttribute("oid");var f=d.GetAttribute("ace");var b=null;var g=null;if(a!=null&&!a.equals("")){if(a.startsWith("frm:")){b=this.FindWebForm(a)}else{g=this.FindWebFrame(a);if(g!=null){b=g.Parent}}}var c=new IDVariant(false);if(g!=null){g.FireKeyPress(j,k,c)}if(b!=null&&c.isFalse()){b.FireKeyPress(g!=null?g.FrIndex:-1,j,k,c)}if(c.isFalse()){this.FireKeyPress(j,k)}}catch(h){}return true};WebEntryPointSrv.prototype.HandleVoice=function(a){try{this.VoiceObj.HandleVoice(a)}catch(b){}return true};WebEntryPointSrv.prototype.HandleScreenZoneSel=function(e){try{var a=e.GetAttribute("oid");var d=parseInt(e.GetAttribute("obn"),10);for(var b=0;b<this.screenZones.Count();b++){var f=this.screenZones.Get(b);if(f.GetRD3Ident()==a){f.set_SelectedForm(d);break}}}catch(c){}return true};WebEntryPointSrv.prototype.HandleIWUpload=function(b){this.WebEvent=b.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;var a=new Object();a.FileName=b.GetAttribute("par2");a.ContentType=b.GetAttribute("par3");a.Content=b.GetAttribute("par4");a.ContentLength=a.Content.length;this.Request.Files=[a];this.IWUpload_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWBlob=function(a){this.WebEvent=a.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;this.IWBlob_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWFiles=function(b){this.WebEvent=b.GetAttribute("par1");this.Request.WCE=this.WebEvent;this.Request.QueryString.WCE=this.WebEvent;var a=new Object();a.FileName=b.GetAttribute("par2");a.ContentType=b.GetAttribute("par3");a.Content=b.GetAttribute("par4");a.ContentLength=b.GetAttribute("par5");this.Request.Files=[a];this.IWFiles_UserEvent(this.WebEvent);return true};WebEntryPointSrv.prototype.HandleIWOAuth=function(d){var a=d.GetAttribute("obn");while(a){var g;var e=a.indexOf("&");if(e!=-1){g=a.substr(0,e).trim();a=a.substr(e+1)}else{g=a.trim();a=""}e=g.indexOf("=");if(e!=-1){var b=g.substr(0,e);var f=Glb.URLDecode(g.substr(e+1));this.Request.QueryString[b]=f}}this.IWOAuth_UserEvent();return true};WebEntryPointSrv.prototype.HandleSYNC=function(e){this.DTTObj.SetRequestName("End Synchronization","End Synchronization",DTTRequest.PRI_ITEM);var c=(e.GetAttribute("par1")=="1");var h=(e.GetAttribute("par2")=="1");var f=new IDArray();if(e.GetAttribute("par3")!=""){var a=e.GetAttribute("par3").split(",");for(var b=0;b<a.length;b++){f.add_Value(new IDVariant(a[b]))}}var d=(e.GetAttribute("par4").length>0?parseInt(e.GetAttribute("par4")):-1);var g=(e.GetAttribute("par5").length>0?parseInt(e.GetAttribute("par5")):-1);this.SyncObject.EndSynchronization(c,h,f,d,g);return true};WebEntryPointSrv.prototype.RD3AddEvent=function(a,b){var c=new RD3EventSrv();c.Name=a;c.Ident=b;if(this.ParamsObj().UseRD3){this.RD3Events.Add(c)}return c};WebEntryPointSrv.prototype.GetLiveForms=function(){var b=new ArrayList();for(var a=0;a<this.StackForm.Count();a++){var c=this.StackForm[a];b.Add(c);c.GetSubForm(b)}return b};WebEntryPointSrv.prototype.FindWebForm=function(a){var h=a.indexOf(":");var g=a.indexOf(":",h+1);if(h==-1){return null}var e;var c=(g==-1)?a.substr(h+1):a.substr(h+1,g-h-1);e=parseInt(c,10);if(isNaN(e)){return null}var d=null;if(this.ActiveForm()!=null&&this.ActiveForm().FormIdx==e){d=this.ActiveForm()}if(d==null){var k=this.GetLiveForms();for(var b=0;b<k.Count();b++){var j=k[b];if(j.FormIdx==e){d=j;break}}}return d};WebEntryPointSrv.prototype.FindWebFrame=function(c){var g=-1;if(c.startsWith("fld:")||c.startsWith("trn:")||c.startsWith("box:")||c.startsWith("ppg:")||c.startsWith("grp:")){g=c.indexOf(":")}var e=c.indexOf(":",g+1);var d=c.indexOf(":",e+1);if(e==-1||d==-1){return null}var a=parseInt(c.substr(e+1,d-e-1),10);if(isNaN(a)){return null}var b=this.FindWebForm(c.substr(d));if(b==null){return null}if(a==-1){return b.PreviewBook}else{return b.Frames[a].Content}};WebEntryPointSrv.prototype.RD3FindSpan=function(c){var e=c.indexOf(":");var d=c.indexOf(":",e+1);var a=this.FindWebFrame("book"+c.substr(d));if(a!=null){return a.BookObj.RD3FindSpan(c)}return null};WebEntryPointSrv.prototype.RD3FindBox=function(c){var e=c.indexOf(":");var d=c.indexOf(":",e+1);var a=this.FindWebFrame("book"+c.substr(d));if(a!=null){return a.BookObj.RD3FindBox(c)}return null};WebEntryPointSrv.prototype.RD3FindField=function(d){if(!d.startsWith("fld")){return null}var f=d.indexOf(":");var c=d.indexOf(":",f+1);if(f>0&&c>0){var a=d.substr(f+1,c-f-1);var b=this.FindWebFrame("pan"+d.substr(c));if(b!=null){var e=parseInt(a,10);if(!isNaN(e)&&e<b.Fields.length){return b.Fields[e]}}}return null};WebEntryPointSrv.prototype.RD3FindNode=function(b){var d=b.indexOf(":");var c=b.indexOf(":",d+1);var e=b.substr(d+1,c-d-1);var a=this.FindWebFrame(b.substr(c));if(a!=null){return a.GetNode(e)}return null};WebEntryPointSrv.prototype.RD3FindCommand=function(b){var d=b.indexOf(":");var c=b.indexOf(":",d+1);if(c==-1){c=b.length}var a=parseInt(b.substr(d+1,c-d-1),10);if(isNaN(a)){return null}if(this.CmdObj.CmdLin.length<=a){return null}return this.CmdObj.CmdLin[a]};WebEntryPointSrv.prototype.RD3Reset=function(){this.DesktopRendered=false;for(var c=0;c<this.StackForm.Count();c++){var b=this.StackForm[c];for(var a=0;a<b.Frames.length;a++){if(b.Frames[a]!=null&&b.Frames[a].Content!=null&&b.Frames[a].Content instanceof IDPanelSrv){b.Frames[a].Content.ResetRD3Cache()}if(b.Frames[a]!=null&&b.Frames[a].Content!=null&&b.Frames[a].Content instanceof OBookSrv){b.Frames[a].Content.RD3ResetPageCache(true)}}if(b.PreviewBook!=null){b.PreviewBook.RD3ResetPageCache(true)}}};WebEntryPointSrv.prototype.RD3StartRequest=function(){for(var c=0;c<this.StackForm.Count();c++){var b=this.StackForm[c];for(var a=0;a<b.Frames.length;a++){if(b.Frames[a]!=null&&b.Frames[a].Content!=null){b.Frames[a].Content.RD3StartRequest()}}}};WebEntryPointSrv.prototype.RD3EndRequest=function(){var a=this.StackForm.Clone();for(var d=0;d<a.Count();d++){var c=a[d];for(var b=0;b<c.Frames.length;b++){if(c.Frames[b]!=null&&c.Frames[b].Content!=null){if((c==this.ActiveForm()||c.Docked)&&c.Frames[b].Content instanceof IDPanelSrv){c.Frames[b].Content.RD3Validate=true}c.Frames[b].Content.RD3EndRequest()}}}if(this.AlertType()==0){this.ConfStack.clear()}};WebEntryPointSrv.prototype.WelcomeUrl=function(){return this.WelcomeURL};WebEntryPointSrv.prototype.set_WelcomeUrl=function(a){this.WelcomeURL=a;this.RD3Change(RD3Glb.WEP_WELCOME)};WebEntryPointSrv.prototype.Widget=function(){return this.WidgetMode};WebEntryPointSrv.prototype.set_Widget=function(a){this.WidgetMode=a;this.RD3Change(RD3Glb.WEP_WIDGETMODE)};WebEntryPointSrv.prototype.AutoCollapseMenu=function(){return(this.CompOwner!=null?this.CompOwner.AutoCollapseMenu():this.MenuAutoCollapse)};WebEntryPointSrv.prototype.set_AutoCollapseMenu=function(a){if(this.CompOwner!=null){this.CompOwner.set_AutoCollapseMenu(a)}else{if(a!=this.MenuAutoCollapse){this.MenuAutoCollapse=a;if(this.MenuAutoCollapse>0){for(var b=1;b<this.CmdObj.CmdSets.length;b++){this.CmdObj.CmdSets[b].PrepareForAutocollapse(this.MenuAutoCollapse)}}}}};WebEntryPointSrv.prototype.set_LogoffURL=function(a){this.LogoffURL=a;this.RD3Change(RD3Glb.WEP_SHOWLOGOFF)};WebEntryPointSrv.prototype.SideMenuWidth=function(){return(this.CompOwner!=null?this.CompOwner.SideMenuWidth():this.iSideMenuWidth)};WebEntryPointSrv.prototype.set_SideMenuWidth=function(a){if(this.CompOwner!=null){this.CompOwner.set_SideMenuWidth(a)}else{this.iSideMenuWidth=a;this.RD3Change(RD3Glb.WEP_MENUWIDTH)}};WebEntryPointSrv.prototype.AccentColor=function(){return(this.CompOwner!=null?this.CompOwner.AccentColor():this.iAccentColor)};WebEntryPointSrv.prototype.set_AccentColor=function(a){if(this.CompOwner!=null){this.CompOwner.set_AccentColor(a)}else{this.iAccentColor=a;this.RD3Change(RD3Glb.WEP_ACCENTCOLOR)}};WebEntryPointSrv.prototype.RefreshInterval=function(){return(this.CompOwner!=null?this.CompOwner.RefreshInterval():this.iRefreshInterval)};WebEntryPointSrv.prototype.set_RefreshInterval=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshInterval(a)}else{this.iRefreshInterval=a;this.RD3Change(RD3Glb.WEP_REFRESHINT)}};WebEntryPointSrv.prototype.RefreshUI=function(){return(this.CompOwner!=null?this.CompOwner.RefreshUI():this.iRefreshUI)};WebEntryPointSrv.prototype.set_RefreshUI=function(a){if(this.CompOwner!=null){this.CompOwner.set_RefreshUI(a)}else{this.iRefreshUI=a}};WebEntryPointSrv.prototype.RD3ServerParams=function(a){var b=a.AddNewElement("par");b.SetAttribute("thm",this.ParamsObj().Theme);b.SetAttribute("sli",this.ParamsObj().SmartLookupIcon);b.SetAttribute("shd",this.ParamsObj().ShowDisabledIcons?"1":"0");b.SetAttribute("rai",this.ParamsObj().RightAlignedIcons?"1":"0");b.SetAttribute("sfi",this.ParamsObj().ShowFieldImageInValue?"1":"0");b.SetAttribute("amp",this.ParamsObj().AllowMasterPanelNav?"1":"0");b.SetAttribute("sda",this.ParamsObj().ShowDisabledFieldActivator?"1":"0");b.SetAttribute("tem",this.ParamsObj().TooltipErrorMode.toString());b.SetAttribute("frs",this.ParamsObj().EnableFrameResize?"1":"0");b.SetAttribute("jsu",this.ParamsObj().UseHTML5Upload?"1":"0");b.SetAttribute("cpb",this.ParamsObj().CompletePanelBorders?"1":"0");b.SetAttribute("uzn",this.ParamsObj().UseZones?"1":"0");b.SetAttribute("brt",this.ParamsObj().BorderType.toString());b.SetAttribute("ued",this.ParamsObj().UseIDEditor?"1":"0");b.SetAttribute("cmk",""+this.ParamsObj().DefaultCurrencyMask);b.SetAttribute("dmk",""+this.ParamsObj().DefaultDateMask);b.SetAttribute("tmk",""+this.ParamsObj().DefaultTimeMask);b.SetAttribute("fmk",""+this.ParamsObj().DefaultFloatMask);b.SetAttribute("M001",this.RTCObj.GetConst("9320F18C-116E-4788-9D72-408754B7414D","Aggiorna la visualizzazione",false));b.SetAttribute("M002",this.RTCObj.GetConst("B9659CF1-1CF2-43f1-A8B8-BC093C796877","I criteri di ricerca sono stati azzerati",false));b.SetAttribute("M003",this.RTCObj.GetConst("40309EDE-81DD-407F-8F25-B9C39B01055F","Torna all'applicazione",false));b.SetAttribute("M004",this.RTCObj.GetConst("A61E8784-7812-44E2-9001-937ED881302F","E' necessario inserire un valore",false));b.SetAttribute("M005",this.RTCObj.GetConst("E98B1F3C-C3D2-4202-8AE6-539A2CF24551","Cancella Documento",false));b.SetAttribute("M006",this.RTCObj.GetConst("169C7BE9-A5B4-40E7-AE1B-92B4FE344A5A","Carica Documento",false));b.SetAttribute("M007",this.RTCObj.GetConst("78F371EA-E7F4-4F30-A3F0-6F7E6924F157","Chiude la videata",false));b.SetAttribute("M008",this.RTCObj.GetConst("2E8B0CC4-B9E8-4579-906D-8A4E9109CF32","Chiude la videata",false));b.SetAttribute("M009",this.RTCObj.GetConst("38ABB688-409C-43A8-BA9F-1ECACD08D957","Chiude l'applicazione",false));b.SetAttribute("M010",this.RTCObj.GetConst("22771A06-0BFD-49B4-B853-FB17DD9E85D7","Chiudi Tutto",false));b.SetAttribute("M011",this.RTCObj.GetConst("677C7F88-80DD-4483-9003-1268B5852F5C","Gestisci Allegati",false));b.SetAttribute("M012",this.RTCObj.GetConst("ADCA4013-3CA1-4D6A-AB95-FEFE161F1CA2","Gestisci Commenti",false));b.SetAttribute("M013",this.RTCObj.GetConst("8B4A3A38-94D6-4FB0-AC8C-E954025FFE75","Confermi la cancellazione?",false));b.SetAttribute("M014",this.RTCObj.GetConst("CD813F50-12CE-4DDF-AFC1-30B5EB8D85A7","Conferma la scelta",false));b.SetAttribute("M015",this.RTCObj.GetConst("F4DD1CE8-BF24-43AF-9753-1302DFDFE68E","Crea un file PDF per la stampa",false));b.SetAttribute("M016",this.RTCObj.GetConst("58BF840D-5DA5-4667-B34C-403F3BE24CA0","Confermi?",false));b.SetAttribute("M017",this.RTCObj.GetConst("AAE29D7E-7545-4115-9945-5CD74D125325","Stampa il report",false));b.SetAttribute("M018",this.RTCObj.GetConst("B1AC743E-369F-4F50-A80C-F0ABE2850DDF","Click per aprire il documento (|1)",false));b.SetAttribute("M019",this.RTCObj.GetConst("BAA77E7E-38E7-44C5-A3DD-243896EA653E","Scegli un documento da caricare (max dim. |1):",false));b.SetAttribute("M020",this.RTCObj.GetConst("EDBD7ED0-0DA7-4877-968F-04F500C68009","Mostra il menù",false));b.SetAttribute("M021",this.RTCObj.GetConst("07F7A1CE-D5F3-415C-B18B-221D2A53B11B","Mostra il riquadro",false));b.SetAttribute("M022",this.RTCObj.GetConst("673FEFC1-2B3E-4FAA-A203-2AE4A0BFF4EA","Nasconde il menù",false));b.SetAttribute("M023",this.RTCObj.GetConst("F947D8CD-BBBB-408A-8BCD-F8FE88172649","Nasconde il riquadro",false));b.SetAttribute("M024",this.RTCObj.GetConst("44F06A32-2D4F-41F5-805A-151C0C38BF1E","Pagina |1 di |2",false));b.SetAttribute("M025",this.RTCObj.GetConst("6980AD68-ED7B-4072-AA7B-0D6E0601E0D3","Pagina precedente",false));b.SetAttribute("M026",this.RTCObj.GetConst("3948B6AB-6CC2-487B-BFC7-43E3703F8409","Pagina precedente",false));b.SetAttribute("M027",this.RTCObj.GetConst("1E96B37D-935E-490B-9D33-BB8644B53528","Pagina successiva",false));b.SetAttribute("M028",this.RTCObj.GetConst("3B623495-689F-4581-B23B-EA5DE94FDC90","Pagina successiva",false));b.SetAttribute("M029",this.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1",false));b.SetAttribute("M030",this.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576","Riga |1 di |2",false));b.SetAttribute("M031",this.RTCObj.GetConst("6ABFFB5D-2E2C-40EF-AD39-9FADA6B96563","Nuova Riga",false));b.SetAttribute("M032",this.RTCObj.GetConst("B04012F8-21CC-45C3-9879-B32D52AF4061","Inserisci criteri di ricerca",false));b.SetAttribute("M033",this.RTCObj.GetConst("C3123089-8533-472D-91BC-F394F71B4FEF","DATI MODIFICATI",false));b.SetAttribute("M034",this.RTCObj.GetConst("198FC43B-3EFC-4326-9E28-3077DD5C4107","Annulla le modifiche",false));b.SetAttribute("M035",this.RTCObj.GetConst("27745E44-6434-4FD9-97FD-8A38D1B51D57","Cerca i dati tramite i criteri di ricerca",false));b.SetAttribute("M036",this.RTCObj.GetConst("3C3FA079-82BB-4F79-8352-A38E00BE0E4C","Cancella la riga selezionata",false));b.SetAttribute("M037",this.RTCObj.GetConst("7A5319D1-4527-4248-8274-938516E162A0","Deseleziona tutte le righe",false));b.SetAttribute("M038",this.RTCObj.GetConst("CABC5476-EF69-4F9D-AC4A-11B26625A963","Duplica la riga",false));b.SetAttribute("M039",this.RTCObj.GetConst("2652029A-73A8-4CB0-BF89-3D0820FEF165","Visualizza la lista o il dettaglio",false));b.SetAttribute("M040",this.RTCObj.GetConst("894F3A97-E470-4524-AC63-6761FF30FEC8","Vai ad una riga vuota per inserire un nuovo dato",false));b.SetAttribute("M041",this.RTCObj.GetConst("47E3DDC3-8074-42FD-9388-5227AF374A5D","Blocca i dati",false));b.SetAttribute("M042",this.RTCObj.GetConst("25B0C66D-51F0-44BB-9B3E-B5C4604D4D0A","Mostra i checkbox per la selezione multipla delle righe",false));b.SetAttribute("M043",this.RTCObj.GetConst("0396E047-4630-4059-B451-DE792393929F","Mostra i bottoni per la selezione delle righe",false));b.SetAttribute("M044",this.RTCObj.GetConst("BF8E9457-11AB-4EAA-889E-9477F2380097","Ricarica i dati dal database",false));b.SetAttribute("M045",this.RTCObj.GetConst("59DD9DD1-1E4E-47DF-B2B2-61A28E85D98F","Seleziona tutte le righe",false));b.SetAttribute("M046",this.RTCObj.GetConst("B5D47A63-66DA-49F6-BF37-0D5762173EDE","Trova i dati nel database",false));b.SetAttribute("M047",this.RTCObj.GetConst("CC63539D-2E1F-46CB-AEF9-F1DD14EEFDBA","Permetti di modificare i dati",false));b.SetAttribute("M048",this.RTCObj.GetConst("2769ADE5-2860-4F74-907C-57F84D893EAE","Registra le modifiche",false));b.SetAttribute("M049",this.RTCObj.GetConst("E86FAD7D-D471-4BAB-A551-B7D348CF8F20","Vai alla fine",false));b.SetAttribute("M050",this.RTCObj.GetConst("45ED1144-48EE-4B32-852C-91FCCDF88930","Vai alla fine",false));b.SetAttribute("M051",this.RTCObj.GetConst("E94579CB-4078-4A7d-803F-55E270FCACCD","Vai all'inizio",false));b.SetAttribute("M052",this.RTCObj.GetConst("146D7307-76B5-4252-A762-B9CBF88F7C57","Vai all'inizio",false));b.SetAttribute("M053",this.RTCObj.GetConst("BCEBD1D9-23E1-4087-9AE0-1FBE3143E84C","Videate Aperte",false));b.SetAttribute("M054",this.RTCObj.GetConst("FAD9E562-D3CF-41C4-A548-F06997EC3C4A","Visualizza Documento",false));b.SetAttribute("M055",this.RTCObj.GetConst("156D9D40-97F9-461C-B8E5-347E75C471FB","Riga |1",false));b.SetAttribute("M056",this.RTCObj.GetConst("A681B53C-BE95-4FEC-8BBE-99A4C3C27576","Riga |1 di |2",false));b.SetAttribute("M057",this.RTCObj.GetConst("58C9F7B6-E6E6-4BAB-B184-2D0C18569BF8","Esporta i dati in Excel",false));b.SetAttribute("M058",this.RTCObj.GetConst("0D21AD28-8DEB-47F5-B216-CF09387064EE","Errore:",false));b.SetAttribute("M059",this.RTCObj.GetConst("664A0C65-7966-4B99-9A34-197D66E43498","Effetti:",false));b.SetAttribute("M060",this.RTCObj.GetConst("6DB549C8-7FD6-4079-B725-96F50670CA0D","Cosa fare:",false));b.SetAttribute("M061",this.RTCObj.GetConst("81CAF4C5-9473-4217-A80D-3A65F53692D7","Causa:",false));b.SetAttribute("M062",this.RTCObj.GetConst("40309EDE-81DD-407F-8F25-B9C39B01055F","Torna all'applicazione",false));b.SetAttribute("M063",this.RTCObj.GetConst("43A079DF-1B3F-4A4C-A5EB-C82B52ABD31A","Attendere prego...",false));b.SetAttribute("M064",this.RTCObj.GetConst("25FDAC1D-F960-45F2-883E-2076D96D2715","Mostra/Nasconde i raggruppamenti",false));b.SetAttribute("M065",this.RTCObj.GetConst("8D797BA1-E282-44a2-BD8B-586378B96186","Mostra i comandi per la selezione delle righe",false))};WebEntryPointSrv.prototype.RenderAllImages=function(a){};WebEntryPointSrv.prototype.AddToPreload=function(b,a){};WebEntryPointSrv.prototype.StreamFile=function(a){};WebEntryPointSrv.prototype.IWStream_UserEvent=function(a){};WebEntryPointSrv.prototype.RDLevel=function(){if(!this.UseRD){return 0}else{if(!this.ParamsObj().UseRD3){return 2}else{return 3}}};WebEntryPointSrv.prototype.BrowserInfo=function(h){if(h==undefined){h=false}if(this.BInfo_Type!=-1){return(h?this.BInfo_Ver:this.BInfo_Type)}if(this.Request==null){return -1}var d=new Array("MSIE ","Chrome/","Safari/","Firefox/","iPhone","iPad","Android","Android");var k=this.Request.Headers["User-Agent"];var a=this.Request.Headers.Referer;if(a!=null&&a.indexOf("iphone")>0){k="Safari/iPhone"}if(a!=null&&a.indexOf("ipad")>0){k="Safari/iPad"}if(a!=null&&a.indexOf("s3")>0){k="Android Mobile"}if(a!=null&&(a.indexOf("n7")>0||a.indexOf("a10")>0)){k="Android"}if(k!=null){this.BInfo_Type=0;for(var c=1;c<=d.length;c++){var j=d[c-1];var g=k.indexOf(j);if(g!=-1){if(j.equals("Safari/")){if(k.indexOf("iPhone")>=0||k.indexOf("iPad")>=0||k.indexOf("Android")>=0){continue}}this.BInfo_Type=c;if(j.equals("Android")&&k.indexOf("Mobile")!=-1){this.BInfo_Type=8}if(j.equals("Safari/")){j="Version/";g=k.indexOf(j);if(g==-1){break}}if(j.equals("iPhone")||j.equals("iPad")||j.equals("Android")){this.BInfo_Ver=3;break}if(j.equals("MSIE ")&&k.indexOf(" ARM")!=-1){this.BInfo_Type=9}var b=k.indexOf(".",g);if(b!=-1){try{g+=j.length;this.BInfo_Ver=parseInt(k.substr(g,b-g),10)}catch(f){}}break}}if(this.BInfo_Type==0&&k.indexOf("Trident/7.0")!=-1){if(k.indexOf(" ARM")!=-1){if(k.indexOf("Phone ")!=-1){BInfo_Type=10}else{BInfo_Type=9}}else{this.BInfo_Type=1}this.BInfo_Ver=11}}return(h?this.BInfo_Ver:this.BInfo_Type)};WebEntryPointSrv.prototype.set_EnableGFX=function(a){if(this.ParamsObj().EnableGFX!=a){this.ParamsObj().EnableGFX=a;this.RD3Change(RD3Glb.WEP_ENABLEGFX)}};WebEntryPointSrv.prototype.EnableSound=function(){return this.ParamsObj().EnableSound};WebEntryPointSrv.prototype.set_EnableSound=function(a){if(ParamsObj().EnableSound!=a){this.ParamsObj().EnableSound=a;this.RD3Change(RD3Glb.WEP_ENABLESND)}};WebEntryPointSrv.prototype.GetAppLanguage=function(){return null};WebEntryPointSrv.prototype.GetAppUrl=function(b,a){if(b==undefined){b=true}if(a==undefined){a=true}return null};WebEntryPointSrv.prototype.GetApplication=function(){return(this.CompOwner==null?this:this.CompOwner.GetApplication())};WebEntryPointSrv.prototype.UserAgent=function(){return(this.Request!=null?this.Request.Headers["User-Agent"]:"")};WebEntryPointSrv.prototype.SetWebServiceURL=function(a,b){this.WebServicesUrl[a]=b};WebEntryPointSrv.prototype.AddTempFile=function(a){this.TempFiles.Add(a)};WebEntryPointSrv.prototype.ExecuteOnClient=function(a){this.RD3CliExecute.Add(a)};WebEntryPointSrv.prototype.OpenFormsCount=function(){return this.StackForm.Count()};WebEntryPointSrv.prototype.GetOpenForm=function(a){return this.StackForm[a]};WebEntryPointSrv.prototype.SoundAction=function(c,a,d,f,e,j,b,h){if(d==undefined){d=-1}if(f==undefined){f=-1}if(e==undefined){e=-1}if(j==undefined){j=false}if(b==undefined){b=false}if(h==undefined){h=null}var g=this.RD3AddEvent("sound",a);g.SetAttribute("action",c);if(d!=-1){g.SetAttribute("volume",d.toString())}if(f!=-1){g.SetAttribute("t1",f.toString())}if(e!=-1){g.SetAttribute("t2",e.toString())}if(j){g.SetAttribute("notify","1")}if(b){g.SetAttribute("progress","1")}if(h!=null&&h.length>0){g.SetAttribute("video",h)}};WebEntryPointSrv.prototype.ShowTooltip=function(f,j,e,q,p,d,g,l,h,o,c,m,a,b){if(b==undefined){b=null}var k=this.RD3AddEvent("tooltip",e);k.CanSendInFulltree=true;k.SetAttribute("title",j);k.SetAttribute("text",f);if(q!=-1){k.SetAttribute("anchorx",q.toString())}if(p!=-1){k.SetAttribute("anchory",p.toString())}if(d!=0){k.SetAttribute("position",d.toString())}if(g!=750){k.SetAttribute("showdelay",g.toString())}if(l!=4000){k.SetAttribute("hidedelay",l.toString())}if(h){k.SetAttribute("showoninactivity","1")}if(o!=-1){k.SetAttribute("width",o.toString())}if(c!=-1){k.SetAttribute("height",c.toString())}if(m!="info"){k.SetAttribute("style",m)}if(!a){k.SetAttribute("haswhisker","0")}if(b!=null){k.SetAttribute("image",b)}};WebEntryPointSrv.prototype.DispatchToComp=function(d,g){if(this.CompList.Count()==0){return}var c=false;var e=null;var b=this.GetApplication();e=b.CompAlreadyNotified;if(e==null){e=new ArrayList();b.CompAlreadyNotified=e;c=true}for(var f=0;f<this.CompList.Count();f++){var h=this.CompList[f];if(h.SharedInstance&&e.IndexOf(h.CompNameSpace)!=-1){continue}var a=h[d];if(a!=null){e.Add(h.CompNameSpace);a.apply(h,g)}}if(c){b.CompAlreadyNotified=null}};WebEntryPointSrv.prototype.DispatchToOwner=function(b,c){if(this.CompOwner==null){return}var a=this.CompOwner[b];if(a!=null){a.apply(this.CompOwner,c)}};WebEntryPointSrv.prototype.KeyHandle=function(){return(this.CompOwner!=null?this.CompOwner.KeyHandle():this.ListenKeys)};WebEntryPointSrv.prototype.set_KeyHandle=function(a){if(this.CompOwner!=null){this.CompOwner.set_KeyHandle(a)}else{this.ListenKeys=a}};WebEntryPointSrv.prototype.ScreenZone=function(a){for(var b=0;b<this.screenZones.Count();b++){var c=this.screenZones.Get(b);if(c.Position()==a){return c}}return null};WebEntryPointSrv.prototype.FireKeyPress=function(a,b){if((this.KeyHandle()&a)==0){return}this.OnKeyPress(new IDVariant(a),new IDVariant(b))};WebEntryPointSrv.prototype.IsMobile=function(){if(this.iIsMobile==-1){this.iIsMobile=0;if(String.compare(this.ParamsObj().Theme.substring(0,6),"mobile",true)==0){this.iIsMobile=1}if(String.compare(this.ParamsObj().Theme.substring(0,6),"quadro",true)==0){this.iIsMobile=1}}return this.iIsMobile==1};WebEntryPointSrv.prototype.UseZones=function(){return this.ParamsObj().UseZones&&!this.IsSmartPhone()};WebEntryPointSrv.prototype.IsSmartPhone=function(){if(this.ScreenHeight()==0||this.ScreenWidth()==0){return this.IsMobile()&&(this.BrowserInfo()==5||this.BrowserInfo()==8||this.BrowserInfo()==10)}else{return this.IsMobile()&&this.ScreenHeight()<=800&&this.ScreenWidth()<=800}};WebEntryPointSrv.prototype.IsTablet=function(){return !this.IsSmartPhone()};WebEntryPointSrv.prototype.AddCustomToManifest=function(a){};WebEntryPointSrv.prototype.AddCaseInsensitive=function(b,a){};WebEntryPointSrv.prototype.GetManifestFileList=function(){};WebEntryPointSrv.prototype.CreateManifest=function(){};WebEntryPointSrv.prototype.GetMimeFromExtension=function(a){if(this.CompOwner!=null){return this.CompOwner.GetMimeFromExtension(a)}if(this.MimeMap==null){this.FillMimeMap()}return this.MimeMap.get_Value(new IDVariant(a.toLowerCase())).stringValue()};WebEntryPointSrv.prototype.GetExtensionFromMime=function(d){if(this.CompOwner!=null){return this.CompOwner.GetExtensionFromMime(d)}if(this.MimeMap==null){this.FillMimeMap()}var c=this.MimeMap.GetKeys();for(var b=0;b<c.Size();b++){var a=c.get_Value(new IDVariant(b)).stringValue();if(this.MimeMap.get_Value(new IDVariant(a)).stringValue().equals(d)){return a}}return""};WebEntryPointSrv.prototype.FillMimeMap=function(){this.MimeMap=new IDMap();this.MimeMap.set_Value(new IDVariant("txt"),new IDVariant("text/plain"));this.MimeMap.set_Value(new IDVariant("htm"),new IDVariant("text/html"));this.MimeMap.set_Value(new IDVariant("html"),new IDVariant("text/html"));this.MimeMap.set_Value(new IDVariant("css"),new IDVariant("text/css"));this.MimeMap.set_Value(new IDVariant("bmp"),new IDVariant("image/bmp"));this.MimeMap.set_Value(new IDVariant("png"),new IDVariant("image/png"));this.MimeMap.set_Value(new IDVariant("gif"),new IDVariant("image/gif"));this.MimeMap.set_Value(new IDVariant("jpe"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("jpg"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("jpeg"),new IDVariant("image/jpeg"));this.MimeMap.set_Value(new IDVariant("tif"),new IDVariant("image/tiff"));this.MimeMap.set_Value(new IDVariant("tiff"),new IDVariant("image/tiff"));this.MimeMap.set_Value(new IDVariant("mp3"),new IDVariant("audio/mpeg"));this.MimeMap.set_Value(new IDVariant("wav"),new IDVariant("audio/wav"));this.MimeMap.set_Value(new IDVariant("avi"),new IDVariant("video/avi"));this.MimeMap.set_Value(new IDVariant("mpeg"),new IDVariant("video/mpeg"));this.MimeMap.set_Value(new IDVariant("asf"),new IDVariant("video/x-ms-asf"));this.MimeMap.set_Value(new IDVariant("qt"),new IDVariant("video/quicktime"));this.MimeMap.set_Value(new IDVariant("csv"),new IDVariant("application/vnd.ms-excel"));this.MimeMap.set_Value(new IDVariant("xls"),new IDVariant("application/vnd.ms-excel"));this.MimeMap.set_Value(new IDVariant("doc"),new IDVariant("application/msword"));this.MimeMap.set_Value(new IDVariant("rtf"),new IDVariant("application/msword"));this.MimeMap.set_Value(new IDVariant("pps"),new IDVariant("application/vnd.ms-powerpoint"));this.MimeMap.set_Value(new IDVariant("ppt"),new IDVariant("application/vnd.ms-powerpoint"));this.MimeMap.set_Value(new IDVariant("gz"),new IDVariant("application/x-gzip"));this.MimeMap.set_Value(new IDVariant("gzip"),new IDVariant("application/x-gzip"));this.MimeMap.set_Value(new IDVariant("js"),new IDVariant("application/x-javascript"));this.MimeMap.set_Value(new IDVariant("swf"),new IDVariant("application/x-shockwave-flash"));this.MimeMap.set_Value(new IDVariant("zip"),new IDVariant("application/x-zip-compressed"));this.MimeMap.set_Value(new IDVariant("pdf"),new IDVariant("application/pdf"));this.MimeMap.set_Value(new IDVariant("xlsx"),new IDVariant("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"));this.MimeMap.set_Value(new IDVariant("ppsx"),new IDVariant("application/vnd.openxmlformats-officedocument.presentationml.slideshow"));this.MimeMap.set_Value(new IDVariant("pptx"),new IDVariant("application/vnd.openxmlformats-officedocument.presentationml.presentation"));this.MimeMap.set_Value(new IDVariant("docx"),new IDVariant("application/vnd.openxmlformats-officedocument.wordprocessingml.document"));this.MimeMap.set_Value(new IDVariant("dotx"),new IDVariant("application/vnd.openxmlformats-officedocument.wordprocessingml.template"))};WebEntryPointSrv.prototype.TraceEvent=function(a,c,b){};WebEntryPointSrv.prototype.TraceError=function(a){};WebEntryPointSrv.prototype.IWSync_UserEvent=function(a){var c=parseInt(GetParameter("FTR"),10);var d=new XMLDoc();d.LoadFromString(this.GetParameter("SYNCDATA"));var b=this.SyncObject.SyncToLocal(d,c);this.Response.responseXML=d.SaveToString(c)};WebEntryPointSrv.prototype.OnOwaMessage=function(b,c,a){};WebEntryPointSrv.prototype.IWOwa_UserEvent=function(a){};WebEntryPointSrv.prototype.IWOAuth_UserEvent=function(a){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",100,"MainFrm.OAuth_UserEvent","OAuth request detected");this.DTTObj.SetRequestName("OAuth","OAuth",DTTRequest.PRI_ITEM);var c=this.Request.QueryString.state;if(c==null||c.length==0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","State parameter not found")}else{try{var f=IDL.Base64Decode(c);var b=IOTConnector.ServiceConnector(this,f);if(b==null){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","Connector not found")}else{b.RequestAccessToken()}}catch(d){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"MainFrm.OAuth_UserEvent","Unable to decode state parameter")}}this.RenderPage()};WebEntryPointSrv.prototype.GetFontsList=function(a){};WebEntryPointSrv.prototype.AddFontsFileList=function(a){};WebEntryPointSrv.prototype.SupportsHTML5Upload=function(){var c=false;if(this.ParamsObj().UseHTML5Upload==true){var a=this.BrowserInfo(false);var b=this.BrowserInfo(true);if(a==2){c=true}if(a==3&&b>=6){c=true}if(a==4&&b>=4){c=true}if(a==1&&b>=10){c=true}}return c};WebEntryPointSrv.prototype.GetRequestHeaders=function(){var a=new IDMap();return a};WebEntryPointSrv.Sessions=new HashTableSrv();WebEntryPointSrv.ShutDownTime=new Date(0);WebEntryPointSrv.prototype.ShutDownMessage=0;WebEntryPointSrv.iComPassword="";WebEntryPointSrv.ComPassword=function(){};WebEntryPointSrv.set_ComPassword=function(a){};WebEntryPointSrv.HandleComRequest=function(a){};WebEntryPointSrv.prototype.CheckRestartWarning=function(){};WebEntryPointSrv.prototype.CreateWEP=function(){return null};WebEntryPointSrv.prototype.OnSessionMessage=function(c,b,a,d){this.DispatchToComp("OnSessionMessage",new Array(c,b,a,d))};WebEntryPointSrv.prototype.IsServerSession=function(){return(!this.SessionName.equals(""))};WebEntryPointSrv.prototype.SendSessionMessage=function(b,c,h,s){if(h==undefined){h=5000}if(s==undefined){s=new IDArray()}var g=(new Date()).getTime()+(h<=0?30000:h);for(var j=0;j<s.Size();j++){var p=s.GetNative()[j];if(!(p==null||p instanceof IDVariant)){this.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",400,"MainFrm.SendSessionMessage","You can't pass an object as an argument of a message; the message was not sent");return new IDVariant()}}var t=new IDVariant();var f=false;while((new Date()).getTime()<g){f=WebEntryPointSrv.SSManager.SendMessage(this.SessionName,b,c,s);if(f){break}else{IDL.Sleep(50)}}if(!f){return new IDVariant()}if(h==0){g+=24*60*60*1000}while((new Date()).getTime()<g){try{var k="SELECT Result";k+=" FROM Sessions";k+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);k+=" AND SessionName = "+IDL.Quote(b);var d=WebEntryPointSrv.SSManager.ExecuteQuery(k);if(d.rows.length==1){var q=d.rows.item(0);var m=parseInt(q.Result.substr(0,1),10);var o=q.Result.substr(2);t=new IDVariant(o,m)}}catch(l){WriteToConsoleError("Error while reading result of message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}if(h==-1&&t.Type==IDVariant.INTEGER&&t.intValue()==-1){try{var k="UPDATE Sessions SET";k+=" FromSessionName = NULL,";k+=" Result = NULL";k+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);k+=" AND SessionName = "+IDL.Quote(b);WebEntryPointSrv.SSManager.ExecuteQuery(k)}catch(l){WriteToConsoleError("Error while cleaning message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}return new IDVariant(0)}if(t.Type!=IDVariant.INTEGER||t.intValue()>0){var a=(t.Type==IDVariant.INTEGER?new IDVariant():new IDVariant(t));try{var k="UPDATE Sessions SET";k+=" FromSessionName = NULL,";k+=" Result = NULL";k+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);k+=" AND SessionName = "+IDL.Quote(b);WebEntryPointSrv.SSManager.ExecuteQuery(k)}catch(l){WriteToConsoleError("Error while cleaning message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}return a}IDL.Sleep(50)}try{var k="UPDATE Sessions SET";k+=" FromSessionName = NULL,";k+=" Result = NULL";k+=" WHERE FromSessionName = "+IDL.Quote(this.SessionName);k+=" AND SessionName = "+IDL.Quote(b);WebEntryPointSrv.SSManager.ExecuteQuery(k)}catch(l){WriteToConsoleError("Error while cleaning message '"+this.iMessage+"' of '"+this.iFromSessionName+"'")}return new IDVariant()};function ProgressBar(a){this.m_Present=0;this.m_Total=1;this.m_Message="";this.MainFrm=a;this.Abortable=false;this.Aborted=false}ProgressBar.prototype.StartPhase=function(a,c,b){if(a!=0){this.m_Total=a}this.m_Present=0;this.m_Message=c;this.Abortable=b;this.Aborted=false;try{var d="UPDATE Sessions SET";d+=" Phase = "+IDL.Quote(this.m_Message)+",";d+=" Progress = 0,";d+=" Aborted = 0";d+=" WHERE SessionName = "+IDL.Quote(this.MainFrm.SessionName);WebEntryPointSrv.SSManager.ExecuteQuery(d)}catch(g){WriteToConsoleError("Error while writing phase of '"+this.MainFrm.SessionName+"'")}if(!this.MainFrm.IsServerSession()){var f=new Object();f.present=this.m_Present;f.total=this.m_Total;f.canAbort=this.Abortable;f.message=this.m_Message;myPostMessage({type:"progress",message:f})}};ProgressBar.prototype.TrackPhase=function(g,a){if(g==-1){this.m_Present++}else{this.m_Present=g}if(a!=-1){this.m_Total=a}if(this.m_Present>this.m_Total){this.m_Present=this.m_Total}try{var c="UPDATE Sessions SET";c+=" Progress = "+((this.m_Present+0)/(this.m_Total>0?this.m_Total:1));c+=" WHERE SessionName = "+IDL.Quote(this.MainFrm.SessionName);c+=" AND Aborted = 0";var b=WebEntryPointSrv.SSManager.ExecuteQuery(c,true);this.Aborted=(b.rowsAffected!=1)}catch(f){WriteToConsoleError("Error while writing progress of '"+this.MainFrm.SessionName+"'")}if(this.Aborted){return false}else{if(!this.MainFrm.IsServerSession()){var d=new Object();d.present=this.m_Present;d.total=this.m_Total;d.canAbort=this.Abortable;d.message=this.m_Message;myPostMessage({type:"progress",message:d})}return true}return false};function WebFormSrv(){this.FormIdx=0;this.BaseTimerIdx=0;this.BaseCmdSetIdx=0;this.BaseCmdLinIdx=0;this.HasCaptionToolbar=-1;this.iCaption=new IDVariant();this.iWebCaption=new IDVariant();this.Owner=0;this.OpenAs=0;this.ActivedTick;this.Frames;this.MainFrm;this.IMDB;this.IndObj;this.JustLoaded;this.ActiveElement="";this.FocusPriority;this.Docked=false;this.DockType=0;this.Visible=true;this.ParentSuf=null;this.ParentBox=null;this.IdxPanelActived;this.IdxFieldActived;this.ActivedDocument=null;this.ActivedProperty=null;this.ActivedExtProperty=null;this.ToolbarPosition;this.iBorderType;this.iVisualFlags=-1;this.iImage="";this.iBackButTxt="";this.Messages=new ArrayList();this.RTCGuid="";this.HelpFile="";this.UploadingPanel;this.TruePopup=0;this.DownloadingBlob;this.DownloadingFrame;this.iDocAttached=null;this.OrgCaption=null;this.PreviewBook=null;this.CloseOnSelection=false;this.AutoSaveType="NONE";this.FormLeft;this.FormTop;this.FormWidth;this.FormHeight;this.ResModeW;this.ResModeH;this.OrgWidth;this.OrgHeight;this.DesignWidth;this.DesignHeight;this.iWindowState=Glb.WS_NORMAL;this.TagMap=null;this.RD3Changed=false;this.RD3PropChg=new BitArray(RD3Glb.FRM_MAXPROP);this.FreezePos=false;this.ToolbarEventDef=RD3Glb.EVENT_ACTIVE;this.FormListEventDef=RD3Glb.EVENT_ACTIVE;this.ResizeEventDef=RD3Glb.EVENT_ACTIVE;this.ShowAnimationDef=null;this.ModalAnimationDef=null;this.MessageAnimationDef=null;this.LastMessageAnimationDef=null;this.PreviewAnimationDef=null;this.DockedAnimationDef=null;this.PopupResizeAnimationDef=null;this.ListenKeys=0}WebFormSrv.prototype.SetMainFrm=function(a,b){this.Visible=false;this.Init(a,true,false)};WebFormSrv.prototype.SetSubMainFrm=function(a,b){this.Init(a,true,true)};WebFormSrv.NewInstance=function(w,imdb,ClassName,OpenAs,AttachTo){if(AttachTo==undefined){AttachTo=null}var wf=eval("new "+(w.CompNameSpace!=null&&!ClassName.startsWith(w.CompNameSpace+".")?w.CompNameSpace+".":"")+ClassName+"()");if(wf==null){for(var i=0;i<w.CompList.length;i++){var cmp=w.CompList[i];wf=eval("new "+(!ClassName.startsWith(cmp.CompNameSpace+".")?cmp.CompNameSpace+".":"")+ClassName+"()");if(wf!=null){w=cmp;imdb=cmp.IMDB;break}}}if(wf!=null){if(OpenAs==-3){wf.SetSubMainFrm(w,imdb)}else{wf.SetMainFrm(w,imdb)}}if(wf!=null&&AttachTo!=null){wf.set_Document(AttachTo);for(var i=1;i<wf.Frames.length;i++){if(wf.Frames[i].Content!=null&&wf.Frames[i].Content instanceof IDPanelSrv){var p=wf.Frames[i].Content;if(p.IsDO()&&AttachTo.TypeName()==p.bQueries(0).MstTableName&&p.Status()!=Glb.PS_DATA&&(p.Flags&Glb.PAN_HASFORM)!=0&&p.MasterPanelCode==null&&p.MasterPanelIdx==0){p.SetQueryDocument(0,AttachTo,AttachTo.Parent()==null);break}}}}if(wf!=null&&(OpenAs!=-2&&OpenAs!=-3)){w.ShowMultipleForm(wf,OpenAs)}return wf};WebFormSrv.prototype.IsMultiple=function(){return this.FormIdx>65536};WebFormSrv.prototype.Init=function(b,c,a){this.MainFrm=b;if(this.IMDB==null){this.IMDB=this.MainFrm.IwImdb.IMDB}this.IndObj=this.MainFrm.IndObj;this.AutoSaveType=this.MainFrm.ParamsObj().AutoSaveType;this.ToolbarPosition=this.MainFrm.ParamsObj().ToolbarPosition;this.iBorderType=this.MainFrm.ParamsObj().BorderType;if(this.OpenAs!=Glb.OPEN_MDI){this.ActivedDocument=b.ActivedDocument;this.ActivedProperty=b.ActivedProperty;this.ActivedExtProperty=b.ActivedExtProperty;b.ActivedExtProperty=null;b.ActivedProperty=null;b.ActivedDocument=null}this.FormLeft=-1;this.FormTop=-1;this.FormWidth=-1;this.FormHeight=-1};WebFormSrv.prototype.set_Document=function(b){var a=this.iDocAttached;if(this.iDocAttached!=b){this.iDocAttached=b;this.OnChangeDocument(a);this.DOSetCaption()}};WebFormSrv.prototype.Document=function(){return this.iDocAttached};WebFormSrv.prototype.DOSetCaption=function(){if(this.iDocAttached!=null){if(this.OrgCaption==null){this.OrgCaption=this.Caption()}if(this.iDocAttached.Deleted()||this.iDocAttached.Hidden()){this.set_Document(null)}else{this.set_Caption(new IDVariant(this.iDocAttached.GetName(1)+(this.iDocAttached.IsModified()?"*":"")));this.set_WebCaption(new IDVariant(this.iDocAttached.GetName(2)+(this.iDocAttached.IsModified()?"*":"")))}}else{if(this.OrgCaption!=null){this.set_Caption(this.OrgCaption)}}};WebFormSrv.prototype.set_Visible=function(a){if(a!=this.Visible){this.Visible=a;if(!this.Visible&&this.MainFrm.ActiveForm()==this){var b=this.MainFrm.GetFormToFocus();if(b!=null){this.MainFrm.BringToFront(b.FormIdx)}else{this.MainFrm.BringToFront(-1)}}if(this.MainFrm.ParamsObj().UseRD3&&this.Visible&&this.MainFrm.ActiveForm()==null){this.MainFrm.BringToFront(this.FormIdx)}if(this.MainFrm.DockedForm()==this){this.MainFrm.RDDockForm=true}this.RD3Change(RD3Glb.FRM_VISIBLE)}};WebFormSrv.prototype.ProcessRequest=function(e,c){if(this.UploadingPanel!=null){this.UploadingPanel.UploadBlob(this.MainFrm,this,e);this.UploadingPanel=null;return}if(this.PreviewBook!=null){this.PreviewBook.ProcessRequest(this.MainFrm,this,e,c)}else{for(var d=1;d<this.Frames.length;d++){if(!this.Frames[d].InTabbed&&!this.Frames[d].IsSubFrame){this.Frames[d].ProcessRequest(this.MainFrm,e,c)}}}if(!c){if(this.MainFrm.GetParameter("closex.x")!=null||this.MainFrm.GetParameter("mno.x")!=null){this.RD3Close(false)}if(this.MainFrm.GetParameter("myes.x")!=null){this.RD3Close(true)}if(this.HasCaptionToolbar==1){this.MainFrm.CmdObj.ProcessCaptionRequest(0,this,this.MainFrm)}for(var d=0;d<this.Messages.Count();d++){var b=this.Messages[d];if(!b.AutoDelete){if(this.MainFrm.GetParameter("clmsg"+b.RIndex+".x")!=null){this.Messages.Remove(b);d--}}}}};WebFormSrv.prototype.RD3Close=function(a){var b="closex";if(this.MainFrm.GetParameter("mno.x")!=null){b="mno"}if(this.MainFrm.GetParameter("myes.x")!=null){b="myes"}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,25,"Form.ProcessRequest","Form "+this.Caption()+" closed");this.MainFrm.DTTObj.SetRequestName("Close Form","Form "+this.Caption()+" closed",DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.RTCGuid,DTTEngine.TST_FRMCLOSE,"Form "+this.Caption()+" close","",b);this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Chiudi la videata "+this.Caption());this.MainFrm.UnloadForm(this.FormIdx,a)};WebFormSrv.prototype.HasMessages=function(){return this.Messages.Count()>0};WebFormSrv.prototype.ClearMessages=function(e,c,f){for(var d=0;d<this.Messages.Count();d++){var b=this.Messages[d];if(b.Source==e&&(f==-1||f==b.NumRow)&&(c==null||b.Code.equals(c))){this.Messages.Remove(b);this.RD3Changed=true;d--;if(b.SrcErr!=null){b.SrcErr.Shown=false}}}};WebFormSrv.prototype.HasOtherMessages=function(d){for(var c=0;c<this.Messages.Count();c++){var b=this.Messages[c];if(b.Source!=d){return true}}return false};WebFormSrv.prototype.SetMessage=function(h,b,g,d,m,l,j,e){if(e==undefined){e=null}var f=null;var p=false;for(var k=0;k<this.Messages.Count();k++){var o=this.Messages[k];if(o.Source==h&&o.NumRow==l&&o.Code.equals(m)){var c=g.equals("")&&o.AutoDelete;if(c){this.Messages.Remove(o);k--;this.RD3Changed=true}else{f=o;p=true}break}}if(!g.equals("")||p){if(f==null){f=new AMessageSrv();f.Parent=this;this.Messages.Add(f);f.RIndex=this.Messages.Count()}f.Source=h;f.Code=m;f.NumRow=l;f.Type=b;f.Text=g;f.Icon=d;f.SrcErr=e;f.AutoDelete=!j||g.equals("");f.RD3Change(RD3Glb.MSG_TEXT);f.RD3Change(RD3Glb.MSG_CODE);f.RD3Change(RD3Glb.MSG_ICON);f.RD3Change(RD3Glb.MSG_TYPE);f.RD3Change(RD3Glb.MSG_TEMPORARY)}};WebFormSrv.prototype.FormHasErrors=function(){return Glb.IsFormInError(this.Frames)};WebFormSrv.prototype.FormIsUpdated=function(){return Glb.IsFormUpdated(this.Frames)};WebFormSrv.prototype.SearchBook=function(a){return null};WebFormSrv.prototype.SearchPanel=function(a){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null){if(this.Frames[b].Content instanceof IDPanelSrv){var c=this.Frames[b].Content;if(c.Code.equals(a)){return c}}}}return null};WebFormSrv.prototype.Form_Activate=function(){};WebFormSrv.prototype.Form_Deactivate=function(a){};WebFormSrv.prototype.OnResize=function(c,a,b){};WebFormSrv.prototype.OnMove=function(c,a,b){};WebFormSrv.prototype.OnChangeState=function(b,a){};WebFormSrv.prototype.IntFormUnload=function(a,b){};WebFormSrv.prototype.OnChangeDocument=function(a){};WebFormSrv.prototype.UnloadForm=function(b,g){if(this.ActivedDocument!=null&&this.ActivedProperty!=null&&this.ActivedExtProperty!=null&&this.ActivedExtProperty.LinkedDoc!=null&&g){var d=false;for(var c=0;c<this.Frames.length&&!d;c++){if(this.Frames[c]!=null&&this.Frames[c].Content!=null&&this.Frames[c].Content instanceof IDPanelSrv){var f=this.Frames[c].Content.GetDocument();if(f!=null&&this.ActivedExtProperty.LinkedDoc.GetDocumentClass()==f.TypeName()){d=true;var e=f.GetMD();for(var a=1;a<=e.GetNumProp();a++){if(e.GetProp(a).PK){this.ActivedDocument.SetPropByIndex(this.ActivedProperty.Index,f.GetPropByIndex(a));break}}}}}}for(var c=0;c<this.Frames.length;c++){if(this.Frames[c]!=null&&this.Frames[c].Content!=null&&this.Frames[c].Content instanceof IDPanelSrv){this.Frames[c].Content.RD3EndRequest()}}};WebFormSrv.prototype.UpdateControls=function(){if(this.IsMultiple()){for(var a=0;a<this.IMDB.DBSize();a++){if(!this.IMDB.IsMasterTable(a)){this.IMDB.TblResetModified(a,Glb.GlbRefModIdx)}}this.IMDB.ResetModified(Glb.GlbRefModIdx,false)}for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv&&this.Frames[a].Content.pSubForm!=null){this.Frames[a].Content.pSubForm.UpdateControls()}}};WebFormSrv.prototype.CmdClickCB=function(a){};WebFormSrv.prototype.TimerTickCB=function(a){};WebFormSrv.prototype.EndModal=function(a,b){};WebFormSrv.prototype.TreeExpand=function(b,a){var e=parseInt(a.substr(0,2),10);var d=this.Frames[e].Content;var f=d.GetNode(a.substr(2));if(f!=null){b.DTTObj.SetRequestName("Tree "+(f.Expanded?"Collapse":"Expand"),"Form "+this.Caption()+": tree item "+f.Name+(f.Expanded?" collapsed":" expanded"),DTTRequest.PRI_CMD);var c=new IDVariant();if(d.IsDO){d.FireOnChangeExpandDoc(f.Doc,!f.Expanded,c)}else{d.FireOnChangeExpandNode(f.HashKey,!f.Expanded,c)}if(c.isFalse()){f.ToggleExpansion(this.MainFrm,true)}f.RD3Change(RD3Glb.TRN_EXPANDED)}};WebFormSrv.prototype.TreeClick=function(b,a){var d=parseInt(a.substr(0,2),10);var c=this.Frames[d].Content;var e=c.GetNode(a.substr(2));if(e!=null){b.DTTObj.SetRequestName("Tree Click","Form "+this.Caption()+": tree item "+e.Name+" clicked",DTTRequest.PRI_CMD);c.FireNodeClick(e,b)}};WebFormSrv.prototype.GraphClick=function(b,a){var d=parseInt(a.substr(0,2),10);var c=this.Frames[d].Content;b.DTTObj.SetRequestName("Graph Click","Form "+this.Caption()+": graph point "+a.substr(2)+" clicked",DTTRequest.PRI_CMD);c.FireGraphClick(a.substr(2),b)};WebFormSrv.prototype.OnSendMessage=function(e,d,c,b,a,g,f){};WebFormSrv.prototype.SendMessage=function(f,e,d,c,b,h,g){if(d==undefined){d=null}if(c==undefined){c=new IDVariant()}if(b==undefined){b=new IDVariant()}if(h==undefined){h=new IDVariant()}if(g==undefined){g=new IDVariant()}var a=null;if(e!=null&&e instanceof WebFormSrv){a=e}this.OnSendMessage(f,a,d,c,b,h,g)};WebFormSrv.prototype.GetParent=function(){if(this.ParentSuf!=null){return this.ParentSuf.Parent}else{if(this.ParentBox!=null&&this.ParentBox.GetParentBook().Parent.ParentS!=null){return this.ParentBox.GetParentBook().Parent.ParentS.Parent}}return null};WebFormSrv.prototype.SubForm_Activate=function(){for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv&&this.Frames[a].Content.pSubForm!=null){this.Frames[a].Content.pSubForm.Form_Activate();this.Frames[a].Content.pSubForm.SubForm_Activate()}}};WebFormSrv.prototype.SubForm_Deactivate=function(a){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null&&this.Frames[b].Content instanceof ASubFormSrv&&this.Frames[b].Content.pSubForm!=null){this.Frames[b].Content.pSubForm.Form_Deactivate(a);this.Frames[b].Content.pSubForm.SubForm_Deactivate(a)}}};WebFormSrv.prototype.SubIntFormUnload=function(a,c){for(var b=0;b<this.Frames.length;b++){if(this.Frames[b]!=null&&this.Frames[b].Content!=null&&this.Frames[b].Content instanceof ASubFormSrv&&this.Frames[b].Content.pSubForm!=null){this.Frames[b].Content.pSubForm.IntFormUnload(a,c);this.Frames[b].Content.pSubForm.SubIntFormUnload(a,c)}}};WebFormSrv.prototype.DownloadBlob=function(a){var d=parseInt(a.substr(0,2),10);var c=parseInt(a.substr(2),10);if(d<0||d>=this.Frames.length){return false}try{this.DownloadingFrame=d;this.DownloadingBlob=c;return this.Frames[d].Content.DownloadBlob(c,this.MainFrm)}catch(b){return false}};WebFormSrv.prototype.set_Caption=function(a){if(!this.iCaption.equals(a)){this.iCaption.set(a);this.iWebCaption=new IDVariant(Glb.HTMLEncode(a.stringValue()));this.RD3Change(RD3Glb.FRM_CAPTION);this.RD3Change(RD3Glb.FRM_WEBCAPTION)}};WebFormSrv.prototype.Caption=function(){return new IDVariant(this.iCaption)};WebFormSrv.prototype.WebCaption=function(){return new IDVariant(this.iWebCaption)};WebFormSrv.prototype.set_WebCaption=function(a){if(!this.iWebCaption.equals(a)){this.iWebCaption.set(a);this.RD3Change(RD3Glb.FRM_WEBCAPTION)}};WebFormSrv.prototype.DockingType=function(){return this.DockType};WebFormSrv.prototype.set_DockingType=function(a){if(this.DockType!=a){if(this.MainFrm.UseZones()){var b=this.MainFrm.ScreenZone(a);if(b!=null){b.AddForm(this)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,RTCGuid,280,"Form.DockType","Form "+Caption()+": Unable to find zone "+a+", docking not changed")}}else{this.DockType=a}}};WebFormSrv.prototype.DTTTrace=function(a){if(a.DTTObj.AddTraceItem(this.RTCGuid,DTTEngine.TRC_ITFORM,"ActiveForm.Render","")){a.DTTObj.AddTraceToken(this.RTCGuid,DTTEngine.TRC_FORMCAPTION,"Form.Caption",this.Caption(),"")}};WebFormSrv.prototype.toString=function(){return this.Caption().stringValue()};WebFormSrv.prototype.Resize=function(b,a){};WebFormSrv.prototype.GetPadding=function(a){if(a){if(this.Caption().stringValue().length>0){return 64}else{return 16}}else{return 16}};WebFormSrv.prototype.ReleaseLock=function(){Glb.ReleaseForm(this.Frames)};WebFormSrv.prototype.DBError=function(c,b,a,e,d){var f=this.Caption()+" - "+this.Frames[c.FrIndex].Caption;this.MainFrm.ErrObj.PanelError(c,b,a.intValue(),e.intValue(),f,d)};WebFormSrv.prototype.RTCReset=function(){this.MainFrm.RTCObj.SelectForm(this.RTCGuid);this.MainFrm.RTCObj.ConfigureForm(this);for(var a=1;a<this.Frames.length;a++){var b=this.Frames[a];if(b==null){continue}if(b.Content instanceof OBookSrv){this.MainFrm.RTCObj.ConfigureBook(this,b.Content)}else{if(b.Content instanceof OButBarSrv){this.MainFrm.RTCObj.ConfigureButtonBar(this,b.Content)}else{if(b.Content instanceof ATreeSrv){this.MainFrm.RTCObj.ConfigureTree(this,b.Content)}else{if(b.Content instanceof AGraphSrv){this.MainFrm.RTCObj.ConfigureGraph(this,b.Content)}else{if(b.Content instanceof OTabViewSrv){this.MainFrm.RTCObj.ConfigureTabbed(this,b.Content)}else{if(b.Content instanceof IDPanelSrv){this.MainFrm.RTCObj.ConfigurePanel(this,b.Content);b.Content.CalcLayout()}}}}}}}this.MainFrm.RolObj.ApplyRoles(this.FormIdx,this)};WebFormSrv.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFormSrv.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};WebFormSrv.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFormSrv.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};WebFormSrv.prototype.GetPanelsCount=function(){var b=0;for(var a=1;a<this.Frames.length;a++){if(this.Frames[a].Content!=null&&this.Frames[a].Content instanceof IDPanelSrv){b++}}return new IDVariant(b)};WebFormSrv.prototype.GetPanel=function(c){var b=0;for(var a=1;a<this.Frames.length;a++){if(this.Frames[a].Content!=null&&this.Frames[a].Content instanceof IDPanelSrv&&b++==c.intValue()){return this.Frames[a].Content}}return null};WebFormSrv.prototype.ResetUpload=function(){if(this.UploadingPanel!=null){for(var a=0;a<this.UploadingPanel.UFields();a++){if(this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).Uploading){this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).Uploading=false;this.UploadingPanel.bFields(a).bValues(this.UploadingPanel.AttR).RD3Change(RD3Glb.VAL_TEXT)}}this.UploadingPanel=null}};WebFormSrv.prototype.ValidateCell=function(a,e,d,b,c,g,f){};WebFormSrv.prototype.ValidateRow=function(a,b){};WebFormSrv.prototype.DynamicProperties=function(a){};WebFormSrv.prototype.CellActivated=function(a,c,b){};WebFormSrv.prototype.OnChangePage=function(a,c,b){};WebFormSrv.prototype.OnChangeLayout=function(a,c,b){};WebFormSrv.prototype.OnChangeLocking=function(a,c,b){};WebFormSrv.prototype.OnChangeRow=function(a){};WebFormSrv.prototype.OnChangeStatus=function(b,a){};WebFormSrv.prototype.OnPanelCommand=function(a,d,c,b){};WebFormSrv.prototype.BeforeFind=function(a,b){};WebFormSrv.prototype.BeforeInsert=function(a,b){};WebFormSrv.prototype.BeforeUpdate=function(a,b){};WebFormSrv.prototype.BeforeBlobUpdate=function(c,d,b,a,f,e){};WebFormSrv.prototype.OnDownloadBlob=function(d,e,c,b,h,f,a,g){};WebFormSrv.prototype.BeforeDelete=function(a,b){};WebFormSrv.prototype.AfterInsert=function(a){};WebFormSrv.prototype.AfterUpdate=function(a){};WebFormSrv.prototype.AfterFind=function(a,b){};WebFormSrv.prototype.OnSelectingRow=function(a){};WebFormSrv.prototype.OnSorting=function(a,c,b){};WebFormSrv.prototype.OnChangeSelection=function(b,a,d,c){};WebFormSrv.prototype.AfterBlobUpdate=function(c,b,a,d){};WebFormSrv.prototype.AfterDelete=function(a){};WebFormSrv.prototype.BeforeCommit=function(a,b){};WebFormSrv.prototype.AfterCommit=function(c,b,a){};WebFormSrv.prototype.OnDBError=function(a,e,d,h,c,g,b,f){};WebFormSrv.prototype.TabClick=function(b,a,c){};WebFormSrv.prototype.NodeClick=function(a,b){};WebFormSrv.prototype.OnTreeDropNode=function(b,c,e,g,f,d,a){};WebFormSrv.prototype.OnTreeExpandNode=function(a,c,b){};WebFormSrv.prototype.OnTreeActivateNode=function(a,c,b){};WebFormSrv.prototype.OnTreeChangeSelNode=function(a,d,e,c,b){};WebFormSrv.prototype.OnTreeDropDoc=function(b,f,g,e,d,a,c){};WebFormSrv.prototype.OnTreeExpandDoc=function(a,c,b){};WebFormSrv.prototype.OnTreeActivateDoc=function(a,c,b){};WebFormSrv.prototype.OnTreeChangeSelDoc=function(a,d,e,c,b){};WebFormSrv.prototype.OnFormattingPage=function(b,a){};WebFormSrv.prototype.OnFormattingSection=function(a,b){};WebFormSrv.prototype.OnAfterFormattingSection=function(a,b){};WebFormSrv.prototype.OnChangingSpan=function(c,e,a,b,d){};WebFormSrv.prototype.OnBoxDrop=function(b,c,a){};WebFormSrv.prototype.OnBoxTransform=function(b,e,f,d,g,a,c){};WebFormSrv.prototype.OnConnecting=function(b,a){};WebFormSrv.prototype.Activated=function(a,c,b){};WebFormSrv.prototype.OnIMDBUpdate=function(a,b){};WebFormSrv.prototype.OnPreview=function(a){};WebFormSrv.prototype.OnPrint=function(c,d,a,b){};WebFormSrv.prototype.CreateDocument=function(a,c,b){};WebFormSrv.prototype.OnOpenPopup=function(a,c,b){};WebFormSrv.prototype.OnCmdSetCommand=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetGeneralDrag=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetGeneralDrop=function(a,d,c,b){};WebFormSrv.prototype.OnChangeCollapse=function(a,c,b){};WebFormSrv.prototype.OnGraphClick=function(a,c,b){};WebFormSrv.prototype.OnRenderToolbar=function(a,c,b){};WebFormSrv.prototype.OnBookCommand=function(a,d,c,b){};WebFormSrv.prototype.OnCmdSetChangeExpand=function(b,a,c){};WebFormSrv.prototype.OnTreeChangeExpandNode=function(a,d,c,b){};WebFormSrv.prototype.OnTreeChangeExpandDoc=function(a,d,c,b){};WebFormSrv.prototype.OnMouseClick=function(d,b,h,g,k,e,f,a,j){};WebFormSrv.prototype.OnMouseDoubleClick=function(d,b,h,g,k,e,f,a,j){};WebFormSrv.prototype.OnMouseClick=function(c,d,b,h,g,a,e,f){};WebFormSrv.prototype.OnMouseDoubleClick=function(c,d,b,h,g,a,e,f){};WebFormSrv.prototype.OnMouseClick=function(b,a,f,d,j,c,e,g,h){};WebFormSrv.prototype.OnMouseDoubleClick=function(b,a,f,d,j,c,e,g,h){};WebFormSrv.prototype.OnMouseClick=function(c,b,g,e,j,d,f,a,h){};WebFormSrv.prototype.OnMouseDoubleClick=function(c,b,g,e,j,d,f,a,h){};WebFormSrv.prototype.OnMouseClick=function(d,e,b,h,g,a,c,f){};WebFormSrv.prototype.OnMouseDoubleClick=function(d,e,b,h,g,a,c,f){};WebFormSrv.prototype.OnReorderColum=function(b,c,a){};WebFormSrv.prototype.OnResizeColum=function(a,c,b){};WebFormSrv.prototype.OnGenericDrag=function(b,a,d,c){};WebFormSrv.prototype.OnGenericDrop=function(a,j,k,c,g,f,l,d,b,e,h){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,j,b,e,d,k,c,h,f){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,h,b,f,e,j,c,d){};WebFormSrv.prototype.OnGenericDrag=function(b,a,c,d){};WebFormSrv.prototype.OnGenericDrop=function(a,g,h,c,f,e,j,d,b){};WebFormSrv.prototype.OnExpandingGroup=function(b,a,c){};WebFormSrv.prototype.OnChangeGroupCollapse=function(a,b){};WebFormSrv.prototype.OnShowMultipleSelection=function(a,d,b,c){};WebFormSrv.prototype.OnChangeTextSelection=function(b,c,a,d){};WebFormSrv.prototype.OnFocus=function(a,b,c){};WebFormSrv.prototype.OnFrameKeyPress=function(b,a,d,c){};WebFormSrv.prototype.OnFormKeyPress=function(d,a,c,b){};WebFormSrv.prototype.OnGetLKE=function(b,c,d,g,a,f,e){};WebFormSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.FormIdx};WebFormSrv.prototype.GetRD3Name=function(){return"frm"};WebFormSrv.prototype.RD3Change=function(a,b){if(b==undefined){b=true}this.RD3PropChg[a]=b;this.RD3Changed=true};WebFormSrv.prototype.RD3RenderDifferences=function(h,m){if(this.MainFrm.ActiveForm()!=null&&this.MainFrm.ActiveForm()==this){this.ActivedTick=this.MainFrm.ClickCounter()}this.DTTTrace(this.MainFrm);var b=null;if(m){b=h.AddNewElement(this.GetRD3Name())}if(!m&&!this.RD3Changed){for(var g=1;g<this.Frames.length;g++){if(this.Frames[g].RD3NewObj||this.Frames[g].RD3DelObj){this.RD3Changed=true;break}}}for(var g=0;g<this.Messages.Count();g++){var d=this.Messages[g];if(!d.RD3Rendered){this.RD3Changed=true;break}}if(b==null&&this.RD3Changed){b=h.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}var l=this.RD3Changed;if(m||this.RD3Changed){for(var g=0;g<this.RD3PropChg.length;g++){if(this.RD3PropChg[g]||m){this.SetRD3Property(g,b,m)}}this.RD3Changed=false;this.RD3PropChg.SetAll(false)}if(m){if(this.FormListEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("flc",this.FormListEventDef.toString())}if(this.ToolbarEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("clk",this.ToolbarEventDef.toString())}if(this.ResizeEventDef!=RD3Glb.EVENT_ACTIVE){b.SetAttribute("res",this.ResizeEventDef.toString())}if(this.ShowAnimationDef!=null){b.SetAttribute("sha",this.ShowAnimationDef)}if(this.ModalAnimationDef!=null){b.SetAttribute("mda",this.ModalAnimationDef)}if(this.MessageAnimationDef!=null){b.SetAttribute("mga",this.MessageAnimationDef)}if(this.LastMessageAnimationDef!=null){b.SetAttribute("lma",this.LastMessageAnimationDef)}if(this.PreviewAnimationDef!=null){b.SetAttribute("pra",this.PreviewAnimationDef)}if(this.DockedAnimationDef!=null){b.SetAttribute("dka",this.DockedAnimationDef)}if(this.PopupResizeAnimationDef!=null){b.SetAttribute("ppr",this.PopupResizeAnimationDef)}if(this.ListenKeys!=0){b.SetAttribute("hks",this.ListenKeys.toString())}if(this.Owner!=0){var j=this.MainFrm.GetFormByIndex(this.Owner);if(j!=null){b.SetAttribute("own",j.GetRD3Ident())}}}var e=(m)?b:h;for(var g=1;g<this.Frames.length;g++){if(this.Frames[g].RD3NewObj){this.Frames[g].RD3RenderDifferences(b,true);this.Frames[g].RD3NewObj=false}else{if(this.Frames[g].RD3DelObj&&this.Frames[g].Content!=null){if(!m){var c=h.AddNewElement("chg");c.SetAttribute("id",this.Frames[g].GetRD3Ident());c.SetAttribute("dcl","1")}this.Frames[g]=new AFrameSrv(g);this.Frames[g].RD3DelObj=true}else{l|=this.Frames[g].RD3RenderDifferences(e,m)}}}if(this.PreviewBook!=null){var f=null;if(m){f=e.AddNewElement(this.PreviewBook.GetRD3Name());f.SetAttribute("id",this.PreviewBook.GetRD3Ident());f.SetAttribute("cap",this.PreviewBook.BookObj.GetName())}l|=(this.PreviewBook.RD3RenderDifferences(f,e,m)!=null)}for(var g=0;g<this.Messages.Count();g++){var d=this.Messages[g];if(!d.RD3Rendered){l|=d.RD3RenderDifferences(b,true)}else{l|=d.RD3RenderDifferences(e,m)}}for(var g=0;g<this.Messages.Count();g++){var k=this.Messages[g];if(!k.AutoDelete){continue}if(k.Type!=AMessageSrv.MSG_INFO&&(k.Source instanceof IDPanelSrv||k.Source instanceof PFieldSrv||k.Source instanceof IDDocument||typeof(k.Source)=="string")){k.RD3Rendered=false;continue}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,28,"Form.RenderMessages","Form "+this.Caption()+": remove temporary message "+k.Text);this.Messages.Remove(k);g--;this.RD3Changed=true}if(m&&this.BaseTimerIdx>0){this.MainFrm.TimerObj.RD3RenderDifferences(b,true,this.FormIdx)}if(m&&this.BaseCmdSetIdx>0){this.MainFrm.CmdObj.RD3RenderDifferences(b,true,this.FormIdx)}return l};WebFormSrv.prototype.SetRD3Property=function(b,d,c){switch(b){case RD3Glb.FRM_IDXFORM:d.SetAttribute("idx",this.FormIdx.toString());break;case RD3Glb.FRM_CAPTION:var a=this.Caption().stringValue();d.SetAttribute("cap",a);break;case RD3Glb.FRM_WEBCAPTION:var a=this.WebCaption().stringValue();if(this.MainFrm.ParamsObj().DemoMode==1){a+="&nbsp;(DEMO)"}d.SetAttribute("wcp",a);break;case RD3Glb.FRM_IMAGE:if(this.iImage.length==0&&c){break}d.SetAttribute("img",this.iImage);break;case RD3Glb.FRM_MODAL:if(this.OpenAs==Glb.OPEN_MDI&&c){break}d.SetAttribute("mod",this.OpenAs.toString());break;case RD3Glb.FRM_DOCKED:if(!this.Docked&&c){break}d.SetAttribute("doc",this.Docked?"1":"0");break;case RD3Glb.FRM_DOCKTYPE:if(this.DockType==0&&c){break}d.SetAttribute("dot",this.DockType.toString());break;case RD3Glb.FRM_VISIBLE:if(this.Visible&&c){break}d.SetAttribute("vis",this.Visible?"1":"0");break;case RD3Glb.FRM_TOOLBARPOS:if(this.ToolbarPosition==Glb.FORMTOOL_LEFT&&c){break}d.SetAttribute("tbp",this.ToolbarPosition.toString());break;case RD3Glb.FRM_BORDERTYPE:if(this.iBorderType==Glb.BORDER_THICK&&c){break}d.SetAttribute("bdt",this.iBorderType.toString());break;case RD3Glb.FRM_VISPROP:if(this.iVisualFlags==-1&&c){break}d.SetAttribute("vfl",this.iVisualFlags.toString());break;case RD3Glb.FRM_FORMLEFT:if(this.FormLeft==-1&&c){break}d.SetAttribute("lef",this.FormLeft.toString());break;case RD3Glb.FRM_FORMTOP:if(this.FormTop==-1&&c){break}d.SetAttribute("top",this.FormTop.toString());break;case RD3Glb.FRM_FORMWIDTH:var g=this.FormWidth;if((this.Docked)&&g==-1){var e=this.Frames[1].GetTotalSize();g=e.Width}if(g==-1&&c){break}d.SetAttribute("wid",g.toString());break;case RD3Glb.FRM_FORMHEIGHT:var g=this.FormHeight;if((this.Docked)&&g==-1){var e=this.Frames[1].GetTotalSize();g=e.Height}if(g==-1&&c){break}d.SetAttribute("hei",g.toString());break;case RD3Glb.FRM_RESMODEW:if(this.ResModeW==0&&c){break}d.SetAttribute("rew",this.ResModeW.toString());break;case RD3Glb.FRM_RESMODEH:if(this.ResModeH==0&&c){break}d.SetAttribute("reh",this.ResModeH.toString());break;case RD3Glb.FRM_PREVIEW:if(this.PreviewBook==null&&c){break}d.SetAttribute("pre",(this.PreviewBook==null)?"":this.PreviewBook.GetRD3Ident());if(this.PreviewBook!=null&&!c){var f=d.AddNewElement(this.PreviewBook.GetRD3Name());f.SetAttribute("id",this.PreviewBook.GetRD3Ident());f.SetAttribute("cap",this.PreviewBook.BookObj.GetName());this.PreviewBook.RD3RenderDifferences(f,d,true)}break;case RD3Glb.FRM_WINSTATE:if(this.iWindowState==0&&c){break}d.SetAttribute("wst",this.iWindowState.toString());break;case RD3Glb.FRM_BACKBUTTXT:if(this.iBackButTxt.length==0&&c){break}d.SetAttribute("bbt",this.iBackButTxt);break;case RD3Glb.FRM_CLOSEONSEL:if(c&&!this.CloseOnSelection){break}d.SetAttribute("cls",this.CloseOnSelection?"1":"0");break}};WebFormSrv.prototype.FormLeftPosition=function(){if(this.MainFrm.ParamsObj().UseRD3&&(this.iBorderType==RD3Glb.BORDER_THICK)){return this.FormLeft-this.GetModalBorderWidth()}return this.FormLeft};WebFormSrv.prototype.set_FormLeftPosition=function(c){if(!this.FreezePos){var a=new IDVariant(c);var b=new IDVariant(this.FormTopPosition());this.RD3Reposition(a,b,true)}else{this.FormLeft=c}this.RD3Change(RD3Glb.FRM_FORMLEFT)};WebFormSrv.prototype.FormTopPosition=function(){if(this.MainFrm.ParamsObj().UseRD3&&(this.iBorderType==RD3Glb.BORDER_THICK)){return this.FormTop-this.GetModalBorderWidth()}return this.FormTop};WebFormSrv.prototype.set_FormTopPosition=function(c){if(!this.FreezePos){var a=new IDVariant(this.FormLeftPosition());var b=new IDVariant(c);this.RD3Reposition(a,b,true)}else{this.FormTop=c}this.RD3Change(RD3Glb.FRM_FORMTOP)};WebFormSrv.prototype.FormWidthSize=function(){return(this.FormWidth==-1?this.DesignWidth:this.FormWidth)+(this.MainFrm.ParamsObj().UseRD3&&this.OpenAs!=Glb.OPEN_MDI?2*this.GetModalBorderWidth():0)};WebFormSrv.prototype.set_FormWidthSize=function(c){if(!this.FreezePos){var a=new IDVariant(c);var b=new IDVariant(this.FormHeightSize());this.RD3Resize(a,b,true)}else{this.FormWidth=c}this.RD3Change(RD3Glb.FRM_FORMWIDTH)};WebFormSrv.prototype.FormHeightSize=function(){return(this.FormHeight==-1?this.DesignHeight:this.FormHeight)+(this.MainFrm.ParamsObj().UseRD3&&this.OpenAs!=Glb.OPEN_MDI?2*this.GetModalBorderWidth():0)};WebFormSrv.prototype.set_FormHeightSize=function(a){if(!this.FreezePos){var b=new IDVariant(this.FormWidthSize());var c=new IDVariant(a);this.RD3Resize(b,c,true)}else{this.FormHeight=a}this.RD3Change(RD3Glb.FRM_FORMHEIGHT)};WebFormSrv.prototype.ToolPosition=function(){return this.ToolbarPosition};WebFormSrv.prototype.set_ToolPosition=function(a){this.ToolbarPosition=a;this.RD3Change(RD3Glb.FRM_TOOLBARPOS)};WebFormSrv.prototype.BorderType=function(){return this.iBorderType};WebFormSrv.prototype.set_BorderType=function(a){this.iBorderType=a;this.RD3Change(RD3Glb.FRM_BORDERTYPE)};WebFormSrv.prototype.VisualFlag=function(a){return this.iVisualFlags&a};WebFormSrv.prototype.set_VisualFlag=function(b,a){this.iVisualFlags=(this.iVisualFlags&(~a))|b;this.RD3Change(RD3Glb.FRM_VISPROP)};WebFormSrv.prototype.bVisualFlag=function(a){return(this.VisualFlag(a))!=0};WebFormSrv.prototype.set_bVisualFlag=function(a,b){this.set_VisualFlag((b?a:0),a)};WebFormSrv.prototype.Image=function(){return this.iImage};WebFormSrv.prototype.set_Image=function(a){this.iImage=a;this.RD3Change(RD3Glb.FRM_IMAGE)};WebFormSrv.prototype.WindowState=function(){return this.iWindowState};WebFormSrv.prototype.set_WindowState=function(a){this.RD3ChangeWindowState(new IDVariant(a))};WebFormSrv.prototype.BackButTxt=function(){return this.iBackButTxt};WebFormSrv.prototype.set_BackButTxt=function(a){this.iBackButTxt=a;this.RD3Change(RD3Glb.FRM_BACKBUTTXT)};WebFormSrv.prototype.GetSubForm=function(c){if(this.Frames==null){return}for(var a=0;a<this.Frames.length;a++){if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof ASubFormSrv){var b=this.Frames[a].Content;if(b.pSubForm!=null&&!c.Contains(b.pSubForm)){c.Add(b.pSubForm);b.pSubForm.GetSubForm(c)}}else{if(this.Frames[a]!=null&&this.Frames[a].Content!=null&&this.Frames[a].Content instanceof OBookSrv){this.Frames[a].Content.BookObj.Book.GetSubForm(c)}}}};WebFormSrv.prototype.RD3Resize=function(c,f,g){this.FreezePos=true;try{var j=c.intValue();var b=f.intValue();var d=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnResize","Form "+this.GetClass().GetClassName()+": Fire On Resize Event (w="+(c.intValue())+", h="+(f.intValue())+")")}this.OnResize(c,f,d);if(d.isFalse()){var e=c.intValue();var a=f.intValue();if(this.OpenAs!=Glb.OPEN_MDI&&this.MainFrm.ParamsObj().UseRD3&&g){e-=2*this.GetModalBorderWidth();a-=2*this.GetModalBorderWidth()}this.FormWidth=e;this.FormHeight=a;if(this.FormWidth!=j){this.RD3Change(RD3Glb.FRM_FORMWIDTH)}if(this.FormHeight!=b){this.RD3Change(RD3Glb.FRM_FORMHEIGHT)}}else{this.RD3Change(RD3Glb.FRM_FORMWIDTH);this.RD3Change(RD3Glb.FRM_FORMHEIGHT)}}finally{this.FreezePos=false}};WebFormSrv.prototype.RD3Reposition=function(b,c,e){this.FreezePos=true;try{var a=c.intValue();var h=b.intValue();var d=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnMove","Form "+this.GetClass().GetClassName()+": Fire On Move Event (t="+(c.intValue())+", l="+(b.intValue())+")")}this.OnMove(b,c,d);if(d.isFalse()){var g=b.intValue();var f=c.intValue();if(this.MainFrm.ParamsObj().UseRD3&&e&&this.iBorderType==RD3Glb.BORDER_THICK){g+=this.GetModalBorderWidth();f+=this.GetModalBorderWidth()}this.FormLeft=g;this.FormTop=f;if(this.FormLeft!=h){this.RD3Change(RD3Glb.FRM_FORMLEFT)}if(this.FormTop!=a){this.RD3Change(RD3Glb.FRM_FORMTOP)}}else{this.RD3Change(RD3Glb.FRM_FORMLEFT);this.RD3Change(RD3Glb.FRM_FORMTOP)}}finally{this.FreezePos=false}};WebFormSrv.prototype.RD3ChangeWindowState=function(a){var d=this.iWindowState;if(a.intValue()!=d){try{var b=new IDVariant();if(this.MainFrm!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,195,this.GetClass().GetClassName()+".FireOnChangeState","Form "+this.GetClass().GetClassName()+": Fire OnChangeState (v="+(a.intValue())+")")}this.OnChangeState(a,b);if(b.isFalse()){this.iWindowState=a.intValue();if(this.iWindowState!=d){this.RD3Change(RD3Glb.FRM_WINSTATE)}if(this.iWindowState==Glb.WS_MINIMIZE&&this.MainFrm.ActiveForm()==this){this.MainFrm.ActivateNextForm()}}else{this.RD3Change(RD3Glb.FRM_WINSTATE)}}catch(c){}}};WebFormSrv.prototype.GetModalBorderWidth=function(){if(this.iBorderType==RD3Glb.BORDER_THICK){return 8}if(this.iBorderType==RD3Glb.BORDER_THIN){return 2}if(this.iBorderType==RD3Glb.BORDER_NONE){return 0}return 0};WebFormSrv.prototype.ResetTooltip=function(){var a=this.MainFrm.RD3AddEvent("restip",this.GetRD3Ident());a.CanSendInFulltree=true};WebFormSrv.prototype.KeyHandle=function(){return this.ListenKeys};WebFormSrv.prototype.set_KeyHandle=function(a){this.ListenKeys=a};WebFormSrv.prototype.FireKeyPress=function(c,a,d,b){if((this.KeyHandle()&a)==0){return}this.OnFormKeyPress(new IDVariant(c),new IDVariant(a),new IDVariant(d),b)};WebFormSrv.prototype.RemovePanelTempMsg=function(c){for(var b=0;b<this.Messages.Count();b++){var g=this.Messages[b];if(!g.AutoDelete){continue}var h=false;if(g.Source==c){h=true}else{if(g.Source instanceof PFieldSrv&&g.Source.Parent==c){h=true}else{if(g.Source instanceof IDDocument){if(c.Queries[0]==null){continue}if(c.Queries[0].Document!=null){h=(g.Source==c.Queries[0].Document)}else{if(c.Queries[0].IDColl!=null){c.Queries[0].IDColl.MoveFirst();while(!c.Queries[0].IDColl.IsEof()){if(g.Source==c.Queries[0].IDColl.GetAt()){h=true;break}c.Queries[0].IDColl.MoveNext()}}}}else{if(typeof(g.Source)=="string"){var f=null;if(c.Queries[0].DocTempl!=null){f=c.Queries[0].DocTempl.GetMD()}else{if(c.Queries[0].Document!=null){f=c.Queries[0].Document.GetMD()}else{if(c.Queries[0].IDColl!=null&&c.Queries[0].IDColl.Count()>0){c.Queries[0].IDColl.MoveFirst();f=c.Queries[0].IDColl.GetAt().GetMD()}}}if(f==null){continue}for(var e=1;e<=f.GetNumProp();e++){var a=f.GetProp(e);if(a!=null){if(g.Source.equals(a.UIName)){h=true;break}}}}}}}if(h){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.RTCGuid,28,"Form.RenderMessages","Form "+this.Caption()+": remove temporary message "+g.Text);this.Messages.Remove(g);b--;this.RD3Changed=true}}if(c.Queries[0].IsDO){for(var d=0;d<this.Frames.length;d++){if(this.Frames[d]!=null&&this.Frames[d].Content!=null&&this.Frames[d].Content!=c&&this.Frames[d].Content instanceof IDPanelSrv){var e=this.Frames[d].Content;if(e.MasterPanelIdx!=0&&e.MasterPanelIdx==c.FrIndex){this.RemovePanelTempMsg(e)}}}}};WebFormSrv.IsMyInstance=function(a){return(a instanceof WebFormSrv)};WebFormSrv.GetClassName=function(a){return(a?"com.progamma.ids.":"")+"WebFormSrv"};WebFormSrv.prototype.GetClass=function(){return WebFormSrv};WebFormSrv.prototype.GetType=function(){return{Name:"WebFormSrv"}};function TBZone(){this.Prefix="";this.Suffix='&nbsp;<img align=absmiddle src="images/sep.gif" alt="">';this.CmdSep=""}WebFrameSrv.MAX_CUSTOMCOMMANDS=8;WebFrameSrv.FIRST_CUSTOMCOMMANDS=18;WebFrameSrv.CustomCommands=new Array(WebFrameSrv.MAX_CUSTOMCOMMANDS);WebFrameSrv.MAX_TBZONES=10;WebFrameSrv.CommandZones=new Array(40);WebFrameSrv.CZ_COLLAPSE=32;WebFrameSrv.CZ_LOCK=33;WebFrameSrv.CZ_STATUSBAR=34;WebFrameSrv.CZ_CMDSET=35;WebFrameSrv.CZ_QBETIP=36;WebFrameSrv.TBZones=new Array(WebFrameSrv.MAX_TBZONES+1);function WebFrameSrv(a){this.iGuid="";this.Visible=true;this.Collapsed=false;this.Collapsable=true;this.iExposed=true;this.Enabled=true;this.iLocked=(a?a.MainFrm.ParamsObj().PanelIsLockable:false);this.Lockable=(a?a.MainFrm.ParamsObj().PanelIsLockable:false);this.ShowInfoMessages=(a?a.MainFrm.ParamsObj().InfoMessages:false);this.iImage="";this.Parent=a;this.Code="";this.MainFrm=(a?a.MainFrm:null);this.Width;this.Height;this.FrIndex=-1;this.iCanDrag=false;this.iCanDrop=false;this.ShowScrollbar=Glb.FORMSCROLL_BOTH;this.TagMap=null;this.RD3FrameChanged=false;this.RD3FramePropChg=new BitArray(RD3Glb.WFR_MAXPROPS);this.CollapseClickEventDef=RD3Glb.EVENT_ACTIVE;this.MouseClickEventDef=RD3Glb.EVENT_CLIENTSIDE;this.MouseDoubleClickEventDef=RD3Glb.EVENT_CLIENTSIDE;this.CollapseAnimationDef=null;this.ListenKeys=0}WebFrameSrv.prototype.CanBeUnlocked=function(){for(var a=1;a<this.Parent.Frames.length;a++){if(this.Parent.Frames[a]!=null&&this.Parent.Frames[a].Content!=null&&this.Parent.Frames[a].Content instanceof IDPanelSrv&&this.Parent.Frames[a].Content!=this&&this.Parent.Frames[a].Content.Lockable){if(this.Parent.Frames[a].Content.Status()==Glb.PS_UPDATE){return false}}}return true};WebFrameSrv.prototype.Locked=function(){return this.iLocked};WebFrameSrv.prototype.set_Locked=function(a){if(a==false){if(!this.CanBeUnlocked()){return}for(var b=1;b<this.Parent.Frames.length;b++){if(this.Parent.Frames[b]!=null&&this.Parent.Frames[b].Content!=null&&this.Parent.Frames[b].Content!=this&&this.Parent.Frames[b].Content.Lockable){this.Parent.Frames[b].Content.set_Locked(true)}}}this.iLocked=a;this.RD3FrameChange(RD3Glb.WFR_LOCKED)};WebFrameSrv.prototype.Exposed=function(){return this.iExposed};WebFrameSrv.prototype.set_Exposed=function(a){this.iExposed=a;if(!a&&this.Parent!=null){this.Parent.SetMessage(this,0,"","","INFO",0,false)}};WebFrameSrv.prototype.set_Visible=function(a){if(this.Visible!=a){this.Visible=a;this.RD3FrameChange(RD3Glb.WFR_VISIBLE);if(this.Parent!=null&&this.FrIndex>-1&&this.Parent.Frames[this.FrIndex].InTabbed&&this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx]!=null){this.Parent.Frames[this.Parent.Frames[this.FrIndex].TabIdx].Content.ChangeItemVisibility(this.FrIndex,this.MainFrm)}}};WebFrameSrv.prototype.set_Collapsed=function(d){if(this.Collapsed!=d){var b=new IDVariant();var a="";if(this.FrIndex>0&&this.Parent!=null){a=this.Parent.Frames[this.FrIndex].Caption}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"WebFrame.SetCollapsed","Frame "+a+": Firing OnChangeCollapse event");if(this.Parent!=null){this.Parent.OnChangeCollapse(this,new IDVariant(d),b)}if(b.isFalse()){if(this.Parent.PreviewBook==this){this.Parent.PreviewBook.RD3ResetPageCache(true);this.Parent.PreviewBook=null;this.Parent.RD3Change(RD3Glb.FRM_PREVIEW)}else{this.RD3FrameChange(RD3Glb.WFR_COLLAPSED);this.Collapsed=d}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",30,"WebFrame.SetCollapsed","Frame "+a+(d?" collapsed":" expanded"));this.MainFrm.DTTObj.SetRequestName((d?"Collapse":"Expand")+" Frame","Frame "+a+(d?" collapsed":" expanded"),DTTRequest.PRI_CMD);this.MainFrm.DTTObj.AddTestItem(this.iGuid,DTTEngine.TST_FRMMENU,"Frame "+a+(d?" collapsed":" expanded"),"","exp");this.MainFrm.DTTObj.AddHelpItem(0,0,0,0,"Apri il riquadro "+a)}}};WebFrameSrv.prototype.set_Collapsable=function(a){if(this.Collapsable!=a){this.Collapsable=a;this.RD3FrameChange(RD3Glb.WFR_COLLAPSABLE)}};WebFrameSrv.prototype.CanDrag=function(){return this.iCanDrag};WebFrameSrv.prototype.set_CanDrag=function(a){this.iCanDrag=a;this.RD3FrameChange(RD3Glb.WFR_DRAG)};WebFrameSrv.prototype.CanDrop=function(){return this.iCanDrop};WebFrameSrv.prototype.set_CanDrop=function(a){this.iCanDrop=a;this.RD3FrameChange(RD3Glb.WFR_DROP)};WebFrameSrv.prototype.Image=function(){return this.iImage};WebFrameSrv.prototype.set_Image=function(a){this.iImage=a;this.RD3FrameChange(RD3Glb.WFR_IMAGE)};WebFrameSrv.prototype.ProcessRequest=function(a,c,d,b){};WebFrameSrv.prototype.DownloadBlob=function(a,b){return false};WebFrameSrv.prototype.GetCaption=function(b,a){return Glb.HTMLEncode(b,false,true)};WebFrameSrv.prototype.HasCaptionCommands=function(){return false};WebFrameSrv.prototype.SearchObject=function(a){return null};WebFrameSrv.prototype.GetContentSize=function(){return null};WebFrameSrv.prototype.Resize=function(b,a){this.Width=b-4;this.Height=a};WebFrameSrv.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFrameSrv.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};WebFrameSrv.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};WebFrameSrv.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};WebFrameSrv.InitCustomCommand=function(f,a,c,d,e){var b=WebFrameSrv.log2(f);b-=WebFrameSrv.FIRST_CUSTOMCOMMANDS;if(b>=0&&b<WebFrameSrv.MAX_CUSTOMCOMMANDS){if(WebFrameSrv.CustomCommands[b]==null){WebFrameSrv.CustomCommands[b]=new ACommandSrv();WebFrameSrv.CustomCommands[b].Caption=a;WebFrameSrv.CustomCommands[b].ToolTip=d;WebFrameSrv.CustomCommands[b].Image=c;WebFrameSrv.CustomCommands[b].FKNum=e}}};WebFrameSrv.InitTBZones=function(){if(WebFrameSrv.TBZones[0]!=null){return}for(var a=0;a<=WebFrameSrv.MAX_TBZONES;a++){WebFrameSrv.TBZones[a]=new TBZone()}WebFrameSrv.TBZones[0].Prefix="";WebFrameSrv.TBZones[0].Suffix="";WebFrameSrv.CommandZones[WebFrameSrv.CZ_COLLAPSE]=1;WebFrameSrv.CommandZones[WebFrameSrv.CZ_LOCK]=1;WebFrameSrv.CommandZones[WebFrameSrv.CZ_STATUSBAR]=2;WebFrameSrv.CommandZones[WebFrameSrv.CZ_QBETIP]=2;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_NAVIGATION)]=3;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_FORMLIST)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_SEARCH)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_FIND)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CANCEL)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_REQUERY)]=4;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_DELETE)]=5;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_INSERT)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_UPDATE)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_DUPLICATE)]=6;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_PRINT)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CSV)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_ATTACH)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_GROUP)]=7;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM1)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM2)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM3)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM4)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM5)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM6)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM7)]=8;WebFrameSrv.CommandZones[WebFrameSrv.log2(Glb.PCM_CUSTOM8)]=8;WebFrameSrv.CommandZones[WebFrameSrv.CZ_CMDSET]=9};WebFrameSrv.InitTBZone=function(d,b,c,a){if(d>=0&&d<=WebFrameSrv.MAX_TBZONES){WebFrameSrv.TBZones[d].Prefix=b;WebFrameSrv.TBZones[d].Suffix=c;WebFrameSrv.TBZones[d].CmdSep=a}};WebFrameSrv.InitCommandZone=function(b,a,c){if(c<0||c>WebFrameSrv.MAX_TBZONES){return}if(a!=0){WebFrameSrv.CommandZones[a]=c}else{WebFrameSrv.CommandZones[WebFrameSrv.log2(b)]=c}};WebFrameSrv.prototype.GetCommandZones=function(a){return WebFrameSrv.CommandZones[WebFrameSrv.log2(a)]};WebFrameSrv.log2=function(b){var a=0;while(b!=0){a++;b>>=1}a--;return a};WebFrameSrv.prototype.GetRD3Ident=function(){return this.GetRD3Name()+":"+this.FrIndex+":"+this.Parent.FormIdx};WebFrameSrv.prototype.GetRD3Name=function(){return"wfr"};WebFrameSrv.prototype.RD3FrameChange=function(a,b){if(b==undefined){b=true}this.RD3FramePropChg[a]=b;this.RD3FrameChanged=true};WebFrameSrv.prototype.RD3RenderDifferences=function(e,c,d){var a=null;if(e==null&&this.RD3FrameChanged){e=c.AddNewElement("chg");e.SetAttribute("id",this.GetRD3Ident());a=e}if(d||this.RD3FrameChanged){for(var b=0;b<this.RD3FramePropChg.length;b++){if(this.RD3FramePropChg[b]||d){WebFrameSrv.prototype.SetRD3Property.call(this,b,e,d)}}this.RD3FrameChanged=false;this.RD3FramePropChg.SetAll(false)}if(d){if(this.CollapseClickEventDef!=RD3Glb.EVENT_ACTIVE){e.SetAttribute("clc",this.CollapseClickEventDef.toString())}if(this.MouseClickEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("mck",this.MouseClickEventDef.toString())}if(this.MouseDoubleClickEventDef!=RD3Glb.EVENT_CLIENTSIDE){e.SetAttribute("mdk",this.MouseDoubleClickEventDef.toString())}if(this.CollapseAnimationDef!=null){e.SetAttribute("cla",this.CollapseAnimationDef)}if(this.ListenKeys!=0){e.SetAttribute("hks",this.ListenKeys.toString())}}return a};WebFrameSrv.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.WFR_VISIBLE:if(this.Visible&&c){break}d.SetAttribute("vis",this.Visible?"1":"0");break;case RD3Glb.WFR_COLLAPSED:if(!this.Collapsed&&c){break}d.SetAttribute("col",this.Collapsed?"1":"0");break;case RD3Glb.WFR_COLLAPSABLE:if(this.Collapsable&&c){break}d.SetAttribute("clp",this.Collapsable?"1":"0");break;case RD3Glb.WFR_LOCKED:if(!this.iLocked&&c){break}d.SetAttribute("lok",this.iLocked?"1":"0");break;case RD3Glb.WFR_LOCKABLE:var b=this.Lockable&this instanceof IDPanelSrv;if(!b&&c){break}d.SetAttribute("lkb",b?"1":"0");break;case RD3Glb.WFR_IMAGE:if(this.iImage.length==0&&c){break}d.SetAttribute("img",this.iImage);break;case RD3Glb.WFR_SHOWSCROLLBAR:if(this.ShowScrollbar==Glb.FORMSCROLL_BOTH&&c){break}d.SetAttribute("scr",this.ShowScrollbar.toString());break;case RD3Glb.WFR_DRAG:if(!this.iCanDrag&&c){break}d.SetAttribute("dra",this.iCanDrag?"1":"0");break;case RD3Glb.WFR_DROP:if(!this.iCanDrop&&c){break}d.SetAttribute("dro",this.iCanDrop?"1":"0");break}};WebFrameSrv.prototype.RD3StartRequest=function(){};WebFrameSrv.prototype.RD3EndRequest=function(){};WebFrameSrv.RenderCustomCommands=function(b){for(var a=0;a<40;a++){if(WebFrameSrv.CommandZones[a]>0){b.SetAttribute("cz"+a,WebFrameSrv.CommandZones[a].toString())}}var c;for(var a=0;a<WebFrameSrv.MAX_CUSTOMCOMMANDS;a++){if(WebFrameSrv.CustomCommands[a]!=null){c=b.AddNewElement("ccm");c.SetAttribute("idx",a.toString());c.SetAttribute("cap",WebFrameSrv.CustomCommands[a].Caption);c.SetAttribute("tip",WebFrameSrv.CustomCommands[a].ToolTip);c.SetAttribute("img",WebFrameSrv.CustomCommands[a].Image);c.SetAttribute("fkn",WebFrameSrv.CustomCommands[a].FKNum.toString())}}};WebFrameSrv.prototype.iLockable=function(){return this.Lockable};WebFrameSrv.prototype.set_iLockable=function(a){this.Lockable=a;this.RD3FrameChange(RD3Glb.WFR_LOCKABLE)};WebFrameSrv.prototype.Scrollbar=function(){return this.ShowScrollbar};WebFrameSrv.prototype.set_Scrollbar=function(a){this.ShowScrollbar=a;this.RD3FrameChange(RD3Glb.WFR_SHOWSCROLLBAR)};WebFrameSrv.prototype.set_Width=function(a){if(this.Width!=a){this.Parent.Frames[this.FrIndex].Width=a;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_WIDTH);this.Width=a}};WebFrameSrv.prototype.set_Height=function(a){if(this.Height!=a){this.Parent.Frames[this.FrIndex].Height=a;this.Parent.Frames[this.FrIndex].RD3Change(RD3Glb.AFR_HEIGHT);this.Height=a}};WebFrameSrv.prototype.RD3Resize=function(a,c,b){if(b==""){this.Width=a;this.Height=c;this.Parent.Frames[this.FrIndex].Width=a;this.Parent.Frames[this.FrIndex].Height=c}};WebFrameSrv.prototype.RD3RawClick=function(c,b,g,f,a,e,d){return false};WebFrameSrv.prototype.GenericDrag=function(b,a){};WebFrameSrv.prototype.GenericDrop=function(b,a){};WebFrameSrv.prototype.OnSearchBox=function(a){};WebFrameSrv.prototype.KeyHandle=function(){return this.ListenKeys};WebFrameSrv.prototype.set_KeyHandle=function(a){this.ListenKeys=a};WebFrameSrv.prototype.FireKeyPress=function(a,c,b){if((this.KeyHandle()&a)==0){return}this.Parent.OnFrameKeyPress(this,new IDVariant(a),new IDVariant(c),b)};function DOError(){this.ErrType=0;this.Text="";this.Ack=false;this.Shown=false;this.PropIdx=0}function DOMDColl(){this.Index;this.ChildrenName;this.PKColl=new ArrayList();this.FKColl=new ArrayList();this.Transient=false;this.Visible=false;this.IOTData="";this.IOTCode="";this.IOTMultiplicityNM=false}function DOMDLinkedDoc(a,b){this.DocumentClass=a;this.Name="";this.SrcProp=new Array(b);this.DstProp=new Array(b)}DOMDLinkedDoc.prototype.SetLinkedProp=function(a,b,c){this.SrcProp[a]=b;this.DstProp[a]=c};DOMDLinkedDoc.prototype.SetName=function(a){this.Name=a};DOMDLinkedDoc.prototype.GetDocumentClass=function(){return this.DocumentClass};DOMDLinkedDoc.prototype.GetName=function(){return this.Name};DOMDLinkedDoc.prototype.GetNumProp=function(){return this.SrcProp.length};DOMDLinkedDoc.prototype.GetSrcProp=function(a){return this.SrcProp[a]};DOMDLinkedDoc.prototype.GetDstProp=function(a){return this.DstProp[a]};function DOMDObj(){this.ObjTag;this.ObjGUID;this.ObjIcon;this.DBCode;this.SequenceCode;this.RemoteType;this.UIName;this.FormName;this.Concept;this.Services=0;this.BaseProps=0;this.BaseColls=0;this.BaseMD=null;this.DocIDIdx=0;this.NotifyOnChange=false;this.FastResync=false;this.TableSubst=false;this.TagMap=null;this.FieldMap=null;this.DBObj;this.DBType=0;this.DBSchema;this.PropList;this.CollList;this.QueryList=new ArrayList();this.WebApiMethods="";this.ServiceEndpoint=null;this.IOTCode="";this.IOTMethods="";this.ODataEntitySet="";this.ODataNamespace="";this.ODataWithEtag=false}DOMDObj.prototype.SetNumProp=function(a){this.PropList=new Array(a)};DOMDObj.prototype.GetNumProp=function(){return this.PropList.length+this.BaseProps};DOMDObj.prototype.SetProp=function(b,a){this.PropList[b-1]=a};DOMDObj.prototype.GetProp=function(a){if(this.BaseMD!=null&&a-this.BaseProps<1){return this.BaseMD.GetProp(a)}a-=this.BaseProps;if(a<1||a>this.PropList.length){return null}return this.PropList[a-1]};DOMDObj.prototype.GetPropIndex=function(b){for(var a=0;a<this.PropList.length;a++){if(this.PropList[a].ObjTag!=null&&this.PropList[a].ObjTag.equals(b)){return a+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetPropIndex(b)}return -1};DOMDObj.prototype.GetDBCodeIndex=function(a){for(var b=0;b<this.PropList.length;b++){if(this.PropList[b].DBCode!=null&&this.PropList[b].DBCode.equals(a)){return b+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetDBCodeIndex(a)}return -1};DOMDObj.prototype.GetIOTCodeIndex=function(b){for(var a=0;a<this.PropList.length;a++){if(this.PropList[a].IOTCode!=null&&this.PropList[a].IOTCode.equals(b)){return a+1+this.BaseProps}}if(this.BaseMD!=null){return this.BaseMD.GetIOTCodeIndex(b)}return -1};DOMDObj.prototype.SetNumColl=function(a){this.CollList=new Array(a)};DOMDObj.prototype.GetNumColl=function(){return this.CollList.length+this.BaseColls};DOMDObj.prototype.SetColl=function(b,a){this.CollList[b-1]=a};DOMDObj.prototype.GetColl=function(a){if(this.BaseMD!=null&&a-this.BaseColls<1){return this.BaseMD.GetColl(a)}a-=this.BaseColls;if(a<1||a>this.CollList.length){return null}return this.CollList[a-1]};DOMDObj.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};DOMDObj.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};DOMDObj.prototype.GetDBType=function(){if(this.DBType>0){return this.DBType}if(this.BaseMD!=null){return this.BaseMD.GetDBType()}return 0};DOMDObj.prototype.AddQuery=function(a,e,b,c,f){var d=new DOMDQuery();d.ID=a;d.Tag=e;d.Query=b;d.MsgText=c;d.QryType=f;d.Init();this.QueryList.Add(d)};DOMDObj.prototype.GetNumQueries=function(){return this.QueryList.Count()};DOMDObj.prototype.GetQuery=function(a){if(a>=1&&a<=this.QueryList.Count()){return this.QueryList[a-1]}else{return null}};DOMDObj.prototype.AddFieldConversion=function(a,b){if(this.FieldMap==null){this.FieldMap=new HashTableSrv()}this.FieldMap[a]=b};DOMDObj.prototype.GetFieldConversion=function(a){if(this.FieldMap==null){return null}return this.FieldMap[a]};function DOMDProp(){this.Index=0;this.ObjTag;this.DBCode="";this.RemoteIndex=0;this.PK=false;this.FK=false;this.LinkedDoc=null;this.Nullable=true;this.Counter=false;this.DescribeRow=false;this.Transient=false;this.Visible=false;this.ReadOnly=false;this.DataType=0;this.MaxLength=0;this.vScale=0;this.Name;this.UIName;this.GUID;this.Concept;this.ExtPropIdx=0;this.Mask;this.IDList;this.Lookup;this.DTString;this.Domain;this.Group;this.Transformation=0;this.TrFormat=null;this.TrOffset=0;this.RecordIdxProp=0;this.TagMap=null;this.IOTData="";this.IOTCode="";this.ODataType=""}DOMDProp.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};DOMDProp.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}return new IDVariant()};function DOMDQuery(){this.ID;this.Tag;this.Query;this.MsgText;this.QryType;this.NeedRecord;this.DocDipName}DOMDQuery.prototype.Init=function(){switch(this.QryType){case 1:this.NeedRecord=false;break;case 2:this.NeedRecord=false;break;case 3:this.NeedRecord=true;break;case 4:this.NeedRecord=false;break}var a=this.MsgText.indexOf("§");if(a>0){this.DocDipName=this.MsgText.substr(0,a);this.MsgText=this.MsgText.substr(a+1)}else{this.DocDipName=""}};DOMDQuery.prototype.CanByApplied=function(a,b){switch(this.QryType){case 1:return b==1;case 2:return b==2||b==1;case 3:return b==2||b==1;case 4:return b==3}return false};DOMDQuery.prototype.GetSQL=function(d,b){var e=this.Query;var g=d.GetMD();while(true){var h=e.indexOf("~~");var f=e.indexOf("~~",h+1);if(h==-1||f==-1){break}var a=d.GetPropertyIndex(e.substr(h+2,f-h-2));if(a==0){break}var c=d.GetPropByIndex(a);if(c.Type==IDVariant.NULL){e="";break}e=e.substr(0,h)+Glb.ToSql(c,g.GetDBType(),b)+e.substr(f+2)}return e};DOMDQuery.prototype.ApplyTo=function(e,d,x){var k=this.MsgText;var j=-1;var w=e.GetMD();var t=null;try{var r=e.GetMainFrm();if(r instanceof WebEntryPointSrv){t=r.RTCObj}}catch(h){}var y="";switch(this.QryType){case 1:case 2:this.MsgFmt="Impossibile salvare il documento perchè ne esiste già un altro con gli stessi dati identificativi (|1)";break;case 3:this.MsgFmt="Impossibile salvare il documento perchè esso si riferisce ad un altro documento |2 non presente nel database (|1)";break;case 4:this.MsgFmt="Impossibile cancellare il documento perchè ci sono altri documenti |2 che si riferiscono ad esso";break}if(t!=null){switch(this.QryType){case 1:case 2:this.MsgFmt=t.GetConst("9B598652-135D-4680-9968-BD32EA55636B",this.MsgFmt);break;case 3:this.MsgFmt=t.GetConst("D06AED6A-84E2-4474-B0DC-AEF9B4A7F572",this.MsgFmt);break;case 4:this.MsgFmt=t.GetConst("0B41D50A-1EAD-484B-B1B7-97F4FE484017",this.MsgFmt);break}}while(true){var c=k.indexOf("~~");var b=k.indexOf("~~",c+1);if(c==-1||b==-1){break}var u=k.substr(c+2,b-c-2);var m=false;if(u.substr(0,1)=="!"){m=true;u=u.slice(1)}var l=e.GetPropertyIndex(u);if(l==0){break}if(!m&&this.QryType!=4){if(j==-1){j=l}else{j=-2}}var g;if(m){var a=w.GetProp(l);g=a.UIName}else{g=e.GetPropByIndex(l).ToString()}k=k.substr(0,c)+g+k.substr(b+2)}var f=IDL.FormatMessage(new IDVariant(this.MsgFmt),new IDVariant(k),new IDVariant(this.DocDipName)).ToString();if(j>0){e.SetPropError(j,f)}else{e.AddDocError(f)}var p=new DOMDQuery();p.Query=this.SQL;p.Tag=this.Tag;p.ID=this.ID;p.NeedRecord=this.NeedRecord;p.MsgText=f;p.QryType=this.QryType;p.DocDipName=this.DocDipName;e.LastFailedCheck=p};function IDCollection(){this.iColl=new ArrayList();this.UILookup=null;this.UIPos=0;this.iPos=0;this.iCur=0;this.ShowDel=false;this.ShowHid=true;this.iCount=0;this.iUIMode=false;this.UILastUpd=-1;this.SortCriteria=new Array(16);for(var a=0;a<16;a++){this.SortCriteria[a]=0}this.iParent=null;this.iMainFrm=null;this.iIMDB=null;this.iUIBound=false;this.iUpdCount=0;this.iLoaded=false;this.iVisible=false;this.bUpdateSort=false;this.bSemMod=false;this.Index=0;this.MaxRows=0;this.HasMoreElements=false;this.LiveSort=false;this.DocumentProvider=null;this.ODataLoadInfo=null}IDCollection.prototype.SetSize=function(b,a){if(b!=-1){while(this.Size()<b){this.iColl.Add(null);if(this.UILookup!=null){this.UILookup.Add(null);this.iCount++}}}if(a!=null){this.DocumentProvider=a}};IDCollection.prototype.GetMissingDoc=function(a){if(this.DocumentProvider!=null){this.DocumentProvider.OnMissingDocument(new IDVariant(a),this);if(this.iColl[a-1]==null&&this.DocumentProvider.GetServiceConnector()!=null){this.DocumentProvider.GetServiceConnector().GetMissingDoc(this.DocumentProvider,this,a-1)}}};IDCollection.prototype.GetDirect=function(a){if(this.UIMode()){if(a>=1&&a<=this.UILookup.Count()){return this.UILookup[a-1]}}else{if(a>=1&&a<=this.iColl.Count()){return this.iColl[a-1]}}return null};IDCollection.prototype.SetDirect=function(d,c){if(this.UIMode()){if(d>=1&&d<=this.UILookup.Count()){this.UILookup[d-1]=c;var a=d;if(this.UILookup.Count()!=this.iColl.Count()){a=d;for(var b=0;b<this.iColl.Count();b++){if(this.DocVisible(this.iColl[b])){a--;if(a==0){a=b;break}}}}this.iColl[a-1]=c;this.iUpdCount++;this.UILastUpd++}}else{if(d>=1&&d<=this.iColl.Count()){this.iColl[d-1]=c}this.iUpdCount++}if(c.ParentCollection()==null){c.set_ParentCollection(this)}};IDCollection.prototype.UpdateCount=function(){return this.iUpdCount};IDCollection.prototype.UIBound=function(){return this.iUIBound};IDCollection.prototype.set_UIBound=function(a){if(a!=this.iUIBound){this.iUIBound=a;for(var c=0;c<this.iColl.Count();c++){var e=this.iColl[c];if(e!=null){e.set_UIBound(a)}}this.UILookup=new ArrayList(this.iColl.Count())}};IDCollection.prototype.set_UIMode=function(d){this.iUIMode=d;if(d&&this.UILastUpd!=this.iUpdCount){this.UILastUpd=this.iUpdCount;var c=this.ShowDel;this.ShowDel=false;var a=this.ShowHid;this.ShowHid=false;this.UILookup.Clear();for(var e=0;e<this.iColl.Count();e++){if(this.DocVisible(this.iColl[e])){this.UILookup.Add(this.iColl[e])}}this.ShowDel=c;this.ShowHid=a}};IDCollection.prototype.UIMode=function(){return this.iUIMode};IDCollection.prototype.Loaded=function(){return this.iLoaded};IDCollection.prototype.set_Loaded=function(a){this.iLoaded=a};IDCollection.prototype.Visible=function(){return this.iVisible};IDCollection.prototype.set_Visible=function(a){if(this.iVisible!=a){this.iVisible=a;this.UISetModified()}};IDCollection.prototype.Parent=function(){return this.iParent};IDCollection.prototype.set_Parent=function(a){this.iParent=a};IDCollection.prototype.MainFrm=function(){return this.iMainFrm};IDCollection.prototype.set_MainFrm=function(a){this.iMainFrm=a};IDCollection.prototype.IMDB=function(){return this.iIMDB};IDCollection.prototype.set_imdb=function(a){this.iIMDB=a};IDCollection.prototype.GetCollection=function(){if(this.DocumentProvider!=null){var b=new ArrayList(this.iColl.Count());for(var a=0;a<this.iColl.Count();a++){if(this.iColl[a]!=null){b.Add(this.iColl[a])}}return b}else{var b=new ArrayList(this.iColl);return b}};IDCollection.prototype.GetLoopCollection=function(){var d=new ArrayList();var c=this.iPos;var b=this.iCur;var a=this.UIPos;this.MoveFirst();while(!this.IsEof()){d.Add(this.GetAt());this.MoveNext()}this.iPos=c;this.iCur=b;this.UIPos=a;return d};IDCollection.prototype.Add=function(a,d,c,b){if(d==undefined){d=null}if(c==undefined){c=true}if(b==undefined){b=true}if(b&&a.ParentCollection()==this){b=false;if(a.ParentCollection().Find(a)){var f=false;if(a.Parent()!=null){f=a.Parent().FreezeEvents();a.Parent().set_FreezeEvents(true)}a.ParentCollection().RemoveAt();if(a.Parent()!=null){a.Parent().set_FreezeEvents(f)}}}if(b&&this.Parent()!=null&&!this.Parent().FreezeEvents()){var e=new IDVariant();if(!this.Parent().GetLock(9999,"",e)){throw new Error("ERR "+MDOInit.DOERR_NOLOCK+" [ "+this.Parent().toString()+"] "+e.toString())}}if(d!=null){var g=this.iColl.IndexOf(d);if(g==-1){this.iColl.Add(a)}else{if(c){this.iColl.Insert(g+1,a)}else{this.iColl.Insert(g,a)}}if(this.UIMode()&&this.DocVisible(a)){g=this.UILookup.IndexOf(d);if(g==-1){this.UILookup.Add(a)}else{if(c){this.UILookup.Insert(g+1,a)}else{this.UILookup.Insert(g,a)}}}}else{if(c){this.iColl.Add(a)}else{this.iColl.Insert(0,a)}if(this.UIMode()&&this.DocVisible(a)){if(c){this.UILookup.Add(a)}else{this.UILookup.Insert(0,a)}}}if(this.iMainFrm!=null){a.SetMainFrm(this.iMainFrm,this.iIMDB)}if(this.UIBound()){a.set_UIBound(true)}if(this.DocVisible(a)){this.iCount++;this.bUpdateSort=true;this.UISetModified()}if(b){if(a.ParentCollection()!=null){if(a.ParentCollection().Find(a)){a.ParentCollection().RemoveAt()}}a.set_ParentCollection(this);if(this.iParent!=null){a.set_Parent(this.iParent);if(!this.iParent.FreezeEvents()){this.iParent.OnAddChild(this,a)}a.ChangingParent()}if(a.OldParent()==null){a.set_OldParentCollection(null)}a.MarkAsChanged()}};IDCollection.prototype.AddAll=function(e,c){if(c==undefined){c=false}var a=e.GetLoopCollection();for(var b=0;b<a.Count();b++){var d=a[b];this.Add(d,null,true,c)}};IDCollection.prototype.RemoveLast=function(){if(this.iColl.Count()>0){var a=this.iColl[this.iColl.Count()-1];if(a==null||!a.Deleted()){this.iCount--}this.iColl.RemoveAt(this.iColl.Count()-1)}};IDCollection.prototype.RemoveAt=function(){if(this.iCur>0&&this.iCur<=this.iColl.Count()){var a=this.iColl[this.iCur-1];if(this.DocVisible(a)){this.iCount--;this.UISetModified()}this.iColl.RemoveAt(this.iCur-1);if(this.iCur<=this.iColl.Count()){a=this.iColl[this.iCur-1];if(!this.DocVisible(a)){this.SkipFiltered(1)}}if(a.Parent()!=null&&!a.Parent().FreezeEvents()){a.Parent().OnRemoveChild(a.ParentCollection(),a);a.Parent().MarkAsChanged()}}};IDCollection.prototype.Clear=function(){this.iColl.Clear();this.iCount=0;this.iPos=0;this.UIPos=0;this.iLoaded=false;this.UISetModified()};IDCollection.prototype.Count=function(){if(this.iUIMode){return this.UILookup.Count()}else{return this.iCount}};IDCollection.prototype.Size=function(){return this.iColl.Count()};IDCollection.prototype.MoveFirst=function(){if(this.iUIMode){this.UIPos=1}else{this.iPos=1;this.iCur=1;this.UIPos=1;this.SkipFiltered(1)}};IDCollection.prototype.MoveNext=function(){if(this.iUIMode){this.UIPos++}else{this.iPos++;this.iCur++;this.SkipFiltered(1)}};IDCollection.prototype.MovePrev=function(){if(this.iUIMode){this.UIPos--}else{this.iPos--;this.iCur--;this.SkipFiltered(-1)}};IDCollection.prototype.MoveLast=function(){if(this.iUIMode){this.UIPos=this.UILookup.Count()}else{this.iPos=this.iCount;this.iCur=this.iColl.Count();this.SkipFiltered(-1)}};IDCollection.prototype.IsEof=function(){if(this.iUIMode){return this.UIPos>this.UILookup.Count()}else{return(this.iPos>this.iCount||this.iCur>this.iColl.Count())}};IDCollection.prototype.AbsolutePosition=function(){if(this.iUIMode){return this.UIPos}else{return this.iPos}};IDCollection.prototype.set_AbsolutePosition=function(a){if(this.iUIMode){this.UIPos=a}else{this.MoveFirst();while(this.iPos<a&&!this.IsEof()){this.MoveNext()}}};IDCollection.prototype.GetAt=function(){if(this.iUIMode){if(this.UIPos<1||this.UIPos>this.UILookup.Count()){return null}else{var a=this.UILookup[this.UIPos-1];if(a==null){this.GetMissingDoc(this.UIPos)}a=this.UILookup[this.UIPos-1];return a}}else{if(this.iCur<1||this.iCur>this.iColl.Count()){return null}else{var a=this.iColl[this.iCur-1];if(a==null||a==undefined){this.GetMissingDoc(this.iCur)}a=this.iColl[this.iCur-1];if(!this.DocVisible(a)){return null}else{return a}}}};IDCollection.prototype.SetAt=function(a){if(this.iCur>=1&&this.iCur<=this.iColl.Count()){this.iColl[this.iCur-1]=a;this.bUpdateSort=true;this.UISetModified()}};IDCollection.prototype.DeleteAt=function(){var c=this.GetAt();if(c!=null){if(!c.Deleted()){var a=this.DocVisible(c);c.set_Deleted(true);if(a&&!this.DocVisible(c)){this.UISetModified();this.SkipFiltered(1)}}}};IDCollection.prototype.ShowHidden=function(){return this.ShowHid};IDCollection.prototype.ShowDeleted=function(){return this.ShowDel};IDCollection.prototype.set_ShowDeleted=function(a){if(this.ShowDel!=a){this.ShowDel=a;if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.set_ShowHidden=function(a){if(this.ShowHid!=a){this.ShowHid=a;if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.SkipFiltered=function(b){if(this.ShowDel&&this.ShowHid){return}for(;b>0?this.iCur<=this.iColl.Count():this.iCur>=1;this.iCur+=b){var a=this.GetAt();if(this.DocVisible(a)){break}}};IDCollection.prototype.PurgeDeleted=function(){var f=new ArrayList(this.iColl.Count());var a=false;for(var b=0;b<this.iColl.Count();b++){var e=this.iColl[b];if(e==null||!e.Deleted()){f.Add(e)}else{if(e.Parent()!=null&&!e.Parent().FreezeEvents()){e.Parent().OnRemoveChild(e.ParentCollection(),e)}a=true}}this.iColl=f;this.iCount=this.iColl.Count();if(a){this.UISetModified()}};IDCollection.prototype.ClearSort=function(){for(var a=0;a<this.SortCriteria.length;a++){this.SortCriteria[a]=0}};IDCollection.prototype.SortBy=function(a){for(var b=0;b<this.SortCriteria.length;b++){if(this.SortCriteria[b]==0){this.SortCriteria[b]=a;break}}};IDCollection.prototype.GetSortCriteria=function(a){if(a>0&&a<=this.SortCriteria.length){return this.SortCriteria[a-1]}else{return 0}};IDCollection.prototype.EnableSort=function(){if(this.SortCriteria[0]!=0){var b=this;var c=this.iColl.Count();var d=new Array(c);for(var a=0;a<c;a++){d[a]=this.iColl[a]}d.sort(function(h,g){var k;var j;var e=0;if(h==null&&g==null){return 0}if(h==null){return 1}if(g==null){return -1}for(var f=0;f<b.SortCriteria.length;f++){if(b.SortCriteria[f]==0){break}k=h.GetPropByIndex(Math.abs(b.SortCriteria[f]));j=g.GetPropByIndex(Math.abs(b.SortCriteria[f]));e=k.CompareToIgnoreCase(j);if(b.SortCriteria[f]<0){e=-e}if(e!=0){break}}return e});for(var a=0;a<c;a++){this.iColl[a]=d[a]}this.bUpdateSort=false;this.UISetModified()}};IDCollection.prototype.IsModified=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null&&b.IsModified()){return true}}return false};IDCollection.prototype.SetOriginal=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null){b.SetOriginal()}}};IDCollection.prototype.LoadChildren=function(c,e,a){for(var b=0;b<this.iColl.Count();b++){var f=this.iColl[b];if(f!=null){f.LoadChildren(c,e,a)}}};IDCollection.prototype.RestoreOriginal=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null){if(b.Inserted()){b.set_Deleted(true)}else{b.set_Deleted(false)}b.RestoreOriginal()}}this.bUpdateSort=true;this.PurgeDeleted()};IDCollection.prototype.ClearErrors=function(){for(var a=0;a<this.iColl.Count();a++){var b=this.iColl[a];if(b!=null){b.ClearErrors()}}};IDCollection.prototype.Validate=function(e){if(e==undefined){e=0}var b=true;for(var a=0;a<this.iColl.Count();a++){var f=this.iColl[a];if(f!=null&&f.IsModified()){f.ReconnectChildren(9999);var c=f.Validate(e,9999,true);b&=c}}return b};IDCollection.prototype.SaveToDB=function(a,f){if(a==undefined){a=9999}if(f==undefined){f=true}var c=true;for(var b=0;b<this.iColl.Count();b++){var g=this.iColl[b];if(g!=null&&g.IsModified()){var e=g.SaveToDB(a,f);c&=e}}return c};IDCollection.prototype.SaveToXML=function(f,c,a,b,d,e){if(c==undefined){c=true}if(a==undefined){a=""}if(b==undefined){b=9999}if(d==undefined){d=XMLDoc.FT_XML}if(e==undefined){e=false}if(this.MainFrm()==null){this.set_MainFrm(f);this.set_imdb(f.getIMDB())}return MDOInit.SaveCollectionToXML(null,this,c,a,b,d,e)};IDCollection.prototype.LoadFromXML=function(e,d,c,a,b){if(c==undefined){c=true}if(a==undefined){a=XMLDoc.FT_XML}if(b==undefined){b=false}if(this.MainFrm()==null){this.set_MainFrm(e);this.set_imdb(e.getIMDB())}return MDOInit.LoadCollectionFromXML(e,this,d,c,a,b)};IDCollection.prototype.Find=function(a){this.MoveFirst();while(!this.IsEof()){var b=this.GetAt();if(b==a){return true}this.MoveNext()}return false};IDCollection.prototype.FindIndex=function(b){var a=1;this.MoveFirst();while(!this.IsEof()){var c=this.GetAt();if(c==b){return a}this.MoveNext();a++}return 0};IDCollection.prototype.UISetModified=function(){if(this.iUIBound){if(this.LiveSort&&this.SortCriteria[0]!=0&&this.bUpdateSort){this.bSemMod=true;try{this.EnableSort()}catch(a){}this.bSemMod=false}this.iUpdCount++;if(this.iParent!=null){this.iParent.RefreshUI()}else{if(this.iMainFrm!=null){this.iMainFrm.set_RefreshUI(true)}}}};IDCollection.prototype.Recount=function(){var f=0;var a=0;var e=this.iColl.Count();for(var a=0;a<e;a++){var b=this.iColl[a];if(this.DocVisible(b)){f++}if(a<this.iCur){this.iPos=f}}if(f!=this.iCount){this.iCount=f;return true}return false};IDCollection.prototype.ChangeStatus=function(a){if(!this.ShowDeleted()||!this.ShowHidden()){if(this.Recount()){this.UISetModified()}}};IDCollection.prototype.ChangeDoc=function(c,a){for(var b=0;b<this.SortCriteria.length;b++){if(this.SortCriteria[b]==0){break}if(Math.abs(this.SortCriteria[b])==a){this.bUpdateSort=true;this.UISetModified();break}}};IDCollection.prototype.DocVisible=function(a,b){if(b==undefined){b=false}if(a==null){return(this.DocumentProvider!=null)}if(b){return(this.ShowDel||!a.Deleted())&&((this.ShowHid&&!this.UIBound())||!a.Hidden())}else{return(this.ShowDel||!a.Deleted())&&(this.ShowHid||!a.Hidden())}};IDCollection.prototype.ChangeCount=function(a){if(a!=0){this.iCount+=a;this.bUpdateSort=true;this.UISetModified()}};IDCollection.prototype.GetFailedDoc=function(){for(var b=0;b<this.iColl.Count();b++){var c=this.iColl[b];if(c!=null){var a=c.GetFailedDoc();if(a!=null){return a}}}return null};IDCollection.prototype.getDebugInfo=function(b,a){var f="<idcollection size='"+this.Size()+"' count='"+this.Count()+"' >";if(b==1){for(var c=0;c<this.iColl.Count();c++){var e=this.iColl[c];if(e!=null){f+=e.getDebugInfo(0,"")}}}f+="</idcollection>";return f};IDCollection.prototype.getDebugObject=function(a){try{return this.iColl[a-1]}catch(b){return null}};IDCollection.prototype.FindDocs=function(a){var e=new IDCollection();this.MoveFirst();while(!this.IsEof()){var b=this.GetAt();if(b!=null&&b.Matchs(a)){e.Add(b,null,true,false)}this.MoveNext()}return e};IDCollection.prototype.FindDoc=function(b){var a=1;this.MoveFirst();while(!this.IsEof()){var c=this.GetAt();if(c!=null&&c.Matchs(b)){return a}this.MoveNext();a++}return 0};IDCollection.prototype.FilterDocs=function(e,a){var b=e.IsEmpty();for(var c=0;c<this.iColl.Count();c++){var f=this.iColl[c];if(f!=null){if(b){f.set_Hidden(false)}else{f.set_Hidden(!f.Matchs(e,a))}}}};IDCollection.prototype.WebApi_LoadFromXML=function(b,a){if(this.MainFrm()==null){this.set_MainFrm(b);this.set_imdb(b.getIMDB())}return MDOInit.LoadCollXMLNode(this.MainFrm(),this,a.GetNode(),true)};IDCollection.prototype.WebApi_SaveToXML=function(c,b,a){if(this.MainFrm()==null){this.set_MainFrm(c);this.set_imdb(c.getIMDB())}return MDOInit.SaveCollectionToXML(null,this,false,"",a,b,true)};function IDDocHelper(){}IDDocHelper.prototype.SetMainFrm=function(a,b){};IDDocHelper.prototype.OpenAttachmentForm=function(a){};IDDocHelper.prototype.ShowAttachment=function(c,b,a){};IDDocHelper.prototype.GetAttachment=function(c,b,a){};IDDocHelper.prototype.SetAttachment=function(f,e,c,g,b,a){};IDDocHelper.prototype.DeleteAttachments=function(a){};IDDocHelper.prototype.GetComment=function(f,c,e,a,b){};IDDocHelper.prototype.SetComment=function(g,a,f,e,c,b){};IDDocHelper.prototype.DeleteComments=function(a){};IDDocHelper.prototype.GetLock=function(c,a,b,e){};IDDocHelper.prototype.ReleaseLock=function(a){};IDDocHelper.prototype.OnChangingProperty=function(c,a,b){};IDDocHelper.prototype.OnChangingProperty=function(a){};IDDocHelper.prototype.OnDeleting=function(a){};IDDocHelper.prototype.OnUpdating=function(a){};IDDocHelper.prototype.OnSelecting=function(a){};IDDocHelper.prototype.OnAddChild=function(c,b,a){};IDDocHelper.prototype.OnRemoveChild=function(c,a,b){};IDDocHelper.prototype.OnBeginTrans=function(a){};IDDocHelper.prototype.OnEndTrans=function(a){};IDDocHelper.prototype.BeforeLoad=function(b,a){};IDDocHelper.prototype.AfterLoad=function(a,b){};IDDocHelper.prototype.BeforeLoadCollection=function(e,c,a,b){};IDDocHelper.prototype.OnValidate=function(e,c,a,b){};IDDocHelper.prototype.BeforeSave=function(e,c,a,b){};IDDocHelper.prototype.AfterSave=function(b,a){};IDDocHelper.prototype.OnSQLQuery=function(c,a,e,b){};IDDocHelper.prototype.AfterSQLQuery=function(e,b,f,a,c){};IDDocHelper.prototype.OnSaveXMLProp=function(e,c,b,a,f){};IDDocHelper.prototype.OnSaveXMLObj=function(b,c,a){};IDDocHelper.prototype.OnLoadXMLProp=function(f,e,c,a,g,b){};IDDocHelper.prototype.OnLoadXMLObj=function(c,e,a,b){};IDDocHelper.prototype.OnGetName=function(g,a,f,e,c,b){};IDDocHelper.prototype.OnGetIcon=function(g,b,a,f,e,c){};IDDocHelper.prototype.OnGetTooltip=function(g,e,f,c,b,a){};IDDocHelper.prototype.OnClick=function(a){};IDDocHelper.prototype.OnExpand=function(a){};IDDocHelper.prototype.OnMayHaveChildren=function(b,a){};IDDocHelper.prototype.BeforeLookup=function(c,b,a){};IDDocHelper.prototype.AfterLookup=function(a){};IDDocHelper.prototype.OnGetValueSource=function(c,a,b){};IDDocHelper.prototype.OnGetLKE=function(h,b,c,f,g,e,a){};IDDocHelper.prototype.OnDrop=function(g,a,b,f,c,e){};IDDocHelper.prototype.OnInit=function(a){};IDDocHelper.prototype.OnClear=function(a){};IDDocHelper.prototype.OnGetNamedPropertyDefinition=function(c,a,b){};IDDocHelper.prototype.OnGetNamedPropertyValue=function(c,a,b){};IDDocHelper.prototype.OnSetNamedPropertyValue=function(c,a,b){};IDDocHelper.prototype.OnDuplicate=function(b,a){};IDDocHelper.prototype.OnMissingDocument=function(b,a,e){};IDDocHelper.prototype.OnGetDNA=function(a){};IDDocHelper.prototype.OnShow=function(b,a){};IDDocHelper.prototype.OnResyncClient=function(g,c,f,b,e,a){};IDDocHelper.prototype.OnChange=function(a){};IDDocHelper.prototype.OnWebAPI=function(b,a){};IDDocHelper.prototype.GetSchemaName=function(b,a){};function IDDocument(){this.IsDeleted=false;this.IsUpdated=false;this.IsInserted=false;this.IsSelected=false;this.IsLocked=false;this.IsValid=true;this.iUpdCount=0;this.LastFailedCheck=null;this.iRemote=null;this.iUIBound=false;this.iParent=null;this.oParent=null;this.iParentCollection=null;this.oParentCollection=null;this.iFreezeEvents=true;this.iStopEvents=0;this.iLoaded=false;this.iHidden=false;this.iInTrans=false;this.ChgProp=null;this.PropErrors=null;this.DocErrors=null;this.aVars=null;this.oVars=null;this.iSuspendSync=false;this.TagMap=null}IDDocument.ERR_NONE=0;IDDocument.ERR_ERROR=1;IDDocument.ERR_WARNACK=2;IDDocument.ERR_WARNING=3;IDDocument.prototype.GetDBObj=function(a){return null};IDDocument.prototype.GetRemote=function(){return null};IDDocument.prototype.GetServiceConnector=function(){return IOTConnector.ServiceConnector(this.GetMainFrm(),this.GetMD().ServiceEndpoint)};IDDocument.prototype.OnMissingDocument=function(a,b){};IDDocument.prototype.Parent=function(){return this.iParent};IDDocument.prototype.OldParent=function(){return this.oParent};IDDocument.prototype.set_Parent=function(a){this.iParent=a};IDDocument.prototype.set_OldParent=function(a){this.oParent=a};IDDocument.prototype.ParentCollection=function(){return this.iParentCollection};IDDocument.prototype.OldParentCollection=function(){return this.oParentCollection};IDDocument.prototype.set_ParentCollection=function(a){this.iParentCollection=a};IDDocument.prototype.set_OldParentCollection=function(a){this.oParentCollection=a};IDDocument.prototype.ChangingParent=function(){this.set_Updated(true)};IDDocument.prototype.SetMainFrm=function(a,b){};IDDocument.prototype.GetMainFrm=function(){return null};IDDocument.prototype.GetDocHelper=function(){return null};IDDocument.prototype.GetIMDB=function(){return null};IDDocument.prototype.IsChildOf=function(a){var b=this;while(b!=null){b=b.Parent();if(b==a){return true}}return false};IDDocument.prototype.GetPropertyIndex=function(d,c,b,a,e,f){if(c==undefined){c=true}if(b==undefined){b=true}if(a==undefined){a=false}if(e==undefined){e=false}if(f==undefined){f=false}return MDOInit.GetPropertyIndex(this,d,c,b,a,e,f)};IDDocument.prototype.GetExtProp=function(a){return MDOInit.GetExtProp(this,a)};IDDocument.prototype.GetExtSchema=function(){return MDOInit.GetExtSchema(this)};IDDocument.prototype.GetSchemaName=function(a){};IDDocument.prototype.GetMD=function(a){return null};IDDocument.prototype.CreateDocument=function(a){return null};IDDocument.prototype.UIBound=function(){return this.iUIBound};IDDocument.prototype.set_UIBound=function(a){if(a){this.set_FreezeEvents(false)}this.iUIBound=a};IDDocument.prototype.GetName=function(d,c,b,a){if(d==undefined){d=0}if(c==undefined){c=null}if(b==undefined){b=0}if(a==undefined){a=0}return MDOInit.GetName(this,d,c,b,a)};IDDocument.prototype.GetIcon=function(a,d,c,b){if(a==undefined){a=0}if(d==undefined){d=null}if(c==undefined){c=0}if(b==undefined){b=0}return MDOInit.GetIcon(this,a,d,c,b)};IDDocument.prototype.GetTooltip=function(d,c,b,a){if(d==undefined){d=0}if(c==undefined){c=null}if(b==undefined){b=0}if(a==undefined){a=0}return MDOInit.GetTooltip(this,d,c,b,a)};IDDocument.prototype.MayHaveChildren=function(){return MDOInit.MayHaveChildren(this)};IDDocument.prototype.DocID=function(){return MDOInit.GetDocID(this)};IDDocument.prototype.GetPropIndex=function(a){return this.GetMD().GetPropIndex(a)};IDDocument.prototype.Deleted=function(){return this.IsDeleted};IDDocument.prototype.DocIsDeleted=function(){return MDOInit.DocIsDeleted(this)};IDDocument.prototype.Updated=function(){return this.IsUpdated};IDDocument.prototype.Inserted=function(){return this.IsInserted};IDDocument.prototype.Selected=function(){return this.IsSelected};IDDocument.prototype.Loaded=function(){return this.iLoaded};IDDocument.prototype.Hidden=function(){return this.iHidden};IDDocument.prototype.Valid=function(){return this.IsValid};IDDocument.prototype.FreezeEvents=function(){return this.iFreezeEvents||(this.iStopEvents>0)};IDDocument.prototype.set_FreezeEvents=function(a){this.iFreezeEvents=a};IDDocument.prototype.StopEvents=function(){this.iStopEvents++};IDDocument.prototype.StartEvents=function(){this.iStopEvents--};IDDocument.prototype.SetUIModified=function(){this.iUpdCount++;if(this.UIBound()){this.RefreshUI()}};IDDocument.prototype.OnChangingProperty=function(a,b){};IDDocument.prototype.OnInserting=function(){};IDDocument.prototype.OnDeleting=function(){};IDDocument.prototype.OnUpdating=function(){};IDDocument.prototype.OnSelecting=function(){};IDDocument.prototype.OnAddChild=function(b,a){};IDDocument.prototype.OnRemoveChild=function(a,b){};IDDocument.prototype.SetOriginal=function(a){if(a==undefined){a=9999}MDOInit.SetOriginal(this,a)};IDDocument.prototype.RefreshUI=function(){};IDDocument.prototype.GetLookupCache=function(){return null};IDDocument.prototype.GetModifiedList=function(){return null};IDDocument.prototype.GetSchemaCache=function(){return null};IDDocument.prototype.RestoreOriginal=function(a){if(a==undefined){a=9999}MDOInit.RestoreOriginal(this,a)};IDDocument.prototype.Clear=function(){MDOInit.Clear(this)};IDDocument.prototype.InitDefaults=function(){};IDDocument.prototype.Init=function(){this.InitDefaults();MDOInit.Init(this)};IDDocument.prototype.set_Deleted=function(a){if(this.IsDeleted!=a){if(!this.FreezeEvents()&&!this.GetLock()){return}this.SetUIModified();var d=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this):false;this.IsDeleted=a;var c=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this):false;if(this.ParentCollection()!=null){if(d&&!c){this.ParentCollection().ChangeCount(-1)}if(!d&&c){this.ParentCollection().ChangeCount(1)}}if(!this.FreezeEvents()){this.OnDeleting()}this.MarkAsChanged()}};IDDocument.prototype.set_Inserted=function(a){if(this.IsInserted!=a){this.IsInserted=a;this.SetUIModified();if(!this.FreezeEvents()){this.OnInserting()}this.MarkAsChanged()}};IDDocument.prototype.set_Updated=function(a){if(this.IsUpdated!=a){this.IsUpdated=a;this.SetUIModified();if(!this.FreezeEvents()){this.OnUpdating()}this.MarkAsChanged()}};IDDocument.prototype.set_Selected=function(a){if(this.IsSelected!=a){this.SetUIModified();this.IsSelected=a;if(!this.FreezeEvents()){this.OnSelecting()}}};IDDocument.prototype.ChangingProperty=function(a){var b=new IDVariant();if(!this.FreezeEvents()){this.OnChangingProperty(new IDVariant(a),b);if(b.isFalse()&&!this.GetLock()){b.set(IDVariant.TRUE)}}if(b.isFalse()){if(!this.Updated()){this.set_Updated(true)}else{this.SetUIModified()}if(this.iInTrans){if(this.ChgProp==null){this.ChgProp=new ArrayList()}if(!this.ChgProp.Contains(a)){this.ChgProp.Add(a)}}if(this.iParentCollection!=null){this.iParentCollection.ChangeDoc(this,a)}return true}return false};IDDocument.prototype.set_Valid=function(a){this.IsValid=a};IDDocument.prototype.set_Loaded=function(a){this.iLoaded=a};IDDocument.prototype.set_Hidden=function(a){if(this.iHidden!=a){var d=false;var c=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,true):false;var g=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,false):false;this.iHidden=a;var f=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,false):false;var e=(this.ParentCollection()!=null)?this.ParentCollection().DocVisible(this,true):false;if(this.ParentCollection()!=null){if(g&&!f){this.ParentCollection().ChangeCount(-1);d=true}if(!g&&f){this.ParentCollection().ChangeCount(1);d=true}if(!d&&c!=e){this.ParentCollection().UISetModified()}}}};IDDocument.prototype.LoadChildren=function(b,c,a){if(c==undefined){c=""}if(a==undefined){a=9999}MDOInit.LoadChildren(this,b,c,a)};IDDocument.prototype.SetLoaded=function(b,a){MDOInit.SetLoaded(this,b,a)};IDDocument.prototype.SetInserted=function(b,a){MDOInit.SetInserted(this,b,a)};IDDocument.prototype.BeginTrans=function(){this.iInTrans=true;this.OnBeginTrans()};IDDocument.prototype.EndTrans=function(){this.iInTrans=false;if(this.ChgProp!=null){for(var a=0;a<this.ChgProp.length;a++){var b=this.ChgProp[a];var c=this.GetPropDOError(b);if(c!=null&&c.Ack){this.PropErrors.remove(c.PropIdx)}}}this.OnEndTrans();if(this.ChgProp!=null){this.MarkAsChanged()}this.ChgProp=null};IDDocument.prototype.WasModified=function(a){return(this.ChgProp==null)?false:this.ChgProp.Contains(a)};IDDocument.prototype.OnBeginTrans=function(){};IDDocument.prototype.OnEndTrans=function(){};IDDocument.prototype.InTrans=function(){return this.iInTrans};IDDocument.prototype.GetPropByIndex=function(a){if(this.aVars[a-1]==null){return new IDVariant()}else{return new IDVariant(this.aVars[a-1])}};IDDocument.prototype.GetPropOrigValue=function(a){if(this.oVars==null||this.oVars[a-1]==null){return this.GetPropByIndex(a)}else{return new IDVariant(this.oVars[a-1])}};IDDocument.prototype.SetPropByIndex=function(a,b){WriteToConsoleError(this.GetClass().GetClassName()+" ERR "+MDOInit.DOERR_PROPNOTFOUND+": Proprietà "+a+" Non Definita")};IDDocument.prototype.SetPropDirect=function(a,b){this.aVars[a-1]=new IDVariant(b)};IDDocument.prototype.GetPropDirect=function(a){return new IDVariant(this.aVars[a-1])};IDDocument.prototype.SetPropOrigValue=function(a,b){if(this.oVars==null){this.oVars=new Array(this.aVars.length)}this.oVars[a-1]=new IDVariant(b)};IDDocument.prototype.GetCollByIndex=function(a){WriteToConsoleError(this.GetClass().GetClassName()+" ERR "+MDOInit.DOERR_COLLNOTFOUND+": Collezione "+a+" Non Definita");return null};IDDocument.prototype.LoadFromDB=function(a){if(a==undefined){a=9999}MDOInit.LoadFromDB(this,a)};IDDocument.prototype.GetMasterQuery=function(b,c,a){};IDDocument.prototype.GetValueSource=function(d,b,a,c){};IDDocument.prototype.GetDBExpr=function(a){return""};IDDocument.prototype.LoadChildrenFromDB=function(a){return MDOInit.LoadChildrenFromDB(this,a)};IDDocument.prototype.LoadCollectionFromDB=function(b,a){MDOInit.LoadCollectionFromDB(this,b,a)};IDDocument.prototype.LoadCollectionDirect=function(d,b,a){if(b==undefined){b=9999}MDOInit.LoadCollectionDirect(this,d,b,a)};IDDocument.prototype.LoadCollectionBE=function(a,f,b,e,d){if(typeof(a)=="string"){var c=a;a=new IDCollection();this.LoadCollectionFromXML(a,c,false);this.LoadCollectionBE(a,f,b,e);return this.SaveCollectionToXML(a,false,"",b)}if(f==undefined){f=false}if(b==undefined){b=0}if(e==undefined){e=null}if(d==undefined){d=false}return MDOInit.LoadCollectionBE(this,a,f,b,e,d)};IDDocument.prototype.GetQBEClauses=function(a,e,c,b,d){MDOInit.GetQBEClauses(this,a,e,c,b,d)};IDDocument.prototype.LoadCollectionRS=function(a,c,b){if(b==undefined){b=0}MDOInit.LoadCollectionRS(this,a,c,b)};IDDocument.prototype.GetLinkedDocument=function(c,f,e,d,b,a){if(e==undefined){e=null}if(d==undefined){d=null}if(b==undefined){b=null}if(a==undefined){a=null}return MDOInit.GetLinkedDocument(this,c,f,e,d,b,a)};IDDocument.prototype.IsModified=function(a){if(a==undefined){a=9999}return MDOInit.IsModified(this,a)};IDDocument.prototype.Validate=function(c,a,b){if(c==undefined){c=0}if(a==undefined){a=9999}if(b==undefined){b=false}return MDOInit.Validate(this,c,a,b)};IDDocument.prototype.InternalValidate=function(b,a){MDOInit.InternalValidate(this,b,a)};IDDocument.prototype.Duplicate=function(b,c,a){if(b==undefined){b=9999}if(c==undefined){c=null}if(a==undefined){a=false}return MDOInit.Duplicate(this,b,c,true,a)};IDDocument.prototype.OnDuplicate=function(a){};IDDocument.prototype.SaveToDB=function(a,b){if(a==undefined){a=9999}if(b==undefined){b=true}return MDOInit.SaveToDB(this,a,b)};IDDocument.prototype.SaveToXML=function(c,a,b,d,e){if(c==undefined){c=true}if(a==undefined){a=""}if(b==undefined){b=9999}if(d==undefined){d=XMLDoc.FT_XML}if(e==undefined){e=false}return MDOInit.SaveToXML(this,c,a,b,null,null,false,d,e)};IDDocument.prototype.SaveCollectionToXML=function(b,d,a,c){return MDOInit.SaveCollectionToXML(this,b,d,a,c)};IDDocument.prototype.LoadFromXML=function(d,c,a,b){if(c==undefined){c=true}if(a==undefined){a=XMLDoc.FT_XML}if(b==undefined){b=false}return MDOInit.LoadFromXML(this,d,c,a,b)};IDDocument.prototype.LoadCollectionFromXML=function(a,c,b){return MDOInit.LoadCollectionFromXML(this.GetMainFrm(),a,c,b)};IDDocument.prototype.ReconnectChildren=function(a){MDOInit.ReconnectFK(this,a)};IDDocument.prototype.toString=function(){return this.ToString()};IDDocument.prototype.ToString=function(){return MDOInit.ToString(this)};IDDocument.prototype.TypeName=function(){return this.GetMD().ObjTag};IDDocument.GetClassName=function(a){return(a?"com.progamma.doc.":"")+"IDDocument"};IDDocument.prototype.GetClass=function(){return IDDocument};IDDocument.prototype.UpdateCount=function(){return this.iUpdCount};IDDocument.prototype.LoadLookupValues=function(){MDOInit.LoadLookupValues(this)};IDDocument.prototype.LoadValueSource=function(b,e){if(typeof(b)=="string"){var a=b;b=new IDCachedRowSet();var d=null;if(a.length>0){var f=a.split("|");d=new ArrayList();for(var c=0;c<f.length;c++){d.Add(f[c])}}MDOInit.LoadValueSource(this,b,d);return b.SaveToXML()}MDOInit.LoadValueSource(this,b,e)};IDDocument.prototype.GetAutoLookupCode=function(){return MDOInit.GetAutoLookupCode(this)};IDDocument.prototype.GetAutoLookupDescription=function(){return MDOInit.GetAutoLookupDescription(this)};IDDocument.prototype.GetLKE=function(j,g,c,f){if(typeof(j)=="string"){var a=j;c=new ArrayList();while(a.length>0){var d=parseInt(a.substr(0,a.indexOf(",")));c.Add(d);a=a.substr(a.indexOf(",")+1)}j=new IDCachedRowSet();var g=new IDVariant();var h=MDOInit.GetLKE(this,j,g,c,null);var b=j.SaveToXML();var e=new Array();e[0]=h;e[1]=g.GetSOAPobj();e[2]=b;return e}return MDOInit.GetLKE(this,j,g,c,f)};IDDocument.prototype.CopyFrom=function(b,a){if(a==undefined){a=9999}MDOInit.CopyFrom(this,b,a)};IDDocument.prototype.GetCopy=function(){return MDOInit.GetCopy(this)};IDDocument.prototype.Serialize=function(b,a){if(a==undefined){a=9999}return MDOInit.SerializeDocument(this,b,a)};IDDocument.prototype.Deserialize=function(a,b){MDOInit.DeserializeDocument(this,a,b)};IDDocument.prototype.ClearErrors=function(a){if(a==undefined){a=false}this.DocErrors=null;if(!a||this.PropErrors==null){this.PropErrors=null}else{var f=new HashTableSrv();var e=this.PropErrors.values();for(var d=0;d<e.length;d++){var b=e[d];if(b.Ack){f[b.PropIdx]=b;b.ErrType=IDDocument.ERR_NONE;b.Text="";b.Shown=false}}this.PropErrors=f}};IDDocument.prototype.HasErrors=function(b){if(b==undefined){b=false}if(this.DocErrors!=null&&this.DocErrors.Count()>0){return true}if(this.PropErrors==null){return false}var d=this.PropErrors.values();for(var c=0;c<d.length;c++){var a=d[c];if(a.ErrType==IDDocument.ERR_ERROR||(a.ErrType==IDDocument.ERR_WARNACK&&!a.Ack)||(b&&a.ErrType==IDDocument.ERR_WARNING)){return true}}return false};IDDocument.prototype.GetPropError=function(a){var b=this.GetPropDOError(a);if(b==null){return null}else{return b.Text}};IDDocument.prototype.GetPropDOError=function(a){if(this.PropErrors==null){return null}else{return this.PropErrors[a]}};IDDocument.prototype.GetDocErrors=function(a){if(a!=null&&this.DocErrors!=null){a.Clear();a.AddRange(this.DocErrors)}};IDDocument.prototype.GetFailedDoc=function(){if(this.LastFailedCheck!=null){return this}var d=this.GetMD();for(var b=1;b<=d.GetNumColl();b++){var e=this.GetCollByIndex(b);var a=e.GetFailedDoc();if(a!=null){return a}}return null};IDDocument.prototype.SetPropError=function(b,d,a){if(a==undefined){a=IDDocument.ERR_ERROR}if(d!=null&&d.length>0){if(this.PropErrors==null){this.PropErrors=new HashTableSrv()}var c=this.GetPropDOError(b);if(c==null){c=new DOError();this.PropErrors[b]=c}c.Text=d;c.ErrType=a;c.PropIdx=b}else{if(this.PropErrors!=null){this.PropErrors.remove(b)}}};IDDocument.prototype.AddDocError=function(a){if(a!=null&&a.length>0){if(this.DocErrors==null){this.DocErrors=new ArrayList()}this.DocErrors.Add(a)}};IDDocument.prototype.SetPropErrorAck=function(a,c){var b=this.GetPropDOError(a);if(b!=null){b.Ack=c}};IDDocument.prototype.BeforeLoad=function(a){};IDDocument.prototype.AfterLoad=function(a){};IDDocument.prototype.BeforeLoadCollection=function(c,a,b){};IDDocument.prototype.OnValidate=function(b,a,c){};IDDocument.prototype.BeforeSave=function(c,a,b){};IDDocument.prototype.AfterSave=function(a){};IDDocument.prototype.OnSQLQuery=function(a,c,b){};IDDocument.prototype.AfterSQLQuery=function(b,d,a,c){};IDDocument.prototype.OnSaveXMLProp=function(c,b,a,d){};IDDocument.prototype.OnSaveXMLObj=function(b,a){};IDDocument.prototype.OnLoadXMLProp=function(d,c,a,e,b){};IDDocument.prototype.OnLoadXMLObj=function(c,a,b){};IDDocument.prototype.OnGetName=function(a,e,d,c,b){};IDDocument.prototype.OnGetIcon=function(b,a,e,d,c){};IDDocument.prototype.OnGetTooltip=function(d,e,c,b,a){};IDDocument.prototype.OnClick=function(){};IDDocument.prototype.OnExpand=function(){};IDDocument.prototype.OnMayHaveChildren=function(a){};IDDocument.prototype.BeforeLookup=function(b,a){};IDDocument.prototype.AfterLookup=function(){};IDDocument.prototype.OnGetValueSource=function(a,b){};IDDocument.prototype.OnGetLKE=function(b,c,e,f,d,a){};IDDocument.prototype.OnDrop=function(a,b,e,c,d){};IDDocument.prototype.OnInit=function(){};IDDocument.prototype.OnClear=function(){};IDDocument.prototype.OnResyncClient=function(a,e,d,b,c){};IDDocument.prototype.OnWebAPI=function(a){};IDDocument.prototype.EditAttachments=function(){MDOInit.EditAttachments(this)};IDDocument.prototype.ShowAttachment=function(a){return MDOInit.ShowAttachment(this,a)};IDDocument.prototype.GetAttachment=function(a){return MDOInit.GetAttachment(this,a)};IDDocument.prototype.SetAttachment=function(c,b,d,a){return MDOInit.SetAttachment(this,c,b,d,a)};IDDocument.prototype.GetComment=function(b,c,a){return MDOInit.GetComment(this,b,c,a)};IDDocument.prototype.SetComment=function(a,d,c,b){return MDOInit.SetComment(this,a,d,c,b)};IDDocument.prototype.GetNamedPropertyDefinition=function(a){var b=new DOMDProp();this.OnGetNamedPropertyDefinition(new IDVariant(a),b);return b};IDDocument.prototype.GetNamedPropertyValue=function(a){var b=new IDVariant();this.OnGetNamedPropertyValue(new IDVariant(a),b);return b};IDDocument.prototype.SetNamedPropertyValue=function(a,b){this.OnSetNamedPropertyValue(new IDVariant(a),b)};IDDocument.prototype.OnGetNamedPropertyDefinition=function(a,b){};IDDocument.prototype.OnGetNamedPropertyValue=function(a,b){};IDDocument.prototype.OnSetNamedPropertyValue=function(a,b){};IDDocument.prototype.GetLock=function(b,a,d){if(b==undefined){b=9999}if(a==undefined){a=""}if(d==undefined){d=new IDVariant()}if(typeof(d)=="string"){d=new IDVariant(d)}try{return MDOInit.GetLock(this,b,a,d)}catch(c){WriteToConsoleError(c);return false}};IDDocument.prototype.ReleaseLock=function(a){if(a==undefined){a=9999}try{return MDOInit.ReleaseLock(this,a)}catch(b){WriteToConsoleError(b);return false}};IDDocument.prototype.Locked=function(){return this.IsLocked};IDDocument.prototype.set_Locked=function(a){this.IsLocked=a};IDDocument.prototype.SetTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};IDDocument.prototype.GetTag=function(a){if(this.TagMap!=null){var b=this.TagMap[a.stringValue()];if(b!=null){return b}}var c=this.GetMD();while(c!=null){var b=c.GetTag(a);if(b!=null){return b}c=c.BaseMD}return null};IDDocument.prototype.SetObjTag=function(b,a){if(this.TagMap==null){this.TagMap=new HashTableSrv()}this.TagMap[b.stringValue()]=a};IDDocument.prototype.GetObjTag=function(a){if(this.TagMap!=null){return this.TagMap[a.stringValue()]}return null};IDDocument.prototype.getDebugInfo=function(b,a){};IDDocument.prototype.getPropDebugInfo=function(b,a,c){};IDDocument.prototype.setPropDebug=function(b,a,c){};IDDocument.prototype.Matchs=function(h,g){if(g==undefined){g=false}var c=this.GetMD();var k=this.GetMD();var j=(g?true:false);for(var e=1;e<=c.GetNumProp()&&e<=k.GetNumProp();e++){var m=this.GetPropByIndex(e);var f=h.GetPropByIndex(e);if(f.Value==null){continue}if(g&&f.stringValue().length==0){continue}var b=g;var o=new IDVariant(";");var a=false;if(b&&"DO_ID".equals(c.GetProp(e).Concept)){o=new IDVariant(" ");a=true;if(f.stringValue().indexOf(o.stringValue())==-1){b=false;if(f.stringValue().charAt(0)=="§"){f=new IDVariant(f.stringValue().substr(1))}}}var l=(h.GetMainFrm() instanceof WebEntryPointSrv?h.GetMainFrm():null);if(b?!IDL.QbeMatch(m,f,l,o,a):!f.equals(m)){return false}else{j=true}}return j};IDDocument.prototype.Show=function(a){return null};IDDocument.prototype.OnShow=function(a){};IDDocument.prototype.GetDNA=function(){var d=this.GetMD();var b=new StringTokenizer();if(this.AssemblyName){b.addToken(new IDVariant(this.AssemblyName+"|"+this.TypeName()))}else{if(this.GetMainFrm().CompNameSpace){b.addToken(new IDVariant(this.GetMainFrm().CompNameSpace+"$"+this.TypeName()))}else{b.addToken(new IDVariant(this.TypeName()))}}for(var c=1;c<=d.GetNumProp();c++){var a=d.GetProp(c);if(a.PK){b.addToken(this.GetPropByIndex(c))}}return b.getString()};IDDocument.GetFromDNA=function(DNA,FromCache,NumLevel,mainfrm,imdb,SkipLoad){if(SkipLoad==undefined){SkipLoad=false}if(mainfrm!=null&&mainfrm instanceof WebEntryPointSrv){if(mainfrm==mainfrm.GetApplication()&&mainfrm.DocHelper!=null){mainfrm.DocHelper.OnGetDNA(DNA)}}var st=new StringTokenizer();st.setString(DNA);if(!st.hasNext()){return null}var flWep=true;var ClassName=st.next().ToString();var doc=null;try{if(ClassName.indexOf("|")!=-1&&mainfrm!=null&&mainfrm instanceof WebEntryPointSrv){var AssemblyName=ClassName.substring(0,ClassName.indexOf("|"));var ClsName=ClassName.substring(ClassName.indexOf("|")+1);doc=mainfrm.GetApplication().CreateObjFromLibrary(AssemblyName,ClsName)}else{if(ClassName.indexOf("$")!=-1&&mainfrm!=null&&mainfrm instanceof WebEntryPointSrv){var NameSpace=ClassName.substring(0,ClassName.indexOf("$"));var ClsName=ClassName.substring(ClassName.indexOf("$")+1);var cmp=mainfrm.GetApplication().GetCompFromNameSpace(NameSpace);if(cmp!=null){doc=cmp.CreateDocument(ClsName);flWep=false}}else{try{doc=eval("new "+ClassName+"()")}catch(e){}if(doc!=null&&!(doc instanceof IDDocument)){doc=null;throw Error("ClassCastException (ClassName "+ClassName+" is not an IDDocument)")}if(doc==null&&mainfrm instanceof WebEntryPointSrv){doc=mainfrm.CreateDocument(ClassName);flWep=false}}}}catch(e){if(mainfrm!=null&&mainfrm instanceof WebEntryPointSrv){mainfrm.getDTTObj().AddException(DNA.stringValue(),"IDDocument.GetFromDNA","Can't find class "+ClassName,e)}}if(doc!=null){if(flWep&&mainfrm!=null&&ClassName.indexOf("|")==-1){doc.SetMainFrm(mainfrm,imdb)}var CanBeLoaded=true;var MD=doc.GetMD();for(var i=1;i<=MD.GetNumProp();i++){var MDP=MD.GetProp(i);if(MDP.PK){if(st.hasNext()){var v=st.next();MDOInit.ConvertVariant(v,MDP);doc.SetPropByIndex(i,v)}else{CanBeLoaded=false}}}if(CanBeLoaded&&!SkipLoad){if(FromCache){doc.LoadLookupValues()}if(!FromCache||NumLevel>0){try{doc.LoadFromDB(NumLevel)}catch(exc){}}}}return doc};IDDocument.prototype.OnChange=function(){};IDDocument.prototype.IsChanged=function(){return this.iChanged};IDDocument.prototype.MarkAsChanged=function(){if(this.GetMD().NotifyOnChange){if(this.GetModifiedList()!=null){if(!this.IsChanged()){this.GetModifiedList().Add(this);this.iChanged=true}}else{this.OnChange()}}if(this.Parent()!=null){this.Parent().MarkAsChanged()}};IDDocument.prototype.ProcessChange=function(a){this.OnChange();this.iChanged=undefined;if(a&&this.GetModifiedList()!=null){this.GetModifiedList().Remove(this)}};IDDocument.prototype.IsEmpty=function(){for(var a=0;a<this.aVars.length;a++){if(this.aVars[a]!=null){return false}}return true};IDDocument.prototype.ResetOrigValues=function(){this.oVars=null};IDDocument.prototype.ChangePropDirect=function(b,f,e){if(!f.equals(this.aVars[b-1])){var d=this.aVars[b-1];this.aVars[b-1]=new IDVariant(f);var a=false;if(this.oVars==null){this.oVars=new Array(this.aVars.length);a=true}var c=false;if(this.oVars[b-1]==null){this.oVars[b-1]=d;c=true}if(!e&&!this.ChangingProperty(b)){this.aVars[b-1]=d;if(a){this.oVars=null}else{if(c){this.oVars[b-1]=null}}}if(e){this.SetUIModified()}}};IDDocument.prototype.AcknowledgeWarnings=function(){var b=this.GetMD();for(var a=1;a<=b.GetNumProp();a++){this.SetPropErrorAck(a,true)}};IDDocument.prototype.equals=function(a){return a==this};IDDocument.IsMyInstance=function(a){return(a instanceof IDDocument)};IDDocument.prototype.SuspendSync=function(){return this.iSuspendSync};IDDocument.prototype.set_SuspendSync=function(a){if(a){this.iSuspendSync=true}else{if(MDOInit.ResumeDocSync(this)){this.iSuspendSync=false}}};IDDocument.prototype.WebApi_LoadFromXML=function(d,c){if(this.GetMainFrm()==null){var a=d;var b=this.GetClass().GetClassName(true);if(b.indexOf(".")!=-1){a=d.GetCompFromNameSpace(b.substring(0,b.lastIndexOf(".")))}this.SetMainFrm(a,a.getIMDB())}return MDOInit.LoadXMLNode(this,c.GetNode(),true,true)};IDDocument.prototype.WebApi_SaveToXML=function(e,d,b){if(this.GetMainFrm()==null){var a=e;var c=this.GetClass().GetClassName(true);if(c.indexOf(".")!=-1){a=e.GetCompFromNameSpace(c.substring(0,c.lastIndexOf(".")))}this.SetMainFrm(a,a.getIMDB())}return MDOInit.SaveToXML(this,false,"",b,null,null,false,d,true)};function IDObject(){}IDObject.prototype.SetMainFrm=function(a,b){};function IOTConnector(){this.MainFrm=null;this.ServiceEndpoint="";this.ServiceType=IOTConnector.SERTYPE_OTHER;this.ServiceFormat=XMLDoc.FT_JSON;this.AuthorizationEndpoint="";this.TokenEndpoint="";this.RedirectUri="";this.ClientID="";this.ClientSecret="";this.Scope="";this.AccessToken="";this.RefreshToken="";this.AccessTokenLifetime=null;this.Username="";this.Password="";this.SalesforceSessionTimeout=120;this.ODataVersion=-1}IOTConnector.SERTYPE_OTHER=0;IOTConnector.SERTYPE_SALESFORCE=1;IOTConnector.SERTYPE_ODATA=2;IOTConnector.IOT_TAG="ID_IOTDATA";IOTConnector.DocMDMap=new IDMap();IOTConnector.prototype.SetMainFrm=function(a,b){this.MainFrm=a};IOTConnector.set_ServiceConnector=function(b,c,a){var e=b.GetApplication();var d=e.ServiceConnectors;d[c]=a;a.ServiceEndpoint=c;if(a.MainFrm==null){a.SetMainFrm(e,e.getIMDB())}if(a.RedirectUri.length==0){a.RedirectUri=e.GetAppUrl(true,false)}switch(a.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:a.AuthorizationEndpoint="https://login.salesforce.com/services/oauth2/authorize";a.TokenEndpoint="https://login.salesforce.com/services/oauth2/token";break}};IOTConnector.ServiceConnector=function(a,b){if(b==null||b.length==0){return null}var e=a.GetApplication();var d=e.ServiceConnectors;var f=d[b];if(f==null){f=new IOTConnector();IOTConnector.set_ServiceConnector(a,b,f)}return f};IOTConnector.InitMetadata=function(o,y){if(y.ServiceEndpoint!=null){return}var D=y.GetTag(new IDVariant(IOTConnector.IOT_TAG)).stringValue();if(D.length==0){y.ServiceEndpoint="";return}y.SetTag(new IDVariant(IOTConnector.IOT_TAG),new IDVariant());try{var A=new XMLDoc();A.LoadFromString(D);var t=A.GetRootNode();y.ServiceEndpoint=t.GetAttribute("Endpoint");y.IOTCode=t.GetAttribute("Code");var g=IOTConnector.ServiceConnector(o,y.ServiceEndpoint);if(t.GetAttribute("Type").length>0){g.ServiceType=parseInt(t.GetAttribute("Type"))}if(t.GetAttribute("Format").length>0){g.ServiceFormat=parseInt(t.GetAttribute("Format"))}if(t.GetAttribute("ODataVersion").length>0){g.ODataVersion=parseInt(t.GetAttribute("ODataVersion"))}if(t.GetAttribute("ODataEntitySet").length>0){y.ODataEntitySet=t.GetAttribute("ODataEntitySet")}if(t.GetAttribute("ODataNamespace").length>0){y.ODataNamespace=t.GetAttribute("ODataNamespace")}if(t.GetAttribute("ODataWithEtag").length>0){y.ODataWithEtag=true}IOTConnector.SetDocMDMap(y);if(t.GetAttribute("Methods").length>0){y.IOTMethods=t.GetAttribute("Methods")}for(var x=1;x<=y.GetNumProp();x++){var C=y.GetProp(x);if(C.IOTData==null||C.IOTData.length==0){continue}A.LoadFromString(C.IOTData);t=A.GetRootNode();C.IOTCode=t.GetAttribute("Code");C.ODataType=t.GetAttribute("ODataType");if(t.GetAttribute("FK").length>0){var l=t.GetAttribute("FK").split(",");for(var v=0;v<l.length;v++){var m=l[v];var r=m.indexOf(".");var c=m.substr(0,r);var q=m.substr(r+1);var p=IOTConnector.CreateIOTDocument(g,o,c);if(p!=null){var b=new DOMDLinkedDoc(p.TypeName(),1);b.SetLinkedProp(0,p.GetPropertyIndex(q,false,false,false,false,true),C.Index);C.LinkedDoc=b}}}while(t.HasNextNode()){var h=t.GetNextNode();if(!h.Name().equals("LinkedDocs")){continue}var c=h.GetAttribute("Type");var p=IOTConnector.CreateIOTDocument(g,o,c);if(p!=null){var a=h.GetAttribute("SrcProp").split(",");var d=h.GetAttribute("DstProp").split(",");var b=new DOMDLinkedDoc(p.TypeName(),a.length);b.SetName(h.GetAttribute("Name"));C.LinkedDoc=b;for(var v=0;v<a.length;v++){b.SetLinkedProp(v,p.GetPropertyIndex(d[v],false,false,false,false,true),y.GetIOTCodeIndex(a[v]))}}}}for(var x=1;x<=y.GetNumColl();x++){var f=y.GetColl(x);if(f.IOTData.length==0){continue}A.LoadFromString(f.IOTData);t=A.GetRootNode();f.IOTCode=t.GetAttribute("Code");if(t.GetAttribute("NM").length>0){f.IOTMultiplicityNM=true}if(t.GetAttribute("PKs").length>0){var s=o.CreateDocument(f.ChildrenName).GetMD();var B=t.GetAttribute("PKs").split(",");var l=t.GetAttribute("FKs").split(",");for(var v=0;v<B.length;v++){for(var u=1;u<=y.GetNumProp();u++){var C=y.GetProp(u);if(C.IOTCode.equals(B[v])){f.PKColl.Add(C.ObjTag);break}}for(var u=1;u<=s.GetNumProp();u++){var C=s.GetProp(u);if(C.IOTCode.equals(l[v])){f.FKColl.Add(C.ObjTag);break}}}}}}catch(z){WriteToConsoleError(z)}};IOTConnector.prototype.Authenticate=function(){if(this.IsAuthenticated()){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.Authenticate","Authentication already done");return}if(!this.CheckAuthenticationParameters()){return}var d=new IDMap();d.set_Value(new IDVariant("response_type"),new IDVariant("code"));d.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));d.set_Value(new IDVariant("redirect_uri"),new IDVariant(this.RedirectUri+"?WCI="+Glb.ITEM_OAUTH));if(this.Scope.length>0){d.set_Value(new IDVariant("scope"),new IDVariant(this.Scope))}d.set_Value(new IDVariant("state"),new IDVariant(IDL.Base64Encode(this.ServiceEndpoint)));var f=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.Authenticate","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestCode Event");this.BeforeOAuthRequestCode(d,f);if(f.isFalse()){var a=this.AuthorizationEndpoint;var j=d.GetKeys();for(var c=0;c<j.Size();c++){var g=j.get_Value(new IDVariant(c));var h=g.stringValue();var b=d.get_Value(g).stringValue();a+=(c==0?"?":"&")+h+"="+Glb.URLEncode(b)}var e=this.MainFrm;e.set_RedirectTo(new IDVariant(a));e.set_RedirectNewWindow(e.ParamsObj().UseRD4&&e.ShellObject.IsInsideShell())}};IOTConnector.prototype.RequestAccessToken=function(){var j=this.MainFrm.GetRequestParams();var k=j.get_Value(new IDVariant("error"));var b=j.get_Value(new IDVariant("code"));if(k.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request code error");this.MainFrm.getDTTObj().AddMsgToken("","error",k);this.MainFrm.getDTTObj().AddMsgToken("","error_description",j.get_Value(new IDVariant("error_description")))}else{if(b.stringValue().length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","Code not found")}else{this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Code obtained");this.MainFrm.getDTTObj().AddMsgToken("","code",b.stringValue())}}var m=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestCode Event");this.AfterOAuthRequestCode(j,m);if(m.isTrue()||k.stringValue().length>0||b.stringValue().length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","Service "+this.ServiceEndpoint+": access token request interrupted");return}j.Clear();j.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));j.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));j.set_Value(new IDVariant("code"),new IDVariant(b));j.set_Value(new IDVariant("grant_type"),new IDVariant("authorization_code"));j.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));j.set_Value(new IDVariant("client_secret"),new IDVariant(this.ClientSecret));j.set_Value(new IDVariant("redirect_uri"),new IDVariant(this.RedirectUri+"?WCI="+Glb.ITEM_OAUTH));m=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.BeforeOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestToken Event");this.BeforeOAuthRequestToken(j,m);if(m.isTrue()){return}var h=new IDVariant();try{h=IDL.HttpRequest(this.MainFrm,new IDVariant(this.TokenEndpoint),j);var f=new XMLDoc();f.LoadFromString(h.stringValue(),this.ServiceFormat);var l=f.GetRootNode();if(l.GetAttribute("error").length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request access token error");this.MainFrm.getDTTObj().AddMsgToken("","error",l.GetAttribute("error"));this.MainFrm.getDTTObj().AddMsgToken("","error_description",l.GetAttribute("error_description"))}else{this.AccessToken=l.GetAttribute("access_token");this.RefreshToken=l.GetAttribute("refresh_token");if(l.GetAttribute("expire_in").length>0){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("s"),new IDVariant(l.GetAttribute("expire_in")),IDL.Now()).dateValue()}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("n"),new IDVariant(this.SalesforceSessionTimeout),IDL.Now()).dateValue()}else{this.AccessTokenLifetime=null}}if(this.AccessToken.length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","AccessToken obtained");this.MainFrm.getDTTObj().AddMsgToken("","access_token",this.AccessToken);if(this.RefreshToken.length>0){this.MainFrm.getDTTObj().AddMsgToken("","refresh_token",this.RefreshToken)}}}}catch(g){WriteToConsoleError(g);this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RequestAccessToken","OAuth request access token error: "+g)}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.AfterOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestToken Event");var c=j.get_Object(new IDVariant("ID_HEADERS"));var o=new IDMap();for(var d=0;d<c.Size();d++){var a=c.get_Value(new IDVariant(d)).stringValue().split(":");o.set_Value(new IDVariant(a[0]),new IDVariant(a[1]))}this.AfterOAuthRequestToken(h,j.get_Value(new IDVariant("ID_RESPONSECODE")),o)};IOTConnector.prototype.IsAuthenticated=function(){if(this.AccessToken.length>0&&this.AccessTokenLifetime!=null&&this.AccessTokenLifetime<IDL.Now().dateValue()&&this.RefreshToken.length>0){this.RefreshAccessToken()}return(this.AccessToken.length>0)};IOTConnector.prototype.RefreshAccessToken=function(){this.AccessToken="";this.AccessTokenLifetime=null;var h=new IDMap();h.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));h.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));h.set_Value(new IDVariant("grant_type"),new IDVariant("refresh_token"));h.set_Value(new IDVariant("client_id"),new IDVariant(this.ClientID));h.set_Value(new IDVariant("client_secret"),new IDVariant(this.ClientSecret));h.set_Value(new IDVariant("refresh_token"),new IDVariant(this.RefreshToken));if(this.Scope.length>0){h.set_Value(new IDVariant("scope"),new IDVariant(this.Scope))}var k=new IDVariant();this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.BeforeOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire BeforeOAuthRequestToken Event");this.BeforeOAuthRequestToken(h,k);if(k.isTrue()){return}var g=new IDVariant();try{g=IDL.HttpRequest(this.MainFrm,new IDVariant(this.TokenEndpoint),h);var d=new XMLDoc();d.LoadFromString(g.stringValue(),this.ServiceFormat);var j=d.GetRootNode();if(j.GetAttribute("error").length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RefreshAccessToken","OAuth refresh access token error");this.MainFrm.getDTTObj().AddMsgToken("","error",j.GetAttribute("error"));this.MainFrm.getDTTObj().AddMsgToken("","error_description",j.GetAttribute("error_description"))}else{this.AccessToken=j.GetAttribute("access_token");if(j.GetAttribute("expire_in").length>0){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("s"),new IDVariant(j.GetAttribute("expire_in")),IDL.Now()).dateValue()}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){this.AccessTokenLifetime=IDL.DateAdd(new IDVariant("n"),new IDVariant(this.SalesforceSessionTimeout),IDL.Now()).dateValue()}else{this.AccessTokenLifetime=null}}if(this.AccessToken.length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.RequestAccessToken","AccessToken obtained");this.MainFrm.getDTTObj().AddMsgToken("","access_token",this.AccessToken)}}}catch(f){WriteToConsoleError(f);this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.RefreshAccessToken","OAuth refresh access token error: "+f)}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,"",100,"IOTConnector.AfterOAuthRequestToken","Service "+this.ServiceEndpoint+": Fire AfterOAuthRequestToken Event");var b=h.get_Object(new IDVariant("ID_HEADERS"));var l=new IDMap();for(var c=0;c<b.Size();c++){var a=(b.get_Value(new IDVariant(c))).stringValue().split(":");l.set_Value(new IDVariant(a[0]),new IDVariant(a[1]))}this.AfterOAuthRequestToken(g,h.get_Value(new IDVariant("ID_RESPONSECODE")),l)};IOTConnector.prototype.CheckAuthenticationParameters=function(){if(this.ClientID.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.CheckAuthenticationParameters","Missing ClientID required for authentication");return false}if(this.ClientSecret.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",100,"IOTConnector.CheckAuthenticationParameters","Missing ClientSecret required for authentication");return false}return true};IOTConnector.prototype.AuthenticationRequired=function(){return(this.AuthorizationEndpoint.length>0&&this.TokenEndpoint.length>0)};IOTConnector.prototype.LoadCollectionBE=function(g,A,b,B){var x=g.GetMD();var f="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+="SELECT ";var u=0;for(var w=1;w<=x.GetNumProp();w++){var D=x.GetProp(w);if(D.IOTCode.length==0){continue}if(u>0){f+=","}u++;f+=D.IOTCode}f+=" FROM "+x.IOTCode}var s="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){s=" WHERE "}for(var w=1;w<=x.GetNumProp();w++){var D=x.GetProp(w);var l=g.GetPropByIndex(w);if(b){var t="";if("DO_ID".equals(D.Concept)){}else{t=this.GetQBEFilter(l.stringValue(),D)}if(t.length>0){f+=s+"("+t+")";s=" and ";t=""}}else{if(l.Type!=IDVariant.NULL){f+=s+"("+D.IOTCode+"="+this.ToSOQL(l,D)+")";s=" and "}}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f="/query?q="+Glb.URLEncode(f)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(x.ODataEntitySet.length>0){var m="/"+x.ODataEntitySet;if(this.ODataVersion==4){m+="?$count=true"}else{m+="?$inlinecount=allpages"}var a=this.GetODataExpand(g);if(a.length>0){m+="&"+a}if(x.BaseMD!=null){if(f.length>0){f+=" and "}f+="isof('"+x.ODataNamespace+"."+x.IOTCode+"')"}if(f.length>0){f=m+"&$filter="+Glb.URLEncode(f)}else{f=m}}}}var d=new IDMap();d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));d.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var c=new IDArray();c.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));d.set_Object(new IDVariant("ID_HEADERS"),c);if(!this.AddAuthorizationHeader(c)){return 0}var o=new IDVariant();var C=new IDVariant(f);this.BeforeLoadCollection(g,null,A,o,C,d);if(o.isTrue()){return A.Count()}var r=new IDVariant();var E=this.DoHttpRequest("LoadCollectionBE",C.stringValue(),d,r);if(r.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionBE",g.TypeName()+": error while loading collection: "+r);throw new Error(r.stringValue())}if(E!=null){try{var p=E.GetRootNode();var h=this.LoadCollectionFromJSON(g,A,p,B);if(h==-1){h=this.GetCollectionCount("LoadCollectionBE",C.stringValue(),c,d,r);if(r.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionBE",g.TypeName()+": error while get collection count: "+r);throw new Error(r.stringValue())}}var y=(A.MaxRows==0?h:Math.min(A.MaxRows,h));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&y>A.Count()){d.set_Object(new IDVariant("ID_HEADERS"),c);A.ODataLoadInfo=new IDMap();A.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(C));A.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadCollectionBE"));A.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(A.Count()));A.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(B));A.ODataLoadInfo.set_Object(new IDVariant("args"),d);A.SetSize(y,g)}}catch(z){WriteToConsoleError(z);throw z}}return A.Count()};IOTConnector.prototype.LoadCollectionFromDB=function(h,C,q){var B=h.GetCollByIndex(q);var u=h.GetMD();var o=u.GetColl(q);var s=h.GetMD(o.ChildrenName);var m=h.CreateDocument(o.ChildrenName);var g="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+="SELECT ";var y=0;for(var z=1;z<=s.GetNumProp();z++){var E=s.GetProp(z);if(E.IOTCode.length==0){continue}if(y>0){g+=", "}y++;g+=E.IOTCode}g+=" FROM "+s.IOTCode;var x=" WHERE ";for(var z=1;z<=o.PKColl.Count();z++){var d=u.GetPropIndex(o.PKColl[z-1]);var b=s.GetPropIndex(o.FKColl[z-1]);var E=s.GetProp(b);var p=h.GetPropByIndex(d);if(p.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+u.IOTCode+" PK Non Definita")}g+=x+"("+E.IOTCode+"="+this.ToSOQL(p,E)+")";x=" and "}g="/query?q="+Glb.URLEncode(g)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){g="/"+this.GetResourcePath(h)+"/"+o.IOTCode;if(this.ODataVersion==4){g+="?$count=true"}else{g+="?$inlinecount=allpages"}var a=this.GetODataExpand(m);if(a.length>0){g+="&"+a}}}var f=new IDMap();f.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));f.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var e=new IDArray();e.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));f.set_Object(new IDVariant("ID_HEADERS"),e);if(!this.AddAuthorizationHeader(e)){return}var r=new IDVariant();var D=new IDVariant(g);this.BeforeLoadCollection(m,h,B,r,D,f);if(r.isTrue()){return}var w=new IDVariant();var F=this.DoHttpRequest("LoadCollectionFromDB",D.stringValue(),f,w);if(w.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionFromDB",h.TypeName()+": error while loading "+o.ChildrenName+": "+w.stringValue());throw new Error(w.stringValue())}if(B.Parent()!=null){B.Parent().StopEvents()}if(F!=null){var t=F.GetRootNode();var l=this.LoadCollectionFromJSON(m,B,t,C);if(l==-1){l=this.GetCollectionCount("LoadCollectionFromDB",D.stringValue(),e,f,w);if(w.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadCollectionFromDB",h.TypeName()+": error while get collection count: "+w);throw new Error(w.stringValue())}}var A=(B.MaxRows==0?l:Math.min(B.MaxRows,l));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&A>B.Count()){f.set_Object(new IDVariant("ID_HEADERS"),e);B.ODataLoadInfo=new IDMap();B.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(D));B.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadCollectionFromDB"));B.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(B.Count()));B.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(C));B.ODataLoadInfo.set_Object(new IDVariant("args"),f);B.SetSize(A,h)}if(B.Parent()!=null){B.Parent().StartEvents()}}};IOTConnector.prototype.SaveDocToDB=function(h,m,o){if(o==undefined){o=-1}var w=h.GetMD();var d=new IDMap();d.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));d.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var c=new IDArray();c.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));d.set_Object(new IDVariant("ID_HEADERS"),c);if(!this.AddAuthorizationHeader(c)){return false}if(h.Deleted()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("DELETE"))}else{if(m==1||m==2){d.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml; charset:utf-8"));d.set_Value(new IDVariant("ID_BODY"),new IDVariant(h.SaveToXML(false,"",0,this.ServiceFormat)));if(h.Inserted()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"))}else{if(h.Updated()){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("PUT"))}}}else{if(m==4){d.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant("application/json"));var a=false;var p="";if(o>0){var k=w.GetProp(o).LinkedDoc;var b=h.CreateDocument(k.GetDocumentClass());for(var u=0;u<k.GetNumProp();u++){b.SetPropByIndex(k.GetSrcProp(u),h.GetPropByIndex(k.GetDstProp(u)));if(h.GetPropByIndex(k.GetDstProp(u)).Type==IDVariant.NULL){a=true}}p=this.GetResourcePath(b)}else{p=this.GetResourcePath(h);a=h.IsDeleted}if(a){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("DELETE"))}else{if(o>0){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("PUT"))}else{d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"))}var D=new XMLDoc();var r=D.AddNewElement(XMLDoc.ROOT_JSON);if(this.ODataVersion<=2){r.SetAttribute("uri",p)}else{if(this.ODataVersion==3){r.SetAttribute("url",p)}else{if(this.ODataVersion==4){r.SetAttribute("@odata.id",p)}}}d.set_Value(new IDVariant("ID_BODY"),new IDVariant(D.SaveToString(XMLDoc.FT_JSON)))}}}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&(m==2||m==3)&&w.ODataWithEtag){c.add_Value(new IDVariant("If-Match: *"))}var g="/";if(m==4){if(o>0){g+=this.GetResourcePath(h);var k=w.GetProp(o).LinkedDoc;if(this.ODataVersion<4){g+="/$links/"+k.GetName()}else{g+="/"+k.GetName()+"/$ref"}}else{g+=this.GetResourcePath(h.Parent());if(this.ODataVersion<4){if(h.Deleted()){g+="/$links/"+this.GetResourcePath(h)}else{g+="/$links/"+h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTCode}}else{if(h.Deleted()){g+="/"+this.GetResourcePath(h)+"/$ref"}else{g+="/"+h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTCode+"/$ref"}}}}else{g+=this.GetResourcePath(h,!h.Inserted())}if(!h.Inserted()&&h.Updated()){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"));g+="?_HttpMethod=PATCH"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){d.set_Value(new IDVariant("ID_TYPE"),new IDVariant("POST"));if(this.ODataVersion<=2){c.add_Value(new IDVariant("X-HTTP-Method: MERGE"))}else{c.add_Value(new IDVariant("X-HTTP-Method: PATCH"))}}}}var q=new IDVariant();var f=new IDVariant();var B=new IDVariant(g);if(!((h.Updated()||h.Inserted()||h.Deleted())&&!(h.Deleted()&&h.Inserted()))){q=new IDVariant(-1)}if(!((m==1&&h.Inserted()&&!h.Deleted())||(m==2&&!h.Deleted()&&!h.Inserted())||(m==3&&h.Deleted()&&!h.Inserted()))){q=new IDVariant(-1)}var z=(h.ParentCollection()!=null&&h.Parent()!=null&&h.Parent().GetMD().GetColl(h.ParentCollection().Index).IOTMultiplicityNM);if(m==1&&z){q=new IDVariant(-1)}if(m==4){q=new IDVariant(0)}try{this.BeforeSave(h,q,f,new IDVariant(m),B,d,new IDVariant(o))}catch(x){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.SaveDocToDB",h.GetName(1)+": exception in Before Save event: "+x);h.AddDocError(x.toString());return false}if(f.isTrue()){return false}if(q.isTrue()){return true}q=new IDVariant(0);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(m==2){q=new IDVariant(-1);if(!z){for(var u=1;u<=w.GetNumProp();u++){var A=w.GetProp(u);if(!A.ODataType.equals("link")&&!h.GetPropOrigValue(u).equals(h.GetPropByIndex(u))){q=new IDVariant(0);break}}}}else{if(m==3){q=new IDVariant(z)}}}if(q.isFalse()){var s=new IDVariant();var C=this.DoHttpRequest("SaveDocToDB",B.stringValue(),d,s);if(s.stringValue().length>0){h.AddDocError(s.stringValue());return false}if(C!=null){var r=C.GetRootNode();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){h.SetPropByIndex(h.GetPropertyIndex("Id",false,false,false,false,true),new IDVariant(r.GetAttribute("id")))}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){for(var u=1;u<=w.GetNumProp();u++){var A=w.GetProp(u);var l=this.StringToVariant(r.GetAttribute(A.IOTCode),A);if(l.Type!=IDVariant.NULL){h.SetPropByIndex(u,l)}}}}h.ReconnectChildren(9999)}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(z&&(m==2||m==3)){if(!this.SaveDocToDB(h,4,0)){return false}}else{if(!z&&(m==1||m==2)){for(var u=1;u<=w.GetNumProp();u++){var A=w.GetProp(u);if(A.ODataType.equals("link")&&A.LinkedDoc!=null&&!h.GetPropOrigValue(u).equals(h.GetPropByIndex(u))){var y=false;for(var t=0;t<A.LinkedDoc.GetNumProp();t++){if(A.LinkedDoc.GetDstProp(t)<u){y=true;break}}if(!y&&!this.SaveDocToDB(h,4,u)){return false}}}}}}return true};IOTConnector.prototype.LoadValueSource=function(g,d,l){var B=g.GetMD();d.PrepareForValueSource();var f="";var o="";var m=new ArrayList();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+="SELECT "}var y="";for(var A=1;A<=B.GetNumProp();A++){var H=B.GetProp(A);if(H.PK){f+=y;f+=H.IOTCode;y=",";m.Add(A)}}for(var A=1;A<=B.GetNumProp();A++){var H=B.GetProp(A);var r=false;if(l!=null){for(var z=0;z<l.Count();z++){var u=l[z];if(String.compare(H.ObjTag,u,true)==0){r=true;break}}}else{r=H.DescribeRow}if(r){f+=",";f+=H.IOTCode;m.Add(A);if(H.DescribeRow&&l==null){break}}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+=" FROM "+B.IOTCode;y=" WHERE "}else{y=""}for(var A=1;A<=B.GetNumProp();A++){var H=B.GetProp(A);var p=g.GetPropByIndex(A);if(p.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f+=y+H.IOTCode+" = "+this.ToSOQL(p,H)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){o+=y+H.IOTCode+" eq "+this.ToSOQL(p,H)}}y=" and "}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){f="/query?q="+Glb.URLEncode(f)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var s="/"+B.ODataEntitySet;if(this.ODataVersion==4){s+="?$count=true"}else{s+="?$inlinecount=allpages"}var a=this.GetODataExpand(g);if(a.length>0){s+="&"+a}s+="&$select="+Glb.URLEncode(f);if(B.BaseMD!=null){if(o.length>0){o+=" and "}o+="isof('"+B.ODataNamespace+"."+B.IOTCode+"')"}f=s+"&$filter="+Glb.URLEncode(o)}}var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){return}var t=new IDVariant();var G=new IDVariant(f);this.OnGetValueSource(g,d,t,G,c);if(t.isTrue()){if(!d.EOF()){d.MoveFirst()}return}var x=new IDVariant();var J=this.DoHttpRequest("LoadValueSource",G.stringValue(),c,x);if(x.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadValueSource",g.TypeName()+": error while loading value source: "+x.stringValue());return}if(J!=null){try{var w=J.GetRootNode();var E=new IDCollection();var h=this.LoadCollectionFromJSON(g,E,w,0);if(h==-1){h=this.GetCollectionCount("LoadValueSource",G.stringValue(),b,c,x);if(x.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadValueSource",g.TypeName()+": error while get collection count: "+x);return}}var C=(E.MaxRows==0?h:Math.min(E.MaxRows,h));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&C>E.Count()){c.set_Object(new IDVariant("ID_HEADERS"),b);E.ODataLoadInfo=new IDMap();E.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(G));E.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("LoadValueSource"));E.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(E.Count()));E.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));E.ODataLoadInfo.set_Object(new IDVariant("args"),c);E.SetSize(C,g)}var I=new IDCachedRowSet();var F=new IDCachedRowSetMetaData();F.setColumnCount(m.Count());for(var A=0;A<m.Count();A++){var H=B.GetProp(m[A]);F.setColumnName(A+1,H.ObjTag);F.setColumnType(A+1,IDCachedRowSetMetaData.GetCSharpType(H.DataType))}I.setMetaData(F);this.LoadRSFromCollection(I,E);if(!I.EOF()){I.MoveFirst()}d.CopyFrom(I)}catch(D){WriteToConsoleError(D)}}};IOTConnector.prototype.GetLKE=function(k,d,l,j,a){var w=k.GetMD();var r=new IDVariant();var y=-1;var o=null;do{y++;if(d.IsOpen()){d.Close()}var t=(d.pQuery==null||d.pQuery.Parent.MainFrm.ParamsObj().LKEDOAllProperties?null:d.pQuery.HeaderColumns);var h=this.GetLKEQbe(k,y,l,j,t);var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){break}var f=new IDVariant();var E=new IDVariant(h);this.OnGetLKE(k,d,new IDVariant(y),l,r,f,a,E,c);if(d.pQuery!=null){d.pQuery.LkeRSLimitedBySystem=false}if(f.isTrue()||d.RecordCount()>0){break}if(r.isTrue()){break}if(l.isFalse()&&!h.equals(o)&&h.length>0){o=h;var u=new IDVariant();var H=this.DoHttpRequest("GetLKE",E.stringValue(),c,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.GetLKE",k.TypeName()+": error while loading LKE data: "+u.stringValue());break}if(H!=null){try{var s=H.GetRootNode();if(d.IsOpen()){d.Close()}if(d.pQuery!=null){d.pQuery.LkeRSLimitedBySystem=true}var A=new IDCollection();var m=this.LoadCollectionFromJSON(k,A,s,0);if(m==-1){m=this.GetCollectionCount("GetLKE",E.stringValue(),b,c,u);if(u.stringValue().length>0){MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.GetLKE",k.TypeName()+": error while get collection count: "+u)}}var x=(A.MaxRows==0?m:Math.min(A.MaxRows,m));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&x>A.Count()){c.set_Object(new IDVariant("ID_HEADERS"),b);A.ODataLoadInfo=new IDMap();A.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(E));A.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("GetLKE"));A.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(A.Count()));A.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));A.ODataLoadInfo.set_Object(new IDVariant("args"),c);A.SetSize(x,k)}var G=new IDCachedRowSet();var p=new ArrayList();for(var v=1;v<=w.GetNumProp();v++){var D=w.GetProp(v);if(D.IOTCode.length>0&&D.DataType!=Glb.DT_DOC_OLE){var C=false;if(t!=null&&!D.PK&&!"DO_CODE".equals(D.Concept)){C=true;var q=t.keys();for(var g=0;g<q.length;g++){var F=q[g];if(String.compare(F,D.ObjTag,true)==0){C=false;break}}}if(C){continue}p.Add(v)}}var B=new IDCachedRowSetMetaData();B.setColumnCount(p.Count());for(var v=0;v<p.Count();v++){var D=w.GetProp(p[v]);B.setColumnName(v+1,D.ObjTag);B.setColumnType(v+1,IDCachedRowSetMetaData.GetCSharpType(D.DataType))}G.setMetaData(B);this.LoadRSFromCollection(G,A);d.CopyFrom(G)}catch(z){WriteToConsoleError(z)}}if(d.RecordCount()>0){break}}if(y>100){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",169,"IOTConnector.GetLKE",k.GetName(1)+": Too many Smart Lookup tries. Did you forget to set Cancel to TRUE?");break}}while((y<5||r.isTrue())&&l.isFalse());return y};IOTConnector.prototype.GetLKEQbe=function(f,A,g,d,u){var z=f.GetMD();var c="";var x=0;if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){c+="SELECT "}for(var y=1;y<=z.GetNumProp();y++){var C=z.GetProp(y);if(C.IOTCode.length>0&&C.DataType!=Glb.DT_DOC_OLE){var B=false;if(u!=null&&!C.PK&&!"DO_CODE".equals(C.Concept)){B=true;var p=u.keys();for(var b=0;b<p.length;b++){var D=p[b];if(String.compare(D,C.ObjTag,true)==0){B=false;break}}}if(B){continue}if(x>0){c+=","}x++;c+=C.IOTCode}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){c+=" FROM "+z.IOTCode+" WHERE "}g.set(IDVariant.TRUE);var w="";if(d!=null){for(var o=0;o<d.Count();o++){var t=d[o];var C=z.GetProp(t);var m=f.GetPropByIndex(t).stringValue();if(m.length>0){var k=this.ToSOQL(new IDVariant(m),C);if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" = "+k}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" eq "+k}}if(w.length>0){w+=" and "}w+=k}}if(w.length>0){c+="("+w+") and ";w=""}}for(var y=1;y<=z.GetNumProp();y++){var m=f.GetPropByIndex(y).stringValue();var C=z.GetProp(y);var B=false;if(u!=null){B=true;var p=u.keys();for(var b=0;b<p.length;b++){var D=p[b];if(String.compare(D,C.ObjTag,true)==0){B=false;break}}}if(B){continue}for(var o=0;o<d.Count();o++){var t=d[o];if(t==y){m="";break}}var e=false;if(m.length>0){g.set(IDVariant.FALSE);if(m[0]=="*"){m="%"+m.substr(1)}if(m[m.length-1]=="*"){m=m.substr(0,m.length-1)+"%"}if(m[0]!="%"&&m[m.length-1]!="%"){if(A==0){e=true}else{if(A==1){m+="%"}else{m="%"+m+"%"}}}var k="";if(e){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" = "+this.ToSOQL(new IDVariant(m),C)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" eq "+this.ToSOQL(new IDVariant(m),C)}}}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" like "+this.ToSOQL(new IDVariant(m),C)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var h=m.indexOf("%");var l=m.lastIndexOf("%");if(h==l&&m.length==1){k=C.IOTCode+" ne null"}else{if(h==l&&h==0){k="endswith(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(1)),C)+"))"}else{if(h==l&&h==m.length-1){k="startswith(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(0,m.length-1)),C)+"))"}else{if(h==0&&l==m.length-1){k="indexof(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(1,m.length-2)),C)+")) gt -1"}else{k="tolower("+C.IOTCode+") eq tolower("+this.ToSOQL(new IDVariant(m),C)+")"}}}}}}}if(w.length>0){if(A>2){w+=" or "}else{w+=" and "}}w+=k}}if(A>3){for(x=1;x<=z.GetNumProp();x++){var C=z.GetProp(x);var B=false;if(u!=null){B=true;var p=u.keys();for(var b=0;b<p.length;b++){var D=p[b];if(String.compare(D,C.ObjTag,true)==0){B=false;break}}}else{B=!(Glb.ClassDT(C.DataType)==Glb.DTC_CHAR&&C.MaxLength>4&&!C.PK&&!C.FK&&C.IOTCode.length>0)}if(!B){var m=f.GetPropByIndex(x).stringValue();if(m.length==0){for(var y=1;y<=z.GetNumProp();y++){m=f.GetPropByIndex(y).stringValue();var s=z.GetProp(y);for(var o=0;o<d.Count();o++){var t=d[o];if(t==y){m="";break}}if(m.length>0){g.set(IDVariant.FALSE);if(m[0]=="*"){m="%"+m.substr(1)}if(m[m.length-1]=="*"){m=m.substr(0,m.length-1)+"%"}if(m[0]!="%"&&m[m.length-1]!="%"){if(A==1){m+="%"}else{m="%"+m+"%"}}var k="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" like "+this.ToSOQL(new IDVariant(m),C)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(!m.equals("%")){var h=m.indexOf("%");var l=m.lastIndexOf("%");if(h==l&&m.length==1){k=C.IOTCode+" ne null"}else{if(h==l&&h==0){k="endswith(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(1)),C)+"))"}else{if(h==l&&h==m.length-1){k="startswith(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(0,m.length-1)),C)+"))"}else{if(h==0&&l==m.length-1){k="indexof(tolower("+C.IOTCode+"), tolower("+this.ToSOQL(new IDVariant(m.substr(1,m.length-2)),C)+")) gt -1"}else{k="tolower("+C.IOTCode+") eq tolower("+this.ToSOQL(new IDVariant(m),C)+")"}}}}}}}if(w.length>0){if(A>2){w+=" or "}else{w+=" and "}}w+=k}}}}}}if(w.length==0){return""}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){c+="("+w+") LIMIT "+(MDOInit.MAX_LKE_ROWS+1);c="/query?q="+Glb.URLEncode(c)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(z.ODataEntitySet.length>0){var r="/"+z.ODataEntitySet;if(this.ODataVersion==4){r+="?$count=true"}else{r+="?$inlinecount=allpages"}var a=this.GetODataExpand(f);if(a.length>0){r+="&"+a}c=r+"&$select="+Glb.URLEncode(c);if(z.BaseMD!=null){if(w.length>0){w+=" and "}w+="isof('"+z.ODataNamespace+"."+z.IOTCode+"')"}if(w.length>0){c+="&$filter="+Glb.URLEncode(w)}}}}}return c};IOTConnector.prototype.LoadFromDB=function(h,B){var z=h.GetMD();if(!h.Loaded()){var o=true;var f=false;for(var y=1;y<=z.GetNumProp();y++){var D=z.GetProp(y);if(D.PK){var m=h.GetPropByIndex(y);if(m.Type==IDVariant.NULL){o=false;break}}}var g="";if(o){g+="/"+this.GetResourcePath(h);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var a=this.GetODataExpand(h);if(a.length>0){g+="?"+a}}}else{var w="";if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+="SELECT ";var x=0;for(var y=1;y<=z.GetNumProp();y++){var D=z.GetProp(y);if(D.IOTCode.length==0){continue}if(x>0){g+=", "}x++;g+=D.IOTCode}g+=" FROM "+z.IOTCode;w=" WHERE "}for(var y=1;y<=z.GetNumProp();y++){var D=z.GetProp(y);if(D.IOTCode.length==0){continue}var m=h.GetPropByIndex(y);if(m.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g+=w+"("+D.IOTCode+"="+this.ToSOQL(m,D)+")"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){g+=w+"("+D.IOTCode+" eq "+this.ToSOQL(m,D)+")"}}w=" and ";f=true}}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){g="/query?q="+Glb.URLEncode(g)}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var r="/"+z.ODataEntitySet;if(this.ODataVersion==4){r+="?$count=true"}else{r+="?$inlinecount=allpages"}var a=this.GetODataExpand(h);if(a.length>0){r+="&"+a}if(z.BaseMD!=null){g+=" and isof('"+z.ODataNamespace+"."+z.IOTCode+"')"}g=r+"&$filter="+Glb.URLEncode(g)}}}if(!o&&!f){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+z.IOTCode+" Nessun campo valorizzato")}var c=new IDMap();c.set_Value(new IDVariant("ID_TYPE"),new IDVariant("GET"));c.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));var b=new IDArray();b.add_Value(new IDVariant("Accept: "+(this.ServiceFormat==XMLDoc.FT_JSON?"application/json":"text/xml")));c.set_Object(new IDVariant("ID_HEADERS"),b);if(!this.AddAuthorizationHeader(b)){return}var s=new IDVariant();var C=new IDVariant(g);this.BeforeLoad(h,s,C,c);if(s.isTrue()){return}var u=new IDVariant();var E=this.DoHttpRequest("LoadFromDB",C.stringValue(),c,u);if(u.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadFromDB",h.TypeName()+": error while loading document: "+u.stringValue());throw new Error(u.stringValue())}var l=0;var t=E.GetRootNode();if(E!=null){if(o){l=1}else{l=this.GetCountFromResult(t)}}if(l==0){throw new Error("ERR "+MDOInit.DOERR_OBJNOTFOUND+": "+z.IOTCode+" Object not found")}if(l>1){throw new Error("ERR "+MDOInit.DOERR_OBJMULDEF+": "+z.IOTCode+" Can not identify the object")}h.StopEvents();try{var d=null;if(o){d=t}else{d=t.GetNextNode()}d.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(h,d.GetNode(),true)}catch(A){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.LoadFromDB",h.GetName(1)+": error while loading document: "+A);throw A}h.SetOriginal()}var p=h.LoadChildrenFromDB(B);if(!h.Loaded()){h.set_Loaded(true);h.MarkAsChanged();h.StartEvents()}else{if(p){h.MarkAsChanged()}}};IOTConnector.prototype.LoadRSFromCollection=function(c,a){a.MoveFirst();while(!a.IsEof()){var f=a.GetAt();var b=new ArrayList();for(var e=1;e<=c.GetNumFields();e++){b.Add(f.GetPropDirect(f.GetPropIndex(c.GetName(e))))}c.AddRow(b);a.MoveNext()}};IOTConnector.prototype.ToSOQL=function(a,b){if(IDL.IsNull(a)){return"null"}switch(b.DataType){case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:return IDL.Quote(a);case Glb.DT_NUM_INTEGER:case Glb.DT_NUM_FLOAT:case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:if(a.Type==IDVariant.DECIMAL||a.Type==IDVariant.FLOAT||a.Type==IDVariant.INTEGER){return a.stringValue()}else{return new IDVariant(a.dblValue()).stringValue()}case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion<=3){return"datetime'"+IOTConnector.FormatDate(a.dateValue(),b.DataType).Replace("Z","")+"'"}else{return IOTConnector.FormatDate(a.dateValue(),b.DataType)}case Glb.DT_BOOLEAN:if(a.booleanValue()){return"true"}else{return"false"}}return""};IOTConnector.FixTime=function(a){if(a<10){a="0"+a}return a};IOTConnector.FormatDate=function(b,d){var f=IOTConnector.FixTime(b.getMonth()+1);var a=IOTConnector.FixTime(b.getDate());var c=b.toUTCString();var e=c.substring(c.indexOf(":")-2,c.indexOf(":")+6)+"Z";switch(d){case Glb.DT_DATE:return b.getFullYear()+"-"+f+"-"+a;case Glb.DT_TIME:return e;case Glb.DT_DATETIME:return b.getFullYear()+"-"+f+"-"+a+"T"+e}};IOTConnector.prototype.GetQBEFilter=function(x,C){var q="";var s="";var e=-1,c=-1;var h=true;if(x.length>0&&x.charAt(0)=="§"){x=x.substr(1);h=false}if(x.length==0){return""}var z=this.MainFrm.ParamsObj().QBETrueLessThan;do{if(x.charAt(0)!="="){e=x.indexOf(";",e+1)}if(e>=0){s=x.substr(c+1,(e)-(c+1))}else{s=x.substr(c+1)}var k="";var o=new Array();o[0]="";o[1]="";if(s.length>0){if(s.charAt(0)==">"){if(z){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" > ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" gt ?"}}}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}}o[0]=s.substr(1);if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var A=IDL.ParsePartialDate(this.MainFrm,o[0],(z?1:0));if(A.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}o[0]=A.stringValue()}}}if(s.charAt(0)=="<"){if(z){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" lt ?"}}}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" le ?"}}}o[0]=s.substr(1);if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var A=IDL.ParsePartialDate(this.MainFrm,o[0],(z?0:1));if(A.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" lt ?"}}o[0]=A.stringValue()}}}if(s.charAt(0)=="."){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" != null"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ne null"}}}if(s.charAt(0)=="!"){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" = null"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" eq null"}}}if(s.charAt(0)=="#"){s=s.substr(1);if(h&&Glb.ClassDT(C.DataType)==Glb.DTC_CHAR){if(s.indexOf("*")==-1&&s.indexOf("%")==-1){s=s+"*"}s=s.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" not "+C.IOTCode+" like ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var l=s.indexOf("%");var m=s.lastIndexOf("%");if(l==m&&l==0){k+="not endswith(tolower("+C.IOTCode+"), tolower(?))";s=s.substr(1)}else{if(l==m&&l==s.length-1){k+="not startswith(tolower("+C.IOTCode+"), tolower(?))";s=s.substr(0,s.length-1)}else{if(l==0&&m==s.length-1){k+="indexof(tolower("+C.IOTCode+"), tolower(?)) eq -1";s=s.substr(1,s.length-2)}else{k="tolower("+C.IOTCode+") ne tolower(?)"}}}}}o[0]=s}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" != ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ne ?"}}o[0]=s;if(C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE){var v=IDL.ParsePartialDate(this.MainFrm,o[0],0);var u=IDL.ParsePartialDate(this.MainFrm,o[0],1);if(v.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" < ? or "+C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" lt ? or "+C.IOTCode+" ge ?"}}o[0]=this.ToSOQL(v,C);o[1]=this.ToSOQL(u,C)}}}}if(s.charAt(0)=="="){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" = ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" eq ?"}}o[0]=s.substr(1)}else{if(k.length==0){var r=s.indexOf(":");if(r>=0){var B=false;if(Glb.ClassDT(C.DataType)==Glb.DTC_DATE){B=true;var v=IDL.ParsePartialDate(this.MainFrm,s.substr(0,r),0);var u=IDL.ParsePartialDate(this.MainFrm,s.substr(r+1),1);var j=(v.Type!=IDVariant.NULL||u.Type!=IDVariant.NULL);if(s.indexOf("/")!=-1||s.indexOf("-")!=-1||j){var a;for(a=r+1;a<s.length;a++){if(s.charAt(a)==":"){r=a}else{if(s.charAt(a)=="/"||s.charAt(a)=="-"){break}}}if(a<=s.length){var g=s.substr(0,r);var f=s.substr(r+1);if(g.length>0&&f.length>0){if(v.Type==IDVariant.NULL&&u.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ? and "+C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ? and "+C.IOTCode+" lt ?"}}o[0]=g;o[1]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}if(v.Type==IDVariant.NULL){o[0]=g}else{o[0]=v.stringValue()}if(u.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" and "+C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k+=" and "+C.IOTCode+" le ?"}}o[1]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k+=" and "+C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k+=" and "+C.IOTCode+" lt ?"}}o[1]=u.stringValue()}}}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}if(v.Type==IDVariant.NULL){o[0]=g}else{o[0]=v.stringValue()}}else{if(f.length>0){if(u.Type==IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" le ?"}}o[0]=f}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" lt ?"}}o[0]=u.stringValue()}}}}}}else{var t=new ArrayList();for(var a=0;a<s.length;a++){if(s.charAt(a)==":"){t.Add(a)}}if(t.Count()>2&&(t.Count()%2)==1){r=Math.floor(t[(t.Count()-1)/2]);var g=s.substr(0,r);var f=s.substr(r+1);if(g.length>0&&f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ? and "+C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ? and "+C.IOTCode+" lt ?"}}o[0]=g;o[1]=f}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}o[0]=g}else{if(f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" le ?"}}o[0]=f}}}}}}if(!B){var g=s.substr(0,r);var f=s.substr(r+1);if(g.length>0&&f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ? and "+C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ? and "+C.IOTCode+" lt ?"}}o[0]=g;o[1]=f}else{if(g.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ?"}}o[0]=g}else{if(f.length>0){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" le ?"}}o[0]=f}}}}}}if(k.length==0){var y=s.indexOf(" ")>=0&&(s.indexOf(":")>=0||s.indexOf(".")>=0);var v=IDL.ParsePartialDate(this.MainFrm,s,0);var u=IDL.ParsePartialDate(this.MainFrm,s,1);if((C.DataType==Glb.DT_DATETIME||C.DataType==Glb.DT_DATE)&&v.Type!=IDVariant.NULL){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ? and "+C.IOTCode+" < ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ? and "+C.IOTCode+" lt ?"}}o[0]=v.stringValue();o[1]=u.stringValue()}else{if(C.DataType==Glb.DT_DATETIME&&!y){if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" >= ? and "+C.IOTCode+" <= ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" ge ? and "+C.IOTCode+" lt ?"}}o[0]=s;o[1]=s+" 23:59:59"}else{if(h&&Glb.ClassDT(C.DataType)==Glb.DTC_CHAR){if(s.indexOf("*")==-1&&s.indexOf("%")==-1){s=s+"*"}s=s.replace(/\*/g,"%");if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" like ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var l=s.indexOf("%");var m=s.lastIndexOf("%");if(l==m&&l==0){k+="endswith(tolower("+C.IOTCode+"), tolower(?))";s=s.substr(1)}else{if(l==m&&l==s.length-1){k+="startswith(tolower("+C.IOTCode+"), tolower(?))";s=s.substr(0,s.length-1)}else{if(l==0&&m==s.length-1){k+="indexof(tolower("+C.IOTCode+"), tolower(?)) gt -1";s=s.substr(1,s.length-2)}else{k="tolower("+C.IOTCode+") eq tolower(?)"}}}}}o[0]=s}else{if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){k=C.IOTCode+" = ?"}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){k=C.IOTCode+" eq ?"}}o[0]=s}}}}}for(var b=0;b<o.length;b++){var w=k.indexOf("?");if(w>=0){o[b]=this.ToSOQL(new IDVariant(o[b]),C);k=k.substr(0,w)+o[b]+k.substr(w+1)}}if(k.length>0){if(q.length>0){q=q+" or "}q=q+"("+k+")"}}c=e}while(e>=0);return q};IOTConnector.prototype.StringToVariant=function(a,b){if(a.length==0){return new IDVariant()}else{if(b.DataType==Glb.DT_DOC_OLE){if(!a.startsWith("data:")){a="data:application/octet-stream;base64,"+a}return new IDVariant(Glb.LoadBlob(this.MainFrm,a))}else{if(Glb.ClassDT(b.DataType)==Glb.DTC_DATE){if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&a.startsWith("/Date(")){return new IDVariant(XMLDoc.DeserializeJsonDate(a))}else{if(this.ODataVersion==3&&(b.DataType==Glb.DT_DATETIME||b.DataType==Glb.DT_TIME)&&!a.endsWith("Z")){a+="Z"}}}return new IDVariant(new Date(a))}}}return new IDVariant(a)};IOTConnector.prototype.VariantToString=function(c,d){switch(c.Type){case IDVariant.NULL:if(this.ServiceFormat==XMLDoc.FT_JSON){return XMLDoc.NULL_VALUE}break;case IDVariant.DATETIME:return IOTConnector.FormatDate(c.dateValue(),d.DataType);case IDVariant.INTEGER:if(d.DataType==Glb.DT_BOOLEAN&&this.ServiceFormat==XMLDoc.FT_JSON){return(c.intValue()==0?XMLDoc.FALSE_VALUE:XMLDoc.TRUE_VALUE)}break;case IDVariant.DECIMAL:if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion<=2){return"0"+c.stringValue()}break;case IDVariant.BLOB:var a=Glb.SaveBlob(this.MainFrm,c,new IDVariant(),new IDVariant(),true).stringValue();return a.substr(a.indexOf(",")+1)}return c.stringValue()};IOTConnector.GetHeader=function(c,a){for(var b=0;b<c.Size();b++){var d=c.get_Value(new IDVariant(b)).stringValue();if(d.toLowerCase().startsWith(a.toLowerCase()+":")){return d.substr(a.length+1).trim()}}return""};IOTConnector.prototype.DoHttpRequest=function(d,b,o,h){var k=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServiceEndpoint+b),o);var m="";if(o.get_Object(new IDVariant("ID_HEADERS")) instanceof IDArray){m=IOTConnector.GetHeader(o.get_Object(new IDVariant("ID_HEADERS")),"content-type")}var f=o.get_Value(new IDVariant("ID_RESPONSECODE")).intValue();if(this.MainFrm.getDTTObj().MsgLevel>=DTTEngine.DTTMSG_VERB){var a="";if(o.get_Object(new IDVariant("ID_HEADERS")) instanceof IDArray){a=IOTConnector.GetHeader(o.get_Object(new IDVariant("ID_HEADERS")),"content-length")}this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_VERB,"",100,"IOTConnector."+d,"Service "+this.ServiceEndpoint+" http request: "+b);this.MainFrm.getDTTObj().AddParameter("","","Method",o.get_Value(new IDVariant("ID_TYPE")));this.MainFrm.getDTTObj().AddParameter("","","Response content-type",m);this.MainFrm.getDTTObj().AddParameter("","","Response content-length",a);this.MainFrm.getDTTObj().AddParameter("","","Response content",(k.stringValue().length>1000?k.stringValue().substr(0,1000)+" ...":k.stringValue()))}var g=null;if(m.toLowerCase().startsWith("application/json")){try{g=new XMLDoc();if(!g.LoadFromString(k.stringValue(),XMLDoc.FT_JSON)){throw new h("Unknown error")}}catch(j){g=null;WriteToConsoleError(j);h.set(new IDVariant("Error while parsing JSON response: "+j.toString()))}}else{o.set_Value(new IDVariant("ID_RESPONSE"),k)}if(f>=400){if(g!=null){var l=g.GetRootNode();switch(this.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:h.set(new IDVariant(l.GetAttribute("message")));break;case IOTConnector.SERTYPE_ODATA:if(l.GetAttribute("message").length>0){h.set(new IDVariant(l.GetAttribute("message")))}else{while(l.HasNextNode()){var c=l.GetNextNode();if(c.Name().equals("message")){h.set(new IDVariant(c.GetAttribute("value")))}break}}break}}else{if(m.toLowerCase().startsWith("text/plain")){h.set(new IDVariant(k.stringValue()))}else{h.set(new IDVariant("Unknown error"))}}}return g};IOTConnector.prototype.GetODataExpand=function(c){var d="";var e=c.GetMD();for(var b=1;b<=e.GetNumProp();b++){var a=e.GetProp(b);if(a.ODataType.equals("link")&&a.LinkedDoc!=null){d+=(d.length>0?",":"")+a.LinkedDoc.GetName()}}if(d.length>0){return"$expand="+d}else{return""}};IOTConnector.prototype.LoadCollectionFromJSON=function(l,d,c,j,g){if(g==undefined){g=-1}if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE&&!c.GetAttribute("done").equals("-1")){return -1}var h=0;while(c.HasNextNode()){h++;if(d.MaxRows>0&&h>d.MaxRows){d.HasMoreElements=true;break}var e=c.GetNextNode();if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE&&!e.Name().equals("records")){continue}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&!e.Name().equals("results")){continue}if(this.ODataVersion>2&&!e.Name().equals("value")){continue}}}var m=null;if(this.ServiceType==IOTConnector.SERTYPE_ODATA){var a="";if(this.ODataVersion<=2){while(e.HasNextNode()){var b=e.GetNextNode();if(b.Name().equals("__metadata")){a=b.GetAttribute("type");break}}e.Reset()}if(this.ODataVersion==3&&e.GetAttribute("odata.type").length>0){a=e.GetAttribute("odata.type")}if(this.ODataVersion==4&&e.GetAttribute("@odata.type").length>0){a=e.GetAttribute("@odata.type")}if(a.indexOf(".")>0){a=a.substr(a.lastIndexOf(".")+1)}if(a.length>0){m=IOTConnector.CreateIOTDocument(l.GetServiceConnector(),l.GetMainFrm(),a)}}if(m==null){m=l.CreateDocument(l.TypeName())}if(g>0){d.SetDirect(g+h,m)}else{d.Add(m)}e.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(m,e.GetNode(),true);m.SetOriginal();m.LoadChildrenFromDB(j-1);m.set_Loaded(true);m.MarkAsChanged();m.StartEvents()}d.set_Loaded(true);if(g==-1){var f=this.GetCountFromResult(c);var k="";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&c.GetAttribute("__next").length>0){k=c.GetAttribute("__next")}else{if(this.ODataVersion==3&&c.GetAttribute("odata.nextLink").length>0){k=c.GetAttribute("odata.nextLink")}else{if(this.ODataVersion==4&&c.GetAttribute("@odata.nextLink").length>0){k=c.GetAttribute("@odata.nextLink")}}}if(f==-1&&k.length==0){f=d.Count()}}return f}return -1};IOTConnector.prototype.GetMissingDoc=function(o,f,m){if(this.ServiceType!=IOTConnector.SERTYPE_ODATA){return}try{var a=f.ODataLoadInfo.get_Value(new IDVariant("url")).stringValue();var c=f.ODataLoadInfo.get_Value(new IDVariant("action")).stringValue();var l=f.ODataLoadInfo.get_Value(new IDVariant("pageSize")).intValue();var p=f.ODataLoadInfo.get_Value(new IDVariant("childLevel")).intValue();var j=f.ODataLoadInfo.get_Object(new IDVariant("args"));var b=j.get_Object(new IDVariant("ID_HEADERS"));var d=m-(m%l);if(this.ODataVersion==4){a=a.Replace("$count=true","$skip="+d)}else{a=a.Replace("$inlinecount=allpages","$skip="+d)}var k=new IDVariant();var h=this.DoHttpRequest(c,a,j,k);if(k.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector."+c,o.TypeName()+": error while loading collection from "+d+" to "+(d+l)+": "+k);return}this.LoadCollectionFromJSON(o,f,h.GetRootNode(),p,d);j.set_Object(new IDVariant("ID_HEADERS"),b)}catch(g){}};IOTConnector.prototype.GetCountFromResult=function(a){var b=-1;if(this.ServiceType==IOTConnector.SERTYPE_SALESFORCE){if(a.GetAttribute("done").equals("-1")&&a.GetAttribute("totalSize").length>0){b=parseInt(a.GetAttribute("totalSize"))}}else{if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(this.ODataVersion<=2&&a.GetAttribute("__count").length>0){b=parseInt(a.GetAttribute("__count"))}else{if(this.ODataVersion==3&&a.GetAttribute("odata.count").length>0){b=parseInt(a.GetAttribute("odata.count"))}else{if(this.ODataVersion==4&&a.GetAttribute("@odata.count").length>0){b=parseInt(a.GetAttribute("@odata.count"))}}}}}return b};IOTConnector.prototype.GetCollectionCount=function(c,g,d,a,f){var e=g;if(this.ODataVersion==4){e=e.Replace("?$count=true","/$count?")}else{e=e.Replace("?$inlinecount=allpages","/$count?")}for(var b=0;b<d.Size();b++){if(d.get_Value(new IDVariant(b)).stringValue().startsWith("Accept: ")){d.Remove(new IDVariant(b))}}d.add_Value(new IDVariant("Accept: text/plain, application/json"));a.set_Object(new IDVariant("ID_HEADERS"),d);this.DoHttpRequest("LoadCollectionBE",e,a,f);if(f.stringValue().length==0){return a.get_Value(new IDVariant("ID_RESPONSE")).intValue()}else{return -1}};IOTConnector.SetDocMDMap=function(a){if(a.IOTCode.length==0){return}IOTConnector.DocMDMap.set_Value(new IDVariant(a.ServiceEndpoint+"|"+a.IOTCode),new IDVariant(a.ObjTag))};IOTConnector.CreateIOTDocument=function(b,a,h){var e=IOTConnector.DocMDMap.get_Value(new IDVariant(b.ServiceEndpoint+"|"+h)).stringValue();if(e.length>0){return a.CreateDocument(e)}var g=a.GetLibraryObjList("",true);for(var c=0;c<g.Size();c++){var f=a.CreateDocument(g.get_Value(new IDVariant(c)).stringValue());IOTConnector.SetDocMDMap(f.GetMD());if(f.GetMD().IOTCode.equals(h)){return f}}for(var c=0;c<a.CompList.Count();c++){var f=IOTConnector.CreateIOTDocument(b,a.CompList[c],h);if(f!=null){return f}}return null};IOTConnector.prototype.GetResourcePath=function(e,g){if(g==undefined){g=true}var f=e.GetMD();var b="";if(g){for(var d=1;d<=f.GetNumProp();d++){var c=f.GetProp(d);if(c.PK){var a=e.GetPropByIndex(d);if(this.ServiceType==IOTConnector.SERTYPE_ODATA){b+=(b.length>0?",":"")+c.IOTCode+"="+this.ToSOQL(a,c)}else{b+=(b.length>0?"/":"")+a}}}if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&b.indexOf(",")==-1){b=b.substr(b.indexOf("=")+1)}}switch(this.ServiceType){case IOTConnector.SERTYPE_SALESFORCE:return"sobjects/"+f.IOTCode+(g?"/"+b:"");case IOTConnector.SERTYPE_ODATA:return f.ODataEntitySet+(g?"("+b+")":"");default:return f.IOTCode+(g?"/"+b:"")}};IOTConnector.CallAction=function(c,a,f,e){var b=c;if(c.indexOf(".")!=-1){b=c.substr(0,c.indexOf("."))+"$"+c.substr(c.indexOf(".")+1)}var d=IDDocument.GetFromDNA(new IDVariant(b),false,0,e,e.getIMDB(),true);return d.GetServiceConnector().CallAction(d,a,f)};IOTConnector.prototype.CallAction=function(J,t,u){var b=J.GetMD();var y=b.IOTMethods.split(";");var l="";for(var M=0;M<y.length;M++){var f=y[M].substr(0,y[M].indexOf("("));f=f.substr(f.lastIndexOf(" ")+1);if(f.startsWith("-")){f=f.substr(1)}if(f.equals(t)){l=y[M];break}}if(l.length==0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction","Missing metadata of method "+t+" of class "+J.TypeName());throw new Error("Missing metadata of method "+t+" of class "+J.TypeName())}var A=(l.indexOf("-")!=-1);var j=false;var N=false;var B=null;var e=l.substr(0,l.indexOf("(")).split(" ");var D=e[0];if(D.endsWith("f")){D=D.substr(0,D.length-1);j=true}var z=(e.length==3?e[1]:"");if(z.startsWith("+")){N=true;z=z.substr(1)}if(z.length>2){B=IOTConnector.CreateIOTDocument(this,J.GetMainFrm(),z)}var O="/";if(!A){O+=this.GetResourcePath(J,!A)+"/";if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&this.ODataVersion==4){O+=b.ODataNamespace+"."}}O+=t;if(j){O+="("}var K="?";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){if(N){if(this.ODataVersion==4){O+=K+"$count=true"}else{O+=K+"$inlinecount=allpages"}K="&"}if(z.length>2){var a=this.GetODataExpand(B);if(a.length>0){O+=K+a}K="&"}}var H=new XMLDoc();var r=H.AddNewElement(XMLDoc.ROOT_JSON);var L=l.substr(l.indexOf("(")+1);L=L.substr(0,L.length-1);if(L.length>0){var g=L.split(",");for(var M=0;M<g.length;M++){var I=g[M].split(" ");var c=g[M].substr(0,g[M].indexOf(" "));var s=g[M].substr(g[M].indexOf(" ")+1);var h=u.get_Object(new IDVariant(M));if(h instanceof IDVariant){var w=new DOMDProp();w.DataType=parseInt(c);if(j){O+=(M==0?"":",")+s+"="+this.ToSOQL(h,w)}else{if(D.equals("GET")||D.equals("DELETE")){O+=K+s+"="+this.ToSOQL(h,w)}else{r.SetAttribute(s,this.VariantToString(h,w))}}}else{if(h==null){r.SetAttribute(s,XMLDoc.NULL_VALUE)}else{if(h instanceof IDDocument){MDOInit.SaveToXML(h,false,"",999,H.GetDocument(),r.GetNode(),false,XMLDoc.FT_JSON)}else{if(h instanceof IDCollection){}}}}}}if(j){O+=")"}var F=new IDMap();F.set_Value(new IDVariant("ID_TYPE"),new IDVariant(D));F.set_Value(new IDVariant("ID_NOERROR"),new IDVariant("-1"));if(!(j||D.equals("GET")||D.equals("DELETE"))){F.set_Value(new IDVariant("ID_BODYTYPE"),new IDVariant("application/json"));F.set_Value(new IDVariant("ID_BODY"),new IDVariant(H.SaveToString(XMLDoc.FT_JSON)))}var E=new IDArray();E.add_Value(new IDVariant("Accept: application/json"));F.set_Object(new IDVariant("ID_HEADERS"),E);if(!this.AddAuthorizationHeader(E)){return 0}var m=new IDVariant();var d=new IDVariant(O);var v=new IDVariant();var x=this.DoHttpRequest("CallAction",d.stringValue(),F,v);if(v.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction",J.TypeName()+": error while calling action: "+v);throw new Error(v.stringValue())}if(z.length==0){return 0}else{r=x.GetRootNode();if(z.length<=2){var C="";if(this.ServiceType==IOTConnector.SERTYPE_ODATA){C=r.GetAttribute("value")}var w=new DOMDProp();w.DataType=parseInt(z);return this.StringToVariant(C,w)}else{if(N){var q=new IDCollection();var G=this.LoadCollectionFromJSON(B,q,r,0);if(G==-1){G=this.GetCollectionCount("CallAction",d.stringValue(),E,F,v);if(v.stringValue().length>0){this.MainFrm.getDTTObj().AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"IOTConnector.CallAction",B.TypeName()+": error while get collection count: "+v);throw new Error(v.stringValue())}}var o=(q.MaxRows==0?G:Math.min(q.MaxRows,G));if(this.ServiceType==IOTConnector.SERTYPE_ODATA&&o>q.Count()){F.set_Object(new IDVariant("ID_HEADERS"),E);q.ODataLoadInfo=new IDMap();q.ODataLoadInfo.set_Value(new IDVariant("url"),new IDVariant(d));q.ODataLoadInfo.set_Value(new IDVariant("action"),new IDVariant("CallAction"));q.ODataLoadInfo.set_Value(new IDVariant("pageSize"),new IDVariant(q.Count()));q.ODataLoadInfo.set_Value(new IDVariant("childLevel"),new IDVariant(0));q.ODataLoadInfo.set_Object(new IDVariant("args"),F);q.SetSize(o,B)}return q}else{r.SetAttribute(XMLDoc.JSON_IGNORENAME,"1");MDOInit.LoadXMLNode(B,r.GetNode(),true);return B}}}};IOTConnector.prototype.AddAuthorizationHeader=function(a){if(this.AuthenticationRequired()){if(!this.IsAuthenticated()){return false}a.add_Value(new IDVariant("Authorization: Bearer "+this.AccessToken))}else{if(this.Username.length>0){a.add_Value(new IDVariant("Authorization: Basic "+IDL.Base64Encode(this.Username+":"+this.Password)))}}return true};IOTConnector.prototype.BeforeOAuthRequestCode=function(a,b){};IOTConnector.prototype.AfterOAuthRequestCode=function(a,b){};IOTConnector.prototype.BeforeOAuthRequestToken=function(a,b){};IOTConnector.prototype.AfterOAuthRequestToken=function(b,a,c){};IOTConnector.prototype.BeforeLoad=function(c,b,a,d){};IOTConnector.prototype.BeforeLoadCollection=function(f,e,b,d,a,c){};IOTConnector.prototype.BeforeSave=function(f,e,d,g,a,b,c){};IOTConnector.prototype.OnGetValueSource=function(d,c,e,a,b){};IOTConnector.prototype.OnGetLKE=function(e,f,h,b,a,g,c,j,d){};function MDOInit(){}MDOInit.DOERR_PROPNOTFOUND=-100000;MDOInit.DOERR_COLLNOTFOUND=-100001;MDOInit.DOERR_NODBCONN=-100002;MDOInit.DOERR_OBJNOTDEF=-100003;MDOInit.DOERR_OBJNOTFOUND=-100004;MDOInit.DOERR_OBJMULDEF=-100005;MDOInit.DOERR_NOCLASS=-100006;MDOInit.DOERR_NOSERV=-100100;MDOInit.DOERR_NOFRM=-100101;MDOInit.DOERR_NOHLP=-100102;MDOInit.DOERR_BADDOM=-100103;MDOInit.DOERR_NOLOCK=-100201;MDOInit.SERV_DOCID=1;MDOInit.SERV_EXTSCHEMA=2;MDOInit.SERV_ATTACH=4;MDOInit.SERV_COMMENT=8;MDOInit.SERV_DOMAIN=16;MDOInit.SERV_USERINFO=32;MDOInit.SERV_LOCKING=64;MDOInit.SERV_LDELETE=128;MDOInit.SERV_FACTORY=256;MDOInit.SERV_SYNC=512;MDOInit.SERV_WEBAPI=1024;MDOInit.MAX_LKE_ROWS=30;MDOInit.MAX_COLL_ROWS=500;MDOInit.QRY_LOADFROMDB=1;MDOInit.QRY_LOADCOLLECTION=2;MDOInit.QRY_LOADCOLLECTIONBE=3;MDOInit.QRY_INSERT=4;MDOInit.QRY_UPDATE=5;MDOInit.QRY_DELETE=6;MDOInit.QRY_LOADVALUESOURCE=7;MDOInit.QRY_LOADSMARTLOOKUP=8;MDOInit.QRY_LOADVALUELIST=9;MDOInit.GetDTT=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.getDTTObj()}return null};MDOInit.GetRTC=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.getRTCObj()}return null};MDOInit.GetSyncObj=function(b){var a=b.GetMainFrm();if(a!=null&&a instanceof WebEntryPointSrv){return a.SyncObject}return null};MDOInit.SetOriginal=function(f,a){var g=f.GetMD();f.ResetOrigValues();f.set_OldParent(f.Parent());f.set_OldParentCollection(f.ParentCollection());f.set_Updated(false);f.set_Inserted(false);if(a>0){for(var e=1;e<=g.GetNumColl();e++){var k=f.GetCollByIndex(e);var c=k.GetCollection();for(var b=0;b<c.length;b++){var h=c[b];h.SetOriginal(a-1)}f.GetCollByIndex(e).PurgeDeleted()}}};MDOInit.RestoreOriginal=function(f,b){f.StopEvents();var j=f.GetMD();for(var c=1;c<=j.GetNumProp();c++){if(!f.GetPropOrigValue(c).equals(f.GetPropByIndex(c))){f.SetUIModified();f.SetPropDirect(c,f.GetPropOrigValue(c))}}f.ResetOrigValues();if(f.OldParentCollection()!=null&&f.OldParentCollection()!=f.ParentCollection()){try{f.OldParentCollection().Add(f)}catch(h){}}f.set_Updated(false);if(f.Inserted()){f.set_Deleted(true)}else{f.set_Deleted(false)}f.set_Inserted(false);if(b>0){for(var c=1;c<=j.GetNumColl();c++){var a=new ArrayList(f.GetCollByIndex(c).GetCollection());for(var g=0;g<a.Count();g++){var k=a[g];k.RestoreOriginal(b-1)}f.GetCollByIndex(c).PurgeDeleted()}}f.ClearErrors();f.StartEvents()};MDOInit.LoadFromDB=function(g,J){if(g.Inserted()){if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.LoadFromDB",g.GetName(1)+": cannot load an inserted document")}return}var D=g.GetMD();var l=g.GetRemote();if(l!=null){}var b=g.GetServiceConnector();if(b!=null){b.LoadFromDB(g,J);return}var x=new IDVariant();g.BeforeLoad(x);if(x.isTrue()){return}if(!g.Loaded()){var a=MDOInit.GetDOBase(D);var w=D.DBObj;if(w==null){w=g.GetDBObj()}var E=new ArrayList();var H="";var m=new IDVariant();var d=new Array(Glb.SQL_MAXQUERIES);var h="";for(var C=0;C<Glb.SQL_MAXQUERIES;C++){d[C]=""}g.GetMasterQuery(d,m,E);if(m.stringValue().length>0){H=m.stringValue()+"."}var A="";var t=true;var y=0;for(var C=1;C<=D.GetNumProp();C++){var K=D.GetProp(C);if(K.PK){y++;var q=g.GetPropByIndex(C);if(q.Type==IDVariant.NULL){t=false;break}var o=MDOInit.GetPropExpr(K,g,a);h+=A+"("+o+"="+Glb.ToSql(q,D.GetDBType(),w)+")";A=" and "}}if(y==0){t=false}if(!t){h="";A="";for(var C=1;C<=D.GetNumProp();C++){var K=D.GetProp(C);if(K.DBCode!=null&&K.DBCode.length>0){var q=g.GetPropByIndex(C);if(q.Type!=IDVariant.NULL){var o=MDOInit.GetPropExpr(K,g,a);h+=A+"("+o+"="+Glb.ToSql(q,D.GetDBType(),w)+")";A=" and ";t=true}}}}if(w!=null&&!t){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+D.ObjTag+" Nessun campo valorizzato")}var I;var p=false;var c="";if(d[0].length>0){I="";for(var C=0;C<Glb.SQL_MAXQUERIES;C++){if(C!=Glb.SQL_ORDERBY){I+=d[C]}if(C==Glb.SQL_ORDERBY&&c.length==0){c=d[C]}if(C==Glb.SQL_WHERE){if(h.length>0){if(d[C].length==0){I+=" where "}else{I+=" and "}I+=h}if(d[C].length>0||h.length>0){p=true}}}}else{I="select ";var B=0;for(var C=1;C<=D.GetNumProp();C++){var K=D.GetProp(C);if(K.DBCode!=null&&K.DBCode.length>0&&!MDOInit.UseRecord(K)){if(B>0){I+=", "}B++;I+=MDOInit.GetPropExpr(K,g,a)}}var F=new IDVariant(I);var L=MDOInit.GetFromList(g.GetMainFrm(),a,F);I=F.stringValue();if(L.length>0){if(h.length==0){h+=L}else{L+=" and ";h=L+h}}A=MDOInit.HandleServiceFilters(g);if(A.length>0){if(h.length==0){h+=A}else{h="("+h;h+=") and "+A}}if(h.length>0){I+=" where "+h;p=true}}var s=new IDVariant();g.OnSQLQuery(new IDVariant(I),new IDVariant(MDOInit.QRY_LOADFROMDB),s);if(s.stringValue().length>0){if(!p){I+=" where "}else{I+=" and "}I+=s;I+=" "}if(I.indexOf("order by")==-1){if(c.length>0){I+=c}}if(w!=null){if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddQuery("DO.LoadFromDB",g.GetName(1)+": loading","DO.LoadFromDB",DTTEngine.STMT_QRY_SELECT,I)}var f;try{f=w.OpenRS(I);if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddDBDataSource(f,I)}if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).EndQuery("DO.LoadFromDB")}g.AfterSQLQuery(new IDVariant(I),new IDVariant(MDOInit.QRY_LOADFROMDB),f,new IDVariant())}catch(G){g.AfterSQLQuery(new IDVariant(I),new IDVariant(MDOInit.QRY_LOADFROMDB),null,new IDVariant(G.toString()));if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadFromDB",g.GetName(1)+": DB error while loading document: "+G)}throw G}if(!f.EOF()){f.MoveFirst()}if(f.RecordCount()<=0){var r=false;if(g.GetMainFrm() instanceof WebEntryPointSrv){r=g.GetMainFrm().SyncObject.IsSynchronizing}if(r){return}else{throw new Error("ERR "+MDOInit.DOERR_OBJNOTFOUND+": "+D.ObjTag+" Object not found")}}if(f.RecordCount()>1){throw new Error("ERR "+MDOInit.DOERR_OBJMULDEF+": "+D.ObjTag+" Can not identify the object")}g.StopEvents();MDOInit.LoadDocProp(g,E,f)}else{if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.LoadFromDB",g.GetName(1)+" ("+D.ObjTag+"): not loaded because the class is not linked to a DB table")}}g.SetOriginal()}var u=g.LoadChildrenFromDB(J);if(!g.Loaded()){g.set_Loaded(true);g.AfterLoad(IDVariant.FALSE);g.MarkAsChanged();g.StartEvents()}else{if(u){g.AfterLoad(IDVariant.TRUE);g.MarkAsChanged()}}};MDOInit.LoadChildrenFromDB=function(d,b){var e=d.GetMD();var a=false;if(b>0){for(var c=1;c<=e.GetNumColl();c++){if(!e.GetColl(c).Transient){if(!d.GetCollByIndex(c).Loaded()){a=true}d.LoadCollectionFromDB(b,c)}}}return a};MDOInit.LoadCollectionFromDB=function(I,h,R){var S=I.GetCollByIndex(R);if(S.Parent()!=null&&S.Parent().Inserted()){if(MDOInit.GetDTT(S.Parent())!=null){MDOInit.GetDTT(S.Parent()).AddMsg(DTTEngine.DTTMSG_WARN,"",208,"DO.LoadCollectionFromDB",S.Parent().GetName(1)+": cannot load a collection belonging to an inserted document")}return}if(!S.Loaded()){S.Clear();var s=I.GetMD();var g=s.GetColl(R);var q=I.GetMD(g.ChildrenName);var m=q.DBObj;var B=I.CreateDocument(g.ChildrenName);var a=I.GetServiceConnector();if(a!=null){a.LoadCollectionFromDB(I,h,R);return}if(m==null){m=B.GetDBObj()}var t=new IDVariant();B.BeforeLoadCollection(I,S,t);if(t.isTrue()){return}var E=MDOInit.GetDOBase(q);var o=new ArrayList();var y="";var w=new IDVariant();var C=new Array(Glb.SQL_MAXQUERIES);var x="";var H=new IDVariant();I.GetValueSource(H,o,S,B);var f=H.stringValue();var b=false;if(H.stringValue().length==0){for(var L=0;L<Glb.SQL_MAXQUERIES;L++){C[L]=""}B.GetMasterQuery(C,w,o);if(w.stringValue().length>0){y=w.stringValue()+"."}var F=MDOInit.GetCollSort(B,S,q.GetDBType(),q,y);var J="";for(var L=1;L<=g.PKColl.Count();L++){var P=s.GetPropIndex(g.PKColl[L-1]);var N=q.GetPropIndex(g.FKColl[L-1]);var z=q.GetProp(N);var G=I.GetPropByIndex(P);if(G.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+s.ObjTag+" PK Non Definita")}x+=J+"("+MDOInit.GetPropExpr(z,B,E)+"="+Glb.ToSql(G,q.GetDBType(),m)+")";J=" and "}if(C[0].length>0){f="";for(var L=0;L<Glb.SQL_MAXQUERIES;L++){if(L!=Glb.SQL_ORDERBY){f+=C[L]}if(L==Glb.SQL_ORDERBY&&F.length==0){F=C[L]}if(L==Glb.SQL_WHERE){if(x.length>0){if(C[L].length==0){f+=" where "}else{f+=" and "}f+=x}if(x.length>0||C[L].length>0){b=true}}}}else{f="select ";var K=0;for(var L=1;L<=q.GetNumProp();L++){var z=q.GetProp(L);if(z.DBCode!=null&&z.DBCode.length>0&&!MDOInit.UseRecord(z)){if(K>0){f+=", "}K++;f+=MDOInit.GetPropExpr(z,B,E)}}var l=new IDVariant(f);var p=MDOInit.GetFromList(I.GetMainFrm(),E,l);f=l.stringValue();if(p.length>0){if(x.length==0){x+=p}else{p+=" and ";x=p+x}}J=MDOInit.HandleServiceFilters(B);if(J.length>0){if(x.length==0){x+=J}else{x="("+x+") and "+J}}if(x.length>0){f+=" where "+x;b=true}}var A=new IDVariant();B.OnSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),A);if(A.stringValue().length>0){if(!b){f+=" where "}else{f+=" and "}f+=A;f+=" "}if(f.indexOf("order by")==-1){if(F.length>0){f+=F}else{f+=MDOInit.GetNaturalSort(B,y)}}}if(m!=null){if(S.MaxRows>0){m.MaxRows=S.MaxRows+1}if(MDOInit.GetDTT(I)!=null){MDOInit.GetDTT(I).AddQuery("DODB",I.TypeName()+": loading "+g.ChildrenName,"DO.LoadCollectionFromDB",DTTEngine.STMT_QRY_SELECT,f)}var r;try{r=m.OpenRS(f);if(MDOInit.GetDTT(I)!=null){MDOInit.GetDTT(I).AddDBDataSource(r,f)}if(MDOInit.GetDTT(I)!=null){MDOInit.GetDTT(I).EndQuery("DODB")}B.AfterSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),r,new IDVariant())}catch(O){B.AfterSQLQuery(new IDVariant(f),new IDVariant(MDOInit.QRY_LOADCOLLECTION),null,new IDVariant(O.toString()));if(MDOInit.GetDTT(I)!=null){MDOInit.GetDTT(I).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadCollectionFromDB",I.TypeName()+": DB error while loading "+g.ChildrenName+": "+O)}throw O}var M=0;if(S.Parent()!=null){S.Parent().StopEvents()}if(!r.EOF()){r.MoveFirst()}while(!r.EOF()){var Q=I.CreateDocument(g.ChildrenName);S.Add(Q);Q.StopEvents();MDOInit.LoadDocProp(Q,o,r);Q.SetOriginal();if(h>0){Q.LoadChildrenFromDB(h-1)}Q.set_Loaded(true);Q.AfterLoad(IDVariant.FALSE);Q.MarkAsChanged();Q.StartEvents();r.MoveNext();M++;if(M==S.MaxRows){break}}S.set_Loaded(true);S.HasMoreElements=(r.RecordCount()>S.MaxRows)&&(S.MaxRows>0);if(S.Parent()!=null){S.Parent().StartEvents()}}}else{if(h>0){var u=S.GetCollection();for(var D=0;D<u.Count();D++){var Q=u[D];if(!Q.Inserted()){Q.LoadFromDB(h-1)}}}}};MDOInit.GetCollSort=function(k,g,m,e,d){var b="";var l=MDOInit.GetDOBase(e);for(var h=1;h<=16;h++){var f=g.GetSortCriteria(h);if(f!=0){var a=e.GetProp(Math.abs(f));var c=MDOInit.GetPropExpr(a,k,l);if(c.length>0){if(b.length==0){b=" order by "}else{b+=", "}b+=c;if(f<0){b+=" desc"}}}}return b};MDOInit.LoadCollectionDirect=function(f,h,d,b){var g=f.GetMD();for(var e=1;e<=g.GetNumColl();e++){if(f.GetCollByIndex(e)==h){if(!b||!g.GetColl(e).Transient){var a=h.Loaded();MDOInit.LoadCollectionFromDB(f,d,e);if(h.Loaded()&&!a&&h.Parent()!=null&&!h.Parent().FreezeEvents()){h.Parent().AfterLoad(IDVariant.TRUE);h.Parent().MarkAsChanged()}}break}}};MDOInit.LoadCollectionRS=function(e,a,c,b){var g=e.GetMD();a.set_MainFrm(e.GetMainFrm());a.set_imdb(e.GetIMDB());if(!c.EOF()){c.MoveFirst()}try{while(!c.EOF()){var h=e.CreateDocument(e.TypeName());h.StopEvents();h.Init();h.set_Inserted(false);a.Add(h);MDOInit.LoadDocProp(h,null,c);h.SetOriginal();h.LoadChildrenFromDB(b-1);h.set_Loaded(true);h.AfterLoad(IDVariant.FALSE);h.MarkAsChanged();h.StartEvents();c.MoveNext()}a.set_Loaded(true)}catch(f){WriteToConsoleError(f)}};MDOInit.LoadCollectionBE=function(O,r,g,f,U,m){var d=O.GetMD();var a=O.GetServiceConnector();if(a!=null){return a.LoadCollectionBE(O,r,g,f)}r.set_MainFrm(O.GetMainFrm());r.set_imdb(O.GetIMDB());var y=new IDVariant();O.BeforeLoadCollection(null,r,y);if(y.isTrue()){return r.Count()}var l=d.DBObj;if(l==null){l=O.GetDBObj()}var H=MDOInit.GetDOBase(d);var o=new ArrayList();var B="";var z=new IDVariant();var F=new Array(Glb.SQL_MAXQUERIES);var A="";for(var S=0;S<Glb.SQL_MAXQUERIES;S++){F[S]=""}O.GetMasterQuery(F,z,o);if(z.stringValue().length>0){B=z.stringValue()+"."}var I=MDOInit.GetCollSort(O,r,d.GetDBType(),d,B);var P="";for(var S=1;S<=d.GetNumProp();S++){var C=d.GetProp(S);var J=MDOInit.GetPropExpr(C,O,H);if(J.length>0){var L=O.GetPropByIndex(S);if(g){var Q="";if("DO_ID".equals(C.Concept)){if(L.stringValue().length>0){var q=L.stringValue();if(q.length>0&&q.charAt(0)=="§"){q=q.substr(1)}if(q.equals(".")){Q="(not "+J+" is null)"}else{if(q.equals("!")){Q="("+J+" is null)"}else{if(q.charAt(0)=="#"&&q.length==21){Q="("+J+" <> "+Glb.ToSql(new IDVariant(q.substr(1)),d.GetDBType(),l)+")"}else{if(q.charAt(0)==">"&&q.length==21){Q="("+J+" > "+Glb.ToSql(new IDVariant(q.substr(1)),d.GetDBType(),l)+")"}else{if(q.charAt(0)==":"&&q.length==21){Q="("+J+" >= "+Glb.ToSql(new IDVariant(q.substr(1)),d.GetDBType(),l)+")"}else{if(q.indexOf(" ")==-1){Q="("+J+"="+Glb.ToSql(new IDVariant(q),d.GetDBType(),l)+")"}else{var E=q.split(" ");Q="("+J+" IN (";for(var G=0;G<E.length;G++){Q+=(G>0?",":"")+Glb.ToSql(new IDVariant(E[G]),d.GetDBType(),l)}Q+="))"}}}}}}}}else{var K=(O.GetMainFrm() instanceof WebEntryPointSrv?O.GetMainFrm():null);Q=MDOInit.GetQBEFilter(J,C.DataType,C.MaxLength,d.GetDBType(),L.stringValue(),C.Mask,l,K)}if(Q.length>0){A+=P+"("+Q+")";P=" and ";Q=""}}else{if(L.Type!=IDVariant.NULL){A+=P+"("+J+"="+Glb.ToSql(L,d.GetDBType(),l)+")";P=" and "}}}}var c;var b=false;if(F[0].length>0){c="";for(var S=0;S<Glb.SQL_MAXQUERIES;S++){if(m&&S==Glb.SQL_SELECT){c+="select count(*) "}else{if(S!=Glb.SQL_ORDERBY){c+=F[S]}}if(S==Glb.SQL_ORDERBY&&I.length==0&&!m){I=F[S]}if(S==Glb.SQL_WHERE){if(A.length>0){if(F[S].length==0){c+=" where "}else{c+=" and "}c+=A}if(A.length>0||F[S].length>0){b=true}}}}else{c="select ";if(m){c+="count(*) "}else{var R=0;for(var S=1;S<=d.GetNumProp();S++){var C=d.GetProp(S);if(C.DBCode!=null&&C.DBCode.length>0&&!MDOInit.UseRecord(C)){if(R>0){c+=", "}R++;c+=MDOInit.GetPropExpr(C,O,H)}}}var h=new IDVariant(c);var u=MDOInit.GetFromList(O.GetMainFrm(),H,h);c=h.stringValue();if(u.length>0){if(A.length==0){A+=u}else{u+=" and ";A.insert(0,u)}}P=MDOInit.HandleServiceFilters(O);if(P.length>0){if(A.length==0){A+=P}else{A="("+A+") and "+P}}if(A.length>0){c+=" where "+A;b=true}}if(U!=null&&U.length>0){if(!b){U=" where "+U+" "}else{U=" and "+U+" "}var N=c.indexOf("group by");if(N!=-1){c=c.insert(N,U)}else{c+=U}c+=" ";b=true}var D=new IDVariant();O.OnSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),D);if(D.stringValue().length>0){if(!b){c+=" where "}else{c+=" and "}var N=c.indexOf("group by");if(N!=-1){c=c.insert(N,D+" ")}else{c+=D+" "}}if(c.indexOf("order by")==-1&&!m){if(I.length==0){c+=MDOInit.GetNaturalSort(O,B)}else{c+=I}}if(l!=null){if(r.MaxRows>0){l.MaxRows=r.MaxRows+1}if(MDOInit.GetDTT(O)!=null){MDOInit.GetDTT(O).AddQuery("DODB",O.TypeName()+": Loading Collection By Example ","DO.LoadCollectionBE",DTTEngine.STMT_QRY_SELECT,c)}var x;try{x=l.OpenRS(c);if(MDOInit.GetDTT(O)!=null){MDOInit.GetDTT(O).AddDBDataSource(x,c)}if(MDOInit.GetDTT(O)!=null){MDOInit.GetDTT(O).EndQuery("DODB")}O.AfterSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),x,new IDVariant())}catch(V){O.AfterSQLQuery(new IDVariant(c),new IDVariant(MDOInit.QRY_LOADCOLLECTIONBE),null,new IDVariant(V.toString()));if(MDOInit.GetDTT(O)!=null){MDOInit.GetDTT(O).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.LoadCollectionBE",O.TypeName()+": DB error while loading collection: "+V)}throw V}if(m){if(!x.EOF()){x.MoveFirst();return x.Get(1).intValue()}else{return 0}}var T=0;if(!x.EOF()){x.MoveFirst()}try{while(!x.EOF()){var t=O.CreateDocument(O.TypeName());t.StopEvents();r.Add(t);MDOInit.LoadDocProp(t,o,x);t.SetOriginal();t.LoadChildrenFromDB(f-1);t.set_Loaded(true);t.AfterLoad(IDVariant.FALSE);t.MarkAsChanged();t.StartEvents();x.MoveNext();T++;if(T==r.MaxRows){break}}r.set_Loaded(true);r.HasMoreElements=(x.RecordCount()>r.MaxRows)&&(r.MaxRows>0)}catch(M){WriteToConsoleError(M);throw M}}else{if(MDOInit.GetDTT(O)!=null){MDOInit.GetDTT(O).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.LoadCollectionBE",O.GetName(1)+" ("+d.ObjTag+"): collection not loaded because the class is not linked to a DB table")}r.set_Loaded(true);r.HasMoreElements=false}return r.Count()};MDOInit.GetQBEClauses=function(f,A,d,e,l,p){var b="";var g="";var B=p.stringValue();var y=f.GetMD();var q=y.DBObj;if(q==null){q=f.GetDBObj(false)}var a=MDOInit.GetDOBase(y);var z=new ArrayList();var h=new IDVariant();var c=new Array(Glb.SQL_MAXQUERIES);for(var x=0;x<Glb.SQL_MAXQUERIES;x++){c[x]=""}f.GetMasterQuery(c,h,z);if(h.stringValue().length>0){B=h.stringValue()+"."}if(A!=null){b=MDOInit.GetCollSort(f,A,y.GetDBType(),y,B)}var t="";for(var x=1;x<=y.GetNumProp();x++){var C=y.GetProp(x);var u=MDOInit.GetPropExpr(C,f,a);if(u.length>0){var m=f.GetPropByIndex(x);if(d){var s="";if("DO_ID".equals(C.Concept)){if(m.stringValue().length>0){var r=m.stringValue();if(r.length>0&&r.charAt(0)=="§"){r=r.substr(1)}if(r.equals(".")){s="(not "+u+" is null)"}else{if(r.equals("!")){s="("+u+" is null)"}else{if(r.charAt(0)=="#"&&r.length==21){s="("+u+" <> "+Glb.ToSql(new IDVariant(r.substr(1)),y.GetDBType(),q)+")"}else{if(r.indexOf(" ")==-1){s="("+u+"="+Glb.ToSql(new IDVariant(r),y.GetDBType(),q)+")"}else{var D=r.split(" ");s="("+u+" IN (";for(var o=0;o<D.length;o++){s+=(o>0?",":"")+Glb.ToSql(new IDVariant(D[o]),y.GetDBType(),q)}s+="))"}}}}}}else{var j=(f.GetMainFrm() instanceof WebEntryPointSrv?f.GetMainFrm():null);s=MDOInit.GetQBEFilter(u,C.DataType,C.MaxLength,y.GetDBType(),m.stringValue(),C.Mask,q,j)}if(s.length>0){g+=t+"("+s+")";t=" and ";s=""}}else{if(m.Type!=IDVariant.NULL){g+=t+"("+u+"="+Glb.ToSql(m,y.GetDBType(),q)+")";t=" and "}}}}if(c[Glb.SQL_WHERE].length>0){if(g.length>0){g+=" and "}g+=c[Glb.SQL_WHERE].substr(6)}e.set(new IDVariant(g));if(c[Glb.SQL_ORDERBY].length>0){b=c[Glb.SQL_ORDERBY]}else{if(b.length==0){b=MDOInit.GetNaturalSort(f,B)}}l.set(new IDVariant(b));p.set(new IDVariant(B))};MDOInit.GetQBEFilter=function(j,A,m,D,B,I,o,q){var s="";var u="";var e=-1,c=-1;var h=true;if(B.length>0&&B.charAt(0)=="§"){B=B.substr(1);h=false}if(B.length==0){return""}var E=(q!=null&&q.ParamsObj().QBETrueLessThan);do{if(B.charAt(0)!="="){e=B.indexOf(";",e+1)}if(e>=0){u=B.substr(c+1,(e)-(c+1))}else{u=B.substr(c+1)}var l="";var r=new Array(2);r[0]="";r[1]="";if(u.length>0){if(u.charAt(0)==">"){if(E){l=j+" > ?"}else{l=j+" >= ?"}r[0]=u.substr(1);if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var F=IDL.ParsePartialDate(q,r[0],(E?1:0));if(F.Type!=IDVariant.NULL){l=j+" >= ?";r[0]=F.stringValue()}}}if(u.charAt(0)=="<"){if(E){l=j+" < ?"}else{l=j+" <= ?"}r[0]=u.substr(1);if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var F=IDL.ParsePartialDate(q,r[0],(E?0:1));if(F.Type!=IDVariant.NULL){l=j+" < ?";r[0]=F.stringValue()}}}if(u.charAt(0)=="."){l=j+" is not null"}if(u.charAt(0)=="!"){l=j+" is null"}if(u.charAt(0)=="#"){u=u.substr(1);if(h&&Glb.ClassDT(A)==Glb.DTC_CHAR){if(u.indexOf("*")==-1&&u.indexOf("%")==-1){u=u+"*"}u=u.replace(/\*/g,"%");var H=0;if(I!=null&&I.equals(">")){l="(";r[0]=u.toUpperCase()}else{if(I!=null&&I.equals("<")){l="(";r[0]=u.toLowerCase()}else{switch(Glb.ClassDB(D)){case Glb.DBC_ACCESS:l="lcase(";r[0]=u.toLowerCase();break;case Glb.DBC_DB2:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_POSTGRES:case Glb.DBC_SQLSRV:l="lower(";r[0]=u.toLowerCase();H=(o.Unicode?4000:8000);break;case Glb.DBC_ORACLE:l="lower(";r[0]=u.toLowerCase();H=2000;break;default:l="(";r[0]=u;break}if(H>0&&m>H){l="(";r[0]=u}}}l+=(j+") not like ?")}else{l=j+" <> ?";r[0]=u;if(A==Glb.DT_DATETIME||A==Glb.DT_DATE){var y=IDL.ParsePartialDate(q,r[0],0);var x=IDL.ParsePartialDate(q,r[0],1);if(y.Type!=IDVariant.NULL){l=j+" < ? or "+j+" >= ?";r[0]=y.stringValue();r[1]=x.stringValue()}}}}if(u.charAt(0)=="="){l=j+" = ?";r[0]=u.substr(1)}else{if(Glb.ClassDT(A)==Glb.DTC_CHAR&&u.charAt(u.length-1)=="&"){if(Glb.ClassDB(D)!=Glb.DBC_ACCESS&&Glb.ClassDB(D)!=Glb.DBC_ODBC&&Glb.ClassDB(D)!=Glb.DBC_POSTGRES){l="soundex("+j+") = soundex(?)";r[0]=u.substr(0,(u.length-1))}else{u=u.substr(0,(u.length-1))+"*"}}if(l.length==0){var t;t=u.indexOf(":");if(t>=0){var G=false;if(Glb.ClassDT(A)==Glb.DTC_DATE){G=true;var y=IDL.ParsePartialDate(q,u.substr(0,t),0);var x=IDL.ParsePartialDate(q,u.substr(t+1),1);var k=(y.Type!=IDVariant.NULL||x.Type!=IDVariant.NULL);if(u.indexOf("/")!=-1||u.indexOf("-")!=-1||k){var a;for(a=t+1;a<u.length;a++){if(u.charAt(a)==":"){t=a}else{if(u.charAt(a)=="/"||u.charAt(a)=="-"){break}}}if(a<=u.length){var g=u.substr(0,t);var f=u.substr(t+1);if(g.length>0&&f.length>0){if(y.Type==IDVariant.NULL&&x.Type==IDVariant.NULL){l=j+" between ? and ?";r[0]=g;r[1]=f}else{l=j+" >= ?";if(y.Type==IDVariant.NULL){r[0]=g}else{r[0]=y.stringValue()}if(x.Type==IDVariant.NULL){l+=" and "+j+" <= ?";r[1]=f}else{l+=" and "+j+" < ?";r[1]=x.stringValue()}}}else{if(g.length>0){l=j+" >= ?";if(y.Type==IDVariant.NULL){r[0]=g}else{r[0]=y.stringValue()}}else{if(f.length>0){if(x.Type==IDVariant.NULL){l=j+" <= ?";r[0]=f}else{l=j+" < ?";r[0]=x.stringValue()}}}}}}else{var v=new ArrayList();for(var a=0;a<u.length;a++){if(u.charAt(a)==":"){v.Add(a)}}if(v.Count()>2&&(v.Count()%2)==1){t=Math.floor(v[(v.Count()-1)/2]);var g=u.substr(0,t);var f=u.substr(t+1);if(g.length>0&&f.length>0){l=j+" between ? and ?";r[0]=g;r[1]=f}else{if(g.length>0){l=j+" >= ?";r[0]=g}else{if(f.length>0){l=j+" <= ?";r[0]=f}}}}}}if(!G){var g=u.substr(0,t);var f=u.substr(t+1);if(g.length>0&&f.length>0){l=j+" between ? and ?";r[0]=g;r[1]=f}else{if(g.length>0){l=j+" >= ?";r[0]=g}else{if(f.length>0){l=j+" <= ?";r[0]=f}}}}}}if(l.length==0){var C;C=u.indexOf(" ")>=0&&(u.indexOf(":")>=0||u.indexOf(".")>=0);var y=IDL.ParsePartialDate(q,u,0);var x=IDL.ParsePartialDate(q,u,1);if((A==Glb.DT_DATETIME||A==Glb.DT_DATE)&&y.Type!=IDVariant.NULL){l=j+" >= ? and "+j+" < ?";r[0]=y.stringValue();r[1]=x.stringValue()}else{if((A==Glb.DT_DATETIME&&!C)||(Glb.ClassDB(D)==Glb.DBC_SQLITE&&A==Glb.DT_DATE)){l=j+" between ? and ?";r[0]=u;r[1]=u+" 23:59:59"}else{if(h&&Glb.ClassDT(A)==Glb.DTC_CHAR){if(u.indexOf("*")==-1&&u.indexOf("%")==-1){u=u+"*"}u=u.replace(/\*/g,"%");var H=0;if(I!=null&&I.equals(">")){l="(";r[0]=u.toUpperCase()}else{if(I!=null&&I.equals("<")){l="(";r[0]=u.toLowerCase()}else{switch(Glb.ClassDB(D)){case Glb.DBC_ACCESS:l="lcase(";r[0]=u.toLowerCase();break;case Glb.DBC_DB2:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:case Glb.DBC_POSTGRES:case Glb.DBC_SQLSRV:l="lower(";r[0]=u.toLowerCase();H=(o.Unicode?4000:8000);break;case Glb.DBC_ORACLE:l="lower(";r[0]=u.toLowerCase();H=2000;break;default:l="(";r[0]=u;break}if(H>0&&m>H){l="(";r[0]=u}}}l+=(j+") like ?")}else{l=j+" = ?";r[0]=u}}}}}for(var b=0;b<r.length;b++){switch(Glb.ClassDT(A)){case Glb.DTC_CHAR:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_CHAR,o);break;case Glb.DTC_NUMBER:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_NUM,o);break;case Glb.DTC_DATE:switch(Glb.ClassDB(D)){case Glb.DBC_ACCESS:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_DAT1,o);break;case Glb.DBC_ORACLE:case Glb.DBC_POSTGRES:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_DAT3,o);break;case Glb.DBC_SQLITE:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_DAT4,o);break;default:r[b]=IDL.CSql(new IDVariant(r[b]),IDL.FMT_DAT2,o);break}break}var z=l.indexOf("?");if(z>=0){l=l.substr(0,z)+r[b]+l.substr(z+1)}}if(l.length>0){if(s.length>0){s=s+" or "}s=s+"("+l+")"}}c=e}while(e>=0);return s};MDOInit.IsModified=function(e,a){if(e.Updated()||e.Inserted()||e.Deleted()){return true}var g=e.GetMD();if(a>0){for(var b=1;b<=g.GetNumColl();b++){var j=e.GetCollByIndex(b).GetCollection();for(var f=0;f<j.Count();f++){var h=j[f];if(h.IsModified(a-1)){return true}}}}return false};MDOInit.DocIsDeleted=function(a){if(a.Deleted()){return true}else{if(a.Parent()!=null){return a.Parent().DocIsDeleted()}}return false};MDOInit.Clear=function(b){var c=b.GetMD();for(var a=1;a<=c.GetNumProp();a++){b.SetPropDirect(a,new IDVariant())}for(var a=1;a<=c.GetNumColl();a++){b.GetCollByIndex(a).Clear()}b.SetOriginal();b.set_Loaded(false);b.set_Inserted(false);b.set_Deleted(false);b.set_Updated(false);b.ClearErrors();b.OnClear()};MDOInit.Validate=function(o,k,l,e){o.ProcessChange(true);o.ClearErrors(true);o.LastFailedCheck=null;var p=new IDVariant();var m=new IDVariant();var a=new IDVariant(k);o.OnValidate(a,p,m);if(p.isTrue()){if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsg(DTTEngine.DTTMSG_WARN,"",204,"DO.Validate",o.GetName(1)+": invalidated by custom event")}if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsgToken("","ERR",MDOInit.GetDocErrors(o))}return false}if(m.isFalse()){if(!o.Deleted()){o.InternalValidate(k,p)}if(p.isTrue()){if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsg(DTTEngine.DTTMSG_WARN,"",205,"DO.Validate",o.GetName(1)+": internally invalidated")}if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsgToken("","ERR",MDOInit.GetDocErrors(o))}return false}if(o.HasErrors()){if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsg(DTTEngine.DTTMSG_WARN,"",205,"DO.Validate",o.GetName(1)+": document has errors")}if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsgToken("","ERR",MDOInit.GetDocErrors(o))}return false}}var b=o.GetMD();if(l>0){for(var g=1;g<=b.GetNumColl();g++){var j=o.GetCollByIndex(g).GetCollection();for(var f=0;f<j.Count();f++){var h=j[f];if(!h.Validate(k,l-1,false)){return false}}}}return true};MDOInit.LoadDocToSave=function(l,k,a,g){var h=l.Inserted()&&l.Deleted();k.Add(l);if(g>0){var b=l.GetMD();for(var e=1;e<=b.GetNumColl();e++){var o=l.GetCollByIndex(e);var c=o.GetCollection();for(var j=0;j<c.Count();j++){var f=c[j];var m=f.ParentCollection()!=o;if(m){a.Add(f)}else{if(h&&f.Inserted()){f.set_Deleted(true)}MDOInit.LoadDocToSave(f,k,a,g-1)}}}}};MDOInit.SaveToDB=function(d,a,f){var g=d.GetMD();var c=true;var b=false;MDOInit.ReconnectFK(d,a);if(f){if(!d.Validate(0,a)){if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsg(DTTEngine.DTTMSG_WARN,"",202,"DO.SaveToDB",d.GetName(1)+": error while validating document")}if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsgToken("","ERR",MDOInit.GetDocErrors(d))}return false}}var e=g.DBObj;if(e==null){e=d.GetDBObj()}if(e!=null&&e.TransCount==0){e.BeginTrans();b=true}MDOInit.SaveToDBTR=function(){var k=new ArrayList();var j=new ArrayList();MDOInit.LoadDocToSave(d,k,j,a);for(var h=0;h<j.Count();h++){var l=j[h];if(l.IsModified()){if(MDOInit.GetDTT(d)!=null){MDOInit.GetDTT(d).AddMsg(DTTEngine.DTTMSG_WARN,"",207,"DO.SaveToDB",l.GetName(1)+"</b> is a referenced document and won't be saved")}}}if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,0,e)){c=false;break}}}k=new ArrayList();j=new ArrayList();MDOInit.LoadDocToSave(d,k,j,a);if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,1,e)){c=false;break}}}if(c){for(var h=0;h<k.Count();h++){var l=k[h];if(!MDOInit.SaveDocToDB(l,2,e)){c=false;break}}}if(c){for(var h=k.Count()-1;h>=0;h--){var l=k[h];if(!MDOInit.SaveDocToDB(l,3,e)){c=false;break}}}if(c){c=MDOInit.AfterSaveDoc(d)}if(c){MDOInit.AfterSaveReset(d)}if(b){if(c){e.CommitTrans()}else{e.RollbackTrans()}}};if(e){e.ExecuteTrans(MDOInit.SaveToDBTR,self)}else{MDOInit.SaveToDBTR()}return c};MDOInit.AfterSaveDoc=function(l){var b=l.GetServiceConnector();if(b!=null){return true}try{var a=l.GetMD();if((a.Services&MDOInit.SERV_SYNC)!=0){var p=MDOInit.GetSyncObj(l);if(p!=null){p.AddVariation(l,false)}}var o=new IDVariant();l.AfterSave(o);if(o.isTrue()){return false}for(var g=1;g<=a.GetNumColl();g++){var m=l.GetCollByIndex(g);var k=m.GetCollection();for(var f=0;f<k.Count();f++){var j=k[f];if(j.ParentCollection()==m){if(!MDOInit.AfterSaveDoc(j)){return false}}}}return true}catch(h){if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",l.GetName(1)+": DB error after saving document: "+h)}l.AddDocError(h.toString());return false}};MDOInit.AfterSaveReset=function(e){var g=e.GetMD();for(var b=1;b<=g.GetNumColl();b++){var a=e.GetCollByIndex(b);var j=a.GetCollection();for(var f=0;f<j.Count();f++){var h=j[f];if(h.ParentCollection()==a){MDOInit.AfterSaveReset(h)}}}e.ClearErrors();if(e.Inserted()){e.set_Loaded(true);for(var b=1;b<=g.GetNumColl();b++){e.GetCollByIndex(b).set_Loaded(true)}}for(var b=1;b<=g.GetNumColl();b++){e.GetCollByIndex(b).PurgeDeleted()}e.SetOriginal(0);e.set_Inserted(false)};MDOInit.SaveDocToDB=function(T,ab,p){var c=T.GetServiceConnector();if(c!=null){return c.SaveDocToDB(T,ab)}var v=new IDVariant();var G=new IDVariant();var r=new IDVariant(ab);try{T.BeforeSave(v,G,r)}catch(Z){if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",T.GetName(1)+": exception in Before Save event: "+Z)}T.AddDocError(Z.toString());return false}if(G.isTrue()){return false}var J=MDOInit.GetDOBase(T.GetMD(),!T.Deleted());var b=false;if(T.GetMainFrm() instanceof WebEntryPointSrv){b=T.GetMainFrm().SyncObject.IsSynchronizing}var x=new IDVariant();for(var Y=0;Y<J.Count();Y++){var j=J[Y];var y="";var S=0;var l=j.DBCode;if(T.GetDBObj()!=p){l=j.DBSchema+l}var f=Glb.ClassDB(j.GetDBType())==Glb.DBC_ORACLE||j.GetDBType()==Glb.DBT_DB2400;var V=false;var L=false;var m=false;var aa=false;if((T.Updated()||T.Inserted()||T.Deleted())&&!(T.Deleted()&&T.Inserted())){if(v.isFalse()&&((ab==1&&T.Inserted()&&!T.Deleted())||(ab==2&&!T.Deleted()&&!T.Inserted())||(ab==3&&T.Deleted()&&!T.Inserted()))){if(T.GetMainFrm() instanceof WebEntryPointSrv){var M=T.GetMainFrm();if((j.Services&MDOInit.SERV_USERINFO)!=0&&!b){if(T.Inserted()){var X=T.GetPropertyIndex("DO_CREAUSER",false,true);var o=T.GetPropertyIndex("DO_CREATIME",false,true);var D=T.GetPropertyIndex("DO_AUTLEVEL",false,true);if(X>0){T.SetPropDirect(X,M.UserName())}if(o>0){T.SetPropDirect(o,IDL.Now())}if(D>0){T.SetPropDirect(D,new IDVariant(M.getRolObj().glbAutLevel))}}var Q=T.GetPropertyIndex("DO_LASTUSER",false,true);var d=T.GetPropertyIndex("DO_LASTTIME",false,true);if(Q>0){T.ChangePropDirect(Q,M.UserName(),true)}if(d>0){T.ChangePropDirect(d,IDL.Now(),true)}}}for(var W=1;W<=j.GetNumProp();W++){var E=j.GetProp(W);if(MDOInit.UseRecord(E)){if(E.RecordIdxProp==0){E.RecordIdxProp=T.GetPropertyIndex(E.TrFormat,false,false,true,false)}if(E.RecordIdxProp>0){T.ChangePropDirect(E.RecordIdxProp,Glb.GetTI(T.GetPropByIndex(E.RecordIdxProp),T.GetPropByIndex(W),E.Transformation,E.TrFormat,E.TrOffset,E.MaxLength),true)}}}var h="";if(T.Deleted()){h+="delete from "+l}else{if(T.Inserted()){h+="insert into "+l;var U=" (";for(var W=1;W<=j.GetNumProp();W++){var E=j.GetProp(W);if(E.DBCode!=null&&E.DBCode.length>0&&!MDOInit.UseRecord(E)){if(E.Counter&&W>j.BaseProps){if(IDL.IsNull(T.GetPropByIndex(W))||!b){aa=true}if(Glb.ClassDB(j.GetDBType())==Glb.DBC_SQLSRV&&!aa){m=true}S=W}if(W!=S||!aa||f){var K=null;if(W>j.BaseProps){K=E.DBCode}else{K=j.GetFieldConversion(W)}if(K!=null){if(E.DataType==Glb.DT_DOC_OLE){L|=(T.GetPropByIndex(W).Type!=IDVariant.NULL)}else{if((W!=S||!aa)&&T.GetPropByIndex(W).Type==IDVariant.NULL&&E.Nullable){continue}h+=U+K;U=", "}}}else{if(W<=j.BaseProps){if(E.PK){h+=U+j.GetFieldConversion(W);U=", "}}}}}h+=") values";U=" (";for(var W=1;W<=j.GetNumProp();W++){var I=W>j.BaseProps;if(!I){I=j.GetFieldConversion(W)!=null}if(I){var E=j.GetProp(W);if(E.DBCode!=null&&E.DBCode.length>0&&!MDOInit.UseRecord(E)){if(E.DataType!=Glb.DT_DOC_OLE){if(W!=S||!aa){if(T.GetPropByIndex(W).Type==IDVariant.NULL&&E.Nullable){continue}var A=Glb.GetTI(new IDVariant(),T.GetPropByIndex(W),E.Transformation,E.TrFormat,E.MaxLength,E.TrOffset);if(A.Type!=IDVariant.NULL&&(E.DataType==Glb.DT_NUM_FIXED||E.DataType==Glb.DT_NUM_CURRENCY)){A=IDL.Round(A,new IDVariant(E.vScale))}if(E.ExtPropIdx>0&&A.Type!=IDVariant.NULL){A.changeType(IDVariant.STRING)}h+=U+Glb.ToSql(A,j.GetDBType(),p);U=", "}else{if(f){if(Glb.ClassDB(j.GetDBType())==Glb.DBC_ORACLE){h+=U+j.SequenceCode+".nextval"}if(j.GetDBType()==Glb.DBT_DB2400){h+=U+"ZZ_NEXT('"+l.toUpperCase()+"')"}U=", "}else{if(W<=j.BaseProps){if(E.PK){h+=U+Glb.ToSql(x,j.GetDBType(),p);U=", "}}}}}}}}h+=")"}else{if(T.Updated()){h+="update "+l;var U=" set ";V=true;for(var W=j.BaseProps+1;W<=j.GetNumProp();W++){var E=j.GetProp(W);if(E.DBCode!=null&&E.DBCode.length>0&&!MDOInit.UseRecord(E)){var A=T.GetPropByIndex(W);var q=T.GetPropOrigValue(W);if(A.Type!=IDVariant.NULL&&(E.DataType==Glb.DT_NUM_FIXED||E.DataType==Glb.DT_NUM_CURRENCY)){A=IDL.Round(A,new IDVariant(E.vScale))}if(!A.equals(q)){var K=null;if(W>j.BaseProps){K=E.DBCode}else{K=j.GetFieldConversion(W)}if(K!=null){if(E.DataType==Glb.DT_DOC_OLE){L=true}else{A=Glb.GetTI(new IDVariant(),A,E.Transformation,E.TrFormat,E.MaxLength,E.TrOffset);if(E.ExtPropIdx>0&&A.Type!=IDVariant.NULL){A.changeType(IDVariant.STRING)}h+=U+K+"="+Glb.ToSql(A,j.GetDBType(),p);U=", ";V=false}}}}}}}}if((T.Deleted()||T.Updated())&&!T.Inserted()){var U=" where ";for(var W=1;W<=j.GetNumProp();W++){var E=j.GetProp(W);if(E.PK&&E.DBCode!=null&&E.DBCode.length>0&&!MDOInit.UseRecord(E)){var K=null;if(W>j.BaseProps){K=MDOInit.GetTIExpr("",E,true,j.GetDBType())}else{K=j.GetFieldConversion(W)}if(K!=null){var q=T.GetPropOrigValue(W);if(q.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+j.ObjTag+" PK Non Definita")}y+=U+K+"="+Glb.ToSql(q,j.GetDBType(),p);U=" and "}}}h+=y}if(p!=null&&j.DBCode!=null){if(!V){var P=0;switch(ab){case 1:P=MDOInit.QRY_INSERT;break;case 2:P=MDOInit.QRY_UPDATE;break;case 3:P=MDOInit.QRY_DELETE;break}try{try{T.OnSQLQuery(new IDVariant(h),new IDVariant(P),new IDVariant());if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).AddQuery("DO.SaveToDB",T.GetName(1)+": "+(ab==1?"Inserting":(ab==2?"Updating":"Deleting")),"DO.SaveToDB",DTTEngine.STMT_QRY_UPDATE,h)}if(m){p.Execute("set identity_insert "+l+" on")}p.Execute(h);T.AfterSQLQuery(new IDVariant(h),new IDVariant(P),null,new IDVariant())}catch(R){if((j.Services&MDOInit.SERV_LDELETE)!=0&&T.Deleted()){T.AfterSQLQuery(new IDVariant(h),new IDVariant(P),null,new IDVariant(R.toString()));var N=T.GetPropertyIndex("DO_LDELETE",false,true);if(N>0){var a=j.GetProp(N).DBCode;h="update "+l+" set "+a+" = 'S' "+y;if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).AddMsg(DTTEngine.DTTMSG_INFO,"",203,"DO.SaveToDB",T.GetName(1)+": logically deleting")}if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).AddMsgToken("","SQL",h)}T.OnSQLQuery(new IDVariant(h),new IDVariant(MDOInit.QRY_DELETE),new IDVariant());p.Execute(h);T.AfterSQLQuery(new IDVariant(h),new IDVariant(MDOInit.QRY_DELETE),null,new IDVariant())}}else{throw R}}if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).EndQuery("DO.SaveToDB")}if(S>j.BaseProps){var ad="";var O="";if(Glb.ClassDB(j.GetDBType())==Glb.DBC_ORACLE){ad=j.SequenceCode}else{ad=l;O=j.GetProp(S).DBCode}if(aa){x=Glb.GetLIV(p,j.GetDBType(),ad,O);T.SetPropByIndex(S,x);T.ReconnectChildren(9999)}else{if(Glb.ClassDB(j.GetDBType())==Glb.DBC_ORACLE){p.Execute("drop sequence "+j.SequenceCode);p.Execute("create sequence "+j.SequenceCode+" start with "+(T.GetPropByIndex(S).intValue()+1)+" nocache")}else{if(j.GetDBType()==Glb.DBT_DB2400){x=Glb.GetLIV(p,j.GetDBType(),l,j.GetProp(S).DBCode);if(!x.equals(T.GetPropByIndex(S))){p.Execute("update ZZ_SEQUENCE set ZZ_VAL = "+T.GetPropByIndex(S).intValue()+" where ZZ_SEQ = '"+l+"'")}}else{if(j.GetDBType()==Glb.DBT_DB2UDB){p.Execute("alter table "+l+" alter column "+j.GetProp(S).DBCode+" restart with "+(T.GetPropByIndex(S).intValue()+1))}else{if(Glb.ClassDB(j.GetDBType())==Glb.DBC_POSTGRES){p.Execute("alter sequence "+j.SequenceCode+"_seq restart with "+(T.GetPropByIndex(S).intValue()+1))}}}}}}if(T.Deleted()&&(j.Services&MDOInit.SERV_ATTACH)!=0&&ab==3){MDOInit.DeleteAttachments(T,9999)}if(T.Deleted()&&(j.Services&MDOInit.SERV_COMMENT)!=0&&ab==3){MDOInit.DeleteComments(T,9999)}}catch(Z){T.AfterSQLQuery(new IDVariant(h),new IDVariant(P),null,new IDVariant(Z.toString()));if(MDOInit.GetDTT(T)!=null){MDOInit.GetDTT(T).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.SaveToDB",T.GetName(1)+": DB error while saving document: "+Z)}if(!b){MDOInit.HandleSaveException(T,ab,Z,p)}else{T.AddDocError(Z.ToString())}return false}finally{if(m){p.Execute("set identity_insert "+l+" off")}}}if(L){var H="";var g=new HashTableSrv();y="";for(var W=1;W<=j.GetNumProp();W++){var E=j.GetProp(W);if(E.DBCode!=null&&E.DBCode.length>0&&!MDOInit.UseRecord(E)){var K=null;if(W>j.BaseProps){K=MDOInit.GetTIExpr("",E,true,j.GetDBType())}else{K=j.GetFieldConversion(W)}if(K!=null){if(E.PK||E.DataType==Glb.DT_DOC_OLE){H+=H.length==0?"select ":", ";H+=K;if(E.PK){var C;if(T.Inserted()){C=T.GetPropByIndex(W)}else{C=T.GetPropOrigValue(W)}if(C.Type==IDVariant.NULL){throw new Error("ERR "+MDOInit.DOERR_OBJNOTDEF+": "+j.ObjTag+" PK Non Definita")}y+=y.length==0?" where ":" and ";y+=K+"="+Glb.ToSql(C,j.GetDBType(),p)}else{g[W]=K}}}}}try{var u=p.OpenRS(H+" from "+l+y);u.setUpdatable();u.MoveFirst();var B=g.keys();for(var ac=0;ac<B.length;ac++){var F=B[ac];if(T.GetPropByIndex(F).Type==IDVariant.NULL){u.Set(g[F],T.GetPropByIndex(F))}else{u.updateBinaryStream(u.findColumn(g[F]),T.GetPropByIndex(F))}}u.setTableName(p.ApplySubstitutions(l));u.updateRow();u.acceptChanges(p)}catch(Z){throw Z}}}else{if(this.GetDTT(T)!=null){this.GetDTT(T).AddMsg(DTTEngine.DTTMSG_INFO,"",210,"DO.SaveToDB",T.GetName(1)+" ("+j.ObjTag+"): not saved because the class is not linked to a DB table")}}}}}return true};MDOInit.HandleSaveException=function(l,g,j,c){var b=l.GetMD();while(b!=null){for(var h=0;h<b.QueryList.Count();h++){var a=b.QueryList[h];if(!a.CanByApplied(l,g)){continue}var d=a.GetSQL(l,c);if(d==""){continue}if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddQuery("DO.HandleSaveException",l.GetName(1)+": handling save exception","DO.LoadFromDB",DTTEngine.STMT_QRY_SELECT,d)}try{var k=c.OpenRS(d);if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddDBDataSource(k,d)}if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).EndQuery("DO.HandleSaveException")}if((k.EOF()&&a.NeedRecord)||(!k.EOF()&&!a.NeedRecord)){a.ApplyTo(l,k,d);return}}catch(f){if(MDOInit.GetDTT(l)!=null){MDOInit.GetDTT(l).AddMsg(DTTEngine.DTTMSG_ERROR,"",201,"DO.HandleSaveException",l.GetName(1)+": DB error while checking document: "+f)}}}b=b.BaseMD}l.AddDocError(j.toString())};MDOInit.SaveToXML=function(Q,z,Z,t,L,f,U,b,I){if(U==undefined){U=false}if(b==undefined){b=XMLDoc.FT_XML}if(I==undefined){I=false}var l;var O;var y=false;if(L==null){y=true;L=new ProXMLDocument();MDOInit.ReconnectFK(Q,9999)}var q=Q.GetMD();var h=Q.GetServiceConnector();var B=new IDVariant(h==null?q.ObjTag:q.IOTCode);if(U&&q.RemoteType!=null&&q.RemoteType.indexOf(".")!=-1){B=new IDVariant(q.RemoteType.substr(q.RemoteType.indexOf(".")+1))}var E=new IDVariant(B);Q.OnSaveXMLObj(B,E);if(E.stringValue().length>0){if(b==XMLDoc.FT_JSON&&y){l=L.createElement(XMLDoc.ROOT_JSON)}else{l=L.createElement(E.stringValue())}if(y){L.appendChild(l)}else{f.appendChild(l)}if(h==null){l.setAttribute("do_updated",(I?(Q.Updated()?"-1":"0"):Q.Updated()+""));l.setAttribute("do_inserted",(I?(Q.Inserted()?"-1":"0"):Q.Inserted()+""));l.setAttribute("do_deleted",(I?(Q.Deleted()?"-1":"0"):Q.Deleted()+""));l.setAttribute("do_loaded",(I?(Q.Loaded()?"-1":"0"):Q.Loaded()+""))}else{if(h.ServiceType==IOTConnector.SERTYPE_ODATA){if(h.ODataVersion<=2){var p=L.createElement("__metadata");p.setAttribute("type",q.ODataNamespace+"."+q.IOTCode);l.appendChild(p)}else{if(h.ODataVersion==3){l.setAttribute("odata.type",q.ODataNamespace+"."+q.IOTCode)}else{if(h.ODataVersion==4){l.setAttribute("@odata.type",q.ODataNamespace+"."+q.IOTCode)}}}}}var F=true;var C=new HashTableSrv();for(var T=1;T<=q.GetNumProp();T++){var G=q.GetProp(T);var M=new IDVariant(Q.GetPropByIndex(T));if(M.Type!=IDVariant.NULL||h!=null){if(h!=null&&(h.ServiceType==IOTConnector.SERTYPE_SALESFORCE||h.ServiceType==IOTConnector.SERTYPE_ODATA)&&Q.Updated()&&Q.GetPropOrigValue(T).Equals(Q.GetPropDirect(T))){continue}B=new IDVariant(h==null?G.ObjTag:G.IOTCode);E=new IDVariant(B);var K=new IDVariant();Q.OnSaveXMLProp(B,E,M,K);if(E.stringValue().length>0){if(I){M=new IDVariant(MDOInit.VariantToString(Q.GetMainFrm(),M,G))}else{if(h!=null){M=new IDVariant(h.VariantToString(M,G))}}if(K.isTrue()){O=L.createElement(E.stringValue());O.appendChild(L.createTextNode(M.stringValue()));l.appendChild(O)}else{if(h!=null&&h.ServiceType==IOTConnector.SERTYPE_ODATA&&G.IOTCode.indexOf("/")!=-1){if(G.ODataType.equals("GeographyPoint")){if(G.IOTCode.endsWith("/Longitude")){var m=Q.GetPropByIndex(q.GetIOTCodeIndex(G.IOTCode.Replace("/Longitude","/Latitude")));var w=L.createElement("Location");l.appendChild(w);if(M.Type!=IDVariant.NULL&&m.Type!=IDVariant.NULL){w.setAttribute("type","Point");var g=L.createElement("coordinates");w.appendChild(g);var X=L.createTextNode(M.stringValue());g.appendChild(X);X=L.createTextNode(Q.GetPropByIndex(q.GetIOTCodeIndex(G.IOTCode.Replace("/Longitude","/Latitude"))).stringValue());g.appendChild(X);var o=L.createElement("crs");w.appendChild(o);o.setAttribute("type","name");var a=L.createElement("properties");o.appendChild(a);a.setAttribute("name","EPSG:4326")}}}else{if(!G.ODataType.equals("link")){var x=G.IOTCode.split("/");var P=l;for(var S=0;S<x.length-1;S++){var aa="";for(var R=0;R<=S;R++){aa+=(R==0?"":"/")+x[R]}var A=C[aa];if(A==null){A=L.createElement(x[S]);C[aa]=A;P.appendChild(A)}P=A}P.setAttribute(x[x.length-1],M.stringValue())}}}else{l.setAttribute(E.stringValue(),M.stringValue())}}if(U&&F){var r=new IDVariant(M);MDOInit.ConvertVariant(r,G);if(!r.equals(M)){F=false}}}}if(h==null){M=new IDVariant(Q.GetPropOrigValue(T));if(!M.equals(Q.GetPropDirect(T))){B=new IDVariant(G.ObjTag+"_O");E=new IDVariant(B);var K=new IDVariant();Q.OnSaveXMLProp(B,E,M,K);if(E.stringValue().length>0){if(I){M=new IDVariant(MDOInit.VariantToString(Q.GetMainFrm(),M,G))}if(K.isTrue()){O=L.createElement(E.stringValue());O.appendChild(L.createTextNode(M.stringValue()));l.appendChild(O)}else{l.setAttribute(E.stringValue(),M.stringValue())}}}}}if(!F){l.SetAttribute("do_conv","0")}var Y=false;var J=new ArrayList();do{Y=false;B=new IDVariant();E=new IDVariant();var K=new IDVariant();var M=new IDVariant();Q.OnSaveXMLProp(B,E,M,K);if(E.stringValue().length>0){Y=true;for(var D=0;D<J.Count();D++){var N=J[D];if(N.equals(E.stringValue())){Y=false;break}}if(Y){J.Add(E.stringValue());if(K.isTrue()){O=L.createElement(E.stringValue());O.appendChild(L.createTextNode(M.stringValue()));l.appendChild(O)}else{l.setAttribute(E.stringValue(),M.stringValue())}}}}while(Y);if(Q.HasErrors()){var V=new ArrayList();Q.GetDocErrors(V);if(V.Count()>0){O=L.createElement("Doc_Errors");l.appendChild(O);for(var T=0;T<V.Count();T++){O.setAttribute("Err"+(T+1).toString(),V[T])}}O=null;for(var T=1;T<=q.GetNumProp();T++){var G=q.GetProp(T);var H=Q.GetPropError(G.Index);if(H!=null){if(O==null){O=L.createElement("Prop_Errors");l.appendChild(O)}O.setAttribute("Err"+T.toString(),H)}}}if(t>0){for(var T=1;T<=q.GetNumColl();T++){var X=Q.GetCollByIndex(T).GetCollection();for(var D=0;D<X.Count();D++){var W=X[D];MDOInit.SaveToXML(W,z,Z,t-1,L,l,U,b,I);if(b==XMLDoc.FT_JSON){l.childNodes[l.childNodes.length-1].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}}}}}if(y){if(z){var u=Q.GetMainFrm();if((!Z||Z.length==0)&&u&&u instanceof WebEntryPointSrv){while(true){Z=u.RealPath+"/temp/"+q.ObjTag+"_"+Math.floor(Math.random()*2147483647)+(b==XMLDoc.FT_XML?".xml":".json");if(!VBFiles.FileExists(new IDVariant(Z))){break}}}L.Save(Z,b);return Z}else{return L.saveToString(b)}}return null};MDOInit.SaveCollectionToXML=function(m,e,c,b,j,k,f){if(k==undefined){k=XMLDoc.FT_XML}if(f==undefined){f=false}var l=new ProXMLDocument();var a=null;if(k==XMLDoc.FT_JSON){a=l.createElement(XMLDoc.ROOT_JSON)}else{a=l.createElement("IDCollection")}a.setAttribute("do_loaded",(f?(e.Loaded()?"-1":"0"):e.Loaded()+""));l.appendChild(a);e.MoveFirst();while(!e.IsEof()){var h=e.GetAt();MDOInit.SaveToXML(h,false,"",j,l,a,false,k,f);if(k==XMLDoc.FT_JSON){a.childNodes[a.childNodes.length-1].setAttribute(XMLDoc.JSON_ISARRAYCHILD,"1")}e.MoveNext()}if(c){var g=(m&&m.GetMainFrm()?m.GetMainFrm():e.MainFrm());if((!b||b.length==0)&&g&&g instanceof WebEntryPointSrv){while(true){b=g.RealPath+"/temp/IDCollection_"+Math.floor(Math.random()*2147483647)+(k==XMLDoc.FT_XML?".xml":".json");if(!VBFiles.FileExists(new IDVariant(b))){break}}}l.Save(b,k);return b}else{return l.saveToString(k)}};MDOInit.LoadFromXML=function(j,l,k,g,c){if(g==undefined){g=XMLDoc.FT_XML}if(c==undefined){c=false}try{var h=new ProXMLDocument();j.StopEvents();j.Clear();if(k){h.Load(l,g)}else{h.loadFromString(l,g)}var f=true;if(h.childNodes.length>0){for(var b=0;b<h.childNodes.length;b++){var a=h.childNodes[b];if(a instanceof ProXMLNode){break}}f=MDOInit.LoadXMLNode(j,a,true,c)}j.StartEvents();return f}catch(d){return false}};MDOInit.LoadXMLNode=function(l,k,I,F,g){if(F==undefined){F=false}if(g==undefined){g=""}var D=l.GetMD();var b=l.GetServiceConnector();var M=(b==null?D.ObjTag:D.IOTCode);var a=k.nodeName;if(a.equals(XMLDoc.ROOT_JSON)){a=M}else{if(k.getAttribute(XMLDoc.JSON_IGNORENAME)){k.removeAttribute(XMLDoc.JSON_IGNORENAME);a=M}else{if(g.length>0){a=M}}}var t=new IDVariant(a);var u;if(M.equals(a)&&I){u=new IDVariant(t)}else{u=new IDVariant()}if(u.stringValue().length==0){for(var C=1;C<=D.GetNumColl();C++){if(D.GetColl(C).ChildrenName.equals(a)){u=new IDVariant(t);break}}}var x=new IDVariant();l.OnLoadXMLObj(u,t,x);if(x.isTrue()){return false}var s=true;var q=u.stringValue();if(q.length>0){if(q.equals(M)&&I){if(b==null){var z=k.getAttribute("do_updated");if(z!=""){l.set_Updated(F?z=="-1":z.toLowerCase()=="true")}var f=k.getAttribute("do_inserted");if(f!=""){l.set_Inserted(F?f=="-1":f.toLowerCase()=="true")}var o=k.getAttribute("do_deleted");if(o!=""){l.set_Deleted(F?o=="-1":o.toLowerCase()=="true")}var m=k.getAttribute("do_loaded");if(m!=""){l.set_Loaded(F?m=="-1":m.toLowerCase()=="true")}var d=k.getAttribute("do_conv");if(d!=""&&d=="0"){s=false}}for(var C=0;C<k.attributes.length;C++){var h=k.attributes[C];a=h.nodeName;q="";if(g.length>0){a=g+"/"+a}if(h.nodeName.endsWith("_O")){a=a.substr(0,a.length-2)}for(var A=1;A<=D.GetNumProp();A++){var L=D.GetProp(A);if((b==null?L.ObjTag:L.IOTCode).equals(a)){q=a;break}}var p=new IDVariant(h.nodeValue);x=new IDVariant();u=new IDVariant(q);t=new IDVariant(a);l.OnLoadXMLProp(u,t,p,new IDVariant(),x);if(x.isTrue()){return false}q=u.stringValue();for(var A=1;A<=D.GetNumProp();A++){var L=D.GetProp(A);if((b==null?L.ObjTag:L.IOTCode).equals(q)){if(F){p=MDOInit.StringToVariant(l.GetMainFrm(),p.stringValue(),L);if(p.Type==IDVariant.NULL){if(!h.nodeName.endsWith("_O")&&k.attributes[q+"_O"]==null){l.SetPropOrigValue(A,new IDVariant(""))}}}else{if(b!=null){p=b.StringToVariant(p.stringValue(),L)}}if(s){MDOInit.ConvertVariant(p,L)}if(h.nodeName.endsWith("_O")){l.SetPropOrigValue(A,p)}else{l.SetPropDirect(A,p)}break}}}if(b!=null&&b.ServiceType==IOTConnector.SERTYPE_ODATA&&g.length>0){if(k.getAttribute("type").equals("Point")){for(var C=1;C<=D.GetNumProp();C++){var L=D.GetProp(C);if(L.ODataType.equals("GeographyPoint")){var B=new ArrayList();for(var A=0;A<k.childNodes.length;A++){var H=k.childNodes[A];if(H.nodeName.equals("coordinates")){B.Add(H.childNodes[0].data)}}var p=null;if(L.IOTCode.equals(g+"/Longitude")){p=new IDVariant(B[0])}else{if(L.IOTCode.equals(g+"/Latitude")){p=new IDVariant(B[1])}}l.SetPropDirect(C,p)}}return true}}for(var C=0;C<k.childNodes.length;C++){var w=false;var y=k.childNodes[C];if(y.childNodes.length>0){if(y.childNodes[0].nodeType==3||y.childNodes[0].nodeType==4){w=true;a=y.nodeName;q="";for(var A=1;A<=D.GetNumProp();A++){var L=D.GetProp(A);if((b==null?L.ObjTag:L.IOTCode).equals(a)){q=a;break}}var p=new IDVariant(y.childNodes[0].data);x=new IDVariant();u=new IDVariant(q);t=new IDVariant(a);l.OnLoadXMLProp(u,t,p,new IDVariant(),x);if(x.isTrue()){return false}q=u.stringValue();for(var A=1;A<=D.GetNumProp();A++){var L=D.GetProp(A);if((b==null?L.ObjTag:L.IOTCode).equals(q)){if(F){p=MDOInit.StringToVariant(l.GetMainFrm(),p.stringValue(),L);if(p.Type==IDVariant.NULL){l.SetPropOrigValue(A,new IDVariant(""))}}else{if(b!=null){p=b.StringToVariant(p.stringValue(),L)}}if(s){MDOInit.ConvertVariant(p,L)}l.SetPropDirect(A,p);break}}}}if(!w){var K=false;if(y.nodeName=="Doc_Errors"){for(var E=0;E<y.attributes.length;E++){l.AddDocError(y.attributes[E].nodeValue)}K=true}if(!K&&y.nodeName=="Prop_Errors"){for(var E=0;E<y.attributes.length;E++){l.SetPropError(parseInt(Attr.nodeName.substr(3),10),y.attributes[E].nodeValue)}K=true}if(!K&&l.GetServiceConnector()!=null){K=MDOInit.LoadXMLNode(l,y,I,F,(g.length>0?g+"/":"")+y.nodeName)}if(!K){var r=MDOInit.LoadXMLNode(l,y,false,F);if(!r){return false}}}}for(var C=1;C<=D.GetNumColl();C++){l.GetCollByIndex(C).EnableSort()}}else{for(var C=1;C<=D.GetNumColl();C++){if(D.GetColl(C).ChildrenName.equals(q)){var J=l.CreateDocument(q);try{var H=l.GetCollByIndex(C);H.Add(J);H.set_Loaded(true)}catch(G){}var r=MDOInit.LoadXMLNode(J,k,true,F);if(!r){return false}break}}}}return true};MDOInit.LoadCollectionFromXML=function(g,b,l,k,h,d){if(h==undefined){h=XMLDoc.FT_XML}if(d==undefined){d=false}try{var j=new ProXMLDocument();if(k){j.Load(l,h)}else{j.loadFromString(l,h)}if(j.childNodes.length>0){for(var c=0;c<j.childNodes.length;c++){var a=j.childNodes[c];if(a instanceof ProXMLNode){break}}return MDOInit.LoadCollXMLNode(g,b,a,d)}return true}catch(f){return false}};MDOInit.LoadCollXMLNode=function(h,b,a,g){if(g==undefined){g=false}var l=a.nodeName;if(l.equals(XMLDoc.ROOT_JSON)){l="IDCollection"}else{if(a.getAttribute(XMLDoc.JSON_IGNORENAME)){a.removeAttribute(XMLDoc.JSON_IGNORENAME);l="IDCollection"}}if(l.equals("IDCollection")){var e=a.getAttribute("do_loaded");if(e!=""){b.set_Loaded(g?e=="-1":e.toLowerCase()=="true")}for(var f=0;f<a.childNodes.length;f++){var k=a.childNodes[f];var j=h.CreateDocument(k.nodeName);MDOInit.LoadXMLNode(j,k,true,g);b.Add(j)}return true}else{return false}};MDOInit.ConvertVariant=function(a,b){if(a.Type==IDVariant.NULL){return true}switch(b.DataType){case Glb.DT_NUM_INTEGER:a.changeType(IDVariant.INTEGER);break;case Glb.DT_NUM_FLOAT:a.changeType(IDVariant.FLOAT);break;case Glb.DT_NUM_FIXED:case Glb.DT_NUM_CURRENCY:a.changeType(IDVariant.DECIMAL);break;case Glb.DT_CHAR:case Glb.DT_CHAR_FIXED:case Glb.DT_DOC_TEXT:a.changeType(IDVariant.STRING);break;case Glb.DT_DATE:case Glb.DT_TIME:case Glb.DT_DATETIME:a.changeType(IDVariant.DATETIME);break;case Glb.DT_BOOLEAN:a.changeType(IDVariant.INTEGER);break;case Glb.DT_DOC_OLE:a.changeType(IDVariant.BLOB);break}return a.Type!=IDVariant.NULL};MDOInit.VariantToString=function(a,b,c){switch(b.Type){case 0:return SyncService.NULL_Marker;case 3:if(c!=null&&c.DataType==Glb.DT_DATE){return IDL.FormatDate(b.dateValue(),"yyyy-mm-dd")}if(c!=null&&c.DataType==Glb.DT_TIME){return IDL.FormatDate(b.dateValue(),"hh:mm:ss")}return IDL.FormatDate(b.dateValue(),"yyyy-mm-dd hh:nn:ss");case 5:if(c!=null&&"DO_ID".equals(c.Concept)){return GUID.DocID2GUID(b.stringValue())}break;case 6:return Glb.SaveBlob(a,b,new IDVariant(),new IDVariant(),true).stringValue()}return b.stringValue()};MDOInit.StringToVariant=function(b,c,d,f){if(f==undefined){f=false}if(f&&(c.equals(".")||c.equals("!"))){return new IDVariant(c)}if(c.equals(SyncService.NULL_Marker)){return new IDVariant()}else{if(d.DataType==Glb.DT_DOC_OLE){return new IDVariant(Glb.LoadBlob(b,c))}else{if("DO_ID".equals(d.Concept)){if(f){var a=c.split(";");for(var e=0;e<a.length();e++){a[e]=GUID.GUID2DocID(a[e])}return new IDVariant(a.join(" "))}else{return new IDVariant(GUID.GUID2DocID(c))}}else{return new IDVariant(c)}}}};MDOInit.ReconnectFK=function(o,m){var e=o.GetMD();for(var h=1;h<=e.GetNumColl();h++){var b=e.GetColl(h);var l=o.GetCollByIndex(h);var a=l.GetCollection();for(var g=0;g<a.Count();g++){var k=a[g];for(var f=0;f<b.FKColl.Count();f++){k.SetPropByIndex(k.GetPropIndex(b.FKColl[f]),o.GetPropByIndex(o.GetPropIndex(b.PKColl[f])))}if(m>1){MDOInit.ReconnectFK(k,m-1)}}}};MDOInit.ToString=function(a){return a.GetName(3)};MDOInit.LoadLookupValues=function(m){var a=m.GetLookupCache();var c=m.GetMD();if(a!=null){for(var f=0;f<a.Count();f++){var j=a[f];var b=j.GetMD();if(b==c){var p=true;for(var g=1;g<=c.GetNumProp();g++){var l=m.GetPropByIndex(g);if(l.Type!=IDVariant.NULL||c.GetProp(g).PK){if(!l.equals(j.GetPropByIndex(g))){p=false;break}}}if(p){m.CopyFrom(j);m.SetOriginal();m.set_Loaded(j.Loaded());return}}}}var k=new IDVariant();var o=new IDVariant();m.BeforeLookup(k,o);if(o.isTrue()){return}if(k.isFalse()){try{m.LoadFromDB(0)}catch(h){}}m.AfterLookup();if(a!=null){var j=m.GetCopy();j.set_Loaded(m.Loaded());a.Add(j)}};MDOInit.CopyFrom=function(p,b,o){var f=p.GetMD();for(var h=1;h<=f.GetNumProp();h++){p.ChangePropDirect(h,new IDVariant(b.GetPropByIndex(h)),true)}p.set_Updated(b.Updated());p.set_Inserted(b.Inserted());p.set_Deleted(b.Deleted());if(o>0){for(var h=1;h<=f.GetNumColl();h++){var j=b.GetCollByIndex(h);var c=p.GetCollByIndex(h);c.Clear();var a=j.GetCollection();for(var g=0;g<a.Count();g++){var l=a[g];var m=p.CreateDocument(l.GetMD().ObjTag);try{c.Add(m)}catch(k){}m.CopyFrom(l,o-1)}}}};MDOInit.GetCopy=function(a){var b=a.GetMD();var c=a.CreateDocument(b.ObjTag);c.SetMainFrm(a.GetMainFrm(),a.GetIMDB());MDOInit.CopyFrom(c,a,9999);return c};MDOInit.LoadValueSource=function(f,e,g){var y=f.GetMD();var b=f.GetServiceConnector();if(b!=null){b.LoadValueSource(f,e,g);return}e.PrepareForValueSource();var t=new IDVariant();f.OnGetValueSource(e,t);if(t.isTrue()){if(!e.EOF()){e.MoveFirst()}return}var a=MDOInit.GetDOBase(y);var C="select ";var r=y.DBObj;if(r==null){r=f.GetDBObj()}for(var x=1;x<=y.GetNumProp();x++){var D=y.GetProp(x);if(D.PK){C+=MDOInit.GetPropExpr(D,f,a);if(String.compare(D.DBCode,D.ObjTag,true)!=0){C+=" as "+D.ObjTag}break}}for(var x=1;x<=y.GetNumProp();x++){var D=y.GetProp(x);var p=false;if(g!=null){for(var B=0;B<g.Count();B++){var u=g[B];if(String.compare(D.ObjTag,u,true)==0){p=true;break}}}else{p=D.DescribeRow}if(p){C+=", ";C+=MDOInit.GetPropExpr(D,f,a);if(String.compare(D.DBCode,D.ObjTag,true)!=0){C+=" as "+D.ObjTag}if(D.DescribeRow&&g==null){break}}}var l=false;var w=" where ";var c="";var z=new ArrayList();var h=new IDVariant();var d=new Array(Glb.SQL_MAXQUERIES);for(var x=0;x<Glb.SQL_MAXQUERIES;x++){d[x]=""}f.GetMasterQuery(d,h,z);if(d[0].length>0){C+=" ";for(var x=Glb.SQL_FROM;x<Glb.SQL_MAXQUERIES;x++){if(x==Glb.SQL_ORDERBY){c=d[x]}else{C+=d[x]}if(x==Glb.SQL_WHERE&&d[x].length>0){l=true;w=" and "}}}else{var A=new IDVariant(C);var E=MDOInit.GetFromList(f.GetMainFrm(),a,A);C=A.stringValue();if(E.length>0){C+=w;C+=E;l=true;w=" and "}}for(var x=1;x<=y.GetNumProp();x++){var D=y.GetProp(x);var m=f.GetPropByIndex(x);if(m.Type!=IDVariant.NULL){l=true;C+=w+MDOInit.GetPropExpr(D,f,a)+" = "+Glb.ToSql(m,y.GetDBType(),r);w=" and "}}if(d[0].length==0){var j=MDOInit.HandleServiceFilters(f);if(j.length>0){l=true;C+=w+j}}var o=new IDVariant();f.OnSQLQuery(new IDVariant(C),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),o);if(o.stringValue().length>0){if(!l){C+=" where "}else{C+=" and "}C+=o;C+=" "}if(C.indexOf("order by")==-1){if(c.length>0){C+=c}else{C+=MDOInit.GetNaturalSort(f,"")}}if(r!=null){try{var F=r.OpenRS(C);f.AfterSQLQuery(new IDVariant(C),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),F,new IDVariant());if(!F.EOF()){F.MoveFirst()}e.CopyFrom(F);if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).AddQuery("DOVS",f.GetName(1)+": loading value source","DO.LoadValueSource",DTTEngine.STMT_QRY_SELECT,C)}if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).AddDBDataSource(e,C)}if(MDOInit.GetDTT(f)!=null){MDOInit.GetDTT(f).EndQuery("DOVS")}}catch(q){f.AfterSQLQuery(new IDVariant(C),new IDVariant(MDOInit.QRY_LOADVALUESOURCE),null,new IDVariant(q.toString()));WriteToConsoleError(q)}}};MDOInit.AddValueSourceRow=function(b,a,c){b.AddValueSourceRow(a.Value,c.Value)};MDOInit.GetAutoLookupCode=function(b){var c=b.GetMD();for(var a=1;a<=c.GetNumProp();a++){if(c.GetProp(a).PK){return b.GetPropByIndex(a)}}return new IDVariant()};MDOInit.GetAutoLookupDescription=function(b){var d=b.GetMD();var c=new IDVariant();for(var a=1;a<=d.GetNumProp();a++){if(d.GetProp(a).DescribeRow){if(c.stringValue().length>0){c=IDL.Add(c,new IDVariant(" - "))}c=IDL.Add(c,b.GetPropByIndex(a))}}return c};MDOInit.SerializeDocument=function(c,b,a){return null};MDOInit.SerializeCollection=function(a,c,b){return null};MDOInit.DeserializeDocument=function(a,b,c){};MDOInit.DeserializeCollection=function(a,b,d,c){};MDOInit.GetLKE=function(o,p,m,d,l){var c=o.GetMD();var e=o.GetServiceConnector();if(e!=null){return e.GetLKE(o,p,m,d,l)}var g=c.DBObj;var f=new IDVariant();var r=new IDVariant();var j=-1;var a=null;do{j++;if(p.IsOpen()){p.Close()}o.OnGetLKE(p,new IDVariant(j),m,f,r,l);if(p.pQuery!=null){p.pQuery.LkeRSLimitedBySystem=false}if(r.isTrue()||p.RecordCount()>0){break}if(f.isFalse()){if(g==null){g=o.GetDBObj()}var b=(p.pQuery==null||p.pQuery.Parent.MainFrm.ParamsObj().LKEDOAllProperties?null:p.pQuery.HeaderColumns);var h=MDOInit.GetLKEQbe(o,j,m,c.GetDBType(),d,g,b);if(m.isFalse()&&!h.equals(a)&&h.length>0&&g!=null){if(p.IsOpen()){p.Close()}g.MaxRows=MDOInit.MAX_LKE_ROWS+1;if(p.pQuery!=null){p.pQuery.LkeRSLimitedBySystem=true}a=h;try{if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddQuery("DOLKE",o.GetName(1)+": Update LKE","Editable Lookup Query",DTTEngine.STMT_QRY_SELECT,h)}var k=g.OpenRS(h);if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddDBDataSource(k,h)}if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).EndQuery("DOLKE")}o.AfterSQLQuery(new IDVariant(h),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),k,new IDVariant());if(!k.EOF()){k.MoveFirst()}p.CopyFrom(k)}catch(q){o.AfterSQLQuery(new IDVariant(h.toString()),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),null,new IDVariant(q.toString()));WriteToConsoleError(q)}if(p.RecordCount()>0){break}}}if(j>100){if(MDOInit.GetDTT(o)!=null){MDOInit.GetDTT(o).AddMsg(DTTEngine.DTTMSG_ERROR,"",169,"DO.GetLKE",o.GetName(1)+": Too many Smart Lookup tries. Did you forget to set Cancel to TRUE?")}break}}while((j<5||f.isTrue())&&m.isFalse());return j};MDOInit.GetLKEQbe=function(h,F,k,H,f,p,z){var D=h.GetMD();var I="select ";var A="";var B=0;var a=MDOInit.GetDOBase(D);for(var C=1;C<=D.GetNumProp();C++){var K=D.GetProp(C);if(K.DBCode!=null&&K.DBCode.length>0&&K.DataType!=Glb.DT_DOC_OLE){var J=false;if(z!=null&&!K.PK&&!"DO_CODE".equals(K.Concept)){J=true;var w=z.keys();for(var e=0;e<w.length;e++){var M=w[e];if(String.compare(M,K.ObjTag,true)==0){J=false;break}}}if(J){continue}if(B>0){I+=", "}B++;I+=MDOInit.GetPropExpr(K,h,a);if(String.compare(K.DBCode,K.ObjTag,true)!=0){I+=" as "+K.ObjTag}}}var c="";var E=new ArrayList();var m=new IDVariant();var d=new Array(Glb.SQL_MAXQUERIES);for(var C=0;C<Glb.SQL_MAXQUERIES;C++){d[C]=""}h.GetMasterQuery(d,m,E);if(d[0].length>0){I+=" ";var q=false;for(var C=Glb.SQL_FROM;C<Glb.SQL_MAXQUERIES;C++){if(C==Glb.SQL_ORDERBY){c=d[C]}else{I+=d[C]}if(C==Glb.SQL_WHERE&&d[C].length>0){q=true}}I+=(!q?" where ":" and ")}else{var G=new IDVariant(I);var L=MDOInit.GetFromList(h.GetMainFrm(),a,G);I=G.stringValue();I+=" where ";if(L.length>0){I+=L;I+=" and "}}k.set(IDVariant.TRUE);if(f!=null){A="";for(var u=0;u<f.Count();u++){var y=f[u];var K=D.GetProp(y);var r=h.GetPropByIndex(y).stringValue();if(r.length>0){if(K.DBCode.length==0){return""}var l="";switch(Glb.ClassDT(K.DataType)){case Glb.DTC_CHAR:l=IDL.CSql(new IDVariant(r),IDL.FMT_CHAR,p);break;case Glb.DTC_DATE:var b=IDL.FMT_DAT2;if(Glb.ClassDB(H)==Glb.DBC_ACCESS){b=IDL.FMT_DAT1}else{if(Glb.ClassDB(H)==Glb.DBC_ORACLE||Glb.ClassDB(H)==Glb.DBC_POSTGRES){b=IDL.FMT_DAT3}else{if(Glb.ClassDB(H)==Glb.DBC_SQLITE){b=IDL.FMT_DAT4}}}l=IDL.CSql(new IDVariant(r),b,p);break;case Glb.DTC_NUMBER:l=IDL.CSql(new IDVariant(r),IDL.FMT_NUM,p);break}l=MDOInit.GetPropExpr(K,h,a)+" = "+l;if(A.length>0){A+=" and "}A+=l}}if(A.length>0){I+="("+A+") and ";A=""}}for(var C=1;C<=D.GetNumProp();C++){var r=h.GetPropByIndex(C).stringValue();var K=D.GetProp(C);var J=false;if(z!=null){J=true;var w=z.keys();for(var e=0;e<w.length;e++){var M=w[e];if(String.compare(M,K.ObjTag,true)==0){J=false;break}}}if(J){continue}for(var u=0;u<f.Count();u++){var y=f[u];if(y==C){r="";break}}if(K.DBCode.length==0&&r.length>0){r="";k.set(IDVariant.FALSE)}var g=false;if(r.length>0){k.set(IDVariant.FALSE);if(r.charAt(0)=="*"){r="%"+r.substr(1)}if(r.charAt(r.length-1)=="*"){r=r.substr(0,r.length-1)+"%"}if(r.charAt(0)!="%"&&r.charAt(r.length-1)!="%"){if(F==0){g=true}else{if(F==1){r+="%"}else{r="%"+r+"%"}}}var l=null;if(g){switch(Glb.ClassDT(K.DataType)){case Glb.DTC_CHAR:l=IDL.CSql(new IDVariant(r),IDL.FMT_CHAR,p);break;case Glb.DTC_DATE:var b=IDL.FMT_DAT2;if(Glb.ClassDB(H)==Glb.DBC_ACCESS){b=IDL.FMT_DAT1}else{if(Glb.ClassDB(H)==Glb.DBC_ORACLE||Glb.ClassDB(H)==Glb.DBC_POSTGRES){b=IDL.FMT_DAT3}else{if(Glb.ClassDB(H)==Glb.DBC_SQLITE){b=IDL.FMT_DAT4}}}l=IDL.CSql(new IDVariant(r),b,p);break;case Glb.DTC_NUMBER:l=IDL.CSql(new IDVariant(r),IDL.FMT_NUM,p);break}l=MDOInit.GetPropExpr(K,h,a)+" = "+l}else{var t;if(K.Mask!=null&&K.Mask.equals(">")){t=new IDVariant(r.toUpperCase());l="(("}else{if(K.Mask!=null&&K.Mask.equals("<")){t=new IDVariant(r.toLowerCase());l="(("}else{t=new IDVariant(r.toLowerCase());switch(Glb.ClassDB(H)){case Glb.DBC_ACCESS:l="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:l="lower((";break;case Glb.DBC_DB2:l="lower(char(";break;case Glb.DBC_SQLSRV:l="lower(convert("+(p.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:l="lower(to_char(";break;default:l="((";t=new IDVariant(r);break}}}l+=(MDOInit.GetPropExpr(K,h,a)+")) like "+IDL.CSql(t,IDL.FMT_CHAR,p))}if(A.length>0){if(F>2){A+=" or "}else{A+=" and "}}A+=l}}if(F>3){for(B=1;B<=D.GetNumProp();B++){var K=D.GetProp(B);var J=false;if(z!=null){J=true;var w=z.keys();for(var e=0;e<w.length;e++){var M=w[e];if(String.compare(M,K.ObjTag,true)==0){J=false;break}}}else{J=!(Glb.ClassDT(K.DataType)==Glb.DTC_CHAR&&K.MaxLength>4&&!K.PK&&!K.FK&&K.DBCode.length>0)}if(!J){var r=h.GetPropByIndex(B).stringValue();if(r.length==0){for(var C=1;C<=D.GetNumProp();C++){r=h.GetPropByIndex(C).stringValue();var x=D.GetProp(C);for(var u=0;u<f.Count();u++){var y=f[u];if(y==C){r="";break}}if(r.length>0){k.set(IDVariant.FALSE);if(r.charAt(0)=="*"){r="%"+r.substr(1)}if(r.charAt(r.length-1)=="*"){r=r.substr(0,r.length-1)+"%"}if(r.charAt(0)!="%"&&r.charAt(r.length-1)!="%"){if(F==1){r+="%"}else{r="%"+r+"%"}}var l=null;var t;if(x.Mask!=null&&x.Mask.equals(">")){t=new IDVariant(r.toUpperCase());l="(("}else{if(x.Mask!=null&&x.Mask.equals("<")){t=new IDVariant(r.toLowerCase());l="(("}else{t=new IDVariant(r.toLowerCase());switch(Glb.ClassDB(H)){case Glb.DBC_ACCESS:l="lcase(cstr('' & ";break;case Glb.DBC_POSTGRES:case Glb.DBC_MYSQL:case Glb.DBC_SQLITE:l="lower((";break;case Glb.DBC_DB2:l="lower(char(";break;case Glb.DBC_SQLSRV:l="lower(convert("+(p.Unicode?"nvarchar(4000)":"varchar(8000)")+", ";break;case Glb.DBC_ORACLE:l="lower(to_char(";break;default:l="((";t=new IDVariant(r);break}}}l+=(MDOInit.GetPropExpr(K,h,a)+")) like "+IDL.CSql(t,IDL.FMT_CHAR,p));if(A.length>0){if(F>2){A+=" or "}else{A+=" and "}}A+=l}}}}}}if(A.length==0){return""}else{I+="("+A+")";if(d[0].length==0){var o=MDOInit.HandleServiceFilters(h);if(o.length>0){I+=" and "+o}}var s=new IDVariant();h.OnSQLQuery(new IDVariant(I),new IDVariant(MDOInit.QRY_LOADSMARTLOOKUP),s);if(s.stringValue().length>0){I+=" and ";I+=s;I+=" "}if(I.indexOf("order by")==-1){if(c.length>0){I+=c}else{I+=MDOInit.GetNaturalSort(h,"")}}return I}};MDOInit.InternalValidate=function(g,t,A){var x=g.GetMD();var y=null;if(!g.Deleted()){for(var w=1;w<=x.GetNumProp();w++){var B=g.GetPropDOError(w);if(B!=null&&B.ErrType==IDDocument.ERR_ERROR){continue}var C=x.GetProp(w);var m=g.GetPropByIndex(w);if(m.Type==IDVariant.NULL){if(!C.Nullable&&!C.Counter){var l=true;var r=g.Parent();var h=g.ParentCollection();var o=C.ObjTag;while(r!=null&&h!=null&&l&&h.Parent()==r&&h.Index>0){var f=r.GetMD();var d=f.GetColl(h.Index);var b=false;for(var u=0;u<d.PKColl.Count();u++){var c=d.FKColl[u];var q=d.PKColl[u];if(c==o){b=true;var s=f.GetPropIndex(q);var a=f.GetProp(s);if(a.Counter){l=false}h=r.ParentCollection();r=r.Parent();o=q;break}}if(!b){break}}if(l){A.set(IDVariant.TRUE);y="E' necessario inserire un valore";var p=MDOInit.GetRTC(g);if(p!=null){y=p.GetConst("A61E8784-7812-44E2-9001-937ED881302F",y)}if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+C.UIName+" cannot be null")}g.SetPropError(w,y)}}}else{switch(Glb.ClassDT(C.DataType)){case Glb.DTC_CHAR:if(m.stringValue().length>C.MaxLength){A.set(IDVariant.TRUE);y="[|1] è troppo lungo; sono consentiti al massimo |2 caratteri";var k=m.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var p=MDOInit.GetRTC(g);if(p!=null){y=p.GetConst("0A52C2C4-2943-43C0-8254-7706B8E7E090",y)}y=IDL.FormatMessage(new IDVariant(y),new IDVariant(k),new IDVariant(C.MaxLength)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+C.UIName+" is too long")}g.SetPropError(w,y)}else{if(C.DataType==Glb.DT_CHAR_FIXED&&m.stringValue().length<C.MaxLength){g.SetPropDirect(w,IDL.FillLR(m,new IDVariant(C.MaxLength),new IDVariant(" "),false))}}break;case Glb.DTC_DATE:if(!IDL.IsDate(m)){A.set(IDVariant.TRUE);y="[|1] non è una data";var k=m.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var p=MDOInit.GetRTC(g);if(p!=null){y=p.GetConst("D93EF94D-866A-4CC5-AE35-020FDD80C7D5",y)}y=IDL.FormatMessage(new IDVariant(y),new IDVariant(k)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+C.UIName+" is not a date value")}g.SetPropError(w,y)}break;case Glb.DTC_NUMBER:case Glb.DTC_BOOL:if(!IDL.IsNumber(m)){A.set(IDVariant.TRUE);y="[|1] non è un numero";var k=m.stringValue();if(k.length>40){k=k.substr(0,37)+"..."}var p=MDOInit.GetRTC(g);if(p!=null){y=p.GetConst("D435495C-D17A-46F0-A73E-FD231C22A9B4",y)}y=IDL.FormatMessage(new IDVariant(y),new IDVariant(k)).stringValue();if(MDOInit.GetDTT(g)!=null){MDOInit.GetDTT(g).AddMsg(DTTEngine.DTTMSG_WARN,"",206,"DO.InternalValidate",g.GetName(1)+": "+C.UIName+" is not a number value")}g.SetPropError(w,y)}break}}}}};MDOInit.GetNewDocID=function(){var a=new GUID();return new IDVariant(a.toAscii85())};MDOInit.GetDocID=function(b){var d=b.GetMD();if(d.DocIDIdx>0){return b.GetPropByIndex(d.DocIDIdx)}var c=b.TypeName();for(var a=1;a<=d.GetNumProp();a++){if(d.GetProp(a).PK){c+=":";c+=b.GetPropByIndex(a)}}return new IDVariant(c)};MDOInit.Init=function(d){var b=null;if(d.GetMainFrm() instanceof WebEntryPointSrv){b=d.GetMainFrm()}var e=d.GetMD();while(e!=null){if(e.DocIDIdx>0){d.SetPropDirect(e.DocIDIdx,MDOInit.GetNewDocID())}if((e.Services&MDOInit.SERV_DOMAIN)!=0&&b!=null){var a=d.GetPropertyIndex("DO_COMPANY",false,true);var c=d.GetPropertyIndex("DO_DOMAIN",false,true);if(a<1||c<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain properties")}d.SetPropDirect(a,new IDVariant(b.getRolObj().glbCompanyID));d.SetPropDirect(c,new IDVariant(b.getRolObj().glbDomainID))}e=e.BaseMD}d.SetOriginal();d.set_Inserted(true);d.OnInit()};MDOInit.Initialize=function(c){var d=c.GetMD();for(var b=1;b<=d.GetNumColl();b++){var a=c.GetCollByIndex(b);a.set_Parent(c);a.Index=b;a.set_Visible(d.GetColl(b).Visible);a.MaxRows=0}for(var b=1;b<=d.GetNumProp();b++){c.SetPropDirect(b,new IDVariant())}};MDOInit.Terminate=function(a){try{MDOInit.ReleaseLock(a,9999)}catch(b){}};MDOInit.GetName=function(d,g,c,b,e){var a=new IDVariant();a=MDOInit.GetAutoLookupDescription(d);if(g==1){var f=d.GetMD();a.set(new IDVariant(f.UIName+" "+a))}if(g==2){var f=d.GetMD();a.set(new IDVariant(f.UIName+" <span class='DO'>"+a+"</span>"))}d.OnGetName(a,new IDVariant(g),c,new IDVariant(b),new IDVariant(e));return a.stringValue()};MDOInit.GetTooltip=function(c,f,b,a,e){var d=new IDVariant();c.OnGetTooltip(d,new IDVariant(f),b,new IDVariant(a),new IDVariant(e));return d.stringValue()};MDOInit.GetIcon=function(e,c,d,b,f){var g=e.GetMD();var a=new IDVariant(g.ObjIcon);e.OnGetIcon(a,new IDVariant(c),d,new IDVariant(b),new IDVariant(f));return a.stringValue()};MDOInit.MayHaveChildren=function(d){var a=new IDVariant();var e=d.GetMD();for(var b=1;b<=e.GetNumColl();b++){var f=d.GetCollByIndex(b);if((f.Count()>0||(!d.Inserted()&&!f.Loaded()))&&f.Visible()){a.set(true);break}}d.OnMayHaveChildren(a);return a.isTrue()};MDOInit.Duplicate=function(u,t,b,j,o){var g=u.GetMD();var v=null;if(j){var k=u.CreateDocument(g.ObjTag);k.SetMainFrm(u.GetMainFrm(),u.GetIMDB());MDOInit.CopyFrom(k,u,t);if(b!=null){try{b.Add(k,u)}catch(q){}if(u.Parent()!=null){u.Parent().ReconnectChildren(9999)}}v=u;u=k;if(o){var p=-1,h=-1;for(var m=1;m<=g.GetNumProp();m++){if(g.GetProp(m).DescribeRow&&g.GetProp(m).MaxLength>h&&(g.GetProp(m).MaxLength>=u.GetPropByIndex(m).stringValue().length+8)){p=m;h=g.GetProp(m).MaxLength}}if(p>0){u.SetPropByIndex(p,IDL.Add(u.GetPropByIndex(p),new IDVariant(" (copia)")))}}}u.set_Inserted(true);if(g.DocIDIdx>0){u.SetPropByIndex(g.DocIDIdx,MDOInit.GetNewDocID())}u.OnDuplicate(v);for(var m=1;m<=g.GetNumColl();m++){var f=g.GetColl(m);var s=u.GetCollByIndex(m);var a=s.GetCollection();for(var l=0;l<a.Count();l++){var r=a[l];if(t>0){MDOInit.Duplicate(r,t-1,null,false,false)}}}return u};MDOInit.LoadChildren=function(d,c,h,a){if(h==undefined){h=""}if(a==undefined){a=9999}var g=null;if(h.length==0||h.equals(d.TypeName())){try{c.Add(d,null,true,false)}catch(f){}}if(a>0){g=d.GetMD();for(var b=1;b<=g.GetNumColl();b++){d.GetCollByIndex(b).LoadChildren(c,h,a-1)}}};MDOInit.StandardDrop=function(k,g,f,a,o){if(g.IsChildOf(k)){return null}var d=MDOInit.CanAdopt(g,k)!=null;var m=false;var l=null;if(g.Parent()!=null){m=MDOInit.CanAdopt(g.Parent(),k)!=null}if(!d&&!m){return null}var h=null;if(m&&(f||!d)){h=g.Parent();l=g}else{h=g}var b=null;if(o){b=k.Duplicate()}else{b=k}var c=MDOInit.CanAdopt(h,b);if(c!=null){try{c.Add(b,l,l==null)}catch(j){}}return b};MDOInit.CanAdopt=function(d,a){var e=d.GetMD();var b;for(var c=1;c<=e.GetNumColl();c++){b=e.GetColl(c);if(b.ChildrenName.equals(a.TypeName())){return d.GetCollByIndex(c)}}return null};MDOInit.GetPropertyIndex=function(l,f,m,k,c,a,j){var b=l.GetMD();for(var d=1;d<=b.GetNumProp();d++){var h=b.GetProp(d);if(f.equals(h.GUID)){return d}if(m&&f.equals(h.Name)){return d}if(k&&f.equals(h.Concept)){return d}if(a&&f.equals(h.ObjTag)){return d}if(c&&f.equals(h.DBCode)){return d}if(j&&f.equals(h.IOTCode)){return d}if(h.ExtPropIdx>0&&(b.Services&MDOInit.SERV_EXTSCHEMA)!=0){try{h=l.GetExtProp(h.ExtPropIdx)}catch(g){WriteToConsoleError(g)}if(h!=null){if(f.equals(h.GUID)){return d}if(m&&f.equals(h.Name)){return d}if(k&&f.equals(h.Concept)){return d}if(a&&f.equals(h.ObjTag)){return d}if(c&&f.equals(h.DBCode)){return d}}}}return 0};MDOInit.GetExtProp=function(a,c){var b=a.GetExtSchema();if(b!=null&&c>0&&c<=b.GetNumProp()){return b.GetProp(c)}return null};MDOInit.GetExtSchema=function(a){var d=a.GetMD();var c=new IDVariant(d.ObjTag);a.GetSchemaName(c);var b=null;var f=c.stringValue();var e=a.GetSchemaCache();if(e.containsKey(f)){b=e[f]}else{b=MDOInit.LoadSchema(a,c);e[f]=b}return b};MDOInit.LoadSchema=function(h,k){var u=h.GetMD();var o=u.DBObj;if(o==null){o=h.GetDBObj()}if(o==null){throw new Error("ERR "+MDOInit.DOERR_NODBCONN+": "+u.ObjTag+" Non connesso al DB")}try{WriteToConsoleOutput("Loading schema "+k);var x="select * from DO_SCHEME where DO_CODE = "+IDL.Quote(k);var f=o.OpenRS(x);if(f.RecordCount()!=1){return null}f.MoveFirst();var l=new DOMDObj();l.ObjTag=k.stringValue();l.UIName=f.Get("DO_DESCRIPTION").stringValue();x="select * from DO_PROPSCHEME where DO_SCHEMAID = "+IDL.Quote(f.Get("DO_SCHEMAID"))+" order by DO_SEQ";var y=o.OpenRS(x);l.SetNumProp(y.RecordCount());if(!y.EOF()){y.MoveFirst()}var t=0;while(!y.EOF()){var a=new DOMDProp();t++;l.SetProp(t,a);a.ObjTag=y.Get("DO_CODE").stringValue();a.Name=y.Get("DO_CODE").stringValue();a.UIName=y.Get("DO_DESCRIPTION").stringValue();a.Concept=y.Get("DO_CONCEPT").stringValue();a.MaxLength=y.Get("DO_MAXLEN").intValue();a.Mask=y.Get("DO_MASK").stringValue();a.IDList=y.Get("DO_LISTID").stringValue();a.DTString=y.Get("DO_DATATYPE").stringValue();a.DataType=Glb.DT_CHAR;if(a.DTString.equals("NM")){a.DataType=Glb.DT_NUM_CURRENCY}if(a.DTString.equals("DT")){a.DataType=Glb.DT_DATETIME}try{a.Nullable=y.Get("DO_NULLABLE").stringValue().equals("Y");a.ReadOnly=y.Get("DO_READONLY").stringValue().equals("Y");a.Lookup=y.Get("DO_LOOKUP").stringValue();var q=y.Get("DO_LNKDOC").stringValue();if(q.length>0){var w=h.CreateDocument(q);if(w!=null){var g=-1;var c=w.GetMD();for(var r=1;r<=c.GetNumProp();r++){var p=c.GetProp(r);if(p.PK){if(g==-1){g=r}else{g=-1;break}}}if(g>-1){var b=new DOMDLinkedDoc(q,1);b.SetLinkedProp(0,t,g);a.LinkedDoc=b}}}}catch(v){}y.MoveNext()}return l}catch(m){WriteToConsoleError(m);return null}};MDOInit.SetLoaded=function(j,g,h){j.set_Loaded(h);if(g>0){var b=j.GetMD();for(var c=1;c<=b.GetNumColl();c++){var f=j.GetCollByIndex(c);f.set_Loaded(h);var a=f.GetCollection();for(var k=0;k<a.Count();k++){var e=a[k];e.SetLoaded(g-1,h)}}}};MDOInit.SetInserted=function(j,g,h){j.set_Inserted(h);if(g>0){var b=j.GetMD();for(var c=1;c<=b.GetNumColl();c++){var f=j.GetCollByIndex(c);var a=f.GetCollection();for(var k=0;k<a.Count();k++){var e=a[k];e.SetInserted(g-1,h)}}}};MDOInit.GetNaturalSort=function(c,f){var e=c.GetMD();var b=0;var a=0;var d="";while(a<4){switch(a){case 0:d="DO_SEQUENCE";break;case 1:d="DO_CODE";break;case 2:d="DO_DATE";break;case 3:d="DO_NAME";break}b=c.GetPropertyIndex(d);if(b>0){if(e.GetProp(b).DBCode==null||e.GetProp(b).DBCode.length==0){b=0}else{break}}a++}if(b>0){return" order by "+f+e.GetProp(b).DBCode}else{return""}};MDOInit.GetDocErrors=function(j,h){if(h==undefined){h=9999}var l="";var f="";var g=new ArrayList();var b=j.GetMD();l+=("*** "+j.GetName(1)+"\n");for(var d=1;d<=b.GetNumProp();d++){f=j.GetPropError(d);if(f!=null&&f.length>0){l+=(b.GetProp(d).UIName+" ("+j.GetPropByIndex(d)+"): "+f+"\n")}}j.GetDocErrors(g);for(var k=0;k<g.Count();k++){l+=g[k]+"\n"}if(h>0){for(var d=1;d<=b.GetNumColl();d++){var a=j.GetCollByIndex(d).GetCollection();for(var k=0;k<a.Count();k++){l+=MDOInit.GetDocErrors(a[k],h-1)}}}return l};MDOInit.GetDocErrorList=function(d,g,a){if(a==undefined){a=9999}if(d.HasErrors()){g.Add(d)}if(a>0){var f=d.GetMD();for(var c=1;c<=f.GetNumColl();c++){var b=d.GetCollByIndex(c).GetCollection();for(var e=0;e<b.Count();e++){GetDocErrorList(b[e],g,a-1)}}}};MDOInit.VerifyService=function(c,a){var b=c.GetMD();if((b.Services&a)==0){throw new Error("ERR "+MDOInit.DOERR_NOSERV+": ["+c.TypeName()+"] Servizio non attivo")}if(c.GetDocHelper()==null){throw new Error("ERR "+MDOInit.DOERR_NOHLP+": ["+c.TypeName()+"] Document helper non attivo")}};MDOInit.EditAttachments=function(a){MDOInit.VerifyService(a,MDOInit.SERV_ATTACH|MDOInit.SERV_COMMENT);a.GetDocHelper().OpenAttachmentForm(a)};MDOInit.ShowAttachment=function(c,b){var a=new IDVariant();MDOInit.VerifyService(c,MDOInit.SERV_ATTACH);c.GetDocHelper().ShowAttachment(c,new IDVariant(b),a);return a.booleanValue()};MDOInit.GetAttachment=function(c,b){var a=new IDVariant();MDOInit.VerifyService(c,MDOInit.SERV_ATTACH);c.GetDocHelper().GetAttachment(c,new IDVariant(b),a);return a.stringValue()};MDOInit.SetAttachment=function(f,e,c,g,b){var a=new IDVariant();MDOInit.VerifyService(f,MDOInit.SERV_ATTACH);f.GetDocHelper().SetAttachment(f,new IDVariant(e),new IDVariant(c),new IDVariant(g),new IDVariant(b),a);return a.stringValue()};MDOInit.DeleteAttachments=function(h,b){var g=h.GetMD();if((g.Services&MDOInit.SERV_ATTACH)!=0){if(h.GetDocHelper()!=null){h.GetDocHelper().DeleteAttachments(h)}}if(b>0){for(var e=1;e<=g.GetNumColl();e++){var j=h.GetCollByIndex(e);var c=j.GetCollection();for(var f=0;f<c.Count();f++){var a=c[f];MDOInit.DeleteAttachments(a,b-1)}}}};MDOInit.GetComment=function(f,c,e,a){var b=new IDVariant();MDOInit.VerifyService(f,MDOInit.SERV_COMMENT);f.GetDocHelper().GetComment(f,new IDVariant(c),new IDVariant(e),new IDVariant(a),b);return b.stringValue()};MDOInit.SetComment=function(g,a,f,e,c){var b=new IDVariant();MDOInit.VerifyService(g,MDOInit.SERV_COMMENT);g.GetDocHelper().SetComment(g,new IDVariant(a),new IDVariant(f),new IDVariant(e),new IDVariant(c),b);return b.stringValue()};MDOInit.DeleteComments=function(h,b){var g=h.GetMD();if((g.Services&MDOInit.SERV_COMMENT)!=0){if(h.GetDocHelper()!=null){h.GetDocHelper().DeleteComments(h)}}if(b>0){for(var e=1;e<=g.GetNumColl();e++){var j=h.GetCollByIndex(e);var c=j.GetCollection();for(var f=0;f<c.Count();f++){var a=c[f];MDOInit.DeleteComments(a,b-1)}}}};MDOInit.HandleServiceFilters=function(r){try{var j=r.GetMainFrm();var s="";var y="";var x="";var v="";var q=r.GetMD();if((q.Services&MDOInit.SERV_DOMAIN)!=0){var b=r.GetPropertyIndex("DO_COMPANY",false,true);var k=r.GetPropertyIndex("DO_DOMAIN",false,true);var c=r.GetPropertyIndex("DO_SCOPE",false,true);if(b<1||k<1||c<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain properties")}var m=q.GetProp(b).DBCode;var u=q.GetProp(k).DBCode;var o=q.GetProp(c).DBCode;if(m.length==0||u.length==0||o.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find domain fields")}if(j==null){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Framework object not set")}var g=j.getRolObj().glbCompanyID;var f=j.getRolObj().glbDomainID;if(g.length>0||f.length>0){y="(";if(g.length>0){y+=("("+m+" = '"+g+"' or "+o+" < 30)")}if(f.length>0){y+=((y.length>1?" and ":"")+"("+u+" = '"+f+"' or "+o+" < 20)")}y+=")"}}if((q.Services&MDOInit.SERV_USERINFO)!=0){var p=r.GetPropertyIndex("DO_AUTLEVEL",false,true);if(p<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find authorization level property")}var e=q.GetProp(p).DBCode;if(e.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find authorization level field")}if(j==null){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Framework object not set")}var h=j.getRolObj().glbAutLevel;x="("+e+" <= "+h+")"}if((q.Services&MDOInit.SERV_LDELETE)!=0){var t=r.GetPropertyIndex("DO_LDELETE",false,true);if(t<1){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find logical deletion property")}var a=q.GetProp(t).DBCode;if(a.length==0){throw new Error("ERR "+MDOInit.DOERR_BADDOM+": Cannot find logical deletion field")}v="("+a+" = 'N')"}s=y;if(x.length>0){s=(s.length==0?"":s+" and ")+x}if(v.length>0){s=(s.length==0?"":s+" and ")+v}return s}catch(l){return""}};MDOInit.GetLock=function(d,c,b,f){if(d.Inserted()){return true}var e=d.GetMD();if(d.Locked()){return true}if((e.Services&MDOInit.SERV_LOCKING)!=0){if(d.GetDocHelper()!=null){var a=new IDVariant(IDVariant.TRUE);d.GetDocHelper().GetLock(d,new IDVariant(b),f,a);if(a.isTrue()){d.set_Locked(true)}return a.isTrue()}else{return false}}else{if(c>0&&d.Parent()!=null){return d.Parent().GetLock(c-1,b,f)}else{return true}}};MDOInit.ReleaseLock=function(b,a){var c=b.GetMD();if((c.Services&MDOInit.SERV_LOCKING)!=0){if(!b.Locked()){return false}if(b.GetDocHelper()!=null){b.set_Locked(false);b.GetDocHelper().ReleaseLock(b);return true}else{return false}}else{if(a>0&&b.Parent()!=null){return b.Parent().ReleaseLock(a-1)}else{return true}}};MDOInit.LoadDocProp=function(m,p,t){var b=m.GetMD();t.getMetaData(true);var g=0;var o=0;if(p!=null){o=p.Count()}if(o==0){for(var k=1;k<=b.GetNumProp();k++){var a=b.GetProp(k);var u=IDL.DataType2IDVariantType(a.DataType);var r=null;var q=false;if(p==null){try{r=t.Get(a.ObjTag,u);q=true}catch(l){if(a.DBCode!=null&&a.DBCode.length>0){try{r=t.Get(a.DBCode,u);q=true}catch(f){}}}}else{if(a.DBCode!=null&&a.DBCode.length>0){try{r=t.Get(g+1,u);q=true}catch(f){}}}if(q){if(a.Transformation<Glb.TRANSF_TRIM){m.SetPropDirect(k,r);g++}else{if(!MDOInit.UseRecord(a)){m.SetPropDirect(k,Glb.GetTD(r,a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength));g++}}}}}else{for(var k=0;k<p.Count();k++){var s=p[k];var r=s;var a=b.GetProp(r);var u=IDL.DataType2IDVariantType(a.DataType);if(a.Transformation<Glb.TRANSF_TRIM){m.SetPropDirect(r,t.Get(g+1,u));g++}else{if(!MDOInit.UseRecord(a)){m.SetPropDirect(r,Glb.GetTD(t.Get(g+1,u),a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength));g++}}}}for(var k=1;k<=b.GetNumProp();k++){var a=b.GetProp(k);if(MDOInit.UseRecord(a)){if(a.RecordIdxProp==0){a.RecordIdxProp=m.GetPropertyIndex(a.TrFormat,false,false,true,false)}if(a.RecordIdxProp>0){m.SetPropDirect(k,Glb.GetTD(m.GetPropByIndex(a.RecordIdxProp),a.Transformation,a.TrFormat,a.TrOffset,a.MaxLength))}}}if((b.Services&MDOInit.SERV_LOCKING)!=0){var h=m.GetPropertyIndex("DO_LOADTIME",false,true);if(h>0){m.SetPropDirect(h,IDL.Now())}}};MDOInit.GetTIExpr=function(e,b,d,a){if(b.Transformation<Glb.TRANSF_TRIM||(b.Transformation==Glb.TRANSF_TRIM&&d)){return e+b.DBCode}else{var c="";if(Glb.ClassDB(a)==Glb.DBC_SQLSRV){c="dbo."}c+="GetTD";switch(Glb.ClassDT(b.DataType)){case Glb.DTC_NUMBER:c+="N";break;case Glb.DTC_DATE:c+="D";break;default:c+="C";break}c+=("("+e);if(MDOInit.UseRecord(b)){c+=b.TrFormat}else{c+=b.DBCode}c+=(","+b.Transformation+",'"+b.TrFormat+"',"+b.TrOffset+","+b.MaxLength+")");return c}};MDOInit.UseRecord=function(a){return(a.Transformation==Glb.TRANSF_C2TOI||a.Transformation==Glb.TRANSF_SUBSTR)};MDOInit.GetDOBase=function(c,a){if(a==undefined){a=true}var b=new ArrayList();while(c!=null){if(a){b.Insert(0,c)}else{b.Add(c)}c=c.BaseMD}return b};MDOInit.GetPropExpr=function(b,c,f){var a=c.GetDBExpr(b.Index);if(a==""){if(b.DBCode!=null&&b.DBCode.length>0){if(f.Count()==1){a=b.DBCode}else{var e=0;var g=f[e];while(g.GetNumProp()<b.Index){e++;g=f[e]}a=MDOInit.GetTIExpr(g.DBCode+".",b,true,g.GetDBType())}}}return a};MDOInit.GetFromList=function(h,r,k){var q=h;var f=k.stringValue();var g=0;var j=r[g];var p="";var o=true;for(g=0;g<r.Count();g++){j=r[g];if(j.DBCode!=null&&j.DBCode.length>0){var b=j.DBCode;if(j.TableSubst&&q!=null){if(g==0){b=q.TableSubst("","",j.DBCode,0)}else{b=q.TableSubst(r[g-1].DBCode,"inner join",j.DBCode,0)}if(!b.equals(j.DBCode)){b+=" "+j.DBCode}}if(o){f+=" from "+b;o=false}else{f+=", "+b}}}if(r.Count()>1){for(var e=1;e<r.Count();e++){var m=r[e];if(m.DBCode!=null&&m.DBCode.length>0){g=0;j=r[g];for(var c=1;c<=m.GetNumProp();c++){var a=m.GetProp(c);if(a.PK&&c<=m.BaseProps&&a.DBCode!=null&&a.DBCode.length>0){var l=m.GetFieldConversion(c);if(l!=null){while(j.GetNumProp()<c){g++;j=r[g]}if(p.length>0){p+=" and "}p+=m.DBCode;p+=".";p+=l;p+=" = ";p+=j.DBCode;p+=".";p+=a.DBCode}}}}}}k.set(new IDVariant(f));return p};MDOInit.GetLinkedDocument=function(r,b,p,o,m,l,k){var a=r.GetMD();var c=MDOInit.GetDTT(r);var q=-1;var q=parseInt(p,10);if(isNaN(q)){for(var d=1;d<=a.GetNumProp();d++){var j=a.GetProp(d);if(j.LinkedDoc!=null&&j.LinkedDoc.GetDocumentClass()==p){q=d;break}}}else{p=a.GetProp(q).Name}if(q==-1){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot find the linked document requested ("+p+")")}return null}var f=a.GetProp(q).LinkedDoc;if(f==null){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": no linked document cannot defined for property "+a.GetProp(q).Name)}return null}var h=r.CreateDocument(f.GetDocumentClass());if(h==null){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot create the linked document requested ("+f.GetDocumentClass()+")")}return null}for(var d=0;d<f.GetNumProp();d++){h.SetPropByIndex(f.GetSrcProp(d),r.GetPropByIndex(f.GetDstProp(d)))}if(b){h.LoadLookupValues()}else{try{h.LoadFromDB(0)}catch(g){}}if(!h.Loaded()){if(c!=null){c.AddMsg(DTTEngine.DTTMSG_WARN,"",209,"DO.GetLinkedDocument",r.GetName(1)+": cannot load the linked document (see previous messages)")}return null}if(o==null){return h}else{if(c!=null){c.AddMsg(DTTEngine.DTTMSG_INFO,"",209,"DO.GetLinkedDocument",r.GetName(1)+": "+p+" linked document loaded. Now searching for the next one ("+o+")")}return MDOInit.GetLinkedDocument(h,b,o,m,l,k,null)}};MDOInit.ResumeDocSync=function(b){if((b.GetMD().Services&MDOInit.SERV_SYNC)!=0){var a=MDOInit.GetSyncObj(b);if(a!=null){return a.ResumeDocSync(b)}}return true};SyncService.FL_SYNCME=1;SyncService.FL_SYNCPARTNER=2;SyncService.FL_RESYNCPARTNER=4;SyncService.FL_USEOPTLOCK=8;SyncService.NULL_Marker="~~NULL~~";function SyncService(a){this.MainFrm=a;this.DB=null;this.TablesAlreadyChecked=false;this.ResetSchemaCache=false;this.ServerURL="";this.ClientUsername="";this.ClientPassword="";this.IsSynchronizing=false;this.ResponseFormat=XMLDoc.FT_JSON;this.MaxAge=30;this.CheckServer=5;this.ConnectionTimeout=0;this.DocToSync=new ArrayList();this.OptLockList=new ArrayList();this.ClassToResync=new ArrayList();this.ErrList=new ArrayList();this.ServerErrList=null;this.ConflictList=new ArrayList();this.ConflictPropList=new ArrayList();this.DontSyncMap=new IDMap();this.DontAddVariations=false;this.SessionFlags=0;this.MaxDocuments=0;this.TotalDocuments=-1;this.ActualDocument=0;this.Aborted=false;this.Completed=false;this.PreCount=false;this.ProcessedDocs=-1;this.iCanAbort=true;this.LastDocument="";this.iNativeSync=true;this.StartSyncTS;this.ServerElapsedTime=-1;this.NetworkElapsedTime=-1;this.ClientElapsedTime=-1;this.TotalChanges=-1;this.ResetSessionFlags()}SyncService.prototype.NativeSync=function(){return(this.iNativeSync&&this.MainFrm.ParamsObj().UseRD4&&!IDL.IsNull(this.MainFrm.ShellObject.IsInsideCaravel()))};SyncService.prototype.set_NativeSync=function(a){this.iNativeSync=a};SyncService.prototype.GetProgress=function(a){if(a==undefined){a=false}return(new IDVariant(parseFloat(this.MainFrm.ShellObject.SendCmd("SYNC_PROGRESS",{ABORTED:(a?"1":"0")}))))};SyncService.prototype.CanAbort=function(){return this.iCanAbort&&(this.MaxDocuments>0)};SyncService.prototype.set_CanAbort=function(a){this.iCanAbort=a};SyncService.prototype.SetSyncDB=function(a){this.DB=a};SyncService.prototype.AddDocToSync=function(a){if(this.DocToSync.IndexOf(a)==-1){this.DocToSync.Add(a)}};SyncService.prototype.EnableOptimisticLock=function(a){if(this.OptLockList.IndexOf(a)==-1){this.OptLockList.Add(a)}};SyncService.prototype.ResetSessionFlags=function(){this.SessionFlags=255};SyncService.prototype.TestSessionFlag=function(a){return(this.SessionFlags&a)!=0};SyncService.prototype.ResetSessionFlag=function(a){this.SessionFlags=this.SessionFlags&(~a)};SyncService.prototype.SetSessionFlag=function(a){this.SessionFlags=this.SessionFlags|a};SyncService.prototype.DontSync=function(b,a){var c=this.DontSyncMap.get_Object(new IDVariant(b.TypeName()));if(c==null){c=new BitArray(b.GetMD().GetNumProp());c.SetAll(true);this.DontSyncMap.set_Object(new IDVariant(b.TypeName()),c)}if(a>0){c[a-1]=false}};SyncService.prototype.ResyncClass=function(a){if(this.ClassToResync.IndexOf(a)==-1){this.ClassToResync.Add(a)}};SyncService.prototype.LastSync=function(){var a=new IDVariant();try{if(!this.CheckTables()){return a}var d="select TS from ZZ_SYNC where ID=1 and STATUS='.'";var b=this.DB.DBO().OpenRS(d);if(b.RecordCount()>0){b.MoveFirst();a=b.Get(1)}}catch(c){}return a};SyncService.prototype.VariationNumber=function(){var a=new IDVariant();try{if(!this.CheckTables()){return a}var d="select count(*) from ZZ_SYNC where ID>1";var b=this.DB.DBO().OpenRS(d);if(b.RecordCount()>0){b.MoveFirst();a=b.Get(1)}}catch(c){}return a};SyncService.prototype.ClearPartialCounters=function(){this.TotalDocuments=-1;this.ActualDocument=0;this.Aborted=false;this.Completed=false;this.ProcessedDocs=0;this.ServerElapsedTime=0;this.NetworkElapsedTime=0;this.ClientElapsedTime=0;this.TotalChanges=0};SyncService.prototype.CheckTables=function(){if(this.TablesAlreadyChecked){return true}if(this.DB==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",602,"SyncService.CheckTables","No database can contain sync data; verify your license");return false}this.TablesAlreadyChecked=true;var a=this.DB.DBO().OpenRS("select sql from sqlite_master where type = 'table' and name = 'ZZ_SYNC'");if(a.RecordCount()>0){return true}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",600,"SyncService.CheckTables","ZZ_SYNC is not readable");try{var c=this.GetZZSQL1().stringValue();this.MainFrm.DTTObj.AddQuery("SyncService.CheckTables","Creating table ZZ_SYNC","SyncService.CheckTables",DTTEngine.STMT_QRY_INSVAL,c);this.DB.DBO().Execute(c);this.MainFrm.DTTObj.EndQuery("SyncService.CheckTables");c=this.GetZZSQL2().stringValue();if(c!=""){this.DB.DBO().Execute(c)}c=this.GetZZSQL3().stringValue();if(c!=""){this.DB.DBO().Execute(c)}c=this.GetZZSQL4().stringValue();if(c!=""){this.DB.DBO().Execute(c)}return true}catch(b){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",601,"SyncService.CheckTables","ZZ_SYNC is not creatable "+b.message);return false}};SyncService.prototype.GetZZSQL1=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ACCESS:a="create table ZZ_SYNC( ID counter not null, DNA longtext not null, STATUS text(1) not null, DOCDOM text(200), CONTENT longtext, TS datetime default NOW())";break;case Glb.DBC_SQLSRV:a="create table ZZ_SYNC( ID int identity not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT text, TS datetime default GETDATE())";break;case Glb.DBC_ORACLE:a="create table ZZ_SYNC( ID number(10), DNA varchar2(1000) not null, STATUS varchar2(1) not null, DOCDOM varchar2(200), CONTENT clob, TS date default SYSDATE)";break;case Glb.DBC_DB2:a="create table ZZ_SYNC( ID integer generated by default as identity, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT clob, TS timestamp default CURRENT_TIMESTAMP)";break;case Glb.DBC_POSTGRES:a="create table ZZ_SYNC( ID serial not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT text, TS timestamp default NOW())";break;case Glb.DBC_MYSQL:a="create table ZZ_SYNC( ID int auto_increment not null primary key, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT longtext, TS timestamp default NOW())";break;case Glb.DBC_SQLITE:a="create table ZZ_SYNC( ID integer primary key autoincrement not null, DNA varchar(1000) not null, STATUS varchar(1) not null, DOCDOM varchar(200), CONTENT varchar(10000), TS datetime default (datetime(CURRENT_TIMESTAMP,'localtime')))";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL2=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ACCESS:a="create index ZZ_SYNC_PK on ZZ_SYNC (ID) with primary";break;case Glb.DBC_SQLSRV:case Glb.DBC_ORACLE:case Glb.DBC_DB2:case Glb.DBC_POSTGRES:a="alter table ZZ_SYNC add constraint ZZ_SYNC_PK primary key (ID)";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL3=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ORACLE:a="create sequence ZZ_SYNC_ID start with 1 nocache";break}return new IDVariant(a)};SyncService.prototype.GetZZSQL4=function(){var a="";switch(Glb.ClassDB(this.DB.DBaseType())){case Glb.DBC_ORACLE:a="insert into ZZ_SYNC(ID, DNA, STATUS, TS) values (ZZ_SYNC_ID.nextval, '0', '.', NULL)";break;default:a="insert into ZZ_SYNC(DNA, STATUS, TS) values ('0', '.', NULL)";break}return new IDVariant(a)};SyncService.prototype.AddVariation=function(e,c){if(this.DontAddVariations){return}if(!c){if(!e.Inserted()&&!e.Updated()&&!e.Deleted()){return}}if(e.Inserted()&&e.Deleted()){return}if(!this.CheckTables()){return}var d=this.GetCompleteDNA(e);var h=this.GetDomain(e);var a="";var b="I";if(!c&&!e.Inserted()){if(e.Updated()){b="U"}if(e.Deleted()){b="D"}}if(b!="D"){a=this.GetContent(e);if(a==""){return}}if(e.SuspendSync()){switch(b){case"I":b="0";break;case"U":b="1";break;case"D":b="2";break}}var g="insert into ZZ_SYNC(DNA, STATUS, DOCDOM, CONTENT) values (?, ?, ?, ?)";if(Glb.ClassDB(this.DB.DBaseType())==Glb.DBC_ORACLE){g="insert into ZZ_SYNC(ID, DNA, STATUS, DOCDOM, CONTENT) values (ZZ_SYNC_ID.nextval, ?, ?, ?, ?)"}var f=new IDPreparedStatement(true);f.SetCommand(g);f.AddParameter(new IDVariant(d));f.AddParameter(new IDVariant(b));f.AddParameter(h);f.AddParameter(new IDVariant(a));this.DB.DBO().ExecuteIDPS(f,false)};SyncService.prototype.GetCompleteDNA=function(b){var a="";while(b!=null){a="{"+b.GetDNA().stringValue()+"}"+a;b=b.Parent()}return a};SyncService.prototype.GetDomain=function(c){var b=new IDVariant();var a=c.GetPropertyIndex("DO_DOMAIN",true,true,true,true);if(a>0){b=c.GetPropByIndex(a)}else{b=c.GetNamedPropertyValue("DO_DOMAIN")}return b};SyncService.prototype.GetContent=function(j){var l=new XMLDoc();var f=l.AddNewElement("do");var a=false;var c=this.OptLockList.IndexOf(j.TypeName())>-1;var b=j.GetMD();var h=this.DontSyncMap.get_Object(new IDVariant(j.TypeName()));if(h==null){this.DontSync(j,0);j.GetNamedPropertyValue("DO_DONTSYNC");h=this.DontSyncMap.get_Object(new IDVariant(j.TypeName()))}for(var e=1;e<=b.GetNumProp();e++){if(h!=null&&!h[e-1]){continue}var k=j.GetPropByIndex(e);var d=j.GetPropOrigValue(e);var g=b.GetProp(e);if(j.Inserted()||!k.equals(d)){f.SetAttribute(g.ObjTag,this.ValueToString(k));if(c&&g.DataType!=Glb.DT_DOC_OLE){f.SetAttribute(g.ObjTag+"_old",this.ValueToString(d))}a=true;if(g.PK&&!j.Inserted()){throw new Error("Cannot sync a primary key change")}}}if(a){return f.SaveToString()}else{return""}};SyncService.prototype.SyncToServer=function(a){this.StartSyncTS=new Date();if(!this.CheckSyncServer()){if(this.NativeSync()){this.EndSynchronization(false,false,new IDArray())}return false}if(this.DocToSync.Count()==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",630,"SyncToServer","There is no class to synchronize")}if(!this.CheckTables()){if(this.NativeSync()){this.EndSynchronization(false,false,new IDArray())}return false}this.ResetSchemaCache=false;this.ClearPartialCounters();if(!this.NativeSync()){this.IsSynchronizing=true;var j=true;var g=true;this.ServerErrList=new ArrayList();try{this.MainFrm.StartPhase(0,this.MainFrm.RTCObj.GetConst("F163BC6B-AB8F-46bc-BCCD-74BBF92B0154","Sincronizzazione in corso...",false),this.CanAbort());while(this.Completed==false&&this.Aborted==false){var d=false;if(this.DB.DBO().TransCount==0){this.DB.BeginTrans();d=true}SyncService.prototype.SyncToServerTR=function(){var A=0;var l="";var C="select DNA,DOCDOM,TS,CONTENT from ZZ_SYNC where ID=1 and STATUS='.'";var p=null;var e="";var m="";var o=this.DB.DBO().OpenRS(C);if(o.RecordCount()>0){o.MoveFirst();A=o.Get(1).intValue();l=o.Get(2).stringValue();p=o.Get(3);e=IDL.CSql(p,IDL.FMT_DAT1,this.DB.DBO());e=e.Replace("#","");m=o.Get(4).stringValue()}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Start synchronization from ID="+A);this.MainFrm.DTTObj.AddMsgToken("","Server",this.ServerURL);this.MainFrm.DTTObj.AddMsgToken("","UserName",this.ClientUsername);this.MainFrm.DTTObj.AddMsgToken("","Password",this.ClientPassword);this.MainFrm.DTTObj.AddMsgToken("","Last Dom",l);this.MainFrm.DTTObj.AddMsgToken("","Last Doc",m);this.MainFrm.DTTObj.AddMsgToken("","Time Stamp",e);this.MainFrm.DTTObj.AddMsgToken("","Pre Count",this.PreCount);var k="";k+='<ss username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';k+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';k+='dom="'+Glb.HTMLEncode(l)+'" ';k+='lastdoc="'+Glb.HTMLEncode(m)+'" ';k+='ts="'+e+'" ';k+='from="'+A+'" ';if(this.PreCount){k+='precount="1" '}if(this.MainFrm.ShellObject.IsInsideShell()){k+='dnid="'+this.MainFrm.ShellObject.GetDNID()+'" '}k+='max="'+this.MaxDocuments+'">';if(this.TestSessionFlag(SyncService.FL_SYNCPARTNER)){k=this.GetClientVariations(k)}for(var B=0;B<this.ClassToResync.Count();B++){var x=this.ClassToResync[B];k+='<rs cls="'+Glb.HTMLEncode(x)+'" />'}this.ClassToResync.Clear();k+="</ss>";var E=new IDMap();E.set_Value(new IDVariant("SYNCDATA"),new IDVariant(k));E.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));E.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));E.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){E.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var r=new Date();var t=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),E);var w=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncToServer","Received "+t.stringValue().length+" bytes from server");if(t.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",t.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&t.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var z=new XMLDoc();if(!z.LoadFromString(t.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncToServer","Parse XML failed")}var u=z.GetRootNode();this.ErrList.Clear();if(u!=null&&u.Name()=="ss"){this.UpdateElapdedTimes(u,w.getTime()-r.getTime());if(!this.CheckResponse(u,"SyncToServer")){this.Aborted=true;g=false;return}if(this.PreCount){this.TotalDocuments=new IDVariant(u.GetAttribute("total")).intValue();this.PreCount=false}else{if(this.TotalDocuments==-1&&this.MaxDocuments==0){this.TotalDocuments=0;var D=u.GetNode().childNodes;var q=D.length;for(var B=0;B<q;B++){var v=D[B];if(v.nodeName.equals("do")&&v.getAttribute("ss_err")!="2"){this.TotalDocuments++}}}}if(this.TotalDocuments!=-1){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","Total documents to sync = "+this.TotalDocuments)}this.DontAddVariations=true;if(this.TestSessionFlag(SyncService.FL_SYNCME)){j=this.ProcessAndSave(u,"",11)}this.DontAddVariations=false;this.Completed=!(u.GetAttribute("completed")=="no");g=g&&this.ErrList.Count()==0&&j&&!this.Aborted;var y=new IDPreparedStatement(true);y.SetCommand("update ZZ_SYNC set DNA=?, DOCDOM=?, TS=?, CONTENT=? where ID=1");y.AddParameter(new IDVariant(u.GetAttribute("maxid")));y.AddParameter(new IDVariant(u.GetAttribute("dom")));y.AddParameter(this.Completed&&g?IDL.Now():p);y.AddParameter(new IDVariant(u.GetAttribute("lastdoc")));this.DB.DBO().ExecuteIDPS(y,false);this.DB.DBO().Execute("delete from ZZ_SYNC where STATUS NOT IN ('.','0','1','2')");this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","End synchronization. Server MaxID="+u.GetAttribute("maxid"));if(!this.Completed){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",605,"SyncToServer","Synchronization is not yet completed. Running again.");this.MainFrm.DTTObj.AddMsgToken("","Aborted",this.Aborted)}}if(d){this.DB.CommitTrans()}};this.DB.DBO().ExecuteTrans(SyncService.prototype.SyncToServerTR,this)}}catch(h){throw h}finally{this.IsSynchronizing=false;this.DontAddVariations=false;if(this.ResetSchemaCache){this.MainFrm.SchemaCache.clear()}this.ResetSchemaCache=false}this.ClientElapsedTime=(new Date()).getTime()-this.StartSyncTS.getTime()-this.ServerElapsedTime-this.NetworkElapsedTime;return g}else{this.ServerErrList=null;var c={DBNAME:this.DB.DefaultConnStr(),SERVERURL:this.ServerURL,USERNAME:this.ClientUsername,PASSWORD:this.ClientPassword,CONTIM:this.ConnectionTimeout,MAXDOCS:this.MaxDocuments,PRECOUNT:this.PreCount?"1":"0",SESSFLAGS:this.SessionFlags,CLASSTORESYNC:this.ClassToResync.join(",")};this.MainFrm.ShellObject.SendCmd("SYNC_START",c);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Native synchronization started (Async="+a+"); for more detail see debug of shell");if(a){return true}this.MainFrm.StartPhase(0,this.MainFrm.RTCObj.GetConst("F163BC6B-AB8F-46bc-BCCD-74BBF92B0154","Sincronizzazione in corso...",false),this.CanAbort());var b=0;while(b>=0&&b<1){IDL.Sleep(500);var f=!this.MainFrm.TrackPhase(b*100,100);b=this.GetProgress(f).dblValue()}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",603,"SyncToServer","Native synchronization terminated (Success="+(b==1)+")");return(b==1)}};SyncService.prototype.GetClientVariations=function(j){var m="select ID, DNA, STATUS, CONTENT from ZZ_SYNC where STATUS NOT IN ('.','0','1','2') order by ID";var k=this.DB.DBO().OpenRS(m);if(k.RecordCount()>0){k.MoveFirst()}while(!k.EOF()){var b=k.Get(1).stringValue();var f=k.Get(2).stringValue();var h=k.Get(3).stringValue();var d=k.Get(4).stringValue();k.MoveNext();var e=false;for(var g=0;g<this.ClassToResync.Count();g++){var l=this.ClassToResync[g];var c='"'+l+'"';var a=f.indexOf(c);if(a>-1&&f.indexOf("}{",a)==-1){e=true;break}}if(e){continue}j+='<do ss_id="'+b+'"';j+=' ss_dna="'+Glb.HTMLEncode(f)+'"';j+=' ss_stt="'+h+'"';if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",606,"GetClientVariations","Send ID="+b+", ST="+h+", dna="+f);this.MainFrm.DTTObj.AddMsgToken("","Content",d)}if(d.length>3){j+=d.remove(0,3)}else{j+="/>"}}return j};SyncService.prototype.SyncToLocal=function(a,h){var k=new XMLDoc();var l=a.GetNextNode();if(l!=null&&l.Name()!="qry"){this.IsSynchronizing=true}try{if(!this.CheckTables()){throw new Error("CheckTables failed")}this.DeleteOldVariations();if(l!=null){var g=l.GetAttribute("username");var b=l.GetAttribute("password");var q=parseInt(l.GetAttribute("from"),10);this.MaxDocuments=parseInt(l.GetAttribute("max"),10);this.set_NativeSync(l.GetAttribute("native")=="1");if(l.GetAttribute("precount").length>0){this.PreCount=true}this.TotalDocuments=0;this.LastDocument=l.GetAttribute("lastdoc");var x=this.LastDocument;var f=this.LastDocument!="";this.Completed=true;this.MainFrm.set_UserName(new IDVariant(this.Username));var j=new IDVariant(l.GetAttribute("dom"));var u=new IDVariant(l.GetAttribute("ts"));u.changeType(IDVariant.DATETIME);var o=new IDVariant();this.MainFrm.OnSynchronize(new IDVariant(this.Username),new IDVariant(this.Password),j,u,o);if(o.isTrue()){var c=k.AddNewElement(l.Name());c.SetAttribute("canceled","yes")}else{if(l.Name()=="qry"){var c=k.AddNewElement("qry");this.ExecQuery(c,l,j,h)}else{if(l.Name()=="sc"){var c=k.AddNewElement("sc");this.ExecSyncCollection(c,l,j)}else{if(l.Name()=="gl"){var c=k.AddNewElement("gl");this.ExecGetLock(c,l,j)}else{if(l.Name()=="ss"){this.ErrList.Clear();this.ConflictList.Clear();this.ConflictPropList.Clear();this.MDMap.Clear();if(this.DocToSync.Count()==0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",630,"SyncToLocal","There is no class to synchronize")}var w=0;var t="select max(ID) from ZZ_SYNC";var d=this.DB.DBO().OpenRS(t);if(d.RecordCount()>0){d.MoveFirst();w=d.Get(1).intValue()}if(this.TestSessionFlag(SyncService.FL_SYNCME)){this.ProcessAndSave(l,j.stringValue(),10)}var c=k.AddNewElement("ss");var p=this.GetServerVariations(c,j.stringValue(),l,q,w,u);if(f||this.PreCount){c.SetAttribute("maxid",q.toString())}else{c.SetAttribute("maxid",p.toString())}c.SetAttribute("dom",j.stringValue());if(this.PreCount){this.LastDocument=x}c.SetAttribute("lastdoc",this.LastDocument);if(!this.Completed||f||this.PreCount){c.SetAttribute("completed","no")}if(this.PreCount){c.SetAttribute("total",this.TotalDocuments.toString())}for(var r=0;r<this.ClassToResync.Count();r++){var m=this.ClassToResync[r];this.GetAllDocumentClass(c,j.stringValue(),m,u)}this.ClassToResync.Clear();this.ResyncErrors(c);if(this.iNativeSync){this.GetAllMD(c)}}}}}}}}catch(v){k=new XMLDoc();var c=k.AddNewElement(l.Name());c.SetAttribute("error",Glb.HTMLEncode(v))}finally{this.IsSynchronizing=false;k.GetRootNode().SetAttribute("elapsedMS",(new Date()).getTime()-this.MainFrm.StartRequestTS.getTime())}return k};SyncService.prototype.ProcessAndSave=function(g,c,l){var d=new IDMap();var a=new ArrayList();var b=true;while(g.HasNextNode()){var f=g.GetNextNode();var m=this.ProcessVariation(f,c,d,a);b=b&&m;this.UpdateProgressBar(l)}var h=true;while(h){h=false;this.ErrList.Clear();for(var e=0;e<a.Count();e++){var o=a[e];var k=o.GetMD();var j=(l==11&&k.FastResync&&o.IsInserted);if(j||o.Validate(l)){if(o.SaveToDB(9999,false)){if(!this.ResetSchemaCache){if(k.DBCode=="DO_SCHEME"||k.DBCode=="DO_PROPSCHEME"){this.ResetSchemaCache=true}}h=true;this.ActualDocument++;this.UpdateProgressBar(l)}else{this.ErrList.Add(o)}}else{this.ErrList.Add(o)}}if(this.ErrList.Count()==0){h=false}else{if(h){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",607,"ProcessAndSave",this.ErrList.Count().toString()+" documents cannot be saved. Trying again...")}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",608,"ProcessAndSave",this.ErrList.Count().toString()+" documents cannot be saved.")}a.Clear();a.AddRange(this.ErrList)}}if(!b){this.UpdatePanels()}return b};SyncService.prototype.UpdateProgressBar=function(a){if(a!=11){return}if((this.ProcessedDocs+this.ActualDocument)%100>0){return}this.ClientElapsedTime=(new Date()).getTime()-this.StartSyncTS.getTime()-this.ServerElapsedTime-this.NetworkElapsedTime;var b=0;if(this.TotalDocuments==-1){b=this.ProcessedDocs+this.ActualDocument+(this.MaxDocuments*2)}else{b=this.TotalDocuments*2}this.Aborted=!this.MainFrm.TrackPhase(this.ProcessedDocs+this.ActualDocument,b)};SyncService.prototype.ProcessVariation=function(s,j,c,m){var k=true;if(s.Name()=="rs"){var b=s.GetAttribute("cls");if(b!=""){this.ResyncClass(b)}return k}if(s.Name()!="do"){return k}var z=s.GetAttribute("ss_dna");var x=s.GetAttribute("ss_stt");var g=s.GetAttribute("ss_id");var l=s.GetAttribute("ss_err");var d=(g=="0");var J=null;if(l!="2"){J=this.GetFromCompleteDNA(z,c,m,true);this.ProcessedDocs++}else{J=this.GetFromCompleteDNA(z,new IDMap(),new ArrayList(),true)}if(J==null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",609,"ProcessVariation","Cannot get document from DNA "+z);return k}var K=null;if(l.length>0){if(l=="1"){K=J.CreateDocument(J.TypeName())}else{if(l=="2"){K=J}}this.ServerErrList.Add(K)}if(!this.VerifyDocDomain(J,j)){return k}var G=this.GetUIDocs(J);var h=this.DontSyncMap.get_Object(new IDVariant(J.TypeName()));if(h==null){this.DontSync(J,0);J.GetNamedPropertyValue("DO_DONTSYNC");h=this.DontSyncMap.get_Object(new IDVariant(J.TypeName()))}var f=this.OptLockList.IndexOf(J.TypeName())>-1;if(x=="D"){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",611,"ProcessVariation",J.GetName(1)+": deleted")}J.set_Deleted(true);var r=G.GetLoopCollection();for(var C=0;C<r.Count();C++){var w=r[C];w.set_Deleted(true);if(w.ParentCollection()!=null){w.ParentCollection().PurgeDeleted()}}}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",612,"ProcessVariation",J.GetName(1)+": updated")}var B=J.GetMD();var q=d&&!J.Loaded()&&B.FastResync;if(!q){J.BeginTrans()}if(d&&J.Loaded()){for(var C=1;C<=B.GetNumProp();C++){J.SetPropByIndex(C,new IDVariant())}}while(s.HasNextAttribute()){var y=new IDVariant();var o=new IDVariant();s.GetNextAttribute(y,o);var I=y.stringValue();if(I.startsWith("ss_")){continue}if(o.stringValue().equals(SyncService.NULL_Marker)){o=new IDVariant()}else{o=new IDVariant(Glb.HTMLDecode(o.stringValue(),true))}if(I.endsWith("_old")){continue}if(I.endsWith("_err")){var a=I.substring(0,I.length-4);var A=J.GetPropertyIndex(a,false,false,false,true);if(A>0){var e=Glb.HTMLDecode(o.stringValue(),true);var r=G.GetLoopCollection();for(var C=0;C<r.Count();C++){var w=r[C];w.SetPropError(A,e)}K.SetPropError(A,e);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"ProcessVariation",K.GetName(1)+": server error while saving document: property "+B.GetProp(A).UIName+": "+e);k=false}continue}var u=0;if(d&&B.FastResync){u=parseInt(I.substring(1),10)}else{u=J.GetPropertyIndex(I,false,false,false,true)}if(u==0){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&!I.startsWith("ss_")){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",613,"ProcessVariation",J.GetName(1)+" property "+y.stringValue()+" not found. Try using a named property")}J.SetNamedPropertyValue(I,o)}else{if(h==null||h[u-1]){var H=B.GetProp(u);if(o.Type!=IDVariant.NULL){o.changeType(IDL.DataType2IDVariantType(H.DataType))}var p=true;if(f&&H.DataType!=Glb.DT_DOC_OLE&&this.TestSessionFlag(SyncService.FL_USEOPTLOCK)&&!this.DontAddVariations){var D=new IDVariant(s.GetAttribute(H.ObjTag+"_old"));if(D.stringValue().equals(SyncService.NULL_Marker)){D=new IDVariant()}else{D.changeType(IDL.DataType2IDVariantType(H.DataType))}if(!D.equals(J.GetPropOrigValue(u))){p=false}}if(p){this.TotalChanges++;if(q){J.SetPropDirect(u,o)}else{J.SetPropByIndex(u,o);var r=G.GetLoopCollection();for(var C=0;C<r.Count();C++){var w=r[C];var E=w.Updated();w.SetPropByIndex(u,o);w.SetPropOrigValue(u,o);w.set_Updated(E)}}}else{if(this.ConflictList.IndexOf(J)==-1){this.ConflictList.Add(J)}this.ConflictPropList.Add(J.GetDNA()+"§§§"+u.toString())}}}}if(!q){J.EndTrans()}var t=1;while(true){var F=s.GetAttribute("do_err"+t);if(F!=""){var r=G.GetLoopCollection();for(var C=0;C<r.Count();C++){var w=r[C];w.AddDocError(F)}K.AddDocError(F);this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"ProcessVariation",K.GetName(1)+": server error while saving document: "+F);k=false}else{break}t++}}return k};SyncService.prototype.GetFromCompleteDNA=function(u,g,m,q,s){if(s==undefined){s=false}var l=null;if(u.length<2){return null}if(u.charAt(0)!="{"&&u.charAt(u.length-1)!="}"){return null}u=u.substr(1,u.length-2);var t=u.indexOf("}{");var e=0;var b=true;while(b){b=false;var y=u.substr(e);if(t>0){b=true;y=u.substr(e,t-e);e=t+2;t=u.indexOf("}{",t+1)}if(s&&b){continue}if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",614,"GetFromCompleteDNA","searching for "+y)}if(l==null){l=g.get_Object(new IDVariant(y));if(l!=null&&l.IsDeleted){l=this.MainFrm.GetFromDNA(new IDVariant(y),false,0,true);l.Init();g.set_Object(new IDVariant(y),l);m.Add(l)}if(l==null&&q){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",615,"GetFromCompleteDNA","creating base object "+y)}l=this.MainFrm.GetFromDNA(new IDVariant(y),false,0,s);if(l!=null){if(!l.Loaded()&&!s){l.Init()}g.set_Object(new IDVariant(y),l);m.Add(l)}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",616,"GetFromCompleteDNA","cannot create base object "+y)}return null}}}else{if(l.Loaded()){l.LoadFromDB(1)}var k=false;var x=l.GetMD();for(var w=1;w<=x.GetNumColl();w++){var z=l.GetCollByIndex(w);z.MoveFirst();while(!z.IsEof()){var r=z.GetAt();if(r.GetDNA().stringValue()==y){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",617,"GetFromCompleteDNA","document found in collection "+y)}var h=g.get_Object(new IDVariant(y));if(h!=null&&r!=h&&!h.IsDeleted){z.RemoveAt();z.Add(h);z.Parent().ReconnectChildren(1);r=h}else{g.set_Object(new IDVariant(y),r)}l=r;k=true;break}z.MoveNext()}if(k){break}}if(!k&&q){var a=new StringTokenizer();a.setString(new IDVariant(y),new IDVariant(","));var o=a.next().stringValue();if(o==""){return null}var v=o.indexOf("|");if(v>-1){o=o.substr(v+1)}v=o.indexOf("$");if(v>-1){o=o.substr(v+1)}for(var w=1;w<=x.GetNumColl();w++){var j=x.GetColl(w);if(j.ChildrenName==o){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",618,"GetFromCompleteDNA","creating child document in collection "+y)}var z=l.GetCollByIndex(w);var f=g.get_Object(new IDVariant(y));if(f==null||f.IsDeleted){f=l.CreateDocument(o);f.Init();g.set_Object(new IDVariant(y),f)}z.Add(f);z.Parent().ReconnectChildren(1);l=f;k=true;break}}}if(!k){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",619,"GetFromCompleteDNA","no collection can contain "+y)}return null}}if(l==null){b=false}}return l};SyncService.prototype.GetServerVariations=function(g,e,f,u,h,C){var r=u;var A="select max(ID) from ZZ_SYNC where STATUS NOT IN ('0','1','2')";var c=this.DB.DBO().OpenRS(A);if(c.RecordCount()>0){c.MoveFirst();r=c.Get(1).intValue()}if(!this.TestSessionFlag(SyncService.FL_SYNCPARTNER)){return r}A="select ID from ZZ_SYNC where ID = "+u.toString();c=this.DB.DBO().OpenRS(A);if(c.RecordCount()==0||this.LastDocument!=""){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(this.LastDocument!=""){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",620,"GetServerVariations","Continue complete resync from document "+this.LastDocument)}else{this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",620,"GetServerVariations","Client maxID="+u+" not found, perform full data download")}}this.GetAllDocuments(g,e,C);return r}var m=new IDVariant("DOCDOM like '"+e+"%' or DOCDOM is null");this.MainFrm.OnSyncFilter(new IDVariant(e),m);var z=" and STATUS NOT IN ('0','1','2')";if(this.PreCount){A="select COUNT(*) from ZZ_SYNC where ID>"+u.toString();A+=z;A+=" and ("+m.stringValue()+")"}else{A="select ID, DNA, STATUS, CONTENT from ZZ_SYNC where ID>"+u.toString();A+=z;A+=" and ("+m.stringValue()+") order by ID";if(this.MaxDocuments>0){this.DB.DBO().MaxRows=this.MaxDocuments+1}}c=this.DB.DBO().OpenRS(A);if(c.RecordCount()>0){c.MoveFirst()}if(this.PreCount){this.TotalDocuments=c.Get(1).intValue();return u}if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",621,"GetServerVariations","Sending "+c.RecordCount()+" variations to client")}while(!c.EOF()){var o=c.Get(1).stringValue();var s=c.Get(2).stringValue();var p=c.Get(3).stringValue();var w=c.Get(4).stringValue();var F=parseInt(o,10);if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",622,"GetServerVariations","Send ID="+o+", ST="+p+", dna="+s);this.MainFrm.DTTObj.AddMsgToken("","Content",w)}var d=this.GetChangedAttr(s,f);var l=true;if(l&&d.ContainsKey(new IDVariant("do_deleted"))){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",623,"GetServerVariations","The client has deleted this document, cannot send data")}l=false}if(l&&p=="D"&&d.Size()>0){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",624,"GetServerVariations","The client has updated this document, while here is deleted. Cannot send data")}l=false}if(l){var b=false;var H=null;var y=null;var k=g.AddNewElement("do");k.SetAttribute("ss_id",o);if(this.iNativeSync){H=this.GetFromCompleteDNA(s,new IDMap(),new ArrayList(),true,true);y=H.GetMD();k.SetAttribute("ss_dna",y.DBCode)}else{k.SetAttribute("ss_dna",s)}k.SetAttribute("ss_stt",p);if(w!=""){var E=new XMLDoc();if(!E.LoadFromString(w)){if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"GetServerVariations","Parse XML failed")}}var D=E.GetNextNode();while(D.HasNextAttribute()){var q=new IDVariant();var j=new IDVariant();D.GetNextAttribute(q,j);var a=true;if(F<=h){a=!d.ContainsKey(q)}else{a=!j.equals(d.get_Value(q))}if(a){if(this.iNativeSync){var t=q.stringValue();var B=0;for(var x=1;x<=y.GetNumProp();x++){var G=y.GetProp(x);if(G.DBCode!=null&&G.DBCode.length>0){B++}if(t==G.ObjTag){if(G.DBCode!=null&&G.DBCode.length>0){k.SetAttribute("P"+B,j.stringValue())}break}}}else{k.SetAttribute(q.stringValue(),j.stringValue())}b=true}else{if(this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,"",625,"GetServerVariations","Purging "+q.stringValue())}}}}if(!b&&(p=="I"||p=="U")){g.RemoveNode(k)}else{if(this.iNativeSync){if(p=="D"||p=="U"){var B=0;for(var x=1;x<=y.GetNumProp();x++){var G=y.GetProp(x);if(G.DBCode==null||G.DBCode.length==0){continue}B++;if(G.PK){k.SetAttribute("P"+B,this.ValueToString(H.GetPropByIndex(x)))}}}MDMap[H.GetDNA().stringValue().split(",")[0]]=y}}}c.MoveNext();if(this.MaxDocuments>0){this.MaxDocuments--;if(this.MaxDocuments==0){this.Completed=c.EOF();r=F;break}}}return r};SyncService.prototype.GetChangedAttr=function(d,f){var a=new IDMap();f.Reset();while(f.HasNextNode()){var c=f.GetNextNode();if(c.GetAttribute("ss_dna")==d){if(c.GetAttribute("ss_stt")=="D"){a.Clear();a.set_Value(new IDVariant("do_deleted"),IDVariant.TRUE);return a}while(c.HasNextAttribute()){var e=new IDVariant();var b=new IDVariant();c.GetNextAttribute(e,b);if(b.stringValue().equals(SyncService.NULL_Marker)){b=new IDVariant()}a.set_Value(e,b)}}}return a};SyncService.prototype.ResyncErrors=function(f){var h=new ArrayList();for(var d=0;d<this.ErrList.Count();d++){var c=this.ErrList[d];MDOInit.GetDocErrorList(c,h)}if(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)){for(var d=0;d<h.Count();d++){var c=h[d];c.set_Loaded(false);c.LoadFromDB(0)}}for(var d=0;d<this.ConflictList.Count();d++){var c=this.ConflictList[d];var g=c.GetDNA().stringValue();for(var b=0;b<this.ConflictPropList.Count();b++){var e=this.ConflictPropList[b];if(e.startsWith(g+"§§§")){var a=parseInt(e.substr(e.indexOf("§§§")+3),10);if(a>0){c.SetPropError(a,"Already changed by another user")}}}if(h.IndexOf(c)==-1){h.Add(c)}}this.ResyncDocuments(f,h,true)};SyncService.prototype.ResyncDocuments=function(d,e,a){for(var c=0;c<e.Count();c++){var b=e[c];this.GetAllDocument(d,b,a)}};SyncService.prototype.GetAllDocuments=function(e,a,d){for(var b=0;b<this.DocToSync.Count();b++){var c=this.DocToSync[b];this.GetAllDocumentClass(e,a,c,d);if(!this.Completed){break}}};SyncService.prototype.GetAllDocumentClass=function(m,g,w,y){var t=new StringTokenizer();if(this.LastDocument!=""){t.setString(new IDVariant(this.LastDocument));if(t.hasNext()){var d=t.next().toString();if(!d.equals(w)){return}}else{return}}var r=this.MainFrm.GetFromDNA(new IDVariant(w),true,0);if(r!=null){var z=new IDCollection();if(this.MaxDocuments>0&&!this.PreCount){z.MaxRows=this.MaxDocuments+1}var C=r.GetMD();var q=C.DBObj;if(q==null){q=r.GetDBObj(false)}var a=t.Count().intValue()-1;var k=new Array();var e=0;for(var v=1;v<=C.GetNumProp();v++){var B=C.GetProp(v);if(B.PK){var b=t.next();MDOInit.ConvertVariant(b,B);for(var u=0;u<a-e;u++){if(k[u]==undefined){k[u]=""}else{k[u]+=" and "}var x=r.GetDBExpr(B.Index);if(x.length==0){x=B.DBCode}k[u]+=x+(u<a-e-1?"=":">")+Glb.ToSql(b,C.GetDBType(),q)}e++;z.SortBy(v)}}var h=null;if(a>0){h="(("+k[0]+")";for(var v=1;v<a;v++){h+=" or ";h+="("+k[v]+")"}h+=")"}this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",626,"GetAllDocumentClass","Firing event OnResyncClient for document "+w);var s=new IDVariant(false);var l=new IDVariant();r.OnResyncClient(z,new IDVariant(g),y,s,l);this.LastDocument="";var A=0;if(s.isFalse()){A=r.LoadCollectionBE(z,true,0,h,this.PreCount)}else{A=l.intValue()}if(this.PreCount){this.TotalDocuments+=A;return}var o=z.Count();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",627,"GetAllDocumentClass",z.Count().toString()+" documents found");var p=z.GetLoopCollection();for(var v=0;v<p.Count();v++){var f=p[v];this.GetAllDocument(m,f,false);o--;if(this.MaxDocuments>0){this.MaxDocuments--;if(this.MaxDocuments==0&&o>=0){this.LastDocument=f.GetDNA().stringValue();this.Completed=false;break}}}}};SyncService.prototype.GetAllDocument=function(e,m,l){var a=m.GetMD();var d=e.AddNewElement("do");d.SetAttribute("ss_id","0");d.SetAttribute("ss_dna",(this.iNativeSync?a.DBCode:this.GetCompleteDNA(m)));if(m.Deleted()){d.SetAttribute("ss_stt","D")}else{d.SetAttribute("ss_stt","I")}if(this.iNativeSync){this.MDMap[m.GetDNA().stringValue().split(",")[0]]=a}var j=this.DontSyncMap.get_Object(new IDVariant(m.TypeName()));if(j==null){this.DontSync(m,0);m.GetNamedPropertyValue("DO_DONTSYNC");j=this.DontSyncMap.get_Object(new IDVariant(m.TypeName()))}var k=0;for(var b=1;b<=a.GetNumProp();b++){var o=m.GetPropByIndex(b);var h=a.GetProp(b);if(this.iNativeSync&&(h.DBCode==null||h.DBCode.length==0)){k++;continue}if(j!=null&&!j[b-1]){continue}if(o.Type!=IDVariant.NULL&&(!l||this.TestSessionFlag(SyncService.FL_RESYNCPARTNER))){d.SetAttribute(a.FastResync?"P"+(b-k):h.ObjTag,Glb.HTMLEncode(this.ValueToString(o),false,false,true))}if(l){var p=m.GetPropError(b);if(p!=null){d.SetAttribute("ss_err",(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)?"1":"2"));d.SetAttribute(h.ObjTag+"_err",Glb.HTMLEncode(p))}}}if(l){var f=new ArrayList();m.GetDocErrors(f);if(f.Count()>0){var g=1;d.SetAttribute("ss_err",(this.TestSessionFlag(SyncService.FL_RESYNCPARTNER)?"1":"2"));for(var b=0;b<f.Count();b++){d.SetAttribute("do_err"+g,f[b]);g++}}}};SyncService.prototype.GetUIDocs=function(o){var b=new IDCollection();for(var e=0;e<this.MainFrm.StackForm.Count();e++){var g=this.MainFrm.StackForm[e];for(var d=0;d<g.Frames.length;d++){var h=g.Frames[d];if(h==null){continue}var a=h.Content;if(a==null){continue}if(a instanceof IDPanelSrv){if(a.pCollection()!=null){var p=a.pCollection().GetLoopCollection();for(var c=0;c<p.Count();c++){var l=p[c];this.SearchForDocs(b,l,o)}}else{if(a.pDocument()!=null){this.SearchForDocs(b,a.pDocument(),o)}}}if(a instanceof ATreeSrv){for(var c=0;c<a.Nodes.Count();c++){var m=a.Nodes[c];if(m.Doc!=null&&m.Parent==null){this.SearchForDocs(b,m.Doc,o)}}}}}return b};SyncService.prototype.SearchForDocs=function(k,l,b){if(l.TypeName()==b.TypeName()&&l.GetDNA().stringValue()==b.GetDNA().stringValue()){k.Add(l,null,true,false);return true}var d=l.GetMD();for(var g=1;g<=d.GetNumColl();g++){var h=d.GetColl(g);if(h.ChildrenName==b.TypeName()){var f=l.GetCollByIndex(g);var m=f.GetLoopCollection();for(var e=0;e<m.Count();e++){var a=m[e];if(this.SearchForDocs(k,a,b)){return true}}}}return false};SyncService.prototype.UpdatePanels=function(){for(var c=0;c<this.MainFrm.StackForm.Count();c++){var e=this.MainFrm.StackForm[c];for(var b=0;b<e.Frames.length;b++){var a=e.Frames[b];if(a==null){continue}var d=a.Content;if(d==null){continue}if(d instanceof IDPanelSrv){if(d.pCollection()!=null||d.pDocument()!=null){d.DumpDOErrors()}}}}};SyncService.prototype.Query=function(a,g){if(g==undefined){g=null}if(this.CheckSyncServer()){var d=new IDCachedRowSet();var h="";h+='<qry username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';h+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';h+='cmd="'+Glb.HTMLEncode(a.stringValue())+'">';if(g!=null){for(var e=0;e<g.GetNative().length;e++){h+='<par val="'+Glb.HTMLEncode(g.GetNative()[e].stringValue())+'"/>'}}h+="</qry>";var j=new IDMap();j.set_Value(new IDVariant("SYNCDATA"),new IDVariant(h));j.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));j.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));j.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){j.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var c=new Date();var b=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),j);var k=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncService.Query","Received "+b.stringValue().length+" bytes from server");if(b.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",b.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&b.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var l=new XMLDoc();if(!l.LoadFromString(b.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncService.Query","Parse XML failed")}var f=l.GetRootNode();if(f!=null&&f.Name()=="qry"){this.UpdateElapdedTimes(f,k.getTime()-c.getTime());if(!this.CheckResponse(f,"SyncService.Query")){return null}if(this.ResponseFormat==XMLDoc.FT_XML){d.LoadFromXML(Glb.HTMLDecode(f.GetAttribute("rs"),true),true)}else{d.LoadFromXMLNode(f)}}this.MainFrm.DTTObj.AddQuery("SyncService.Query","Query: "+a.stringValue(),"SyncService.Query",DTTEngine.STMT_QRY_SELECT,a.toString());this.MainFrm.DTTObj.AddDBDataSource(d,a.toString());this.MainFrm.DTTObj.EndQuery("SyncService.Query");return d}else{return null}};SyncService.prototype.ExecQuery=function(a,f,h,d){var b=new IDCachedRowSet();var e=new IDVariant(f.GetAttribute("cmd"));var c=new IDArray();while(f.HasNextNode()){var g=f.GetNextNode();if(g.Name()=="par"){c.add_Value(new IDVariant(g.GetAttribute("val")))}}this.MainFrm.OnSyncQuery(e,c,h,b);if(d==XMLDoc.FT_XML){a.SetAttribute("rs",Glb.HTMLEncode(b.SaveToXML(true)))}else{b.SaveToXMLNode(a)}};SyncService.prototype.SyncDocument=function(c,a){if(a==undefined){a=9999}var b=new IDCollection();b.Add(c,null,true,false);return this.SyncCollection(b,a)};SyncService.prototype.SyncCollection=function(e,o){if(o==undefined){o=9999}if(!this.CheckSyncServer()){return false}var j="";j+='<sc username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';j+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';j+='numlev="'+o+'">';var a=e.GetLoopCollection();for(var f=0;f<a.Count();f++){var m=a[f];j+='<do dna="'+Glb.HTMLEncode(m.GetDNA())+'"/>'}j+="</sc>";var k=new IDMap();k.set_Value(new IDVariant("SYNCDATA"),new IDVariant(j));k.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));k.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));k.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){k.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var d=new Date();var c=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),k);var l=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"SyncCollection","Received "+c.stringValue().length+" bytes from server");if(c.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",c.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&c.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var p=new XMLDoc();if(!p.LoadFromString(c.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"SyncCollection","Parse XML failed")}var h=p.GetRootNode();if(h!=null&&h.Name()=="sc"){this.UpdateElapdedTimes(h,l.getTime()-d.getTime());if(!this.CheckResponse(h,"SyncCollection")){return false}while(h.HasNextNode()){var g=h.GetNextNode();if(g.Name()=="do"){var b=g.GetAttribute("dna");var a=e.GetLoopCollection();for(var f=0;f<a.Count();f++){var m=a[f];if(m.GetDNA().stringValue()==b){m.LoadFromXML(Glb.HTMLDecode(g.GetAttribute("cnt"),true),false);break}}}}}return true};SyncService.prototype.ExecSyncCollection=function(a,e,h){var d=parseInt(e.GetAttribute("numlev"),10);while(e.HasNextNode()){var g=e.GetNextNode();if(g.Name()=="do"){var f=g.GetAttribute("dna");var b=this.MainFrm.GetFromDNA(new IDVariant(f),false,d);if(b!=null){if(this.VerifyDocDomain(b,h.stringValue())){if(!b.Loaded()){b.set_Deleted(true)}var c=a.AddNewElement("do");c.SetAttribute("dna",f);c.SetAttribute("cnt",Glb.HTMLEncode(b.SaveToXML(false)))}}}}};SyncService.prototype.ReleaseLock=function(a){return this.GetLock(a,new IDVariant(),false)};SyncService.prototype.GetLock=function(k,e,a){if(e==undefined){e=new IDVariant()}if(a==undefined){a=true}if(!this.CheckSyncServer()){return false}var g=false;var f="";f+='<gl username="'+Glb.HTMLEncode(this.ClientUsername)+'" ';f+='password="'+Glb.HTMLEncode(this.ClientPassword)+'" ';f+='get="'+(a?"1":"0")+'" ';f+='dna="'+Glb.HTMLEncode(k.GetDNA())+'">';f+="</gl>";var h=new IDMap();h.set_Value(new IDVariant("SYNCDATA"),new IDVariant(f));h.set_Value(new IDVariant("WCI"),new IDVariant("SYNC"));h.set_Value(new IDVariant("FTR"),new IDVariant(this.ResponseFormat));h.set_Value(new IDVariant("ID_RESPONSETYPE"),new IDVariant("TEXT"));if(this.ConnectionTimeout>0){h.set_Value(new IDVariant("ID_TIMEOUT"),new IDVariant(this.ConnectionTimeout))}var c=new Date();var b=IDL.HttpRequest(this.MainFrm,new IDVariant(this.ServerURL),h);var j=new Date();this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,"",604,"GetLock","Received "+b.stringValue().length+" bytes from server");if(b.stringValue().length<20000&&this.MainFrm.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.MainFrm.DTTObj.AddMsgToken("","Content",b.stringValue())}if(this.ResponseFormat!=XMLDoc.FT_XML&&b.stringValue().startsWith("<")){this.ResponseFormat=XMLDoc.FT_XML}var l=new XMLDoc();if(!l.LoadFromString(b.stringValue(),this.ResponseFormat)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",628,"GetLock","Parse XML failed")}var d=l.GetRootNode();if(d!=null&&d.Name()=="gl"){this.UpdateElapdedTimes(d,j.getTime()-c.getTime());if(!this.CheckResponse(d,"GetLock")){return false}g=d.GetAttribute("ris")=="1";e.set(new IDVariant(Glb.HTMLDecode(d.GetAttribute("err"),true)))}return g};SyncService.prototype.ExecGetLock=function(a,d,g){var e=d.GetAttribute("dna");var c=this.MainFrm.GetFromDNA(new IDVariant(e),false,0);a.SetAttribute("ris","0");if(c!=null){if(this.VerifyDocDomain(c,g.stringValue())){if(d.GetAttribute("get")=="1"){var f=new IDVariant();var b=c.GetLock(9999,"",f);a.SetAttribute("ris",b?"1":"0");a.SetAttribute("err",Glb.HTMLEncode(f.stringValue()));c.set_Locked(false)}else{var b=c.ReleaseLock(9999);a.SetAttribute("ris",b?"1":"0")}}}};SyncService.prototype.VerifyDocDomain=function(b,e){var c=b;while(c!=null&&e!=""){var a=this.GetDomain(c).stringValue();if(a!=""){if(!a.startsWith(e)){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",610,"VerifyDocDomain",b.GetName(1)+": client domain "+e+" cannot be match with document domain "+a+". The document won't be processed");return false}break}c=c.Parent()}return true};SyncService.prototype.AppendTo=function(a){for(var b=0;b<this.DocToSync.length;b++){a.AddDocToSync(this.MainFrm.CompNameSpace+"$"+this.DocToSync[b])}};SyncService.prototype.DeleteOldVariations=function(){if(this.MaxAge<=0){return}var b=IDL.Sub(IDL.Now(),new IDVariant(this.MaxAge,1));var a="delete from ZZ_SYNC where ID>1 and TS<"+Glb.ToSql(b,this.DB.DBaseType(),DB.DBO());this.DB.DBO().Execute(a)};SyncService.prototype.ValueToString=function(a){switch(a.Type){case 0:return SyncService.NULL_Marker;case 3:return IDL.FormatDate(a.dateValue(),"yyyy-mm-dd hh:nn:ss");default:return a.stringValue()}};SyncService.prototype.CheckSyncServer=function(){if(this.ServerURL==""){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",629,"CheckSyncServer","No sync server specified");return false}if(this.MainFrm.ShellObject&&this.MainFrm.ShellObject.IsInsideShell()&&this.CheckServer>0){if(!this.MainFrm.ShellObject.IsServerReachable(new IDVariant(this.ServerURL),new IDVariant(this.CheckServer))){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",629,"CheckSyncServer","Sync server "+this.ServerURL+" was not reached in "+this.CheckServer+" seconds");return false}}return true};SyncService.prototype.SetRTCDB=function(b,a){};SyncService.prototype.CheckResponse=function(a,c){var d=a.GetAttribute("canceled");if(d!=null&&d=="yes"){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,"",605,c,"Synchronization canceled by the server");return false}var b=a.GetAttribute("error");if(b!=null&&b.length>0){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",605,c,"Synchronization failed with error: "+Glb.HTMLDecode(b,true));return false}return true};SyncService.prototype.GetAllMD=function(a){};SyncService.prototype.EndSynchronization=function(a,b,h,e,k){if(e==undefined){e=-1}if(k==undefined){k=-1}if(b){this.MainFrm.SchemaCache.clear()}this.TotalDocuments=e;this.TotalChanges=k;if(this.MainFrm.DTTObj.Level>0){var j=new IDCollection();var c=new IDCollection();this.GetAllDocsInError(j,c);j.MoveFirst();while(!j.IsEof()){var f=j.GetAt();this.DumpDocErrors(f,true);j.MoveNext()}c.MoveFirst();while(!c.IsEof()){var f=c.GetAt();this.DumpDocErrors(f,false);c.MoveNext()}}var g=IDVariant.FALSE;this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,null,640,"SyncService.EndSynchronization","Native synchronization terminated: fire OnEndSynchronization event");this.MainFrm.OnEndSynchronization(new IDVariant(a),g,h);if(g.isFalse()&&h.Size()>0){this.RefreshPanels(h)}};SyncService.prototype.RefreshPanels=function(h){for(var c=0;c<this.MainFrm.StackForm.Count();c++){var d=this.MainFrm.StackForm[c];for(var b=0;b<d.Frames.length;b++){var e=d.Frames[b];if(e==null){continue}var a=e.Content;if(!a){continue}if(a instanceof IDPanelSrv){if(a.bQueries(0)==null){continue}if(a.IsIMDB()){continue}if(a.Status()==Glb.PS_QBE||a.IsContentModified()){continue}if(!a.IsDO()&&h.FindValue(new IDVariant(a.GetMasterTable(0)),false).intValue()!=-1){a.RefreshQuery(this.MainFrm);continue}if(a.IsDO()){var l=a.bQueries(0).DocTempl;if(l==null){l=a.bQueries(0).DocFilter}if(l==null){l=this.MainFrm.CreateDocument(a.GetMasterTable(0))}if(l==null){continue}var k=false;var g=l.GetMD();while(g!=null){if(h.FindValue(new IDVariant(g.DBCode),false).intValue()!=-1){k=true;break}g=g.BaseMD}if(k){if(a.bQueries(0).IsMasterDO){a.RefreshQuery(this.MainFrm)}else{if(a.MasterPanelIdx!=0&&a.bQueries(0).IDColl!=null){a.bQueries(0).IDColl.set_Loaded(false);a.CheckMasterDocument(true)}}}continue}}if(a instanceof ATreeSrv){if(!a.IsDO){continue}}}}};SyncService.prototype.ResumeDocSync=function(a){try{if(!this.CheckTables()){return true}var c=a.GetDNA().stringValue();var f="insert into ZZ_SYNC(STATUS, DNA, DOCDOM, CONTENT) select ";if(Glb.ClassDB(this.DB.DBaseType())==Glb.DBC_ACCESS){f+="IIF(STATUS='0', 'I', IIF(STATUS='1', 'U', 'D'))"}else{f+="CASE WHEN STATUS='0' THEN 'I' WHEN STATUS='1' THEN 'U' ELSE 'D' END"}f+=", DNA, DOCDOM, CONTENT from ZZ_SYNC where DNA LIKE ? and STATUS IN ('0','1','2')";this.MainFrm.DTTObj.AddQuery("SyncService.ResumeDocSync",a.GetName(1)+": Resuming variations","SyncService.ResumeDocSync",DTTEngine.STMT_QRY_INSSEL,f);this.MainFrm.DTTObj.AddParameter("","","DNA",c);var d=new IDPreparedStatement(true);d.SetCommand(f);d.AddParameter(new IDVariant("%{"+c+"}"));this.DB.DBO().ExecuteIDPS(d,false);this.MainFrm.DTTObj.EndQuery("SyncService.ResumeDocSync");f="delete from ZZ_SYNC where DNA LIKE ? and STATUS IN ('0','1','2')";this.MainFrm.DTTObj.AddQuery("SyncService.ResumeDocSync",a.GetName(1)+": Deleting temporary variations","SyncService.ResumeDocSync",DTTEngine.STMT_QRY_DELETE,f);this.MainFrm.DTTObj.AddParameter("","","DNA",c);d=new IDPreparedStatement(true);d.SetCommand(f);d.AddParameter(new IDVariant("%{"+c+"}"));this.DB.DBO().ExecuteIDPS(d,false);this.MainFrm.DTTObj.EndQuery("SyncService.ResumeDocSync");return true}catch(b){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",601,"SyncService.ResumeDocSync","Unable to resume variations of "+a.GetName(1)+": "+b.Message);return false}};SyncService.prototype.UpdateElapdedTimes=function(b,c){if(b.GetAttribute("elapsedMS").length>0){var a=parseInt(b.GetAttribute("elapsedMS"));this.ServerElapsedTime+=a;this.NetworkElapsedTime+=c-a}};SyncService.prototype.GetElapsedTimes=function(b,f,d){if(this.NativeSync()&&this.ClientElapsedTime==0){var a=this.MainFrm.ShellObject.SendCmd("SYNC_ELAPSEDTIMES");var e=new XMLDoc();if(a.length>0&&e.LoadFromString(a,XMLDoc.FT_JSON)){var c=e.GetRootNode();b.set(new IDVariant(parseInt(c.GetAttribute("server"))));f.set(new IDVariant(parseInt(c.GetAttribute("network"))));d.set(new IDVariant(parseInt(c.GetAttribute("client"))));if(c.GetAttribute("final")=="1"){this.ServerElapsedTime=b.intValue();this.NetworkElapsedTime=f.intValue();this.ClientElapsedTime=d.intValue()}}}else{b.set(new IDVariant(this.ServerElapsedTime));f.set(new IDVariant(this.NetworkElapsedTime));d.set(new IDVariant(this.ClientElapsedTime))}};SyncService.prototype.GetTotalDocuments=function(){if(this.TotalDocuments!=-1){return this.TotalDocuments}else{return this.ProcessedDocs}};SyncService.prototype.GetAllDocsInError=function(h,a){try{if(this.NativeSync()&&this.ServerErrList==null){this.ServerErrList=new ArrayList();var r=this.MainFrm.ShellObject.SendCmd("SYNC_GETALLDOCSINERROR");var q=new XMLDoc();if(r.length>0&&q.LoadFromString(r,XMLDoc.FT_XML)){var l=q.GetRootNode();while(l.HasNextNode()){var g=l.GetNextNode();while(g.HasNextNode()){var d=g.GetNextNode();var m=IDDocument.GetFromDNA(new IDVariant(d.GetAttribute("ss_dna")),false,0,this.MainFrm,this.MainFrm.getIMDB(),true);if(!m){continue}while(d.HasNextAttribute()){var c=new IDVariant();var p=new IDVariant();d.GetNextAttribute(c,p);var k=c.stringValue();if(k.endsWith("_err")){var o=k.substring(0,k.length-4);var b=m.GetPropertyIndex(o,false,false,false,true);if(b>0){m.SetPropError(b,p.stringValue())}}else{if(k.startsWith("do_err")){m.AddDocError(p.stringValue())}}}if(g.Name()=="client"){this.ErrList.Add(m)}if(g.Name()=="server"){this.ServerErrList.Add(m)}}}}}if(this.ServerErrList!=null){for(var f=0;f<this.ServerErrList.Count();f++){h.Add(this.ServerErrList[f])}for(var f=0;f<this.ErrList.Count();f++){a.Add(this.ErrList[f])}}}catch(j){}};SyncService.prototype.DumpDocErrors=function(c,d){var a=new ArrayList();c.GetDocErrors(a);for(var b=0;b<a.Count();b=b+1){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"DumpDocErrors",c.GetName(1)+": "+(d?"server":"client")+" error while saving document: "+a[b])}var f=c.GetMD();for(var b=1;b<=f.GetNumProp();b=b+1){var e=c.GetPropError(b);if(e!=null){this.MainFrm.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",614,"DumpDocErrors",c.GetName(1)+": "+(d?"server":"client")+" error while saving document: property "+f.GetProp(b).UIName+": "+e)}}};function ADSEState(){this.ActualPosition=1;this.HideGroupLevel=-1}ADSEState.prototype.CopyFrom=function(a){this.ActualPosition=a.ActualPosition;this.HideGroupLevel=a.HideGroupLevel};function APage(g){this.PageNum;this.PageType;this.Width;this.Height;this.UM;this.Orientation;this.FitMode;this.ParentMastro;this.ReportStates=new ArrayList();this.Sections=new ArrayList();this.MastroBoxes=new ArrayList();this.RD3ObjMap=null;this.RD3ChangedObjects=null;if(g!=undefined){this.ParentMastro=g;this.PageType=g.PageType;this.Width=g.Width;this.Height=g.Height;this.UM=g.UM;this.Orientation=g.Orientation;this.FitMode=g.FitMode;var c=this.ParentMastro.Parent;var d=0;IDREGlb.SetArraySize(this.MastroBoxes,g.BoxList.Count());for(var a=0;a<g.BoxList.Count();a++){var f=g.BoxList[a];var h=true;if(!f.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),481,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because it's invisible by design")}h=false}if(c.IsPrinting&&!f.GetFlag(IDREGlb.FL_RPTBOX_TOPRINT)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),482,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because the flag ShowWhenPrinted is disabled and the book is printing")}h=false}if(!c.IsPrinting&&!f.GetFlag(IDREGlb.FL_RPTBOX_TOPREVIEW)){if(c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(f.BoxID),483,"APage.<constructor>","Box "+c.Parent.GetObjName(f.BoxID)+": Not used because the flag ShowWhenPreviewed is disabled and the book is shown in preview")}h=false}if(h){var e=f.GetARptBox(null);e.ParentPage=this;this.MastroBoxes[d++]=e}}IDREGlb.SetArraySize(this.MastroBoxes,d)}}APage.prototype.GetRect=function(a){var b=this.ParentMastro.Parent;switch(a){case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};APage.prototype.SetRect=function(a,c){var b=this.ParentMastro.Parent;switch(a){case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};APage.prototype.GetState=function(b){for(var c=0;c<this.ReportStates.Count();c++){var a=this.ReportStates[c];if(a.ParentReport==b){return a}}return null};APage.prototype.GetMastroBox=function(c){for(var a=0;a<this.MastroBoxes.Count();a++){var d=this.MastroBoxes[a];if(d.ParentRptBox==c){return d}}return null};APage.prototype.FindObject=function(d){if(this.ParentMastro==d){return this}for(var a=0;a<this.MastroBoxes.Count();a++){var e=this.MastroBoxes[a];if(e!=null&&e.ParentRptBox==d){return e}for(var f=0;f<e.Spans.Count();f++){var c=e.Spans[f];if(c.ParentRptSpan==d){return c}}}return null};APage.prototype.Dump=function(){return};APage.prototype.Arrange=function(){if(this.MastroBoxes.Count()==0){return}var l=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Width:this.Height);var c=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Height:this.Width);var h=(this.ParentMastro.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.ParentMastro.Width:this.ParentMastro.Height);var e=(this.ParentMastro.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.ParentMastro.Height:this.ParentMastro.Width);var k=h-l;var j=e-c;if(this.FitMode==IDREGlb.MASTRO_FM_NONE){k=j=0}if(this.FitMode==IDREGlb.MASTRO_FM_WIDTH){j=0}if(k!=0||j!=0){if(this.ParentMastro.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.ParentMastro.Parent.AddVerboseMsg(this.ParentMastro.Parent.Parent.GetRTCGuid(this.ParentMastro.MastroID),484,"APage.<constructor>","Page "+this.ParentMastro.Parent.Parent.GetObjName(this.ParentMastro.MastroID)+": Adapting page content to new page dimensions -> DeltaWidth = "+this.ParentMastro.Parent.InternalUnitToString(k)+", DeltaHeight = "+this.ParentMastro.Parent.InternalUnitToString(j))}var d=new ArrayList();for(var g=0;g<this.MastroBoxes.Count();g++){d.Add(this.MastroBoxes[g])}var f=new CBoxArranger();f.BookObj=this.ParentMastro.Parent;f.Init(d,k,j,new CRect(0,0,l,c));var a=100;if(this.ParentMastro.Parent.UM==IDREGlb.BOOKUM_INCH){a=254}f.Arrange(a);f.Apply(true)}};APage.prototype.RotateSections=function(r){var v=null;if(r==null){v=this.Sections}else{v=r.SubSections}var u=null,c=null;var o=-1;for(var h=0;h<v.Count();h++){var t=h;u=v[h];for(var w=0;w<u.BoxList.Count();w++){if(u.BoxList[w].SubSections!=null){this.RotateSections(u.BoxList[w])}}if(!u.GetFlag(IDREGlb.FL_SECT_VERTICAL)){continue}if(c==null){o=t;c=u}if(u.MastroBox!=c.MastroBox||u.NumCol!=c.NumCol||h==v.Count()-1){var m;if(u.MastroBox!=c.MastroBox){m=c.MastroBox.Height}else{m=u.YPos;if(u.NumCol==c.NumCol&&h==v.Count()-1){m+=u.Height}}if(c.NumCol>1&&c.GetFlag(IDREGlb.FL_SECT_VERTICAL)){var g=new ArrayList();for(var f=0;f<v.Count();f++){var p=v[f];if(p.ParentSection!=c.ParentSection||p.MastroBox!=c.MastroBox){continue}if(p.NumCol!=c.NumCol){break}g.Add(p)}var l=g.Count()/c.NumCol;if((g.Count()%c.NumCol)!=0){l++}var k=(m-c.YPos)/l;var x=Math.floor((c.MastroBox.Width-(c.NumCol-1)*c.ColSpace)/c.NumCol);var j=0;var a=0;var d=c.YPos;for(var e=0;e<g.Count();e++){var q=g[e];q.XPos=j*(x+c.ColSpace);q.YPos=a*k+d;q.Height=k;a++;if(a==l){a=0;j++}}}c=u;o=t}}};APage.prototype.GetRD3Ident=function(){return"pag:"+this.PageNum+":"+this.ParentMastro.Parent.FrIndex+":"+this.ParentMastro.Parent.Parent.ParentS.Parent.FormIdx};APage.prototype.RD3RenderDifference=function(s,d,g){if(this.RD3ObjMap==null){this.RD3ObjMap=new HashTableSrv()}this.RD3ObjMap[this.GetRD3Ident()]=this;var f=(d?null:new BitArray(RD3Glb.PAG_MAXPROPS));var a=(d?true:this.CalcRD3Difference(g,f));var q=null;if(d){q=s.AddNewElement("pag")}if(q==null&&a){q=s.AddNewElement("chg")}if(q!=null){q.SetAttribute("id",this.GetRD3Ident())}if(d||a){for(var r=0;r<RD3Glb.PAG_MAXPROPS;r++){if(d||f[r]){this.SetRD3Property(r,q,d)}}}var t=(d)?q:s;var h=a;for(var v=0;v<this.MastroBoxes.Count();v++){var e=this.MastroBoxes[v];h|=e.RD3RenderDifference(t,d,g)}for(var v=0;v<this.Sections.Count();v++){var u=this.Sections[v];h|=u.RD3RenderDifference(t,d,g)}if(!d&&g!=null){var j=g.RD3ObjMap.keys();for(var p=0;p<j.length;p++){var w=j[p];var c=g.RD3ObjMap[w];var l=this.RD3ObjMap[w];if(l==null){var k=null;if(w.substr(0,3)=="sec"){k=c.GetRD3Ident()}if(w.substr(0,3)=="box"){k=c.GetRD3Ident()}if(w.substr(0,3)=="spn"){k=c.GetRD3Ident()}if(k!=null){var m=t.AddNewElement("del");m.SetAttribute("id",k)}}}}this.RD3ChangedObjects=null;return h};APage.prototype.CalcRD3Difference=function(c,b){b[RD3Glb.PAG_PAGENUM]=(c!=null&&c.PageNum!=this.PageNum);b[RD3Glb.PAG_UM]=(c!=null&&c.UM!=this.UM);b[RD3Glb.PAG_WIDTH]=(c!=null&&(c.Width!=this.Width||c.Orientation!=this.Orientation));b[RD3Glb.PAG_HEIGHT]=(c!=null&&(c.Height!=this.Height||c.Orientation!=this.Orientation));b[RD3Glb.PAG_FITMODE]=(c!=null&&c.FitMode!=this.FitMode);for(var a=0;a<RD3Glb.PAG_MAXPROPS;a++){if(b[a]){return true}}return false};APage.prototype.SetRD3Property=function(a,e,d){switch(a){case RD3Glb.PAG_PAGENUM:e.SetAttribute("num",this.PageNum);break;case RD3Glb.PAG_WIDTH:var c=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Width:this.Height);e.SetAttribute("wid",c);break;case RD3Glb.PAG_HEIGHT:var b=(this.Orientation==IDREGlb.MASTRO_OR_PORTRAIT?this.Height:this.Width);e.SetAttribute("hei",b);break;case RD3Glb.PAG_UM:if(this.UM==IDREGlb.BOOKUM_MM&&d){break}e.SetAttribute("um",(this.UM==IDREGlb.BOOKUM_MM)?"mm":"in");break;case RD3Glb.PAG_FITMODE:if(this.FitMode==IDREGlb.MASTRO_FM_NONE&&d){break}e.SetAttribute("fit",this.FitMode);break}};APage.prototype.RD3FindSpan=function(a){if(this.RD3ObjMap!=null){return this.RD3ObjMap[a]}else{var c=(a.indexOf("B")!=-1?"box:"+a.substr(a.indexOf("B")):"");var b=this.RD3FindBox(c);if(b!=null){for(var e=0;e<b.Spans.Count();e++){var d=b.Spans[e];if(d.GetRD3Ident()==a&&d.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){return d}}}return null}};APage.prototype.RD3FindBox=function(e){if(this.RD3ObjMap!=null){return this.RD3ObjMap[e]}else{var c=null;for(var a=0;a<this.MastroBoxes.Count();a++){var f=this.MastroBoxes[a];if(f.GetRD3Ident()==e){return f}}for(var a=0;a<this.Sections.Count();a++){var d=this.Sections[a];c=d.RD3FindBox(e);if(c!=null){return c}}return null}};APage.prototype.GetBoxesList=function(b){for(var a=0;a<this.Sections.Count();a++){var c=this.Sections[a];c.GetBoxesList(b)}};function AReportState(){this.Parent=null;this.ParentReport=null;this.DSEState=null;this.PrintPHPF=true;this.SectionStates=new ArrayList()}AReportState.prototype.GetState=function(a){for(var c=0;c<this.SectionStates.Count();c++){var b=this.SectionStates[c];if(b.ParentSection==a){return b}}return null};function ARptBox(){this.HashCode=Math.random();this.ParentSect=null;this.ParentPage=null;this.XPos=0;this.YPos=0;this.Width=0;this.Height=0;this.HRsz=IDREGlb.RSZ_NONE;this.VRsz=IDREGlb.RSZ_NONE;this.VisAttrIdx=-1;this.ImageIdx=0;this.LastColumnUsed=0;this.Interline=0;this.Stretch=IDREGlb.STRTC_AUTO;this.VisProp=-1;this.Rotation=0;this.Flags=0;this.ParentRptBox=null;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Alignment=IDREGlb.VISALN_AUTO;this.Badge="";this.YFilledPosPrev=0;this.YFilledPos=0;this.ToolTip="";this.Spans=new ArrayList();this.SpanDivList=null;this.SubSections=null;this.DSEPositions=null;this.GraphFile=null;this.GraphClickMap=null;this.GraphRS=null;this.GraphIMDB=null;this.SubForm=null;this.RD3IdentName=null;this.ClickEventDef=RD3Glb.EVENT_ACTIVE}ARptBox.prototype.GetParentBook=function(){if(this.ParentRptBox.PSection!=null){return this.ParentRptBox.PSection.Parent.Parent}else{return this.ParentRptBox.PMastro.Parent}};ARptBox.prototype.FormatPage=function(E,r){this.GetRD3Ident();var e=null;if(r!=null&&this.SpanDivList==null){this.SpanDivList=this.ParentRptBox.PSection.Parent.Parent.PE.PrepareDivList(this)}if(this.SpanDivList!=null){var l=new IDVariant(0);var C=new IDVariant(0);var p=new IDVariant(0);var w=new IDVariant(0);this.GetPaddings(l,C,p,w);e=new ARptBox();e.CopyFrom(this,false);e.SpanDivList=new ArrayList();var B=Math.min(E.YFilledPos+this.YPos+this.Height,E.Height);var m;var b;for(var H=0;H<this.SpanDivList.Count();H++){b=this.SpanDivList[H];if(E.YFilledPos+this.YPos+l.intValue()+b.Point.Y+b.TextHeight-b.TextAscent+p.intValue()<=B){e.SpanDivList.Add(b);this.SpanDivList.RemoveAt(H--)}else{if(e.SpanDivList.Count()>0&&e.VRsz==IDREGlb.RSZ_STRETCH){b=e.SpanDivList[e.SpanDivList.Count()-1];e.Height=l.intValue()+b.Point.Y+b.TextHeight-b.TextAscent}break}}if(e.SpanDivList.Count()>0&&this.SpanDivList.Count()>0&&this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){for(var H=e.SpanDivList.Count()-1;H>=0;H--){b=e.SpanDivList[H];this.SpanDivList.Insert(0,b)}e.SpanDivList.Clear()}if(e.SpanDivList.Count()>0&&this.SpanDivList.Count()>0){b=this.SpanDivList[0];var c=b.Point.Y-b.TextAscent;for(m=0;m<this.SpanDivList.Count();m++){b=this.SpanDivList[m];b.Point.Y-=c}this.YPos+=c;this.Height-=c}var j=new ArrayList();var d=new ArrayList();var F=new ArrayList();for(m=0;m<this.SpanDivList.Count();m++){b=this.SpanDivList[m];if(j.IndexOf(b.Span)==-1){j.Add(b.Span)}}for(m=0;m<e.SpanDivList.Count();m++){b=e.SpanDivList[m];if(d.IndexOf(b.Span)==-1){d.Add(b.Span)}if(j.IndexOf(b.Span)!=-1&&F.IndexOf(b.Span)==-1){F.Add(b.Span)}}IDREGlb.SetArraySize(e.Spans,this.Spans.Count());for(var A=0;A<this.Spans.Count();A++){if(this.Spans[A]==null){continue}if(j.IndexOf(this.Spans[A])==-1&&F.IndexOf(this.Spans[A])==-1){e.Spans[A]=this.Spans[A];e.Spans[A].Parent=e;this.Spans[A]=null;continue}if(F.IndexOf(this.Spans[A])!=-1){e.Spans[A]=new ARptSpan();e.Spans[A].CopyFrom(this.Spans[A]);e.Spans[A].Parent=e;var h;this.Spans[A].Text="";for(m=0;m<this.SpanDivList.Count();m++){h=this.SpanDivList[m];if(h.Span==this.Spans[A]){if(h.DelSpaces>0){for(var a=0;a<h.DelSpaces;a++){h.Text+=" "}h.DelSpaces=h.DelSpacesWidth=0}this.Spans[A].Text+=(h.Text.length!=0?h.Text:"\n")}}e.Spans[A].Text="";for(m=0;m<e.SpanDivList.Count();m++){h=e.SpanDivList[m];if(h.Span.ParentRptSpan==e.Spans[A].ParentRptSpan){if(h.DelSpaces>0){for(var a=0;a<h.DelSpaces;a++){h.Text+=" "}h.DelSpaces=h.DelSpacesWidth=0}e.Spans[A].Text+=(h.Text.length!=0?h.Text:"\n")}h.Span=e.Spans[A]}}}}else{if(this.SubSections!=null&&!this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&this.ParentRptBox.PSection!=null&&!this.ParentRptBox.PSection.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),485,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-report can split -> Calculating what can be placed on the page");u.DTTObj.AddParameter("","","Number of sub-sections",this.SubSections.Count)}e=new ARptBox();e.CopyFrom(this,true,false);e.SubSections=new ArrayList();e.Height=0;var x=false;for(var m=0;m<this.SubSections.Count();m++){var z=this.SubSections[m];if(E.YFilledPos+this.ParentRptBox.YPos+z.YPos+z.Height<=E.Height){this.SubSections.RemoveAt(m--);e.SubSections.Add(z);z.MastroBox=e;e.Height=z.YPos+z.Height;this.YPos=e.YPos+e.Height;if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(z.ParentSection.SectionID),486,"ARptBox.FormatPage","Sub-Section "+u.Parent.GetObjName(z.ParentSection.SectionID)+": Sub-Section formatted successfully");u.DTTObj.AddParameter("","","Section YPos",u.InternalUnitToString(z.YPos));u.DTTObj.AddParameter("","","Section Height",u.InternalUnitToString(z.Height))}}else{if(!x){x=true;if(z.SplitSubSection(E,e)){if(z.BoxList.Count()==0){this.SubSections.RemoveAt(m--)}continue}if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){u.AddVerboseMsg(u.Parent.GetRTCGuid(z.ParentSection.SectionID),487,"ARptBox.FormatPage","Sub-Section "+u.Parent.GetObjName(z.ParentSection.SectionID)+": Sub-Section can't be placed on the box and can NOT be split -> Storing in the cache for next page");u.DTTObj.AddParameter("","","Section YPos",u.InternalUnitToString(z.YPos));u.DTTObj.AddParameter("","","Section Height",u.InternalUnitToString(z.Height));u.DTTObj.AddParameter("","","MastroBox Height",u.InternalUnitToString(E.Height));u.DTTObj.AddParameter("","","Box YPos",u.InternalUnitToString(this.ParentRptBox.YPos))}}z.YPos-=e.Height}}if(e.SubSections.Count()>0&&this.SubSections.Count()>0){var k=0;for(var m=0;m<this.ParentRptBox.SubReport.SectionsList.Count();m++){var D=this.ParentRptBox.SubReport.SectionsList[m];if(D.SectType==IDREGlb.SECT_GROUPHEADER&&D.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&this.SubSections[0].ParentSection!=D){var o=new MyBoolean(false);var t=new MyBoolean(false);var g=new MyBoolean(true);var G=new ARptBox();G.CopyFrom(this,false,false);G.YFilledPos=0;G.YFilledPosPrev=0;G.Height=2147483647;D.FormatPage(null,null,true,o,t,g,G);var q=G.SubSections[0];G.SubSections.Clear();q.YPos=this.SubSections[0].YPos;for(var f=0;f<this.SubSections.Count();f++){var y=this.SubSections[f];y.YPos+=q.Height}this.SubSections.Insert(k++,q);this.Height+=q.Height}}}this.Height-=this.YPos;if(this.SubSections.Count()==0){this.SubSections=null}if(e.SubSections!=null&&e.SubSections.Count()==0){e=null}if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(e!=null){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),488,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-Report has been partially formatted")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),489,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Sub-Report has NOT been formatted -> All sub-sections are kept in cache for next page")}}return e}else{e=new ARptBox();e.CopyFrom(this)}}if(E.YFilledPos+e.YPos+e.Height<=E.Height){if(r!=null){IDREGlb.SetArraySize(r.Spans,this.Spans.Count());for(var v=0;v<this.Spans.Count();v++){if(this.Spans[v]!=null){r.Spans[v]=this.Spans[v];r.Spans[v].Parent=r;this.Spans[v]=null}}}else{if(this.SpanDivList==null||this.SpanDivList.Count()==0){for(var v=0;v<this.Spans.Count();v++){this.Spans[v]=null}}}if(this.SpanDivList!=null&&e.SpanDivList!=null&&this.SpanDivList.Count()>0&&e.SpanDivList.Count()==0){e=null}var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e!=null){if(this.Spans.Count()==0||this.IsCompleted()){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),490,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Formatted completely (Content = "+e.DumpContent()+")")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),491,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": Partially formatted -> "+e.Spans.Count()+" span formatted and "+this.Spans.Count()+" left in cache for next formatting cycle (Formatted Content = "+e.DumpContent()+", Content left in cache = "+DumpContent()+")")}u.DTTObj.AddParameter("","","Box Left",u.InternalUnitToString(e.XPos));u.DTTObj.AddParameter("","","Box Top",u.InternalUnitToString(e.YPos));u.DTTObj.AddParameter("","","Box Width",u.InternalUnitToString(e.Width));u.DTTObj.AddParameter("","","Box Height",u.InternalUnitToString(e.Height))}return e}else{if(this.SpanDivList!=null){for(var v=0;v<e.Spans.Count();v++){if(e.Spans[v]!=null){if(this.Spans[v]!=null){this.Spans[v].Text=e.Spans[v].Text+this.Spans[v].Text}else{this.Spans[v]=e.Spans[v];this.Spans[v].Parent=this}e.Spans[v]=null}}}var u=this.GetParentBook();if(u!=null&&u.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(this.SpanDivList!=null){u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),492,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": No spans formatted -> no space available on the page (Content = "+this.DumpContent()+")")}else{u.AddVerboseMsg(u.Parent.GetRTCGuid(this.ParentRptBox.BoxID),493,"ARptBox.FormatPage","Box "+u.Parent.GetObjName(this.ParentRptBox.BoxID)+": No spans formatted -> KeepTogether flag set and space available on the page is not enough (Content = "+this.DumpContent()+")")}u.DTTObj.AddParameter("","","Space Left On Page",u.InternalUnitToString(E.Height-(E.YFilledPos+this.YPos)));u.DTTObj.AddParameter("","","Box Left",u.InternalUnitToString(this.XPos));u.DTTObj.AddParameter("","","Box Top",u.InternalUnitToString(this.YPos));u.DTTObj.AddParameter("","","Box Width",u.InternalUnitToString(this.Width));u.DTTObj.AddParameter("","","Box Height",u.InternalUnitToString(this.Height))}return null}};ARptBox.prototype.SplitSubBox=function(c,a,h){var b=c.GetParentBook();if(this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(this.ParentRptBox.BoxID),494,"ARptBox.SplitSubBox","Box "+b.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has KeepTogether flag set thus can NOT be divided -> This sub-box will remain a single piece")}return false}if(this.SubSections==null){return false}var e=new ARptBox();e.SubSections=new ArrayList();e.CopyFrom(this,false,false);e.Height=0;var g=false;for(var f=0;f<this.SubSections.Count();f++){var d=this.SubSections[f];if(c.YFilledPos+h+a.YPos+this.YPos+d.YPos+d.Height<=c.Height){this.SubSections.RemoveAt(f--);e.SubSections.Add(d);d.MastroBox=e;e.Height=d.YPos+d.Height;if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(d.ParentSection.SectionID),495,"ARptBox.SplitSubBox","Sub-Section "+b.Parent.GetObjName(d.ParentSection.SectionID)+": Sub-Section formatted successfully");b.DTTObj.AddParameter("","","Section YPos",b.InternalUnitToString(d.YPos));b.DTTObj.AddParameter("","","Section Height",b.InternalUnitToString(d.Height))}}else{if(!g){g=true;if(d.SplitSubSection(c,e)){if(d.BoxList.Count()==0){this.SubSections.RemoveAt(f--)}continue}}if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(d.ParentSection.SectionID),496,"ARptBox.SplitSubBox","Sub-Section "+b.Parent.GetObjName(d.ParentSection.SectionID)+": Sub-Section can't be placed on the box and can NOT be split -> Storing in the cache for next page");b.DTTObj.AddParameter("","","Section YPos",b.InternalUnitToString(d.YPos));b.DTTObj.AddParameter("","","Section Height",b.InternalUnitToString(d.Height));b.DTTObj.AddParameter("","","MastroBox Height",b.InternalUnitToString(c.Height));b.DTTObj.AddParameter("","","Box YPos",b.InternalUnitToString(this.YPos))}d.YPos-=e.Height}}if(e.SubSections.Count()>0){a.BoxList.Add(e);a.Height=e.YPos+e.Height;e.ParentSect=a;this.Height-=e.Height;this.YPos=0;if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(this.ParentRptBox.BoxID),497,"ARptBox.SplitSubBox","Box "+b.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has been split in 2 parts (SubSections formatted = "+e.SubSections.Count()+", SubSections that remains in cache = "+this.SubSections.Count()+")")}return true}if(b!=null&&b.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){b.AddVerboseMsg(b.Parent.GetRTCGuid(this.ParentRptBox.BoxID),498,"ARptBox.SplitSubBox","Box "+b.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box has NOT been split (meybe the box is too short to contain sub-sections)")}return false};ARptBox.prototype.CopyFrom=function(e,f,b){if(f==undefined){f=true}if(b==undefined){b=true}this.ParentSect=e.ParentSect;this.ParentPage=e.ParentPage;this.ParentRptBox=e.ParentRptBox;this.XPos=e.XPos;this.YPos=e.YPos;this.Width=e.Width;this.Height=e.Height;this.HRsz=e.HRsz;this.VRsz=e.VRsz;this.Interline=e.Interline;this.VisAttrIdx=e.VisAttrIdx;this.ImageIdx=e.ImageIdx;this.YFilledPos=e.YFilledPos;this.InitFlags(e.GetFlags());this.ToolTip=e.ToolTip;this.Stretch=e.Stretch;this.Rotation=e.Rotation;this.BackColor=e.BackColor;this.ForeColor=e.ForeColor;this.Alignment=e.Alignment;this.FontMod=e.FontMod;this.Badge=e.Badge;this.VisProp=e.VisProp;this.LastColumnUsed=e.LastColumnUsed;this.GraphFile=e.GraphFile;this.GraphClickMap=e.GraphClickMap;this.GraphRS=e.GraphRS;this.GraphIMDB=e.GraphIMDB;this.RD3IdentName=e.RD3IdentName;this.ClickEventDef=e.ClickEventDef;this.SubForm=e.SubForm;if(b){this.SubSections=null;this.SubSections=e.SubSections;e.SubSections=null;if(this.SubSections!=null){for(var g=0;g<this.SubSections.Count();g++){var a=this.SubSections[g];a.MastroBox=this}}}if(f){IDREGlb.SetArraySize(this.Spans,e.Spans.Count());for(var d=0;d<e.Spans.Count();d++){if(e.Spans[d]!=null){this.Spans[d]=new ARptSpan();this.Spans[d].CopyFrom(e.Spans[d]);this.Spans[d].Parent=this}}}if(this.DSEPositions!=null){this.DSEPositions=null}if(e.DSEPositions!=null){this.DSEPositions=new Array();for(var c=0;c<e.DSEPositions.length;c++){this.DSEPositions[c]=e.DSEPositions[c]}}};ARptBox.prototype.IsCompleted=function(){for(var a=0;a<this.Spans.Count();a++){if(this.Spans[a]!=null&&this.Spans[a].GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){return false}}if(this.SubSections!=null&&this.SubSections.Count()!=0){return false}return true};ARptBox.prototype.IsFullyPrinted=function(){if(this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){return true}for(var a=0;a<this.Spans.Count()-1;a++){if(this.Spans[a]!=null&&this.Spans[a+1]==null){return false}}return true};ARptBox.prototype.DeleteNullSpans=function(){for(var b=0;b<this.Spans.Count();b++){var c=this.Spans[b];var a=false;if(!c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){a=true}else{if(c.Text!=null&&c.Text.length==0&&c.Value.Type==IDVariant.NULL){a=true}else{if(c.Value.Type==IDVariant.STRING&&c.Value.stringValue().length==0){a=true}}}if(a){this.Spans.RemoveAt(b);b--}}};ARptBox.prototype.IsZero=function(){for(var a=0;a<this.Spans.Count();a++){if(this.Spans[a]!=null&&!this.Spans[a].IsZero()){return false}}return true};ARptBox.prototype.IsEmpty=function(){for(var b=0;b<this.Spans.Count();b++){if(this.Spans[b]!=null&&!this.Spans[b].IsEmpty()){return false}}if(this.SubSections!=null){for(var c=0;c<this.SubSections.Count();c++){var a=this.SubSections[c];if(!a.IsEmpty()){return false}}}return true};ARptBox.prototype.SetRect=function(a,c){var b=null;if(this.ParentRptBox.PSection!=null){b=this.ParentRptBox.PSection.Parent.Parent}else{b=this.ParentRptBox.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:this.XPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_TOP:this.YPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};ARptBox.prototype.GetRect=function(a){if(a==undefined){return new CRect(this.XPos,this.YPos,this.XPos+this.Width,this.YPos+this.Height)}var b=null;if(this.ParentRptBox.PSection!=null){b=this.ParentRptBox.PSection.Parent.Parent}else{b=this.ParentRptBox.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:return b.ConvertFromInternalValue(this.XPos);case IDREGlb.RECT_TOP:return b.ConvertFromInternalValue(this.YPos);case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};ARptBox.prototype.InitFlags=function(a){this.Flags=a};ARptBox.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTBOX_VISIBLE}return a};ARptBox.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTBOX_VISIBLE&&(this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTBOX_KEEPTOGETHER&&(this.Flags&a)==0){if(this.Spans!=null&&this.Spans.length==1&&this.Spans[0]!=null&&this.Spans[0].GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){return true}}return((this.Flags&a)!=0)};ARptBox.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentRptBox.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTBOX_VISIBLE}};ARptBox.prototype.GetSubForm=function(){return this.SubForm};ARptBox.prototype.SetSubForm=function(a){this.SubForm=a;if(a!=null){a.ParentBox=this;if(a.Frames==null){a.SetSubMainFrm(a.MainFrm,a.MainFrm.IMDB)}}};ARptBox.prototype.GetVisualStyle=function(){return this.VisAttrIdx};ARptBox.prototype.SetVisualStyle=function(b){var a=this.GetParentBook();for(var d=0;d<this.Spans.Count();d++){var c=this.Spans[d];if(c!=null&&c.VisAttrIdx==this.VisAttrIdx){a.Parent.AObjectChanged(c);c.VisAttrIdx=b}}this.VisAttrIdx=b};ARptBox.prototype.GetBackColor=function(){return this.BackColor};ARptBox.prototype.SetBackColor=function(d){var a=this.GetParentBook();for(var c=0;c<this.Spans.Count();c++){var b=this.Spans[c];if(b!=null&&b.BackColor==this.BackColor){a.Parent.AObjectChanged(b);b.BackColor=d}}this.BackColor=d};ARptBox.prototype.GetForeColor=function(){return this.ForeColor};ARptBox.prototype.SetForeColor=function(d){var a=this.GetParentBook();for(var c=0;c<this.Spans.Count();c++){var b=this.Spans[c];if(b!=null&&b.ForeColor==this.ForeColor){a.Parent.AObjectChanged(b);b.ForeColor=d}}this.ForeColor=d};ARptBox.prototype.GetFontMod=function(){return this.FontMod};ARptBox.prototype.SetFontMod=function(b){var a=this.GetParentBook();for(var d=0;d<this.Spans.Count();d++){var c=this.Spans[d];if(c!=null&&c.FontMod.equals(this.FontMod)){a.Parent.AObjectChanged(c);c.FontMod=b}}this.FontMod=b};ARptBox.prototype.FormatSubReport=function(b){if(!this.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return this.Height}if(this.ParentRptBox.SubReport!=null){this.YFilledPos=this.YFilledPosPrev=0;var a=this.Height;var e=false;if(this.VRsz==IDREGlb.RSZ_STRETCH||(this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.ParentRptBox.PSection.Parent.Parent.PE.CanScroll)){if(this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.ParentRptBox.PSection.Parent.Parent.PE.CanScroll){this.Height=2147483647;e=true}else{if(this.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){this.Height=b}else{this.Height=2147483647}}}if(this.SubSections==null||this.SubSections.Count()==0){this.ParentRptBox.SubReport.FormatSubReport(this)}this.Height=a;if(!e){var d=0;var c=null;if(this.SubSections!=null){c=this.SubSections[this.SubSections.Count()-1]}if(c!=null){d=c.YPos+c.Height}return d}else{return this.Height}}return this.Height};ARptBox.prototype.FormatGraph=function(){if(this.ParentRptBox.SubGraph!=null){if(this.GraphFile!=null&&this.GraphFile.length>0){return true}var c=new Object();c.Width=this.Width;c.Height=this.Height;this.ParentRptBox.PSection.Parent.Parent.ConvertFromPhysicalToPixel(c);this.ParentRptBox.SubGraph.Width=c.Width;this.ParentRptBox.SubGraph.Height=c.Height;this.ParentRptBox.SubGraph.FrIndex=(this.ParentRptBox.PSection.Parent.Parent.FrIndex==-1?99:this.ParentRptBox.PSection.Parent.Parent.FrIndex);this.ParentRptBox.SubGraph.UpdateGraph(this.ParentRptBox.PSection.Parent.Parent.MainFrm);this.GraphFile=this.ParentRptBox.SubGraph.getGraphFile();if(this.ParentRptBox.SubGraph.Hyperlink()){this.GraphClickMap="ena";if(this.ParentRptBox.SubGraph.IMDBDataSource==-1){this.GraphRS=new IDCachedRowSet();this.GraphRS.CopyFrom(this.ParentRptBox.SubGraph.QueryObj.RS)}else{var b=this.ParentRptBox.PSection.Parent.Parent.Parent.ParentS.Parent.MainFrm.IMDB;this.GraphIMDB=new IMDBTableSrv(b);this.GraphIMDB.CopyFrom(b.Table(this.ParentRptBox.SubGraph.IMDBDataSource))}}var a=this.GetParentBook();if(a!=null&&a.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){a.AddVerboseMsg(a.Parent.GetRTCGuid(this.ParentRptBox.BoxID),499,"ARptBox.FormatGraph","Box "+a.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box Graph has been formatted");a.DTTObj.AddParameter("","","Box Width",a.InternalUnitToString(this.ParentRptBox.SubGraph.Width));a.DTTObj.AddParameter("","","Box Height",a.InternalUnitToString(this.ParentRptBox.SubGraph.Height))}return true}return false};ARptBox.prototype.HandleVertResize=function(){this.SpanDivList=this.ParentRptBox.PSection.Parent.Parent.PE.PrepareDivList(this);if(this.SpanDivList==null){return}var b=0;for(var g=0;g<this.SpanDivList.Count();g++){var f=this.SpanDivList[g];b=Math.max(b,f.Point.Y+f.TextHeight-f.TextAscent)}var a=new IDVariant(0);var e=new IDVariant(0);var d=new IDVariant(0);var c=new IDVariant(0);this.GetPaddings(a,e,d,c);b+=a.intValue()+d.intValue();if(this.VRsz==IDREGlb.RSZ_STRETCH&&b>this.Height){this.Height=b}};ARptBox.prototype.DeleteAllSpanDiv=function(){this.SpanDivList=null;if(this.SubSections!=null){for(var d=0;d<this.SubSections.Count();d++){var c=this.SubSections[d];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].DeleteAllSpanDiv()}}}};ARptBox.prototype.CreateAllSpanDiv=function(d,e){var f=d.PrepareDivList(this);if(f!=null){e[this.HashCode]=f}if(this.SubSections!=null){for(var g=0;g<this.SubSections.Count();g++){var c=this.SubSections[g];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].CreateAllSpanDiv(d,e)}}}};ARptBox.prototype.GetPaddings=function(a,f,e,c,b){if(b==undefined){b=null}var d=null;if(b!=null){d=b.Parent}else{if(this.ParentRptBox!=null){if(this.ParentRptBox.PSection!=null){d=this.ParentRptBox.PSection.Parent.Parent}else{d=this.ParentRptBox.PMastro.Parent}}else{if(this.ParentSect!=null){d=this.ParentSect.ParentSection.Parent.Parent}}}d.VisualStyleList.GetPaddings(this.VisAttrIdx,a,f,e,c,(d!=null?d.UM:-1),b)};ARptBox.prototype.LogDSEpositions=function(){var c=false;var b=null;if(this.ParentRptBox.PSection!=null){b=this.ParentRptBox.PSection.Parent.Parent}else{b=this.ParentRptBox.PMastro.Parent}if(this.HasHyperLink()){c=true}if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){c=true}if(!c&&(this.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG)||this.GetFlag(IDREGlb.FL_RPTBOX_CANDROP)||this.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS))){c=true}if(!c){for(var g=0;g<this.Spans.Count();g++){var f=this.Spans[g];if(f!=null&&f.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){c=true;break}}}if(!c){return}var a=this.ParentRptBox;var e=new ArrayList();while(a!=null){e.Insert(0,a.PSection.Parent.DSE.GetCurrentPosition());a=a.PSection.Parent.ParentBox}this.DSEPositions=new Array();for(var d=0;d<e.Count();d++){this.DSEPositions[d]=e[d]}};ARptBox.prototype.GetHTMLName=function(){var c="B"+this.ParentRptBox.BoxID;if(this.ParentRptBox.PSection==null||this.DSEPositions==null){return c}var b=this.ParentRptBox;var a=this.DSEPositions.length-1;while(b!=null){c+=("R"+this.DSEPositions[a--]);b=b.PSection.Parent.ParentBox;if(b!=null){c+=("B"+b.BoxID)}}return c};ARptBox.prototype.ProcessRequest=function(p,h,j){var a=this.GetHTMLName();if(j){for(var c=0;c<this.Spans.Count();c++){var o=this.Spans[c];if(o!=null&&o.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){var d="F"+h.FrIndex+a+"S"+o.ParentRptSpan.SpanID;var q=new IDVariant(p.GetParameter(d));if(o.Value.Type==IDVariant.NULL&&q.stringValue().equals("")){continue}if(q.Type==IDVariant.NULL){continue}o.ProcessRequest(q);if(h.AbortProcessReq){return true}}}}else{if(this.HasHyperLink()||(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink())){var m="F"+h.FrIndex+a+".x";if(p.GetParameter(m)!=null){if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){this.ParentRptBox.PSection.Parent.Parent.MoveDSEPositions(this);if(this.GraphRS!=null){this.ParentRptBox.SubGraph.QueryObj.RS.CopyFrom(this.GraphRS)}else{p.IMDB.Table(this.ParentRptBox.SubGraph.IMDBDataSource).CopyFrom(this.GraphIMDB)}var g=p.iwrd_wce;if(g==null||g.length==0){g=p.Request.WCE}if(g!=null&&g.length>2){this.ParentRptBox.SubGraph.FireGraphClick(g.substr(2),p)}else{WriteToConsoleError("[ARptBox::ProcessRequest] Empty WebEvent. Can't fire GraphClick event")}return true}h.BoxActivated(this);return true}}}if(this.SubSections!=null){for(var l=0;l<this.SubSections.Count();l++){var f=this.SubSections[l];for(var k=0;k<f.BoxList.Count();k++){var e=f.BoxList[k];if(e.ProcessRequest(p,h,j)){return true}}}}return false};ARptBox.prototype.GetBoxByID=function(c){if(this.GetHTMLName().equals(c)){return this}if(this.SubSections!=null&&this.SubSections.Count()!=0){for(var g=0;g<this.SubSections.Count();g++){var d=this.SubSections[g];for(var a=0;a<d.BoxList.Count();a++){var f=d.BoxList[a];var e=f.GetBoxByID(c);if(e!=null){return e}}}}return null};ARptBox.prototype.GetStretch=function(a){if(this.Stretch==IDREGlb.STRTC_AUTO){if(a instanceof CPEPDF){return IDREGlb.STRTC_FILL}if(a instanceof CPEHTML){return IDREGlb.STRTC_FILL}}return this.Stretch};ARptBox.prototype.GetPage=function(){if(this.ParentPage!=null){return this.ParentPage}else{return this.ParentSect.GetPage()}};ARptBox.prototype.GetRD3Ident=function(){if(this.RD3IdentName==null){this.RD3IdentName="box:B"+this.ParentRptBox.BoxID;if(this.ParentRptBox.PSection!=null){var a=this.ParentRptBox;while(a!=null&&a.PSection.Parent!=null){this.RD3IdentName+="R"+(a.PSection.SectType==IDREGlb.SECT_DETAIL?a.PSection.Parent.DSE.GetRowId():a.PSection.Parent.DSE.GetCurrentPosition().toString());a=a.PSection.Parent.ParentBox;if(a!=null){this.RD3IdentName+="B"+a.BoxID}}}else{if(this.ParentPage!=null){this.RD3IdentName+="P"+this.ParentPage.PageNum}}this.RD3IdentName+=":"+this.ParentRptBox.PMastro.Parent.FrIndex+":"+this.ParentRptBox.PMastro.Parent.Parent.ParentS.Parent.FormIdx}return this.RD3IdentName};ARptBox.prototype.RD3RenderDifference=function(q,f,j){var g=this.GetPage();g.RD3ObjMap[this.GetRD3Ident()]=this;var h=(f?null:new BitArray(RD3Glb.BOX_MAXPROPS));var d=new IDVariant();var c=f;if(!c){if(g.RD3ChangedObjects!=null){var u=g.RD3ChangedObjects[this.GetRD3Ident()];if(u!=null){c=this.CalcRD3Difference(u,h,d)}}else{c=this.CalcRD3Difference(j.RD3ObjMap[this.GetRD3Ident()],h,d)}}var m=null;if(f){m=q.AddNewElement("box")}if(d.isTrue()){m=q.AddNewElement("ins");if(this.ParentSect!=null){m.SetAttribute("parid",this.ParentSect.GetRD3Ident());var e=this.ParentSect.BoxList.IndexOf(this);m.SetAttribute("previd",(e==this.ParentSect.BoxList.Count()-1?"":this.ParentSect.BoxList[e+1].GetRD3Ident()))}else{m.SetAttribute("parid",this.ParentPage.GetRD3Ident());var e=this.ParentPage.MastroBoxes.IndexOf(this);m.SetAttribute("previd",(e==this.ParentPage.MastroBoxes.Count()-1?"":this.ParentPage.MastroBoxes[e+1].GetRD3Ident()))}c=true;h.SetAll(true)}if(m==null&&c){m=q.AddNewElement("chg")}if(m!=null){m.SetAttribute("id",this.GetRD3Ident())}if(f||c){for(var p=0;p<RD3Glb.BOX_MAXPROPS;p++){if(f||h[p]){this.SetRD3Property(p,m,f)}}}if(f||d.isTrue()){if(this.ClickEventDef!=RD3Glb.EVENT_ACTIVE){m.SetAttribute("clk",this.ClickEventDef)}}var k=c;var r=(f)?m:q;for(var t=0;t<this.Spans.Count();t++){var o=this.Spans[t];if(o!=null){k|=o.RD3RenderDifference(r,f,j)}}if(this.SubSections!=null){var a=null;for(var t=0;t<this.SubSections.Count();t++){var s=this.SubSections[t];if(s!=null){k|=s.RD3RenderDifference(r,f,j);if(f&&s.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&a!=null&&a.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&s.MastroBox==a.MastroBox){var l=r.GetNode().childNodes[r.GetNode().childNodes.length-1];if(l.nodeName.equals("sec")){l.setAttribute("ohd","1")}}a=s}}}if(!f&&h[RD3Glb.BOX_SUBFORM]){f=true;r=m;m.SetAttribute("csf",(this.SubForm!=null?"1":"0"));k=true}if(this.SubForm!=null){k|=this.SubForm.RD3RenderDifferences(r,f)}return k};ARptBox.prototype.CalcRD3Difference=function(c,e,a){if(c==null){a.set(true);return true}var d=null;if(this.ParentPage!=null){d=this.ParentPage.ParentMastro.Parent.VisualStyleList}else{if(this.ParentSect!=null){if(this.ParentSect.Parent!=null){d=this.ParentSect.Parent.ParentMastro.Parent.VisualStyleList}else{d=this.ParentSect.ParentSection.Parent.Parent.VisualStyleList}}}e[RD3Glb.BOX_XPOS]=(c.XPos!=this.XPos);e[RD3Glb.BOX_YPOS]=(c.YPos!=this.YPos);e[RD3Glb.BOX_WIDTH]=(c.Width!=this.Width);e[RD3Glb.BOX_HEIGHT]=(c.Height!=this.Height||c.CanBeEdited()!=this.CanBeEdited());e[RD3Glb.BOX_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);e[RD3Glb.BOX_IMAGE]=(c.ImageIdx!=this.ImageIdx);e[RD3Glb.BOX_INTERLINE]=(c.Interline!=this.Interline);e[RD3Glb.BOX_STRETCH]=(c.Stretch!=this.Stretch);e[RD3Glb.BOX_VISIBLE]=(c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)!=this.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE));e[RD3Glb.BOX_CANDRAG]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANDRAG));e[RD3Glb.BOX_CANDROP]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANDROP)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANDROP));e[RD3Glb.BOX_CANTRANSFORM]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANTRANS));e[RD3Glb.BOX_CANSCROLL]=(c.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)!=this.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL));e[RD3Glb.BOX_TOOLTIP]=((c.ToolTip==null)!=(this.ToolTip==null)||(c.ToolTip!=null&&!c.ToolTip.equals(this.ToolTip)));e[RD3Glb.BOX_GRAPHFILE]=((c.GraphFile==null)!=(this.GraphFile==null)||(c.GraphFile!=null&&!c.GraphFile.equals(this.GraphFile)));e[RD3Glb.BOX_GRAPHMAP]=((c.GraphClickMap==null)!=(this.GraphClickMap==null)||(c.GraphClickMap!=null&&!c.GraphClickMap.equals(this.GraphClickMap)));e[RD3Glb.BOX_CANCLICK]=(c.CanClick()!=this.CanClick());e[RD3Glb.BOX_VISPROP]=(c.VisProp!=this.VisProp);e[RD3Glb.BOX_SUBFORM]=(c.SubForm!=this.SubForm);e[RD3Glb.BOX_BACKCOLOR]=(c.BackColor!=this.BackColor);e[RD3Glb.BOX_FORECOLOR]=(c.ForeColor!=this.ForeColor);e[RD3Glb.BOX_ALIGN]=(c.Alignment!=this.Alignment);e[RD3Glb.BOX_FONTMOD]=((c.FontMod==null)!=(this.FontMod==null)||(c.FontMod!=null&&!c.FontMod.equals(this.FontMod)));e[RD3Glb.BOX_BADGE]=((c.Badge==null)!=(this.Badge==null)||(c.Badge!=null&&!c.Badge.equals(this.Badge)));for(var b=0;b<RD3Glb.BOX_MAXPROPS;b++){if(e[b]){return true}}return false};ARptBox.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.BOX_XPOS:if(this.XPos==0&&c){break}d.SetAttribute("xp",this.XPos.toString());break;case RD3Glb.BOX_YPOS:if(this.YPos==0&&c){break}d.SetAttribute("yp",this.YPos.toString());break;case RD3Glb.BOX_WIDTH:d.SetAttribute("wid",this.Width.toString());break;case RD3Glb.BOX_HEIGHT:d.SetAttribute("hei",this.Height.toString());var b=0;if(this.ParentRptBox!=null&&this.ParentRptBox.FontHeight>0){if(this.CanBeEdited()){b=Math.floor(this.Height/this.ParentRptBox.FontHeight)}else{b=Math.floor(this.Height/this.ParentRptBox.FontHeight+0.5)}}if(b==1&&c){break}d.SetAttribute("num",b.toString());break;case RD3Glb.BOX_VISATTR:d.SetAttribute("sty",this.GetParentBook().VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.BOX_IMAGE:if(this.ImageIdx==0&&c){break}if(this.ImageIdx==0){d.SetAttribute("img","")}else{var e=CBook.AdaptWebFileName(this.ParentRptBox.PMastro.Parent.ImagesPath[Math.abs(this.ImageIdx)-1]);d.SetAttribute("img",e)}break;case RD3Glb.BOX_INTERLINE:if(this.Interline==0&&c){break}d.SetAttribute("int",this.Interline.toString());break;case RD3Glb.BOX_VISPROP:if(this.VisProp==-1&&c){break}d.SetAttribute("vfl",this.VisProp.toString());break;case RD3Glb.BOX_STRETCH:if(this.Stretch==IDREGlb.STRTC_AUTO&&c){break}d.SetAttribute("str",this.Stretch.toString());break;case RD3Glb.BOX_VISIBLE:if((this.Flags&IDREGlb.FL_RPTBOX_VISIBLE)!=0&&c){break}d.SetAttribute("vis",((this.Flags&IDREGlb.FL_RPTBOX_VISIBLE)!=0)?"1":"0");break;case RD3Glb.BOX_CANDRAG:if((this.Flags&IDREGlb.FL_RPTBOX_CANDRAG)==0&&c){break}d.SetAttribute("dra",((this.Flags&IDREGlb.FL_RPTBOX_CANDRAG)!=0)?"1":"0");break;case RD3Glb.BOX_CANDROP:if((this.Flags&IDREGlb.FL_RPTBOX_CANDROP)==0&&c){break}d.SetAttribute("dro",((this.Flags&IDREGlb.FL_RPTBOX_CANDROP)!=0)?"1":"0");break;case RD3Glb.BOX_CANTRANSFORM:if((this.Flags&IDREGlb.FL_RPTBOX_CANTRANS)==0&&c){break}d.SetAttribute("tra",((this.Flags&IDREGlb.FL_RPTBOX_CANTRANS)!=0)?"1":"0");break;case RD3Glb.BOX_CANSCROLL:if((this.Flags&IDREGlb.FL_RPTBOX_CANSCROLL)==0&&c){break}d.SetAttribute("scr",((this.Flags&IDREGlb.FL_RPTBOX_CANSCROLL)!=0)?"1":"0");break;case RD3Glb.BOX_TOOLTIP:if(this.ToolTip.length==0&&c){break}d.SetAttribute("tip",this.ToolTip);break;case RD3Glb.BOX_GRAPHFILE:if((this.GraphFile==null||this.GraphFile.length==0)&&c){break}d.SetAttribute("grf",this.GraphFile!=null?this.GraphFile:"");break;case RD3Glb.BOX_GRAPHMAP:if((this.GraphClickMap==null||this.GraphClickMap.length==0)&&c){break}d.SetAttribute("grm",this.GraphClickMap!=null?this.GraphClickMap:"");break;case RD3Glb.BOX_CANCLICK:var f=this.CanClick();if(!f&&c){break}d.SetAttribute("act",(f?"1":"0"));break;case RD3Glb.BOX_BACKCOLOR:if(this.BackColor==-1&&c){break}d.SetAttribute("bkc",(this.BackColor==-1?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.BOX_FORECOLOR:if(this.ForeColor==-1&&c){break}d.SetAttribute("frc",(this.ForeColor==-1?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.BOX_ALIGN:if(this.Alignment==IDREGlb.VISALN_AUTO&&c){break}d.SetAttribute("aln",this.Alignment.toString());break;case RD3Glb.BOX_FONTMOD:if((this.FontMod==null||this.FontMod.length==0)&&c){break}d.SetAttribute("ftm",(this.FontMod==null)?"":this.FontMod);break;case RD3Glb.BOX_BADGE:if((this.Badge==null||this.Badge.length==0)&&c){break}d.SetAttribute("bdg",(this.Badge==null)?"":this.Badge);break}};ARptBox.prototype.RD3GraphClick=function(b){var a=this.ParentRptBox.PSection.Parent.Parent.MainFrm;if(this.ParentRptBox.SubGraph!=null&&this.ParentRptBox.SubGraph.Hyperlink()){this.ParentRptBox.PSection.Parent.Parent.MoveDSEPositions(this);if(this.GraphRS!=null){this.ParentRptBox.SubGraph.QueryObj.RS.CopyFrom(this.GraphRS)}else{a.IMDB.Table(this.ParentRptBox.SubGraph.IMDBDataSource).CopyFrom(this.GraphIMDB)}this.ParentRptBox.SubGraph.FireGraphClick(b,a)}};ARptBox.prototype.RD3Activate=function(){this.ParentRptBox.PMastro.Parent.BoxActivated(this)};ARptBox.prototype.RD3Drop=function(a){this.ParentRptBox.PMastro.Parent.BoxDrop(a,this)};ARptBox.prototype.RD3Transform=function(c,g,d,f){var a=this.ParentRptBox.PMastro.Parent;a.DDSrcBox=this;a.MoveDSEPositions(this);if(a.DTTObj.Level>0){a.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,a.Parent.GetRTCGuid(this.ParentRptBox.BoxID),415,"ARptBox.RD3Transform","Box "+a.Parent.GetObjName(this.ParentRptBox.BoxID)+": Box transformed -> Fire OnBoxTransform event")}var e=new IDVariant(false);a.FormattingObj=this.ParentSect;a.FormattingType=IDREGlb.FRM_SECTION_PERM;a.Parent.Fire_OnBoxTransform(this.ParentRptBox.BoxID,c,g,d,f,e);a.FormattingType=IDREGlb.FRM_NONE;a.FormattingObj=null};ARptBox.prototype.GetIndex=function(){return this.ParentRptBox.BoxID};ARptBox.prototype.CanClick=function(){var a=this.GetParentBook();if(this.Spans.Count()==1){var b=this.Spans[0];if(b!=null&&a.VisualStyleList.ControlType(b.VisAttrIdx)==IDREGlb.VISCTRL_BUTTON){return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}}return this.HasHyperLink()};ARptBox.prototype.CanBeEdited=function(){if(this.Spans!=null&&this.Spans.Count()==1){var b=this.Spans[0];if(b==null){return false}var a=this.GetParentBook();if(a.VisualStyleList.ControlType(b.VisAttrIdx)!=IDREGlb.VISCTRL_AUTO&&a.VisualStyleList.ControlType(b.VisAttrIdx)!=IDREGlb.VISCTRL_EDIT){return false}return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}return false};ARptBox.prototype.DumpContent=function(){var b="'";for(var a=0;a<this.Spans.Count();a++){var c=this.Spans[a];if(c==null){continue}b+=c.Text;if(b.length>50){return b.substr(0,50)+"...'"}}return b+"'"};ARptBox.prototype.HasHyperLink=function(){if((this.VisProp&IDREGlb.BOXVISPROP_HYPERLINK)!=0){return true}if((this.GetParentBook().VisualStyleList.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_HYPERLINK)!=0){return true}return false};ARptBox.prototype.GetToolTip=function(){return this.ToolTip};ARptBox.prototype.GetInnerText=function(){var b="";for(var a=0;a<this.Spans.Count();a++){b+=this.Spans[a].Text;b+=" "}return b};function ARptSpan(){this.Parent=null;this.ParentRptSpan=null;this.Text="";this.Value=new IDVariant();this.VisAttrIdx=-1;this.Scale=0;this.MaxLen=0;this.ValueSourceIdx=-1;this.Flags=0;this.Stretch=IDREGlb.STRTC_AUTO;this.ToolTip="";this.MimeType="";this.ValueList=null;this.Image=new MyImage();this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Mask="";this.Watermark="";this.ChangeEventDef=RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE}ARptSpan.prototype.CopyFrom=function(b){this.ParentRptSpan=b.ParentRptSpan;this.Text=b.Text;this.Value=b.Value;this.VisAttrIdx=b.VisAttrIdx;this.InitFlags(b.GetFlags());this.MimeType=b.MimeType;this.MaxLen=b.MaxLen;this.Scale=b.Scale;this.ToolTip=b.ToolTip;this.ValueSourceIdx=b.ValueSourceIdx;this.Stretch=b.Stretch;this.Image=b.Image;this.BackColor=b.BackColor;this.ForeColor=b.ForeColor;this.FontMod=b.FontMod;this.Mask=b.Mask;this.Watermark=b.Watermark;this.ChangeEventDef=b.ChangeEventDef;if(b.ValueList!=null){this.ValueList=new ArrayList();IDREGlb.SetArraySize(this.ValueList,b.ValueList.Count());for(var a=0;a<b.ValueList.Count();a++){this.ValueList[a]=new CRptSpanValItem();this.ValueList[a].CopyFrom(b.ValueList[a])}}};ARptSpan.prototype.SetNewValue=function(g){this.Value=g;if(g.Type!=IDVariant.NULL){switch(this.ParentRptSpan.DataType){case IDREGlb.DT_NUM_INTEGER:g.changeType(IDVariant.INTEGER);break;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:g.changeType(IDVariant.DECIMAL);break;case IDREGlb.DT_NUM_FLOAT:g.changeType(IDVariant.FLOAT);break;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:g.changeType(IDVariant.STRING);break;case IDREGlb.DT_BOOLEAN:g.changeType(IDVariant.INTEGER);break;case IDREGlb.DT_DATE:case IDREGlb.DT_DATETIME:case IDREGlb.DT_TIME:if(this.Mask.length>0){g=IDL.ToDateTime(g,new IDVariant(this.Mask))}else{g.changeType(IDVariant.DATETIME)}break}var f=null;if(this.ParentRptSpan.Parent.PSection!=null){f=this.ParentRptSpan.Parent.PSection.Parent.Parent.VisualStyleList}else{f=this.ParentRptSpan.Parent.PMastro.Parent.VisualStyleList}this.Text=g.ToString();var e=new IDVariant(g);if(this.Mask.length>0){this.Text=IDL.Format(g,new IDVariant(this.Mask),this.GetMainFrm()).stringValue()}else{if(!f.ApplyMask(this.VisAttrIdx,g,e,this.GetMainFrm())){var a="";switch(this.ParentRptSpan.DataType){case IDREGlb.DT_NUM_FLOAT:a=f.Parent.Parent.FloatMsk;break;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:a=f.Parent.Parent.CurrencyMsk;break;case IDREGlb.DT_DATE:a=f.Parent.Parent.DateMsk;break;case IDREGlb.DT_DATETIME:a=f.Parent.Parent.DateMsk+" "+f.Parent.Parent.TimeMsk;break;case IDREGlb.DT_TIME:a=f.Parent.Parent.TimeMsk;break}if(!a.equals("")){this.Text=IDL.Format(g,new IDVariant(a),this.GetMainFrm()).stringValue()}}else{this.Text=e.stringValue()}}var d=(this.ValueList!=null?this.ValueList:this.ParentRptSpan.ValueList);if(d!=null&&d.Count()>0){var c=new IDVariant("");var b=new IDVariant("");this.ValueSourceIdx=this.ParentRptSpan.GetValueSourceVal(d,f,this.Value,c,b);if(f.ControlType(this.VisAttrIdx)!=IDREGlb.VISCTRL_EDIT){this.Text=c.ToString()}this.ToolTip=b.ToString();if(this.ValueSourceIdx!=-1&&d[this.ValueSourceIdx].VisualStyle!=-1){this.VisAttrIdx=d[this.ValueSourceIdx].VisualStyle}}}else{this.Text=""}};ARptSpan.prototype.IsZero=function(){switch(this.Value.Type){case IDVariant.NULL:return true;case IDVariant.INTEGER:return(this.Value.intValue()==0);case IDVariant.FLOAT:return(this.Value.dblValue()==0);case IDVariant.DATETIME:return false;case IDVariant.DECIMAL:return(this.Value.decValue()==0);case IDVariant.STRING:return(this.Value.stringValue()==null||this.Value.stringValue().length==0);case IDVariant.BLOB:return false}return false};ARptSpan.prototype.IsEmpty=function(){return this.Text.equals("")};ARptSpan.prototype.InitFlags=function(a){this.Flags=a};ARptSpan.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){a&=~IDREGlb.FL_RPTSPAN_ENABLED}return a};ARptSpan.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTSPAN_VISIBLE&&(this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTSPAN_ENABLED&&(this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return false}return(this.Flags&a)!=0};ARptSpan.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_ENABLED}};ARptSpan.prototype.ProcessRequest=function(k){var b=this.ParentRptSpan.Parent.PMastro.Parent;if((this.ParentRptSpan.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(b.DTTObj.Level>0){b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),416,"ARptSpan.ProcessRequest","Span "+b.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Span has been activated but a Role item prevent the span to be ENABLED -> skipping activation")}return}var f=b.UpdateCount;var d=this.ParentRptSpan.Parent.PMastro.Parent.VisualStyleList.ControlType(this.VisAttrIdx);if(d==IDREGlb.VISCTRL_CHECK&&this.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)){var h=this.GetMainFrm();if(!h.ParamsObj().UseRD3){var m=k.stringValue();var l=this.ValueList;if(l==null){l=this.ParentRptSpan.ValueList}if(l!=null&&l.Count()>=2&&d==IDREGlb.VISCTRL_CHECK){if(m.length>0){k=l[0].Value}else{k=l[1].Value}}}}if(this.ParentRptSpan.DataType!=IDREGlb.DT_UNSPEC){k.changeType(IDREGlb.GetOLEType(this.ParentRptSpan.DataType))}if(!k.equals(this.Value)){var e=new ArrayList();var g=new ArrayList();if(this.Parent.ParentSect!=null){var a=this.Parent.ParentRptBox;while(a!=null){g.Insert(0,a);a=a.PSection.Parent.ParentBox}for(var c=0;c<g.Count();c++){a=g[c];e.Add(a.PSection.Parent.DSE.GetCurrentPosition());if(a.PSection.Parent.ParentBox!=null){a.PSection.Parent.DSE.Close();a.PSection.Parent.DSE.UpdateIMDB(true);a.PSection.Parent.DSE.Open()}a.PSection.Parent.DSE.SetCurrentPosition(this.Parent.DSEPositions[c])}}if(b.DTTObj.Level>0){b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),417,"ARptSpan.ProcessRequest","Span "+b.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Span value has changed from "+this.Value+" to "+k+" -> Fire OnChangingSpan event")}var o=new IDVariant(0);if(this.Parent.ParentSect!=null){b.FormattingObj=this.Parent.ParentSect;b.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Parent.ParentPage!=null){b.FormattingObj=this.Parent.ParentPage;b.FormattingType=IDREGlb.FRM_PAGE}}var j=b.Parent.GetNewID2OldID(this.ParentRptSpan.SpanID);b.Parent.Fire_OnChangingSpan(j,this.Value,k,o);b.FormattingType=IDREGlb.FRM_NONE;b.FormattingObj=null;if(b.UpdateCount!=f){b.AbortProcessReq=true}else{if(o.intValue()!=-1){if(this.Parent.ParentSect!=null){this.SetNewValue(k);if(b.DTTObj.Level>0){b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),418,"ARptSpan.ProcessRequest","Span "+b.Parent.GetObjName(this.ParentRptSpan.SpanID)+": Storing value in book's memory")}if(this.ParentRptSpan.FldIdx!=-1){if(b.DTTObj.Level>0){b.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,b.Parent.GetRTCGuid(this.ParentRptSpan.SpanID),419,"ARptSpan.ProcessRequest","Span "+b.Parent.GetObjName(this.ParentRptSpan.SpanID)+": The span is directly connected with a Field -> storing value in DataSource")}this.Parent.ParentSect.ParentSection.Parent.DSE.SetFieldValue(this.ParentRptSpan.FldIdx,this.Value)}}}if(e.Count()!=0){for(var c=0;c<g.Count();c++){var a=g[c];a.PSection.Parent.DSE.SetCurrentPosition(e[c])}}}}};ARptSpan.prototype.GetStretch=function(a){if(this.Stretch==IDREGlb.STRTC_AUTO){if(a instanceof CPEPDF){return IDREGlb.STRTC_ENLARGE}if(a instanceof CPEHTML){return IDREGlb.STRTC_NONE}}return this.Stretch};ARptSpan.prototype.IsLastLineOfParagraph=function(){if(this.Parent.ParentSect!=null&&this.Parent.ParentSect.Parent!=null){var a=this.Parent.ParentSect.Parent.GetState(this.Parent.ParentSect.ParentSection.Parent);if(a!=null&&a.DSEState.ActualPosition==this.Parent.ParentSect.DSEPosition){var b=a.GetState(this.Parent.ParentSect.ParentSection);if(b!=null&&b.FindObject(this.ParentRptSpan)!=null){return false}}}return true};ARptSpan.prototype.GetMainFrm=function(){if(this.ParentRptSpan.Parent.PSection!=null){return this.ParentRptSpan.Parent.PSection.Parent.Parent.MainFrm}else{return this.ParentRptSpan.Parent.PMastro.Parent.MainFrm}};ARptSpan.prototype.GetParentBook=function(){if(this.ParentRptSpan.Parent.PSection!=null){return this.ParentRptSpan.Parent.PSection.Parent.Parent}else{return this.ParentRptSpan.Parent.PMastro.Parent}};ARptSpan.prototype.GetClientMask=function(g,u,v,y,t,f){var w,o;var a=this.GetMainFrm();if(a!=null&&a.ParamsObj().UseClientMask){switch(Glb.ClassDT(this.ParentRptSpan.DataType)){case Glb.DTC_CHAR:f.set(new IDVariant("A"));w=y;if(y.equals(">")){g.set(new IDVariant(t.toUpperCase()));u.set(new IDVariant(y))}else{if(y.equals("<")){g.set(new IDVariant(t.toLowerCase()));u.set(new IDVariant(y))}else{if(y.length>0){var m=w.charAt(w.length-1);while(w.length<this.MaxLen){w+=m}if(w.length>this.MaxLen){w=w.remove(this.MaxLen,w.length-this.MaxLen)}o=w;var q=0;var b=true;for(var s=0;s<o.length;s++){var k=o.charAt(s);if(k=="A"||k=="a"||k=="&"||k=="#"){if(q>=t.length){o=o.remove(s,o.length-s);break}o=o.substr(0,s)+t.charAt(q)+o.substr(s+1);q++;b=false}else{if(b&&q<t.length){if(o.charAt(s)==t.charAt(q)){q++}else{q=0;b=false}}}}g.set(new IDVariant(o));u.set(new IDVariant(w))}else{g.set(new IDVariant(t))}}}break;case Glb.DTC_DATE:f.set(new IDVariant("D"));if(y.length>0){u.set(new IDVariant(y))}else{switch(this.ParentRptSpan.DataType){case Glb.DT_DATE:u.set(new IDVariant(a.ParamsObj().DefaultDateMask));break;case Glb.DT_TIME:u.set(new IDVariant(a.ParamsObj().DefaultTimeMask));break;case Glb.DT_DATETIME:u.set(new IDVariant(a.ParamsObj().DefaultDateMask+" "+a.ParamsObj().DefaultTimeMask));break}}if(u.stringValue().length==0){g.set(new IDVariant(t))}else{g.set(IDL.Format(v,u,a))}break;case Glb.DTC_NUMBER:f.set(new IDVariant("N"));if(y.length>0){u.set(new IDVariant(y))}else{switch(this.ParentRptSpan.DataType){case Glb.DT_NUM_CURRENCY:u.set(new IDVariant(a.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FIXED:u.set(new IDVariant(a.ParamsObj().DefaultCurrencyMask));break;case Glb.DT_NUM_FLOAT:u.set(new IDVariant(a.ParamsObj().DefaultFloatMask));break;case Glb.DT_NUM_INTEGER:u.set(IDL.Add(IDL.Replicate(new IDVariant("#"),new IDVariant(this.MaxLen-1)),new IDVariant("0")));break}}if(u.stringValue().length==0){g.set(new IDVariant(t))}else{w=u.stringValue();var x=-1;var d=-1;var h=w.indexOf(".");switch(this.ParentRptSpan.DataType){case Glb.DT_NUM_CURRENCY:x=this.MaxLen;if(h>-1){d=w.length-h-1}break;case Glb.DT_NUM_FIXED:x=this.MaxLen;d=this.Scale;break;case Glb.DT_NUM_INTEGER:x=this.MaxLen;d=0;break}var r=x-d;var c=0;if(r>0){if(h==-1){h=w.length}for(var e=h-1;e>=0;e--){if(w.charAt(e)=="0"||w.charAt(e)=="#"){c++;if(c==r){if(e>0){w=w.remove(0,e)}break}}}}h=w.indexOf(".");if(h>-1&&d>=0){r=d;if(r==0){w.length=h}else{c=0;for(var e=h+1;e<w.length;e++){if(w.charAt(e)=="0"||w.charAt(e)=="#"){c++;if(c==r){w=w.substr(0,e+1);break}}}}}u.set(new IDVariant(w));g.set(IDL.Format(v,u,a));for(var e=0;e<w.length;e++){if(w.charAt(e)=="."){break}if(w.charAt(e)=="0"){w=w.substr(0,e)+"#"+w.substr(e+1)}}if(!a.ParamsObj().UseDecimalDot){h=w.indexOf(".");w=w.Replace(",",".");if(h>=0){w=w.substr(0,h)+","+w.substr(h+1)}}u.set(new IDVariant(w))}break}}else{g.set(new IDVariant(t));u.set(new IDVariant(""))}};ARptSpan.prototype.GetRD3Ident=function(){return"spn:S"+this.ParentRptSpan.SpanID+this.Parent.GetRD3Ident().substr(4)};ARptSpan.prototype.RD3RenderDifference=function(f,m,c){var h=this.Parent.GetPage();h.RD3ObjMap[this.GetRD3Ident()]=this;var e=(m?null:new BitArray(RD3Glb.SPN_MAXPROPS));var a=new IDVariant();var o=m;if(!o){if(h.RD3ChangedObjects!=null){var j=h.RD3ChangedObjects[this.GetRD3Ident()];if(j!=null){o=this.CalcRD3Difference(j,e,a)}}else{o=this.CalcRD3Difference(c.RD3ObjMap[this.GetRD3Ident()],e,a)}}var b=null;if(m){b=f.AddNewElement("spn")}if(a.isTrue()){b=f.AddNewElement("ins");b.SetAttribute("parid",this.Parent.GetRD3Ident());var g=this.Parent.Spans.IndexOf(this);b.SetAttribute("previd",(g==this.Parent.Spans.Count()-1||this.Parent.Spans[g+1]==null?"":this.Parent.Spans[g+1].GetRD3Ident()));o=true;e.SetAll(true)}if(b==null&&o){b=f.AddNewElement("chg")}if(b!=null){b.SetAttribute("id",this.GetRD3Ident())}if(m||o){for(var d=0;d<RD3Glb.SPN_MAXPROPS;d++){if(m||e[d]){this.SetRD3Property(d,b,m)}}}if(m||a.isTrue()){var l=this.ChangeEventDef;if((this.Flags&IDREGlb.FL_RPTSPAN_ACTIVE)!=0){l|=RD3Glb.EVENT_IMMEDIATE}if(l!=(RD3Glb.EVENT_CLIENTSIDE|RD3Glb.EVENT_SERVERSIDE)){b.SetAttribute("chg",l)}}var k=o;return k};ARptSpan.prototype.CalcRD3Difference=function(c,d,a){if(c==null){a.set(true);return true}d[RD3Glb.SPN_TEXT]=((c.Text==null)!=(this.Text==null)||(c.Text!=null&&!c.Text.equals(this.Text)));if(!d[RD3Glb.SPN_TEXT]&&(c.ValueList!=this.ValueList||this.GetParentBook().ChangedObj.Contains(this.ParentRptSpan))){d[RD3Glb.SPN_TEXT]=true}d[RD3Glb.SPN_VALUE]=(!c.Value.equals(this.Value));d[RD3Glb.SPN_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);d[RD3Glb.SPN_MAXLEN]=(c.MaxLen!=this.MaxLen);d[RD3Glb.SPN_VISIBLE]=(c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)!=this.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE));d[RD3Glb.SPN_ENABLED]=(c.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)!=this.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED));d[RD3Glb.SPN_STRETCH]=(c.Stretch!=this.Stretch);d[RD3Glb.SPN_TOOLTIP]=((c.ToolTip==null)!=(this.ToolTip==null)||(c.ToolTip!=null&&!c.ToolTip.equals(this.ToolTip)));d[RD3Glb.SPN_MIME]=((c.MimeType==null)!=(this.MimeType==null)||(c.MimeType!=null&&!c.MimeType.equals(this.MimeType)));d[RD3Glb.SPN_HASIMAGE]=(c.Image.IsEmpty()!=this.Image.IsEmpty());d[RD3Glb.SPN_VALUELIST]=(c.ValueList!=this.ValueList||this.GetParentBook().ChangedObj.Contains(this.ParentRptSpan));d[RD3Glb.SPN_DATATYPE]=(c.ParentRptSpan.DataType!=this.ParentRptSpan.DataType);d[RD3Glb.SPN_SCALE]=(c.Scale!=this.Scale);d[RD3Glb.SPN_BACKCOLOR]=(c.BackColor!=this.BackColor);d[RD3Glb.SPN_FORECOLOR]=(c.ForeColor!=this.ForeColor);d[RD3Glb.SPN_FONTMOD]=((c.FontMod==null)!=(this.FontMod==null)||(c.FontMod!=null&&!c.FontMod.equals(this.FontMod)));d[RD3Glb.SPN_MASK]=((c.Mask==null)!=(this.Mask==null)||(c.Mask!=null&&!c.Mask.equals(this.Mask)));d[RD3Glb.SPN_WATERMARK]=((c.Watermark==null)!=(this.Watermark==null)||(c.Watermark!=null&&!c.Watermark.equals(this.Watermark)));for(var b=0;b<RD3Glb.SPN_MAXPROPS;b++){if(d[b]){return true}}return false};ARptSpan.prototype.SetRD3Property=function(k,m,h){switch(k){case RD3Glb.SPN_TEXT:if((this.Text==null||this.Text.length==0)&&h){break}var d=(this.Text==null)?"":this.Text;if((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0){var j=this.GetParentBook();var a=j.VisualStyleList.Mask(this.VisAttrIdx);if(!this.Mask.equals("")){a=this.Mask}if(!a.equals("=")&&j.PE instanceof CPEHTML){d=j.PE.HTMLEncode(d,true)}d=PFieldSrv.EncodeMultiLineSpaces(d)}if((this.GetParentBook().VisualStyleList.Flags(this.VisAttrIdx)&Glb.FL_VIS_PASSWORD)!=0){d="********"}m.SetAttribute("txt",d);break;case RD3Glb.SPN_VALUE:if((this.ValueList!=null||this.ParentRptSpan.ValueList.Count()>0)){if((this.Value==null||this.Value.Type==IDVariant.NULL||this.Value.stringValue().length==0)&&h){break}m.SetAttribute("val",this.Value.ToString())}if(this.ValueSourceIdx>=0){var e=(this.ValueList==null)?this.ParentRptSpan.ValueList:this.ValueList;var g=e[this.ValueSourceIdx];if(g.ImagePath.length>0){m.SetAttribute("img",g.ImagePath)}m.SetAttribute("idx",this.ValueSourceIdx.toString())}break;case RD3Glb.SPN_VISATTR:if((this.VisAttrIdx==0||this.VisAttrIdx==this.Parent.VisAttrIdx)&&h){break}m.SetAttribute("sty",this.GetParentBook().VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.SPN_MAXLEN:if((this.MaxLen==255||this.MaxLen==0)&&h){break}m.SetAttribute("max",this.MaxLen.toString());break;case RD3Glb.SPN_DATATYPE:if(Glb.ClassDT(this.ParentRptSpan.DataType)==Glb.DTC_CHAR&&h){break}m.SetAttribute("dat",this.ParentRptSpan.DataType.toString());break;case RD3Glb.SPN_SCALE:if(this.Scale==0&&h){break}m.SetAttribute("sca",this.Scale.toString());break;case RD3Glb.SPN_VISIBLE:if((this.Flags&IDREGlb.FL_RPTSPAN_VISIBLE)!=0&&h){break}m.SetAttribute("vis",((this.Flags&IDREGlb.FL_RPTSPAN_VISIBLE)!=0)?"1":"0");break;case RD3Glb.SPN_ENABLED:if((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0&&h){break}m.SetAttribute("ena",((this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)!=0)?"1":"0");break;case RD3Glb.SPN_STRETCH:if(this.Stretch==IDREGlb.STRTC_AUTO&&h){break}m.SetAttribute("str",this.Stretch.toString());break;case RD3Glb.SPN_TOOLTIP:if((this.ToolTip==null||this.ToolTip.length==0)&&h){break}m.SetAttribute("tip",(this.ToolTip==null)?"":this.ToolTip);break;case RD3Glb.SPN_MIME:if((this.MimeType==null||this.MimeType.length==0)&&h){break}m.SetAttribute("mim",(this.MimeType==null)?"":this.MimeType);break;case RD3Glb.SPN_HASIMAGE:if((this.Image==null||this.Image.IsEmpty())&&h){break}m.SetAttribute("him",(this.Image!=null&&!this.Image.IsEmpty())?"1":"0");break;case RD3Glb.SPN_VALUELIST:if(this.ValueList==null&&this.ParentRptSpan.ValueList.Count()==0&&h&&(this.Flags&IDREGlb.FL_RPTSPAN_ENABLED)==0){break}var e=(this.ValueList==null)?this.ParentRptSpan.ValueList:this.ValueList;if(e.Count()>0){var c=m.AddNewElement("val");for(var l=0;l<e.Count();l++){var f=e[l];f.RD3RenderDifference(c,h,this.GetMainFrm())}}break;case RD3Glb.SPN_BACKCOLOR:if(this.BackColor==-1&&h){break}m.SetAttribute("bkc",(this.BackColor==-1?"":Glb.GetWebColor(this.BackColor)));break;case RD3Glb.SPN_FORECOLOR:if(this.ForeColor==-1&&h){break}m.SetAttribute("frc",(this.ForeColor==-1?"":Glb.GetWebColor(this.ForeColor)));break;case RD3Glb.SPN_FONTMOD:if((this.FontMod==null||this.FontMod.length==0)&&h){break}m.SetAttribute("ftm",(this.FontMod==null)?"":this.FontMod);break;case RD3Glb.SPN_MASK:if((this.Mask==null||this.Mask.length==0)&&h){break}m.SetAttribute("msk",(this.Mask==null)?"":this.Mask);break;case RD3Glb.SPN_WATERMARK:if((this.Watermark==null||this.Watermark.length==0)&&h){break}m.SetAttribute("wtk",(this.Watermark==null)?"":this.Watermark);break}};function ASection(){this.Parent=null;this.ParentSection=null;this.XPos=0;this.YPos=0;this.Height=0;this.Flags=0;this.VisAttrIdx=-1;this.ColSpace=0;this.NumCol=0;this.MastroBox=null;this.DSEPosition=-1;this.BoxList=new ArrayList();this.GH_DSEPos=-1;this.GH_PageNum=-1;this.PageChanged=false;this.RD3IdentName=null}ASection.prototype.CopyFrom=function(a){this.Parent=a.Parent;this.ParentSection=a.ParentSection;this.XPos=a.XPos;this.YPos=a.YPos;this.Height=a.Height;this.Flags=a.Flags;this.VisAttrIdx=a.VisAttrIdx;this.ColSpace=a.ColSpace;this.NumCol=a.NumCol;this.MastroBox=a.MastroBox;this.DSEPosition=a.DSEPosition;this.GH_DSEPos=a.GH_DSEPos;this.GH_PageNum=a.GH_PageNum;this.PageChanged=a.PageChanged};ASection.prototype.SetHeight=function(b){var a=this.ParentSection.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};ASection.prototype.GetHeight=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};ASection.prototype.GetColSpace=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};ASection.prototype.GetYPos=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.YPos)};ASection.prototype.ContainsBoxes=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]!=null&&this.BoxList[a].GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return false}}return true};ASection.prototype.IsFullyPrinted=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]==null||!this.BoxList[a].IsFullyPrinted()){return false}}return true};ASection.prototype.IsEmpty=function(){for(var a=0;a<this.BoxList.Count();a++){if(this.BoxList[a]!=null&&!this.BoxList[a].IsEmpty()){return false}}return true};ASection.prototype.GetAsARptBox=function(){var a=new ARptBox();a.XPos=this.XPos;a.YPos=this.YPos;a.Height=this.Height;a.Width=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);a.VisAttrIdx=this.VisAttrIdx;if(this.GetFlag(IDREGlb.FL_SECT_VISIBLE)){a.InitFlags(IDREGlb.FL_RPTBOX_VISIBLE)}a.ParentSect=this;return a};ASection.prototype.FindObject=function(c){if(c==this.ParentSection){return this}for(var a=0;a<this.BoxList.Count();a++){var d=this.BoxList[a];if(d.ParentRptBox==c){return d}for(var e=0;e<d.Spans.Count();e++){if(d.Spans[e].ParentRptSpan==c){return d.Spans[e]}}}if(this.MastroBox!=null&&this.MastroBox.ParentSect!=null){return this.MastroBox.ParentSect.FindObject(c)}return null};ASection.prototype.InitFlags=function(a){this.Flags=a};ASection.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};ASection.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};ASection.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};ASection.prototype.ArrangeColumn=function(){var a=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);this.XPos=this.MastroBox.LastColumnUsed*(a+this.ColSpace);this.MastroBox.LastColumnUsed++;if(this.MastroBox.LastColumnUsed>=this.NumCol){this.MastroBox.LastColumnUsed=0;return true}else{return false}};ASection.prototype.GetPage=function(){if(this.Parent!=null){return this.Parent}else{var b=null;var a=this;while(b==null){a=a.MastroBox.ParentSect;b=a.Parent}return b}};ASection.prototype.SplitSubSection=function(d,e){var c=this.ParentSection.Parent.Parent;if(this.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),500,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has KeepTogether flag set thus can NOT be divided -> This sub-section will remain a single piece")}return false}var g=new ASection();g.CopyFrom(this);g.Height=0;var j=false;for(var a=0;a<this.BoxList.Count();a++){var k=this.BoxList[a];if(d.YFilledPos+e.YPos+this.YPos+k.YPos+k.Height<=d.Height){this.BoxList.RemoveAt(a--);g.BoxList.Add(k);k.ParentSect=g;g.Height=k.YPos+k.Height;if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(k.ParentRptBox.BoxID),501,"ASection.SplitSubSection","Sub-Box "+c.Parent.GetObjName(k.ParentRptBox.BoxID)+": Sub-Box formatted successfully");c.DTTObj.AddParameter("","","Box XPos",c.InternalUnitToString(k.XPos));c.DTTObj.AddParameter("","","Box YPos",c.InternalUnitToString(k.YPos));c.DTTObj.AddParameter("","","Box Width",c.InternalUnitToString(k.Width));c.DTTObj.AddParameter("","","Box Height",c.InternalUnitToString(k.Height))}}else{if(!j){j=true;if(k.SplitSubBox(d,g,e.YPos)){if(k.SubSections.Count()==0){this.BoxList.RemoveAt(a--)}continue}}if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(k.ParentRptBox.BoxID),502,"ASection.SplitSubSection","Sub-Box "+c.Parent.GetObjName(k.ParentRptBox.BoxID)+": Sub-Box can't be placed on the box and can NOT be split -> Storing in the cache for next page");c.DTTObj.AddParameter("","","Box YPos",c.InternalUnitToString(k.YPos));c.DTTObj.AddParameter("","","Box Height",c.InternalUnitToString(k.Height));c.DTTObj.AddParameter("","","MastroBox Height",c.InternalUnitToString(d.Height));c.DTTObj.AddParameter("","","Section YPos",c.InternalUnitToString(this.YPos))}k.YPos-=g.Height}}if(g.BoxList.Count()>0){e.SubSections.Add(g);g.MastroBox=e;e.Height=g.YPos+g.Height;var f=0;for(var a=0;a<this.BoxList.Count();a++){var k=this.BoxList[a];f=Math.max(f,k.YPos+k.Height)}this.Height=f;this.YPos=0;if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),503,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has been split in 2 parts (SubBoxes formatted = "+g.BoxList.Count()+", SubBoxes that remains in cache = "+this.BoxList.Count()+")")}return true}if(c!=null&&c.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){c.AddVerboseMsg(c.Parent.GetRTCGuid(this.ParentSection.SectionID),504,"ASection.SplitSubSection","Section "+c.Parent.GetObjName(this.ParentSection.SectionID)+": Section has NOT been split (meybe the section is too short to contain sub-boxes)")}return false};ASection.prototype.GetRD3Ident=function(){if(this.RD3IdentName==null){this.RD3IdentName="sec:S"+this.ParentSection.SectionID+"R"+(this.ParentSection.SectType==IDREGlb.SECT_DETAIL?this.ParentSection.Parent.DSE.GetRowId():this.ParentSection.Parent.DSE.GetCurrentPosition());if(this.ParentSection.Parent.ParentBox!=null){this.RD3IdentName+=":";var a=this.ParentSection.Parent.ParentBox;while(a!=null&&a.PSection.Parent!=null){this.RD3IdentName+="R"+(a.PSection.SectType==IDREGlb.SECT_DETAIL?a.PSection.Parent.DSE.GetRowId():a.PSection.Parent.DSE.GetCurrentPosition());a=a.PSection.Parent.ParentBox;if(a!=null){this.RD3IdentName+="B"+a.BoxID}}}this.RD3IdentName+=":"+this.MastroBox.ParentRptBox.PMastro.Parent.FrIndex+":"+this.MastroBox.ParentRptBox.PMastro.Parent.Parent.ParentS.Parent.FormIdx}return this.RD3IdentName};ASection.prototype.RD3RenderDifference=function(k,r,e){var o=this.GetPage();o.RD3ObjMap[this.GetRD3Ident()]=this;var h=(r?null:new BitArray(RD3Glb.SEC_MAXPROPS));var a=new IDVariant();var t=r;if(!t){if(o.RD3ChangedObjects!=null){var p=o.RD3ChangedObjects[this.GetRD3Ident()];if(p!=null){t=this.CalcRD3Difference(p,h,a)}}else{t=this.CalcRD3Difference(e.RD3ObjMap[this.GetRD3Ident()],h,a)}}var c=null;if(r){c=k.AddNewElement("sec")}if(a.isTrue()){c=k.AddNewElement("ins");if(this.ParentSection.Parent.ParentBox!=null){c.SetAttribute("parid",this.MastroBox.GetRD3Ident());var m=this.MastroBox.SubSections.IndexOf(this);c.SetAttribute("previd",(m==this.MastroBox.SubSections.Count()-1?"":(this.MastroBox.SubSections[m+1]).GetRD3Ident()))}else{c.SetAttribute("parid",o.GetRD3Ident());var g=null;var m=o.Sections.IndexOf(this);for(var f=m+1;f<o.Sections.Count()&&g==null;f++){var u=o.Sections[f];if(u.MastroBox==this.MastroBox){g=u}}c.SetAttribute("previd",(g!=null?g.GetRD3Ident():""))}t=true;h.SetAll(true)}if(c==null&&t){c=k.AddNewElement("chg")}if(c!=null){c.SetAttribute("id",this.GetRD3Ident())}if(r||t){for(var f=0;f<RD3Glb.SEC_MAXPROPS;f++){if(r||h[f]){this.SetRD3Property(f,c,r)}}}var q=t;var d=(r)?c:k;for(var l=0;l<this.BoxList.Count();l++){var j=this.BoxList[l];q|=j.RD3RenderDifference(d,r,e)}return q};ASection.prototype.CalcRD3Difference=function(c,d,a){if(c==null){a.set(true);return true}d[RD3Glb.SEC_XPOS]=(c.XPos!=this.XPos);d[RD3Glb.SEC_YPOS]=(c.YPos!=this.YPos);d[RD3Glb.SEC_WIDTH]=(c.MastroBox.Width!=this.MastroBox.Width||c.NumCol!=this.NumCol||c.ColSpace!=this.ColSpace);d[RD3Glb.SEC_HEIGHT]=(c.Height!=this.Height);d[RD3Glb.SEC_VISATTR]=(c.VisAttrIdx!=this.VisAttrIdx);d[RD3Glb.SEC_VISIBLE]=(c.GetFlag(IDREGlb.FL_SECT_VISIBLE)!=this.GetFlag(IDREGlb.FL_SECT_VISIBLE));d[RD3Glb.SEC_NUMCOL]=(c.NumCol!=this.NumCol);d[RD3Glb.SEC_COLSPACE]=(c.ColSpace!=this.ColSpace);d[RD3Glb.SEC_MASTRO]=(!c.MastroBox.GetRD3Ident().equals(this.MastroBox.GetRD3Ident()));d[RD3Glb.SEC_RECNUM]=(c.DSEPosition!=this.DSEPosition);d[RD3Glb.SEC_OVERLAY]=(c.GetFlag(IDREGlb.FL_SECT_OVERLAY)!=this.GetFlag(IDREGlb.FL_SECT_OVERLAY));for(var b=0;b<RD3Glb.SEC_MAXPROPS;b++){if(d[b]){return true}}return false};ASection.prototype.SetRD3Property=function(a,d,c){switch(a){case RD3Glb.SEC_XPOS:if(this.XPos==0&&c){break}d.SetAttribute("xp",this.XPos.toString());break;case RD3Glb.SEC_YPOS:if(this.YPos==0&&c){break}d.SetAttribute("yp",this.YPos.toString());break;case RD3Glb.SEC_HEIGHT:d.SetAttribute("hei",this.Height.toString());break;case RD3Glb.SEC_WIDTH:var b=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);d.SetAttribute("wid",b.toString());break;case RD3Glb.SEC_VISATTR:if(this.VisAttrIdx==0&&c){break}d.SetAttribute("sty",this.ParentSection.Parent.Parent.VisualStyleList.GetTrueIdx(this.VisAttrIdx).toString());break;case RD3Glb.SEC_VISIBLE:if((this.Flags&IDREGlb.FL_SECT_VISIBLE)!=0&&c){break}d.SetAttribute("vis",((this.Flags&IDREGlb.FL_SECT_VISIBLE)!=0)?"1":"0");break;case RD3Glb.SEC_COLSPACE:if(this.ColSpace==0&&c){break}d.SetAttribute("csp",this.ColSpace.toString());break;case RD3Glb.SEC_NUMCOL:if(this.NumCol==1&&c){break}d.SetAttribute("col",this.NumCol.toString());break;case RD3Glb.SEC_MASTRO:d.SetAttribute("mas",this.MastroBox.GetRD3Ident());break;case RD3Glb.SEC_RECNUM:d.SetAttribute("rec",this.DSEPosition.toString());break;case RD3Glb.SEC_OVERLAY:if((this.Flags&IDREGlb.FL_SECT_OVERLAY)==0&&c){break}d.SetAttribute("ovr",((this.Flags&IDREGlb.FL_SECT_OVERLAY)!=0)?"1":"0");break}};ASection.prototype.RD3FindBox=function(e){for(var a=0;a<this.BoxList.Count();a++){var f=this.BoxList[a];if(f.GetRD3Ident()==e){return f}if(f.SubSections!=null){for(var d=0;d<f.SubSections.Count();d++){var g=f.SubSections[d];var c=g.RD3FindBox(e);if(c!=null){return c}}}}return null};ASection.prototype.GetBoxesList=function(c){for(var b=0;b<this.BoxList.Count();b++){var d=this.BoxList[b].SubSections;if(d!=null){for(var a=0;a<d.Count();a++){subSection[a].GetBoxesList(c)}}else{c.Add(this.BoxList[b])}}};function ASectionState(){this.Parent=null;this.ParentSection=null;this.MastroBox=null;this.Height=0;this.Flags=0;this.VisAttrIdx=-1;this.ColSpace=0;this.NumCol=0;this.SavedHeight=-1;this.PrevBottomBorder=0;this.Reprint=false;this.GH_DSEPos=-1;this.GH_PageNum=-1;this.PageChanged=false;this.BoxStates=new ArrayList();this.SavedBoxStates=new ArrayList()}ASectionState.prototype.CopyFrom=function(e){this.ParentSection=e.ParentSection;this.MastroBox=e.MastroBox;this.Height=e.Height;this.InitFlags(e.GetFlags());this.VisAttrIdx=e.VisAttrIdx;this.NumCol=e.NumCol;this.ColSpace=e.ColSpace;this.PrevBottomBorder=e.PrevBottomBorder;this.PageChanged=e.PageChanged;var a=this.Parent.ParentReport.GetPermanentState(this);if(a!=null){this.InitFlags(a.Flags)}for(var d=0;d<e.BoxStates.Count();d++){var b=e.BoxStates[d];if(b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){var c=new ARptBox();c.CopyFrom(b);this.BoxStates.Add(c)}}};ASectionState.prototype.FindObject=function(c){if(c==this.ParentSection){return this}for(var b=0;b<this.BoxStates.Count();b++){var d=this.BoxStates[b];if(d.ParentRptBox==c){return d}for(var f=0;f<d.Spans.Count();f++){var a=d.Spans[f];if(a!=null&&a.ParentRptSpan==c){return d.Spans[f]}}}var e=this.ParentSection.Parent;while(e.ParentBox!=null){var h=e.ParentBox.PSection.Parent;if(h.FormattingObj==null){break}var g=h.FormattingObj.FindObject(c);if(g!=null){return g}e=e.ParentBox.PSection.Parent}return null};ASectionState.prototype.SetHeight=function(b){var a=this.ParentSection.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};ASectionState.prototype.SetColSpace=function(b){var a=this.ParentSection.Parent.Parent;this.ColSpace=a.ConvertToInternalValue(b)};ASectionState.prototype.GetHeight=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};ASectionState.prototype.GetColSpace=function(){var a=this.ParentSection.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};ASectionState.prototype.GetYPos=function(){var a=this.ParentSection.Parent.Parent;if(this.MastroBox!=null){return a.ConvertFromInternalValue(this.MastroBox.YFilledPos)}else{return -1}};ASectionState.prototype.InitFlags=function(a){this.Flags=a};ASectionState.prototype.GetFlags=function(){var a=this.Flags;if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};ASectionState.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};ASectionState.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.ParentSection.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};ASectionState.prototype.GetBottomBorder=function(){var c=0;for(var a=0;a<this.BoxStates.Count();a++){var b=this.BoxStates[a];if(!b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}c=Math.max(c,b.YPos+b.Height)}return this.Height-c};ASectionState.prototype.Arrange=function(){this.SavedBoxStates.Clear();if(this.NumCol==0){this.NumCol=this.ParentSection.NumCol}if(this.BoxStates.Count()==0){return}this.SavedHeight=this.Height;for(var k=0;k<this.BoxStates.Count();k++){var f=this.BoxStates[k];var e=new ARptBox();e.CopyFrom(f,false,false);this.SavedBoxStates.Add(e)}var d=this.ParentSection.Parent.Parent;var m=Math.floor((this.ParentSection.RendersInto.Width-(this.ParentSection.NumCol-1)*this.ParentSection.ColSpace)/this.ParentSection.NumCol);var l=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);if((m-l)*100/m>20&&this.ParentSection.NumCol==this.NumCol&&this.ParentSection.ColSpace==this.ColSpace){var h=Math.floor((this.MastroBox.Width+this.ColSpace)/(m+this.ColSpace));if(h<1){h=1}if(this.NumCol!=h&&d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentSection.SectionID),650,"ASectionState.Arrange","Section "+d.Parent.GetObjName(this.ParentSection.SectionID)+": Section width is smaller than design time by more than 20% -> Suppressing columns (from "+this.NumCol+" to "+h+", OrigColWidth = "+d.InternalUnitToString(m)+", NewColWidth = "+d.InternalUnitToString(l)+")")}this.NumCol=h}l=Math.floor((this.MastroBox.Width-(this.NumCol-1)*this.ColSpace)/this.NumCol);var o=m-l;if(o==0){return}if(d.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){d.AddVerboseMsg(d.Parent.GetRTCGuid(this.ParentSection.SectionID),505,"ASectionState.Arrange","Section "+d.Parent.GetObjName(this.ParentSection.SectionID)+": Section width is different from design time -> Adapting section's content -> DeltaWidth = "+d.InternalUnitToString(o))}var c=new ArrayList();for(var j=0;j<this.BoxStates.Count();j++){c.Add(this.BoxStates[j])}var g=new CBoxArranger();g.BookObj=d;g.Init(c,o,0,new CRect(0,0,l,this.Height));var a=100;if(this.ParentSection.Parent.Parent.UM==IDREGlb.BOOKUM_INCH){a=254}g.Arrange(a);g.Apply(true)};ASectionState.prototype.Reset=function(){if(this.SavedHeight>-1){this.Height=this.SavedHeight}for(var a=0;a<this.BoxStates.Count();a++){var c=this.BoxStates[a];if(c.SpanDivList!=null){c.SpanDivList=null}for(var b=0;b<this.SavedBoxStates.Count();b++){var d=this.SavedBoxStates[b];if(d.ParentRptBox==c.ParentRptBox){c.Width=d.Width;c.XPos=d.XPos;if(this.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){c.Height=d.Height;c.YPos=d.YPos}break}}}this.SavedBoxStates.Clear()};function CBook(){this.Name="";this.UM=IDREGlb.BOOKUM_MM;this.Flags=0;this.VisualStyleList=new VisAttrListIDRE();this.IMDB=null;this.MastroList=new ArrayList();this.ReportsList=new ArrayList();this.FrIndex=-1;this.MainFrm=null;this.DTTObj=null;this.FormattingObj=null;this.FormattingType=IDREGlb.FRM_NONE;this.FormattingPage=null;this.Parent=null;this.PE=null;this.MultiplePE=null;this.PrintDestination=IDREGlb.PRN_NONE;this.OutputFileName="";this.AutoOutFileName=false;this.WebFileName="";this.PrinterName="";this.IsPrinting=false;this.TotalPagesNumber=0;this.TotalPagesNumberConf=false;this.IsPrecounting=false;this.Bookmark=null;this.FixedWidth=0;this.FixedHeight=0;this.PrintingFromPage=-1;this.PrintingToPage=-1;this.PagesList=new ArrayList();this.ImagesPath=new ArrayList();this.DDSrcBox=null;this.DDDstBox=null;this.UpdateCount=0;this.AbortProcessReq=false;this.HtmlFontHStretch=0;this.EnabledCommands=-5;this.ChangedObj=new ArrayList()}CBook.prototype.SetMainFrm=function(a){this.MainFrm=a;this.DTTObj=a.getDTTObj()};CBook.prototype.UMastro=function(){return new IDVariant(this.MastroList.Count())};CBook.prototype.bMastro=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.MastroList.Count()?null:this.MastroList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.FindObjByID(this.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CBook.prototype.UReport=function(){return new IDVariant(this.ReportsList.Count())};CBook.prototype.bReport=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.ReportsList.Count()?null:this.ReportsList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.FindObjByID(this.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CBook.prototype.AddVerboseMsg=function(d,e,c,a,b){if(b==undefined){b=new IDVariant("")}this.DTTObj.AddMsg(DTTEngine.DTTMSG_VERB,d,e,c,a,b)};CBook.prototype.InternalUnitToString=function(a){return IDL.FormatNumber(this.ConvertFromInternalValue(a),"0.00",",","")+(this.UM==IDREGlb.BOOKUM_MM?" mm":" inch")};CBook.prototype.GetPEDevice=function(){switch(this.PrintDestination){case IDREGlb.PRN_SCREEN:return IDREGlb.DEV_SCREEN;case IDREGlb.PRN_PRINTER:return IDREGlb.DEV_PRINTER;default:return IDREGlb.DEV_NONE}};CBook.prototype.PrintPages=function(j,b){if(b==undefined){b=-1}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),401,"CBook.PrintPages","Book "+this.Name+": Printing from "+(j<=1?"beginning":"page "+j)+" to "+(b==-1?"end":"page "+b))}if((this.Flags&IDREGlb.FL_BOOK_PRECOUNT)!=0&&!this.IsPrecounting&&!this.TotalPagesNumberConf){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),402,"CBook.PrintPages","Book "+this.Name+": Precount flag active -> start precounting...")}this.IsPrecounting=true;var f=this.PrintPages(1,-1);this.RefreshPages(1);this.IsPrecounting=false;if(!f){return false}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),403,"CBook.PrintPages","Book "+this.Name+": Precount complete (Total Pages = "+this.TotalPagesNumber+") -> Restart printing from "+(j<=1?"beginning":"page "+j)+" to "+(b==-1?"end":"page "+b))}}var e=true;if(j<1){j=1}var l=b;if(this.CacheSize()!=1&&b!=-1){var m=new IDVariant(0);var d=new IDVariant(0);this.GetPageIntervals(b,m,d);j=m.intValue();b=d.intValue()}this.PE.Device=this.GetPEDevice();if(this.MultiplePE!=null){this.MultiplePE.Device=this.GetPEDevice()}var k=null;if(this.PrintDestination==IDREGlb.PRN_PDF){this.IsPrinting=true;k=this.PE;k.Device=IDREGlb.DEV_SCREEN;this.PE=new CPEPDF();this.PE.Parent=this;if(k instanceof CPEHTML){this.PE.Device=IDREGlb.DEV_PDF;if(!this.OutputFileName.equals("")&&this.AutoOutFileName){this.OutputFileName=""}if(this.OutputFileName.length==0){this.AutoOutFileName=true;while(true){this.WebFileName="temp/PDF"+Math.floor(Math.random()*2147483647)+".pdf";this.OutputFileName=this.GetBaseDir()+"/"+this.WebFileName;if(!VBFiles.FileExists(new IDVariant(this.OutputFileName))){break}}this.AddToTempFiles(this.OutputFileName);if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),404,"CBook.PrintPages","Book "+this.Name+": Printing book to PDF using random file name");this.DTTObj.AddParameter("","","Output File Name",new IDVariant(this.OutputFileName))}}else{if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),405,"CBook.PrintPages","Book "+this.Name+": Printing book to PDF");this.DTTObj.AddParameter("","","Output File Name",new IDVariant(this.OutputFileName))}}}this.PE.PDFFileName=this.OutputFileName}else{if(this.PrintDestination==IDREGlb.PRN_PRINTER){this.IsPrinting=true;k=this.PE;k.Device=IDREGlb.DEV_SCREEN;this.PE=new CPEGDI(0);this.PE.Parent=this;this.PE.Device=IDREGlb.DEV_PRINTER}}this.PrintingFromPage=j;this.PrintingToPage=b;if(this.PE.StartDocument()){if(this.DTTObj.Level>0){this.DTTObj.AddWhile(this.Parent.GetRTCGuid(0),"Book "+this.Name+".Print"+(this.IsPrecounting?" (pre-counting)":""),"")}var h=j;var c=null;do{var a=this.DTTObj.LoggedLoops;this.DTTObj.LoggedLoops=this.DTTObj.MaxLoopCycles;if(this.DTTObj.Level>0&&!this.DTTObj.CheckLoop(this.Parent.GetRTCGuid(0),h-j+1)){break}c=this.FormatPage(h-1);if(c!=null){var g=this.TotalPagesNumber;this.TotalPagesNumber=Math.max(this.TotalPagesNumber,h);if(this.Parent!=null&&this.Parent.ParentS!=null&&g!=this.TotalPagesNumber){this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGETOTAL)}if(!this.IsPrecounting&&(this.CacheSize()==1||h<=l)){this.ShowPage(c)}h++}else{this.TotalPagesNumberConf=true;if(this.Parent!=null&&this.Parent.ParentS!=null){this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}}}while((b==-1||h<=b)&&c!=null);this.DTTObj.LoggedLoops=a;if(this.DTTObj.Level>0){this.DTTObj.EndWhile(this.Parent.GetRTCGuid(0),"Book "+this.Name,"",h-j)}this.PE.EndDocument()}else{e=false;WriteToConsoleError("[CBook::PrintPages] Can't start the document")}if(this.IsPrinting){this.IsPrinting=false;this.PE=null;this.PE=k}return e};CBook.prototype.RefreshPages=function(g,b){if(b==undefined){b=-1}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),406,"CBook.RefreshPages","Book "+this.Name+": Deleting pages from "+(g<=1?"beginning":"page "+g)+" to "+(b==-1?"end":"page "+b))}this.UpdateCount++;if(g<1){g=1}if(b==-1||b>this.PagesList.Count()){b=this.PagesList.Count()}for(var a=g-1;a<b;a++){this.PagesList[a]=null}if(!this.IsPrecounting){var f=false;var d=this.TotalPagesNumber;for(this.TotalPagesNumber=this.PagesList.Count();this.TotalPagesNumber>1;this.TotalPagesNumber--){if(this.PagesList[this.TotalPagesNumber-1]==null){if(this.TotalPagesNumberConf&&this.Parent!=null&&this.Parent.ParentS!=null){this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}this.TotalPagesNumberConf=false}else{f=true}}if(!f){this.TotalPagesNumber=0}if(this.Parent!=null&&this.Parent.ParentS!=null&&d!=this.TotalPagesNumber){this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGETOTAL)}}if(g==1){for(var c=0;c<this.ReportsList.Count();c++){var e=this.ReportsList[c];if(e.DSE.IsOpen()){e.DSE.Close(e.ParentBox!=null?true:false)}}}for(var c=0;c<this.ReportsList.Count();c++){var e=this.ReportsList[c];if(e.PrintedSomething>=g&&e.PrintedSomething<=b){e.PrintedSomething=0}}this.PE.Reset();if(this.MultiplePE!=null){this.MultiplePE.Reset()}if(this.Parent!=null&&this.Parent.ParentS!=null){this.Parent.ParentS.RD3ResetPageCache()}};CBook.prototype.FormatPage=function(d){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),465,"CBook.FormatPage","Book "+this.Name+": Start formatting page "+(d+1))}if(d<=this.PagesList.Count()-1&&(this.PagesList[d]!=null)){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),466,"CBook.FormatPage","Book "+this.Name+": Page "+(d+1)+" has been already printed. Retrieving it from cache")}return this.PagesList[d]}if(d!=0&&this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),467,"CBook.FormatPage","Book "+this.Name+": Page "+(d+1)+" was not printed before. Looking for a good starting point")}var c;for(c=Math.min(d,this.PagesList.Count()-1);c>=0;c--){if(this.PagesList[c]!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),468,"CBook.FormatPage","Book "+this.Name+": Found page "+(c+1)+" in cache: starting from here")}break}}if(d!=0&&c<0&&this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),469,"CBook.FormatPage","Book "+this.Name+": Starting point not found -> start from beginning")}var f=false;if(this.PrintDestination==IDREGlb.PRN_NONE||this.PrintDestination==IDREGlb.PRN_SCREEN){for(var e=0;e<this.ReportsList.Count();e++){var h=this.ReportsList[e];if(h.ParentBox!=null&&!h.ParentBox.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&h.ParentBox.PSection!=null&&!h.ParentBox.PSection.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){f=true;break}}}if(d>=this.PagesList.Count()){IDREGlb.SetArraySize(this.PagesList,d+1)}var g=null;for(var b=c;b<d;b++){this.PagesList[b+1]=this.CreateNextPage(b==-1?null:this.PagesList[b]);g=this.PagesList[b+1];if(g==null){break}if(this.CacheSize()!=1&&d-c<this.CacheSize()){continue}if(b>-1&&(this.IsPrinting||b%10!=0)&&!f){if(this.PE.PrintingPage==this.PagesList[b]){this.PE.PrintingPage=null}this.PagesList[b]=null;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),470,"CBook.FormatPage","Book "+this.Name+": Deleting page "+(b+1)+" in order to save memory")}}}if(g!=null&&this.PE.PrintingPage!=null&&(this.PE.PrintingPage.PageNum-1)%10!=0&&!f&&this.CacheSize()==1){var a=this.PE.PrintingPage.PageNum-1;this.PE.PrintingPage=null;if(this.PagesList[a]!=null){this.PagesList[a]=null;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),471,"CBook.FormatPage","Book "+this.Name+": Deleting page "+(a+1)+" in order to save memory")}}}return g};CBook.prototype.CreateNextPage=function(e){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),472,"CBook.CreateNextPage","Book "+this.Name+": Looking for a report that needs to print something and asking him which page it needs")}var v=null;for(var m=0;m<this.ReportsList.Count();m++){var c=this.ReportsList[m];if(c.ParentBox!=null){continue}if(!c.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(c.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}v=c.GetNextMastro(e);if(v!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(c.ReportID),473,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(c.ReportID)+": Report asks for a new page of type '"+this.Parent.GetObjName(v.MastroID)+"'")}break}}if(v==null){for(var m=0;m<this.ReportsList.Count();m++){var c=this.ReportsList[m];if(c.ParentBox!=null){continue}if(!c.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(c.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){continue}if(c.DSE.IsOpen()&&!c.DSE.IsEof()&&(c.PrintedSomething==0||(e!=null&&c.PrintedSomething>e.PageNum))){v=c.GetNextMastro(null);if(v!=null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(c.ReportID),473,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(c.ReportID)+": Book was finished but report was never started and asks for a new page of type '"+this.Parent.GetObjName(v.MastroID)+"'")}break}}}}if(v==null){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(0),474,"CBook.CreateNextPage","Book "+this.Name+": No report wants to print anything. Done printing")}return null}var u=new APage(v);this.FormattingPage=u;u.PageNum=(e!=null?e.PageNum+1:1);var a=this.PE.GetPageSize();if(u.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE){var k=a.Width;a.Width=a.Height;a.Height=k}if(a.Width==0&&a.Height==0){a=new Object();a.Width=u.Width;a.Height=u.Height}if(u.FitMode>=IDREGlb.MASTRO_FM_WIDTH){var j=new Object();j.Width=u.Width;j.Height=u.Height;if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ParentMastro.MastroID),475,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(u.ParentMastro.MastroID)+": FitMode = "+(u.FitMode==IDREGlb.MASTRO_FM_PAGE?"Page":"Width")+" -> handling "+(u.FitMode==IDREGlb.MASTRO_FM_PAGE?"page":"horizontal")+" resize")}var w=200;if(this.UM==IDREGlb.BOOKUM_INCH){w=Math.floor(w/2.54)}var p=0;var o=(this.MainFrm instanceof WebEntryPointSrv&&this.MainFrm.IsMobile());if(this.PE!=null&&this.PE instanceof CPEHTML&&u.FitMode==IDREGlb.MASTRO_FM_WIDTH&&!o){var q=new Object();q.Width=24;q.Height=0;this.ConvertFromPixelToPhysical(q,this.UM);p=q.Width}if(u.Orientation==IDREGlb.MASTRO_OR_PORTRAIT&&Math.abs(u.Width-a.Width)>w){u.Width=a.Width-p}if(u.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE&&Math.abs(u.Height-a.Height)>w){u.Height=a.Height-p}if(u.FitMode==IDREGlb.MASTRO_FM_PAGE){if(u.Orientation==IDREGlb.MASTRO_OR_PORTRAIT&&Math.abs(u.Height-a.Height)>w){u.Height=a.Height}if(u.Orientation==IDREGlb.MASTRO_OR_LANDSCAPE&&Math.abs(u.Width-a.Width)>w){u.Width=a.Width}}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){if(j.Width!=u.Width){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ParentMastro.MastroID),476,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(u.ParentMastro.MastroID)+": Width changed from "+this.InternalUnitToString(j.Width)+" to "+this.InternalUnitToString(u.Width))}if(j.Height!=u.Height){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ParentMastro.MastroID),476,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(u.ParentMastro.MastroID)+": Heigth changed from "+this.InternalUnitToString(j.Height)+" to "+this.InternalUnitToString(u.Height))}}}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(u.ParentMastro.MastroID),477,"CBook.CreateNextPage","Page "+this.Parent.GetObjName(u.ParentMastro.MastroID)+": Fire OnFormatting event")}this.FormattingObj=u;this.FormattingType=IDREGlb.FRM_PAGE;var l=this.Parent.GetNewID2OldID(u.ParentMastro.MastroID);this.Parent.Fire_OnFormattingPage(l);this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null;u.Arrange();var d=new HashTableSrv();for(var x=0;x<u.MastroBoxes.Count();x++){var h=u.MastroBoxes[x];if(h.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.PE.CanScroll){d[h]=h.Height;h.Height=2147483646}}for(var m=0;m<this.ReportsList.Count();m++){var s=this.ReportsList[m];if(s.ParentBox!=null){continue}if(!s.GetFlag(IDREGlb.FL_REPORT_VISIBLE)){continue}if(s.GetFlag(IDREGlb.FL_REPORT_ANYPAGE)){s.DSE.Close();if(e!=null&&e.GetState(s)!=null){for(var f=0;f<e.ReportStates.Count();f++){var g=e.ReportStates[f];if(g.ParentReport==s){e.ReportStates.Remove(g);break}}}}if(!s.DSE.IsOpen()){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(s.ReportID),478,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(s.ReportID)+": Opening data source")}s.OpenDSE()}else{if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(s.ReportID),479,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(s.ReportID)+": Data source was already open")}}if(s.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)&&s.DSE.GetNumRecords()==0){if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg(this.Parent.GetRTCGuid(s.ReportID),480,"CBook.CreateNextPage","Report "+this.Parent.GetObjName(s.ReportID)+": HideIfEmpty flag set and data source is empty -> skipping report")}continue}if(this.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.AddVerboseMsg("",0,"","---------- Report "+this.Parent.GetObjName(s.ReportID)+" ----------")}s.FormatPage(e,u)}u.RotateSections(null);this.FormattingPage=null;for(var x=0;x<u.MastroBoxes.Count();x++){var h=u.MastroBoxes[x];if(h.GetFlag(IDREGlb.FL_RPTBOX_CANSCROLL)&&this.PE.CanScroll&&d[h]!=null){h.Height=d[h]}}if(u.Sections.Count()==0){u=null}return u};CBook.prototype.ShowPage=function(a){if(this.Parent!=null&&this.Parent.ParentS!=null&&(this.PE.LastRD3Page==null||a==null||this.PE.LastRD3Page.PageNum!=a.PageNum)){this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGENUM)}this.PE.PrintPage(a);if(this.MultiplePE!=null){this.MultiplePE.PrintPage(a)}if(a!=null){a.Dump()}};CBook.prototype.GetFormattingObj=function(a){switch(this.FormattingType){case IDREGlb.FRM_SECTION:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_SECTION_AFT:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_PAGE:return this.FormattingObj.FindObject(a);case IDREGlb.FRM_SECTION_PERM:return this.FormattingObj.FindObject(a)}return null};CBook.prototype.IsChildOfFormattingObj=function(a){switch(this.FormattingType){case IDREGlb.FRM_SECTION:return this.FormattingObj.ParentSection.IsChildOf(a);case IDREGlb.FRM_SECTION_AFT:return this.FormattingObj.ParentSection.IsChildOf(a);case IDREGlb.FRM_PAGE:return this.FormattingObj.ParentMastro.IsChildOf(a);case IDREGlb.FRM_SECTION_PERM:return this.FormattingObj.ParentSection.IsChildOf(a)}return false};CBook.prototype.Update=function(d){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),407,"CBook.Update","Book "+this.Name+": IMDB is changed")}this.UpdateCount++;var b=false;for(var e=0;e<this.ReportsList.Count();e++){var f=this.ReportsList[e];if(f.ParentBox!=null){continue}if(f.DSE.UpdateIMDB(d)){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(f.ReportID),408,"CBook.Update","Report "+this.Parent.GetObjName(f.ReportID)+": Query has changed.")}b=true}}if(!b){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),409,"CBook.Update","Book "+this.Name+": None of reports query have changed. Skipping update")}return}var c=-1;if(this.PE!=null&&this.PE.PrintingPage!=null){c=this.PE.PrintingPage.PageNum;if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(0),410,"CBook.Update","Book "+this.Name+": Page "+c+" was shown at the moment. Updating book from beginning to this page")}}var a=this.PagesList.Count();this.PagesList.Clear();if(this.Parent!=null){if(this.Parent.ParentS!=null){this.Parent.ParentS.RD3ResetPageCache();this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGENUM);this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGETOTAL);this.Parent.ParentS.RD3Change(RD3Glb.BOK_PAGECONFIRMED)}}this.PE.PrintingPage=null;this.TotalPagesNumber=0;this.TotalPagesNumberConf=false;if(c==-1){c=1}this.PrintPages(1,c);if(a!=0&&(this.PagesList.Count()==0||(this.PagesList.Count()==1&&this.PagesList[0]==null))){this.Parent.set_RD(true)}};CBook.prototype.ProcessRequest=function(s,p){this.AbortProcessReq=false;var k=this.UpdateCount;this.DDSrcBox=null;this.DDDstBox=null;if(!this.PE.ProcessRequest(s,p)&&!p){var d=s.GetParameter("DDDstID");if(d!=null){var h=s.GetParameter("DDSrcID");this.DDSrcBox=this.GetABoxByID(h);this.DDDstBox=this.GetABoxByID(d);this.BoxDrop(this.DDSrcBox,this.DDDstBox);if(this.UpdateCount!=k){this.AbortProcessReq=true}return}var g=s.GetParameter("DDTrID");if(g!=null){var c=s.GetParameter("DDNewX");var a=s.GetParameter("DDNewY");var e=s.GetParameter("DDNewW");var r=s.GetParameter("DDNewH");var m=this.GetABoxByID(g);if(m!=null){if((m.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return}var l=0,j=0,o=0,f=0;if(c!=null){l=parseFloat(c)}else{l=this.ConvertFromInternalValue(m.XPos)}if(a!=null){j=parseFloat(a)}else{j=this.ConvertFromInternalValue(m.YPos)}if(e!=null){o=parseFloat(e)}else{o=this.ConvertFromInternalValue(m.Width)}if(r!=null){f=parseFloat(r)}else{f=this.ConvertFromInternalValue(m.Height)}this.MoveDSEPositions(m);var q=m;while(q.ParentSect!=null){if(c!=null){l-=this.ConvertFromInternalValue(q.ParentSect.XPos)}if(a!=null){j-=this.ConvertFromInternalValue(q.ParentSect.YPos)}q=q.ParentSect.MastroBox;if(c!=null){l-=this.ConvertFromInternalValue(q.XPos)}if(a!=null){j-=this.ConvertFromInternalValue(q.YPos)}}var t=new IDVariant(false);this.FormattingObj=m.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM;this.Parent.Fire_OnBoxTransform(m.ParentRptBox.BoxID,l,j,o,f,t);this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null;if(this.UpdateCount!=k){this.AbortProcessReq=true}}return}}};CBook.prototype.GetABoxByID=function(f){var l="F"+this.FrIndex;if(f.indexOf(l)<0){return null}f=f.substr(l.length);for(var c=0;c<this.PagesList.Count();c++){var e=this.PagesList[c];for(var j=0;j<e.MastroBoxes.Count();j++){var k=e.MastroBoxes[j];var a=k.GetBoxByID(f);if(a!=null){return a}}for(var h=0;h<e.Sections.Count();h++){var d=e.Sections[h];for(var j=0;j<d.BoxList.Count();j++){var g=d.BoxList[j];var a=g.GetBoxByID(f);if(a!=null){return a}}}}return null};CBook.prototype.ConvertToInternalValue=function(a){return Math.floor(a*(this.UM==IDREGlb.BOOKUM_MM?100:1000))};CBook.prototype.ConvertFromInternalValue=function(a){return(a/(this.UM==IDREGlb.BOOKUM_MM?100:1000))};CBook.prototype.ConvertFromPixelToPhysical=function(b,a){b.Width=Math.floor(b.Width/96*1000);b.Height=Math.floor(b.Height/96*1000);if(a==IDREGlb.BOOKUM_MM){b.Width=Math.floor(b.Width*2.54);b.Height=Math.floor(b.Height*2.54)}return b};CBook.prototype.ConvertFromPhysicalToPixel=function(c){var a=0,b=0;if(this.UM==IDREGlb.BOOKUM_MM){a=c.Width/100/25.4;b=c.Height/100/25.4}else{if(this.UM==IDREGlb.BOOKUM_INCH){a=c.Width/1000;b=c.Height/1000}}c.Width=Math.floor(a*96);c.Height=Math.floor(b*96);return c};CBook.prototype.MoveDSEPositions=function(d){if(d.ParentSect!=null){var c=new ArrayList();var a=d.ParentRptBox;while(a!=null){c.Insert(0,a);a=a.PSection.Parent.ParentBox}for(var b=0;b<c.Count();b++){a=c[b];if(a.PSection.Parent.ParentBox!=null){a.PSection.Parent.DSE.Close();a.PSection.Parent.DSE.UpdateIMDB(true);a.PSection.Parent.DSE.Open()}a.PSection.Parent.DSE.SetCurrentPosition(d.DSEPositions[b])}}};CBook.prototype.BoxActivated=function(a){this.DTTObj.SetRequestName("Activate Box","Book "+this.Name+": box "+a.ParentRptBox.BoxID+" activated",DTTRequest.PRI_CMD);if((a.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),411,"CBook.BoxActivated","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been activated but a Role item prevent the box to be ENABLED -> skipping activation")}return}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),412,"CBook.BoxActivated","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been activated -> Activating object connected with the box")}if(a.ParentSect!=null){this.MoveDSEPositions(a);this.FormattingObj=a.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM;var b=this.Parent.GetNewID2OldID(a.ParentRptBox.BoxID);this.Parent.Fire_Activated(b,a.GetHTMLName());this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null}else{this.FormattingObj=a.ParentPage;this.FormattingType=IDREGlb.FRM_PAGE;var b=this.Parent.GetNewID2OldID(a.ParentRptBox.BoxID);this.Parent.Fire_Activated(b,a.GetHTMLName());this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null}};CBook.prototype.AddToTempFiles=function(a){if(this.Parent.ParentS!=null){this.Parent.ParentS.Parent.MainFrm.TempFiles.Add(a)}};CBook.prototype.GetBaseDir=function(){if(this.Parent.ParentS!=null){return this.Parent.ParentS.Parent.MainFrm.RealPath}};CBook.prototype.GetLastCachedPage=function(){for(var a=this.PagesList.Count()-1;a>=0;a--){if(this.PagesList[a]!=null){return this.PagesList[a]}}return null};CBook.AdaptWebFileName=function(a){if(a.indexOf("/")!=-1||a.indexOf("\\")!=-1){return a}return"images/"+a};CBook.prototype.RD3RenderDifference=function(d,b,c){var a=this.PE.RD3RenderDifference(d,b,c);this.ChangedObj.Clear();return a};CBook.prototype.RD3FindSpan=function(a){return this.PE.RD3FindSpan(a)};CBook.prototype.RD3FindBox=function(a){return this.PE.RD3FindBox(a)};CBook.prototype.BoxDrop=function(a,b){if(a==null||b==null){return}this.DDSrcBox=a;this.DDDstBox=b;if((this.DDSrcBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0||(this.DDDstBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){if(this.DTTObj.Level>0){var c="";if((this.DDSrcBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){c="source"}else{if((this.DDDstBox.ParentRptBox.RoleFlag&IDREGlb.OBJ_ENABLED)==0){c="destination"}}this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),413,"CBook.BoxDrop","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been dropped onto box "+this.Parent.GetObjName(b.ParentRptBox.BoxID)+" but "+c+" box's Role prevent the box to handle the operation > Skipping")}return}this.MoveDSEPositions(this.DDDstBox);if(this.DDDstBox.ParentSect!=null){this.FormattingObj=this.DDDstBox.ParentSect;this.FormattingType=IDREGlb.FRM_SECTION_PERM}else{this.FormattingObj=this.DDDstBox.ParentPage;this.FormattingType=IDREGlb.FRM_PAGE}if(this.DTTObj.Level>0){this.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.Parent.GetRTCGuid(a.ParentRptBox.BoxID),414,"CBook.BoxDrop","Box "+this.Parent.GetObjName(a.ParentRptBox.BoxID)+": Box has been dropped onto box "+this.Parent.GetObjName(b.ParentRptBox.BoxID)+" -> Fire OnBoxDrop event")}this.Parent.Fire_OnBoxDrop(this.Parent.GetNewID2OldID(this.DDSrcBox.ParentRptBox.BoxID),this.Parent.GetNewID2OldID(this.DDDstBox.ParentRptBox.BoxID));this.FormattingType=IDREGlb.FRM_NONE;this.FormattingObj=null};CBook.prototype.GetSubForm=function(h){var e=new ArrayList(this.PagesList);if(this.FormattingPage!=null&&!e.Contains(this.FormattingPage)){e.Add(this.FormattingPage)}for(var g=0;g<e.Count();g++){var j=e[g];if(j==null){continue}for(var a=0;a<j.MastroBoxes.Count();a++){var f=j.MastroBoxes[a];if(f.SubForm!=null&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}for(var d=0;d<j.Sections.Count();d++){var c=j.Sections[d];for(var a=0;a<c.BoxList.Count();a++){var f=c.BoxList[a];if(f.SubForm!=null&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}}}if(this.FormattingType==IDREGlb.FRM_SECTION&&this.FormattingObj!=null){var c=this.FormattingObj;for(var a=0;a<c.BoxStates.Count();a++){var f=c.BoxStates[a];if(f.SubForm!=null&&f.SubForm.FormIdx>65536&&!h.Contains(f.SubForm)){h.Add(f.SubForm);f.SubForm.GetSubForm(h)}}}};CBook.prototype.CacheSize=function(){if(this.PE==null||!(this.PE instanceof CPEHTML)){return 1}return this.PE.CacheSize};CBook.prototype.set_CacheSize=function(c){if(this.PE==null||!(this.PE instanceof CPEHTML)){return}this.PE.CacheSize=c;var a=this.PE.LastRD3MultiPages;this.PE.LastRD3MultiPages=new Array(this.PE.CacheSize);if(a!=null){for(var b=0;b<Math.min(a.length,this.PE.CacheSize);b++){this.PE.LastRD3MultiPages[b]=a[b]}}};CBook.prototype.GetPageIntervals=function(f,e,a){var d=this.CacheSize();var b=f-Math.floor(d/2);var c=f+Math.floor(d/2);if(d%2==0){b++}if(this.TotalPagesNumberConf&&this.TotalPagesNumber<d){b=1;c=this.TotalPagesNumber}else{if(this.TotalPagesNumberConf&&f>this.TotalPagesNumber-d){c=this.TotalPagesNumber;b=Math.max(c-d+1,1)}if(b<=0){c+=-b+1;b+=-b+1}}e.set(new IDVariant(b));a.set(new IDVariant(c))};CBook.prototype.getPage=function(c){var b=null;if(c<this.PagesList.Count()){b=this.PagesList[c]}if(b==null){var a=this.PE.PrintingPage.PageNum;this.PrintPages(c+1,c+1);if(this.PE.PrintingPage.PageNum==a){return null}b=this.PagesList[c]}return b};function CCell(){this.BoxList=new ArrayList();this.Top=0;this.Height=0;this.Left=0;this.Width=0}function CBoxArranger(){this.Rows=0;this.Columns=0;this.MissingWidth=0;this.MissingHeight=0;this.Container;this.GridSize=0;this.BookObj=null;this.Matrix;this.BoxList}CBoxArranger.prototype.Init=function(g,h,u,e){this.Rows=0;this.Columns=0;this.BoxList=g;this.MissingWidth=h;this.MissingHeight=u;this.Container=e;var d,s;var l=new ArrayList();var q=new ArrayList();for(var t=0;t<this.BoxList.Count();t++){var p=this.BoxList[t];var k=p.XPos;var j=p.YPos;var m=p.Width;var a=p.Height;for(d=0;d<l.Count();d++){if(l[d]==j){break}}if(d==l.Count()){var o=0;for(o=0;o<l.Count();o++){if(l[o]>j){break}}l.Insert(o,j)}for(d=0;d<l.Count();d++){if(l[d]==j+a){break}}if(d==l.Count()){var o=0;for(o=0;o<l.Count();o++){if(l[o]>j+a){break}}l.Insert(o,(j+a))}for(s=0;s<q.Count();s++){if(q[s]==k){break}}if(s==q.Count()){var o=0;for(o=0;o<q.Count();o++){if(q[o]>k){break}}q.Insert(o,k)}for(s=0;s<q.Count();s++){if(q[s]==k+m){break}}if(s==q.Count()){var o=0;for(o=0;o<q.Count();o++){if(q[o]>k+m){break}}q.Insert(o,(k+m))}}this.Matrix=new Array(l.Count());for(var o=0;o<l.Count();o++){this.Matrix[o]=new Array(q.Count())}for(d=0;d<l.Count()-1;d++){for(s=0;s<q.Count()-1;s++){var f=new CCell();this.Matrix[d][s]=f;f.Top=l[d];f.Height=l[d+1]-l[d];f.Left=q[s];f.Width=q[s+1]-q[s];for(var t=0;t<this.BoxList.Count();t++){var p=this.BoxList[t];var k=p.XPos;var j=p.YPos;var m=p.Width;var a=p.Height;if(k<=f.Left&&k+m>=f.Left+f.Width&&j<=f.Top&&j+a>=f.Top+f.Height){f.BoxList.Add(p)}}}}this.Rows=l.Count()-1;this.Columns=q.Count()-1};CBoxArranger.prototype.Arrange=function(a){if(this.Rows==0||this.Columns==0){return}this.GridSize=a;if(this.MissingWidth!=0){this.ArrangeBand(false)}if(this.MissingHeight!=0){this.ArrangeBand(true)}};CBoxArranger.prototype.ArrangeBand=function(p){var l,k;var f=0;var r=new Array(p?this.Rows:this.Columns);var m=new Array(p?this.Rows:this.Columns);var e=(p?this.MissingHeight:this.MissingWidth);var s=0;for(l=0;l<(p?this.Rows:this.Columns);l++){m[l]=true;r[l]=false;for(k=0;k<(p?this.Columns:this.Rows);k++){var d;if(p){d=this.Matrix[l][k]}else{d=this.Matrix[k][l]}if(d.BoxList.Count()>0){m[l]=false;for(var q=0;q<d.BoxList.Count();q++){var o=d.BoxList[q];r[l]|=(p?o.VRsz:o.HRsz)!=IDREGlb.RSZ_STRETCH}}}if(!r[l]){if(m[l]){s+=(p?this.Matrix[l][0].Height:this.Matrix[0][l].Width)*e/(p?this.Container.height:this.Container.width)}else{f+=(p?this.Matrix[l][0].Height:this.Matrix[0][l].Width)-this.GridSize}}}if(this.GridSize>0){s=Math.floor(s/this.GridSize)*this.GridSize}var c=e;e-=s;if(e>f){e=f}if(e==0||f==0){return}for(l=0;l<(p?this.Rows:this.Columns);l++){var g=0;if(!r[l]){if(m[l]){g=(p?this.Matrix[l][0].Height:this.Matrix[0][l].Width)*c/(p?this.Container.height:this.Container.width)}else{g=((p?this.Matrix[l][0].Height:this.Matrix[0][l].Width)-this.GridSize)*e/f}}if(g!=0){for(k=0;k<(p?this.Columns:this.Rows);k++){var d;if(p){d=this.Matrix[l][k]}else{d=this.Matrix[k][l]}if(p){d.Height-=g}else{d.Width-=g}}for(var j=l+1;j<(p?this.Rows:this.Columns);j++){for(var h=0;h<(p?this.Columns:this.Rows);h++){var a;if(p){a=this.Matrix[j][h]}else{a=this.Matrix[h][j]}if(p){a.Top-=g}else{a.Left-=g}}}}}};CBoxArranger.prototype.Apply=function(a){if(this.MissingWidth!=0){this.ApplyBand(false)}if(this.MissingHeight!=0){this.ApplyBand(true)}if(a){this.DoKeepInside()}};CBoxArranger.prototype.ApplyBand=function(f){var l=new HashTableSrv();var o=new HashTableSrv();var d,c;for(d=0;d<(f?this.Columns:this.Rows);d++){for(c=0;c<(f?this.Rows:this.Columns);c++){var a;if(f){a=this.Matrix[c][d]}else{a=this.Matrix[d][c]}if(a.BoxList.Count()>0){for(var k=0;k<a.BoxList.Count();k++){var e=a.BoxList[k];var p=l[e.GetRD3Ident()];if(p==null){p=new CCell();if(f){p.Top=a.Top}else{p.Left=a.Left}l[e.GetRD3Ident()]=p;o[e.GetRD3Ident()]=e}if(p.Left==a.Left){p.Width=0}if(p.Top==a.Top){p.Height=0}if(f){p.Height+=a.Height}else{p.Width+=a.Width}}}}}if(this.GridSize>0){var j=l.keys();for(var m=0;m<j.length;m++){var e=o[j[m]];var p=l[e.GetRD3Ident()];if(e!=null&&p!=null){if(f){p.Top=Math.floor(p.Top/this.GridSize+0.5)*this.GridSize;p.Height=Math.floor(p.Height/this.GridSize+0.5)*this.GridSize}else{p.Left=Math.floor(p.Left/this.GridSize+0.5)*this.GridSize;p.Width=Math.floor(p.Width/this.GridSize+0.5)*this.GridSize}}}}var h=l.keys();for(var g=0;g<h.length;g++){var e=o[h[g]];var p=l[e.GetRD3Ident()];if(e!=null&&p!=null){if(f){if(e.VRsz>=IDREGlb.RSZ_MOVE){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.YPos!=p.Top){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),506,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box moved and changed Top from "+this.BookObj.InternalUnitToString(e.YPos)+" to "+this.BookObj.InternalUnitToString(p.Top))}e.YPos=p.Top}if(e.VRsz==IDREGlb.RSZ_STRETCH){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.Height!=p.Height){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),507,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box adapted and changed Height from "+this.BookObj.InternalUnitToString(e.Height)+" to "+this.BookObj.InternalUnitToString(p.Height))}e.Height=p.Height}}else{if(e.HRsz>=IDREGlb.RSZ_MOVE){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.XPos!=p.Left){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),506,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box moved and changed Left from "+this.BookObj.InternalUnitToString(e.XPos)+" to "+this.BookObj.InternalUnitToString(p.Left))}e.XPos=p.Left}if(e.HRsz==IDREGlb.RSZ_STRETCH){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&e.Width!=p.Width){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(e.ParentRptBox.BoxID),507,"CBoxArranger.ApplyBand","Box "+this.BookObj.Parent.GetObjName(e.ParentRptBox.BoxID)+": Box adapted and changed Width from "+this.BookObj.InternalUnitToString(e.Width)+" to "+this.BookObj.InternalUnitToString(p.Width))}e.Width=p.Width}}}}};CBoxArranger.prototype.DoKeepInside=function(){for(var a=0;a<this.BoxList.Count();a++){var c=this.BoxList[a];var e=new CRect(c.XPos,c.YPos,c.XPos+c.Width,c.YPos+c.Height);var d=new CRect();d.Intersect(this.Container,e);if(d!=e){if(e.width>this.Container.width){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&c.Width!=this.Container.width){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),508,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was too big for its container and changed Width from "+this.BookObj.InternalUnitToString(c.Width)+" to "+this.BookObj.InternalUnitToString(this.Container.width))}c.Width=this.Container.width;e.setRight(e.left()+this.Container.width)}if(e.height>this.Container.height){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&c.Height!=this.Container.height){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),508,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was too big for its container and changed Height from "+this.BookObj.InternalUnitToString(c.Height)+" to "+this.BookObj.InternalUnitToString(this.Container.height))}c.Height=this.Container.height;e.setBottom(e.top()+this.Container.height)}if(e.left()<0){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved horizzontally from "+this.BookObj.InternalUnitToString(c.XPos)+" to "+this.BookObj.InternalUnitToString(0))}c.XPos=0}if(e.top()<0){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved vertically from "+this.BookObj.InternalUnitToString(c.YPos)+" to "+this.BookObj.InternalUnitToString(0))}c.YPos=0}if(e.right()>this.Container.right()){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved horizzontally from "+this.BookObj.InternalUnitToString(c.XPos)+" to "+this.BookObj.InternalUnitToString(this.Container.right()-e.width))}c.XPos=this.Container.right()-e.width}if(e.bottom()>this.Container.bottom()){if(this.BookObj!=null&&this.BookObj.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.BookObj.AddVerboseMsg(this.BookObj.Parent.GetRTCGuid(c.ParentRptBox.BoxID),509,"CBoxArranger.DoKeepInside","Box "+this.BookObj.Parent.GetObjName(c.ParentRptBox.BoxID)+": Box was exiting from its container and moved vertically from "+this.BookObj.InternalUnitToString(c.YPos)+" to "+this.BookObj.InternalUnitToString(this.Container.bottom()-e.height))}c.YPos=this.Container.bottom()-e.height}}}};CBoxArranger.prototype.Dump=function(a){WriteToConsoleOutput("\n"+a+"\n");for(var b=0;b<this.Rows;b++){for(var e=0;e<this.Columns;e++){var d=this.Matrix[b][e];WriteToConsoleOutput("   ("+b+","+e+") = X="+d.Left+", Y="+d.Top+", W="+d.Width+", H="+d.Height)}}};function CDSEAggr(){this.CountNN=0;this.Sum=new IDVariant();this.Sum2=0;this.Min=new IDVariant();this.Max=new IDVariant();this.DistinctSum=new IDVariant();this.UpdateDistinctSum=true}CDSEAggr.prototype.Update=function(a){if(a instanceof IDVariant){if(a.Type==IDVariant.NULL){return}this.CountNN++;if(this.Max.Type==IDVariant.NULL||a.CompareTo(this.Max)>0){this.Max=a}if(this.Min.Type==IDVariant.NULL||a.CompareTo(this.Min)<0){this.Min=a}if(this.IsNumber(a)){this.Sum.set(IDL.Add(this.Sum,a));var c=a.dblValue();this.Sum2+=c*c;if(this.UpdateDistinctSum){this.UpdateDistinctSum=false;this.DistinctSum.set(IDL.Add(this.DistinctSum,a))}}}else{if(a instanceof CDSEAggr){var b=a;this.CountNN+=b.CountNN;if(this.Max.Type==IDVariant.NULL||b.Max.CompareTo(this.Max)>0){this.Max=b.Max}if(this.Min.Type==IDVariant.NULL||b.Min.CompareTo(this.Min)<0){this.Min=b.Min}this.Sum.set(IDL.Add(this.Sum,b.Sum));this.DistinctSum.set(IDL.Add(this.DistinctSum,b.DistinctSum));this.Sum2+=b.Sum2}}};CDSEAggr.prototype.Compare=function(b,a){return b.CompareTo(a)};CDSEAggr.prototype.IsNumber=function(a){switch(a.Type){case IDVariant.INTEGER:case IDVariant.FLOAT:case IDVariant.DECIMAL:return true;default:return false}};CDSEAggr.prototype.GetAggrFunct=function(c,e){switch(c){case IDREGlb.AGGR_SUM:e.set(this.Sum);break;case IDREGlb.AGGR_AVE:if(this.CountNN==0){break}e.set(IDL.Div(this.Sum,new IDVariant(this.CountNN)));break;case IDREGlb.AGGR_VAR:this.GetAggrFunct(IDREGlb.AGGR_DEV,e);e.set(IDL.Mul(e,e));break;case IDREGlb.AGGR_DEV:var b=this.Sum.dblValue();var a=b/this.CountNN;var d=Math.sqrt((this.Sum2+this.CountNN*a*a-2*a*b)/(this.CountNN-1));e.set(new IDVariant(d));break;case IDREGlb.AGGR_CNT:e.set(new IDVariant(this.CountNN));break;case IDREGlb.AGGR_MIN:e.set(this.Min);break;case IDREGlb.AGGR_MAX:e.set(this.Max);break;case IDREGlb.AGGR_DSUM:e.set(this.DistinctSum);break}};function CDSEBase(){this.OpenState=false;this.flOrderData=false;this.MaxRows=0;this.Parent=null;this.GroupStringArray=new ArrayList();this.GroupArray=new ArrayList();this.Root=null;this.iGuid="";this.iAbsolutePosition=0;this.iRecordCount=0;this.iColumnCount=0;this.FieldNames=new ArrayList()}CDSEBase.prototype.GetFldIdx=function(a){return -1};CDSEBase.prototype.FieldName=function(a){return null};CDSEBase.prototype.GetFldParam=function(d,b,a,c){};CDSEBase.prototype.IsMyGroupTime=function(d,b,a){var c=(a!=null)?a.ActualPosition:this.iAbsolutePosition;if(this.Root==null){return false}if(c==0||this.IsEof()){return false}return this.Root.IsMyGroupTime(c,b,d)};CDSEBase.prototype.Next=function(a,c){if(a==undefined){a=null}if(c==undefined){c=false}if(a!=null){this.SetCurrentPosition(a.ActualPosition)}if(a!=null&&this.IsEof()){return null}if(!this.IsOpen()){return null}if(this.iAbsolutePosition==0||(this.IsEof()&&a==null)){this.MoveFirst();this.iAbsolutePosition=1}else{this.MoveNext();this.iAbsolutePosition++}var b=null;if(c){b=new ADSEState();b.ActualPosition=this.GetCurrentPosition()}return b};CDSEBase.prototype.GetCurrentPosition=function(){return this.iAbsolutePosition};CDSEBase.prototype.SetCurrentPosition=function(a){if(a==0){this.MoveFirst();this.MovePrevious();this.iAbsolutePosition=a}else{if(a>this.GetNumRecords()){this.MoveLast();this.MoveNext();this.iAbsolutePosition=this.GetNumRecords()+1}else{if(a>this.iAbsolutePosition){if(this.iAbsolutePosition==0){this.MoveFirst();this.iAbsolutePosition=1}while(this.iAbsolutePosition<a){this.iAbsolutePosition++;this.MoveNext()}}else{if(a<this.iAbsolutePosition){if(this.iAbsolutePosition>this.GetNumRecords()){this.MoveLast();this.iAbsolutePosition=this.GetNumRecords()}while(this.iAbsolutePosition>a){this.iAbsolutePosition--;this.MovePrevious()}}}}}};CDSEBase.prototype.GetNumRecords=function(){return this.iRecordCount};CDSEBase.prototype.IsEof=function(){return true};CDSEBase.prototype.IsOpen=function(){return this.OpenState};CDSEBase.prototype.GetFieldValue=function(a,b){a.set(new IDVariant(0))};CDSEBase.prototype.SetFieldValue=function(b,a){};CDSEBase.prototype.GetNumColumns=function(){return this.iColumnCount};CDSEBase.prototype.GetFieldName=function(a){return this.FieldNames[a]};CDSEBase.prototype.AddGroup=function(b){for(var a=0;a<this.GroupStringArray.Count();a++){if(this.GroupStringArray[a]==b){return a}}this.GroupStringArray.Add(b);return this.GroupStringArray.Count()-1};CDSEBase.prototype.Open=function(){this.OpenState=true;this.iAbsolutePosition=1;this.iRecordCount=this.RecordCount();this.iColumnCount=this.ColumnCount();if(this.iRecordCount>0){IDREGlb.SetArraySize(this.FieldNames,this.iColumnCount);for(var a=0;a<this.iColumnCount;a++){this.FieldNames[a]=this.FieldName(a+1)}this.CreateGroups()}this.SetCurrentPosition(0);return true};CDSEBase.prototype.Close=function(a){if(a==undefined){a=false}this.OpenState=false;this.Root=null};CDSEBase.prototype.CreateGroups=function(){IDREGlb.SetArraySize(this.GroupArray,this.GroupStringArray.Count());for(var a=0;a<this.GroupStringArray.Count();a++){this.GroupArray[a]=this.GetFldIdx(this.GroupStringArray[a])}if(this.flOrderData){this.SortRecords()}this.Root=new CDSEGroup();this.Root.AddGroup(-1,this)};CDSEBase.prototype.GetBlobContent=function(g,b,f,l,k){try{if(!l&&g.length<16){return}var o="";if(!l){o=g.substr(0,16)}if(l||o.substr(0,4)=="BLOB"){var a;if(l){a="bin"}else{var d="";for(var h=4;h<16;h++){if(o.charCodeAt(h)==0){break}d+=o.charAt(h)}a=d}var m="";if(this.Parent.Parent.Parent.IsServlet&&this.Parent.Parent.Parent.ParentS!=null){m=this.Parent.Parent.Parent.ParentS.Parent.MainFrm.GetMimeType(a)}else{m=this.GetMimeType(a)}if(m.indexOf("/")!=-1){m=m.substr(0,m.indexOf("/"))}var p=g;if(m=="text"){var c=p;f.set(new IDVariant(c))}else{if(m=="image"){var c=p;if(this.Parent.Parent.Parent.IsServlet){b.set_ServletImage(c)}}}}}catch(j){WriteToConsoleError(j)}};CDSEBase.prototype.GetWEBBlobContent=function(g,p,f,t,b,s){try{if(!b&&g.length<16){return}var h="";if(!b){h=g.substr(0,16)}if(b||h.substr(0,4)=="BLOB"){var j;if(b){j="bin"}else{var d="";for(var o=4;o<16;o++){if(h.charCodeAt(o)==0){break}d+=h.charAt(o)}j=d}var x;if(this.Parent.Parent.Parent.ParentS!=null){x=this.Parent.Parent.Parent.ParentS.Parent.MainFrm.GetMimeType(j)}else{x=this.GetMimeType(j)}f.set(new IDVariant(x));if(x!=null&&x.indexOf("/")!=-1){x=x.substr(0,x.indexOf("/"))}var u=g.substr(16);if(x!="text"||t){var c=this.Parent.Parent.Parent.ParentS.Parent.MainFrm;if(c.ShellObject.IsInsideShell()){var a=new IDVariant();a.Type=IDVariant.BLOB;a.Value=g;var l=Glb.SaveBlob(c,a).stringValue();this.Parent.Parent.AddToTempFiles(l);if(l.length>0){l=l.substring(c.RealPath.length+1)}p.set(new IDVariant(l))}else{var k=new Uint8Array(u.length);for(var o=0;o<u.length;o++){k[o]=u.charCodeAt(o)}var m=new BlobBuilder();m.append(k.buffer);var a=m.getBlob(f);var w=URL.createObjectURL(a);p.set(new IDVariant(w))}}else{var r=u;p.set(new IDVariant(r))}}}catch(q){WriteToConsoleError(q)}};CDSEBase.prototype.GetAggrFunct=function(b,e,d,c){var a=this.GetCurrentPosition();if(b==0&&e==-1){c.set(new IDVariant(a));return}if(this.Root!=null){this.Root.GetAggrFunct(a,b,e,d,c)}};CDSEBase.prototype.UpdateIMDB=function(a){return false};CDSEBase.prototype.MoveFirst=function(){};CDSEBase.prototype.MoveLast=function(){};CDSEBase.prototype.MoveNext=function(){};CDSEBase.prototype.MovePrevious=function(){};CDSEBase.prototype.RecordCount=function(){return 0};CDSEBase.prototype.ColumnCount=function(){return 0};CDSEBase.prototype.OrderGroups=function(){this.flOrderData=true};CDSEBase.prototype.SortRecords=function(){return false};CDSEBase.prototype.GetMimeType=function(a){return""};CDSEBase.prototype.GetRowId=function(){return this.GetCurrentPosition()+""};function CDSEDB(){CDSEBase.call(this);this.SQLstr="";this.OldSQLstr=null;this.RS=new IDCachedRowSet();this.RSDT=new ArrayList();this.ConnectionS=null;this.QueryOK=false;this.QueryParameters=new ArrayList();this.RSParam=new ArrayList();this.SortColumns=null;this.SortAscending=null;this.NumSort=0;this.LookupRows=null;this.CursorPos=0}CDSEDB.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEDB[obj]=CDSEBase[obj]}CDSEDB.prototype.Open=function(){var a=this.FindData();if(a){CDSEBase.prototype.Open.call(this)}return a};CDSEDB.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);if(a){try{this.RS.Close()}catch(b){}}if(this.RS.IsOpen()){this.MoveFirst()}};CDSEDB.prototype.GotoAbsolute=function(a){try{if(a<=0){this.RS.MoveFirst();this.RS.MovePrevious()}else{if(a>this.LookupRows.length){this.RS.MoveLast();this.RS.MoveNext()}else{this.RS.absolute(this.LookupRows[a-1]);this.CursorPos=a}}}catch(b){}};CDSEDB.prototype.IsEof=function(){if(this.LookupRows==null){try{return(this.MaxRows>0&&this.GetCurrentPosition()==this.MaxRows+1)||this.RS.EOF()}catch(a){return true}}else{return(this.MaxRows>0&&this.CursorPos==this.MaxRows+1)||this.CursorPos>this.LookupRows.length}};CDSEDB.prototype.FindData=function(){var d=true;if(this.RS.IsOpen()){return d}try{if(!this.QueryOK){this.UpdateParam(false)}if(this.ConnectionS!=null){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddQuery(this.iGuid,(this.Parent.ParentBox!=null?"Sub-Report '":"Report '")+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' loading data from DB","CDSEDB.FindData",DTTEngine.STMT_QRY_SELECT,this.SQLstr);try{var f=1;for(var j=0;j<this.RSParam.Count();j++){var b=this.RSParam[j];this.Parent.Parent.DTTObj.AddParameter("","","Param "+f++,b)}}catch(g){}}if(!this.ConnectionS.IsOpen()){this.Parent.Parent.Parent.Fire_OnConnecting(this.ConnectionS)}this.RS.setMaxRows(this.MaxRows);this.RS.setUpdatable();this.RS.setCommand((this.ConnectionS!=null)?this.ConnectionS.ApplySubstitutions(this.SQLstr):this.SQLstr);this.RS.execute(this.RSParam,this.ConnectionS);var a=this.RS.getMetaData();if(a){var h=a.getColumnCount();for(var c=0;c<h;c++){a.setColumnType(c+1,this.RSDT[c])}}if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddDBDataSource(this.RS,this.RS.getCommand());this.Parent.Parent.DTTObj.EndQuery(this.iGuid)}}if(!this.RS.EOF()){this.MoveFirst()}if(this.Parent.Parent.DTTObj.Level>0&&this.RS.RecordCount()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,420,"CDSEDB.FindData","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}catch(g){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,"",421,"CDSEDB.FindData","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' - Error: "+g);this.Parent.Parent.DTTObj.AddParameter("","","SQL",new IDVariant(this.RS.getCommand()))}d=false}return d};CDSEDB.prototype.GetFldIdx=function(a){try{return this.RS.findColumn(a)}catch(b){return -1}};CDSEDB.prototype.FieldName=function(b){try{return this.RS.GetName(b)}catch(a){return null}};CDSEDB.prototype.GetFldParam=function(g,c,a,d){if(g!=-1){try{var b=this.RS.getMetaData();if(b==null){return}c.set(new IDVariant(IDL.Type2DT(b.getColumnType(g+1))));a.set(new IDVariant(b.getColumnDisplaySize(g+1)));d.set(new IDVariant(b.getScale(g+1)))}catch(f){}}};CDSEDB.prototype.GetFieldValue=function(a,c){if(c==-1){a.set(new IDVariant("???"))}else{try{a.set(this.RS.Get(c))}catch(b){a.set(new IDVariant())}}};CDSEDB.prototype.SetFieldValue=function(c,a){try{this.RS.Set(c,a)}catch(b){}};CDSEDB.prototype.GetBlobContent=function(g,b,d,a){d.set(new IDVariant(""));var c=null;try{c=this.RS.getBlob(g)}catch(f){}if(c==null){try{c=this.RS.getBinaryStream(g)}catch(f){}}if(c==null){return}CDSEBase.prototype.GetBlobContent.call(this,c,b,d,a,(this.ConnectionS!=null&&this.ConnectionS.Unicode))};CDSEDB.prototype.GetWEBBlobContent=function(h,d,g,a,b){d.set(new IDVariant(""));g.set(new IDVariant(""));var c=null;try{c=this.RS.getBlob(h)}catch(f){}if(c==null){try{c=this.RS.getBinaryStream(h)}catch(f){}}if(c==null){return}CDSEBase.prototype.GetWEBBlobContent.call(this,c,d,g,a,b,(this.ConnectionS!=null&&this.ConnectionS.Unicode))};CDSEDB.prototype.UpdateParam=function(e){var g=false;var a=false;if(!this.QueryOK){this.PrepareParam();g=this.QueryParameters.Count()>0}var c=0;for(var h=0;h<this.QueryParameters.Count();h++){var f=this.QueryParameters[h];if(f.RepIdx>-1&&f.FldIdx>-1){var b=this.Parent.Parent.Parent.FindObjByID(f.RepIdx);var d=new IDVariant();b.DSE.GetFieldValue(d,f.FldIdx);a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}if(f.TblIdx>-1&&f.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(f.TblIdx,1)||e){var d=new IDVariant(this.Parent.Parent.IMDB.Value(f.TblIdx,f.FldIdx,0));a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}}c++}if(g){this.RSParam.Clear();c=0;for(var h=0;h<this.QueryParameters.Count();h++){var f=this.QueryParameters[h];this.RSParam.Add(f.AttValue)}c++}return g&&a};CDSEDB.prototype.PrepareParam=function(){var m=-1;var j=-1;this.QueryParameters.Clear();do{m=this.SQLstr.indexOf("~~",m+1);j=this.SQLstr.indexOf("~~",m+1);if(m>-1&&j>-1){var o=this.SQLstr.substr(m+2,j-(m+2));this.SQLstr=this.SQLstr.substr(0,m)+"?"+this.SQLstr.substr(j+2);var d=new CQueryParam();this.QueryParameters.Add(d);var b=o.lastIndexOf(".");if(b>-1){var a=0;try{a=parseInt(o.substr(0,b),10)}catch(f){}if(a>0&&!isNaN(a)){d.RepIdx=a;var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);if(d.RepIdx>-1){d.FldIdx=h.DSE.GetFldIdx(o.substr(b+1))}}else{var l=(this.Parent.Parent.Parent.ParentS!=null?this.Parent.Parent.Parent.ParentS.MainFrm:null);d.TblIdx=this.Parent.Parent.IMDB.TblByCode(o.substr(0,b),l);if(d.TblIdx>-1){d.FldIdx=this.Parent.Parent.IMDB.FldByCode(d.TblIdx,o.substr(b+1))}}}if(d.FldIdx>-1){if(d.RepIdx>-1){var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);h.DSE.GetFieldValue(d.AttValue,d.FldIdx);var g=new IDVariant();var k=new IDVariant();var c=new IDVariant();h.DSE.GetFldParam(d.FldIdx,g,k,c);d.DataType=g.intValue();d.MaxLength=k.intValue();d.Scale=c.intValue()}else{d.AttValue.set(this.Parent.Parent.IMDB.Value(d.TblIdx,d.FldIdx,0));d.DataType=this.Parent.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.Scale=this.Parent.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}}}while(m>-1&&j>-1);this.QueryOK=true};CDSEDB.prototype.UpdateIMDB=function(c){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEDB.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.UpdateParam(c);if(a){if(this.RS.IsOpen()){this.Close(true)}}return a};CDSEDB.prototype.MoveFirst=function(){try{if(this.LookupRows==null){this.RS.MoveFirst()}else{this.GotoAbsolute(1)}}catch(a){}};CDSEDB.prototype.MoveLast=function(){try{if(this.LookupRows==null){this.RS.MoveLast()}else{this.GotoAbsolute(this.LookupRows.length)}}catch(a){}};CDSEDB.prototype.MoveNext=function(){try{if(this.LookupRows==null){this.RS.MoveNext()}else{this.GotoAbsolute(++this.CursorPos)}}catch(a){}};CDSEDB.prototype.MovePrevious=function(){try{if(this.LookupRows==null){this.RS.MovePrevious()}else{this.GotoAbsolute(--this.CursorPos)}}catch(a){}};CDSEDB.prototype.RecordCount=function(){return this.RS.RecordCount()};CDSEDB.prototype.ColumnCount=function(){try{return this.RS.GetNumFields()}catch(a){return 0}};CDSEDB.prototype.SortRecords=function(){if(this.GroupStringArray.Count()==0){return true}this.InitSort();for(var a=0;a<this.GroupStringArray.Count();a++){this.SortBy(this.GroupArray[a],true)}this.StartSort();this.MoveFirst();return true};CDSEDB.prototype.InitSort=function(){this.LookupRows=null;this.NumSort=0;this.CursorPos=1};CDSEDB.prototype.SortBy=function(b,a){if(this.SortColumns==null){this.SortColumns=new Array(32);this.SortAscending=new Array(32)}this.SortColumns[this.NumSort]=b;this.SortAscending[this.NumSort]=a;this.NumSort++};CDSEDB.prototype.StartSort=function(){if(this.NumSort==0||this.RS.size()==0){return}var b=new Array(this.RS.size());for(var d=0;d<this.RS.size();d++){b[d]=(d+1)}function c(j,g,a,e,f){function h(o,l){var m=o;var k=l;var p=0;for(var s=0;s<e&&p==0;s++){var r=null;var q=null;try{r=f.GetObjectDirect(m,g[s]);q=f.GetObjectDirect(k,g[s]);if(r==null){p=(q==null)?0:-1}else{if(q==null){p=(r==null)?0:1}else{if(typeof(r)=="string"&&typeof(q)=="string"){p=(String.compare(r,q,true))}else{if(r==q){p=0}else{p=(r>q?1:-1)}}}}if(!a[s]){p=-p}}catch(t){WriteToConsoleError(t)}}return p}j.sort(h)}c(b,this.SortColumns,this.SortAscending,this.NumSort,this.RS);this.LookupRows=new Array(this.RS.size());for(var d=0;d<this.RS.size();d++){this.LookupRows[d]=b[d]}};CDSEDB.prototype.MergeWhereClause=function(j,c,b){if(this.OldSQLstr==null){this.OldSQLstr=this.SQLstr}this.SQLstr=this.OldSQLstr;if(j.length>0||c.length>0){var h=this.SQLstr.toUpperCase();var e=-1;var a=0;for(var g=0;g<h.length;g++){var l=h.substr(g,1);if(l.equals("(")){a++}if(l.equals(")")){a--}if(a==0&&(g<=h.length-7)&&h.substr(g,7).equals(" WHERE ")){e=g;break}}var d=h.indexOf(" GROUP BY ");var f=h.indexOf(" ORDER BY ");if(j.length>0){if(e>0){j=" and "+j}else{j=" where "+j}var k=2147483647;if(f>0&&f<k){k=f}if(d>0&&d<k){k=d}if(k!=2147483647){this.SQLstr=this.SQLstr.insert(k,j);if(d>0){d+=j.length}if(f>0){f+=j.length}}else{this.SQLstr+=j}}if(c.length>0){c=" order by "+c;if(f==-1){this.SQLstr+=c}else{if(b){this.SQLstr=this.SQLstr.substr(0,f)+c}}}}if(this.SQLstr.indexOf("~~")!=-1){this.QueryOK=false}};CDSEDB.prototype.GetMimeType=function(a){return""};CDSEDB.prototype.GetRowId=function(){var a=this.RS.findColumn("HASH");if(a!=-1){return this.RS.Get("HASH").stringValue()}return CDSEBase.prototype.GetRowId.call(this)};function CDSEDO(){CDSEBase.call(this);this.MstTableName="";this.WC=null;this.WCOK=true;this.IDColl=null;this.CursorPos=0;this.Document=null;this.DocTemplate=null;this.Master=true;this.QueryColumns=new ArrayList();this.LastUpdCount=0;this.LastUpdCountCol;this.WCParameters=new ArrayList();this.RSParam=new ArrayList();this.SortArray=new ArrayList();this.flOrderData=true}CDSEDO.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEDO[obj]=CDSEBase[obj]}function t_ColDef(){this.DBCode;this.PropIdx}CDSEDO.prototype.AddQueryColumn=function(a){var b=new t_ColDef();b.DBCode=a;b.PropIdx=-999;this.QueryColumns.Add(b)};CDSEDO.prototype.AddSortColumn=function(a){this.SortArray.Add(a)};CDSEDO.prototype.GetColumnPropIdx=function(c,e){var b=this.QueryColumns[e-1];if(b.PropIdx!=-999){return b.PropIdx}else{b.PropIdx=c.GetPropIndex(b.DBCode);if(b.PropIdx==-1){var a=c.GetNamedPropertyDefinition(b.DBCode);if(a.DataType!=0){b.PropIdx=0}}return b.PropIdx}};CDSEDO.prototype.Open=function(){if(!this.Master&&this.Parent.ParentBox!=null){var a=this.Parent.ParentBox.PSection.Parent.DSE;if(a instanceof CDSEDO){var l=a.GetDocument();if(l!=null){var f=l.GetMD();for(var g=1;g<=f.GetNumColl();g++){var d=f.GetColl(g);if(d.ChildrenName.equals(this.MstTableName)){this.IDColl=l.GetCollByIndex(g);if(!this.IDColl.Loaded()){try{l.LoadCollectionFromDB(0,g)}catch(j){WriteToConsoleError(j);if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': can't read data - ERROR = "+j.message)}}if(this.Parent.Parent.DTTObj.Level>0&&this.IDColl.Count()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}this.IDColl.set_UIBound(true);break}}}}}else{if(this.IDColl!=null&&!this.IDColl.Loaded()){try{if(this.IDColl.Parent()!=null){this.IDColl.Parent().LoadCollectionDirect(this.IDColl,0,true)}else{if(this.WC!=null&&this.WC.length>0&&!this.WCOK){this.UpdateParam(false)}var m=null;if(this.WC!=null&&this.WC.length>0){m=this.WC;if(this.WCParameters.Count()>0){var b=this.DocTemplate.GetDBObj();var o=0;var c=false;for(var g=0;g<m.length;g++){if(m[g]=="'"){c=!c}else{if(!c&&m[g]=="?"){var k=this.RSParam[o++];var h=Glb.ToSql(k,b.DBType,b);m=m.substring(0,g)+h+m.substring(g+1);g+=h.length-1}}}}}this.DocTemplate.LoadCollectionBE(this.IDColl,false,0,m)}}catch(j){WriteToConsoleError(j);if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': can't read data - ERROR = "+j.message)}}if(this.Parent.Parent.DTTObj.Level>0&&this.IDColl.Count()==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}else{if(this.Document!=null&&!this.Document.Loaded()&&!this.Document.Inserted()){try{this.Document.LoadFromDB(0)}catch(j){if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEDO.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}}}}if(this.IDColl!=null){this.IDColl.set_UIMode(true)}if(this.IDColl!=null){this.LastUpdCount=this.IDColl.UpdateCount();this.LastUpdCountCol=new Array(this.IDColl.Count());for(var g=0;g<this.LastUpdCountCol.length;g++){this.LastUpdCountCol[g]=-1}}else{if(this.Document!=null){this.LastUpdCount=this.Document.UpdateCount()}}this.MoveFirst();CDSEBase.prototype.Open.call(this);return true};CDSEDO.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);if(a){if(this.Master&&this.IDColl!=null&&(this.WC==null||this.WC.length>0)){this.IDColl.Clear()}}if(this.IDColl!=null){this.IDColl.set_UIMode(false)}};CDSEDO.prototype.IsEof=function(){return((this.MaxRows>0&&this.CursorPos==this.MaxRows+1)||(this.IDColl!=null&&this.CursorPos>this.IDColl.Count())||(this.Document!=null&&this.CursorPos>1))};CDSEDO.prototype.GetFldIdx=function(b){for(var a=0;a<this.QueryColumns.Count();a++){var c=this.QueryColumns[a];if(c.DBCode.equals(b)){return a+1}}return 0};CDSEDO.prototype.FieldName=function(b){var a=this.QueryColumns[b-1];return a.DBCode};CDSEDO.prototype.GetFldParam=function(f,c,b,d){var a=this.GetColumnPropIdx(this.DocTemplate,f);var e=null;if(a>0){e=this.DocTemplate.GetMD().GetProp(a)}else{if(a==0){e=this.DocTemplate.GetNamedPropertyDefinition(this.QueryColumns[f-1].DBCode)}}if(e!=null){c.set(new IDVariant(e.DataType));b.set(new IDVariant(e.MaxLength));d.set(new IDVariant(e.vScale))}};CDSEDO.prototype.GetFieldValue=function(b,e){var c=this.GetDocument();if(c==null){b.set(new IDVariant());return}var a=this.GetColumnPropIdx(c,e);if(a>0){b.set(c.GetPropByIndex(a))}else{if(a==0){b.set(c.GetNamedPropertyValue(this.QueryColumns[e-1].DBCode))}}};CDSEDO.prototype.SetFieldValue=function(g,b){var f=this.GetDocument();var e=new IDVariant();var c=f.GetLock(9999,"",e);if(c){f.BeginTrans();var a=this.GetColumnPropIdx(f,g);if(a>0){f.SetPropByIndex(a,b)}else{if(a==0){f.SetNamedPropertyValue(this.QueryColumns[g-1].DBCode,b)}}f.EndTrans();f.Validate(1,0,true)}};CDSEDO.prototype.GetBlobContent=function(j,e,g,c){g.set(new IDVariant(""));var h=this.GetDocument();var a=this.GetColumnPropIdx(h,j);var b=null;if(a>0){b=h.GetPropByIndex(j)}else{if(a==0){b=h.GetNamedPropertyValue(this.QueryColumns[j-1].DBCode)}}if(b==null||b.Type!=IDVariant.BLOB){return}var f=b.Value;CDSEBase.prototype.GetBlobContent.call(this,f,e,g,c,true)};CDSEDO.prototype.GetWEBBlobContent=function(h,c,k,a,j){c.set(new IDVariant(""));k.set(new IDVariant(""));var g=this.GetDocument();var f=this.GetColumnPropIdx(g,h);var b=null;if(f>0){b=g.GetPropByIndex(h)}else{if(f==0){b=g.GetNamedPropertyValue(this.QueryColumns[h-1].DBCode)}}if(b==null||b.Type!=IDVariant.BLOB){return}var e=b.Value;CDSEBase.prototype.GetWEBBlobContent.call(this,e,c,k,a,j,true)};CDSEDO.prototype.UpdateParam=function(e){var g=false;var a=false;if(!this.WCOK){this.PrepareParam();g=this.WCParameters.Count()>0}var c=0;for(var h=0;h<this.WCParameters.Count();h++){var f=this.WCParameters[h];if(f.RepIdx>-1&&f.FldIdx>-1){var b=this.Parent.Parent.Parent.FindObjByID(f.RepIdx);var d=new IDVariant();b.DSE.GetFieldValue(d,f.FldIdx);a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}if(f.TblIdx>-1&&f.FldIdx>-1){if(this.Parent.Parent.IMDB.TblModified(f.TblIdx,1)||e){var d=new IDVariant(this.Parent.Parent.IMDB.Value(f.TblIdx,f.FldIdx,0));a=true;if(d.CompareTo(f.AttValue)!=0&&!(f.AttValue.Type==IDVariant.NULL&&d.Type==IDVariant.NULL)){f.AttValue=d;g=true}}}c++}if(g){this.RSParam.Clear();c=0;for(var h=0;h<this.WCParameters.Count();h++){var f=this.WCParameters[h];this.RSParam.Add(f.AttValue)}c++}return g&&a};CDSEDO.prototype.PrepareParam=function(){var m=-1;var j=-1;this.WCParameters.Clear();do{m=this.WC.indexOf("~~",m+1);j=this.WC.indexOf("~~",m+1);if(m>-1&&j>-1){var o=this.WC.substr(m+2,j-(m+2));this.WC=this.WC.substr(0,m)+"?"+this.WC.substr(j+2);var d=new CQueryParam();this.WCParameters.Add(d);var b=o.lastIndexOf(".");if(b>-1){var a=0;try{a=parseInt(o.substr(0,b),10)}catch(f){}if(a>0&&!isNaN(a)){d.RepIdx=a;var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);if(d.RepIdx>-1){d.FldIdx=h.DSE.GetFldIdx(o.substr(b+1))}}else{var l=(this.Parent.Parent.Parent.ParentS!=null?this.Parent.Parent.Parent.ParentS.MainFrm:null);d.TblIdx=this.Parent.Parent.IMDB.TblByCode(o.substr(0,b),l);if(d.TblIdx>-1){d.FldIdx=this.Parent.Parent.IMDB.FldByCode(d.TblIdx,o.substr(b+1))}}}if(d.FldIdx>-1){if(d.RepIdx>-1){var h=this.Parent.Parent.Parent.FindObjByID(d.RepIdx);h.DSE.GetFieldValue(d.AttValue,d.FldIdx);var g=new IDVariant();var k=new IDVariant();var c=new IDVariant();h.DSE.GetFldParam(d.FldIdx,g,k,c);d.DataType=g.intValue();d.MaxLength=k.intValue();d.Scale=c.intValue()}else{d.AttValue.set(this.Parent.Parent.IMDB.Value(d.TblIdx,d.FldIdx,0));d.DataType=this.Parent.Parent.IMDB.GetFldDataType(d.TblIdx,d.FldIdx);d.MaxLength=this.Parent.Parent.IMDB.GetFldMaxLength(d.TblIdx,d.FldIdx);d.Scale=this.Parent.Parent.IMDB.GetFldScale(d.TblIdx,d.FldIdx)}}}}while(m>-1&&j>-1);this.WCOK=true};CDSEDO.prototype.UpdateIMDB=function(e){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEDO.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.UpdateParam(e);if(a){this.Close(true)}if(!a&&this.IDColl!=null){if(this.LastUpdCount!=this.IDColl.UpdateCount()){a=true}else{for(var c=0;c<this.IDColl.Count();c++){var f=this.IDColl.GetDirect(c+1);if(f!=null&&f.UpdateCount()!=this.LastUpdCountCol[c]){a=true;break}}}}else{if(!a&&this.Document!=null&&this.LastUpdCount!=this.Document.UpdateCount()){a=true}}if(a&&this.IsOpen()){this.Close()}return a};CDSEDO.prototype.MoveFirst=function(){this.CursorPos=1};CDSEDO.prototype.MoveLast=function(){this.CursorPos=(this.IDColl!=null?this.IDColl.Count():1)};CDSEDO.prototype.MoveNext=function(){if(this.IDColl!=null){if(this.CursorPos<=this.IDColl.Count()){this.CursorPos++}}else{this.CursorPos++}};CDSEDO.prototype.MovePrevious=function(){if(this.IDColl!=null){if(this.CursorPos>=1){this.CursorPos--}}};CDSEDO.prototype.RecordCount=function(){if(this.IDColl!=null){return this.IDColl.Count()}else{return 1}};CDSEDO.prototype.ColumnCount=function(){return this.QueryColumns.Count()};CDSEDO.prototype.GetFieldName=function(b){var a=this.QueryColumns[b];return a.DBCode};CDSEDO.prototype.SortRecords=function(){if(this.IDColl==null){return false}this.IDColl.ClearSort();for(var b=0;b<this.GroupArray.Count();b++){var a=this.GetColumnPropIdx(this.DocTemplate,this.GroupArray[b]);this.IDColl.SortBy(a)}for(var b=0;b<this.SortArray.Count();b++){this.IDColl.SortBy(this.SortArray[b])}this.IDColl.EnableSort();this.MoveFirst();return true};CDSEDO.prototype.SetQueryCollection=function(a){this.IDColl=a;this.IDColl.set_UIBound(true);this.IDColl.set_ShowDeleted(false);this.Document=null;this.Master=true;this.LastUpdCount=-1;this.LastUpdCountCol=null;this.WC="";if(this.IsOpen()){this.Close()}};CDSEDO.prototype.SetQueryDocument=function(a){this.Document=a;if(this.Document!=null){this.Document.set_UIBound(true)}this.IDColl=null;this.LastUpdCount=-1;this.LastUpdCountCol=null;if(this.IsOpen()){this.Close()}};CDSEDO.prototype.GetDocument=function(){if(this.IDColl!=null){var g=this.IDColl.GetDirect(this.CursorPos);if(g==null&&this.Parent.Parent.PE!=null){var f=false;var b=this.Parent.Parent.PrintingToPage;var e=this.Parent.Parent.PrintingToPage;if(this.Parent.Parent.CacheSize()>1&&this.Parent.Parent.FormattingPage!=null){var a=new IDVariant(0);var c=new IDVariant(0);this.Parent.Parent.GetPageIntervals(this.Parent.Parent.PrintingToPage,a,c);b=a.intValue();e=c.intValue()}if(this.Parent.Parent.PE instanceof CPEPDF){f=true}else{if(this.Parent.Parent.FormattingPage!=null&&this.Parent.Parent.FormattingPage.PageNum>=b-1&&this.Parent.Parent.FormattingPage.PageNum<=e){f=true}}if(f){this.IDColl.GetMissingDoc(this.CursorPos);g=this.IDColl.GetDirect(this.CursorPos);if(g!=null){this.LastUpdCount=this.IDColl.UpdateCount()}}}if(g!=null&&this.LastUpdCountCol[this.CursorPos-1]==-1){this.LastUpdCountCol[this.CursorPos-1]=g.UpdateCount()}return g}else{return this.Document}};CDSEDO.prototype.SetDocumentClass=function(b){this.MstTableName=b;try{var a=this.Parent.Parent.MainFrm;var f=new IDCollection();a.CreateDocument(f,this.MstTableName);f.MoveFirst();var d=f.GetAt();if(d==null){WriteToConsoleError("REPORT: cannot create a "+MstTableName)}else{d.Clear();d.SetMainFrm(a,a.IMDB)}this.DocTemplate=d;this.IDColl=new IDCollection();this.IDColl.set_MainFrm(a);this.IDColl.set_imdb(a.IMDB);this.IDColl.set_UIBound(true);this.IDColl.set_ShowDeleted(false)}catch(c){WriteToConsoleError(c)}};function CDSEGroup(){this.StartGroupIdx=0;this.EndGroupIdx=0;this.Level=0;this.FieldIdx=-1;this.ValuesArray=new ArrayList();this.GroupList=new ArrayList();this.AggrMap=new HashTableSrv()}CDSEGroup.prototype.AddGroup=function(f,b){this.StartGroupIdx=b.GetCurrentPosition();this.Level=f;if(f>=0){this.FieldIdx=b.GroupArray[f];IDREGlb.SetArraySize(this.ValuesArray,f+1);for(var e=0;e<this.ValuesArray.Count();e++){if(this.ValuesArray[e]==null){this.ValuesArray[e]=new IDVariant()}b.GetFieldValue(this.ValuesArray[e],b.GroupArray[e])}}while(!b.IsEof()){if(f!=-1){var d=false;for(var e=0;e<this.ValuesArray.Count()&&!d;e++){var j=new IDVariant();b.GetFieldValue(j,b.GroupArray[e]);if(j.CompareTo(this.ValuesArray[e])!=0){d=true}}if(d){break}}if(f<b.GroupArray.Count()-1){var h=new CDSEGroup();this.GroupList.Add(h);h.AddGroup(f+1,b);for(var e=0;e<b.GetNumColumns();e++){var c=this.AggrMap[b.GetFieldName(e).toUpperCase()];if(c==null){c=new CDSEAggr();this.AggrMap[b.GetFieldName(e).toUpperCase()]=c}c.Update(h.AggrMap[b.GetFieldName(e).toUpperCase()])}}else{for(var e=0;e<b.GetNumColumns();e++){var c=this.AggrMap[b.GetFieldName(e).toUpperCase()];if(c==null){c=new CDSEAggr();this.AggrMap[b.GetFieldName(e).toUpperCase()]=c}var j=new IDVariant();b.GetFieldValue(j,e+1);c.Update(j)}b.Next()}}if(!b.IsEof()){this.EndGroupIdx=b.GetCurrentPosition()-1}else{this.EndGroupIdx=b.GetNumRecords()}};CDSEGroup.prototype.IsMyGroupTime=function(b,a,e){if(this.Level==e){if(a){return b==this.StartGroupIdx}else{return b==this.EndGroupIdx}}for(var d=0;d<this.GroupList.Count();d++){var c=this.GroupList[d];if(b>=c.StartGroupIdx&&b<=c.EndGroupIdx){return c.IsMyGroupTime(b,a,e)}}return false};CDSEGroup.prototype.GetGroup=function(a,d){if(this.Level==d){return this}for(var c=0;c<this.GroupList.Count();c++){var b=this.GroupList[c];if(a>=b.StartGroupIdx&&a<=b.EndGroupIdx){return b.GetGroup(a,d)}}return null};CDSEGroup.prototype.GetAggrFunct=function(d,c,k,j,f){if(this.Level==k){var b=this.AggrMap[j.toUpperCase()];if(c==0){f.set(new IDVariant(this.StartGroupIdx));return}if(b!=null){b.GetAggrFunct(c,f)}return}for(var h=0;h<this.GroupList.Count();h++){var e=this.GroupList[h];if(d>=e.StartGroupIdx&&d<=e.EndGroupIdx){e.GetAggrFunct(d,c,k,j,f);return}}};function CDSEIMDB(){CDSEBase.call(this);this.IMDBTable=-1;this.IsBOF=false;this.IsFirstRow=false}CDSEIMDB.prototype=new CDSEBase();for(var i=0;i<Object.keys(CDSEBase).length;i++){var obj=Object.keys(CDSEBase)[i];CDSEIMDB[obj]=CDSEBase[obj]}CDSEIMDB.prototype.Open=function(){var a=this.Parent.Parent.Parent.GetNewID2OldID(this.Parent.ReportID);this.Parent.Parent.Parent.Fire_OnIMDBUpdate(a);this.MoveFirst();CDSEBase.prototype.Open.call(this);if(this.Parent.Parent.DTTObj.Level>0){this.Parent.Parent.DTTObj.AddQuery(this.iGuid,(this.Parent.ParentBox!=null?"Sub-Report '":"Report '")+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"' loading data from IMDB","CDSEIMDB.FindData",DTTEngine.STMT_QRY_SELECT,"");this.Parent.Parent.DTTObj.AddIMDBDataSource(this.IMDBTable,(this.Parent.Parent.Parent.ParentS!=null?this.Parent.Parent.Parent.ParentS.Parent.IMDB:null));this.Parent.Parent.DTTObj.EndQuery(this.iGuid);if(this.Parent.Parent.IMDB.TblNumRows(this.IMDBTable)==0){this.Parent.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.iGuid,422,"CDSEIMDB.Open","Report '"+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+"': the query returned NO data")}}return true};CDSEIMDB.prototype.Close=function(a){CDSEBase.prototype.Close.call(this,a);this.MoveFirst()};CDSEIMDB.prototype.IsEof=function(){return((this.MaxRows>0&&this.GetCurrentPosition()==this.MaxRows+1)||this.Parent.Parent.IMDB.Eof(this.IMDBTable,IDREGlb.IMDB_CURSOR))};CDSEIMDB.prototype.GetFldIdx=function(a){return this.Parent.Parent.IMDB.FldByCode(this.IMDBTable,a)+1};CDSEIMDB.prototype.FieldName=function(a){return this.Parent.Parent.IMDB.FldCode(this.IMDBTable,a-1)};CDSEIMDB.prototype.GetFldParam=function(d,b,a,c){b.set(new IDVariant(this.Parent.Parent.IMDB.GetFldDataType(this.IMDBTable,d-1)));a.set(new IDVariant(this.Parent.Parent.IMDB.GetFldMaxLength(this.IMDBTable,d-1)));c.set(new IDVariant(this.Parent.Parent.IMDB.GetFldScale(this.IMDBTable,d-1)))};CDSEIMDB.prototype.GetFieldValue=function(a,b){a.set(this.Parent.Parent.IMDB.Value(this.IMDBTable,b-1,IDREGlb.IMDB_CURSOR))};CDSEIMDB.prototype.SetFieldValue=function(b,a){this.Parent.Parent.IMDB.set_Value(this.IMDBTable,b-1,IDREGlb.IMDB_CURSOR,a)};CDSEIMDB.prototype.GetBlobContent=function(f,c,e,b){e.set(new IDVariant(""));var a=this.Parent.Parent.IMDB.Value(this.IMDBTable,f-1,IDREGlb.IMDB_CURSOR);if(a.Type!=IDVariant.BLOB){return}var d=a.Value;CDSEBase.prototype.GetBlobContent.call(this,d,c,e,b,true)};CDSEIMDB.prototype.GetWEBBlobContent=function(g,e,f,b,c){e.set(new IDVariant(""));f.set(new IDVariant(""));var a=this.Parent.Parent.IMDB.Value(this.IMDBTable,g-1,IDREGlb.IMDB_CURSOR);if(a.Type!=IDVariant.BLOB){return}var d=a.Value;CDSEBase.prototype.GetWEBBlobContent.call(this,d,e,f,b,c,true)};CDSEIMDB.prototype.UpdateIMDB=function(c){if(this.Parent.Freezed){var b=this.Parent.Parent.MainFrm;if(b.getDTTObj()!=null){b.getDTTObj().AddMsg(DTTEngine.DTTMSG_INFO,this.iGuid,71,"CDSEIMDB.UpdateIMDB","Report "+this.Parent.Parent.Parent.GetObjName(this.Parent.ReportID)+": update not performed (the report is freezed)")}return false}var a=this.Parent.Parent.IMDB.TblModified(this.IMDBTable,1)||c;if(a){if(this.IsOpen()){this.Close()}}return a};CDSEIMDB.prototype.MoveFirst=function(){this.Parent.Parent.IMDB.TblMoveFirst(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=true;this.IsBOF=false};CDSEIMDB.prototype.MoveLast=function(){this.Parent.Parent.IMDB.TblMoveLast(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false};CDSEIMDB.prototype.MoveNext=function(){this.Parent.Parent.IMDB.TblMoveNext(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false};CDSEIMDB.prototype.MovePrevious=function(){if(!this.IsBOF&&this.IsFirstRow){this.IsFirstRow=false;this.IsBOF=true}else{this.Parent.Parent.IMDB.TblMovePrev(this.IMDBTable,IDREGlb.IMDB_CURSOR);this.IsFirstRow=false;this.IsBOF=false}};CDSEIMDB.prototype.RecordCount=function(){return this.Parent.Parent.IMDB.TblNumRows(this.IMDBTable)};CDSEIMDB.prototype.ColumnCount=function(){return this.Parent.Parent.IMDB.TblNumField(this.IMDBTable)};CDSEIMDB.prototype.GetFieldName=function(a){return this.Parent.Parent.IMDB.FldCode(this.IMDBTable,a)};CDSEIMDB.prototype.SortRecords=function(){this.Parent.Parent.IMDB.TblInitSort(this.IMDBTable);for(var a=0;a<this.GroupArray.Count();a++){this.Parent.Parent.IMDB.TblSortBy(this.IMDBTable,this.GroupArray[a]-1,true)}this.Parent.Parent.IMDB.TblStartSort(this.IMDBTable);this.MoveFirst();return true};CDSEIMDB.prototype.GetRowId=function(){var a=this.Parent.Parent.IMDB.FldByCode(this.IMDBTable,"HASH");if(a!=-1){return this.Parent.Parent.IMDB.Value(this.IMDBTable,a,IDREGlb.IMDB_CURSOR).stringValue()}return CDSEBase.prototype.GetRowId.call(this)};function CFloatRect(b,e,a,c){this.x=0;this.y=0;this.width=0;this.height=0;if(b instanceof CFloatRect){var d=b;this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height}else{this.x=b;this.y=e;this.width=Math.abs(a-b);this.height=Math.abs(c-e)}}CFloatRect.prototype.left=function(){return this.x};CFloatRect.prototype.top=function(){return this.y};CFloatRect.prototype.right=function(){return this.x+this.width};CFloatRect.prototype.bottom=function(){return this.y+this.height};CFloatRect.prototype.setLeft=function(a){this.x=a};CFloatRect.prototype.setTop=function(a){this.y=a};CFloatRect.prototype.setRight=function(a){this.width=a-this.x};CFloatRect.prototype.setBottom=function(a){this.height=a-this.y};CFloatRect.prototype.setWidth=function(a){this.width=a};CFloatRect.prototype.setHeight=function(a){this.height=a};CFloatRect.prototype.IsRectNull=function(){return(this.x==0&&this.y==0&&this.width==0&&this.height==0)};CFloatRect.prototype.Deflate=function(d,c,a,e){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x+=c;this.y+=d;this.width-=(c+e);this.height-=(a+d)};CFloatRect.prototype.Inflate=function(d,c,a,e){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x-=c;this.y-=d;this.width+=c+e;this.height+=a+d};CFloatRect.prototype.Intersect=function(b,a){this.x=Math.max(b.left(),a.left());this.y=Math.max(b.top(),a.top());this.setRight(Math.floor(Math.min(b.left()+b.width,a.left()+a.width)));this.setBottom(Math.floor(Math.min(b.top()+b.height,a.top()+a.height)))};CFloatRect.prototype.toString=function(){return"X="+this.x+", Y="+this.y+", W="+this.width+", H="+this.height};function CIDREObj(a){this.ParentS=a;this.Book=new CBook();this.ObjMap=new ArrayList();this.GUIDMap=new ArrayList();this.NameMap=new ArrayList();this.Code2IndexMap={};this.Index2CodeMap=new ArrayList();this.OldGUIDMap=null;this.OldID2NewIDArray=new ArrayList();this.NewID2OldIDArray=new ArrayList();this.CurrencyMsk="";this.FloatMsk="";this.DateMsk="";this.TimeMsk="";this.ForceSnap=true;this.OptimizeDOM=false;this.ScrollDir=0;this.IsServlet=false;this.Book.Parent=this;if(a!=null&&a.Parent!=null){this.Book.MainFrm=a.Parent.MainFrm}}CIDREObj.prototype.FindObjByID=function(a){if(a>this.ObjMap.Count()-1){return null}return this.ObjMap[a]};CIDREObj.prototype.GetOldID2NewID=function(a){if(this.OldGUIDMap!=null&&this.OldID2NewIDArray.Count()>0){if(a>this.OldID2NewIDArray.Count()-1){return 0}return this.OldID2NewIDArray[a]}else{return a}};CIDREObj.prototype.GetNewID2OldID=function(a){if(this.OldGUIDMap!=null&&this.NewID2OldIDArray.Count()>0){if(a>this.NewID2OldIDArray.Count()-1){return 0}return this.NewID2OldIDArray[a]}else{return a}};CIDREObj.prototype.ResetBook=function(){this.ObjMap.Clear();if(this.OldGUIDMap==null){this.OldGUIDMap=new ArrayList(this.GUIDMap)}this.GUIDMap.Clear();this.NameMap.Clear();this.Code2IndexMap={};this.Index2CodeMap.Clear();this.OldID2NewIDArray=new ArrayList();this.NewID2OldIDArray=new ArrayList();this.Book.PagesList=new ArrayList();this.Book.PE.PrintingPage=null;this.Book.MastroList=new ArrayList();this.Book.ReportsList=new ArrayList();this.Book.ImagesPath=new ArrayList()};CIDREObj.prototype.CalcBookNewIDs=function(){this.OldID2NewIDArray.Clear();for(var d=this.OldID2NewIDArray.Count();d<this.OldGUIDMap.Count();d++){this.OldID2NewIDArray.Add(0)}this.NewID2OldIDArray.Clear();for(var d=this.NewID2OldIDArray.Count();d<this.GUIDMap.Count();d++){this.NewID2OldIDArray.Add(0)}for(var c=0;c<this.OldGUIDMap.Count();c++){var a=this.OldGUIDMap[c];var e=0;for(var b=0;b<this.GUIDMap.Count()&&e==0;b++){if(this.GUIDMap[b].equals(a)){e=b}}this.OldID2NewIDArray[c]=e;this.NewID2OldIDArray[e]=c}};CIDREObj.prototype.InitBook=function(b,e,d,a,c){this.Book.UM=b;this.Book.Flags=e;this.Book.Name=d;this.Book.IMDB=a;this.Book.VisualStyleList.set_VisualStyleList(c);this.Book.VisualStyleList.Parent=this.Book;this.IsServlet=true};CIDREObj.prototype.InitHTML=function(){this.Book.PE=new CPEHTML();this.Book.PE.Parent=this.Book};CIDREObj.prototype.FrIndex=function(){return this.Book.FrIndex};CIDREObj.prototype.set_FrIndex=function(a){this.Book.FrIndex=a};CIDREObj.prototype.ProcessRequest=function(a,b){this.Book.ProcessRequest(a,b)};CIDREObj.prototype.PrintBook=function(h,f){try{var b=false;if(this.Book.PrintDestination<=IDREGlb.PRN_SCREEN&&this.ParentS!=null&&this.ParentS.MainFrm.ParamsObj().UseRD3&&this.ParentS.RD3PageCache.containsKey(f)){b=true}var a=new HashTableSrv();var g=Object.keys(this.ParentS.RD3PageCache);for(var e=0;e<g.length;e++){var d=g[e];a[d]=this.ParentS.RD3PageCache[d]}this.Book.PrintPages(h,f);if(b){this.ParentS.RD3PageCache=a;if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),570,"CIDREObj.PrintBook","Book "+this.GetObjName(0)+": the page "+f+" is already available on client side -> skipping send")}}}catch(c){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_ERROR,this.GetRTCGuid(0),423,"CIDREObj.PrintBook","Book "+this.GetObjName(0)+": Error while printing book (Msg = "+c.message+")")}throw c}};CIDREObj.prototype.OpenMultiPDF=function(a){};CIDREObj.prototype.CloseMultiPDF=function(){};CIDREObj.prototype.SetScrollMode=function(a,b,c){if(a!=this.ScrollDir){this.ScrollDir=a;this.ParentS.RD3Change(RD3Glb.BOK_SCROLLDIR)}if(b!=this.ForceSnap){this.ForceSnap=b;this.ParentS.RD3Change(RD3Glb.BOK_FORCESNAP)}if(c!=this.OptimizeDOM){this.OptimizeDOM=c;this.ParentS.RD3Change(RD3Glb.BOK_OPTIMIZEDOM)}};CIDREObj.prototype.SetSize=function(c,a){var b={Width:c-10,Height:a-10};this.Book.ConvertFromPixelToPhysical(b,this.Book.UM);if(this.Book.PE.Width!=b.Width||this.Book.PE.Height!=b.Height){this.Book.PE.Width=b.Width;this.Book.PE.Height=b.Height;for(var d=0;d<this.Book.PagesList.Count();d++){var e=this.Book.PagesList[d];if(e!=null&&e.FitMode!=IDREGlb.MASTRO_FM_NONE){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),424,"CIDREObj.SetSize","Book "+this.GetObjName(0)+": content size changed and page '"+this.GetObjName(e.ParentMastro.MastroID)+"' has FitMode != NONE -> Refreshing book's content using new dimensions")}this.RefreshBook(1,-1);break}}}};CIDREObj.prototype.IsPrinting=function(){return this.Book.IsPrinting};CIDREObj.prototype.set_IsPrinting=function(a){this.Book.IsPrinting=a};CIDREObj.prototype.PrinterName=function(){return this.Book.PrinterName};CIDREObj.prototype.set_PrinterName=function(a){this.Book.PrinterName=a};CIDREObj.prototype.OutputFileName=function(){return this.Book.OutputFileName};CIDREObj.prototype.set_OutputFileName=function(a){this.Book.OutputFileName=a;this.Book.AutoOutFileName=false};CIDREObj.prototype.GetWebFileName=function(){return this.Book.WebFileName.replace(/\\/g,"/")};CIDREObj.prototype.Bookmark=function(){return this.Book.Bookmark};CIDREObj.prototype.set_Bookmark=function(a){this.Book.Bookmark=a};CIDREObj.prototype.CacheSize=function(){return this.Book.CacheSize()};CIDREObj.prototype.set_CacheSize=function(a){if(this.Book.CacheSize()!=a){this.Book.set_CacheSize(a);this.ParentS.RD3Change(RD3Glb.BOK_CACHESIZE)}};CIDREObj.prototype.FixedWidth=function(){return this.Book.ConvertFromInternalValue(this.Book.FixedWidth)};CIDREObj.prototype.set_FixedWidth=function(a){this.Book.FixedWidth=this.Book.ConvertToInternalValue(a);this.ParentS.RD3Change(RD3Glb.BOK_FIXEDWIDTH)};CIDREObj.prototype.FixedHeight=function(){return this.Book.ConvertFromInternalValue(this.Book.FixedHeight)};CIDREObj.prototype.set_FixedHeight=function(a){this.Book.FixedHeight=this.Book.ConvertToInternalValue(a);this.ParentS.RD3Change(RD3Glb.BOK_FIXEDHEIGHT)};CIDREObj.prototype.RefreshBook=function(c,b){var a=-1;if(this.Book.PE!=null&&this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(c,b);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),425,"CIDREObj.RefreshBook","Book "+this.GetObjName(0)+": Book refresh done. The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(1,a);if(this.ParentS!=null&&this.GetPageNumber()!=a){this.ParentS.RD3DeletePage=a}if(this.GetPageNumber()==0){this.set_RD(true);if(this.ParentS!=null){this.ParentS.RD3Change(RD3Glb.BOK_PAGECONFIRMED);this.ParentS.RD3Change(RD3Glb.BOK_PAGENUM);this.ParentS.RD3Change(RD3Glb.BOK_PAGETOTAL)}}}};CIDREObj.prototype.RefreshQuery=function(){for(var b=0;b<this.Book.ReportsList.Count();b++){var c=this.Book.ReportsList[b];if(c.ParentBox==null){this.ReportRefreshQuery(c.ReportID,false)}}var a=-1;if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),569,"CIDREObj.RefreshQuery","Book "+this.GetObjName(0)+": The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(a,a)}};CIDREObj.prototype.UpdateBook=function(a){if(a==undefined){a=false}if(this.ParentS!=null&&(!this.ParentS.Visible||this.ParentS.Collapsed||!this.ParentS.Exposed())){this.ParentS.WasHidden=true;this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(0),72,"CIDREObj.UpdateBook","Book "+this.GetObjName(0)+": update not performed (the book is either invisible, collapsed or not exposed)");return}this.Book.Update(a)};CIDREObj.prototype.GetName=function(){return this.Book.Name};CIDREObj.prototype.HideBorder=function(){return(this.Book.Flags&IDREGlb.FL_BOOK_HIDEBORD)!=0};CIDREObj.prototype.set_HideBorder=function(a){var b=this.Book.Flags;if(a){b|=IDREGlb.FL_BOOK_HIDEBORD}else{b&=~IDREGlb.FL_BOOK_HIDEBORD}if(this.Book.Flags!=b){this.Book.Flags=b;this.set_RD(true);if(this.ParentS!=null){this.ParentS.RD3Change(RD3Glb.BOK_HIDEBORDER)}}};CIDREObj.prototype.SetCommandEnabled=function(c,a){var b=this.Book.EnabledCommands;this.Book.EnabledCommands=(this.Book.EnabledCommands&(~c))|((a)?c:0);if(b!=this.Book.EnabledCommands){this.ParentS.RD3Change(RD3Glb.BOK_ENABLEDCOMMANDS)}};CIDREObj.prototype.IsCommandEnabled=function(a){return(this.Book.EnabledCommands&a)!=0};CIDREObj.prototype.SetZoom=function(a){this.Book.PE.SetZoomLevel(a)};CIDREObj.prototype.GetZoom=function(){return this.Book.PE.ZoomLevel};CIDREObj.prototype.PrintDestination=function(){return this.Book.PrintDestination};CIDREObj.prototype.set_PrintDestination=function(a){if(a==IDREGlb.PRN_ABCPDF){a=IDREGlb.PRN_PDF}if(this.Book.PrintDestination!=a){this.Book.RefreshPages(1)}this.Book.PrintDestination=a};CIDREObj.prototype.GetTotalPagesNumber=function(){return this.Book.TotalPagesNumber};CIDREObj.prototype.GetTotalPagesNumberConf=function(){return this.Book.TotalPagesNumberConf};CIDREObj.prototype.InitMastro=function(g,c,a,h,d,f,e){var b=new CMastro();b.MastroID=g;b.PageType=c;b.Width=a;b.Height=h;b.UM=d;b.Orientation=f;b.FitMode=e;b.Parent=this.Book;this.Book.MastroList.Add(b);IDREGlb.SetArraySize(this.ObjMap,g+1);this.ObjMap[g]=b};CIDREObj.prototype.InitMastroBox=function(a,q,e,d,s,l,g,r,b,p,m,w,c,u,f,h,o,v,k){if(h==undefined){h=-1}if(o==undefined){o=-1}if(v==undefined){v=""}if(k==undefined){k=IDREGlb.VISALN_AUTO}var t=this.FindObjByID(a);var j=new CRptBox();j.BoxID=q;j.XPos=e;j.YPos=d;j.Width=s;j.Height=l;j.Interline=g;j.HRsz=r;j.VRsz=b;j.VisAttrIdx=p;j.FontHeight=w;j.InitFlags(m);j.ToolTip=c;j.Stretch=u;j.VisProp=f;j.SetBackColor(h);j.SetForeColor(o);j.SetFontMod(v);j.Alignment=k;j.PMastro=t;j.PSection=null;t.BoxList.Add(j);IDREGlb.SetArraySize(this.ObjMap,q+1);this.ObjMap[q]=j};CIDREObj.prototype.InitBoxSpan=function(q,a,r,h,j,b,p,k,d,g,l,c,o,e){if(l==undefined){l=-1}if(c==undefined){c=-1}if(o==undefined){o=""}if(e==undefined){e=""}var f=this.FindObjByID(q);var m=new CRptSpan();m.SpanID=a;m.Text=d;m.VisAttrIdx=r;m.DataType=h;m.MaxLen=j;m.Scale=b;m.InitFlags(p);m.ToolTip=k;m.Stretch=g;if(l!=-1){m.BackColor=l}else{if(f.GetBackColor()!=-1){m.BackColor=f.GetBackColor()}}if(c!=-1){m.ForeColor=c}else{if(f.GetForeColor()!=-1){m.ForeColor=f.GetForeColor()}}if(!o.equals("")){m.FontMod=o}else{if(f.GetFontMod().length>0){m.FontMod=f.GetFontMod()}}if(!e.equals("")){m.Mask=e}m.Parent=f;f.SpanList.Add(m);IDREGlb.SetArraySize(this.ObjMap,a+1);this.ObjMap[a]=m};CIDREObj.prototype.InitReport=function(c,b){var a=new CReport();a.ReportID=c;a.InitFlags(b);a.Parent=this.Book;a.ParentBox=null;this.Book.ReportsList.Add(a);IDREGlb.SetArraySize(this.ObjMap,c+1);this.ObjMap[c]=a};CIDREObj.prototype.SetReportQuery=function(c,g,e,d,b){var a=this.FindObjByID(c);var f=null;if(e==-1){f=new CDSEDB();f.ConnectionS=g;f.SQLstr=d}else{f=new CDSEIMDB();f.IMDBTable=e}a.DSE=f;f.Parent=a;f.iGuid=b};CIDREObj.prototype.SetReportQueryColumnDT=function(b,d,c){var a=this.FindObjByID(b);a.DSE.RSDT[d]=c};CIDREObj.prototype.SetReportQueryDO=function(d,e,c,b){var f=new CDSEDO();var a=this.FindObjByID(d);a.DSE=f;f.Parent=a;f.iGuid=b;f.SetDocumentClass(e);f.Master=c};CIDREObj.prototype.AddReportQueryColumnDO=function(c,b){var a=this.FindObjByID(c);a.DSE.AddQueryColumn(b)};CIDREObj.prototype.AddReportOrderByColumnDO=function(c,a){var b=this.FindObjByID(c);b.DSE.AddSortColumn(a)};CIDREObj.prototype.SetReportWhereClauseDO=function(b,c){var a=this.FindObjByID(b);a.DSE.WC=c;a.DSE.WCOK=false};CIDREObj.prototype.set_ReportDocument=function(b,c){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportDocument","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return}a.DSE.SetQueryDocument(c);this.ReportRefreshQuery(b)};CIDREObj.prototype.ReportDocument=function(b){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportDocument","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return null}if(this.Book.FormattingObj!=null){return a.DSE.GetDocument()}else{return a.DSE.Document}};CIDREObj.prototype.set_ReportCollection=function(c,b){var a=this.FindObjByID(c);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportDocument","Report "+this.GetObjName(c)+": report is not DocumentOriented")}return}a.DSE.SetQueryCollection(b);this.ReportRefreshQuery(c)};CIDREObj.prototype.ReportCollection=function(b){var a=this.FindObjByID(b);if(!(a.DSE instanceof CDSEDO)){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(0),572,"CIDREObj.set_ReportDocument","Report "+this.GetObjName(b)+": report is not DocumentOriented")}return null}return a.DSE.IDColl};CIDREObj.prototype.SetSubReportBox=function(d,b){var a=this.FindObjByID(d);var c=this.FindObjByID(b);c.SubReport=a;a.ParentBox=c};CIDREObj.prototype.ReportFreezed=function(b){var a=this.FindObjByID(b);return a.Freezed};CIDREObj.prototype.set_ReportFreezed=function(c,b){var a=this.FindObjByID(c);a.Freezed=b};CIDREObj.prototype.InitSection=function(h,j,b,g,a,e,l,k,d){var c=this.FindObjByID(h);var f=new CSection();f.SectionID=j;f.Height=b;f.NumCol=g;f.ColSpace=a;f.SectType=e;f.VisAttrIdx=l;f.InitFlags(k);f.DBFieldName=d;if(e==IDREGlb.SECT_GROUPHEADER||e==IDREGlb.SECT_GROUPFOOTER){f.GroupLevel=c.DSE.AddGroup(f.DBFieldName)}f.Parent=c;c.SectionsList.Add(f);IDREGlb.SetArraySize(this.ObjMap,j+1);this.ObjMap[j]=f};CIDREObj.prototype.AddReportGroup=function(a,b){var c=this.FindObjByID(a);if(c.Parent.ReInitGroups){c.Parent.ReInitGroups=false;c.Parent.DSE.GroupStringArray.Clear()}c.GroupLevel=c.Parent.DSE.AddGroup(c.DBFieldName)};CIDREObj.prototype.SetSectionRendersInto=function(b,a){var d=this.FindObjByID(b);var c=this.FindObjByID(a);d.RendersInto=c};CIDREObj.prototype.InitReportBox=function(a,r,e,d,t,m,g,s,b,q,o,w,c,u,f,j,p,v,l){if(j==undefined){j=-1}if(p==undefined){p=-1}if(v==undefined){v=""}if(l==undefined){l=IDREGlb.VISALN_AUTO}var h=this.FindObjByID(a);var k=new CRptBox();k.BoxID=r;k.XPos=e;k.YPos=d;k.Width=t;k.Height=m;k.Interline=g;k.HRsz=s;k.VRsz=b;k.VisAttrIdx=q;k.FontHeight=w;k.InitFlags(o);k.ToolTip=c;k.Stretch=u;k.VisProp=f;k.SetBackColor(j);k.SetForeColor(p);k.SetFontMod(v);k.Alignment=l;k.PMastro=(h.RendersInto!=null?h.RendersInto.PMastro:null);k.PSection=h;h.BoxList.Add(k);IDREGlb.SetArraySize(this.ObjMap,r+1);this.ObjMap[r]=k};CIDREObj.prototype.SetBoxImage=function(d,b,a){d=this.GetOldID2NewID(d);if(d==0){return}var g=this.FindObjByID(d);var f=null;var e=0;if(this.Book.FormattingObj!=null){f=this.Book.GetFormattingObj(g)}if(!a.equals("")){e=0;for(var c=0;c<this.Book.ImagesPath.Count();c++){var h=this.Book.ImagesPath[c];if(String.compare(h,a,false)==0){e=c+1;break}}if(e==0){this.Book.ImagesPath.Add(a);e=this.Book.ImagesPath.Count()}}if(f!=null){if(f.ImageIdx!=e){this.AObjectChanged(f);f.ImageIdx=e;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(g)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(g.BoxID),426,"CIDREObj.SetBoxImage","Box "+this.GetObjName(g.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}g.ImageIdx=e}}};CIDREObj.prototype.SetBoxNextBox=function(a,d){var c=this.FindObjByID(a);var b=this.FindObjByID(d);c.NextBox=b};CIDREObj.prototype.SetBoxGraph=function(a,c){var b=this.FindObjByID(a);b.SubGraph=c;b.SubGraph.QueryObj.ParentRep=b.PSection.Parent};CIDREObj.prototype.SetSpanValueListItem=function(a,g,b,h,c,j,e){a=this.GetOldID2NewID(a);if(a==0){return}var k=this.FindObjByID(a);var f=new CRptSpanValItem();f.Name=g;f.Value.set(h);f.Description=b;f.VisualStyle=e;if(this.IsServlet){f.Image.set_ServletImage(c)}f.ImagePath=j;var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(k)}if(d!=null){this.AObjectChanged(imgbox);if(d.ValueList==null){d.ValueList=new ArrayList()}d.ValueList.Add(f);if(d.ValueSourceIdx<d.ValueList.Count()){d.SetNewValue(d.Value)}this.set_RD(true)}else{if(!this.Book.IsChildOfFormattingObj(k)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(k.SpanID),427,"CIDREObj.SetSpanValueListItem","Span "+this.GetObjName(k.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the object that fired the event -> Changing object's design time property")}if(k.ValueList==null){k.ValueList=new ArrayList()}k.ValueList.Add(f);if(!this.Book.ChangedObj.Contains(k)){this.Book.ChangedObj.Add(k)}}}};CIDREObj.prototype.GetReportColumn=function(c,e){c=this.GetOldID2NewID(c);if(c==0){return new IDVariant()}var a=this.FindObjByID(c);var d=a.DSE.GetFldIdx(e);var b=new IDVariant();if(a.DSE.IsOpen()&&!a.DSE.IsEof()){a.DSE.GetFieldValue(b,d)}else{if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.ReportID),428,"CIDREObj.GetReportColumn","Report "+this.GetObjName(a.ReportID)+": Report's DataSource is closed or in EOF -> Can't read report's column value")}b.set(new IDVariant())}return b};CIDREObj.prototype.GetReportTotalRecords=function(b){b=this.GetOldID2NewID(b);if(b==0){return 0}var a=this.FindObjByID(b);if(a.DSE!=null){return a.DSE.GetNumRecords()}else{return 0}};CIDREObj.prototype.GetAggrFunct=function(c,b,e){b=this.GetOldID2NewID(b);if(b==0){return new IDVariant()}var d=this.FindObjByID(b);var a=new IDVariant();d.Parent.DSE.GetAggrFunct(c,d.GroupLevel,e,a);return a};CIDREObj.prototype.GetPageNumber=function(){var a=0;if(this.Book.FormattingPage!=null){a=this.Book.FormattingPage.PageNum}else{if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}}return a};CIDREObj.prototype.GetLastCachedPage=function(){var a=this.Book.GetLastCachedPage();if(a!=null){return a.PageNum}else{return 0}};CIDREObj.prototype.MastroRect=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return 0}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){return c.GetRect(a)}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.MastroID),573,"CIDREObj.MastroRect","Page "+this.GetObjName(b.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return b.GetRect(a)}};CIDREObj.prototype.set_MastroRect=function(e,a,c){e=this.GetOldID2NewID(e);if(e==0){return}var b=this.FindObjByID(e);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(b)}if(d!=null){d.SetRect(a,c)}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.MastroID),429,"CIDREObj.set_MastroRect","Page "+this.GetObjName(b.MastroID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}b.SetRect(a,c)}};CIDREObj.prototype.MastroOrientation=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Orientation}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),574,"CIDREObj.MastroOrientation","Page "+this.GetObjName(a.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Orientation}};CIDREObj.prototype.set_MastroOrientation=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){c.Orientation=b}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),430,"CIDREObj.set_MastroOrientation","Page "+this.GetObjName(a.MastroID)+": Changing properties while a formatting event is firing but the object is not inside the object that fired the event -> Changing object's design time property")}a.Orientation=b}};CIDREObj.prototype.MastroFitMode=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.FitMode}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),575,"CIDREObj.MastroFitMode","Page "+this.GetObjName(a.MastroID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.FitMode}};CIDREObj.prototype.set_MastroFitMode=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){c.FitMode=b}else{if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.MastroID),431,"CIDREObj.set_MastroFitMode","Page "+this.GetObjName(a.MastroID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}a.FitMode=b}};CIDREObj.prototype.BoxRect=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return 0}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){return c.GetRect(a)}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),576,"CIDREObj.BoxRect","Box "+this.GetObjName(d.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return d.GetRect(a)}}return 0};CIDREObj.prototype.set_BoxRect=function(c,a,b){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(e)}if(d!=null){if(d.GetRect(a)!=b){this.AObjectChanged(d);d.SetRect(a,b);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(e)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.BoxID),432,"CIDREObj.set_BoxRect","Box "+this.GetObjName(e.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}e.SetRect(a,b)}}};CIDREObj.prototype.BoxVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),577,"CIDREObj.BoxVisible","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)}}return false};CIDREObj.prototype.set_BoxVisible=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTBOX_VISIBLE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),433,"CIDREObj.set_BoxVisible","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFlag(IDREGlb.FL_RPTBOX_VISIBLE,a)}}};CIDREObj.prototype.BoxInterline=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Interline}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),578,"CIDREObj.BoxInterline","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Interline}}return 0};CIDREObj.prototype.set_BoxInterline=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Interline!=a){this.AObjectChanged(c);c.Interline=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),434,"CIDREObj.set_BoxInterline","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Interline=a}}};CIDREObj.prototype.BoxVisualStyle=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.VisAttrIdx}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),579,"CIDREObj.BoxVisualStyle","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.VisAttrIdx}}return 0};CIDREObj.prototype.set_BoxVisualStyle=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.VisAttrIdx!=a){this.AObjectChanged(c);c.SetVisualStyle(a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),435,"CIDREObj.set_BoxVisualStyle","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetVisualStyle(a)}}};CIDREObj.prototype.BoxToolTip=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.ToolTip}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),580,"CIDREObj.BoxToolTip","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.ToolTip}}return""};CIDREObj.prototype.set_BoxToolTip=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.ToolTip.equals(a)){this.AObjectChanged(c);c.ToolTip=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),436,"CIDREObj.set_BoxToolTip","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.ToolTip=a}}};CIDREObj.prototype.BoxFlag=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFlag(d)}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),581,"CIDREObj.BoxFlag","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(d)}}return false};CIDREObj.prototype.set_BoxFlag=function(b,e,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.GetFlag(e)!=a){this.AObjectChanged(c);c.SetFlag(e,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),437,"CIDREObj.set_BoxFlag","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFlag(e,a)}}};CIDREObj.prototype.BoxStretch=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Stretch}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),582,"CIDREObj.BoxStretch","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Stretch}}return -1};CIDREObj.prototype.set_BoxStretch=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Stretch!=a){this.AObjectChanged(c);c.Stretch=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),438,"CIDREObj.set_BoxStretch","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Stretch=a}}};CIDREObj.prototype.BoxRotation=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Rotation}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),583,"CIDREObj.BoxRotation","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Rotation}}return -1};CIDREObj.prototype.set_BoxRotation=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Rotation!=a){this.AObjectChanged(c);c.Rotation=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),439,"CIDREObj.set_BoxRotation","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Rotation=a}}};CIDREObj.prototype.BoxBackgroundColor=function(a){a=this.GetOldID2NewID(a);if(a==0){return -2}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetBackColor()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),584,"CIDREObj.BoxBackgroundColor","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetBackColor()}}return -2};CIDREObj.prototype.set_BoxBackgroundColor=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(b.GetBackColor()!=d){this.AObjectChanged(b);b.SetBackColor(d);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),464,"CIDREObj.set_BoxBackgroundColor","Box "+this.GetObjName(c.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}c.SetBackColor(d)}}};CIDREObj.prototype.BoxForegroundColor=function(a){a=this.GetOldID2NewID(a);if(a==0){return -2}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetForeColor()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),585,"CIDREObj.BoxForegroundColor","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetForeColor()}}return -2};CIDREObj.prototype.set_BoxForegroundColor=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(b.GetForeColor()!=d){this.AObjectChanged(b);b.SetForeColor(d);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),473,"CIDREObj.set_BoxForegroundColor","Box "+this.GetObjName(c.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}c.SetForeColor(d)}}};CIDREObj.prototype.BoxAlignment=function(a){a=this.GetOldID2NewID(a);if(a==0){return -1}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Alignment}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),586,"CIDREObj.BoxAlignment","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Alignment}}return -1};CIDREObj.prototype.set_BoxAlignment=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(c.Alignment!=a){this.AObjectChanged(c);c.Alignment=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),474,"CIDREObj.set_BoxAlignment","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Alignment=a}}};CIDREObj.prototype.BoxFontModifiers=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetFontMod()}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),587,"CIDREObj.BoxFontModifiers","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFontMod()}}return""};CIDREObj.prototype.set_BoxFontModifiers=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.GetFontMod().equals(a)){this.AObjectChanged(c);c.SetFontMod(a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),475,"CIDREObj.set_BoxFontModifiers","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.SetFontMod(a)}}};CIDREObj.prototype.BoxSubForm=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.GetSubForm()}else{if(this.Book.DTTObj.Level>0){if(c.PSection!=null){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),465,"CIDREObj.BoxSubForm","Box "+this.GetObjName(c.BoxID)+": The sub-form property can be read only inside BeforeFormatting or AfterFormatting of the section that contains this box")}else{this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),465,"CIDREObj.BoxSubForm","Box "+this.GetObjName(c.BoxID)+": The sub-form property can be read only inside OnFormatting event of the page that contains this box")}}}return null};CIDREObj.prototype.set_BoxSubForm=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){if(c.SubGraph!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),466,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": This box contains a graph thus you can't insert a form into it")}}else{if(c.SubReport!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),466,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": This box contains a sub-report thus you can't insert a form into it")}}else{if(b.SubForm!=d){b.SetSubForm(d)}}}}else{if(this.Book.DTTObj.Level>0){if(c.PSection!=null){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),467,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": SubForm can be set only inside BeforeFormatting or AfterFormatting of the section that contains this box")}else{this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),467,"CIDREObj.set_BoxSubForm","Box "+this.GetObjName(c.BoxID)+": SubForm can be set only inside OnFormatting event of the page that contains this box")}}}};CIDREObj.prototype.BoxVisProp=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return -1}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){return(a==undefined?c.VisProp:(c.VisProp&a)!=0)}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),588,"CIDREObj.BoxVisProp","Box "+this.GetObjName(d.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return(a==undefined?d.VisProp:(d.VisProp&a)!=0)}}return -1};CIDREObj.prototype.set_BoxVisProp=function(c,a,b){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);var d=null;if(this.Book.FormattingObj!=null){d=this.Book.GetFormattingObj(e)}if(d!=null){var f=(d.VisProp&~a)|(b?a:0);if(d.VisProp!=f){this.AObjectChanged(d);d.VisProp=f;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(e)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.BoxID),439,"CIDREObj.set_BoxVisProp","Box "+this.GetObjName(e.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}e.VisProp=(e.VisProp&~a)|(b?a:0)}}};CIDREObj.prototype.BoxBadge=function(a){a=this.GetOldID2NewID(a);if(a==0){return""}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}if(b!=null){return b.Badge}else{if(!this.Book.IsChildOfFormattingObj(c)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.BoxID),589,"CIDREObj.BoxBadge","Box "+this.GetObjName(c.BoxID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.Badge}}return""};CIDREObj.prototype.set_BoxBadge=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var d=this.FindObjByID(b);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(d)}if(c!=null){if(!c.Badge.equals(a)){this.AObjectChanged(c);c.Badge=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(d)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.BoxID),439,"CIDREObj.set_BoxBadge","Box "+this.GetObjName(d.BoxID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}d.Badge=a}}};CIDREObj.prototype.SpanText=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Text}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),590,"CIDREObj.SpanText","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Text}}return""};CIDREObj.prototype.set_SpanText=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Text.equals(a)){this.AObjectChanged(c);c.Text=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),440,"CIDREObj.set_SpanText","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Text=a}}};CIDREObj.prototype.SpanValue=function(c){c=this.GetOldID2NewID(c);if(c==0){return new IDVariant()}var a=this.FindObjByID(c);if(this.Book.FormattingObj!=null){var b=this.Book.GetFormattingObj(a);if(b!=null){return b.Value}}return new IDVariant()};CIDREObj.prototype.set_SpanValue=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);if(this.Book.FormattingObj!=null){var c=this.Book.GetFormattingObj(b);if(c!=null){if(!c.Value.equals(a)){this.AObjectChanged(c);c.SetNewValue(a);this.set_RD(true)}}}};CIDREObj.prototype.SpanVisible=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),591,"CIDREObj.SpanVisible","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)}}return false};CIDREObj.prototype.set_SpanVisible=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_VISIBLE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),441,"CIDREObj.set_SpanVisible","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_VISIBLE,a)}}};CIDREObj.prototype.SpanEnabled=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),592,"CIDREObj.SpanEnabled","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)}}return false};CIDREObj.prototype.set_SpanEnabled=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_ENABLED)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_ENABLED,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),442,"CIDREObj.set_SpanEnabled","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_ENABLED,a)}}};CIDREObj.prototype.SpanActive=function(c){c=this.GetOldID2NewID(c);if(c==0){return false}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),593,"CIDREObj.SpanActive","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)}}return false};CIDREObj.prototype.set_SpanActive=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.GetFlag(IDREGlb.FL_RPTSPAN_ACTIVE)!=a){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_RPTSPAN_ACTIVE,a);this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),443,"CIDREObj.set_SpanActive","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.SetFlag(IDREGlb.FL_RPTSPAN_ACTIVE,a)}}};CIDREObj.prototype.SpanVisualStyle=function(c){c=this.GetOldID2NewID(c);if(c==0){return 0}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.VisAttrIdx}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),594,"CIDREObj.SpanVisualStyle","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.VisAttrIdx}}return 0};CIDREObj.prototype.set_SpanVisualStyle=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.VisAttrIdx!=a){this.AObjectChanged(c);c.VisAttrIdx=a;if(c.Value.Type!=IDVariant.NULL){c.SetNewValue(c.Value)}c.VisAttrIdx=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),444,"CIDREObj.set_SpanVisualStyle","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.VisAttrIdx=a}}};CIDREObj.prototype.SpanToolTip=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.ToolTip}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),595,"CIDREObj.SpanToolTip","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.ToolTip}}return""};CIDREObj.prototype.set_SpanToolTip=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.ToolTip.equals(a)){this.AObjectChanged(c);c.ToolTip=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),445,"CIDREObj.set_SpanToolTip","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.ToolTip=a}}};CIDREObj.prototype.SpanStretch=function(c){c=this.GetOldID2NewID(c);if(c==0){return -1}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Stretch}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),596,"CIDREObj.SpanStretch","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Stretch}}return -1};CIDREObj.prototype.set_SpanStretch=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(c.Stretch!=a){this.AObjectChanged(c);c.Stretch=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),446,"CIDREObj.set_SpanStretch","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Stretch=a}}};CIDREObj.prototype.SpanBackgroundColor=function(c){c=this.GetOldID2NewID(c);if(c==0){return -2}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.BackColor}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),597,"CIDREObj.SpanBackgroundColor","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.BackColor}}return -2};CIDREObj.prototype.set_SpanBackgroundColor=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){if(c.BackColor!=b){this.AObjectChanged(c);c.BackColor=b;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),468,"CIDREObj.set_SpanBackgroundColor","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.BackColor=b}}};CIDREObj.prototype.SpanForegroundColor=function(c){c=this.GetOldID2NewID(c);if(c==0){return -2}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.ForeColor}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),598,"CIDREObj.SpanForegroundColor","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.ForeColor}}return -2};CIDREObj.prototype.set_SpanForegroundColor=function(d,b){d=this.GetOldID2NewID(d);if(d==0){return}var a=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(a)}if(c!=null){if(c.ForeColor!=b){this.AObjectChanged(c);c.ForeColor=b;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),469,"CIDREObj.set_SpanForegroundColor","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.ForeColor=b}}};CIDREObj.prototype.SpanFontModifiers=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.FontMod}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),599,"CIDREObj.SpanFontModifiers","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.FontMod}}return""};CIDREObj.prototype.set_SpanFontModifiers=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.FontMod.equals(a)){this.AObjectChanged(c);c.FontMod=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),470,"CIDREObj.set_SpanFontModifiers","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.FontMod=a}}};CIDREObj.prototype.SpanMask=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Mask}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),600,"CIDREObj.SpanMask","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Mask}}return""};CIDREObj.prototype.set_SpanMask=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Mask.equals(a)){this.AObjectChanged(c);c.Mask=a;if(c.Value.Type!=IDVariant.NULL){c.SetNewValue(c.Value)}this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),471,"CIDREObj.set_SpanMask","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Mask=a}}};CIDREObj.prototype.SpanWatermark=function(c){c=this.GetOldID2NewID(c);if(c==0){return""}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){return b.Watermark}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),601,"CIDREObj.SpanWatermark","Box "+this.GetObjName(a.SpanID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return a.Watermark}}return""};CIDREObj.prototype.set_SpanWatermark=function(d,a){d=this.GetOldID2NewID(d);if(d==0){return}var b=this.FindObjByID(d);var c=null;if(this.Book.FormattingObj!=null){c=this.Book.GetFormattingObj(b)}if(c!=null){if(!c.Watermark.equals(a)){this.AObjectChanged(c);c.Watermark=a;this.set_RD(true)}}else{if(!this.Book.IsChildOfFormattingObj(b)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(b.SpanID),472,"CIDREObj.set_SpanWatermark","Span "+this.GetObjName(b.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}b.Watermark=a}}};CIDREObj.prototype.EmptySpanValueList=function(c){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}if(b!=null){this.AObjectChanged(b);b.ValueList=new ArrayList();this.set_RD(true)}else{if(!this.Book.IsChildOfFormattingObj(a)){if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(a.SpanID),447,"CIDREObj.EmptySpanValueList","Span "+this.GetObjName(a.SpanID)+": Changing properties while a formatting event is firing but the object is not inside the one that fired the event -> Changing object's design time property")}a.ValueList=new ArrayList()}}};CIDREObj.prototype.SectionHeight=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetHeight()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetHeight()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),602,"CIDREObj.SectionHeight","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetHeight()};CIDREObj.prototype.set_SectionHeight=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetHeight(b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetHeight()!=b){this.AObjectChanged(c);c.SetHeight(b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),448,"CIDREObj.set_SectionHeight","Section "+this.GetObjName(d.SectionID)+": Changing Height during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),449,"CIDREObj.set_SectionHeight","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetHeight(b)};CIDREObj.prototype.SectionVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_VISIBLE)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_VISIBLE)}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),603,"CIDREObj.SectionVisible","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(IDREGlb.FL_SECT_VISIBLE)};CIDREObj.prototype.set_SectionVisible=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetFlag(IDREGlb.FL_SECT_VISIBLE,b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetFlag(IDREGlb.FL_SECT_VISIBLE)!=b){this.AObjectChanged(c);c.SetFlag(IDREGlb.FL_SECT_VISIBLE,b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),450,"CIDREObj.set_SectionVisible","Section "+this.GetObjName(d.SectionID)+": Changing Visibility during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),451,"CIDREObj.set_SectionVisible","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetFlag(IDREGlb.FL_SECT_VISIBLE,b)};CIDREObj.prototype.SectionShowChildren=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(d);if(b!=null){return b.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var c=this.Book.GetFormattingObj(d);if(c!=null){return c.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){return c.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)}}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),604,"CIDREObj.SectionShowChildren","Section "+this.GetObjName(d.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return d.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)};CIDREObj.prototype.set_SectionShowChildren=function(l,c){l=this.GetOldID2NewID(l);if(l==0){return}var f=this.FindObjByID(l);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var e=this.Book.GetFormattingObj(f);if(e!=null){e.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);var h=f.Parent.GetPermanentState(e);if(h==null){h=new PSectionState();f.Parent.PermStatesList.Add(h);h.SectionID=f.SectionID;h.DSECurrentPosition=f.Parent.DSE.GetCurrentPosition();h.Flags=e.GetFlags();h.PageNum=-1}h.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);return}}if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var d=this.Book.GetFormattingObj(f);if(d!=null){var h=d.ParentSection.Parent.GetPermanentState(d.ParentSection.SectionID,d.DSEPosition);if(h==null){h=new PSectionState();d.ParentSection.Parent.PermStatesList.Add(h);h.SectionID=d.ParentSection.SectionID;h.DSECurrentPosition=d.DSEPosition;h.Flags=d.GetFlags();h.PageNum=d.Parent.PageNum}h.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);if(this.Book.PE.PrintingPage!=null){var g=this.Book.PE.PrintingPage.PageNum;if(h.GH_PageNum!=-1){g=h.GH_PageNum}if(f.SectType==IDREGlb.SECT_GROUPHEADER&&f.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)){for(var b=0;b<this.Book.ReportsList.Count();b++){var k=this.Book.ReportsList[b];for(var j=0;j<k.PermStatesList.Count();j++){var a=k.PermStatesList[j];if((a.PageNum==-1||a.PageNum>g)&&a.SectionID==f.SectionID&&a.GH_DSECurrentPosition==h.GH_DSECurrentPosition){k.PermStatesList.RemoveAt(j--)}}}}this.Book.RefreshPages(g);this.Book.PrintPages(g,g)}return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(f.SectionID),452,"CIDREObj.set_SectionShowChildren","Section "+this.GetObjName(f.SectionID)+": Changing ShowChildren flag during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(f.SectionID),453,"CIDREObj.set_SectionShowChildren","Section "+this.GetObjName(f.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}if(f.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)!=c){f.SetFlag(IDREGlb.FL_SECT_SHOWCHILD,c);for(var b=0;b<this.Book.ReportsList.Count();b++){var k=this.Book.ReportsList[b];for(var j=0;j<k.PermStatesList.Count();j++){var a=k.PermStatesList[j];if(a.SectionID==f.SectionID){k.PermStatesList.RemoveAt(j--)}}}}};CIDREObj.prototype.SectionFlag=function(a,d){a=this.GetOldID2NewID(a);if(a==0){return false}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(d)}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetFlag(d)}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),605,"CIDREObj.SectionFlag","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetFlag(d)};CIDREObj.prototype.set_SectionFlag=function(a,e,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetFlag(e,b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.GetFlag(e)!=b){this.AObjectChanged(c);c.SetFlag(e,b);this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),454,"CIDREObj.set_SectionFlag","Section "+this.GetObjName(d.SectionID)+": Changing flag during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),455,"CIDREObj.set_SectionFlag","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetFlag(e,b)};CIDREObj.prototype.SectionVisualStyle=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.VisAttrIdx}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.VisAttrIdx}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),606,"CIDREObj.SectionVisualStyle","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.VisAttrIdx};CIDREObj.prototype.set_SectionVisualStyle=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.VisAttrIdx=b;return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var c=this.Book.GetFormattingObj(d);if(c!=null){if(c.VisAttrIdx!=b){this.AObjectChanged(c);c.VisAttrIdx=b;this.set_RD(true)}return}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),456,"CIDREObj.set_SectionVisualStyle","Section "+this.GetObjName(d.SectionID)+": Changing VisualStyle during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),457,"CIDREObj.set_SectionVisualStyle","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.VisAttrIdx=b};CIDREObj.prototype.SectionGroupLevel=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var b=this.FindObjByID(a);if(this.Book.FormattingObj!=null){}return b.GroupLevel+1};CIDREObj.prototype.set_SectionGroupLevel=function(f,a){f=this.GetOldID2NewID(f);if(f==0){return}var e=this.FindObjByID(f);if(this.Book.FormattingObj!=null){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(e.SectionID),458,"CIDREObj.set_SectionGroupLevel","Section "+this.GetObjName(e.SectionID)+": Changing of GroupLevel property is not is not allowed during a formatting event -> Skipping operation")}}else{if(e.Parent.DSE.GroupArray.Count()==0&&e.Parent.DSE.GroupStringArray.Count()>0){e.Parent.DSE.CreateGroups()}a--;if(a>=0&&a<e.Parent.DSE.GroupArray.Count()&&e.GroupLevel!=a){var j=e.GroupLevel;var m=e.Parent.DSE.GroupStringArray[j];var b=e.Parent.DSE.GroupArray[j];for(var l=0;l<e.Parent.SectionsList.Count();l++){var k=e.Parent.SectionsList[l];if(k.SectType!=IDREGlb.SECT_GROUPHEADER&&k.SectType!=IDREGlb.SECT_GROUPFOOTER){continue}if(k==e){continue}if(k.DBFieldName.equals(e.DBFieldName)){k.GroupLevel=a;continue}if(k.GroupLevel<=Math.max(e.GroupLevel,a)&&k.GroupLevel>=Math.min(e.GroupLevel,a)){if(a>e.GroupLevel){k.GroupLevel--}else{k.GroupLevel++}}}e.GroupLevel=a;e.Parent.DSE.GroupStringArray.RemoveAt(j);e.Parent.DSE.GroupArray.RemoveAt(j);e.Parent.DSE.GroupStringArray.Insert(a,m);e.Parent.DSE.GroupArray.Insert(a,b);var h;for(h=0;h<e.Parent.SectionsList.Count();h++){var d=e.Parent.SectionsList[h];if(d.SectType==IDREGlb.SECT_GROUPHEADER){for(var g=h;g<e.Parent.SectionsList.Count();g++){var c=e.Parent.SectionsList[g];if(c.SectType==IDREGlb.SECT_GROUPHEADER&&d.GroupLevel>c.GroupLevel){e.Parent.SectionsList[h]=c;e.Parent.SectionsList[g]=d;h=-1;break}}}}for(h=0;h<e.Parent.SectionsList.Count();h++){var d=e.Parent.SectionsList[h];if(d.SectType==IDREGlb.SECT_GROUPFOOTER){for(var g=h;g<e.Parent.SectionsList.Count();g++){var c=e.Parent.SectionsList[g];if(c.SectType==IDREGlb.SECT_GROUPFOOTER&&d.GroupLevel<c.GroupLevel){e.Parent.SectionsList[h]=c;e.Parent.SectionsList[g]=d;h=-1;break}}}}e.Parent.DSE.OrderGroups()}}};CIDREObj.prototype.SectionColumns=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.NumCol}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.NumCol}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),607,"CIDREObj.SectionColumns","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.NumCol};CIDREObj.prototype.set_SectionColumns=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=null;c=this.Book.GetFormattingObj(d);if(c!=null){c.NumCol=b;return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),459,"CIDREObj.set_SectionColumns","Section "+this.GetObjName(d.SectionID)+": Changing ColumnNumber during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),460,"CIDREObj.set_SectionColumns","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.NumCol=b};CIDREObj.prototype.SectionColSpace=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetColSpace()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetColSpace()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),608,"CIDREObj.SectionColSpace","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return c.GetColSpace()};CIDREObj.prototype.set_SectionColSpace=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.SetColSpace(b);return}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}if(this.Book.DTTObj.Level>0){if(this.Book.FormattingObj!=null&&this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),461,"CIDREObj.set_SectionColSpace","Section "+this.GetObjName(d.SectionID)+": Changing ColumnSpace during AfterFormatting event is not allowed -> Changing section's design time property")}else{if(this.Book.FormattingType!=0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),462,"CIDREObj.set_SectionColSpace","Section "+this.GetObjName(d.SectionID)+": Changing properties while a formatting event is firing but the object is not the one that fired the event -> Changing object's design time property")}}}d.SetColSpace(b)};CIDREObj.prototype.GetSectionYPos=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetYPos()}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){var b=this.Book.GetFormattingObj(c);if(b!=null){return b.GetYPos()}}}}if(this.Book.FormattingType!=0&&this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(c.SectionID),609,"CIDREObj.GetSectionYPos","Section "+this.GetObjName(c.SectionID)+": Reading properties while a formatting event is firing but the object is not the one that fired the event -> Return object's design time property")}return 0};CIDREObj.prototype.SetSectionReprint=function(a,b){a=this.GetOldID2NewID(a);if(a==0){return}var d=this.FindObjByID(a);if(this.Book.FormattingObj!=null){if(this.Book.FormattingType==IDREGlb.FRM_SECTION){var c=this.Book.GetFormattingObj(d);if(c!=null){c.Reprint=b}}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT){}else{if(this.Book.FormattingType==IDREGlb.FRM_SECTION_PERM){}}}}else{}if(this.Book.DTTObj.Level>0&&(this.Book.FormattingObj==null||this.Book.FormattingType==IDREGlb.FRM_SECTION_AFT)){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.GetRTCGuid(d.SectionID),463,"CIDREObj.SetSectionReprint","Section "+this.GetObjName(d.SectionID)+": Reprint can only be called during BeforeFormatting event -> Skipping operation")}};CIDREObj.prototype.ReportVisible=function(a){a=this.GetOldID2NewID(a);if(a==0){return false}var b=this.FindObjByID(a);if(b!=null){return b.GetFlag(IDREGlb.FL_REPORT_VISIBLE)}else{return false}};CIDREObj.prototype.set_ReportVisible=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var c=this.FindObjByID(b);if(c!=null){c.SetFlag(IDREGlb.FL_REPORT_VISIBLE,a)}};CIDREObj.prototype.ReportMaxRows=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var b=this.FindObjByID(a);if(b!=null){return b.DSE.MaxRows}return 0};CIDREObj.prototype.set_ReportMaxRows=function(b,a){b=this.GetOldID2NewID(b);if(b==0){return}var c=this.FindObjByID(b);if(c!=null){c.DSE.MaxRows=a}};CIDREObj.prototype.ReportRefreshQuery=function(c,b){if(b==undefined){b=true}c=this.GetOldID2NewID(c);if(c==0){return}var d=this.FindObjByID(c);d.DSE.Close(true);if(d.DSE instanceof CDSEDB){d.DSE.UpdateParam(true)}if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(d.ReportID),568,"CIDREObj.ReportRefreshQuery","Report "+this.GetObjName(d.ReportID)+": Refreshing report's query")}this.Book.TotalPagesNumberConf=false;if(b){var a=-1;if(this.Book.PE.PrintingPage!=null){a=this.Book.PE.PrintingPage.PageNum}this.Book.RefreshPages(1);if(a!=-1){if(this.Book.DTTObj.Level>0){this.Book.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,this.GetRTCGuid(d.ReportID),569,"CIDREObj.ReportRefreshQuery","Report "+this.GetObjName(d.ReportID)+": The book was showing page "+a+" in preview -> Reformatting up to that page")}this.Book.PrintPages(a,a)}}};CIDREObj.prototype.SetReportWhereClause=function(e,d,b,a){if(b==undefined){b=""}if(a==undefined){a=true}var c;if(e==-1){c=this.Book.ReportsList[0];e=c.ReportID}else{e=this.GetOldID2NewID(e);if(e==0){return}c=this.FindObjByID(e)}if(c!=null&&c.DSE instanceof CDSEDB){c.DSE.MergeWhereClause(d,b,a);this.ReportRefreshQuery(e)}};CIDREObj.prototype.ReportSelectSection=function(c,a,b){var c=this.GetOldID2NewID(c);if(c==0){return false}var d=this.FindObjByID(c);if(d!=null){return d.SelectSection(a,b)}else{return false}};CIDREObj.prototype.SetObjName=function(b,a){IDREGlb.SetArraySize(this.NameMap,b+1);this.NameMap[b]=a};CIDREObj.prototype.GetObjName=function(a){a=this.GetOldID2NewID(a);var b="";if(a<this.NameMap.Count()){b=this.NameMap[a]}return b};CIDREObj.prototype.SetObjCode=function(a,b){this.Code2IndexMap[b]=a;IDREGlb.SetArraySize(this.Index2CodeMap,a+1);this.Index2CodeMap[a]=b};CIDREObj.prototype.GetObjCode=function(a){a=this.GetOldID2NewID(a);var b="";if(a<this.Index2CodeMap.Count()){b=this.Index2CodeMap[a]}return b};CIDREObj.prototype.GetObjByCode=function(b){var a=this.Code2IndexMap[b];var c=this.FindObjByID(a);return c};CIDREObj.prototype.SetRTCGuid=function(b,a){IDREGlb.SetArraySize(this.GUIDMap,b+1);this.GUIDMap[b]=a};CIDREObj.prototype.GetRTCGuid=function(b){b=this.GetOldID2NewID(b);var a="";if(b<this.GUIDMap.Count()){a=this.GUIDMap[b]}return a};CIDREObj.prototype.GetRTCID=function(a){for(var b=0;b<this.GUIDMap.Count();b++){if(this.GUIDMap[b].equals(a)){return b}}return -1};CIDREObj.prototype.SetFlags=function(a,b,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);if(c instanceof CBook){c.Flags=(c.Flags&~d)|(b&d)}if(c instanceof CRptBox){c.SetFlag(d,(b&d)!=0)}if(c instanceof CRptSpan){c.SetFlag(d,(b&d)!=0)}if(c instanceof CReport){c.SetFlag(d,(b&d)!=0)}if(c instanceof CSection){c.SetFlag(d,(b&d)!=0)}};CIDREObj.prototype.GetNumObjects=function(){return this.GUIDMap.Count()};CIDREObj.prototype.GetObjType=function(a){a=this.GetOldID2NewID(a);if(a==0){return 0}var c=this.FindObjByID(a);var b=IDREGlb.OBJ_UNKNOWN;if(c instanceof CBook){b=IDREGlb.OBJ_BOOK}if(c instanceof CMastro){b=IDREGlb.OBJ_MASTRO}if(c instanceof CRptBox){b=IDREGlb.OBJ_RPTBOX}if(c instanceof CRptSpan){b=IDREGlb.OBJ_RPTSPAN}if(c instanceof CReport){b=IDREGlb.OBJ_REPORT}if(c instanceof CSection){b=IDREGlb.OBJ_SECTION}return b};CIDREObj.prototype.SetRoleFlags=function(a,b,d){a=this.GetOldID2NewID(a);if(a==0){return}var c=this.FindObjByID(a);if(c instanceof CRptBox){c.SetRoleFlag(b&d)}if(c instanceof CRptSpan){c.SetRoleFlag(b&d)}if(c instanceof CReport){c.SetRoleFlag(b&d)}if(c instanceof CSection){c.SetRoleFlag(b&d)}};CIDREObj.prototype.UpdateMastro=function(f,a,g,c,e,d){f=this.GetOldID2NewID(f);if(f==0){return}var b=this.FindObjByID(f);if(a instanceof IDVariant){a=(a.Type==IDVariant.NULL?b.Width:a.intValue());g=(g.Type==IDVariant.NULL?b.Height:g.intValue());c=(c.Type==IDVariant.NULL?b.UM:c.intValue());e=(e.Type==IDVariant.NULL?b.Orientation:e.intValue());d=(d.Type==IDVariant.NULL?b.FitMode:d.intValue())}b.Width=a;b.Height=g;b.UM=c;b.Orientation=e;b.FitMode=d};CIDREObj.prototype.UpdateRptBox=function(q,c,a,m,d,l,j,k,p,o,g,h,f,b){q=this.GetOldID2NewID(q);if(q==0){return}var e=this.FindObjByID(q);if(c instanceof IDVariant){c=(c.Type==IDVariant.NULL?e.X:c.intValue());a=(a.Type==IDVariant.NULL?e.Y:a.intValue());m=(m.Type==IDVariant.NULL?e.Width:m.intValue());d=(d.Type==IDVariant.NULL?e.Height:d.intValue());l=(l.Type==IDVariant.NULL?e.Interline:l.intValue());j=(j.Type==IDVariant.NULL?e.HorizResize:j.intValue());k=(k.Type==IDVariant.NULL?e.VertResize:k.intValue());if(p==null){p=e.VisAttrIdx}h=(h.Type==IDVariant.NULL?e.ToolTip:h.stringValue());f=(f.Type==IDVariant.NULL?e.Stretch:f.intValue())}e.XPos=c;e.YPos=a;e.Width=m;e.Height=d;e.Interline=l;e.HRsz=j;e.VRsz=k;e.Stretch=f;e.VisProp=b;if(p!=0){e.VisAttrIdx=p}e.InitFlags((e.GetFlags()&~g)|(o&g));e.InitFlags(e.GetFlags());e.ToolTip=h};CIDREObj.prototype.UpdateRptSpan=function(a,l,e,g,b,k,f,h,c,d){a=this.GetOldID2NewID(a);if(a==0){return}var j=this.FindObjByID(a);if(e instanceof IDVariant){if(l==null){l=j.VisAttrIdx}e=(e.Type==IDVariant.NULL?j.DataType:e.intValue());g=(g.Type==IDVariant.NULL?j.MaxLen:g.intValue());b=(b.Type==IDVariant.NULL?j.Scale:b.intValue());h=(h.Type==IDVariant.NULL?j.ToolTip:h.stringValue());c=(c.Type==IDVariant.NULL?j.Text:c.stringValue());d=(d.Type==IDVariant.NULL?j.Stretch:d.intValue())}if(l!=0){j.VisAttrIdx=l}j.DataType=e;j.MaxLen=g;j.Scale=b;j.Stretch=d;j.InitFlags((j.GetFlags()&~f)|(k&f));j.InitFlags(j.GetFlags());j.ToolTip=h;j.Text=c};CIDREObj.prototype.UpdateReport=function(c,d,b){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);a.InitFlags((a.GetFlags()&~b)|(d&b));a.InitFlags(a.GetFlags())};CIDREObj.prototype.UpdateReportQuery=function(c,b,d){c=this.GetOldID2NewID(c);if(c==0){return}var a=this.FindObjByID(c);if(d!=-1&&a.DSE instanceof CDSEIMDB){a.DSE.IMDBTable=d}if(b!=null&&a.DSE instanceof CDSEDB){}};CIDREObj.prototype.UpdateSection=function(c,h,b,g,a,f,d){c=this.GetOldID2NewID(c);if(c==0){return}var e=this.FindObjByID(c);if(h instanceof IDVariant){h=(h.Type==IDVariant.NULL?e.Height:h.intValue());b=(b.Type==IDVariant.NULL?e.NumCol:b.intValue());g=(g.Type==IDVariant.NULL?e.ColSpace:g.intValue());if(a==null){a=e.VisAttrIdx}}e.Height=h;e.NumCol=b;e.ColSpace=g;if(a!=0){e.VisAttrIdx=a}if(e.RendersInto==null){f&=~IDREGlb.FL_SECT_VISIBLE}e.InitFlags((e.GetFlags()&~d)|(f&d));e.InitFlags(e.GetFlags())};CIDREObj.prototype.set_RD=function(a){if(this.Book.FormattingObj!=null){if(this.Book.FormattingObj instanceof ASectionState){this.Book.FormattingObj.PageChanged=true}if(this.Book.FormattingObj instanceof ASection){this.Book.FormattingObj.PageChanged=true}}};CIDREObj.prototype.Fire_OnFormattingPage=function(a){if(this.ParentS!=null){this.ParentS.Fire_OnFormattingPage(a)}};CIDREObj.prototype.Fire_OnFormattingSection=function(a){if(this.ParentS!=null){this.ParentS.Fire_OnFormattingSection(a)}};CIDREObj.prototype.Fire_OnAfterFormattingSection=function(a){if(this.ParentS!=null){this.ParentS.Fire_OnAfterFormattingSection(a);if(this.Book.FormattingObj!=null&&this.Book.FormattingPage!=null&&this.Book.FormattingObj.PageChanged){this.ParentS.RD3PageCache.remove(this.Book.FormattingPage.PageNum);this.ParentS.RD3Changed=true}}};CIDREObj.prototype.Fire_OnChangingSpan=function(d,a,b,c){if(this.ParentS!=null){this.ParentS.Fire_OnChangingSpan(d,a,b,c)}};CIDREObj.prototype.Fire_OnBoxDrop=function(b,a){if(this.ParentS!=null){this.ParentS.Fire_OnBoxDrop(new IDVariant(b),new IDVariant(a))}};CIDREObj.prototype.Fire_OnBoxTransform=function(d,e,c,f,a,b){if(this.ParentS!=null){this.ParentS.Fire_OnBoxTransform(new IDVariant(d),new IDVariant(e),new IDVariant(c),new IDVariant(f),new IDVariant(a),b)}};CIDREObj.prototype.Fire_OnConnecting=function(a){if(this.ParentS!=null){this.ParentS.Fire_OnConnecting(a)}};CIDREObj.prototype.Fire_Activated=function(b,a){if(this.ParentS!=null){this.ParentS.Fire_Activated(b,a)}};CIDREObj.prototype.Fire_OnIMDBUpdate=function(a){if(this.ParentS!=null){this.ParentS.Fire_OnIMDBUpdate(a)}};CIDREObj.prototype.Fire_OnPreview=function(){if(this.ParentS!=null){this.ParentS.Fire_OnPreview()}};CIDREObj.prototype.ShowDragBox=function(){if(this.Book.DDSrcBox!=null){if(this.Book.DDSrcBox.ParentSect!=null){this.Book.FormattingObj=this.Book.DDSrcBox.ParentSect;this.Book.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Book.DDSrcBox.ParentPage!=null){this.Book.FormattingObj=this.Book.DDSrcBox.ParentPage;this.Book.FormattingType=IDREGlb.FRM_PAGE}}this.Book.MoveDSEPositions(this.Book.DDSrcBox)}};CIDREObj.prototype.ShowDropBox=function(){if(this.Book.DDDstBox!=null){if(this.Book.DDDstBox.ParentSect!=null){this.Book.FormattingObj=this.Book.DDDstBox.ParentSect;this.Book.FormattingType=IDREGlb.FRM_SECTION_PERM}else{if(this.Book.DDDstBox.ParentPage!=null){this.Book.FormattingObj=this.Book.DDDstBox.ParentPage;this.Book.FormattingType=IDREGlb.FRM_PAGE}}this.Book.MoveDSEPositions(this.Book.DDDstBox)}};CIDREObj.prototype.SetHTMLValidate=function(a,b){this.Book.PE.BrowserClass=a;this.Book.PE.ValidType=b};CIDREObj.prototype.SetDefaultMasks=function(a,d,c,b){this.CurrencyMsk=a;this.FloatMsk=d;this.DateMsk=c;this.TimeMsk=b};CIDREObj.prototype.RD3RenderDifference=function(c,a,b){return this.Book.RD3RenderDifference(c,a,b)};CIDREObj.prototype.RD3ResendPage=function(a){return(this.Book.PE==null||this.Book.PE.LastRD3Page==null||this.Book.PE.LastRD3Page.PageNum!=a)};CIDREObj.prototype.GetLastRD3Page=function(){if(this.Book.PE!=null&&this.Book.PE.LastRD3Page!=null){return this.Book.PE.LastRD3Page.PageNum}return -1};CIDREObj.prototype.RD3ResetLastPage=function(){if(this.Book.PE!=null){this.Book.PE.LastRD3Page=null;if(this.Book.PE.LastRD3MultiPages!=null){this.Book.PE.LastRD3MultiPages=new Array(this.Book.CacheSize())}}};CIDREObj.prototype.RD3FindSpan=function(a){return this.Book.RD3FindSpan(a)};CIDREObj.prototype.RD3FindBox=function(a){return this.Book.RD3FindBox(a)};CIDREObj.prototype.FindBox=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}var c=this.FindObjByID(a);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(c)}return b};CIDREObj.prototype.FindSpan=function(c){c=this.GetOldID2NewID(c);if(c==0){return null}var a=this.FindObjByID(c);var b=null;if(this.Book.FormattingObj!=null){b=this.Book.GetFormattingObj(a)}return b};CIDREObj.prototype.MoveDSEToBox=function(c){var a=c.ParentRptBox.BoxID;if(c.ParentSect!=null){var e=c;if(e.DSEPositions==null){for(var b=0;b<c.ParentSect.BoxList.Count();b++){var d=c.ParentSect.BoxList[b];if(d.DSEPositions!=null){e=d;break}}}if(e.DSEPositions!=null){this.Book.MoveDSEPositions(e)}}return a};CIDREObj.prototype.GetReportByIndex=function(a){a=this.GetOldID2NewID(a);if(a==0){return null}return this.FindObjByID(a)};CIDREObj.prototype.GetRD3ID=function(b){b=this.GetOldID2NewID(b);if(b==0){return""}var c=this.FindObjByID(b);if(c==null){return""}var a=null;if(this.Book.FormattingObj!=null){a=this.Book.GetFormattingObj(c)}if(a==null){return""}if(a instanceof ARptBox){return a.GetRD3Ident()}else{if(a instanceof ARptSpan){return a.GetRD3Ident()}else{if(a instanceof ASection){return a.GetRD3Ident()}else{return""}}}};CIDREObj.prototype.AObjectChanged=function(d){if(this.Book.FormattingType!=IDREGlb.FRM_SECTION_PERM){return}var b;var a=null;if(d instanceof ARptBox){b=d.GetRD3Ident();a=d.GetPage()}else{if(d instanceof ARptSpan){b=d.GetRD3Ident();a=d.Parent.GetPage()}else{if(d instanceof ASection){b=d.GetRD3Ident();a=d.GetPage()}else{return}}}if(a.RD3ChangedObjects==null){a.RD3ChangedObjects=new HashTableSrv()}else{if(a.RD3ChangedObjects[b]!=null){return}}var c=null;if(d instanceof ARptBox){c=new ARptBox();c.CopyFrom(d,false,false)}else{if(d instanceof ARptSpan){c=new ARptSpan();c.CopyFrom(d)}else{if(d instanceof ASection){c=new ASection();c.CopyFrom(d)}}}a.RD3ChangedObjects[b]=c;if(this.ParentS!=null){this.ParentS.RD3PageCache.remove(a.PageNum);this.ParentS.RD3Changed=true}};function CMastro(){this.MastroID=0;this.Parent=null;this.PageType=IDREGlb.MASTRO_PT_CUSTOM;this.Width=0;this.Height=0;this.UM=IDREGlb.BOOKUM_MM;this.Orientation=IDREGlb.MASTRO_OR_PORTRAIT;this.FitMode=IDREGlb.MASTRO_FM_NONE;this.BoxList=new ArrayList()}CMastro.prototype.GetID=function(){return this.MastroID};CMastro.prototype.GetBook=function(){return this.Parent};CMastro.prototype.UBox=function(){return new IDVariant(this.BoxList.Count())};CMastro.prototype.bBox=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.BoxList.Count()?null:this.BoxList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.FindObjByID(this.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CMastro.prototype.SetRect=function(a,b){switch(a){case IDREGlb.RECT_WIDTH:this.Width=this.Parent.ConvertToInternalValue(b);break;case IDREGlb.RECT_HEIGHT:this.Height=this.Parent.ConvertToInternalValue(b);break}};CMastro.prototype.GetRect=function(a){switch(a){case IDREGlb.RECT_WIDTH:return this.Parent.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return this.Parent.ConvertFromInternalValue(this.Height)}return 0};CMastro.prototype.IsChildOf=function(d){if(d==this){return true}for(var a=0;a<this.BoxList.Count();a++){var e=this.BoxList[a];if(e==d){return true}for(var f=0;f<e.SpanList.Count();f++){var c=e.SpanList[f];if(c==d){return true}}}return false};function CPEBase(){this.ZoomLevel=100;this.Device=IDREGlb.DEV_NONE;this.BlobInFile=false;this.Parent=null;this.PrintingPage=null;this.RefreshSpanDiv=false;this.SpanDivMap=new HashTableSrv();this.CanScroll=false;this.AbsPosition=true;this.LastRD3Page=null;this.CacheSize=1;this.LastRD3MultiPages=null}CPEBase.prototype.StartDocument=function(){return true};CPEBase.prototype.EndDocument=function(){return true};CPEBase.prototype.PrintPage=function(a){this.PrintingPage=a};CPEBase.prototype.DeleteAllSpanDiv=function(){this.SpanDivMap.clear();if(this.PrintingPage!=null){for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){this.PrintingPage.MastroBoxes[a].DeleteAllSpanDiv()}for(var d=0;d<this.PrintingPage.Sections.Count();d++){var c=this.PrintingPage.Sections[d];for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].DeleteAllSpanDiv()}}}};CPEBase.prototype.CreateAllSpanDiv=function(){this.DeleteAllSpanDiv();for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){this.PrintingPage.MastroBoxes[a].CreateAllSpanDiv(this,this.SpanDivMap)}for(var d=0;d<this.PrintingPage.Sections.Count();d++){var c=this.PrintingPage.Sections[d];if(!c.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}for(var a=0;a<c.BoxList.Count();a++){c.BoxList[a].CreateAllSpanDiv(this,this.SpanDivMap)}}};CPEBase.prototype.RenderPage=function(){if(this.PrintingPage!=null){for(var c=0;c<this.PrintingPage.MastroBoxes.Count();c++){var a=this.PrintingPage.MastroBoxes[c];if(a.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){this.PrintBox(a);var e=null;for(var f=0;f<this.PrintingPage.Sections.Count();f++){var j=this.PrintingPage.Sections[f];if(j.MastroBox!=a){continue}if(!j.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}var h=j.GetAsARptBox();if(this.AbsPosition){h.XPos+=j.MastroBox.XPos;h.YPos+=j.MastroBox.YPos}var d=true;if(j.GetFlag(IDREGlb.FL_SECT_OVERLAY)){if(e==null){e=h}else{d=false}}else{if(e!=null){this.PrintBoxEnd(e);e=null}}if(d){this.PrintBox(h)}for(var k=0;k<j.BoxList.Count();k++){var g=j.BoxList[k];if(!g.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}if(this.AbsPosition){g.XPos+=j.MastroBox.XPos+j.XPos;g.YPos+=j.MastroBox.YPos+j.YPos;if(g.Rotation==0&&(g.XPos<0||g.XPos>j.MastroBox.XPos+j.XPos+j.MastroBox.Width||g.YPos<0||g.YPos>j.MastroBox.YPos+j.YPos+j.MastroBox.Height)){continue}}else{if(g.Rotation==0&&(g.XPos<0||g.XPos>j.MastroBox.Width||g.YPos<0||g.YPos>j.MastroBox.Height)){continue}}this.PrintBox(g);this.PrintBoxEnd(g);if(this.AbsPosition){g.XPos-=(j.MastroBox.XPos+j.XPos);g.YPos-=(j.MastroBox.YPos+j.YPos)}}if(d&&e==null){this.PrintBoxEnd(h)}h=null}if(e!=null){this.PrintBoxEnd(e);e=null}this.PrintBoxEnd(a)}}}else{this.RenderEmptyPage()}return true};CPEBase.prototype.Reset=function(){this.PrintingPage=null};CPEBase.prototype.RenderEmptyPage=function(){};CPEBase.prototype.PrintBox=function(d){if(d.SubSections!=null){for(var e=0;e<d.SubSections.Count();e++){var f=d.SubSections[e];if(f.MastroBox!=d){continue}if(!f.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}var c=f.GetAsARptBox();if(this.AbsPosition){c.XPos+=f.MastroBox.XPos;c.YPos+=f.MastroBox.YPos}this.PrintBox(c);for(var a=0;a<f.BoxList.Count();a++){var g=f.BoxList[a];if(!g.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){continue}if(this.AbsPosition){g.XPos+=f.MastroBox.XPos+f.XPos;g.YPos+=f.MastroBox.YPos+f.YPos;if(g.Rotation==0&&(g.XPos<0||g.XPos>f.MastroBox.XPos+f.XPos+f.MastroBox.Width||g.YPos<0||g.YPos>f.MastroBox.YPos+f.YPos+f.MastroBox.Height)){continue}}else{if(g.Rotation==0&&(g.XPos<0||g.XPos>f.MastroBox.Width||g.YPos<0||g.YPos>f.MastroBox.Height)){continue}}this.PrintBox(g);this.PrintBoxEnd(g);if(this.AbsPosition){g.XPos-=(f.MastroBox.XPos+f.XPos);g.YPos-=(f.MastroBox.YPos+f.YPos)}}this.PrintBoxEnd(c);c=null}}};CPEBase.prototype.PrintBoxEnd=function(a){};CPEBase.prototype.SetZoomLevel=function(a){this.ZoomLevel=a};CPEBase.prototype.ProcessRequest=function(a,b){return true};CPEBase.prototype.GetPageSize=function(){var a=new Object();a.Width=0;a.Height=0;return a};CPEBase.prototype.GetBorderSize=function(){return 1/96*72*4};CPEBase.prototype.PrepareDivList=function(N){if(!N.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){return null}if(N.Spans.Count()==0){return null}var B=new ArrayList();var g=N.GetRect();var q=new IDVariant(0);var z=new IDVariant(0);var w=new IDVariant(0);var E=new IDVariant(0);if(N.ImageIdx==0){N.GetPaddings(q,z,w,E)}g.Deflate(z.intValue(),q.intValue(),E.intValue(),w.intValue());var b=this.Parent.VisualStyleList.Alignment(N.VisAttrIdx,1);var M=0;var d=0;for(var p=0;p<N.Spans.Count();p++){var r=N.Spans[p];if(r==null){continue}if(r.Image!=null&&!r.Image.IsEmpty()){continue}if(!r.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}var S=r.ValueList;if(S==null){S=r.ParentRptSpan.ValueList}if(S!=null&&S.Count()>0&&b==IDREGlb.VISALN_AUTO){b=IDREGlb.VISALN_SX}if(r.ValueSourceIdx!=-1&&(this.Parent.VisualStyleList.Flags(r.VisAttrIdx)&IDREGlb.FL_VIS_SHOWIMAGE)!=0){var j=100;if(this.Parent.UM==IDREGlb.BOOKUM_INCH){j=254}var C=S[r.ValueSourceIdx];if(C!=null&&C.ImagePath.length>0){if(this.Parent.Parent.IsServlet&&C.Image.ServletImage()==null){var A;if(this.Parent.Parent.ParentS!=null){A=this.Parent.Parent.ParentS.Parent.MainFrm.RealPath}C.Image.LoadServletImage(A+"/"+CBook.AdaptWebFileName(C.ImagePath))}}M+=this.FromPointsToPhysical(C.Image.width()/96*72)+j}if(this.Device==IDREGlb.DEV_PDF&&r.Text.length>0&&r.ParentRptSpan.FldIdx!=-1&&r.ParentRptSpan.DataType==IDREGlb.DT_DOC_OLE&&r.MimeType.length>0){var A;if(this.Parent.Parent.ParentS!=null){A=this.Parent.Parent.ParentS.Parent.MainFrm.RealPath}var K=r.MimeType;if(K.indexOf("/")!=-1){K=K.substr(0,K.indexOf("/"))}if(K=="image"&&r.Image.IsEmpty()){r.Image.LoadServletImage(A+"/"+r.Text);continue}else{if(K=="text"){try{var l=this.Parent.Parent.ParentS.Parent.MainFrm;r.Text="";var a=l.VBFile.FreeFile();l.VBFile.OpenForInput(new IDVariant(A+"/"+r.Text),a);while(!l.VBFile.EOF(a)){r.Text+=l.VBFile.ReadLine(a).stringValue()}l.VBFile.Close(a);r.MimeType=""}catch(Q){}}else{if(K!=""){WriteToConsoleError("[CPEBase::PrepareDivList] Span mime type not supported. Skip formatting... (Mimetype = "+r.MimeType+")");continue}}}}var J=this.Parent.VisualStyleList.Font(r.VisAttrIdx,IDREGlb.VISFNT_VALUE,r.FontMod,(this.Parent.MultiplePE==this?2:1));var O=this.FromPointsToPhysical(J.Height);var m=this.FromPointsToPhysical(J.Ascent);var G=this.FromPointsToPhysical(J.LineGap);var R=B.length;var t=r.Text;t=t.Replace("\r\n","\n");t=t.Replace("\r","\n");while(t.length>0){var u=t.indexOf("\n");var k=t;if(u!=-1){if(u==0){k="";t=t.substr(1)}else{k=t.substr(0,u+1);t=t.substr(u+1)}}else{t=""}if(k==""&&u!=-1&&B.Count()>0){var L=new CSpanDiv();L.Span=r;L.Point=new Object();L.Point.X=0;L.Point.Y=0;L.Riga=d;L.Text="";var c=B[B.Count()-1];L.TextHeight=c.TextHeight;L.TextAscent=c.TextAscent;L.TextLineGap=c.TextLineGap;B.Add(L);d++;M=0;continue}while(k.length>0){var L=new CSpanDiv();L.Span=r;J.GetCharacterPlacement(k,k.length,L.CharPos,null,this);var I;while(true){var y=0;for(I=0;I<k.length;I++){if(k.charAt(I)!="\r"&&k.charAt(I)!="\n"){y+=(L.CharPos[I])}if(y>g.width-M){break}}if(I<k.length){var P;for(P=I-1;P>=0;P--){if(this.IsWordBreak(k.charAt(P))){break}}if(P<0){if(M==0){P=I-1}else{d++;M=0;continue}}I=P+1}break}if(I==0){I=1}L.Point=new Object();L.Point.X=M;L.Point.Y=0;L.Riga=d;L.Text=k.substr(0,I);L.TextHeight=O;L.TextAscent=m;L.TextLineGap=G;if(k.length>0){k=k.substr(I)}k=k.trimLeft();L.TextWidth=0;for(var P=0;P<I;P++){if(L.Text.charAt(P)!="\r"&&L.Text.charAt(P)!="\n"){L.TextWidth=(L.TextWidth+L.CharPos[P])}}M+=L.TextWidth;B.Add(L)}if(u!=-1&&M!=0){M=0;d++}}if(B.length==R&&r.ValueSourceIdx!=-1){var L=new CSpanDiv();L.Span=r;L.Point=new Object();L.Point.X=0;L.Point.Y=0;L.Riga=d;L.Text="";if(B.length>0){var c=B[B.length-1];L.TextHeight=c.TextHeight;L.TextAscent=c.TextAscent;L.TextLineGap=c.TextLineGap}else{if(r.Parent!=null&&r.Parent.ParentRptBox!=null){L.TextHeight=r.Parent.ParentRptBox.FontHeight;L.TextAscent=r.Parent.ParentRptBox.FontHeight;L.TextLineGap=0}else{L.TextHeight=N.Height;L.TextAscent=N.Height;L.TextLineGap=0}}B.Add(L)}}if(b==IDREGlb.VISALN_AUTO){b=IDREGlb.VISALN_SX;if(N.Spans.Count()==1&&N.Spans[0]!=null&&IDREGlb.ClassDT(N.Spans[0].ParentRptSpan.DataType)==IDREGlb.DTC_NUMBER){b=IDREGlb.VISALN_DX;var v=N.Spans[0];if((v.ValueList!=null&&v.ValueList.Count()>0)||v.ParentRptSpan.ValueList.Count()>0){b=IDREGlb.VISALN_SX}}}if(N.Alignment!=IDREGlb.VISALN_AUTO){b=N.Alignment}var f=Math.floor(N.Interline*25.4*100/72);if(this.Parent.UM==IDREGlb.BOOKUM_INCH){f=Math.floor(f*2.54)}d=0;var o=new IDVariant(0);for(var D=0;D<B.Count();D++){var s=B[D];if(s.Riga!=d){this.ProcessLine(B,g.width,d,o,b,f);d=s.Riga}}this.ProcessLine(B,g.width,d,o,b,f);for(var D=0;D<B.Count();D++){var s=B[D];if(s.Riga==1&&s.Point.Y+s.TextHeight-s.TextAscent>N.Height&&N.VRsz!=IDREGlb.RSZ_STRETCH){var H=-999;for(D=0;D<B.Count();D++){s=B[D];s.Riga=0;if(H==-999){H=s.Point.X}else{s.Point.X=H}s.JustSpace=0;if(s.DelSpaces!=0){for(var P=0;P<s.DelSpaces;P++){s.Text+=" "}s.TextWidth+=s.DelSpacesWidth}H+=s.TextWidth}o.set(new IDVariant(0));d=0;this.ProcessLine(B,g.width,d,o,b,f);break}}if(b==IDREGlb.VISALN_JX){for(var D=0;D<B.Count();D++){var s=B[D];if(s.Riga==d){if(s.Span.IsLastLineOfParagraph()){for(var h=0;h<B.Count();h++){var F=B[h];if(F.Riga==d&&F.Point.X>s.Point.X){F.Point.X-=s.JustSpace}}s.JustSpace=0}}}}return B};CPEBase.prototype.ProcessLine=function(g,k,b,j,m,c){var e=0;var o=0;var t=0;var a=null;for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){e=Math.max(e,s.TextHeight);o=Math.max(o,s.TextAscent);t+=s.TextWidth;a=s}}if(a!=null&&a.Text.length>0&&a.Text.charAt(a.Text.length-1)==" "){var d=a.Text.length;a.Text=a.Text.trimRight();var p=a.TextWidth;a.TextWidth=0;for(var r=0;r<a.Text.length;r++){if(a.Text.charAt(r)!="\r"&&a.Text.charAt(r)!="\n"){a.TextWidth=a.TextWidth+a.CharPos[r]}}t-=p-a.TextWidth;a.DelSpaces=d-a.Text.length;a.DelSpacesWidth=p-a.TextWidth}if(m==IDREGlb.VISALN_JX&&a!=null&&a.Text.length>0&&a.Text.charAt(a.Text.Length-1)=="\n"){m=IDREGlb.VISALN_SX}if(m==IDREGlb.VISALN_JX&&t>0){for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){s.JustSpace=k*s.TextWidth/t;for(var r=s.Text.length-1;r>=0;r--){if(s.Text.charAt(r)!="\r"&&s.Text.charAt(r)!="\n"){s.JustSpace-=s.CharPos[r]}}for(var f=0;f<g.Count();f++){var q=g[f];if(q.Riga==b&&q.Point.X>s.Point.X){q.Point.X+=s.JustSpace}}}}}if(c>0){j.set(new IDVariant(j.intValue()+c))}else{j.set(new IDVariant(j.intValue()+(b==0?o:e)))}var l=this.GetOffsetAlign(k,m,t);if(l<0){l=0}for(var h=0;h<g.Count();h++){var s=g[h];if(s.Riga==b){s.Point.Y=j.intValue();s.Point.X+=l}}};CPEBase.prototype.GetOffsetAlign=function(c,a,b){switch(a){case IDREGlb.VISALN_SX:return 0;case IDREGlb.VISALN_CX:return(c-b)/2;case IDREGlb.VISALN_DX:return c-b}return 0};CPEBase.prototype.IsWordBreak=function(a){if(a==" "){return true}if(a=="-"){if(this.Parent.MainFrm instanceof WebEntryPointSrv&&this.Parent.MainFrm.BrowserClass==Glb.BRWCLS_FIREFOX){return false}return true}return false};CPEBase.prototype.FromPhysicalToPoints=function(a){var b=(this.Parent.UM==IDREGlb.BOOKUM_MM?a/100/25.4:a/1000);return b*72};CPEBase.prototype.FromPointsToPhysical=function(a){var b=a/72;if(this.Parent.UM==IDREGlb.BOOKUM_MM){return Math.floor(b*25.4*100)}else{return Math.floor(b*1000)}};CPEBase.prototype.RemoveEOLandLF=function(a){a.Replace("\r","\n");var b=a.indexOf("\n");while(b!=-1){a=a.remove(b,1);b=a.indexOf("\n")}return a};CPEBase.prototype.HandleStretch=function(z,t,f,a,g,m,p,d,o,e,q,r){if(z==IDREGlb.STRTC_FILL){return}if(z==IDREGlb.STRTC_NONE&&this instanceof CPEHTML){q.set(new IDVariant(-1));r.set(new IDVariant(-1));return}var l=false;if(f==null&&a.length>0){try{if(a.startsWith("$SHELL")){a=a.substring(6)}if(a[0]=="/"){a=a.substring(1)}var b=new XMLHttpRequest();b.open("GET",RD4_WebEntryPoint.GetAppUrl(false)+a,false);b.responseType="arraybuffer";b.send();var u=new Uint8Array(b.response);f=PdfDocument.AddImage(u,u.length)}catch(y){WriteToConsoleError("[CPEBase::HandleStretch] Error while loading image: "+y.message);return}l=true}if(f==null){return}var j=f.Width;var v=f.Height;var s=v/j;if(z==IDREGlb.STRTC_NONE&&this instanceof CPEPDF){q.set(new IDVariant(o.dblValue()+(j/96*72)));r.set(new IDVariant(e.dblValue()+(v/96*72)*-1));return}var x=(p-g)*s;var k=(d-m)/s*(this instanceof CPEPDF?-1:1);if(x>(d-m)*(this instanceof CPEPDF?-1:1)){if(z==IDREGlb.STRTC_ENLARGE){q.set(new IDVariant(o.dblValue()+k));var c=((p-g)-(q.dblValue()-o.dblValue()))/2;o.set(new IDVariant(o.dblValue()+c));q.set(new IDVariant(q.dblValue()+c))}else{if(z==IDREGlb.STRTC_CROP){r.set(new IDVariant(e.dblValue()+x));var c=((d-m)-(r.dblValue()-e.dblValue()))/2;e.set(new IDVariant(e.dblValue()+c));r.set(new IDVariant(r.dblValue()+c))}}}else{if(z==IDREGlb.STRTC_ENLARGE){r.set(new IDVariant(e.dblValue()+x));var c=((d-m)-(r.dblValue()-e.dblValue()))/2;e.set(new IDVariant(e.dblValue()+c));r.set(new IDVariant(r.dblValue()+c))}else{if(z==IDREGlb.STRTC_CROP){q.set(new IDVariant(o.dblValue()+k));var c=((p-g)-(q.dblValue()-o.dblValue()))/2;o.set(new IDVariant(o.dblValue()+c));q.set(new IDVariant(q.dblValue()+c))}}}if(l){f=null}};CPEBase.prototype.RD3RenderDifference=function(b,g,o){var l=false;if(this.CacheSize!=1){if(this.PrintingPage!=null){var p=new IDVariant(0);var k=new IDVariant(0);this.Parent.GetPageIntervals(this.PrintingPage.PageNum,p,k);var a=p.intValue()-1;var m=k.intValue()-1;if(m>=this.Parent.PagesList.Count()){m=this.Parent.PagesList.Count()-1}var f=this.LastRD3MultiPages;this.LastRD3MultiPages=new Array(f.length);for(var e=a;e<=m;e++){var h=this.Parent.PagesList[e];if(h!=null){this.LastRD3MultiPages[e-a]=h;if(this.Parent.Parent.ParentS.RD3PageCache.containsKey(h.PageNum)){continue}var q=null;if(!o){for(var d=0;d<f.length&&q==null;d++){if(f[d]!=null&&f[d].PageNum==h.PageNum){q=f[d]}}}if(q==null){if(h.RD3RenderDifference(b,true,null)){l=true}}else{l|=h.RD3RenderDifference(g,false,q)}this.Parent.Parent.ParentS.RD3PageCache[h.PageNum]=true}}}else{this.LastRD3MultiPages=new Array(this.CacheSize)}}else{if(this.PrintingPage!=null){var c=(o?b:g);l=this.PrintingPage.RD3RenderDifference(c,o,this.LastRD3Page)}}this.LastRD3Page=this.PrintingPage;return l};CPEBase.prototype.RD3FindSpan=function(a){return this.PrintingPage.RD3FindSpan(a)};CPEBase.prototype.RD3FindBox=function(a){return this.PrintingPage.RD3FindBox(a)};function CPEGDI(a){CPEBase.call(this);this.dc=null;this.BorderWidth=15;this.BorderHeight=15;if(a!=undefined){this.PrintingPage=null;this.Device=IDREGlb.DEV_NONE}}CPEGDI.prototype=new CPEBase();for(var i=0;i<Object.keys(CPEBase).length;i++){var obj=Object.keys(CPEBase)[i];CPEGDI[obj]=CPEBase[obj]}CPEGDI.prototype.OnPaint=function(a){this.RenderPage()};CPEGDI.prototype.StartDocument=function(){return true};CPEGDI.prototype.EndDocument=function(){var a=true;return a};CPEGDI.prototype.PrintPage=function(a){};CPEGDI.prototype.RenderPage=function(){if(this.PrintingPage!=null&&this.RefreshSpanDiv){this.CreateAllSpanDiv();this.RefreshSpanDiv=false}if(!CPEBase.prototype.RenderPage.call(this)){return false}return true};CPEGDI.prototype.Reset=function(){CPEBase.prototype.Reset.call(this);this.DeleteAllSpanDiv()};CPEGDI.prototype.PrintBox=function(a){};CPEGDI.prototype.DrawBorder=function(a,b){};CPEGDI.prototype.SetZoomLevel=function(a){};CPEGDI.prototype.GetPageSize=function(){var a=new Object();a.Width=0;a.Height=0;return a};CPEGDI.prototype.FromPhysicalToPoints=function(b){var a=CPEBase.prototype.FromPhysicalToPoints.call(this,b);return a/72*96};CPEGDI.prototype.FromPointsToPhysical=function(a){var b=a/96*72;return CPEBase.prototype.FromPointsToPhysical.call(this,b)};CPEGDI.prototype.RenderImage=function(b,a){};function CPEHTML(){CPEBase.call(this);this.Width=0;this.Height=0;this.DivFactor=100;this.UMstr="mm";this.HTMLBuffer="";this.MainFrm;this.RespWriter=null;this.BrowserClass=IDREGlb.BRWCLS_IENORMAL;this.ValidType=IDREGlb.WEBVALID_NONE;this.nf=null;this.BlobInFile=true;this.CanScroll=true;this.AbsPosition=false}CPEHTML.prototype=new CPEBase();for(var i=0;i<Object.keys(CPEBase).length;i++){var obj=Object.keys(CPEBase)[i];CPEHTML[obj]=CPEBase[obj]}CPEHTML.prototype.PrintPage=function(a){if(this.Parent.PrintDestination==IDREGlb.PRN_SCREEN){this.Parent.Parent.Fire_OnPreview()}this.Parent.Parent.set_RD(true);CPEBase.prototype.PrintPage.call(this,a)};CPEHTML.prototype.RenderPage=function(){return true};CPEHTML.prototype.PrintBox=function(a){CPEBase.prototype.PrintBox.call(this,a)};CPEHTML.prototype.PrintBoxEnd=function(a){};CPEHTML.prototype.ProcessRequest=function(c,d){if(this.PrintingPage!=null){for(var a=0;a<this.PrintingPage.MastroBoxes.Count();a++){var f=this.PrintingPage.MastroBoxes[a];if(f.ProcessRequest(c,this.Parent,d)){return true}}for(var g=0;this.PrintingPage.Sections.Count();g++){var e=this.PrintingPage.Sections[g];for(var a=0;a<e.BoxList.Count();a++){var f=e.BoxList[a];if(f.ProcessRequest(c,this.Parent,d)){return true}}}}return false};CPEHTML.prototype.GetPageSize=function(){var a=new Object();a.Width=this.Width;a.Height=this.Height;return a};CPEHTML.prototype.HTMLEncode=function(b,a){if(a==undefined){a=false}return Glb.HTMLEncode(b,a)};CPEHTML.prototype.RenderCombo=function(b,a,c){};CPEHTML.prototype.RenderOption=function(b,a,c){};CPEHTML.prototype.RenderCheck=function(b,a,c){};CPEHTML.prototype.WriteHTML=function(a){this.HTMLBuffer+=a};function CPEPDF(){CPEBase.call(this);this.MyPDF=new PdfDocument();this.PDFFileName="";this.PageSizeX;this.PageSizeY;this.IsFirstPage=true;this.BlobInFile=true;this.MyPDF.SetPreference(PdfDocument.VP_FITWINDOW)}CPEPDF.prototype=new CPEBase();for(var i=0;i<Object.keys(CPEBase).length;i++){var obj=Object.keys(CPEBase)[i];CPEPDF[obj]=CPEBase[obj]}CPEPDF.prototype.StartDocument=function(){if(this.Parent.IsPrecounting){return true}this.MyPDF.SetDocumentInfo(PdfDocument.DI_TITLE,this.Parent.Name);this.MyPDF.SetDocumentInfo(PdfDocument.DI_PRODUCER,"IDRE Pro-Gamma");this.Parent.VisualStyleList.ResetFonts(this.Parent.MultiplePE==this?2:1);this.IsFirstPage=true;if(this.Parent.MultiplePE!=null){this.Parent.MultiplePE.IsFirstPage=true}return true};CPEPDF.prototype.PrintPage=function(a){CPEBase.prototype.PrintPage.call(this,a);this.CreateAllSpanDiv();if(a.Orientation==IDREGlb.MASTRO_OR_PORTRAIT){this.PageSizeX=this.FromPhysicalToPoints(a.Width);this.PageSizeY=this.FromPhysicalToPoints(a.Height)}else{this.PageSizeX=this.FromPhysicalToPoints(a.Height);this.PageSizeY=this.FromPhysicalToPoints(a.Width)}this.MyPDF.AddPage(this.PageSizeX,this.PageSizeY);if(this.Parent.MultiplePE==this&&this.Parent.Bookmark!=null&&this.Parent.Bookmark.length>0&&this.IsFirstPage){this.MyPDF.AddOutline(this.Parent.Bookmark)}this.RenderPage();this.DeleteAllSpanDiv();this.IsFirstPage=false};CPEPDF.prototype.EndDocument=function(){if(this.Parent.IsPrecounting){return true}if(this.PDFFileName.length==0){this.PDFFileName=this.Parent.Name+".pdf";this.Parent.WebFileName=this.PDFFileName;this.Parent.OutputFileName=this.Parent.GetBaseDir()+"\\"+this.PDFFileName}else{this.Parent.OutputFileName=this.PDFFileName;this.Parent.WebFileName=this.PDFFileName;var c=this.Parent.WebFileName.toUpperCase();var h=this.Parent.GetBaseDir().toUpperCase()+"\\";c=c.replace(/\\/g,"/");h=h.replace(/\\/g,"/");if(c.startsWith(h)){this.Parent.WebFileName=this.Parent.WebFileName.substr(h.length)}}var f={data:""};if(this.MyPDF.Save(this.Parent.OutputFileName,f)==0){if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){var a=RD4_WebEntryPoint.ShellObject.SendCmd("SAVEFILE",{CONTENT:btoa(f.data),FILENAME:this.Parent.OutputFileName});if(a!="OK"){throw new Error(a)}}else{var b=new Uint8Array(f.data.length);for(var g=0;g<f.data.length;g++){b[g]=f.data.charCodeAt(g)}var e=new BlobBuilder();e.append(b.buffer);var d=e.getBlob("application/pdf");this.Parent.WebFileName=URL.createObjectURL(d)}return true}return false};CPEPDF.prototype.PrintBox=function(aa){var J=this.FromPhysicalToPoints(aa.XPos);var X=this.FromPhysicalToPoints(aa.YPos);var ae=this.FromPhysicalToPoints(aa.XPos+aa.Width);var M=this.FromPhysicalToPoints(aa.YPos+aa.Height);if(aa.ParentSect!=null&&aa.ParentRptBox!=null){var F=new CRect(0,0,0,0);F.setLeft(aa.ParentSect.MastroBox.XPos+aa.ParentSect.XPos);F.setRight(F.left()+aa.ParentSect.MastroBox.Width);F.setTop(aa.ParentSect.MastroBox.YPos+aa.ParentSect.YPos);F.setBottom(F.top()+aa.ParentSect.Height);if(aa.ParentSect.NumCol>1){F.setRight(F.left()+(aa.ParentSect.MastroBox.Width-(aa.ParentSect.NumCol-1)*aa.ParentSect.ColSpace)/aa.ParentSect.NumCol)}if(aa.Rotation==0){var Y=aa.GetRect();if(F.top()>Y.top()){X=this.FromPhysicalToPoints(F.top())}if(F.bottom()<Y.bottom()){M=this.FromPhysicalToPoints(F.bottom())}if(F.left()>Y.left()){J=this.FromPhysicalToPoints(F.left())}if(F.right()<Y.right()){ae=this.FromPhysicalToPoints(F.right())}}if(J>=ae||X>=M){return}}X=this.PageSizeY-X;M=this.PageSizeY-M;var p=new IDVariant(0);var B=new IDVariant(0);var x=new IDVariant(0);var L=new IDVariant(0);aa.GetPaddings(p,B,x,L,this);if(aa.ImageIdx!=0||aa.GraphFile!=null){var ad=this.Parent.VisualStyleList.BorderType(aa.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(ad!=IDREGlb.VISBRD_CUSTOM){this.Parent.VisualStyleList.GetBorderWidths(aa.VisAttrIdx,p,B,x,L,this.Parent.UM,this)}}var z=this.Parent.VisualStyleList.Color(aa.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var o=this.Parent.VisualStyleList.GradCol(aa.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var O=this.Parent.VisualStyleList.GradDir(aa.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);var s=this.Parent.VisualStyleList.Opacity(aa.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(aa.ParentSect!=null&&aa.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&aa.ParentSect.DSEPosition%2==0){var T=this.Parent.VisualStyleList.Color(aa.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var y=this.Parent.VisualStyleList.GradCol(aa.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var E=this.Parent.VisualStyleList.GradDir(aa.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);var m=this.Parent.VisualStyleList.Opacity(aa.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE);if(T!=IDREGlb.CLR_NONE){z=T;if(y!=IDREGlb.CLR_NONE){o=y;O=E}else{if(m<100){s=m}}}}if(aa.GetBackColor()!=-1){z=aa.GetBackColor();O=-2;s=100}if(aa.Rotation!=0){this.MyPDF.SetRotation(aa.Rotation,J+(ae-J)/2,M+(X-M)/2)}if(z!=IDREGlb.CLR_NONE){if(o!=IDREGlb.CLR_NONE){if(O==IDREGlb.VISGRADDIR_HORIZ){this.MyPDF.SetFillGradient(J,(X+M)/2,ae,(X+M)/2,z,o)}else{this.MyPDF.SetFillGradient((J+ae)/2,X,(J+ae)/2,M,z,o)}}else{this.MyPDF.SetFillColor(z&255,(z&65280)>>8,(z&16711680)>>16)}this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(J,M,ae-J,X-M,true,s);if(o!=IDREGlb.CLR_NONE){this.MyPDF.CloseFillGradient()}}this.DrawBorder(aa.VisAttrIdx,J,X,ae,M);if(aa.ImageIdx!=0||aa.GraphFile!=null){if(aa.ImageIdx==0||(this.Parent.ImagesPath.Count()>=Math.abs(aa.ImageIdx)&&this.Parent.ImagesPath[Math.abs(aa.ImageIdx)-1]!=null)){var ac;if(aa.ImageIdx!=0){ac=this.Parent.GetBaseDir()+"/"+CBook.AdaptWebFileName(this.Parent.ImagesPath[Math.abs(aa.ImageIdx)-1])}else{ac=aa.GraphFile}if(ac.length>0){var j=new IDVariant(J,IDVariant.FLOAT);var P=new IDVariant(ae,IDVariant.FLOAT);var c=new IDVariant(X,IDVariant.FLOAT);var t=new IDVariant(M,IDVariant.FLOAT);var C=new CFloatRect(j.dblValue(),t.dblValue(),P.dblValue(),c.dblValue());this.HandleStretch(aa.GetStretch(this),aa,null,ac,J,X,ae,M,j,c,P,t);this.MyPDF.AddImage(ac,j.dblValue(),c.dblValue(),P.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),-9999,C)}}else{}}for(var l=0;l<aa.Spans.Count();l++){var v=aa.Spans[l];if(v==null||!v.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}if(v.Image.ServletImage()!=null){var ad=this.Parent.VisualStyleList.BorderType(aa.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(ad!=IDREGlb.VISBRD_CUSTOM){this.Parent.VisualStyleList.GetBorderWidths(aa.VisAttrIdx,p,B,x,L,this.Parent.UM,this)}var j=new IDVariant(J+this.FromPhysicalToPoints(B.intValue()),IDVariant.FLOAT);var P=new IDVariant(ae-this.FromPhysicalToPoints(L.intValue()),IDVariant.FLOAT);var c=new IDVariant(X-this.FromPhysicalToPoints(p.intValue()),IDVariant.FLOAT);var t=new IDVariant(M+this.FromPhysicalToPoints(x.intValue()),IDVariant.FLOAT);var C=new CFloatRect(j.dblValue(),t.dblValue(),P.dblValue(),c.dblValue());this.HandleStretch(v.GetStretch(this),aa,v.Image.ServletImage(),"",J,X,ae,M,j,c,P,t);if(v.Text.length>0&&v.Text.indexOf("data:")==-1){this.MyPDF.AddImage(this.Parent.GetBaseDir()+"/"+v.Text,j.dblValue(),c.dblValue(),P.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),-9999,C)}else{this.MyPDF.AddImage(v.Image.ServletImage(),j.dblValue(),c.dblValue(),P.dblValue()-j.dblValue(),t.dblValue()-c.dblValue(),C)}}var N=this.Parent.VisualStyleList.ControlType(v.VisAttrIdx);var ag=v.ValueList;if(ag==null){ag=v.ParentRptSpan.ValueList}if(ag!=null&&ag.Count()!=0){var f=this.Parent.VisualStyleList.Color(v.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(aa.ParentSect!=null&&aa.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&aa.ParentSect.DSEPosition%2==0){f=this.Parent.VisualStyleList.Color(v.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE)}if(v.BackColor!=-1){f=v.BackColor}if(f==z){f=IDREGlb.CLR_NONE}if(N==IDREGlb.VISCTRL_OPTION){this.RenderOption(v,f,J,X,ae,M,B.intValue(),p.intValue(),L.intValue(),x.intValue());return}else{if(N==IDREGlb.VISCTRL_CHECK){this.RenderCheck(v,f,J,X,ae,M,B.intValue(),p.intValue(),L.intValue(),x.intValue());return}else{if(N==IDREGlb.VISCTRL_COMBO||N==IDREGlb.VISCTRL_AUTO||N==IDREGlb.VISCTRL_EDIT){if(f!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(J,X,ae-J,M-X,true)}this.DrawBorder(v.VisAttrIdx,J,X,ae,M)}}}}}var G=aa.SpanDivList;if(G==null&&aa.ParentRptBox){G=this.SpanDivMap[aa.HashCode]}if(G!=null){var H=new ArrayList();for(var K=0;K<G.Count();K++){var g=G[K];if((g.Text.length==0&&g.Span.ValueSourceIdx==-1)||!g.Span.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){continue}var q=X-this.FromPhysicalToPoints(g.Point.Y);if(q<M){continue}if(g.Span.MimeType.length>0){var V=g.Span.MimeType;if(V.indexOf("/")!=-1){V=V.substr(0,V.indexOf("/"))}if(V!="image"&&V!="text"){continue}}if(g.Span.ValueSourceIdx!=-1&&(this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_SHOWIMAGE)!=0&&H.IndexOf(g.Span)==-1){var ag=g.Span.ValueList;if(ag==null){ag=g.Span.ParentRptSpan.ValueList}var I=ag[g.Span.ValueSourceIdx];if(I!=null&&I.Image.ServletImage()==null&&I.ImagePath.length>0){var A;if(this.Parent.Parent.ParentS!=null){A=this.Parent.Parent.ParentS.Parent.MainFrm.RealPath}I.Image.LoadServletImage(A+"/"+CBook.AdaptWebFileName(I.ImagePath))}if(I.Image.ServletImage()!=null){var ab=this.FromPointsToPhysical(I.Image.height()*72/96);var S=this.FromPointsToPhysical(I.Image.width()*72/96);var d=100;if(this.Parent.UM==IDREGlb.BOOKUM_INCH){d=254}var j=g.Point.X+aa.XPos-S-d+B.intValue();var c=g.Point.Y+aa.YPos-g.TextAscent+(g.TextHeight-ab)/2;if(j<aa.XPos){j=aa.XPos}var P=j+S;var t=c+ab;j=this.FromPhysicalToPoints(Math.floor(j));P=this.FromPhysicalToPoints(Math.floor(P));c=this.PageSizeY-this.FromPhysicalToPoints(Math.floor(c));t=this.PageSizeY-this.FromPhysicalToPoints(Math.floor(t));var ac=ag[g.Span.ValueSourceIdx].ImagePath;if(ac.length>0&&ac.indexOf("data:")==-1){this.MyPDF.AddImage(this.Parent.GetBaseDir()+"/"+CBook.AdaptWebFileName(ac),j,c,P-j,t-c)}else{this.MyPDF.AddImage(I.Image.ServletImage(),j,c,P-j,t-c)}}H.Add(g.Span)}var f=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_BACKVALUE);if(aa.ParentSect!=null&&aa.ParentSect.ParentSection.SectType==IDREGlb.SECT_DETAIL&&aa.ParentSect.DSEPosition%2==0){f=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_ALTVALUE)}if(g.Span.BackColor!=-1){f=g.Span.BackColor}if(f==z){f=IDREGlb.CLR_NONE}if(f!=IDREGlb.CLR_NONE){var b=J+this.FromPhysicalToPoints(g.Point.X+B.intValue());var Q=this.FromPhysicalToPoints(g.TextWidth)+0.5;var R=X-this.FromPhysicalToPoints(g.Point.Y-g.TextAscent);var Z=-this.FromPhysicalToPoints(g.TextHeight);this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(b,R,Q,Z,true)}var e=this.Parent.VisualStyleList.Color(g.Span.VisAttrIdx,IDREGlb.VISCLR_FOREVALUE);if(g.Span.ForeColor!=-1){e=g.Span.ForeColor}this.MyPDF.SetColor(e&255,(e&65280)>>8,(e&16711680)>>16);var U=this.Parent.VisualStyleList.Font(g.Span.VisAttrIdx,IDREGlb.VISFNT_VALUE,g.Span.FontMod,(this.Parent.MultiplePE==this?2:1));if(U.ServletFont()!=null&&U.ServletFont().ID==-1){var k=(this.Parent.VisualStyleList.Flags(g.Span.VisAttrIdx)&IDREGlb.FL_VIS_EMBEDFONT)!=0;U.ServletFont().ID=this.MyPDF.AddFont(U.ServletFont(),k)}var a=J+this.FromPhysicalToPoints(g.Point.X+B.intValue());var af=X-this.FromPhysicalToPoints(g.Point.Y+(this.Parent.VisualStyleList.BorderType(aa.VisAttrIdx,IDREGlb.VISBDI_VALUE)==IDREGlb.VISBRD_CUSTOM?p.intValue():0));var D=(U.Bold&&!U.ServletFont().IsBold);var W=(U.Italic&&!U.ServletFont().IsItalic);var u=g.GetText(this.FromPointsToPhysical(ae-J)-g.Point.X);u=this.RemoveEOLandLF(u);if(u.length==0){continue}this.MyPDF.AddText(u,a,af,0.5,U.Size,-1,U.ServletFont().ID,D,W,(g.JustSpace!=0?this.FromPhysicalToPoints(g.JustSpace):-1),100,U.LetterSpacing,U.WordSpacing,(U.HorizontalScale==0?100:U.HorizontalScale));if(U.Underline){this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddLine(a,af-U.Size*0.15,a+this.FromPhysicalToPoints(g.TextWidth),af-U.Size*0.15)}if(U.StrikeOut){this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddLine(a,af+U.Size*0.25,a+this.FromPhysicalToPoints(g.TextWidth),af+U.Size*0.25)}}}CPEBase.prototype.PrintBox.call(this,aa);if(aa.Rotation!=0){this.MyPDF.UndoRotation()}};CPEPDF.prototype.DrawBorder=function(l,c,g,d,b){var k=this.Parent.VisualStyleList.BorderType(l,IDREGlb.VISBDI_VALUE);if(k==IDREGlb.VISBRD_NONE){return}if(k==IDREGlb.VISBRD_CUSTOM){for(var h=1;h<=4;h++){var f=this.Parent.VisualStyleList.CBorWidth(l,h)/4;var j=this.Parent.VisualStyleList.CBorColor(l,h);var a=this.Parent.VisualStyleList.CBorType(l,h);if(f==0||j==IDREGlb.CLR_NONE){continue}switch(a){case IDREGlb.VISCTYP_SOLID:this.MyPDF.SetLineDashPattern(0);break;case IDREGlb.VISCTYP_DOTTED:this.MyPDF.SetLineDashPattern(0,f);break;case IDREGlb.VISCTYP_DASHED:this.MyPDF.SetLineDashPattern(0,5*f);break;case IDREGlb.VISCTYP_DOUBLE:this.MyPDF.SetLineDashPattern(0);f/=3;break;default:continue}this.MyPDF.SetLineWidth(f);this.MyPDF.SetLineColor(j&255,(j&65280)>>8,(j&16711680)>>16);switch(h){case IDREGlb.VISCBOR_TOP:this.MyPDF.AddLine(c,g-f/2,d,g-f/2);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c,g-2*f-f/2,d,g-2*f-f/2)}break;case IDREGlb.VISCBOR_RIGHT:this.MyPDF.AddLine(d-f/2,g,d-f/2,b);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(d-2*f-f/2,g,d-2*f-f/2,b)}break;case IDREGlb.VISCBOR_BOTTOM:this.MyPDF.AddLine(c,b+f/2,d,b+f/2);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c,b+2*f+f/2,d,b+2*f+f/2)}break;case IDREGlb.VISCBOR_LEFT:this.MyPDF.AddLine(c+f/2,g,c+f/2,b);if(a==IDREGlb.VISCTYP_DOUBLE){this.MyPDF.AddLine(c+2*f+f/2,g,c+2*f+f/2,b)}break}}}else{var e=this.Parent.VisualStyleList.Color(l,IDREGlb.VISCLR_BORDERS);this.MyPDF.SetLineDashPattern(0);this.MyPDF.SetLineWidth(0.5);this.MyPDF.SetLineColor(e&255,(e&65280)>>8,(e&16711680)>>16);switch(k){case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:this.MyPDF.AddRectangle(c,g,d-c,b-g);break;case IDREGlb.VISBRD_HORIZ:this.MyPDF.AddLine(c,g,d,g);break;case IDREGlb.VISBRD_VERT:this.MyPDF.AddLine(c,g,c,b);this.MyPDF.AddLine(d,g,d,b);break}}};CPEPDF.prototype.RenderOption=function(r,j,h,p,q,c,v,e,m,g){var t=this.Parent.VisualStyleList.Font(r.VisAttrIdx,IDREGlb.VISFNT_VALUE,r.FontMod,(this.Parent.MultiplePE==this?2:1));if(t.ServletFont()!=null&&t.ServletFont().ID==-1){var u=(this.Parent.VisualStyleList.Flags(r.VisAttrIdx)&IDREGlb.FL_VIS_EMBEDFONT)!=0;t.ServletFont().ID=this.MyPDF.AddFont(t.ServletFont(),u)}var f=this.Parent.VisualStyleList.Color(r.VisAttrIdx,IDREGlb.VISCLR_FOREVALUE);if(r.ForeColor!=-1){f=r.ForeColor}var k=r.ValueList;if(k==null){k=r.ParentRptSpan.ValueList}var o=((p-c)/t.Height>=2);if(j!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(j&255,(j&65280)>>8,(j&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(h,p,q-h,c-p,true);this.MyPDF.SetColor(0,0,0)}var a=4;var s=p-a-2;var b=h;for(var w=0;w<k.Count();w++){var l=k[w];var d=this.FromPhysicalToPoints(t.GetStringWidth(l.Name,null,this));if(j!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(255,255,255);this.MyPDF.AddCircle(b+a+2,s,a,true);this.MyPDF.SetColor(0,0,0)}this.MyPDF.AddCircle(b+a+2,s,a);if(l.Value.equals(r.Value)){this.MyPDF.AddCircle(b+a+2,s,a-2,true)}this.MyPDF.SetColor(f&255,(f&65280)>>8,(f&16711680)>>16);this.MyPDF.AddText(l.Name,b+a*2+2+2,s-2,-1,-1,-1,t.ServletFont().ID);if(o){s-=(t.Height+t.LineGap)}else{b+=d+a*2+2+4+4}}};CPEPDF.prototype.RenderCheck=function(j,h,o,k,p,s,a,q,r,g){var b=10;var m=o+(p-o-b)/2;if(h!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(h&255,(h&65280)>>8,(h&16711680)>>16);this.MyPDF.SetLineWidth(0.5);this.MyPDF.AddRectangle(o,k,p-o,s-k,true)}this.DrawBorder(j.VisAttrIdx,o,k,p,s);var l=this.Parent.VisualStyleList.BorderType(j.VisAttrIdx,IDREGlb.VISBDI_VALUE);if(l!=IDREGlb.VISBRD_NONE){var f=new IDVariant(0);var d=new IDVariant(0);var c=new IDVariant(0);var e=new IDVariant(0);this.Parent.VisualStyleList.GetBorderWidths(j.VisAttrIdx,f,d,c,e,this.Parent.UM,this);o+=this.FromPhysicalToPoints(d.intValue())+1;k-=(this.FromPhysicalToPoints(f.intValue())+1)}if(h!=IDREGlb.CLR_NONE){this.MyPDF.SetColor(255,255,255);this.MyPDF.AddRectangle(m,k,b,-b,true);this.MyPDF.SetColor(0,0,0)}this.MyPDF.SetLineWidth(0.8);this.MyPDF.SetLineColor(176,176,176);this.MyPDF.AddLine(m-0.4,k,m+b+0.4,k);this.MyPDF.AddLine(m,k+0.4,m,k-b+0.4);this.MyPDF.SetLineColor(128,128,128);this.MyPDF.AddLine(m+0.4,k-0.8,m+b-0.4,k-0.8);this.MyPDF.AddLine(m+0.8,k-0.8,m+0.8,k-b+0.4);this.MyPDF.SetLineColor(224,224,224);this.MyPDF.AddLine(m-0.4,k-b,m+b+0.4,k-b);this.MyPDF.AddLine(m+b,k-b,m+b,k+0.4);if(j.ValueSourceIdx==0){this.MyPDF.SetLineWidth(1.2);this.MyPDF.SetLineColor(0,0,0);this.MyPDF.AddLine(m+b*3/10,k-b/2,m+b*5/10,k-b*8/10);this.MyPDF.AddLine(m+b*5/10,k-b*8/10,m+b*7/10,k-b*3/10)}};CPEPDF.prototype.GetPageSize=function(){var a=new Object();a.Width=0;a.Height=0;return a};CPEPDF.prototype.GetBorderSize=function(){return 0.5*4};function CQueryParam(){this.RepIdx=-1;this.TblIdx=-1;this.FldIdx=-1;this.AttValue=new IDVariant();this.DataType=0;this.MaxLength=0;this.Scale=0}function CRect(b,e,a,c){this.x=0;this.y=0;this.width=0;this.height=0;if(b instanceof CRect){var d=b;this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height}else{if(b!=undefined){this.x=b}if(e!=undefined){this.y=e}if(a!=undefined){this.width=Math.abs(a-b)}if(c!=undefined){this.height=Math.abs(c-e)}}}CRect.prototype.left=function(){return this.x};CRect.prototype.top=function(){return this.y};CRect.prototype.right=function(){return this.x+this.width};CRect.prototype.bottom=function(){return this.y+this.height};CRect.prototype.setLeft=function(a){this.x=a};CRect.prototype.setTop=function(a){this.y=a};CRect.prototype.setRight=function(a){this.width=a-this.x};CRect.prototype.setBottom=function(a){this.height=a-this.y};CRect.prototype.setWidth=function(a){this.width=a};CRect.prototype.setHeight=function(a){this.height=a};CRect.prototype.IsRectNull=function(){return(this.x==0&&this.y==0&&this.width==0&&this.height==0)};CRect.prototype.Deflate=function(c,d,e,a){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x+=Math.floor(c);this.y+=Math.floor(d);this.width-=Math.floor(c+e);this.height-=Math.floor(a+d)};CRect.prototype.Inflate=function(c,d,e,a){if(d==undefined){d=c}if(e==undefined){e=c}if(a==undefined){a=d}this.x-=Math.floor(c);this.y-=Math.floor(d);this.width+=Math.floor(c+e);this.height+=Math.floor(a+d)};CRect.prototype.Intersect=function(b,a){this.x=Math.max(b.left(),a.left());this.y=Math.max(b.top(),a.top());this.setRight(Math.min(b.left()+b.width,a.left()+a.width));this.setBottom(Math.min(b.top()+b.height,a.top()+a.height))};CRect.prototype.toString=function(){return"X="+this.x+", Y="+this.y+", W="+this.width+", H="+this.height};function CReport(){this.ReportID=0;this.ParentBox=null;this.Parent=null;this.Flags=0;this.DSE=null;this.SectionsList=new ArrayList();this.PermStatesList=new ArrayList();this.RoleFlag=-1;this.ReInitGroups=true;this.FormattingObj=null;this.Freezed=false;this.PrintedSomething=0}CReport.prototype.GetID=function(){return this.ReportID};CReport.prototype.GetBook=function(){return this.Parent};CReport.prototype.USection=function(){return new IDVariant(this.SectionsList.Count())};CReport.prototype.bSection=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.SectionsList.Count()?null:this.SectionsList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.FindObjByID(this.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CReport.prototype.GetNextMastro=function(c){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&this.DSE.IsOpen()){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),510,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Data source is already open. Using cached data")}if(!this.DSE.IsOpen()&&!this.OpenDSE()){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),511,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Can't open data source and HideIfEmpty flag set -> Skipping report")}return null}}else{if(this.DSE.IsOpen()&&this.DSE.RecordCount()==0){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),511,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report's query has no data and HideIfEmpty flag set -> Skipping report")}return null}}}var g=null;if(c!=null){g=c.GetState(this)}var b=null;if(g!=null){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),512,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Check if sections printed partially in previous page needs a particular page to be completed")}for(var e=0;e<this.SectionsList.Count();e++){var d=this.SectionsList[e];if(!d.IsCompleted(g,null)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),513,"CReport.GetNextMastro","Section "+this.Parent.Parent.GetObjName(d.SectionID)+": Section was not fully printed in previous page. Asking which page it needs to continue")}b=d.GetNextMastro(g,c,null);if(b!=null){return b}}}if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),514,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": No page is needed by partially printed sections. Check if sections wants to print something")}}else{if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),515,"CReport.GetNextMastro","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Check if any section wants to print something")}}var f=null;if(this.DSE.IsOpen()){f=this.DSE.Next(g!=null?g.DSEState:null,true)}for(var e=0;e<this.SectionsList.Count()&&b==null;e++){var d=this.SectionsList[e];var a=((!this.DSE.IsOpen()||this.DSE.RecordCount()==0)&&g==null&&(d.SectType==IDREGlb.SECT_REPORTHEADER||d.SectType==IDREGlb.SECT_PAGEHEADER||d.SectType==IDREGlb.SECT_REPORTFOOTER||d.SectType==IDREGlb.SECT_PAGEFOOTER));if(a||d.WantToPrint(g,f)){b=d.GetNextMastro(g,c,f)}if(b!=null){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),516,"CReport.GetNextMastro","Section "+this.Parent.Parent.GetObjName(d.SectionID)+": Section requested a page of type '"+this.Parent.Parent.GetObjName(b.MastroID)+"'")}break}}f=null;return b};CReport.prototype.FormatPage=function(e,j){var r=null;if(e!=null){r=e.GetState(this)}var p=new AReportState();p.Parent=j;p.ParentReport=this;j.ReportStates.Add(p);var f=new ADSEState();p.DSEState=f;if(r!=null){f.CopyFrom(r.DSEState);if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(r.DSEState.ActualPosition)}}else{if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(1)}}var m=true;var c=true;if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),517,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Start formatting sections on the current page")}var o=new MyBoolean(false);while(m){for(var q=0;q<this.SectionsList.Count();q++){var l=this.SectionsList[q];if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg("",0,"","-------------------- Section "+this.Parent.Parent.GetObjName(l.SectionID)+" (RecNum = "+this.DSE.GetCurrentPosition()+" out of "+this.DSE.RecordCount()+") --------------------")}if(!l.GetFlag(IDREGlb.FL_SECT_VISIBLE)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(l.SectionID),518,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(l.SectionID)+": Section is invisible. Skipping...")}continue}if(l.SectType!=IDREGlb.SECT_PAGEHEADER&&l.SectType!=IDREGlb.SECT_PAGEFOOTER&&f.HideGroupLevel!=-1&&(l.GroupLevel>f.HideGroupLevel||l.SectType==IDREGlb.SECT_DETAIL||(l.GroupLevel==f.HideGroupLevel&&l.SectType==IDREGlb.SECT_GROUPFOOTER))){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(l.SectionID),519,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(l.SectionID)+": One previous section has ShowChildren flag set to False and I'm included into that section -> Skipping section")}continue}var g=new MyBoolean(false);var k=new MyBoolean(true);var a=true;var d=0;while(k.get()&&a){k.set(false);a=l.FormatPage(e,j,c,g,o,k,null);if(a&&(k.get()||d>0)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(l.SectionID),520,"CReport.FormatPage","Section "+this.Parent.Parent.GetObjName(l.SectionID)+": Reprint requested -> Reformatting section")}if(d>0){(j.Sections[j.Sections.Count()-1]).RD3IdentName+="-"+d}d++}}if(l.SectType!=IDREGlb.SECT_PAGEHEADER&&l.SectType!=IDREGlb.SECT_PAGEFOOTER){m&=a}if(g.get()){m=true;o.set(false);break}}c=false;m&=this.DSE.IsOpen();if(m){this.DSE.Next(f);f.ActualPosition=this.DSE.GetCurrentPosition();if(this.DSE.IsEof()){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),521,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Data source has no more records. Continue with other reports")}p.PrintPHPF=false;m=false}}}if(this.Parent.DTTObj.Level>0&&this.ParentBox==null&&e!=null&&j!=null&&this.DSE.IsOpen()&&!this.DSE.IsEof()){var h=this.DSE.GetCurrentPosition();var b=e.GetState(this);if(b!=null&&h==b.DSEState.ActualPosition){this.Parent.DTTObj.AddMsg(DTTEngine.DTTMSG_WARN,this.Parent.Parent.GetRTCGuid(0),464,"CReport.FormatPage","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report DataSource position did't change from previous page -> Maybe one of my sections can't print and a potential LOOP will be hit")}}};CReport.prototype.OpenDSE=function(){if(!this.DSE.Open()){return false}for(var e=0;e<this.SectionsList.Count();e++){var d=this.SectionsList[e];for(var a=0;a<d.BoxList.Count();a++){var f=d.BoxList[a];for(var g=0;g<f.SpanList.Count();g++){var c=f.SpanList[g];if(c.Text.length>2&&c.Text.substr(0,2)=="::"){c.FldIdx=this.DSE.GetFldIdx(c.Text.substr(2))}}}}return true};CReport.prototype.GetPermanentState=function(f,e,b){if(f instanceof ASectionState){var a=f;var b=e;if(b==undefined){b=true}return this.GetPermanentState(a.ParentSection.SectionID,this.DSE.GetCurrentPosition(),b)}else{if(b==undefined){b=true}var g=null;for(var d=0;d<this.PermStatesList.Count();d++){var c=this.PermStatesList[d];if(c.DSECurrentPosition==e&&c.SectionID==f){g=c;break}}if(b&&g!=null&&g.GH_DSECurrentPosition!=-1&&g.GH_DSECurrentPosition!=e){g=this.GetPermanentState(f,g.GH_DSECurrentPosition)}return g}};CReport.prototype.FormatSubReport=function(d){if(this.DSE.IsOpen()){this.DSE.Close()}this.DSE.UpdateIMDB(true);if(!this.OpenDSE()){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),651,"CReport.FormatSubReport","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Can't open data source and HideIfEmpty flag set -> Skipping report")}return}}else{if(this.DSE.IsOpen()&&this.DSE.RecordCount()==0){if(this.GetFlag(IDREGlb.FL_REPORT_HIDEIFEMPTY)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(this.ReportID),651,"CReport.FormatSubReport","Report "+this.Parent.Parent.GetObjName(this.ReportID)+": Report's query has no data and HideIfEmpty flag set -> Skipping report")}return}}}if(this.DSE.IsOpen()){this.DSE.SetCurrentPosition(1)}var j=true;var b=true;var e=new ADSEState();while(j){for(var l=0;l<this.SectionsList.Count();l++){var h=this.SectionsList[l];if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg("",0,"","-------------------- Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+" (RecNum = "+this.DSE.GetCurrentPosition()+" out of "+this.DSE.RecordCount()+") --------------------")}if(!h.GetFlag(IDREGlb.FL_SECT_VISIBLE)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),522,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": Section is invisible. Skipping...")}continue}if(h.SectType!=IDREGlb.SECT_PAGEHEADER&&h.SectType!=IDREGlb.SECT_PAGEFOOTER&&e.HideGroupLevel!=-1&&(h.GroupLevel>e.HideGroupLevel||h.SectType==IDREGlb.SECT_DETAIL)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),523,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": One previous sub-section has ShowChildren flag set to False and I'm included into that sub-section -> Skipping sub-section")}continue}var f=new MyBoolean(false);var k=new MyBoolean(false);var g=new MyBoolean(true);var a=true;var c=0;while(g.get()&&a){g.set(false);a=h.FormatPage(null,null,b,f,k,g,d);if(a&&(g.get()||c>0)){if(this.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.AddVerboseMsg(this.Parent.Parent.GetRTCGuid(h.SectionID),524,"CReport.FormatSubReport","Sub-Section "+this.Parent.Parent.GetObjName(h.SectionID)+": Reprint requested -> Reformatting sub-section")}if(c>0){(d.SubSections[d.SubSections.Count()-1]).RD3IdentName+="-"+c}c++}}if(h.SectType!=IDREGlb.SECT_PAGEHEADER&&h.SectType!=IDREGlb.SECT_PAGEFOOTER){j&=a}}b=false;j&=this.DSE.IsOpen();if(j){this.DSE.Next(e);e.ActualPosition=this.DSE.GetCurrentPosition();if(this.DSE.IsEof()){j=false}}}e=null};CReport.prototype.InitFlags=function(a){this.Flags=a};CReport.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_REPORT_VISIBLE}return a};CReport.prototype.GetFlag=function(a){if(a==IDREGlb.FL_REPORT_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};CReport.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_REPORT_VISIBLE}};CReport.prototype.SetRoleFlag=function(a){this.RoleFlag=a;for(var b=0;b<this.SectionsList.Count();b++){(this.SectionsList[b]).SetRoleFlag(a)}};CReport.prototype.ExportData=function(l,z){if(z==undefined){z=true}var t=new StringTokenizer();t.UseDecimalDot=l.ParamsObj().UseDecimalDot;var r=new IDVariant(t.UseDecimalDot?",":";");try{var p="";var k=this.DSE.IsOpen();if(!k){this.DSE.Open()}t.setString(new IDVariant(),r);for(var u=0;u<this.DSE.GetNumColumns();u++){var g=new IDVariant();var o=new IDVariant();var x=new IDVariant();this.DSE.GetFldParam(u+1,g,o,x);if(g.intValue()!=Glb.DT_DOC_OLE){t.addToken(new IDVariant(this.DSE.GetFieldName(u)))}}p+=t.getString()+"\n";this.DSE.MoveFirst();while(!this.DSE.IsEof()){t.setString(new IDVariant(),r);for(var u=0;u<this.DSE.GetNumColumns();u++){var g=new IDVariant();var o=new IDVariant();var x=new IDVariant();this.DSE.GetFldParam(u+1,g,o,x);if(g.intValue()!=Glb.DT_DOC_OLE){var A=new IDVariant();this.DSE.GetFieldValue(A,u+1);t.addToken(new IDVariant(A))}}p+=t.getString()+"\n";this.DSE.MoveNext()}var b;if(l.ShellObject.IsInsideShell()){var h="temp/"+GUID.DocID2GUID(MDOInit.GetNewDocID().stringValue())+".csv";var d=l.RealPath+"/"+h;var q=RD4_WebEntryPoint.VBFile.FreeFile();RD4_WebEntryPoint.VBFile.OpenForOutput(new IDVariant(d),q);RD4_WebEntryPoint.VBFile.WriteLine(q,new IDVariant(p));RD4_WebEntryPoint.VBFile.Close(q);b=h}else{var m=new Uint8Array(p.length);for(var v=0;v<p.length;v++){m[v]=p.charCodeAt(v)}var s=new BlobBuilder();s.append(m.buffer);var c=l.GetMimeType("csv");var a=s.getBlob(c);b=URL.createObjectURL(a)}if(!k){this.DSE.Close()}else{this.DSE.MoveFirst();var f=this.DSE.GetCurrentPosition();for(var v=1;v<f;v++){this.DSE.MoveNext()}}if(z){if(l.ShellObject.IsInsideShell()){l.TempFiles.Add(l.RealPath+"/"+b)}l.set_RedirectTo(new IDVariant(b));l.set_RedirectNewWindow(true)}return b}catch(y){WriteToConsoleError(y)}return""};CReport.prototype.SelectSection=function(a,b){var f=this.GetBook();var e=-1;if(b.Type==IDVariant.NULL||(b.Type==IDVariant.STRING&&b.stringValue().length==0)||(b.Type==IDVariant.INTEGER&&b.intValue()==0)){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),800,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Removing section selection")}f.FormattingType=IDREGlb.FRM_NONE;f.FormattingObj=null;return true}else{if(b.Type==IDVariant.INTEGER){var h=b.intValue();if(h<0||h>this.DSE.RecordCount()){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),801,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Removing section selection (record number "+h+" out of range 0-"+this.DSE.RecordCount()+")")}f.FormattingType=IDREGlb.FRM_NONE;f.FormattingObj=null;return true}}else{if(b.Type==IDVariant.STRING){for(var o=0;o<this.DSE.GetNumColumns()&&e==-1;o++){var v=this.DSE.GetFieldName(o);if(v.equals("HASH")){e=o}}if(e==-1){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),802,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Column HASH not found in the data source")}return false}}}}if(this.ParentBox!=null&&(f.FormattingObj==null||!(f.FormattingObj instanceof ASection))){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),803,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": You need to select the section that contains the sub-report before you can select a sub-report section")}return false}var q=null;for(var g=0;g<this.SectionsList.Count()&&q==null;g++){var r=this.SectionsList[g];if(r.SectionID==a){q=r}}if(q==null){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),804,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't find section inside the report")}return false}var l=this.DSE.GetCurrentPosition();if(this.ParentBox!=null){var c=null;var m=f.FormattingObj;for(var k=0;k<m.BoxList.Count()&&c==null;k++){var d=m.BoxList[k];if(d.ParentRptBox!=this.ParentBox){continue}c=d}if(c==null){if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),805,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't find an instance of my box inside the activated section")}return false}for(var g=0;g<c.SubSections.Count();g++){var r=c.SubSections[g];if(r.ParentSection.SectionID!=a){continue}if(b.Type==IDVariant.INTEGER&&r.DSEPosition!=b.intValue()){continue}else{if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(r.DSEPosition);var u=new IDVariant();this.DSE.GetFieldValue(u,e);if(!u.equals(b)){continue}}}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),806,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Section for record "+r.DSEPosition+" selected")}this.DSE.Close();this.DSE.UpdateIMDB(true);this.DSE.Open();this.DSE.SetCurrentPosition(r.DSEPosition);f.FormattingObj=r;f.FormattingType=IDREGlb.FRM_SECTION_PERM;return true}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),807,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The activated section does not contain the right sub-section instance")}}else{for(var j=0;j<f.PagesList.Count();j++){var t=f.PagesList[j];if(t==null){if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),808,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The page "+(j+1)+" has not been printed yet")}continue}if(t.ParentMastro!=q.RendersInto.PMastro){if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),809,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": The page "+t.PageNum+" is not of the right type (section renders in a different page)")}continue}if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),810,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Page "+t.PageNum+" contains instances of requested section -> Checking if it contains the right instance")}for(var g=0;g<t.Sections.Count();g++){var r=t.Sections[g];if(r.ParentSection.SectionID!=a){continue}if(b.Type==IDVariant.INTEGER&&r.DSEPosition!=b.intValue()){continue}else{if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(r.DSEPosition);var u=new IDVariant();this.DSE.GetFieldValue(u,e);if(!u.equals(b)){continue}}}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),806,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Section for record "+r.DSEPosition+" selected")}this.DSE.SetCurrentPosition(r.DSEPosition);f.FormattingObj=r;f.FormattingType=IDREGlb.FRM_SECTION_PERM;return true}if(f.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),811,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Page "+t.PageNum+" does not contain the right section instance")}}}if(b.Type==IDVariant.STRING){this.DSE.SetCurrentPosition(l)}if(f.DTTObj.Level>0){f.DTTObj.AddMsg(DTTEngine.DTTMSG_INFO,f.Parent.GetRTCGuid(this.ReportID),812,"CReport.SelectSection","Report "+f.Parent.GetObjName(this.ReportID)+": Can't locate the right section")}return false};function CRptBox(){this.BoxID=0;this.XPos=0;this.YPos=0;this.Width=0;this.Height=0;this.HRsz=IDREGlb.RSZ_NONE;this.VRsz=IDREGlb.RSZ_NONE;this.Interline=0;this.VisAttrIdx=-1;this.Flags=0;this.ImageIdx=0;this.FontHeight=0;this.ToolTip="";this.RoleFlag=-1;this.Stretch=IDREGlb.STRTC_AUTO;this.VisProp=-1;this.Rotation=0;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Alignment=IDREGlb.VISALN_AUTO;this.Badge="";this.NextBox=null;this.SubReport=null;this.PMastro=null;this.PSection=null;this.SubGraph=null;this.SpanList=new ArrayList()}CRptBox.prototype.GetID=function(){return this.BoxID};CRptBox.prototype.GetBook=function(){return(this.PSection!=null?this.PSection.Parent.Parent:this.PMastro.Parent)};CRptBox.prototype.USpan=function(){return new IDVariant(this.SpanList.Count())};CRptBox.prototype.bSpan=function(b){var a=this.GetBook();if(b.Type==IDVariant.INTEGER){return(b.intValue()<0||b.intValue()>=this.SpanList.Count()?null:this.SpanList[b.intValue()])}else{if(b.Type==IDVariant.STRING){return a.Parent.FindObjByID(a.Parent.Code2IndexMap[b.stringValue()])}else{return null}}};CRptBox.prototype.GetARptBox=function(a){var d=new ARptBox();d.ParentRptBox=this;d.InitFlags(this.GetFlags());d.XPos=this.XPos;d.YPos=this.YPos;d.Width=this.Width;d.Height=this.Height;d.HRsz=this.HRsz;d.VRsz=this.VRsz;d.Interline=this.Interline;d.SetVisualStyle(this.VisAttrIdx);d.ImageIdx=this.ImageIdx;d.YFilledPos=0;d.ToolTip=this.ToolTip;d.Stretch=this.Stretch;d.Rotation=this.Rotation;d.VisProp=this.VisProp;d.SetBackColor(this.BackColor);d.SetForeColor(this.ForeColor);d.Alignment=this.Alignment;d.SetFontMod(this.FontMod);d.Badge=this.Badge;IDREGlb.SetArraySize(d.Spans,this.SpanList.Count());for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)){d.Spans[c]=b.GetARptSpan(a);d.Spans[c].Parent=d}else{d.Spans[c]=null}}return d};CRptBox.prototype.SetRect=function(a,c){var b;if(this.PSection!=null){b=this.PSection.Parent.Parent}else{b=this.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:this.XPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_TOP:this.YPos=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_WIDTH:this.Width=b.ConvertToInternalValue(c);break;case IDREGlb.RECT_HEIGHT:this.Height=b.ConvertToInternalValue(c);break}};CRptBox.prototype.GetRect=function(a){var b;if(this.PSection!=null){b=this.PSection.Parent.Parent}else{b=this.PMastro.Parent}switch(a){case IDREGlb.RECT_LEFT:return b.ConvertFromInternalValue(this.XPos);case IDREGlb.RECT_TOP:return b.ConvertFromInternalValue(this.YPos);case IDREGlb.RECT_WIDTH:return b.ConvertFromInternalValue(this.Width);case IDREGlb.RECT_HEIGHT:return b.ConvertFromInternalValue(this.Height)}return 0};CRptBox.prototype.InitFlags=function(a){this.Flags=a};CRptBox.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTBOX_VISIBLE}return a};CRptBox.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTBOX_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return((this.Flags&a)!=0)};CRptBox.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTBOX_VISIBLE}};CRptBox.prototype.SetRoleFlag=function(a){this.RoleFlag=a;for(var b=0;b<this.SpanList.Count();b++){SpanList[b].SetRoleFlag(a)}};CRptBox.prototype.GetVisualStyle=function(){return this.VisAttrIdx};CRptBox.prototype.SetVisualStyle=function(a){for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.VisAttrIdx==this.VisAttrIdx){b.VisAttrIdx=a}}this.VisAttrIdx=a};CRptBox.prototype.GetBackColor=function(){return this.BackColor};CRptBox.prototype.SetBackColor=function(c){for(var b=0;b<this.SpanList.Count();b++){var a=this.SpanList[b];if(a.BackColor==this.BackColor){a.BackColor=c}}this.BackColor=c};CRptBox.prototype.GetForeColor=function(){return this.ForeColor};CRptBox.prototype.SetForeColor=function(c){for(var b=0;b<this.SpanList.Count();b++){var a=this.SpanList[b];if(a.ForeColor==this.ForeColor){a.ForeColor=c}}this.ForeColor=c};CRptBox.prototype.GetFontMod=function(){return this.FontMod};CRptBox.prototype.SetFontMod=function(a){for(var c=0;c<this.SpanList.Count();c++){var b=this.SpanList[c];if(b.FontMod.equals(this.FontMod)){b.FontMod=a}}this.FontMod=a};function CRptSpan(){this.SpanID=0;this.Parent=null;this.Text="";this.ToolTip="";this.FldIdx=-1;this.VisAttrIdx;this.DataType=IDREGlb.DT_UNSPEC;this.Scale=0;this.MaxLen=0;this.Flags=0;this.RoleFlag=-1;this.Stretch=IDREGlb.STRTC_AUTO;this.BackColor=-1;this.ForeColor=-1;this.FontMod="";this.Mask="";this.Watermark="";this.ValueList=new ArrayList()}CRptSpan.prototype.GetID=function(){return this.SpanID};CRptSpan.prototype.GetBook=function(){return(this.Parent.PSection!=null?this.Parent.PSection.Parent.Parent:this.Parent.PMastro.Parent)};CRptSpan.prototype.GetARptSpan=function(j){var a=new ARptSpan();a.ParentRptSpan=this;a.VisAttrIdx=this.VisAttrIdx;a.Scale=this.Scale;a.MaxLen=this.MaxLen;a.InitFlags(this.GetFlags());a.ToolTip=this.ToolTip;a.Stretch=this.Stretch;a.BackColor=this.BackColor;a.ForeColor=this.ForeColor;a.FontMod=this.FontMod;a.Mask=this.Mask;a.Watermark=this.Watermark;if(this.FldIdx!=-1&&j!=null){if(this.DataType==IDREGlb.DT_DOC_OLE){var d=null;if(this.Parent.PMastro!=null&&this.Parent.PMastro.Parent!=null){d=this.Parent.PMastro.Parent}if(this.Parent.PSection!=null&&this.Parent.PSection.Parent.Parent!=null){d=this.Parent.PSection.Parent.Parent}var g=false;if(d.Parent.ParentS!=null){g=d.Parent.ParentS.Parent.MainFrm.ParamsObj().NativeBlob}else{g=false}var f=false;if(d.PE!=null){f=d.PE.BlobInFile;if(!f){var b=new IDVariant("");j.GetBlobContent(this.FldIdx,a.Image,b,g);a.Text=b.ToString()}else{var c=false;if((d.VisualStyleList.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_HYPERLINK)!=0){c=true}var b=new IDVariant("");var e=new IDVariant("");j.GetWEBBlobContent(this.FldIdx,b,e,c,g);a.Text=b.ToString();a.MimeType=e.ToString()}a.Text=a.Text.replace(/\\/g,"/")}}else{var h=new IDVariant();if(this.FldIdx>=1){j.GetFieldValue(h,this.FldIdx);a.SetNewValue(h)}else{a.Text=this.Text}}}else{a.Text=this.Text}return a};CRptSpan.prototype.GetValueSourceVal=function(k,f,d,b,g){var e=-1;var c=null;var h;for(h=0;h<k.Count();h++){if((k[h]).Value.equals(d)){c=k[h];break}}if(c==null){return -1}var a=c.Name;if((f.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_SHOWVALUE)!=0){var j=new IDVariant(c.Value);a=j.stringValue()+" - "+a}b.set(new IDVariant(a));if((f.Flags(this.VisAttrIdx)&IDREGlb.FL_VIS_SHOWDESCR)!=0){g.set(new IDVariant(c.Description))}e=h;return e};CRptSpan.prototype.InitFlags=function(a){this.Flags=a};CRptSpan.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){a&=~IDREGlb.FL_RPTSPAN_ENABLED}return a};CRptSpan.prototype.GetFlag=function(a){if(a==IDREGlb.FL_RPTSPAN_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}if(a==IDREGlb.FL_RPTSPAN_ENABLED&&(this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){return false}return(this.Flags&a)!=0};CRptSpan.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_VISIBLE}if((this.RoleFlag&IDREGlb.OBJ_ENABLED)==0){this.Flags&=~IDREGlb.FL_RPTSPAN_ENABLED}};CRptSpan.prototype.SetRoleFlag=function(a){this.RoleFlag=a};function CRptSpanValItem(){this.Name="";this.Description="";this.Value=new IDVariant();this.Image=new MyImage();this.ImagePath="";this.VisualStyle=-1}CRptSpanValItem.prototype.CopyFrom=function(a){this.Name=a.Name;this.Description=a.Description;this.ImagePath=a.ImagePath;this.Value=a.Value;this.Image=a.Image;this.VisualStyle=a.VisualStyle};CRptSpanValItem.prototype.RD3RenderDifference=function(b,d,a){var c=b.AddNewElement("vli");if(this.Name!=null&&this.Name.length>0){c.SetAttribute("txt",this.Name)}if(this.Value!=null&&this.Value.stringValue().length>0){c.SetAttribute("val",this.Value.stringValue())}if(this.Description!=null&&this.Description.length>0){c.SetAttribute("tip",this.Description)}if(this.ImagePath!=null&&this.ImagePath.length>0){c.SetAttribute("img",this.ImagePath)}if(this.VisualStyle!=-1){c.SetAttribute("sty",a.VisualStyleList.GetTrueIdx(this.VisualStyle).toString())}return true};function CSection(){this.SectionID=0;this.Parent=null;this.NumCol;this.ColSpace;this.SectType;this.Height;this.VisAttrIdx;this.Flags;this.DBFieldName="";this.GroupLevel=-1;this.RendersInto=null;this.BoxList=new ArrayList();this.RoleFlag=-1;this.GH_DSEPos=-1;this.GH_PageNum=-1}CSection.prototype.GetID=function(){return this.SectionID};CSection.prototype.GetBook=function(){return this.Parent.Parent};CSection.prototype.UBox=function(){return new IDVariant(this.BoxList.Count())};CSection.prototype.bBox=function(a){if(a.Type==IDVariant.INTEGER){return(a.intValue()<0||a.intValue()>=this.BoxList.Count()?null:this.BoxList[a.intValue()])}else{if(a.Type==IDVariant.STRING){return this.Parent.Parent.Parent.FindObjByID(this.Parent.Parent.Parent.Code2IndexMap[a.stringValue()])}else{return null}}};CSection.prototype.SetHeight=function(b){var a=this.Parent.Parent;this.Height=a.ConvertToInternalValue(b)};CSection.prototype.SetColSpace=function(b){var a=this.Parent.Parent;this.ColSpace=a.ConvertToInternalValue(b)};CSection.prototype.GetHeight=function(){var a=this.Parent.Parent;return a.ConvertFromInternalValue(this.Height)};CSection.prototype.GetColSpace=function(){var a=this.Parent.Parent;return a.ConvertFromInternalValue(this.ColSpace)};CSection.prototype.GetNextMastro=function(d,c,f){var b=null;if(d!=null){b=d.GetState(this)}if(this.RendersInto==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),525,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section does not render anywhere. Skipping...")}return null}if(c==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),526,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section asks for box '"+this.Parent.Parent.Parent.GetObjName(this.RendersInto.BoxID)+"' that is in page '"+this.Parent.Parent.Parent.GetObjName(this.RendersInto.PMastro.MastroID)+"' (first page)")}return this.RendersInto.PMastro}var a=this.SearchMyCurrentBox(c.ParentMastro);if(a==null||a.NextBox==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),527,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was previously printed into box '"+(a!=null?this.Parent.Parent.Parent.GetObjName(a.BoxID):"???")+"' but this box does NOT continue in any other box (NextBox=NULL) -> this section will not be printed anymore")}return null}var e=new ArrayList();e.Add(a);while(a.PMastro==c.ParentMastro){a=a.NextBox;if(a==null){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),528,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Box chain ended. This section will not be printed anymore")}return null}if(e.IndexOf(a)!=-1){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),529,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section will continue into box '"+this.Parent.Parent.Parent.GetObjName(a.BoxID)+"'")}return a.PMastro}e.Add(a)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),530,"CSection.GetNextMastro","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section will continue into box '"+this.Parent.Parent.Parent.GetObjName(a.BoxID)+"'")}return a.PMastro};CSection.prototype.SearchMyCurrentBox=function(b){if(b==null){return this.RendersInto}var c=this.RendersInto;var a=new ArrayList();while(c.PMastro!=b){c=c.NextBox;if(c==null||a.IndexOf(c)!=-1){return null}a.Add(c)}return c};CSection.prototype.IsCompleted=function(c,b){if(c!=null&&b!=null&&c.DSEState.ActualPosition!=b.ParentReport.DSE.GetCurrentPosition()){return true}var a=(c!=null?c.GetState(this):null);return(a==null||(a.BoxStates.Count()==0&&this.BoxList.Count()!=0))};CSection.prototype.WantToPrint=function(d,c){var a=(c!=null&&d!=null&&d.GetState(this)==null&&d.DSEState.ActualPosition==c.ActualPosition);if(this.RendersInto==null){return false}if(a&&d!=null&&d.DSEState.HideGroupLevel!=-1){if(this.SectType!=IDREGlb.SECT_PAGEHEADER&&this.SectType!=IDREGlb.SECT_PAGEFOOTER&&(this.GroupLevel>d.DSEState.HideGroupLevel||this.SectType==IDREGlb.SECT_DETAIL||(this.GroupLevel==d.DSEState.HideGroupLevel&&this.SectType==IDREGlb.SECT_GROUPFOOTER))){a=false}}if(this.SectType==IDREGlb.SECT_DETAIL){if(a){return false}return(this.Parent.DSE.IsOpen()&&this.Parent.DSE.GetNumRecords()>0&&!this.Parent.DSE.IsEof())}else{if(this.SectType==IDREGlb.SECT_PAGEHEADER||this.SectType==IDREGlb.SECT_PAGEFOOTER){return false}else{if(c==null&&this.Parent.ParentBox==null){return false}var b=(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,(this.SectType==IDREGlb.SECT_REPORTHEADER||this.SectType==IDREGlb.SECT_GROUPHEADER),c));if((this.SectType==IDREGlb.SECT_REPORTHEADER||this.SectType==IDREGlb.SECT_REPORTFOOTER)&&(!this.Parent.DSE.IsOpen()||this.Parent.DSE.RecordCount()==0)){b=true}if(a){return false}return b}}};CSection.prototype.FormatPage=function(u,C,ac,P,D,j,c){var x=null;var ah=null;if(u!=null){x=u.GetState(this.Parent);if(x!=null){ah=x.GetState(this)}}var L=(C!=null?C.GetState(this.Parent):null);var ak=ac&&(this.SectType==IDREGlb.SECT_PAGEHEADER||this.SectType==IDREGlb.SECT_PAGEFOOTER||(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)))&&(x==null||x.PrintPHPF);if(ak&&this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),531,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Wants to print (first request for this page)")}if(ak&&ac&&this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&L!=null&&L.DSEState.ActualPosition==this.Parent.DSE.RecordCount()){var e=false;var H=(L!=null?L.DSEState:null);for(var R=0;R<this.Parent.SectionsList.Count();R++){var J=this.Parent.SectionsList[R];if(J.SectType!=IDREGlb.SECT_DETAIL){continue}if(!J.IsCompleted(x,L)||(x!=null&&J.WantToPrint(x,H))){e=true;break}}if(!e){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),532,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is GH and it has ShowOnNewPage flag set but all details have been already printed before -> Skipping")}ak=false}}if(!ak&&x!=null){ak|=!this.IsCompleted(x,L);if(ak&&this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),533,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section did NOT want to be printed but it was partially printed on previous page -> Printing section")}}if(!ak){ak|=this.WantToPrint(x,(L!=null?L.DSEState:null))}if(ak){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),534,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section wants to print something on the page")}var v=this.GetASectionState(L);var Y=new ArrayList();if(c!=null){Y.Add(c)}else{this.FindMastroBoxesInThisPage(Y,C)}if(ah==null||c!=null||x.DSEState.ActualPosition!=L.DSEState.ActualPosition){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),535,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Creating a new instance from design time section")}for(var aq=0;aq<this.BoxList.Count();aq++){if(this.BoxList[aq].GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){var Q=this.BoxList[aq].GetARptBox(this.Parent.DSE);v.BoxStates.Add(Q)}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),536,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnBeforeFormatting event")}if(Y.Count()>0){v.MastroBox=Y[0]}else{v.MastroBox=null}this.Parent.Parent.FormattingObj=v;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION;this.Parent.FormattingObj=v;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;for(var ag=0;ag<v.BoxStates.Count();ag++){var h=(v.BoxStates[ag]);if(!h.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){h.DeleteNullSpans()}}j.set(v.Reprint);if(!v.GetFlag(IDREGlb.FL_SECT_VISIBLE)){v=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),537,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has been hidden during OnBeforeFormatting event. Skipping...")}return true}for(var aj=0;aj<v.BoxStates.Count();aj++){var O=v.BoxStates[aj];if(O.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){O.LogDSEpositions()}}v.PrevBottomBorder=v.GetBottomBorder()}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),538,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was previously formatted -> Retrieving instance from cache")}v.CopyFrom(ah);this.GH_PageNum=v.GH_PageNum}if(v.GetFlag(IDREGlb.FL_SECT_NEWPGBEFORE)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),539,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag NewPageBefore set -> filling all boxes in the current page (except PH or PF if they are in a box different from mine)")}this.FillAllReportsMastros(C,true)}var q=null;var S=false;var ad;for(var E=0;E<Y.Count();E++){var U=Y[E];TryNextColumn:do{v.Reset();v.MastroBox=U;v.Arrange();TryNextBox:{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),540,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Formatting Sub-Reports or Sub-Graphs")}for(var o=0;o<v.BoxStates.Count();o++){var T=v.BoxStates[o];if(T.FormatGraph()){continue}var ab=0;for(var an=0;an<Y.Count();an++){var N=Y[an];ab=Math.max(ab,N.Height-N.YFilledPos-T.YPos-v.PrevBottomBorder)}if(ab<T.Height){ab=T.Height}var ar=T.FormatSubReport(ab);if(ar>T.Height){T.Height=ar}}for(var o=0;o<v.BoxStates.Count();o++){var T=v.BoxStates[o];if(T.VRsz==IDREGlb.RSZ_STRETCH||!T.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)){T.HandleVertResize()}}var a=v.GetBottomBorder();if(a<v.PrevBottomBorder){var am=v.Height;v.Height+=v.PrevBottomBorder-a;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),541,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Bottom border has changed. Fixing it (PreviousHeight = "+this.Parent.Parent.InternalUnitToString(am)+", NewHeight = "+this.Parent.Parent.InternalUnitToString(v.Height)+")")}}if(v.GetFlag(IDREGlb.FL_SECT_OVERLAY)){U.YFilledPos=U.YFilledPosPrev}var A;if(c!=null){A=c.SubSections}else{A=C.Sections}var I=null;if(A!=null){for(var ag=A.Count()-1;ag>=0;ag--){var J=A[ag];if(J.MastroBox==v.MastroBox){I=J;break}}}if(I!=null&&I.NumCol!=((v.NumCol!=0)?v.NumCol:this.NumCol)&&I.MastroBox.LastColumnUsed>0){I.MastroBox.LastColumnUsed=0;if(I.MastroBox.YFilledPos+I.Height>I.MastroBox.Height){I.Height=I.MastroBox.Height-I.MastroBox.YFilledPos}I.MastroBox.YFilledPos+=I.Height;I.MastroBox.YFilledPosPrev=I.MastroBox.YFilledPos}q=this.GetASection(v);q.Parent=C;ad=0;for(var ag=0;ag<v.BoxStates.Count();ag++){var T=v.BoxStates[ag];var M=true;if(!T.GetFlag(IDREGlb.FL_RPTBOX_VISIBLE)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(T.ParentRptBox.BoxID),542,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(T.ParentRptBox.BoxID)+": Box is invisible -> Skipping")}M=false}if(T.GetFlag(IDREGlb.FL_RPTBOX_OMITZERO)&&T.IsZero()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(T.ParentRptBox.BoxID),543,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(T.ParentRptBox.BoxID)+": Box has OmitIfZero flag set and it is ZERO -> Skipping")}M=false}if(this.Parent.Parent.IsPrinting&&!T.GetFlag(IDREGlb.FL_RPTBOX_TOPRINT)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(T.ParentRptBox.BoxID),544,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(T.ParentRptBox.BoxID)+": Box has ShowWhenPrinted flag set and the book is printing -> Skipping")}M=false}if(!this.Parent.Parent.IsPrinting&&!T.GetFlag(IDREGlb.FL_RPTBOX_TOPREVIEW)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(T.ParentRptBox.BoxID),545,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(T.ParentRptBox.BoxID)+": Box has ShowWhenPreviewed flag set and the book is shown in preview -> Skipping")}M=false}if(T.GetFlag(IDREGlb.FL_RPTBOX_OMITDUPL)&&A!=null){var K=null;for(var f=A.Count()-1;f>=0;f--){var J=A[f];for(var aq=0;aq<J.BoxList.Count();aq++){if(J.BoxList[aq].ParentRptBox==T.ParentRptBox){K=J.BoxList[aq];break}}if(K!=null){break}}if(K!=null){var t;for(t=0;t<T.Spans.Count();t++){var z=T.Spans[t];if(z.GetFlag(IDREGlb.FL_RPTSPAN_VISIBLE)&&K.Spans[t]!=null&&!z.Value.equals((K.Spans[t]).Value)){break}}if(t==T.Spans.Count()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(T.ParentRptBox.BoxID),546,"CSection.FormatPage","Box "+this.Parent.Parent.Parent.GetObjName(T.ParentRptBox.BoxID)+": Box has OmitDuplicate flag set and the previous instance was exactly equal to me -> Skipping")}M=false}}}if(!M){T=null;v.BoxStates.RemoveAt(ag--);continue}var ap=null;if(T.ParentRptBox.NextBox!=null){for(var ae=0;ae<v.BoxStates.Count();ae++){var aq=v.BoxStates[ae];if(aq.ParentRptBox==T.ParentRptBox.NextBox){ap=aq;break}}}var X=T.FormatPage(U,ap);if(X!=null){X.ParentSect=q;q.BoxList[ad++]=X;if(T.IsCompleted()){T=null;v.BoxStates.RemoveAt(ag--)}else{if(T.VRsz==IDREGlb.RSZ_STRETCH){T.Height=0}}}}IDREGlb.SetArraySize(q.BoxList,ad);if(U.YFilledPos==0){for(var R=0;R<this.Parent.SectionsList.Count();R++){var J=this.Parent.SectionsList[R];if(J==this){break}if(J.SectType==IDREGlb.SECT_GROUPHEADER&&J.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)){var aa=new ArrayList();J.FindMastroBoxesInThisPage(aa,C);if(aa.Contains(U)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(J.SectionID),547,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(J.SectionID)+": Section is a GH and has ShowOnNewPage flag set -> Printing it now")}J.FormatPage(u,C,true,P,D,j,c)}}}q.YPos=U.YFilledPos}if(L!=null&&this.SectType!=IDREGlb.SECT_REPORTHEADER&&this.SectType!=IDREGlb.SECT_PAGEHEADER&&this.SectType!=IDREGlb.SECT_PAGEFOOTER){for(var ag=0;ag<L.SectionStates.Count();ag++){var r=L.SectionStates[ag];if(r.ParentSection.SectType==IDREGlb.SECT_PAGEHEADER||r.ParentSection.SectType==IDREGlb.SECT_PAGEFOOTER){continue}if(r.ParentSection.SectType<this.SectType){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),571,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was formatted but will NOT be printed in this page at this moment because section '"+this.Parent.Parent.Parent.GetObjName(r.ParentSection.SectionID)+"' was not completely printed on this page.")}for(var aq=0;aq<q.BoxList.Count();aq++){var O=q.BoxList[aq];var al=0;for(var af=0;af<v.BoxStates.Count();af++){var ao=v.BoxStates[af];if(O.ParentRptBox.BoxID<ao.ParentRptBox.BoxID){break}al++}v.BoxStates.Insert(al,O)}q.BoxList.Clear();for(var V=v.BoxStates.Count()-1;V>=0;V--){var h=v.BoxStates[V];if(h.ParentRptBox.SubReport!=null){h.LastColumnUsed=0}var ap=null;if(h.ParentRptBox.NextBox!=null){for(var ai=0;ai<v.BoxStates.Count();ai++){var aq=v.BoxStates[ai];if(aq.ParentRptBox==h.ParentRptBox.NextBox){ap=aq;break}}for(var t=0;t<ap.Spans.Count();t++){if(ap.Spans[t]!=null){if(h.Spans[t]!=null){h.Spans[t].Text+=ap.Spans[t].Text}else{h.Spans[t]=ap.Spans[t];h.Spans[t].Parent=h}ap.Spans[t]=null}}}}q=null;S=true;break TryNextBox}}}if(U.Height-U.YFilledPos>0&&(!q.ContainsBoxes()||ad==0)){if(!q.IsFullyPrinted()||v.BoxStates.Count()>0){if(q.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)){for(var aq=0;aq<q.BoxList.Count();aq++){var O=q.BoxList[aq];var al=0;for(var af=0;af<v.BoxStates.Count();af++){var ao=v.BoxStates[af];if(O.ParentRptBox.BoxID<ao.ParentRptBox.BoxID){break}al++}v.BoxStates.Insert(al,O)}q.BoxList.Clear();for(var V=v.BoxStates.Count()-1;V>=0;V--){var h=v.BoxStates[V];if(h.ParentRptBox.SubReport!=null){h.LastColumnUsed=0}var ap=null;if(h.ParentRptBox.NextBox!=null){for(var ai=0;ai<v.BoxStates.Count();ai++){var aq=v.BoxStates[ai];if(aq.ParentRptBox==h.ParentRptBox.NextBox){ap=aq;break}}for(var t=0;t<ap.Spans.Count();t++){if(ap.Spans[t]!=null){if(h.Spans[t]!=null){h.Spans[t].Text+=ap.Spans[t].Text}else{h.Spans[t]=ap.Spans[t];h.Spans[t].Parent=h}ap.Spans[t]=null}}}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),548,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section was partially printed but it can't be split (KeepTogether flag set). Trying next box in the box chain")}q=null;S=true;break TryNextBox}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),549,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has been partially printed")}}q.Height=U.Height-U.YFilledPos;if(q.GetFlag(IDREGlb.FL_SECT_HIDEEMPTY)&&q.IsEmpty()){v=null;q=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),550,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is empty and it has the HideIfEmpty flag set -> Skipping")}return true}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&q.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){var m=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition());if(m!=null&&m.PageNum==-1){m.PageNum=q.Parent.PageNum}}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&L!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,L.DSEState)){this.GH_PageNum=q.Parent.PageNum}q.GH_PageNum=this.GH_PageNum;var G=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition(),false);if(G!=null){G.PageNum=q.Parent.PageNum;G.GH_PageNum=q.GH_PageNum}else{WriteToConsoleError("[CSection::FormatSection] Can't locate the PermanentState for a GH with ShowNewPage set")}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),551,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnAfterFormatting event")}this.Parent.Parent.FormattingObj=q;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION_AFT;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnAfterFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;this.Parent.FormattingObj=null;if(this.Parent.PrintedSomething==0){this.Parent.PrintedSomething=(C!=null?C.PageNum:-1)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),552,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Adding section to the page");this.Parent.Parent.DTTObj.AddParameter("","","Section YPos",this.Parent.Parent.InternalUnitToString(q.YPos));this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(q.Height))}if(c!=null){if(c.SubSections==null){c.SubSections=new ArrayList()}c.SubSections.Add(q)}else{C.Sections.Add(q)}if(q.GetFlag(IDREGlb.FL_SECT_OVERLAY)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),553,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has Overlay flag set but it has been partially printed. Remaining part will NOT be printed anymore -> removing it from cache")}U.YFilledPosPrev=U.YFilledPos;U.YFilledPos=U.Height;v=null;return true}D.set(false);var F=2147483647;for(var g=0;g<v.BoxStates.Count();g++){var T=v.BoxStates[g];F=Math.min(F,T.YPos)}for(var g=0;g<v.BoxStates.Count();g++){var T=v.BoxStates[g];T.YPos-=F}v.Height-=v.PrevBottomBorder;v.Height-=(F-v.PrevBottomBorder);v.SavedHeight=v.Height;if(q.ArrangeColumn()){break TryNextBox}continue TryNextColumn}else{if(U.YFilledPos+q.Height>U.Height){q.Height=U.Height-U.YFilledPos;if(!q.GetFlag(IDREGlb.FL_SECT_KEEPTOGETHER)&&q.BoxList.Count()==1){var h=q.BoxList[0];if(!h.GetFlag(IDREGlb.FL_RPTBOX_KEEPTOGETHER)&&h.SubSections!=null&&h.SubSections.Count()>0){if(h.Height<q.Height){var l=q.ParentSection.Height-h.ParentRptBox.Height;q.Height=h.Height+l}}}}if(q.GetFlag(IDREGlb.FL_SECT_HIDEEMPTY)&&q.IsEmpty()){v=null;q=null;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),554,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section is empty and it has the HideIfEmpty flag set -> Skipping")}return true}U.YFilledPosPrev=U.YFilledPos;if(q.ArrangeColumn()){var B=q.Height;if(q.XPos!=0&&A!=null){for(var w=A.Count()-1;w>=0;w--){var J=A[w];if(J.MastroBox!=q.MastroBox){break}B=Math.max(B,J.Height);if(J.XPos==0){break}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB&&q.Height!=B){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),555,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has ColumnNumber!=1 -> Adapting MastroBox filling state to the maximum heigth of other sections in the current 'row'");this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(q.Height));this.Parent.Parent.DTTObj.AddParameter("","",'"Row" Height',this.Parent.Parent.InternalUnitToString(B))}}U.YFilledPos+=B}if(!q.GetFlag(IDREGlb.FL_SECT_OVERLAY)){U.YFilledPosPrev=U.YFilledPos}v=null;if(this.SectType==IDREGlb.SECT_GROUPHEADER&&q.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){var m=this.Parent.GetPermanentState(this.SectionID,this.Parent.DSE.GetCurrentPosition());if(m!=null&&m.PageNum==-1){m.PageNum=q.Parent.PageNum}}if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&L!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,L.DSEState)){this.GH_PageNum=q.Parent.PageNum}q.GH_PageNum=this.GH_PageNum;var G=this.Parent.GetPermanentState(this.SectionID,Parent.DSE.GetCurrentPosition(),false);if(G!=null){G.PageNum=q.Parent.PageNum;G.GH_PageNum=q.GH_PageNum}else{WriteToConsoleError("[CSection::FormatSection] Can't locate the PermanentState for a GH with ShowNewPage set")}}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),556,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Fire OnAfterFormatting event")}this.Parent.Parent.FormattingObj=q;this.Parent.Parent.FormattingType=IDREGlb.FRM_SECTION_AFT;var d=this.Parent.Parent.Parent.GetNewID2OldID(this.SectionID);this.Parent.Parent.Parent.Fire_OnAfterFormattingSection(d);this.Parent.Parent.FormattingType=IDREGlb.FRM_NONE;this.Parent.Parent.FormattingObj=null;this.Parent.FormattingObj=null;if(this.Parent.PrintedSomething==0){this.Parent.PrintedSomething=(C!=null?C.PageNum:-1)}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),557,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Adding section to the page");this.Parent.Parent.DTTObj.AddParameter("","","Section YPos",this.Parent.Parent.InternalUnitToString(q.YPos));this.Parent.Parent.DTTObj.AddParameter("","","Section Height",this.Parent.Parent.InternalUnitToString(q.Height))}if(c!=null){if(c.SubSections==null){c.SubSections=new ArrayList()}c.SubSections.Add(q)}else{C.Sections.Add(q)}if(L!=null&&L.DSEState.HideGroupLevel!=-1){var W=false;if(this.SectType==IDREGlb.SECT_GROUPFOOTER&&this.GroupLevel>=L.DSEState.HideGroupLevel){W=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),558,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  this is a GF and its level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}else{if(this.SectType==IDREGlb.SECT_GROUPHEADER){if(q.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)&&this.GroupLevel>=L.DSEState.HideGroupLevel){W=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),559,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  this is a GH and its level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}else{if(!q.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)&&this.GroupLevel>L.DSEState.HideGroupLevel){W=true;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),560,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": ShowChildren of one of previous GH sections is False,  my level is equal to the GH level -> Remove filtering. From now on sections will be shown")}}}}}if(W){L.DSEState.HideGroupLevel=-1}}if(L!=null&&this.SectType==IDREGlb.SECT_GROUPHEADER&&!q.GetFlag(IDREGlb.FL_SECT_SHOWCHILD)){L.DSEState.HideGroupLevel=this.GroupLevel;if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),561,"CSection.FormatPage","Section '"+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has ShowChildren flag set to False -> Adding filtering. From now on all sections with level below "+this.GroupLevel+" will be hidden")}}if(q.GetFlag(IDREGlb.FL_SECT_NEWPGAFTER)){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),562,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag NewPageBefore set -> Filling all boxes in the current page (except for PH or PF if they are in a box different from mine)")}this.FillAllReportsMastros(C)}D.set(true);if(q.GetFlag(IDREGlb.FL_SECT_SHOWBOTTOMBOX)){q.YPos=U.Height-q.Height;U.YFilledPos=U.Height;if(!q.GetFlag(IDREGlb.FL_SECT_OVERLAY)){U.YFilledPosPrev=U.YFilledPos}if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),563,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Flag ShowBottomBox set -> Moving the section to the bottom of the Mastro box (YPos = "+this.Parent.Parent.InternalUnitToString(q.YPos)+", MastroBoxHeight = "+this.Parent.Parent.InternalUnitToString(U.Height)+")")}D.set(false)}return true}}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),564,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has not been printed. Trying next box in the mastro chain (if available)")}q=null;S=true;break TryNextBox}}if(c==null&&S&&D.get()){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),565,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has NOT been printed -> Kept in cache for next page")}var k=null;var w;for(w=C.Sections.Count()-1;w>=0;w--){var Z=C.Sections[w];if(Z.MastroBox!=U){k=null;break}if(Z.ParentSection==this){break}if(!Z.ParentSection.GetFlag(IDREGlb.FL_SECT_KEEPNEXT)){break}if(k!=null&&k.ParentSection==Z.ParentSection){break}k=Z}if(k!=null){w++}if(k!=null&&w>0){if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),566,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section has not been printed and previous instance of section "+this.Parent.Parent.Parent.GetObjName(k.ParentSection.SectionID)+" had the KeepWithNextSection flag set -> Removing that from the current page and storing it in cache with me (will print on next page)")}P.set(true);U.YFilledPos=U.Height;U.YFilledPosPrev=U.Height;var y=C.Sections[w-1];this.Parent.DSE.SetCurrentPosition(y.DSEPosition);L.DSEState.ActualPosition=y.DSEPosition;C.Sections.splice(w,C.Sections.Count()-w);v=null;q=null;return true}}U.YFilledPosPrev=U.YFilledPos;U.YFilledPos=U.Height;if(q!=null&&!q.GetFlag(IDREGlb.FL_SECT_OVERLAY)){U.YFilledPosPrev=U.YFilledPos}}while(false)}v.Reset();if((v.BoxStates.Count()!=0||this.BoxList.Count()==0)&&c==null){L.SectionStates.Add(v)}else{v=null}return false}else{if(this.Parent.Parent.DTTObj.MsgLevel>=DTTEngine.DTTMSG_VERB){this.Parent.Parent.AddVerboseMsg(this.Parent.Parent.Parent.GetRTCGuid(this.SectionID),567,"CSection.FormatPage","Section "+this.Parent.Parent.Parent.GetObjName(this.SectionID)+": Section does NOT want to print (maybe is not the right time to do it and was not partially printed before)")}}return true};CSection.prototype.FillAllReportsMastros=function(e,b){if(b==undefined){b=false}var g=new ArrayList();for(var j=0;j<this.Parent.SectionsList.Count();j++){var f=this.Parent.SectionsList[j];if(f.SectType==IDREGlb.SECT_PAGEHEADER||f.SectType==IDREGlb.SECT_PAGEFOOTER){continue}if(!f.GetFlag(IDREGlb.FL_SECT_VISIBLE)){continue}if(f.RendersInto==null){continue}var h=new ArrayList();f.FindMastroBoxesInThisPage(h,e);g.AddRange(h)}if(b){var c=true;for(var a=0;a<g.Count();a++){var d=g[a];if(d.YFilledPos!=0){c=false;break}}if(c){return}}for(var a=0;a<g.Count();a++){var d=g[a];d.YFilledPos=d.Height;d.YFilledPosPrev=d.Height}};CSection.prototype.FindMastroBoxesInThisPage=function(e,d){var g=this.SearchMyCurrentBox(d.ParentMastro);if(g==null){return}e.Add(g);while(g.PMastro==d.ParentMastro){g=g.NextBox;if(g==null||e.IndexOf(g)!=-1){break}e.Add(g)}for(var h=0;h<e.Count();h++){var f=e[h];var c=null;for(var a=0;a<d.MastroBoxes.Count();a++){if(d.MastroBoxes[a].ParentRptBox==f){c=d.MastroBoxes[a];break}}if(c!=null&&(c.YFilledPos<c.Height||(this.GetFlag(IDREGlb.FL_SECT_OVERLAY)&&c.YFilledPosPrev<c.Height))){e[h]=c}else{e.RemoveAt(h--)}}};CSection.prototype.GetASection=function(a){var b=new ASection();b.ParentSection=this;b.MastroBox=a.MastroBox;b.XPos=0;b.YPos=a.MastroBox.YFilledPos;b.Height=a.Height;b.InitFlags(a.GetFlags());b.VisAttrIdx=a.VisAttrIdx;b.ColSpace=a.ColSpace;b.NumCol=a.NumCol;b.GH_DSEPos=a.GH_DSEPos;b.PageChanged=a.PageChanged;if(a.Parent!=null){b.DSEPosition=a.Parent.DSEState.ActualPosition}else{b.DSEPosition=a.ParentSection.Parent.DSE.GetCurrentPosition()}b.GetRD3Ident();IDREGlb.SetArraySize(b.BoxList,a.BoxStates.Count());return b};CSection.prototype.GetASectionState=function(c){var a=new ASectionState();a.Parent=c;a.ParentSection=this;a.Height=this.Height;a.InitFlags(this.GetFlags());a.VisAttrIdx=this.VisAttrIdx;a.ColSpace=this.ColSpace;a.NumCol=0;if(this.SectType==IDREGlb.SECT_GROUPHEADER&&this.GetFlag(IDREGlb.FL_SECT_SHOWNEWPAGE)&&c!=null){if(this.Parent.DSE.IsMyGroupTime(this.GroupLevel,true,c.DSEState)){this.GH_DSEPos=c.DSEState.ActualPosition}a.GH_DSEPos=this.GH_DSEPos;var d=this.Parent.GetPermanentState(this.SectionID,Parent.DSE.GetCurrentPosition());if(d==null){d=new PSectionState();this.Parent.PermStatesList.Add(d);d.SectionID=this.SectionID;d.DSECurrentPosition=this.Parent.DSE.GetCurrentPosition();d.Flags=this.GetFlags();d.GH_DSECurrentPosition=a.GH_DSEPos}}var b=this.Parent.GetPermanentState(a);if(b!=null){a.InitFlags(b.Flags)}return a};CSection.prototype.InitFlags=function(a){this.Flags=a};CSection.prototype.GetFlags=function(){var a=this.Flags;if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){a&=~IDREGlb.FL_SECT_VISIBLE}return a};CSection.prototype.GetFlag=function(a){if(a==IDREGlb.FL_SECT_VISIBLE&&(this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){return false}return(this.Flags&a)!=0};CSection.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}if((this.RoleFlag&IDREGlb.OBJ_VISIBLE)==0){this.Flags&=~IDREGlb.FL_SECT_VISIBLE}};CSection.prototype.SetRoleFlag=function(c){this.RoleFlag=c;for(var a=0;a<this.BoxList.Count();a++){this.BoxList[a].SetRoleFlag(c)}};CSection.prototype.IsChildOf=function(d){if(d==this){return true}for(var a=0;a<this.BoxList.Count();a++){var e=this.BoxList[a];if(e==d){return true}for(var f=0;f<e.SpanList.Count();f++){var c=e.SpanList[f];if(c==d){return true}}}return false};function CSpanDiv(){this.DataType=0;this.Riga=0;this.TextHeight=0;this.TextWidth=0;this.TextAscent=0;this.TextLineGap=0;this.Point=new Object();this.Point.X=0;this.Point.Y=0;this.Text="";this.Span=null;this.CharPos=new ArrayList();this.JustSpace=0;this.DelSpaces=0;this.DelSpacesWidth=0}CSpanDiv.prototype.GetText=function(a){if(a<0){return""}a+=2;if(this.TextWidth>a){var b=0;for(var c=0;c<this.Text.length;c++){b+=this.CharPos[c];if(b>a){return this.Text.substr(0,c)}}}return this.Text};function IDREGlb(){}IDREGlb.INT_MAX=2147483647;IDREGlb.CLR_NONE=-1;IDREGlb.IMDB_CURSOR=10;IDREGlb.DT_LEFT=0;IDREGlb.DT_CENTER=1;IDREGlb.DT_RIGHT=2;IDREGlb.PRN_NONE=0;IDREGlb.PRN_SCREEN=1;IDREGlb.PRN_PRINTER=2;IDREGlb.PRN_PDF=3;IDREGlb.PRN_ABCPDF=4;IDREGlb.DEV_NONE=0;IDREGlb.DEV_SCREEN=1;IDREGlb.DEV_PRINTER=2;IDREGlb.DEV_PDF=3;IDREGlb.RECT_LEFT=1;IDREGlb.RECT_TOP=2;IDREGlb.RECT_WIDTH=3;IDREGlb.RECT_HEIGHT=4;IDREGlb.DTC_NONE=0;IDREGlb.DTC_NUMBER=1;IDREGlb.DTC_CHAR=2;IDREGlb.DTC_DATE=3;IDREGlb.DTC_DOC=4;IDREGlb.DTC_BOOL=5;IDREGlb.DTC_OBJECT=6;IDREGlb.DT_UNSPEC=0;IDREGlb.DT_NUM_INTEGER=1;IDREGlb.DT_NUM_FLOAT=2;IDREGlb.DT_NUM_FIXED=3;IDREGlb.DT_NUM_CURRENCY=4;IDREGlb.DT_CHAR=5;IDREGlb.DT_CHAR_FIXED=12;IDREGlb.DT_DATE=6;IDREGlb.DT_TIME=7;IDREGlb.DT_DATETIME=8;IDREGlb.DT_DOC_TEXT=9;IDREGlb.DT_DOC_OLE=10;IDREGlb.DT_BOOLEAN=11;IDREGlb.DT_OBJECT=13;IDREGlb.PR_USER=32;IDREGlb.RSZ_NONE=1;IDREGlb.RSZ_MOVE=2;IDREGlb.RSZ_STRETCH=3;IDREGlb.STRTC_AUTO=1;IDREGlb.STRTC_NONE=2;IDREGlb.STRTC_FILL=3;IDREGlb.STRTC_ENLARGE=4;IDREGlb.STRTC_CROP=5;IDREGlb.BCM_PRINT=1;IDREGlb.BCM_NAVIGATION=2;IDREGlb.BCM_CSV=4;IDREGlb.PR_VIS_COLORS=IDREGlb.PR_USER;IDREGlb.PR_VIS_FONTS=IDREGlb.PR_USER+1;IDREGlb.PR_VIS_BORDER=IDREGlb.PR_USER+2;IDREGlb.PR_VIS_OFFSET=IDREGlb.PR_USER+3;IDREGlb.PR_VIS_MASK=IDREGlb.PR_USER+4;IDREGlb.PR_VIS_CONTROL=IDREGlb.PR_USER+5;IDREGlb.PR_VIS_ALIGN=IDREGlb.PR_USER+6;IDREGlb.FL_VIS_PASSWORD=65536;IDREGlb.FL_VIS_SHOWVALUE=131072;IDREGlb.FL_VIS_SHOWDESCR=262144;IDREGlb.FL_VIS_SHOWIMAGE=524288;IDREGlb.FL_VIS_PREVFORM=1048576;IDREGlb.FL_VIS_HYPERLINK=2097152;IDREGlb.FL_VIS_EMBEDFONT=4194304;IDREGlb.FL_VIS_UNICODE=8388608;IDREGlb.VISCLR_FOREVALUE=1;IDREGlb.VISCLR_FOREHEAD=2;IDREGlb.VISCLR_FOREGROUP=3;IDREGlb.VISCLR_BACKVALUE=4;IDREGlb.VISCLR_ALTVALUE=5;IDREGlb.VISCLR_BACKPANEL=6;IDREGlb.VISCLR_BACKHEAD=7;IDREGlb.VISCLR_BACKGROUP=8;IDREGlb.VISCLR_HILIGHT=9;IDREGlb.VISCLR_EDITING=10;IDREGlb.VISCLR_BORDERS=11;IDREGlb.VISCLR_BACKGRPFORM=12;IDREGlb.VISCLR_FOREGRPFORM=13;IDREGlb.VISCLR_BACKQBE=14;IDREGlb.VISCLR_BACKREADONLY=15;IDREGlb.VISCLR_HILIGHTREADONLY=16;IDREGlb.VISCLR_BACKHEADFRM=17;IDREGlb.VISFNT_VALUE=1;IDREGlb.VISFNT_HEAD=2;IDREGlb.VISFNT_GROUP=3;IDREGlb.VISBRD_NONE=1;IDREGlb.VISBRD_HORIZ=2;IDREGlb.VISBRD_VERT=3;IDREGlb.VISBRD_FRAME=4;IDREGlb.VISBRD_SUNKEN=5;IDREGlb.VISBRD_RAISED=6;IDREGlb.VISBRD_ETCHED=7;IDREGlb.VISBRD_BUMP=8;IDREGlb.VISBRD_CUSTOM=9;IDREGlb.VISBDI_VALUE=1;IDREGlb.VISBDI_HEAD=2;IDREGlb.VISBDI_GROUP=3;IDREGlb.VISBDI_HDRFORM=4;IDREGlb.VISBDI_GRPFORM=5;IDREGlb.VISBDI_VALFORM=6;IDREGlb.VISCBOR_TOP=1;IDREGlb.VISCBOR_RIGHT=2;IDREGlb.VISCBOR_BOTTOM=3;IDREGlb.VISCBOR_LEFT=4;IDREGlb.VISCTYP_SOLID=1;IDREGlb.VISCTYP_DOTTED=2;IDREGlb.VISCTYP_DASHED=3;IDREGlb.VISCTYP_DOUBLE=4;IDREGlb.VISGRADDIR_NONE=1;IDREGlb.VISGRADDIR_HORIZ=2;IDREGlb.VISGRADDIR_VERT=3;IDREGlb.VISALN_AUTO=1;IDREGlb.VISALN_SX=2;IDREGlb.VISALN_CX=3;IDREGlb.VISALN_DX=4;IDREGlb.VISALN_JX=5;IDREGlb.VISALI_VALUE=1;IDREGlb.VISALI_HDRLIST=2;IDREGlb.VISALI_HDRFORM=3;IDREGlb.VISCTRL_AUTO=1;IDREGlb.VISCTRL_EDIT=2;IDREGlb.VISCTRL_COMBO=3;IDREGlb.VISCTRL_CHECK=4;IDREGlb.VISCTRL_OPTION=5;IDREGlb.VISCTRL_BUTTON=6;IDREGlb.VISCTRL_HTMLEDIT=7;IDREGlb.AGGR_REC=0;IDREGlb.AGGR_SUM=1;IDREGlb.AGGR_AVE=2;IDREGlb.AGGR_VAR=3;IDREGlb.AGGR_DEV=4;IDREGlb.AGGR_CNT=5;IDREGlb.AGGR_MIN=6;IDREGlb.AGGR_MAX=7;IDREGlb.AGGR_DSUM=8;IDREGlb.FRM_NONE=0;IDREGlb.FRM_SECTION=1;IDREGlb.FRM_PAGE=2;IDREGlb.FRM_SECTION_PERM=3;IDREGlb.FRM_SECTION_AFT=4;IDREGlb.OBJ_UNKNOWN=-1;IDREGlb.OBJ_BOOK=0;IDREGlb.OBJ_MASTRO=1;IDREGlb.OBJ_RPTBOX=2;IDREGlb.OBJ_RPTSPAN=3;IDREGlb.OBJ_REPORT=4;IDREGlb.OBJ_SECTION=5;IDREGlb.OBJ_ENABLED=1;IDREGlb.OBJ_VISIBLE=2;IDREGlb.WEBVALID_NONE=0;IDREGlb.WEBVALID_STRICT=1;IDREGlb.BRWCLS_IENORMAL=0;IDREGlb.BRWCLS_IESTRICT=1;IDREGlb.BRWCLS_FIREFOX=2;IDREGlb.BOOKUM_MM=1;IDREGlb.BOOKUM_INCH=2;IDREGlb.FL_BOOK_PRECOUNT=1048576;IDREGlb.FL_BOOK_HIDEBORD=2097152;IDREGlb.MASTRO_PT_CUSTOM=1;IDREGlb.MASTRO_PT_A3=2;IDREGlb.MASTRO_PT_A4=3;IDREGlb.MASTRO_PT_A5=4;IDREGlb.MASTRO_PT_LETTER=5;IDREGlb.MASTRO_PT_LEGAL=6;IDREGlb.MASTRO_PT_EXECUTIVE=7;IDREGlb.MASTRO_PT_FANFOLD_US=8;IDREGlb.MASTRO_PT_FANFOLD_GER=9;IDREGlb.MASTRO_PT_B5=10;IDREGlb.MASTRO_PT_ENVELOPE10=11;IDREGlb.MASTRO_PT_ENVELOPEDL=12;IDREGlb.MASTRO_PT_ENVELOPEC5=13;IDREGlb.MASTRO_PT_ENVELOPEB5=14;IDREGlb.MASTRO_PT_ENVELOPEMONARCH=15;IDREGlb.MASTRO_PT_ENVELOPEITALY=16;IDREGlb.MASTRO_OR_PORTRAIT=1;IDREGlb.MASTRO_OR_LANDSCAPE=2;IDREGlb.MASTRO_FM_NONE=1;IDREGlb.MASTRO_FM_WIDTH=2;IDREGlb.MASTRO_FM_PAGE=3;IDREGlb.FL_RPTBOX_VISIBLE=65536;IDREGlb.FL_RPTBOX_TOPREVIEW=131072;IDREGlb.FL_RPTBOX_TOPRINT=262144;IDREGlb.FL_RPTBOX_KEEPTOGETHER=524288;IDREGlb.FL_RPTBOX_CLOSEBORDER=1048576;IDREGlb.FL_RPTBOX_OMITZERO=2097152;IDREGlb.FL_RPTBOX_OMITDUPL=4194304;IDREGlb.FL_RPTBOX_CANDRAG=8388608;IDREGlb.FL_RPTBOX_CANDROP=16777216;IDREGlb.FL_RPTBOX_CANTRANS=33554432;IDREGlb.FL_RPTBOX_CANSCROLL=67108864;IDREGlb.BOXVISPROP_RESW=1;IDREGlb.BOXVISPROP_RESH=2;IDREGlb.BOXVISPROP_MOVEX=4;IDREGlb.BOXVISPROP_MOVEY=8;IDREGlb.BOXVISPROP_CANCELMOVE=16;IDREGlb.BOXVISPROP_HYPERLINK=32;IDREGlb.RPTBOX_RECTI_X=0;IDREGlb.RPTBOX_RECTI_Y=1;IDREGlb.RPTBOX_RECTI_WIDTH=2;IDREGlb.RPTBOX_RECTI_HEIGHT=3;IDREGlb.FL_REPORT_HIDEIFEMPTY=65536;IDREGlb.FL_REPORT_VISIBLE=131072;IDREGlb.FL_REPORT_ANYPAGE=262144;IDREGlb.FL_SECT_VISIBLE=65536;IDREGlb.FL_SECT_NEWPGAFTER=131072;IDREGlb.FL_SECT_NEWPGBEFORE=262144;IDREGlb.FL_SECT_KEEPTOGETHER=524288;IDREGlb.FL_SECT_KEEPNEXT=1048576;IDREGlb.FL_SECT_HIDEEMPTY=2097152;IDREGlb.FL_SECT_VERTICAL=4194304;IDREGlb.FL_SECT_SHOWCHILD=8388608;IDREGlb.FL_SECT_OVERLAY=16777216;IDREGlb.FL_SECT_SHOWNEWPAGE=33554432;IDREGlb.FL_SECT_SHOWBOTTOMBOX=67108864;IDREGlb.SECT_REPORTHEADER=1;IDREGlb.SECT_PAGEHEADER=2;IDREGlb.SECT_GROUPHEADER=3;IDREGlb.SECT_DETAIL=4;IDREGlb.SECT_GROUPFOOTER=5;IDREGlb.SECT_PAGEFOOTER=6;IDREGlb.SECT_REPORTFOOTER=7;IDREGlb.PR_SPAN_DOMAIN=IDREGlb.PR_USER;IDREGlb.FL_RPTSPAN_VISIBLE=268435456;IDREGlb.FL_RPTSPAN_ENABLED=536870912;IDREGlb.FL_RPTSPAN_ACTIVE=1073741824;IDREGlb.ClassDT=function(a){switch(a){case IDREGlb.DT_NUM_CURRENCY:case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_FLOAT:case IDREGlb.DT_NUM_INTEGER:return IDREGlb.DTC_NUMBER;case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_DATETIME:return IDREGlb.DTC_DATE;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:return IDREGlb.DTC_CHAR;case IDREGlb.DT_DOC_OLE:return IDREGlb.DTC_DOC;case IDREGlb.DT_UNSPEC:return IDREGlb.DTC_NONE;case IDREGlb.DT_BOOLEAN:return IDREGlb.DTC_BOOL;case IDREGlb.DT_OBJECT:return IDREGlb.DTC_OBJECT;default:return IDREGlb.DTC_NONE}};IDREGlb.GetADOSize=function(b,a){switch(b){case IDREGlb.DT_NUM_INTEGER:case IDREGlb.DT_NUM_FLOAT:case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:if(a<29){return a}else{return 28}case IDREGlb.DT_DATETIME:case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:return a;case IDREGlb.DT_DOC_TEXT:case IDREGlb.DT_DOC_OLE:return IDREGlb.INT_MAX;default:return 0}};IDREGlb.GetOLEType=function(a){switch(a){case IDREGlb.DT_NUM_INTEGER:case IDREGlb.DT_BOOLEAN:return IDVariant.INTEGER;case IDREGlb.DT_NUM_FLOAT:return IDVariant.FLOAT;case IDREGlb.DT_NUM_FIXED:case IDREGlb.DT_NUM_CURRENCY:return IDVariant.DECIMAL;case IDREGlb.DT_DATE:case IDREGlb.DT_TIME:case IDREGlb.DT_DATETIME:return IDVariant.DATETIME;case IDREGlb.DT_CHAR:case IDREGlb.DT_CHAR_FIXED:case IDREGlb.DT_DOC_TEXT:return IDVariant.STRING;default:return IDVariant.NULL}};IDREGlb.SetArraySize=function(c,a){if(a==c.Count()){return}if(a<c.Count()){for(var b=c.Count();b>a;b--){c.RemoveAt(c.Count()-1)}}else{for(var b=c.Count();b<a;b++){c.Add(null)}}};function MyBoolean(a){this.Value=false;if(a!=undefined){this.Value=a}}MyBoolean.prototype.set=function(a){this.Value=a};MyBoolean.prototype.get=function(){return this.Value};function MyFont(d,b,a){this.Name="";this.Bold=false;this.Italic=false;this.Underline=false;this.StrikeOut=false;this.EmbedFont=false;this.UnicoFont=false;this.Size=0;this.Ascent=0;this.Height=0;this.LineGap=0;this.LetterSpacing=-1;this.WordSpacing=-1;this.HorizontalScale=-1;this.FontS=null;this.Name=d.substr(0,d.indexOf(","));d=d.substr(d.indexOf(",")+1);var c=d.substr(0,d.indexOf(","));this.EmbedFont=b;this.UnicoFont=a;this.Bold=c.indexOf("B")!=-1;this.Italic=c.indexOf("I")!=-1;this.Underline=c.indexOf("U")!=-1;this.StrikeOut=c.indexOf("S")!=-1;d=d.substr(d.indexOf(",")+1);this.Size=parseFloat(d);if(isNaN(this.Size)){WriteToConsoleError("[MyFont::<Init>] NumberFormatException: "+this.Size)}this.FontS=PdfFont.getFont(this.Name,this.Bold,this.Italic);this.FontS.iIsUnicode=this.UnicoFont;this.Ascent=this.FontS.getAscent()*this.Size;this.LineGap=(-this.FontS.getDescent())*this.Size+this.FontS.getLeading()*this.Size;this.Height=this.Ascent+this.LineGap}MyFont.prototype.ServletFont=function(){return this.FontS};MyFont.prototype.GetCharacterPlacement=function(f,e,d,c,b){d.Clear();if(this.FontS!=null){for(var a=0;a<e;a++){var g=this.FontS.GetCharWidth(f.charCodeAt(a))/1000*this.Size;if(a>0){g+=this.FontS.GetKerning(f.charCodeAt(a-1),f.charCodeAt(a))*this.Size}if(this.HorizontalScale!=0&&this.HorizontalScale!=100){g=(g*this.HorizontalScale/100)+0}if(this.LetterSpacing!=0){g+=(this.LetterSpacing+0)/100}if(this.WordSpacing!=0&&f.charAt(a)==" "){g+=(this.WordSpacing+0)/100}if(b!=null&&b instanceof CPEHTML&&b.Parent.HtmlFontHStretch!=0){g*=(1+(b.Parent.HtmlFontHStretch+0)/100)}d.Add(b.FromPointsToPhysical(g))}return}};MyFont.prototype.GetStringWidth=function(d,c,b){var f=0;if(this.FontS!=null){for(var a=0;a<d.length;a++){var e=this.FontS.GetCharWidth(d.charCodeAt(a))/1000*this.Size;if(a>0){e+=this.FontS.GetKerning(d.charCodeAt(a-1),d.charCodeAt(a))*this.Size}if(this.HorizontalScale!=0&&this.HorizontalScale!=100){e=(e*this.HorizontalScale/100)+0}if(this.LetterSpacing!=0){e+=(this.LetterSpacing+0)/100}if(this.WordSpacing!=0&&d.charAt(a)==" "){e+=(this.WordSpacing+0)/100}f+=b.FromPointsToPhysical(e)}}return f};MyFont.prototype.Reset=function(){if(this.FontS!=null){this.FontS.Reset()}};MyFont.prototype.ToString=function(){var a="";a+="Name = "+this.Name+",";a+=this.Bold?"B":"";a+=this.Italic?"I":"";a+=", "+this.Size;a+="\nHeight = "+this.Height;a+="\nAscent = "+this.Ascent;a+="\nLineGap = "+this.LineGap;a+="\nEMBED = "+this.EmbedFont;a+="\nUNICODE = "+this.UnicoFont;if(this.FontS!=null){a+="\nServlet";a+="   FontName = "+this.FontS.FontName;a+="   FontPath = "+this.FontS.FontPath;a+="   FamilyName = "+this.FontS.FamilyName;a+="   FullName = "+this.FontS.FullName;a+="   IsBold = "+this.FontS.IsBold;a+="   IsItalic = "+this.FontS.IsItalic}return a};function MyImage(){this.Image2=null}MyImage.prototype.Empty=function(){this.Image2=null};MyImage.prototype.IsEmpty=function(){return(this.Image2==null)};MyImage.prototype.set_Image=function(a){this.Image2=a};MyImage.prototype.set_ServletImage=function(d){if(d instanceof Uint8Array){try{var b=d;this.Image2=PdfDocument.AddImage(b,b.length);this.Image1=null}catch(c){WriteToConsoleError("[MyImage::set_ServletImage] Exception: "+c.message)}}else{var a=d;this.Image2=a}};MyImage.prototype.ServletImage=function(){return this.Image2};MyImage.prototype.width=function(){if(this.Image2!=null){return this.Image2.Width}return 0};MyImage.prototype.height=function(){if(this.Image2!=null){return this.Image2.Height}return 0};MyImage.prototype.LoadServletImage=function(d){try{var g=null;if(RD4_WebEntryPoint.ShellObject.IsInsideShell()){if(d.startsWith("$SHELL")){d=d.substring(6)}if(d[0]=="/"){d=d.substring(1)}var b=new XMLHttpRequest();b.open("GET",RD4_WebEntryPoint.GetAppUrl(false)+d,false);b.responseType="arraybuffer";b.send();g=new Uint8Array(b.response)}else{d=d.substring(d.indexOf(",")+1);var a=atob(d);g=new Uint8Array(a.length);for(var c=0;c<a.length;c++){g[c]=a.charCodeAt(c)}}this.Image2=PdfDocument.AddImage(g,g.length);if(this.Image2==null){WriteToConsoleError("[MyImage::LoadServletImage] Image "+d+" not loaded")}this.Image1=null;return this.Image2}catch(f){WriteToConsoleError("[MyImage::LoadServletImage] Image "+d+" Exception: "+f);return null}};function PSectionState(){this.Flags=0;this.DSECurrentPosition=-1;this.SectionID=-1;this.PageNum=-1;this.GH_DSECurrentPosition=-1;this.GH_PageNum=-1}PSectionState.prototype.GetFlag=function(a){return(this.Flags&a)!=0};PSectionState.prototype.SetFlag=function(b,a){if(a){this.Flags|=b}else{this.Flags&=~b}};function VisAttrListIDRE(){this.ISVSlist=null;this.CachedFonts=null;this.CachedFonts2=null;this.Parent=null;PdfFont.scanFontDirectory()}VisAttrListIDRE.prototype.set_VisualStyleList=function(d){this.ISVSlist=d;this.CachedFonts=new Array(d.Size());for(var b=0;b<d.Size();b++){this.CachedFonts[b]=new Array(VisAttrObjSrv.MAX_FONTS+1);for(var a=0;a<this.CachedFonts[b].length;a++){this.CachedFonts[b][a]=new HashTableSrv()}}this.CachedFonts2=new Array(d.Size());for(var c=0;c<d.Size();c++){this.CachedFonts2[c]=new Array(VisAttrObjSrv.MAX_FONTS+1);for(var a=0;a<this.CachedFonts2[c].length;a++){this.CachedFonts2[c][a]=new HashTableSrv()}}};VisAttrListIDRE.prototype.Size=function(){if(this.ISVSlist!=null){return this.ISVSlist.Size()}return 0};VisAttrListIDRE.prototype.set_Size=function(a){if(this.ISVSlist!=null){this.ISVSlist.set_Size(a)}};VisAttrListIDRE.prototype.VisualAttribute=function(a){if(this.ISVSlist!=null){return this.ISVSlist.VisualAttribute(a)}return null};VisAttrListIDRE.prototype.set_VisualAttribute=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_VisualAttribute(a,b)}};VisAttrListIDRE.prototype.Derived=function(a){if(this.ISVSlist!=null){return this.ISVSlist.Derived(a)}return null};VisAttrListIDRE.prototype.set_Derived=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_Derived(a,b)}};VisAttrListIDRE.prototype.Alignment=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.Alignment(a,b)}return 0};VisAttrListIDRE.prototype.set_Alignment=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_Alignment(a,c,b)}};VisAttrListIDRE.prototype.ControlType=function(a){if(this.ISVSlist!=null){return this.ISVSlist.ControlType(a)}return 0};VisAttrListIDRE.prototype.set_ControlType=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_ControlType(a,b)}};VisAttrListIDRE.prototype.Mask=function(a){if(this.ISVSlist!=null){return this.ISVSlist.Mask(a)}return null};VisAttrListIDRE.prototype.set_Mask=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_Mask(a,b)}};VisAttrListIDRE.prototype.RowOffset=function(a){if(this.ISVSlist!=null){return this.ISVSlist.RowOffset(a)}return 0};VisAttrListIDRE.prototype.set_RowOffset=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_RowOffset(a,b)}};VisAttrListIDRE.prototype.BorderType=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.BorderType(a,b)}return 0};VisAttrListIDRE.prototype.set_BorderType=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_BorderType(a,c,b)}};VisAttrListIDRE.prototype.Color=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.Color(a,b)}return 0};VisAttrListIDRE.prototype.set_Color=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_Color(a,c,b)}};VisAttrListIDRE.prototype.GradCol=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.GradCol(a,b)}return 0};VisAttrListIDRE.prototype.set_GradCol=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_GradCol(a,c,b)}};VisAttrListIDRE.prototype.GradDir=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.GradDir(a,b)}return 0};VisAttrListIDRE.prototype.set_GradDir=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_GradDir(a,c,b)}};VisAttrListIDRE.prototype.Opacity=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.Opacity(a,b)}return 0};VisAttrListIDRE.prototype.set_Opacity=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_Opacity(a,c,b)}};VisAttrListIDRE.prototype.Font=function(k,b,e,d){if(e==undefined){e=""}if(d==undefined){d=1}var h=null;if(d==2){h=this.CachedFonts2}else{h=this.CachedFonts}var j=this.ISVSlist.Font(k,b);if(e.length!=0){var f=j.split(",");f[1]=e;j=f.join(",")}if(h[k][b][j]!=null){return h[k][b][j]}if(this.ISVSlist!=null){var c=((this.ISVSlist.Flags(k)&IDREGlb.FL_VIS_EMBEDFONT)!=0);var a=((this.ISVSlist.Flags(k)&IDREGlb.FL_VIS_UNICODE)!=0);var g=new MyFont(j,c,a);g.LetterSpacing=this.ISVSlist.LetterSpacing(k);g.HorizontalScale=this.ISVSlist.HorizontalScale(k);g.WordSpacing=this.ISVSlist.WordSpacing(k);h[k][b][j]=g;return g}return null};VisAttrListIDRE.prototype.set_Font=function(a,c,b){if(this.ISVSlist!=null&&typeof(b)=="string"){this.ISVSlist.set_Font(a,c,b);this.CachedFonts[a][c][b]=null}};VisAttrListIDRE.prototype.Flags=function(a){if(this.ISVSlist!=null){return this.ISVSlist.Flags(a)}return 0};VisAttrListIDRE.prototype.set_Flags=function(a,b){if(this.ISVSlist!=null){this.ISVSlist.set_Flags(a,b)}};VisAttrListIDRE.prototype.CBorColor=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.CBorColor(a,b)}return 0};VisAttrListIDRE.prototype.set_CBorColor=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_CBorColor(a,c,b)}};VisAttrListIDRE.prototype.CBorWidth=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.CBorWidth(a,b)}return 0};VisAttrListIDRE.prototype.set_CBorWidth=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_CBorWidth(a,c,b)}};VisAttrListIDRE.prototype.CBorPadding=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.CBorPadding(a,b)}return 0};VisAttrListIDRE.prototype.set_CBorPadding=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_CBorPadding(a,c,b)}};VisAttrListIDRE.prototype.CBorType=function(a,b){if(this.ISVSlist!=null){return this.ISVSlist.CBorType(a,b)}return 0};VisAttrListIDRE.prototype.set_CBorType=function(a,c,b){if(this.ISVSlist!=null){this.ISVSlist.set_CBorType(a,c,b)}};VisAttrListIDRE.prototype.ApplyMask=function(e,c,d,b){if(this.ISVSlist!=null){var a=this.ISVSlist.Mask(e);if(a==null||a.length==0){return false}if(!a.equals("=")){d.set(IDL.Format(c,new IDVariant(a),b))}else{d.set(c)}return true}return false};VisAttrListIDRE.prototype.GetPaddings=function(p,q,d,m,r,e,b){if(e==undefined){e=-1}if(b==undefined){b=null}var c=this.BorderType(p,IDREGlb.VISBDI_VALUE);var o=0,h=0,a=0,j=0;switch(c){case IDREGlb.VISBRD_NONE:o=0;h=0;a=0;j=0;break;case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:o=12;h=12;a=12;j=12;break;case IDREGlb.VISBRD_HORIZ:o=12;h=0;a=12;j=0;break;case IDREGlb.VISBRD_VERT:o=0;h=12;a=0;j=12;break;case IDREGlb.VISBRD_CUSTOM:o=this.CBorPadding(p,IDREGlb.VISCBOR_TOP);h=this.CBorPadding(p,IDREGlb.VISCBOR_LEFT);a=this.CBorPadding(p,IDREGlb.VISCBOR_BOTTOM);j=this.CBorPadding(p,IDREGlb.VISCBOR_RIGHT);break}if(e!=-1){if(e==IDREGlb.BOOKUM_MM){o=(25.4*100/72/4)*o;h=(25.4*100/72/4)*h;a=(25.4*100/72/4)*a;j=(25.4*100/72/4)*j}else{o=(1000/72/4)*o;h=(1000/72/4)*h;a=(1000/72/4)*a;j=(1000/72/4)*j}}if(b==null||!(b instanceof CPEHTML)){var l=new IDVariant(0);var g=new IDVariant(0);var f=new IDVariant(0);var k=new IDVariant(0);this.GetBorderWidths(p,l,g,f,k,e,b);q.set(new IDVariant(Math.floor(o)+l.intValue()));d.set(new IDVariant(Math.floor(h)+g.intValue()));m.set(new IDVariant(Math.floor(a)+f.intValue()));r.set(new IDVariant(Math.floor(j)+k.intValue()))}};VisAttrListIDRE.prototype.GetBorderWidths=function(o,k,g,e,l,d,b){if(d==undefined){d=-1}if(b==undefined){b=null}var c=this.BorderType(o,IDREGlb.VISBDI_VALUE);var m=0,f=0,a=0,j=0;var h=(b!=null?b.GetBorderSize():1);switch(c){case IDREGlb.VISBRD_NONE:m=0;f=0;a=0;j=0;break;case IDREGlb.VISBRD_FRAME:case IDREGlb.VISBRD_SUNKEN:case IDREGlb.VISBRD_RAISED:case IDREGlb.VISBRD_ETCHED:case IDREGlb.VISBRD_BUMP:m=h;f=h;a=h;j=h;break;case IDREGlb.VISBRD_HORIZ:m=h;f=0;a=h;j=0;break;case IDREGlb.VISBRD_VERT:m=0;f=h;a=0;j=h;break;case IDREGlb.VISBRD_CUSTOM:m=this.CBorWidth(o,IDREGlb.VISCBOR_TOP);f=this.CBorWidth(o,IDREGlb.VISCBOR_LEFT);a=this.CBorWidth(o,IDREGlb.VISCBOR_BOTTOM);j=this.CBorWidth(o,IDREGlb.VISCBOR_RIGHT);break}if(d!=-1){if(d==IDREGlb.BOOKUM_MM){m=(25.4*100/72/4)*m;f=(25.4*100/72/4)*f;a=(25.4*100/72/4)*a;j=(25.4*100/72/4)*j}else{m=(1000/72/4)*m;f=(1000/72/4)*f;a=(1000/72/4)*a;j=(1000/72/4)*j}}k.set(new IDVariant(Math.floor(m)));g.set(new IDVariant(Math.floor(f)));e.set(new IDVariant(Math.floor(a)));l.set(new IDVariant(Math.floor(j)))};VisAttrListIDRE.prototype.ResetFonts=function(e){if(e==undefined){e=1}var f=null;if(e==2){f=this.CachedFonts2}else{f=this.CachedFonts}for(var d=0;d<f.length;d++){for(var b=0;b<f[d].length;b++){var a=f[d][b].values();for(var c=0;c<a.length;c++){if(a[c]!=null){a[c].Reset()}}}}};VisAttrListIDRE.prototype.GetTrueIdx=function(a){if(this.ISVSlist!=null){return this.ISVSlist.GetTrueIdx(a)}else{return 0}};function PdfObject(){this.PosOnFile=-1;this.ID=-1;this.Data=null;this.DataSize=-1;this.Doc=null;this.Dict=null;this.HasStream=false}function Boxer(a){this.IntObj=null;this.set(a)}Boxer.prototype.set=function(a){this.IntObj=a};Boxer.prototype.intValue=function(){return this.IntObj};Boxer.prototype.stringValue=function(){return this.IntObj};Boxer.prototype.arrayValue=function(){return this.IntObj};function MemoryStream(a){this.Data=a;this.Pos=0}MemoryStream.prototype.ReadByte=function(){return this.Data[this.Pos++]};MemoryStream.prototype.Read=function(a,d,c){for(var b=d;b<d+c;b++){a[b-d]=this.Data[b]}this.Pos+=c};MemoryStream.prototype.Seek=function(a){this.Pos+=a};PdfObject.ENC_NONE=0;PdfObject.ENC_HEX=1;PdfObject.ENC_A85=2;PdfObject.ENC_FLATE=3;PdfObject.DEFAULT_ENCODING=PdfObject.ENC_A85;PdfObject.GetNUINT=function(d,e,a){if(a==undefined){a=false}var c=0;if(!a){for(var b=0;b<e;b++){c|=d.ReadByte()<<(b*8)}}else{for(var b=0;b<e;b++){c=(c<<8)+d.ReadByte()}}return c};PdfObject.GetUINT=function(b,a){return PdfObject.GetNUINT(b,4,a)};PdfObject.GetSHORT=function(c,a){var b=PdfObject.GetNUINT(c,2,a);if(b>32767){b-=65536}return b};PdfObject.GetUNICODEString=function(c,d){var e="";for(var a=0;a<d/2;a++){var b=((c.ReadByte()<<8)|(c.ReadByte()&255));e+=b}return e};PdfObject.GetString=function(d,e){var a=new Uint8Array(e);for(var c=0;c<e;c++){a[c]=d.ReadByte()}return String.fromCharCode.apply(null,a)};PdfObject.prototype.FormatObject=function(){if(this.HasStream&&this.DataSize>110){this.Encode(PdfObject.DEFAULT_ENCODING)}if(this.Dict!=null){this.Dict.FormatObject()}};PdfObject.prototype.WriteData=function(a){if(this.HasStream){a.data+=PdfDocument.CR;a.data+="stream";a.data+=PdfDocument.CR}if(this.DataSize>0){for(var b=0;b<this.DataSize;b++){a.data+=String.fromCharCode(this.Data[b])}}if(this.HasStream){a.data+=PdfDocument.CR;a.data+="endstream"}};PdfObject.prototype.Save=function(b){try{this.PosOnFile=b.data.length;var a=this.ID+" 0 obj"+PdfDocument.CR;b.data+=a;if(this.Dict!=null){this.Dict.WriteData(b)}this.WriteData(b);a=PdfDocument.CR+"endobj"+PdfDocument.CR;b.data+=a}catch(c){}};PdfObject.prototype.CopyFrom=function(b){this.ID=b.ID;this.PosOnFile=b.PosOnFile;this.DataSize=b.DataSize;this.Data=new Uint8Array(this.DataSize);for(var a=0;a<this.DataSize;a++){this.Data[a]=b.Data[a]}};PdfObject.prototype.GetIndirectRef=function(){return(this.ID+" 0 R")};PdfObject.Src=new Array("\\","\n","\r","\t","\b","\f","(",")");PdfObject.Rep=new Array("\\\\","\\n","\\r","\\t","\\b","\\f","\\(","\\)");PdfObject.AdaptString=function(e){var f=e;for(var a=0;a<PdfObject.Src.length;a++){var d=PdfObject.Src[a];var b=PdfObject.Rep[a];var c=0;while(true){c=f.indexOf(d,c);if(c==-1){break}else{f=f.substring(0,c)+b+f.substring(c+d.length);c=c-d.length+b.length+1}}}return f};PdfObject.prototype.Encode=function(c){if(this.DataSize==0){WriteToConsoleError("[PdfObject::Encode] DataSize = 0!");return}if(c==PdfObject.ENC_FLATE){WriteToConsoleError("[PdfObject::Encode] DEFLATE not available. Using ASCII85 instead of FLATE for encoding.");c=PdfObject.ENC_A85}var e="";switch(c){case PdfObject.ENC_NONE:return;case PdfObject.ENC_HEX:e="/ASCIIHexDecode";break;case PdfObject.ENC_A85:e="/ASCII85Decode";break;case PdfObject.ENC_FLATE:e="/FlateDecode";break;default:WriteToConsoleError("[PdfObject::Encode] Unhandled encoding type (= "+c+")");return}if(this.Dict==null){this.Dict=new PdfDictionary();this.Dict.Doc=this.Doc}var b=this.Dict.Get("/Filter");if(b==null){var a=new PdfArray();a.Doc=this.Doc;b=this.Dict.Add("/Filter",a)}else{var a=b.Value;if(a.Get(e)!=null){return}}b.Value.Add(e,false,true);var d=new Boxer(this.Data);var f=new Boxer(this.DataSize);switch(c){case PdfObject.ENC_HEX:PdfObject.EncodeHex(d,f);break;case PdfObject.ENC_A85:PdfObject.EncodeA85(d,f);break;case PdfObject.ENC_FLATE:PdfObject.EncodeFlate(d,f);break}this.Data=d.arrayValue();this.DataSize=f.intValue();b=this.Dict.Get("/Length");b.Value=this.DataSize};PdfObject.EncodeHex=function(f,a){var c=f.arrayValue();var d=a.intValue();var m=new Uint8Array(d*2+PdfDocument.CR_LEN*d/40+10);var o=0;for(var g=0;g<d;g++){var k=c[g]>>4;var b=c[g]&15;m[o++]=(k>9?k-10+65:k+48);m[o++]=(b>9?b-10+65:b+48);if((g+1)%40==0){for(var e=0;e<PdfDocument.CR_LEN;e++){m[o++]=PdfDocument.CR.charCodeAt(e)}}}m[o++]=62;f.set(m);a.set(o)};PdfObject.EncodeA85=function(h,a){var d=h.arrayValue();var f=a.intValue();var m=new Uint8Array(Math.floor(f*5/4+2*f/100+10));var p=0;var b;var k=0;for(k=0;k+4<=f;k+=4){b=(d[k]<<24)+(d[k+1]<<16)+(d[k+2]<<8)+d[k+3];if(b<0){b+=4294967296}if(b==0){m[p++]=122;continue}var o=new Uint8Array(5);for(var e=4;e>=0;e--){o[e]=(b%85+33);b=b/85}for(var g=0;g<5;g++){m[p++]=o[g]}if((k+4)%100==0){for(var g=0;g<PdfDocument.CR_LEN;g++){m[p++]=PdfDocument.CR.charCodeAt(g)}}}if(k<f){var c=f-k;b=0;for(var l=24;l>=0;l-=8){b|=d[k]<<l;if(++k>=f){break}}if(b<0){b+=4294967296}var o=new Uint8Array(5);for(var e=4;e>=0;e--){o[e]=(b%85+33);b=b/85}for(var g=0;g<c+1;g++){m[p++]=o[g]}}m[p++]=126;m[p++]=62;h.set(m);a.set(p)};PdfObject.EncodeFlate=function(b,a){};function PdfArray(){PdfObject.call(this);this.ObjArray=new ArrayList()}PdfArray.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfArray[obj]=PdfObject[obj]}PdfArray.prototype.FormatObject=function(){try{this.Data=null;var a={data:""};a.data="[ ";for(var b=0;b<this.ObjArray.Count();b++){if(b>0){a.data+=" "}var d=this.ObjArray[b];d.WriteData(a)}a.data+=" ]";this.DataSize=a.data.length;this.Data=new Uint8Array(a.data.length);for(var b=0;b<a.data.length;b++){this.Data[b]=a.data.charCodeAt(b)}a=null}catch(c){}PdfObject.prototype.FormatObject.call(this)};PdfArray.prototype.RemoveAll=function(){this.ObjArray.Clear();this.ObjArray=null};PdfArray.prototype.Add=function(m,l,k,j){if(m instanceof Uint8Array){var g=m;var e=l;var f=new PdfCollectionElem();f.SetData(g,e);this.ObjArray.Add(f);return f}var g=m;var c;var h;var b;if(g instanceof PdfObject){c=l;h=k;b=j;if(c==undefined){c=false}if(h==undefined){h=true}if(b==undefined){b=false}}else{h=l;b=k;if(h==undefined){h=true}if(b==undefined){b=false}}if(h){for(var d=0;d<this.ObjArray.Count();d++){var a=this.ObjArray[d];if(g instanceof PdfObject){if(c){if(a.Type==PdfCollectionElem.VAL_STRING&&a.Value==g.GetIndirectRef()){return a}}else{if(a.Type==PdfCollectionElem.VAL_PDFOBJ&&a.Value==g){return a}}}else{if(typeof(g)=="number"&&a.Type==(PdfCollectionElem.VAL_INT||a.Type==PdfCollectionElem.VAL_FLOAT)&&a.Value==g){return a}if(typeof(g)=="string"&&a.Type==PdfCollectionElem.VAL_STRING&&a.Value==g){return a}}}}var f=new PdfCollectionElem();if(g instanceof PdfObject){if(c){f.SetData(g.GetIndirectRef())}else{f.SetData(g)}}else{f.SetData(g)}if(b){this.ObjArray.splice(0,0,f)}else{this.ObjArray.Add(f)}return f};PdfArray.prototype.Get=function(a){for(var b=0;b<this.ObjArray.Count();b++){var c=this.ObjArray[b];if(c.Type==PdfCollectionElem.VAL_STRING&&c.Value==a){return c}}return null};function PdfCollectionElem(){this.Type=0;this.Value=null;this.ValueLen=-1}PdfCollectionElem.VAL_NULL=0;PdfCollectionElem.VAL_INT=1;PdfCollectionElem.VAL_FLOAT=2;PdfCollectionElem.VAL_STRING=3;PdfCollectionElem.VAL_PDFOBJ=4;PdfCollectionElem.VAL_BYTEBUFF=5;PdfCollectionElem.prototype.SetData=function(b,a){if(typeof(b)=="number"){if((b+"").indexOf(".")==-1){this.Type=PdfCollectionElem.VAL_INT}else{this.Type=PdfCollectionElem.VAL_FLOAT}this.Value=b}else{if(typeof(b)=="string"){this.Type=PdfCollectionElem.VAL_STRING;this.Value=b}else{if(b instanceof PdfObject){this.Type=PdfCollectionElem.VAL_PDFOBJ;this.Value=b}else{if(b instanceof Uint8Array){this.Type=PdfCollectionElem.VAL_BYTEBUFF;this.ValueLen=a;this.Value=b}else{if(b instanceof PdfCollectionElem){this.Type=b.Type;this.Value=b.Value;this.ValueLen=b.ValueLen;b.Value=null}}}}}};PdfCollectionElem.prototype.WriteData=function(a){var b="";switch(this.Type){case PdfCollectionElem.VAL_NULL:return;case PdfCollectionElem.VAL_INT:b=this.Value.toString();break;case PdfCollectionElem.VAL_FLOAT:b=this.Value.toFixed(2);break;case PdfCollectionElem.VAL_STRING:b=this.Value;break;case PdfCollectionElem.VAL_PDFOBJ:this.Value.FormatObject();a.data+=String.fromCharCode.apply(null,this.Value.Data);return;case PdfCollectionElem.VAL_BYTEBUFF:a.data+=String.fromCharCode.apply(null,this.Value);return}a.data+=b};PdfCollectionElem.prototype.ChangeToArray=function(){var c=this.Type;var b=this.Value;var a=this.ValueLen;if(c!=PdfCollectionElem.VAL_PDFOBJ&&c!=PdfCollectionElem.VAL_STRING){this.Value=null}var d=new PdfArray();this.SetData(d);if(c==PdfCollectionElem.VAL_BYTEBUFF){d.Add(b,a)}else{d.Add(b)}return d};PdfCollectionElem.prototype.intValue=function(){if(this.Type!=PdfCollectionElem.VAL_INT){WriteToConsoleError("[PdfCollectionElem::intValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.floatValue=function(){if(this.Type!=PdfCollectionElem.VAL_FLOAT){WriteToConsoleError("[PdfCollectionElem::floatValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.stringValue=function(){if(this.Type!=PdfCollectionElem.VAL_STRING){WriteToConsoleError("[PdfCollectionElem::stringValue] wrong type ("+this.Type+")")}return this.Value};PdfCollectionElem.prototype.pdfObjectValue=function(){if(this.Type!=PdfCollectionElem.VAL_PDFOBJ){WriteToConsoleError("[PdfCollectionElem::pdfObjectValue] wrong type ("+this.Type+")")}return this.Value};function PdfDictionary(){PdfObject.call(this);this.Dictionary=new HashTableSrv()}PdfDictionary.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfDictionary[obj]=PdfObject[obj]}PdfDictionary.prototype.FormatObject=function(){try{var f;this.Data=null;var b={data:""};b.data="<< ";var g=this.Dictionary.keys();for(var c=0;c<g.length;c++){var a=g[c];var d=this.Dictionary[a];b.data+=a+" ";d.WriteData(b);b.data+=PdfDocument.CR}b.data+=">>";this.DataSize=b.data.length;this.Data=new Uint8Array(b.data.length);for(var c=0;c<b.data.length;c++){this.Data[c]=b.data.charCodeAt(c)}b=null}catch(h){}PdfObject.prototype.FormatObject.call(this)};PdfDictionary.prototype.RemoveAll=function(){this.Dictionary.clear()};PdfDictionary.prototype.Add=function(d,c,b,a){if(typeof(d)=="string"){var k;var u;var o;var p;if(c instanceof PdfObject){k=d;u=c;p=b;o=a;if(p==undefined){p=false}}else{k=d;u=c;o=b}if(o==undefined){o=true}var f=this.Get(k);if(o){if(u instanceof PdfObject){if(p){if(f!=null&&f.Type==PdfCollectionElem.VAL_STRING&&f.Value==u.GetIndirectRef()){return f}}else{if(f!=null&&f.Type==PdfCollectionElem.VAL_PDFOBJ&&f.Value==u){return f}}}else{if(typeof(u)=="number"&&f!=null&&f.Type==(PdfCollectionElem.VAL_INT||PdfCollectionElem.VAL_FLOAT)&&f.Value==u){return f}if(typeof(u)=="string"&&f!=null&&f.Type==PdfCollectionElem.VAL_STRING&&f.Value==u){return f}}}if(f==null){f=new PdfCollectionElem();if(u instanceof PdfObject&&p){f.SetData(u.GetIndirectRef())}else{f.SetData(u)}this.Dictionary[k]=f}else{if(u instanceof PdfObject){if(f.Value instanceof PdfArray){if(p){f.Value.Add(u.GetIndirectRef(),o)}else{f.Value.Add(u,o)}}else{if(f.Value instanceof PdfDictionary){f.Value.Add(k,u,p,o)}else{var l=f.ChangeToArray();l.Add(u)}}}else{var l=f.ChangeToArray();l.Add(u)}}return f}else{if(d instanceof PdfDictionary){var g=d;var v=c;var m=g.Dictionary.keys();for(var r=0;r<m.length;r++){var k=m[r];var f=g.Dictionary[k];switch(f.Type){case PdfCollectionElem.VAL_INT:case PdfCollectionElem.VAL_FLOAT:case PdfCollectionElem.VAL_STRING:this.Add(k,f.Value);break;case PdfCollectionElem.VAL_PDFOBJ:if(v){this.Add(k,f.pdfObjectValue());f.Type=PdfCollectionElem.VAL_NULL;f.Value=null}else{var h=f.pdfObjectValue();if(h instanceof PdfArray){var s=new PdfArray();this.Add(k,s);for(var q=0;q<h.ObjArray.Count();q++){var t=h.ObjArray[q];if(t.Type==PdfCollectionElem.VAL_INT){s.Add(t.intValue(),false)}else{if(t.Type==PdfCollectionElem.VAL_FLOAT){s.Add(t.floatValue(),false)}else{if(t.Type==PdfCollectionElem.VAL_STRING){s.Add(t.stringValue(),false)}else{WriteToConsoleError("[PdfDictionary::Add] Can't add a PdfObject contained in an array")}}}}}else{WriteToConsoleError("[PdfDictionary::Add] Don't know how to move a PdfObject between two dictionaries")}}break}}if(v){g.RemoveAll()}}}};PdfDictionary.prototype.Get=function(a){return this.Dictionary[a]};function CDblSize(d,c){this.cx=d;this.cy=c}function PdfDocument(){this.Version=1.3;this.LastXREFPos=-1;this.CurrPage=null;this.CurrFont=null;this.CurrFontHeight=-1;this.CurrGraphState=null;this.LastID=0;this.DocOutlines=null;this.LastOutlineObj=null;this.Children=new ArrayList();this.AddedImages=new HashTableSrv();this.ExtGRStates=new ArrayList();this.DocCatalog=new PdfDictionary();this.AddChild(this.DocCatalog);this.DocPages=new PdfDictionary();this.AddChild(this.DocPages);this.DocPages.Add("/Type","/Pages");var a=new PdfArray();a.Doc=this;this.DocPages.Add("/Kids",a);this.DocPages.Add("/Count",0);this.DocCatalog.Add("/Type","/Catalog");this.DocCatalog.Add("/Pages",this.DocPages,true);this.DocCatalog.Add("/PageMode","/UseNone");this.DocInfo=new PdfDictionary();this.AddChild(this.DocInfo);this.Trailer=new PdfDictionary();this.Trailer.Add("/Info",this.DocInfo,true)}PdfDocument.PAGE_LETTER=new CDblSize(612,792);PdfDocument.PAGE_LEGAL=new CDblSize(612,1008);PdfDocument.PAGE_A0=new CDblSize(2380,3368);PdfDocument.PAGE_A1=new CDblSize(1684,2380);PdfDocument.PAGE_A2=new CDblSize(1190,1684);PdfDocument.PAGE_A3=new CDblSize(842,1190);PdfDocument.PAGE_A4=new CDblSize(595,842);PdfDocument.PAGE_A5=new CDblSize(421,595);PdfDocument.PAGE_B0=new CDblSize(2836,4008);PdfDocument.PAGE_B1=new CDblSize(2004,2836);PdfDocument.PAGE_B2=new CDblSize(1418,2004);PdfDocument.PAGE_B3=new CDblSize(1002,1418);PdfDocument.PAGE_B4=new CDblSize(709,1002);PdfDocument.PAGE_B5=new CDblSize(501,709);PdfDocument.PAGE_11X17=new CDblSize(792,1224);PdfDocument.LANDSCAPE=function(b){var a=b.cx;b.cx=b.cy;b.cy=a;return b};PdfDocument.VP_HIDETOOLBAR="/HideToolbar";PdfDocument.VP_HIDEMENUBAR="/HideMenubar";PdfDocument.VP_FITWINDOW="/FitWindow";PdfDocument.VP_CENTERWINDOW="/CenterWindow";PdfDocument.DI_TITLE="/Title";PdfDocument.DI_AUTHOR="/Author";PdfDocument.DI_SUBJECT="/Subject";PdfDocument.DI_KEYWORDS="/Keywords";PdfDocument.DI_PRODUCER="/Producer";PdfDocument.CR="\n";PdfDocument.CR_LEN=PdfDocument.CR.length;PdfDocument.prototype.AddChild=function(a){a.ID=++this.LastID;a.Doc=this;this.Children.Add(a)};PdfDocument.prototype.GetObjectByID=function(a){for(var b=0;b<this.Children.Count();b++){var c=this.Children[b];if(c.ID==a){return c}}return null};PdfDocument.prototype.Save=function(c,g){var p=new Date();var q=IDL.FormatDate(new Date(),"'D:'yyyymmddhhnnss");var b=p.getTimezoneOffset()*60*1000;if(p.dstOffset()){b-=3600000}var l=Math.round(Math.abs(b/1000)/3600);var f=Math.round(Math.abs(b/1000)%3600);var a=(b>0?"+":"-")+(l<=9?"0":"")+l+"'"+(f<=9?"0":"")+f;this.DocInfo.Add("/CreationDate","("+q+a+")");if(this.DocOutlines!=null&&this.LastOutlineObj!=null){this.DocOutlines.Add("/Last",this.LastOutlineObj,true)}try{for(var k=0;k<this.Children.Count();k++){var j=this.Children[k];j.FormatObject()}this.WriteHeader(g);for(var k=0;k<this.Children.Count();k++){var j=this.Children[k];j.Save(g)}this.WriteXref(g);this.WriteTrailer(g);return 0}catch(o){WriteToConsoleError("[PdfDocument::Save] Error: "+o);return 2}};PdfDocument.prototype.WriteHeader=function(a){var b="%PDF-"+this.Version.toFixed(1)+PdfDocument.CR;a.data+=b;a.data+="%";a.data+=String.fromCharCode(226);a.data+=String.fromCharCode(227);a.data+=String.fromCharCode(207);a.data+=String.fromCharCode(211);a.data+=PdfDocument.CR};PdfDocument.prototype.WriteXref=function(a){this.LastXREFPos=a.data.length;var d="xref"+PdfDocument.CR;a.data+=d;d="0 "+(this.LastID+1)+PdfDocument.CR;a.data+=d;d="0000000000 65536 f\r\n";a.data+=d;for(var c=0;c<this.Children.Count();c++){var e=this.Children[c];d=e.PosOnFile.toString();for(var b=d.length;b<10;b++){d="0"+d}d+=" 00000 n\r\n";a.data+=d}};PdfDocument.prototype.WriteTrailer=function(a){this.Trailer.Add("/Size",this.LastID+1);this.Trailer.Add("/Root",this.DocCatalog.GetIndirectRef());var b="trailer"+PdfDocument.CR;a.data+=b;this.Trailer.FormatObject();a.data+=String.fromCharCode.apply(null,this.Trailer.Data);b=PdfDocument.CR+"startxref"+PdfDocument.CR+this.LastXREFPos+PdfDocument.CR;a.data+=b;b="%%EOF"+PdfDocument.CR;a.data+=b};PdfDocument.prototype.SetPreference=function(c,a){if(a==undefined){a=true}var d=null;var b=this.DocCatalog.Get("/ViewerPreferences");if(b==null){d=new PdfDictionary();d.Doc=this;b=this.DocCatalog.Add("/ViewerPreferences",d)}else{d=b.Value}b=d.Get(c);if(b!=null){b.Value=(a?"true":"false")}else{d.Add(c,(a?"true":"false"))}};PdfDocument.prototype.SetDocumentInfo=function(b,a){a="("+PdfObject.AdaptString(a)+")";var c=this.DocInfo.Get(b);if(c!=null){c.Value=a}else{this.DocInfo.Add(b,a)}};PdfDocument.prototype.AddToResource=function(j,d,h,g,b){if(g==undefined){g=null}if(b==undefined){b=true}var f=null;var e=null;var c=null;var a=j.Get("/Resources");if(a==null){f=new PdfDictionary();f.Doc=this;j.Add("/Resources",f)}else{f=a.Value}a=f.Get(d);if(a==null){if(g!=null){c=new PdfDictionary();c.Doc=this;f.Add(d,c)}else{e=new PdfArray();e.Doc=this;f.Add(d,e)}}else{if(g!=null){c=a.Value}else{e=a.Value}}if(g!=null){c.Add(h,g,b)}else{e.Add(h)}return f};PdfDocument.prototype.AddPage=function(d,c){if(d instanceof CDblSize){var b=d;d=b.cx;c=b.cy}this.CurrPage=new PdfDictionary();this.AddChild(this.CurrPage);this.CurrPage.Add("/Type","/Page");this.CurrPage.Add("/Parent",this.DocPages,true);var f=new PdfArray();f.Doc=this;f.Add(0,false);f.Add(0,false);f.Add(d,false);f.Add(c,false);this.CurrPage.Add("/MediaBox",f);var a=this.DocPages.Get("/Kids");var e=this.DocPages.Get("/Count");e.Value=e.Value+1;a.Value.Add(this.CurrPage,true);this.CurrGraphState=null;return this.CurrPage.ID};PdfDocument.prototype.AddFont=function(e,c){if(typeof(e)=="string"){if(c==undefined){var b=this.GetFont(e);if(b!=null){this.CurrFont=b}else{var a=new PdfFont();a.Init(e);a.AddToDoc(this,false);this.CurrFont=a}return this.CurrFont.ID}else{var a=new PdfFont();a.Init(FntPath,c);var b=this.GetFont(a.BaseFont);if(b!=null){this.CurrFont=b}else{a.AddToDoc(this,c);this.CurrFont=a}return this.CurrFont.ID}}else{if(e instanceof PdfFont){var d=e;var b=this.GetFont(d.BaseFont);if(b!=null){this.CurrFont=b}else{d.AddToDoc(this,c);this.CurrFont=d}return this.CurrFont.ID}}};PdfDocument.prototype.GetFont=function(a){for(var c=0;c<this.Children.Count();c++){var b=this.Children[c];if(b instanceof PdfFont&&b.IsSameFont(a)){return b}}return null};PdfDocument.prototype.GetExtGS=function(b){for(var c=0;c<this.ExtGRStates.Count();c++){var e=this.ExtGRStates[c];var d=e.Get("/Type");if(d!=null&&d.Type==PdfCollectionElem.VAL_STRING&&d.stringValue()=="/ExtGState"){d=e.Get("/ca");if(d!=null&&d.Type==PdfCollectionElem.VAL_FLOAT){var a=b;if(d.floatValue()==a){return e}}}}return null};PdfDocument.prototype.NewGraphicState=function(){if(this.CurrPage==null){return null}var b=new PdfGraphics();this.AddChild(b);b.ParentPage=this.CurrPage;var a=null;var c=this.CurrPage.Get("/Contents");if(c==null){a=new PdfArray();a.Doc=this;this.CurrPage.Add("/Contents",a)}else{a=c.Value}a.Add(b,true);this.AddToResource(this.CurrPage,"/ProcSet","/PDF");return b};PdfDocument.prototype.AddImage=function(g,c,b,a,H,E,D){if(typeof(g)=="string"){var d=g;var q=c;var p=b;var r=a;var A=H;var t=E;var z=D;if(r==undefined){r=-1}if(A==undefined){A=-1}if(t==undefined){t=-9999}if(z==undefined){z=null}var C=this.AddedImages[d];if(C==null){var v=null;var j=null;try{if(d.startsWith("$SHELL")){d=d.substring(6)}if(d.length&&d[0]=="/"){d=d.substring(1)}j=new XMLHttpRequest();j.open("GET",RD4_WebEntryPoint.GetAppUrl(false)+d,false);j.responseType="arraybuffer";j.send();if(!j.response){j=new XMLHttpRequest();j.open("GET",RD4_WebEntryPoint.GetAppUrl(false)+"Images/"+d,false);j.responseType="arraybuffer";j.send()}v=new Uint8Array(j.response)}catch(B){WriteToConsoleError("[PdfDocument::AddImage] Exception while adding image "+d);return -1}try{var s=v.length;C=PdfDocument.AddImage(v,s,t);if(C!=null){this.AddedImages[d]=C}else{WriteToConsoleError("  [PdfDocument::AddImage] Image "+d+" not added")}}catch(B){WriteToConsoleError("[PdfDocument::AddImage] Exception while reading image "+d+"\n"+B)}}if(C!=null){return this.AddImage(C,q,p,r,A,z)}else{return -1}}else{if(g instanceof PdfImage){var o=g;var q=c;var p=b;var r=a;var A=H;var z=E;if(z==undefined){z=null}if(o.ID==-1){this.AddChild(o)}var k=null;var f=this.CurrPage.Get("/Contents");if(f==null){k=new PdfArray();k.Doc=this;this.CurrPage.Add("/Contents",k)}else{k=f.Value}if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}k.Add(this.CurrGraphState,true);var G=this.AddToResource(this.CurrPage,"/ProcSet","/PDF");switch(o.ColorSpace){case 1:this.AddToResource(this.CurrPage,"/ProcSet","/ImageB");break;case 4:this.AddToResource(this.CurrPage,"/ProcSet","/ImageC");break;case 3:if(o.Palette!=null){this.AddToResource(this.CurrPage,"/ProcSet","/ImageI")}else{this.AddToResource(this.CurrPage,"/ProcSet","/ImageC")}break}var l="/Image"+o.ID;var u=G.Get("/XObject");if(u!=null){var m=u.Value;m.Add(l,o,true)}else{var F=new PdfDictionary();F.Add(l,o,true);G.Add("/XObject",F)}if(A==-1){A=o.Height/96*72}if(r==-1){r=o.Width/96*72}if(A<0){A=-A;p-=A}this.CurrGraphState.AddImage(q,p,o,r,A,z);return o.ID}}};PdfDocument.AddImage=function(f,c,a){if(a==undefined){a=-9999}var b=null;if(f[0]==71&&f[1]==73&&f[2]==70){b=new Gif()}else{if(f[0]==255&&f[1]==216){b=new Jpeg()}else{if(f[0]==137&&f[1]==80&&f[2]==78&&f[3]==71){}else{if(f[0]==215&&f[1]==205){b=new Wmf()}else{if(f[0]==66&&f[1]==77){b=new Bitmap()}else{if((f[0]==77&&f[1]==77&&f[2]==0&&f[3]==42)||(f[0]=="I"&&f[1]=="I"&&f[2]==42&&f[3]==0)){b=new Tiff()}else{if(f[0]==154&&f[1]==198&&f[0]==205&&f[1]==215){b=new Wmf()}else{return null}}}}}}}if(a!=-9999){b.Param=a}try{b.Init(f,c)}catch(d){WriteToConsoleError(d);b=null}return b};PdfDocument.prototype.AddOutline=function(a){if(this.DocOutlines==null){this.DocOutlines=new PdfDictionary();this.DocOutlines.Add("/Type","/Outlines");this.AddChild(this.DocOutlines);this.DocCatalog.Add("/Outlines",this.DocOutlines,true)}var b=new PdfDictionary();this.AddChild(b);if(this.LastOutlineObj==null){this.DocOutlines.Add("/First",b,true)}else{this.LastOutlineObj.Add("/Next",b,true)}this.LastOutlineObj=b;this.LastOutlineObj.Add("/Title","("+PdfObject.AdaptString(a)+")");this.LastOutlineObj.Add("/Parent",this.DocOutlines,true);this.LastOutlineObj.Add("/Dest","["+this.CurrPage.GetIndirectRef()+" /XYZ null null null]")};PdfDocument.prototype.SetLineWidth=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineWidth(a)};PdfDocument.prototype.SetLineCap=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineCap(a)};PdfDocument.prototype.SetLineJoin=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineJoin(a)};PdfDocument.prototype.SetLineMiterLimit=function(a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineMiterLimit(a)};PdfDocument.prototype.SetLineDashPattern=function(b,a,c){if(a==undefined){a=-1}if(c==undefined){c=-1}if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineDashPattern(b,a,c)};PdfDocument.prototype.SetLineColor=function(d,c,a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetLineColor(d,c,a)};PdfDocument.prototype.SetFillColor=function(d,c,a){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetFillColor(d,c,a)};PdfDocument.prototype.SetFillGradient=function(e,d,c,b,F,D,C,B,A,s){if(C==undefined){var z=e;var h=d;var y=c;var g=b;var q=F;var r=D;this.SetFillGradient(z,h,y,g,q&255,(q>>8)&255,(q>>16)&255,r&255,(r>>8)&255,(r>>16)&255)}else{var z=e;var h=d;var y=c;var g=b;var w=F;var a=D;var l=C;var u=B;var E=A;var k=s;var t=new PdfDictionary();this.AddChild(t);t.Add("/FunctionType",2);var p=new PdfArray();p.Add(0);p.Add(1);t.Add("/Domain",p);var x=new PdfArray();x.Add(w/255,false);x.Add(a/255,false);x.Add(l/255,false);t.Add("/C0",x);var v=new PdfArray();v.Add(u/255,false);v.Add(E/255,false);v.Add(k/255,false);t.Add("/C1",v);t.Add("/N",1);var o=new PdfDictionary();this.AddChild(o);o.Add("/ShadingType",2);o.Add("/ColorSpace","/DeviceRGB");o.Add("/Function",t,true);var j=new PdfArray();j.Add(z,false);j.Add(h,false);j.Add(y,false);j.Add(g,false);o.Add("/Coords",j);var m=new PdfDictionary();this.AddChild(m);m.Add("/Type","/Pattern");m.Add("/PatternType",2);m.Add("/Shading",o,true);if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.SetFillPattern(m);this.CurrGraphState.CurrState.FillColorRGB=(l<<16)|(a<<8)|w;var f="/P"+m.ID;this.AddToResource(this.CurrPage,"/Pattern",f,m)}};PdfDocument.prototype.CloseFillGradient=function(){if(this.CurrGraphState==null){this.CurrGraphState=this.NewGraphicState()}this.CurrGraphState.CloseFillPattern();this.CurrGraphState.CurrState.FillColorRGB=-1};PdfDocument.prototype.SetColor=function(d,c,a){this.SetLineColor(d,c,a);this.SetFillColor(d,c,a)};PdfDocument.prototype.SetTextMode=function(a){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextMode(a)};PdfDocument.prototype.SetTextFont=function(b,a){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextFont(b,a)};PdfDocument.prototype.SetTextPosition=function(a,b){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetTextPosition(a,b)};PdfDocument.prototype.SetRotation=function(c,b,d){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.SetRotation(c,b,d)};PdfDocument.prototype.UndoRotation=function(){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.UndoRotation()};PdfDocument.prototype.AddText=function(h,d,c,p,e,g,m,j,o,f,b,k,a,l){if(d==undefined){d=-1}if(c==undefined){c=-1}if(p==undefined){p=-1}if(e==undefined){e=-1}if(g==undefined){g=-1}if(m==undefined){m=-1}if(j==undefined){j=false}if(o==undefined){o=false}if(f==undefined){f=-1}if(b==undefined){b=100}if(k==undefined){k=0}if(a==undefined){a=0}if(l==undefined){l=100}if(e==-1){e=this.CurrFontHeight}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddText(h,d,c,p,e,g,m,j,o,f,b,k,a,l);this.CurrFontHeight=e};PdfDocument.prototype.AddRectangle=function(b,f,a,e,d,c){if(d==undefined){d=false}if(c==undefined){c=100}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddRectangle(b,f,a,e,d,c)};PdfDocument.prototype.AddBezier=function(c,h,b,g,a,f,j,e,d){if(d==undefined){d=false}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddBezier(c,h,b,g,a,f,j,e,d)};PdfDocument.prototype.AddCircle=function(a,d,c,b){if(b==undefined){b=false}if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddCircle(a,d,c,b)};PdfDocument.prototype.AddLine=function(b,d,a,c){if(this.CurrGraphState==null){this.CurrGraphState=NewGraphicState()}this.CurrGraphState.AddLine(b,d,a,c)};function PdfFont(){PdfDictionary.call(this);this.head=null;this.hhea=null;this.os_2=null;this.EncodingTable=null;this.KerningTable=null;this.UsedGlyps=new HashTableSrv();this.ToUnicode=null;this.DescFont=null;this.iIsUnicode=false;this.CharWidths=null;this.FntDescriptor=null;this.FontFile=null;this.BBox=null;this.GlyphWidths=null;this.IsSymbolicFont=false;this.BaseFont="";this.IsItalic=false;this.IsBold=false;this.FontsMap=null;this.FontPath="";this.FontName="";this.FamilyName="";this.FullName="";this.SrcFont=null}PdfFont.prototype=new PdfDictionary();for(var i=0;i<Object.keys(PdfDictionary).length;i++){var obj=Object.keys(PdfDictionary)[i];PdfFont[obj]=PdfDictionary[obj]}function t_Header(){this.unitsPerEm}function t_HorizontalHeader(){this.Ascender;this.Descender;this.LineGap;this.numberOfHMetrics}function t_Glyph(){this.glyph;this.width}function t_FontDATA(){this.FontName;this.IsBold;this.IsItalic;this.FontPath;this.Fnt}PdfFont.COURIER="Courier";PdfFont.COURIER_BOLD="Courier-Bold";PdfFont.COURIER_BOLDOBLIQUE="Courier-BoldOblique";PdfFont.COURIER_OBLIQUE="Courier-Oblique";PdfFont.HELVETICA="Helvetica";PdfFont.HELVETICA_BOLD="Helvetica-Bold";PdfFont.HELVETICA_BOLDOBLIQUE="Helvetica-BoldOblique";PdfFont.HELVETICA_OBLIQUE="Helvetica-Oblique";PdfFont.SYMBOL="Symbol";PdfFont.TIMES_ROMAN="Times-Roman";PdfFont.TIMES_BOLD="Times-Bold";PdfFont.TIMES_BOLDITALIC="Times-BoldItalic";PdfFont.TIMES_ITALIC="Times-Italic";PdfFont.ZAPFDINGBATS="ZapfDingbats";PdfFont.prototype.Init=function(c,b,a){if(b==undefined){var y=c;this.Add("/Type","/Font");this.Add("/Subtype","/Type1");y=y.Replace(" ","");this.Add("/BaseFont","/"+y)}else{var D=c;var g=b;var F=a;if(F==undefined){F=false}this.BaseFont="";try{var d=new XMLHttpRequest();d.open("GET",RD4_WebEntryPoint.GetAppUrl(true)+D,false);d.responseType="arraybuffer";d.send();var m=new MemoryStream(new Uint8Array(d.response));this.FontPath=D;this.head=new t_Header();this.hhea=new t_HorizontalHeader();this.EncodingTable=new HashTableSrv();this.KerningTable=new HashTableSrv();var A=PdfObject.GetSHORT(m,true);this.BaseFont=PdfObject.GetString(m,A);A=PdfObject.GetSHORT(m,true);this.FamilyName=PdfObject.GetString(m,A);var w=PdfObject.GetSHORT(m,true);var l=PdfObject.GetSHORT(m,true);var h=PdfObject.GetSHORT(m,true);this.head.unitsPerEm=PdfObject.GetSHORT(m,true);var o=PdfObject.GetSHORT(m,true);var t=PdfObject.GetSHORT(m,true);var r=PdfObject.GetSHORT(m,true);var u=PdfObject.GetSHORT(m,true);var p=PdfObject.GetSHORT(m,true);if((p&1)!=0){this.IsBold=true;if((p&2)!=0){this.IsItalic=true}}else{if((p&2)!=0){this.IsItalic=true}}if(!F){this.hhea.numberOfHMetrics=PdfObject.GetSHORT(m,true);this.hhea.Ascender=PdfObject.GetSHORT(m,true);this.hhea.Descender=PdfObject.GetSHORT(m,true);this.hhea.LineGap=PdfObject.GetSHORT(m,true);var E=PdfObject.GetNUINT(m,1,true)!=0;this.IsSymbolicFont=PdfObject.GetNUINT(m,1,true)!=0;var f=PdfObject.GetSHORT(m,true);A=PdfObject.GetUINT(m,true);this.GlyphWidths=new Uint16Array(A);for(var z=0;z<A;z++){this.GlyphWidths[z]=PdfObject.GetUINT(m,true)}A=PdfObject.GetUINT(m,true);for(var z=0;z<A;z++){var x=PdfObject.GetUINT(m,true);var q=new t_Glyph();q.glyph=PdfObject.GetUINT(m,true);q.width=PdfObject.GetUINT(m,true);this.EncodingTable.add(x,q)}A=PdfObject.GetUINT(m,true);for(var z=0;z<A;z++){var x=PdfObject.GetUINT(m,true);var q=PdfObject.GetUINT(m,true);this.KerningTable.add(x,q)}this.Add("/Type","/Font");this.Add("/Subtype","/TrueType");this.Add("/BaseFont","/"+this.BaseFont);this.Add("/Encoding","/WinAnsiEncoding");this.FntDescriptor=new PdfDictionary();this.FntDescriptor.Add("/Type","/FontDescriptor");this.FntDescriptor.Add("/Ascent",w*1000/this.head.unitsPerEm);this.FntDescriptor.Add("/CapHeight",l*1000/this.head.unitsPerEm);this.FntDescriptor.Add("/Descent",h*1000/this.head.unitsPerEm);this.BBox=new PdfArray();this.BBox.Add((o*1000/this.head.unitsPerEm),false);this.BBox.Add((t*1000/this.head.unitsPerEm),false);this.BBox.Add((r*1000/this.head.unitsPerEm),false);this.BBox.Add((u*1000/this.head.unitsPerEm),false);this.FntDescriptor.Add("/FontBBox",this.BBox);this.FntDescriptor.Add("/FontName","/"+this.BaseFont);this.FntDescriptor.Add("/ItalicAngle",f);this.FntDescriptor.Add("/StemV",80);var j=0;if(E){j|=1}j|=(this.IsSymbolicFont?4:32);if((p&2)!=0){j|=64}if((p&1)!=0){j|=262144}this.FntDescriptor.Add("/Flags",j);if(g){this.FontFile=new PdfObject();var C=this.FontPath;C=C.Replace(".idf",".ttf");var A=0;var s=null;var d=new XMLHttpRequest();d.open("GET",RD4_WebEntryPoint.GetAppUrl(true)+C,false);d.responseType="arraybuffer";d.send();A=d.response.byteLength;s=new Uint8Array(d.response);this.FontFile.Dict=new PdfDictionary();this.FontFile.Dict.Add("/Length",A);this.FontFile.Dict.Add("/Length1",A);this.FontFile.Data=new Uint8Array(A);for(var z=0;z<A;z++){this.FontFile.Data[z]=s[z]}this.FontFile.DataSize=A;this.FontFile.HasStream=true}}return true}catch(B){WriteToConsoleError("[PdfFont::Init] Error while reading font ("+D+"): "+B);return false}}};PdfFont.prototype.Reset=function(){this.ID=-1;this.UsedGlyps.clear()};PdfFont.prototype.AddToDoc=function(d,c){this.Doc=d;this.Doc.AddChild(this);if(!this.IsUnicode()&&this.FontPath.length>0){this.CharWidths=new PdfArray();this.CharWidths.Doc=this.Doc;this.Doc.AddChild(this.CharWidths);var b=this.Get("/Widths");if(b==null){this.Add("/Widths",this.CharWidths,true)}else{b.SetData(this.CharWidths.GetIndirectRef())}}if(this.FntDescriptor!=null){this.FntDescriptor.Doc=this.Doc;this.Doc.AddChild(this.FntDescriptor);if(!this.IsUnicode()){b=this.Get("/FontDescriptor");if(b==null){this.Add("/FontDescriptor",this.FntDescriptor,true)}else{b.SetData(this.FntDescriptor.GetIndirectRef())}}}if(this.BBox!=null){this.BBox.Doc=this.Doc}if(c&&this.FontFile!=null){this.FontFile.Doc=this.Doc;this.Doc.AddChild(this.FontFile);var b=this.FntDescriptor.Get("/FontFile2");if(b==null){this.FntDescriptor.Add("/FontFile2",this.FontFile,true)}else{b.SetData(this.FontFile.GetIndirectRef())}}if(this.IsUnicode()){var b=null;this.Get("/Subtype").SetData("/Type0");this.Get("/Encoding").SetData("/Identity-H");this.DescFont=new PdfDictionary();this.DescFont.Doc=this.Doc;this.Doc.AddChild(this.DescFont);this.DescFont.Add("/Type","/Font");this.DescFont.Add("/Subtype","/CIDFontType2");this.DescFont.Add("/BaseFont","/"+this.BaseFont);this.DescFont.Add("/CIDToGIDMap","/Identity");var a=new PdfDictionary();a.Add("/Supplement","0");a.Add("/Ordering","(Identity)");a.Add("/Registry","(Adobe)");this.DescFont.Add("/CIDSystemInfo",a);this.DescFont.Add("/DW","1000");this.DescFont.Add("/FontDescriptor",this.FntDescriptor,true);var e=new PdfArray();e.Add(this.DescFont.GetIndirectRef());b=this.Get("/DescendantFonts");if(b==null){this.Add("/DescendantFonts",e)}else{b.SetData(e)}this.ToUnicode=new PdfObject();this.ToUnicode.Doc=this.Doc;this.ToUnicode.Dict=new PdfDictionary();this.Doc.AddChild(this.ToUnicode);b=this.Get("/ToUnicode");if(b==null){this.Add("/ToUnicode",this.ToUnicode.GetIndirectRef())}else{b.SetData(this.ToUnicode.GetIndirectRef())}}};PdfFont.WinAnsiEncode=function(a){if(typeof(a)=="string"){a=a.charCodeAt(0)}switch(a){case 128:a=8364;break;case 129:a=65533;break;case 130:a=8218;break;case 131:a=402;break;case 132:a=8222;break;case 133:a=8230;break;case 134:a=8224;break;case 135:a=8225;break;case 136:a=710;break;case 137:a=8240;break;case 138:a=352;break;case 139:a=8249;break;case 140:a=338;break;case 141:a=65533;break;case 142:a=381;break;case 143:a=65533;break;case 144:a=65533;break;case 145:a=8216;break;case 146:a=8217;break;case 147:a=8220;break;case 148:a=8221;break;case 149:a=8226;break;case 150:a=8211;break;case 151:a=8212;break;case 152:a=732;break;case 153:a=8482;break;case 154:a=353;break;case 155:a=8250;break;case 156:a=339;break;case 157:a=65533;break;case 158:a=382;break;case 159:a=376;break}return a};PdfFont.WinAnsiDecode=function(a){if(typeof(a)=="string"){a=a.charCodeAt(0)}switch(a){case 8364:a=128;break;case 8218:a=130;break;case 402:a=131;break;case 8222:a=132;break;case 8230:a=133;break;case 8224:a=134;break;case 8225:a=135;break;case 710:a=136;break;case 8240:a=137;break;case 352:a=138;break;case 8249:a=139;break;case 338:a=140;break;case 381:a=142;break;case 8216:a=145;break;case 8217:a=146;break;case 8220:a=147;break;case 8221:a=148;break;case 8226:a=149;break;case 8211:a=150;break;case 8212:a=151;break;case 732:a=152;break;case 8482:a=153;break;case 353:a=154;break;case 8250:a=155;break;case 339:a=156;break;case 382:a=158;break;case 376:a=159;break;case 65533:a=129;break}return a};PdfFont.prototype.GetCharWidth=function(a){if(this.EncodingTable!=null&&this.hhea!=null){if(!this.IsSymbolicFont&&a>=128&&a<=159){a=PdfFont.WinAnsiEncode(a)}var b=this.EncodingTable[a];if(b!=null){return b.width}else{if(a<this.hhea.numberOfHMetrics){return this.GlyphWidths[a]}else{return this.GlyphWidths[this.hhea.numberOfHMetrics-1]}}}return 0};PdfFont.prototype.GetKerning=function(f,e){if(this.EncodingTable!=null){var d=-1;var c=this.EncodingTable[f];if(c!=null){d=c.glyph}var b=-1;c=this.EncodingTable[e];if(c!=null){b=c.glyph}if(d==-1||b==-1){return 0}var a=this.KerningTable[(d<<16)+b];if(a!=null){return a/1000}}return 0};PdfFont.prototype.IsSameFont=function(a){var b=this.Get("/BaseFont");if(b!=null&&b.Type==PdfCollectionElem.VAL_STRING&&b.Value=="/"+a){return true}return false};PdfFont.prototype.getAscent=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.Ascender/this.head.unitsPerEm}else{return 0.8}};PdfFont.prototype.getDescent=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.Descender/this.head.unitsPerEm}else{return -0.1}};PdfFont.prototype.getLeading=function(){if(this.head!=null&&this.head.unitsPerEm!=0){return this.hhea.LineGap/this.head.unitsPerEm}else{return 0}};PdfFont.scanFontDirectory=function(){if(this.FontsMap){return}var d=0;var b=new ArrayList();RD4_WebEntryPoint.GetFontsList(b);if(b.Count()==0){return}if(this.FontsMap==null){this.FontsMap=new HashTableSrv()}for(var e=0;e<b.Count();e++){var g=b[e];if(g[0]=="+"){g=g.substring(1)}g=g.replace(/\|/g,"_");g="?WCI=RD3&WCE=GZ&FN=fonts/"+g+".idf";var a=new PdfFont();if(a.Init(g,false,true)){var c=this.FontsMap[a.FamilyName];if(c==null){c=new ArrayList();this.FontsMap.add(a.FamilyName,c)}var f=new t_FontDATA();f.FontName=a.FontName;f.IsBold=a.IsBold;f.IsItalic=a.IsItalic;f.FontPath=a.FontPath;f.Fnt=null;c.Add(f);d++}a=null}WriteToConsoleOutput("[PdfFont::scanFontDirectory] Found "+this.FontsMap.count()+" families ("+d+" fonts)")};PdfFont.getFont=function(f,b,a){if(this.FontsMap==null){WriteToConsoleError("[PdfFont::getFont] No fonts found")}else{var c=this.FontsMap[f];if(c!=null){for(var g=0;g<c.length;g++){var e=c[g];if(e.IsBold==b&&e.IsItalic==a){if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}return e.Fnt.Clone()}}WriteToConsoleError("[PdfFont::getFont] Font "+f+","+(b?"B":"")+(a?"I":"")+" not found in family");for(var g=0;g<c.length;g++){var e=c[g];if((b&&a&&(e.IsBold||e.IsItalic))||(!(b&&a)&&(b||a)&&!e.IsBold&&!e.IsItalic)){WriteToConsoleError("  -->  Replacing with "+f+","+(e.IsBold?"B":"")+(e.IsItalic?"I":""));if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}return e.Fnt.Clone()}}for(var g=0;g<c.length;g++){var e=c[g];if(e.Fnt==null){e.Fnt=new PdfFont();e.Fnt.Init(e.FontPath,true)}}return e.Fnt.Clone()}else{WriteToConsoleError("[PdfFont::getFont] Font "+f+" family not found")}}WriteToConsoleError("  -->  Replacing with HELVETICA,"+(b?"B":"")+(a?"I":""));var d=new PdfFont();if(b&&a){d.Init(PdfFont.HELVETICA_BOLDOBLIQUE)}else{if(b){d.Init(PdfFont.HELVETICA_BOLD)}else{if(a){d.Init(PdfFont.HELVETICA_OBLIQUE)}else{d.Init(PdfFont.HELVETICA)}}}return d};PdfFont.prototype.Clone=function(){var a=new PdfFont();if(this.FntDescriptor!=null){a.FntDescriptor=new PdfDictionary();a.FntDescriptor.Doc=this.Doc;if(this.FntDescriptor.Dictionary!=null){a.FntDescriptor.Add(this.FntDescriptor,false)}}if(this.FontFile!=null){this.FontFile.FormatObject();a.FontFile=new PdfObject();a.FontFile.Doc=this.Doc;a.FontFile.Data=this.FontFile.Data;a.FontFile.DataSize=this.FontFile.DataSize;a.FontFile.HasStream=this.FontFile.HasStream;if(this.FontFile.Dict!=null){a.FontFile.Dict=new PdfDictionary();a.FontFile.Dict.Doc=this.Doc;a.FontFile.Dict.Add(this.FontFile.Dict,false)}}a.head=this.head;a.hhea=this.hhea;a.os_2=this.os_2;a.BBox=this.BBox;a.GlyphWidths=this.GlyphWidths;a.EncodingTable=this.EncodingTable;a.KerningTable=this.KerningTable;a.IsSymbolicFont=this.IsSymbolicFont;a.BaseFont=this.BaseFont;a.IsItalic=this.IsItalic;a.IsBold=this.IsBold;a.FontPath=this.FontPath;a.FontName=this.FontName;a.FamilyName=this.FamilyName;a.FullName=this.FullName;a.iIsUnicode=this.iIsUnicode;a.Add(this,false);a.SrcFont=this;return a};PdfFont.prototype.IsUnicode=function(){return this.iIsUnicode&&this.FontPath.length>0};PdfFont.prototype.AddedText=function(a){if(a==null||a.length==0){return}var d=-1;var b=null;for(var c=0;c<a.length;c++){var e=PdfFont.WinAnsiDecode(a.charCodeAt(c));if((e>>8)!=d||d==-1){d=(e>>8);b=this.UsedGlyps[d];if(b==null){b=new Uint8Array(256);this.UsedGlyps[d]=b}}b[e&255]=true}};PdfFont.prototype.FormatObject=function(){if(this.IsUnicode()){var t="";var s="";var o=0;s+="[ ";var p=Object.keys(this.UsedGlyps);for(var y=0;y<p.length;y++){var h=p[y];var m=this.UsedGlyps[h];var g=0;var f=0;for(g=0;g<m.length&&!m[g];g++){}for(f=m.length-1;f>=0&&!m[f];f--){}for(var u=g;u<=f;u++){if(m[u]){var z=this.EncodingTable[(h<<8)+u];if(z==null){WriteToConsoleError("[PdfFont::FormatObject] Can't find glyph "+((h<<8)+u)+" for USE");continue}s+=z.glyph;s+=" ["+z.width;var w=0;var r=z;for(w=u+1;w<=f;w++){var x=this.EncodingTable[(h<<8)+w];if(x!=null){r=x;s+=" "+(m[w]?x.width:0)}else{break}}var e=z.glyph.toString(16);e="0000".substring(0,4-e.length)+e;var d=r.glyph.toString(16);d="0000".substring(0,4-d.length)+d;var b=((h<<8)+u).toString(16);b="0000".substring(0,4-b.length)+b;t+="<";t+=e;t+="><";t+=d;t+="><";t+=b;t+=">\n";s+="] ";o++;u=w-1}}}s+="]";var c=this.DescFont.Get("/W");if(c==null){this.DescFont.Add("/W",s.toString())}else{c.SetData(s.toString())}var a="";a+="/CIDInit /ProcSet findresource begin\n";a+="12 dict begin\n";a+="begincmap\n";a+="/CIDSystemInfo\n";a+="<< /Registry (Adobe)\n";a+="/Ordering (UCS)\n";a+="/Supplement 0\n";a+=">> def\n";a+="/CMapName /Adobe-Identity-UCS def\n";a+="/CMapType 2 def\n";a+="1 begincodespacerange\n";a+="<0000><FFFF>\n";a+="endcodespacerange\n";a+=o+" beginbfrange\n";a+=t;a+="endbfrange\n";a+="endcmap\n";a+="CMapName currentdict /CMap defineresource pop\n";a+="end end";this.ToUnicode.Data=a.toString().split("");this.ToUnicode.DataSize=this.ToUnicode.Data.length;this.ToUnicode.HasStream=true;this.ToUnicode.Dict.Add("/Length",this.ToUnicode.DataSize)}else{var q=0;var l=0;if(this.UsedGlyps.count()>0){var m=null;var p=Object.keys(this.UsedGlyps);for(var y=0;y<p.length;y++){var h=p[y];m=this.UsedGlyps[h];if(h==0){break}}m["?"]=true;for(q=0;q<256&&(!m[q]||this.GetCharWidth(q)==0);q++){}for(l=255;l>q&&(!m[l]||this.GetCharWidth(l)==0);l--){}for(var k=q;k<=l;k++){this.CharWidths.Add((m[k]?this.GetCharWidth(k):0),false)}}var c=this.Get("/FirstChar");if(c==null){this.Add("/FirstChar",q)}else{c.SetData(q)}c=this.Get("/LastChar");if(c==null){this.Add("/LastChar",l)}else{c.SetData(l)}}PdfDictionary.prototype.FormatObject.call(this)};PdfFont.ToString=function(e,c,g,f){if(PdfFont.FontsMap==null){new VisAttrListIDRE()}var h="";var d=PdfFont.getFont(e,c,g);h+="  PdfFont pf = new PdfFont();\n";h+="  pf.IsItalic = "+d.IsItalic+";\n";h+="  pf.IsBold = "+d.IsBold+";\n";h+='  pf.FontName = "'+d.FontName+'";\n';h+='  pf.FamilyName = "'+d.FamilyName+'";\n';h+="  pf.IsSymbolicFont = "+d.IsSymbolicFont+";\n";h+="  pf.Ascent = "+d.getAscent()+";\n";h+="  pf.Descent = "+d.getDescent()+";\n";h+="  pf.LineGap = "+d.getLeading()+";\n";var j=0;if(d.GlyphWidths!=null){h+="  pf.GlyphWidths = new Array(";j=0;for(;j<d.GlyphWidths.length;j++){h+=(j>0?", ":"")+d.GlyphWidths[j];if(j%40==39){h+="\n    "}}h+="  );\n"}if(d.KerningTable!=null){h+="  pf.KerningTable = {";j=0;var m=Object.keys(d.KerningTable);for(var b=0;b<m.length;b++){var a=m[b];var l=d.KerningTable[a];h+=(j>0?", ":"")+'"'+a+'" : "'+l+'"';if(++j%40==39){h+="\n    "}}h+="  };\n"}if(d.EncodingTable!=null){h+="  pf.EncodingTable = {";j=0;var m=Object.keys(d.EncodingTable);for(var b=0;b<m.length;b++){var a=m[b];var l=d.EncodingTable[a];h+=(j>0?", ":"")+'"'+a+'" : {"glyph" : "'+l.glyph+'" , "width" : "'+l.width+'"}';if(++j%40==39){h+="\n    "}}h+="  };\n"}};function t_GRState(){this.LineWidth;this.LineCap;this.LineJoin;this.LineMiterLimit;this.DashPhase;this.DashOn;this.DashOff;this.LineColorRGB;this.LineColorGray;this.FillColorRGB;this.FillColorGray;this.TextMode;this.TextFont;this.Rotation}t_GRState.prototype.Reset=function(){this.LineWidth=1;this.LineCap=PdfGraphics.LINE_CAP_BUTTCAP;this.LineJoin=PdfGraphics.LINE_JOIN_MITER;this.LineMiterLimit=10;this.DashPhase=0;this.DashOn=-1;this.DashOff=-1;this.LineColorRGB=-1;this.LineColorGray=-1;this.FillColorRGB=-1;this.FillColorGray=-1;this.TextMode=PdfGraphics.TEXT_FILL;this.TextFont="";this.Rotation=0};function PdfGraphics(){PdfObject.call(this);this.ParentPage=null;this.Fonts=new ArrayList();this.CursTx=0;this.CursTy=0;this.CurrState=new t_GRState();this.CurrState.Reset();this.CurrentLen=0;this.HasStream=true}PdfGraphics.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfGraphics[obj]=PdfObject[obj]}PdfGraphics.LINE_CAP_BUTTCAP=0;PdfGraphics.LINE_CAP_ROUND=1;PdfGraphics.LINE_CAP_SQUARE=2;PdfGraphics.LINE_JOIN_MITER=0;PdfGraphics.LINE_JOIN_ROUND=1;PdfGraphics.LINE_JOIN_BEVEL=2;PdfGraphics.TEXT_FILL=0;PdfGraphics.TEXT_STRO=1;PdfGraphics.TEXT_FILL_STRO=2;PdfGraphics.TEXT_NONE=3;PdfGraphics.TEXT_FILL_CLIP=4;PdfGraphics.TEXT_STRO_CLIP=5;PdfGraphics.TEXT_FILL_STRO_CLIP=6;PdfGraphics.TEXT_CLIP=7;PdfGraphics.prototype.FormatDouble=function(a){return a.toFixed(2)};PdfGraphics.prototype.Add=function(d){if(this.DataSize==-1){this.DataSize=200;if(PdfDocument.CR_LEN+d.length>this.DataSize){this.DataSize=PdfDocument.CR_LEN+d.length+10}this.Data=new Uint8Array(this.DataSize)}if(PdfDocument.CR_LEN+this.CurrentLen+d.length>this.DataSize){this.DataSize=Math.max(this.DataSize*2,PdfDocument.CR_LEN+this.CurrentLen+d.length);var e=this.Data;this.Data=new Uint8Array(this.DataSize);for(var c=0;c<e.length;c++){this.Data[c]=e[c]}}if(this.CurrentLen>0){for(var c=0;c<PdfDocument.CR_LEN;c++){this.Data[this.CurrentLen+c]=PdfDocument.CR.charCodeAt(c)}this.CurrentLen+=PdfDocument.CR_LEN}for(var c=0;c<d.length;c++){var a=d.charCodeAt(c);if(a>255){a=PdfFont.WinAnsiDecode(a)}this.Data[this.CurrentLen+c]=a}this.CurrentLen+=d.length};PdfGraphics.prototype.FormatObject=function(){this.DataSize=this.CurrentLen;if(this.Dict==null){this.Dict=new PdfDictionary();this.Dict.Doc=this.Doc}var c=this.Dict.Get("/Length");if(c==null){c=this.Dict.Add("/Length",0)}c.Value=this.DataSize;if(this.Fonts.Count()>0){for(var b=0;b<this.Fonts.Count();b++){var d=this.Fonts[b];var a="/F"+d.ID;this.Doc.AddToResource(this.ParentPage,"/Font",a,d)}this.Doc.AddToResource(this.ParentPage,"/ProcSet","/Text");this.ParentPage.FormatObject()}PdfObject.prototype.FormatObject.call(this)};PdfGraphics.prototype.AddExtGS=function(c){var b=this.Doc.GetExtGS(c);if(b==null){b=new PdfDictionary();b.Add("/Type","/ExtGState");b.Add("/ca",c);b.Add("/CA",c);this.Doc.AddChild(b);this.Doc.ExtGRStates.Add(b)}var a="/GS"+b.ID;this.Doc.AddToResource(this.Doc.CurrPage,"/ExtGState",a,b);return b};PdfGraphics.prototype.SetLineWidth=function(a){if(this.CurrState.LineWidth!=a){this.CurrState.LineWidth=a;this.Add(this.FormatDouble(a)+" w")}};PdfGraphics.prototype.SetLineCap=function(a){if(this.CurrState.LineCap!=a){this.CurrState.LineCap=a;this.Add(a+" J")}};PdfGraphics.prototype.SetLineJoin=function(a){if(this.CurrState.LineJoin!=a){this.CurrState.LineJoin=a;this.Add(a+" j")}};PdfGraphics.prototype.SetLineMiterLimit=function(a){if(this.CurrState.LineMiterLimit!=a){this.CurrState.LineMiterLimit=a;this.Add(this.FormatDouble(a)+" M")}};PdfGraphics.prototype.SetLineDashPattern=function(b,a,e){if(this.CurrState.DashPhase!=b||this.CurrState.DashOn!=a||this.CurrState.DashOff!=e){this.CurrState.DashPhase=b;this.CurrState.DashOn=a;this.CurrState.DashOff=e;var d;if(a!=-1){if(e!=-1){d="["+this.FormatDouble(a)+" "+this.FormatDouble(e)}else{d="["+this.FormatDouble(a)}}else{d="["}var c="] "+b+" d";this.Add(d+c)}};PdfGraphics.prototype.SetLineColor=function(j,h,f){if(h==undefined){var c=j;if(this.CurrState.LineColorGray!=c){this.CurrState.LineColorGray=c;this.Add(this.FormatDouble(c/256)+" G")}}else{var e=j;var d=h;var a=f;if(this.CurrState.LineColorRGB!=((e<<16)|(d<<8)|a)){this.CurrState.LineColorRGB=(e<<16)|(d<<8)|a;this.Add(this.FormatDouble(e/256)+" "+this.FormatDouble(d/256)+" "+this.FormatDouble(a/256)+" RG")}}};PdfGraphics.prototype.SetFillColor=function(j,h,f){if(h==undefined){var c=j;if(this.CurrState.FillColorGray!=c){this.CurrState.FillColorGray=c;this.Add(this.FormatDouble(c/256)+" g")}}else{var e=j;var d=h;var a=f;if(this.CurrState.FillColorRGB!=((a<<16)|(d<<8)|e)){this.CurrState.FillColorRGB=(a<<16)|(d<<8)|e;this.Add(this.FormatDouble(e/256)+" "+this.FormatDouble(d/256)+" "+this.FormatDouble(a/256)+" rg")}}};PdfGraphics.prototype.SetFillPattern=function(a){this.Add("q"+PdfDocument.CR+"/Pattern cs"+PdfDocument.CR+"/P"+a.ID+" scn")};PdfGraphics.prototype.CloseFillPattern=function(){this.Add("Q")};PdfGraphics.prototype.SetColor=function(j,h,f){if(h==undefined){var c=j;this.SetLineColor(c);this.SetFillColor(c)}else{var e=j;var d=h;var a=f;this.SetLineColor(e,d,a);this.SetFillColor(e,d,a)}};PdfGraphics.prototype.SetTextMode=function(a){if(this.CurrState.TextMode!=a){this.CurrState.TextMode=a;this.Add(a+" Tr")}};PdfGraphics.prototype.SetTextFont=function(c,a){var b="/F"+c.ID+" "+this.FormatDouble(a)+" Tf";if(!this.CurrState.TextFont==b){this.CurrState.TextFont=b;this.Add(b)}};PdfGraphics.prototype.SetTextPosition=function(a,b){this.Add(this.FormatDouble(a)+" "+this.FormatDouble(b)+" Td")};PdfGraphics.prototype.SetRotation=function(c,b,g){if(this.CurrState.Rotation!=c){this.CurrState.Rotation=c;var f=this.CurrState.Rotation*Math.PI/180;var e=Math.cos(f);var d=Math.sin(f);this.Add("q");this.Add("1 0 0 1 "+this.FormatDouble(b)+" "+this.FormatDouble(g)+" cm");this.Add(this.FormatDouble(e)+" "+this.FormatDouble(d)+" "+this.FormatDouble(-d)+" "+this.FormatDouble(e)+" 0 0 cm");this.Add("1 0 0 1 "+this.FormatDouble(-b)+" "+this.FormatDouble(-g)+" cm")}};PdfGraphics.prototype.UndoRotation=function(){this.Add("Q");this.CurrState.Reset()};PdfGraphics.prototype.AddText=function(z,p,m,q,K,e,k,L,g,c,t,F,f,E){if(L==undefined){L=false}if(g==undefined){g=false}if(c==undefined){c=-1}if(t==undefined){t=100}if(F==undefined){F=0}if(f==undefined){f=0}if(E==undefined){E=100}var v="BT";if(K==-1){K=this.Doc.CurrFontHeight}var b=0;var a=0;if(p!=-1&&m!=-1){var d=PdfDocument.CR+this.FormatDouble(p)+" "+this.FormatDouble(m)+" Td";b=p;a=m;v+=d}else{if(CursTx!=0||CursTy-K!=0){var d=PdfDocument.CR+"1 0 0 1 "+this.FormatDouble(CursTx)+" "+this.FormatDouble(CursTy-K)+" cm";v+=d;b=this.CursTx;a=this.CursTy-K;this.CursTx=0;this.CursTy=0}}if(q!=-1&&this.CurrState.LineWidth!=q){this.CurrState.LineWidth=q;var d=PdfDocument.CR+this.FormatDouble(q)+" w";v+=d}if(e!=-1&&this.CurrState.TextMode!=e){this.CurrState.TextMode=e;var d=PdfDocument.CR+e+" Tr";v+=v}var l=null;if(k!=-1){var J=this.Doc.GetObjectByID(k);if(J instanceof PdfFont){l=J}}else{l=this.Doc.CurrFont}if(l!=null){var C=false;for(var I=0;I<this.Fonts.Count()&&!C;I++){if(this.Fonts[I]==l){C=true}}if(!C){this.Fonts.Add(l)}var d=PdfDocument.CR+"/F"+l.ID+" "+this.FormatDouble(K)+" Tf";if(this.CurrState.TextFont!=d){this.CurrState.TextFont=d;v+=d}}if(L){v+=PdfDocument.CR+this.FormatDouble(K/30)+" w";v+=PdfDocument.CR+""+PdfGraphics.TEXT_FILL_STRO+" Tr"}if(g){v+=PdfDocument.CR+"1 0 0.21256 1 "+this.FormatDouble(b)+" "+this.FormatDouble(a)+" Tm"}if(c>0&&E!=100){c=c/E*100}if(c>0){var H=0;var o=0;var A=false;for(var I=z.length-1;I>=0;I--){if(z[I]!=" "){A=true}if(A){if(z[I]==" "){H++}o++}}var j=-1;var B=-1;if(H>0){var D=l.GetCharWidth(" ")/1000*K;if(c/D>4){j=c*0.4/H;B=c*0.6/(o-1)}else{j=c/H}}else{B=c/(o-1)}if(f!=0){j=(j==-1?0:j)+f/100}if(F!=0){B=(B==-1?0:B)+F/100}if(j!=-1){v+=PdfDocument.CR+this.FormatDouble(j)+" Tw"}if(B!=-1){v+=PdfDocument.CR+this.FormatDouble(B)+" Tc"}}else{if(f!=0){v+=PdfDocument.CR+this.FormatDouble(f/100)+" Tw"}if(F!=0){v+=PdfDocument.CR+this.FormatDouble(F/100)+" Tc"}}if(E!=100){v+=PdfDocument.CR+E+" Tz"}if(!l.IsUnicode()){v+=PdfDocument.CR+"("+PdfObject.AdaptString(z)+")Tj"}else{v+=PdfDocument.CR+"(";for(var u=0;u<z.length;u++){var r=z.charCodeAt(u);var G=l.EncodingTable[r];if(G!=null){var d=""+String.fromCharCode(G.glyph>>8)+String.fromCharCode(G.glyph&255);v+=PdfObject.AdaptString(d)}else{WriteToConsoleError("[PdfGraphics::AddText] Can't find encoding for glyph '"+String.fromCharCode(r)+"' ("+r+")")}}v+=")Tj"}if(L){v+=PdfDocument.CR+this.FormatDouble(this.CurrState.LineWidth)+" w";v+=PdfDocument.CR+this.CurrState.TextMode+" Tr"}if(g){v+=PdfDocument.CR+"1 0 0 1 "+this.FormatDouble(b)+" "+this.FormatDouble(a)+" Tm"}if(c!=-1){v+=PdfDocument.CR+"0 Tc"+PdfDocument.CR+"0 Tw"}else{if(f!=0){v+=PdfDocument.CR+"0 Tw"}if(F!=0){v+=PdfDocument.CR+"0 Tc"}}if(E!=100){v+=PdfDocument.CR+"100 Tz"}v+=PdfDocument.CR+"ET";this.Add(v);l.AddedText(z)};PdfGraphics.prototype.AddRectangle=function(b,h,a,g,e,d){if(e==undefined){e=false}if(d==undefined){d=100}if(d<100){var c=this.AddExtGS(d/100);this.Add("q"+PdfDocument.CR+"/GS"+c.ID+" gs")}var f=this.FormatDouble(b)+" "+this.FormatDouble(h)+" "+this.FormatDouble(a)+" "+this.FormatDouble(g)+" re"+PdfDocument.CR+(e?"f":"s");this.Add(f);if(d<100){this.Add("Q")}this.CursTx+=b;this.CursTy+=h+g};PdfGraphics.prototype.AddBezier=function(c,h,b,g,a,f,k,e,d){if(d==undefined){d=false}var j=this.FormatDouble(c)+" "+this.FormatDouble(h)+" "+PdfDocument.CR+this.FormatDouble(b)+" "+this.FormatDouble(g)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f)+"  c"+PdfDocument.CR;if(d){j+="b"}else{j+="s"}this.Add(j)};PdfGraphics.KAPPA=0.5522847498;PdfGraphics.prototype.AddCircle=function(a,f,e,b){if(b==undefined){b=false}var d="";var c="";c=this.FormatDouble(a-e)+" "+this.FormatDouble(f)+" m"+PdfDocument.CR;d+=c;c=this.FormatDouble(a-e)+" "+this.FormatDouble(f+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f+e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f+e)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a+PdfGraphics.PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f+e)+" "+this.FormatDouble(a+e)+" "+this.FormatDouble(f+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a+e)+" "+this.FormatDouble(f)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a+e)+" "+this.FormatDouble(f-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a+PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f-e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(f-e)+" c"+PdfDocument.CR;d+=c;c=this.FormatDouble(a-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(f-e)+" "+this.FormatDouble(a-e)+" "+this.FormatDouble(f-PdfGraphics.KAPPA*e)+" "+this.FormatDouble(a-e)+" "+this.FormatDouble(f)+" c"+PdfDocument.CR;d+=c;if(b){d+="b"}else{d+="s"}this.Add(d)};PdfGraphics.prototype.AddLine=function(b,e,a,c){var d=this.FormatDouble(b)+" "+this.FormatDouble(e)+" m"+PdfDocument.CR+this.FormatDouble(a)+" "+this.FormatDouble(c)+" l"+PdfDocument.CR+"S";this.Add(d)};PdfGraphics.prototype.AddImage=function(a,g,f,b,e,d){var c;if(d!=null){c="q"+PdfDocument.CR+this.FormatDouble(d.left())+" "+this.FormatDouble(d.top())+" "+this.FormatDouble(d.right()-d.left())+" "+this.FormatDouble(d.bottom()-d.top())+" re"+PdfDocument.CR+"W n";this.Add(c)}c="q"+PdfDocument.CR+this.FormatDouble(b)+" 0 0 "+this.FormatDouble(e)+" "+this.FormatDouble(a)+" "+this.FormatDouble(g)+" cm"+PdfDocument.CR+"/Image"+f.ID+" Do"+PdfDocument.CR+"Q";this.Add(c);if(d!=null){this.Add("Q")}};function PdfImage(){PdfObject.call(this);this.Height=-1;this.Width=-1;this.Palette=null;this.PaletteLen=-1;this.PaletteSize=-1;this.BitsPerComponent=-1;this.ColorSpace=-1;this.Param;this.Dict=new PdfDictionary()}PdfImage.prototype=new PdfObject();for(var i=0;i<Object.keys(PdfObject).length;i++){var obj=Object.keys(PdfObject)[i];PdfImage[obj]=PdfObject[obj]}PdfImage.prototype.Init=function(c,a){this.Dict.Add("/Type","/XObject");this.Dict.Add("/Subtype","/Image");this.Dict.Add("/Width",this.Width);this.Dict.Add("/Height",this.Height);this.Dict.Add("/BitsPerComponent",this.BitsPerComponent);switch(this.ColorSpace){case 0:break;case 1:this.Dict.Add("/ColorSpace","/DeviceGray");break;case 3:if(this.Palette!=null){var b=new PdfArray();b.Add("/Indexed");b.Add("/DeviceRGB");b.Add(this.PaletteSize/3-1);b.Add(this.Palette,this.PaletteLen);this.Palette=null;this.Dict.Add("/ColorSpace",b)}else{this.Dict.Add("/ColorSpace","/DeviceRGB")}break;case 4:this.Dict.Add("/ColorSpace","/DeviceCMYK");break}this.HasStream=true;this.Dict.Add("/Length",this.DataSize)};function Bitmap(){PdfImage.call(this);this.bmih=new t_BITMAPINFOHEADER();this.bmfh=new t_BITMAPFILEHEADER()}Bitmap.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Bitmap[obj]=PdfImage[obj]}Bitmap.BMP_BI_RGB=0;Bitmap.BMP_BI_RLE8=1;Bitmap.BMP_BI_RLE4=2;Bitmap.BMP_BI_BITFIELDS=3;function t_BITMAPFILEHEADER(){this.bfType;this.bfSize;this.bfReserved1;this.bfReserved2;this.bfOffBits}function t_BITMAPINFOHEADER(){this.biSize;this.biWidth;this.biHeight;this.biPlanes;this.biBitCount;this.biCompression;this.biSizeImage;this.biXPelsPerMeter;this.biYPelsPerMeter;this.biClrUsed;this.biClrImportant}Bitmap.prototype.Init=function(c,b){var a=new MemoryStream(c);this.bmfh.bfType=PdfObject.GetSHORT(a);this.bmfh.bfSize=PdfObject.GetUINT(a);this.bmfh.bfReserved1=PdfObject.GetSHORT(a);this.bmfh.bfReserved2=PdfObject.GetSHORT(a);this.bmfh.bfOffBits=PdfObject.GetUINT(a);if(this.bmfh.bfType!=(66+(77<<8))){throw new Error("[Bitmap::Init] Wrong start type (BM)")}this.bmih.biSize=PdfObject.GetUINT(a);this.bmih.biWidth=PdfObject.GetUINT(a);this.bmih.biHeight=PdfObject.GetUINT(a);this.bmih.biPlanes=PdfObject.GetSHORT(a);this.bmih.biBitCount=PdfObject.GetSHORT(a);this.bmih.biCompression=PdfObject.GetUINT(a);this.bmih.biSizeImage=PdfObject.GetUINT(a);this.bmih.biXPelsPerMeter=PdfObject.GetUINT(a);this.bmih.biYPelsPerMeter=PdfObject.GetUINT(a);this.bmih.biClrUsed=PdfObject.GetUINT(a);this.bmih.biClrImportant=PdfObject.GetUINT(a);if(this.bmih.biCompression!=Bitmap.BMP_BI_RGB&&this.bmih.biCompression!=Bitmap.BMP_BI_RLE4&&this.bmih.biCompression!=Bitmap.BMP_BI_RLE8){throw new Error("[Bitmap::Init] Wrong compression type ("+this.bmih.biCompression+")")}if(this.bmih.biBitCount==1||this.bmih.biBitCount==4||this.bmih.biBitCount==8){this.ComputePalette(a,((this.bmfh.bfOffBits-14-this.bmih.biSize)/4))}switch(this.bmih.biBitCount){case 1:case 4:case 8:this.readNBit(this.bmih.biBitCount,a);break;case 24:case 32:this.read2432Bit(a,(this.bmih.biBitCount==32));break;default:throw new Error("[Bitmap::Init] Unsupported bit count ("+this.bmih.biBitCount+")")}this.Height=this.bmih.biHeight;this.Width=this.bmih.biWidth;this.BitsPerComponent=this.bmih.biBitCount;this.ColorSpace=3;if(this.BitsPerComponent==24||this.BitsPerComponent==32){this.BitsPerComponent=8}PdfImage.prototype.Init.call(this,c,b)};Bitmap.prototype.readNBit=function(c,a){var b=Math.floor(this.bmih.biWidth/(8/this.nBitsPerPixel)+0.9999);this.DataSize=b*this.bmih.biHeight;this.Data=new Uint8Array(this.DataSize);var l=(b%4==0?0:4-b%4);var g=null;if(this.bmih.biCompression!=0){if(!(c==4||c==8)||!(c!=4||this.bmih.biCompression==Bitmap.BMP_BI_RLE4)||!(c!=8||this.bmih.biCompression==Bitmap.BMP_BI_RLE8)){throw new Exception("[Bitmap::readNBit] Unsupported combination of bitPerPixel and Compression (BPP = "+c+", COMRP = "+this.bmih.biCompression+")")}g=new Uint8Array(this.bmih.biWidth*this.bmih.biHeight);var k=new Boxer(g);this.DecodeRLE(c==8,a,k);g=k.arrayValue();if(c==4){for(var m=0;m<this.bmih.biHeight;m++){for(var o=0;o<this.bmih.biWidth;o+=2){g[o/2+m*this.bmih.biWidth/2]=((g[o+m*this.bmih.biWidth]<<4)+(g[o+1+m*this.bmih.biWidth]&15))}}}}else{g=new Uint8Array(a.Length-a.Position);try{a.Read(g,0,g.length)}catch(h){throw new Error("[Bitmap::readNBit] Exception while reading from DataPixel buffer")}}for(var f=0;f<this.bmih.biHeight;f++){for(var d=0;d<b;d++){this.Data[f*b+d]=g[(b+l)*this.bmih.biHeight-(f+1)*(b+l)+d]}}if(this.bmih.biCompression!=0){g=null}};Bitmap.prototype.read2432Bit=function(g,d){this.DataSize=this.bmih.biWidth*this.bmih.biHeight*3;this.Data=new Uint8Array(this.DataSize);var e=this.bmih.biWidth*24/8;var f=(e%4==0?0:4-e%4);if(d){f=0}for(var c=0;c<this.bmih.biHeight;c++){var a=(this.bmih.biWidth*this.bmih.biHeight*3-1)-(c+1)*this.bmih.biWidth*3+1;for(var b=0;b<this.bmih.biWidth;b++){this.Data[a+2]=PdfObject.GetNUINT(g,1);this.Data[a+1]=PdfObject.GetNUINT(g,1);this.Data[a]=PdfObject.GetNUINT(g,1);if(d){PdfObject.GetNUINT(g,1)}a+=3}g.Seek(f)}};Bitmap.prototype.DecodeRLE=function(c,a,h){var b=h.arrayValue();var g=0;var l;var j;var k=false;l=j=0;while(g<this.bmih.biSizeImage&&!k){var d=a.ReadByte();g++;if(d!=0){var f=a.ReadByte();g++;if(c){for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=f}}else{for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=((e%2)==0?f>>4:f&15)}}l+=d}else{d=a.ReadByte();g++;switch(d){case 0:l=0;j++;break;case 1:k=true;break;case 2:l+=a.ReadByte();j+=a.ReadByte();g+=2;break;default:if(c){for(var e=0;e<d;e++){b[l+e+j*this.bmih.biWidth]=a.ReadByte();g++}}else{var f=0;for(var e=0;e<d;e++){if((e%2)==0){f=a.ReadByte();g++}b[l+e+j*this.bmih.biWidth]=((e%2)==0?f>>4:f&15)}}l+=d;if(c){if(d%2!=0){a.Seek(1);g++}}else{if((d&3)==1||(d&3)==2){a.Seek(1);g++}}break}}}};Bitmap.prototype.ComputePalette=function(e,a){this.Palette=new Uint8Array(a*6+2);this.PaletteSize=a*3;this.PaletteLen=0;this.Palette[this.PaletteLen++]=40;var c=new Uint8Array(3);for(var d=0;d<a;d++){c[2]=e.ReadByte();c[1]=e.ReadByte();c[0]=e.ReadByte();e.ReadByte();for(var b=0;b<3;b++){switch(c[b]){case 10:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=110;break;case 13:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=114;break;case 9:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=116;break;case 8:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=98;break;case 12:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=102;break;case 40:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=40;break;case 41:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=41;break;case 92:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=92;break;default:this.Palette[this.PaletteLen++]=c[b];break}}}this.Palette[this.PaletteLen++]=41};function GifLZWDictionary(b){this.pNext=new Int16Array(4096);this.pAdded=new Int16Array(4096);this.StartSize;this.Size;this.PostBytes=new Int16Array(4096);this.PostBytesLen=0;this.StartSize=b;for(var a=0;a<4096;a++){if(a<this.StartSize){this.pNext[a]=a}else{this.pNext[a]=-1}this.pAdded[a]=-1}this.Size=this.StartSize+2}GifLZWDictionary.prototype.Reset=function(){this.Size=this.StartSize+2};GifLZWDictionary.prototype.AddItem=function(a,b){this.pNext[this.Size]=a;this.pAdded[this.Size]=b;this.Size++};GifLZWDictionary.prototype.GetString=function(c,b,a){this.PostBytesLen=0;while(true){if(c<=this.StartSize){b[a++]=c;if(this.pAdded[c]!=-1){this.PostBytes[this.PostBytesLen++]=this.pAdded[c]}break}else{if(this.pAdded[c]!=-1){this.PostBytes[this.PostBytesLen++]=this.pAdded[c]}c=this.pNext[c]}}for(var d=this.PostBytesLen-1;d>=0;d--){b[a++]=this.PostBytes[d]}return a};function Gif(){PdfImage.call(this);this.gifh=new t_GIFHEADER();this.giim=new t_GIFIMAGEBLOCK();this.Param=1;this.Block=new Uint8Array(256)}Gif.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Gif[obj]=PdfImage[obj]}function t_GIFHEADER(){this.ghTag;this.ghType;this.ghLogWidth;this.ghLogHeight;this.ghGlobColTable;this.ghColResol;this.ghSortGlobColTable;this.ghGlobColTableSize;this.ghBackColIdx;this.ghAspectRatio}function t_GIFIMAGEBLOCK(){this.gimLeft;this.gimTop;this.gimWidth;this.gimHeight;this.gimLocColTable;this.gimInterlace;this.gimSort;this.gimLocColTableSize}Gif.prototype.Init=function(c,f){var m=new MemoryStream(c);this.gifh.ghTag=PdfObject.GetNUINT(m,3);this.gifh.ghType=PdfObject.GetNUINT(m,3);this.gifh.ghLogWidth=PdfObject.GetSHORT(m);this.gifh.ghLogHeight=PdfObject.GetSHORT(m);var l=PdfObject.GetNUINT(m,1);if(l<0){l+=256}this.gifh.ghGlobColTable=((l>>7)&1)!=0;this.gifh.ghColResol=((l>>4)&7);this.gifh.ghSortGlobColTable=((l>>3)&1)!=0;this.gifh.ghGlobColTableSize=(l&7);this.gifh.ghBackColIdx=PdfObject.GetNUINT(m,1);this.gifh.ghAspectRatio=PdfObject.GetNUINT(m,1);switch(this.gifh.ghGlobColTableSize){case 0:case 1:case 3:this.BitsPerComponent=this.gifh.ghGlobColTableSize+1;break;case 2:this.BitsPerComponent=4;break;default:this.BitsPerComponent=8;break}if(this.gifh.ghTag!=(71+(73<<8)+(70<<16))){throw new Error("[Gif::Init] Not a GIF file! (TAG = 0x"+this.gifh.ghTag.toString(16)+")")}if(this.gifh.ghType!=(56+(55<<8)+(97<<16))&&this.gifh.ghType!=(56+(57<<8)+(97<<16))){throw new Error("[Gif::Init] Only GIF87a and GIF89a are supported (TYPE = 0x"+this.gifh.ghType.toString(16)+")")}if(this.gifh.ghGlobColTable){this.ComputePalette(m,(1<<(this.gifh.ghGlobColTableSize+1)))}var h=-1;var g=1;var k=false;var d;while(!k){var j=m.ReadByte();switch(j){case 44:this.readImageData(m,g==this.Param);g++;break;case 33:var e=m.ReadByte();switch(e){case 249:m.Seek(1);d=(PdfObject.GetNUINT(m,1)&1);m.Seek(2);if(d!=0){if(g==this.Param){h=PdfObject.GetNUINT(m,1)}else{m.Seek(1)}}d=PdfObject.GetNUINT(m,1);if(d!=0){throw new Error("[Gif::Init] GCEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 254:d=PdfObject.GetNUINT(m,1);m.Seek(d);d=PdfObject.GetNUINT(m,1);if(d!=0){throw new Error("[Gif::Init] CEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 1:m.Seek(13);d=PdfObject.GetNUINT(m,1);m.Seek(d);d=PdfObject.GetNUINT(m,1);if(d!=0){throw new Error("[Gif::Init] PTEB block not terminated! (b = 0x"+d.toString(16)+")")}break;case 255:m.Seek(12);d=PdfObject.GetNUINT(m,1);while(this.readSubBlock(m)!=0){}d=PdfObject.GetNUINT(m,1);if(d!=0){throw new Error("[Gif::Init] AEB block not terminated! (b = 0x"+d.toString(16)+")")}break}break;case 59:k=true;break;case 0:break;default:throw new Error("[Gif::Init] Unknown block type (Type = 0x"+j.toString(16)+")")}}this.ColorSpace=3;if(h!=-1){var a=new PdfArray();a.Add(h);a.Add(h,false);this.Dict.Add("/Mask",a)}PdfImage.prototype.Init.call(this,c,f)};Gif.prototype.ComputePalette=function(e,c){this.Palette=new Uint8Array(c*6+2);this.PaletteSize=c*3;this.PaletteLen=0;this.Palette[this.PaletteLen++]=40;for(var d=0;d<c*3;d++){var a=e.ReadByte();switch(a){case 10:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=110;break;case 13:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=114;break;case 9:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=116;break;case 8:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=98;break;case 12:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=102;break;case 40:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=40;break;case 41:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=41;break;case 92:this.Palette[this.PaletteLen++]=92;this.Palette[this.PaletteLen++]=92;break;default:this.Palette[this.PaletteLen++]=a;break}}this.Palette[this.PaletteLen++]=41};Gif.prototype.readImageData=function(e,p){this.giim.gimLeft=PdfObject.GetSHORT(e);this.giim.gimTop=PdfObject.GetSHORT(e);this.giim.gimWidth=PdfObject.GetSHORT(e);this.giim.gimHeight=PdfObject.GetSHORT(e);if(p){this.Height=this.giim.gimHeight;this.Width=this.giim.gimWidth}var A=PdfObject.GetNUINT(e,1);this.giim.gimLocColTable=((A>>7)&1)!=0;this.giim.gimInterlace=((A>>6)&1)!=0;this.giim.gimSort=((A>>5)&4)!=0;this.giim.gimLocColTableSize=(A&7);if(this.giim.gimLocColTable){switch(this.giim.gimLocColTableSize){case 0:case 1:case 3:this.BitsPerComponent=this.giim.gimLocColTableSize+1;break;case 2:this.BitsPerComponent=4;break;default:this.BitsPerComponent=8;break}this.ComputePalette(e,(1<<(this.giim.gimLocColTableSize+1)))}if(p){if(this.BitsPerComponent==8){this.DataSize=this.giim.gimWidth*this.giim.gimHeight}else{this.DataSize=(this.giim.gimWidth*this.BitsPerComponent+7)/8*this.giim.gimHeight}this.Data=new Uint8Array(this.DataSize);if(this.BitsPerComponent!=8){for(var u=0;u<this.DataSize;u++){this.Data[u]=0}}}var r=PdfObject.GetNUINT(e,1);var c=1<<r;var t=c+1;var g=0;var o=0;var l=0;var j=0;var k=this.readSubBlock(e);var f=0;var v=0;var h=0;var z=false;var m=new GifLZWDictionary(c);var d=new Uint16Array(4096);var s;var a=0;var C=(this.giim.gimInterlace?8:1);while(g!=t){g=-1;var B;if(m.Size>=2048){B=12}else{if(m.Size>=1024){B=11}else{if(m.Size>=512){B=10}else{if(m.Size>=256){B=9}else{if(m.Size>=128){B=8}else{if(m.Size>=64){B=7}else{if(m.Size>=32){B=6}else{if(m.Size>=16){B=5}else{if(m.Size>=8){B=4}else{if(m.Size>=4){B=3}else{if(m.Size>=2){B=2}else{B=1}}}}}}}}}}}if(h<B){v|=(this.Block[f++]<<h);h+=8;if(f==k){k=this.readSubBlock(e);f=0;if(k==0){g=t;e.Seek(-1)}}if(g!=t&&h<B){v|=(this.Block[f++]<<h);h+=8;if(f==k){k=this.readSubBlock(e);f=0;if(k==0){g=t;e.Seek(-1)}}}}if(g!=t){g=v&((1<<B)-1);v>>=B;h-=B}s=0;if(g>m.Size+2){throw new Error("[Gif::readImageData] Wrong dict size (Code = "+g+", DictSize = "+m.Size)}if(g==c){m.Reset();z=true}else{if(g==t){break}else{if(z){z=false;s=m.GetString(g,d,s);o=g}else{if(g<m.Size){s=m.GetString(g,d,s);m.AddItem(o,d[0]);o=g}else{s=m.GetString(o,d,s);d[s++]=d[0];m.AddItem(o,d[0]);o=g}}}}if(s!=0&&p){for(var u=0;u<s;u++){if(this.BitsPerComponent==8){this.Data[l+j*this.giim.gimWidth]=d[u]}else{var w=(this.giim.gimWidth*this.BitsPerComponent+7)/8*j+l/(8/this.BitsPerComponent);var q=(d[u]<<(8-this.BitsPerComponent*(l%(8/this.BitsPerComponent))-this.BitsPerComponent));this.Data[w]|=q}l++;if(l>=this.giim.gimWidth){l=0;j=j+C;if(j>this.giim.gimHeight){if(!this.giim.gimInterlace){throw new Error("[Gif::readImageData] Too many bits for an un-interlaced image")}switch(a++){case 0:j=4;C=8;break;case 1:j=2;C=4;break;case 2:j=1;C=2;break}}}}}}m=null;d=null};Gif.prototype.readSubBlock=function(c){var b=PdfObject.GetNUINT(c,1);for(var a=0;a<b;a++){this.Block[a]=c.ReadByte()}return b};function Jpeg(){PdfImage.call(this);this.Width=this.Height=0;this.ColorSpace=-1}Jpeg.prototype=new PdfImage();for(var i=0;i<Object.keys(PdfImage).length;i++){var obj=Object.keys(PdfImage)[i];Jpeg[obj]=PdfImage[obj]}Jpeg.prototype.Init=function(c,e){var l=new MemoryStream(c);var h=PdfObject.GetNUINT(l,2);if((h>>8)!=216||(h&255)!=255){throw new Error("[Jpeg::Init] Wrong start TAG (T1 = 0x"+(h>>8).toString(16)+", T2 = 0x"+(h&255).toString(16)+")")}var a=false;while(true){h=PdfObject.GetNUINT(l,1);if(h==255){var g=PdfObject.GetNUINT(l,1);var d=0;if((g<208||g>215)&&g!=1){d=PdfObject.GetNUINT(l,2,true)}if(g==224){if(d<16){throw new Error("[Jpeg::Init] Wrong Segment Length (="+d+")")}var f=(l.ReadByte()==74)&&(l.ReadByte()==70)&&(l.ReadByte()==73)&&(l.ReadByte()==70)&&(l.ReadByte()==0);d-=5;if(!f){throw new Error("[Jpeg::Init] Can't find the JFIF+0x00 marker")}}else{if(g==238){var k=PdfObject.GetString(l,5);if(d>12&&k=="Adobe"){a=true}d-=5}else{if(g==192||g==193||g==194){this.BitsPerComponent=PdfObject.GetNUINT(l,1);if(this.BitsPerComponent!=8){throw new Error("[Jpeg::Init] Unexpected BPC ("+this.BitsPerComponent+") for Marker 0x"+g.toString(16))}this.Height=PdfObject.GetSHORT(l,true);this.Width=PdfObject.GetSHORT(l,true);this.ColorSpace=PdfObject.GetNUINT(l,1);d-=6}else{if(g==218||g==217){break}}}}if(d!=0){l.Seek(d-2)}}else{throw new Error("[Jpeg::Init] Wrong block start byte (found 0x"+h.toString(16)+" expected 0xFF)")}}this.DataSize=e;this.Data=c;this.BitsPerComponent=8;var j=new PdfArray();j.Add("/DCTDecode");this.Dict.Add("/Filter",j);if(this.ColorSpace==4&&a){this.Dict.Add("/Decode","[1 0 1 0 1 0 1 0]")}PdfImage.prototype.Init.call(this,c,e)};